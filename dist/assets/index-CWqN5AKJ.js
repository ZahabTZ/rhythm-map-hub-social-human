var D8=Object.defineProperty;var rD=t=>{throw TypeError(t)};var L8=(t,r,l)=>r in t?D8(t,r,{enumerable:!0,configurable:!0,writable:!0,value:l}):t[r]=l;var iD=(t,r,l)=>L8(t,typeof r!="symbol"?r+"":r,l),kT=(t,r,l)=>r.has(t)||rD("Cannot "+l);var tt=(t,r,l)=>(kT(t,r,"read from private field"),l?l.call(t):r.get(t)),fr=(t,r,l)=>r.has(t)?rD("Cannot add the same private member more than once"):r instanceof WeakSet?r.add(t):r.set(t,l),Fn=(t,r,l,d)=>(kT(t,r,"write to private field"),d?d.call(t,l):r.set(t,l),l),Jr=(t,r,l)=>(kT(t,r,"access private method"),l);var B1=(t,r,l,d)=>({set _(_){Fn(t,r,_,l)},get _(){return tt(t,r,d)}});function N8(t,r){for(var l=0;l<r.length;l++){const d=r[l];if(typeof d!="string"&&!Array.isArray(d)){for(const _ in d)if(_!=="default"&&!(_ in t)){const x=Object.getOwnPropertyDescriptor(d,_);x&&Object.defineProperty(t,_,x.get?x:{enumerable:!0,get:()=>d[_]})}}}return Object.freeze(Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}))}(function(){const r=document.createElement("link").relList;if(r&&r.supports&&r.supports("modulepreload"))return;for(const _ of document.querySelectorAll('link[rel="modulepreload"]'))d(_);new MutationObserver(_=>{for(const x of _)if(x.type==="childList")for(const C of x.addedNodes)C.tagName==="LINK"&&C.rel==="modulepreload"&&d(C)}).observe(document,{childList:!0,subtree:!0});function l(_){const x={};return _.integrity&&(x.integrity=_.integrity),_.referrerPolicy&&(x.referrerPolicy=_.referrerPolicy),_.crossOrigin==="use-credentials"?x.credentials="include":_.crossOrigin==="anonymous"?x.credentials="omit":x.credentials="same-origin",x}function d(_){if(_.ep)return;_.ep=!0;const x=l(_);fetch(_.href,x)}})();var z8=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function zw(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var HN={exports:{}},Ow={},qN={exports:{}},pi={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Cx=Symbol.for("react.element"),O8=Symbol.for("react.portal"),F8=Symbol.for("react.fragment"),j8=Symbol.for("react.strict_mode"),B8=Symbol.for("react.profiler"),V8=Symbol.for("react.provider"),U8=Symbol.for("react.context"),$8=Symbol.for("react.forward_ref"),G8=Symbol.for("react.suspense"),H8=Symbol.for("react.memo"),q8=Symbol.for("react.lazy"),sD=Symbol.iterator;function W8(t){return t===null||typeof t!="object"?null:(t=sD&&t[sD]||t["@@iterator"],typeof t=="function"?t:null)}var WN={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},ZN=Object.assign,XN={};function Jg(t,r,l){this.props=t,this.context=r,this.refs=XN,this.updater=l||WN}Jg.prototype.isReactComponent={};Jg.prototype.setState=function(t,r){if(typeof t!="object"&&typeof t!="function"&&t!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,t,r,"setState")};Jg.prototype.forceUpdate=function(t){this.updater.enqueueForceUpdate(this,t,"forceUpdate")};function YN(){}YN.prototype=Jg.prototype;function pA(t,r,l){this.props=t,this.context=r,this.refs=XN,this.updater=l||WN}var mA=pA.prototype=new YN;mA.constructor=pA;ZN(mA,Jg.prototype);mA.isPureReactComponent=!0;var oD=Array.isArray,KN=Object.prototype.hasOwnProperty,gA={current:null},QN={key:!0,ref:!0,__self:!0,__source:!0};function JN(t,r,l){var d,_={},x=null,C=null;if(r!=null)for(d in r.ref!==void 0&&(C=r.ref),r.key!==void 0&&(x=""+r.key),r)KN.call(r,d)&&!QN.hasOwnProperty(d)&&(_[d]=r[d]);var s=arguments.length-2;if(s===1)_.children=l;else if(1<s){for(var k=Array(s),z=0;z<s;z++)k[z]=arguments[z+2];_.children=k}if(t&&t.defaultProps)for(d in s=t.defaultProps,s)_[d]===void 0&&(_[d]=s[d]);return{$$typeof:Cx,type:t,key:x,ref:C,props:_,_owner:gA.current}}function Z8(t,r){return{$$typeof:Cx,type:t.type,key:r,ref:t.ref,props:t.props,_owner:t._owner}}function _A(t){return typeof t=="object"&&t!==null&&t.$$typeof===Cx}function X8(t){var r={"=":"=0",":":"=2"};return"$"+t.replace(/[=:]/g,function(l){return r[l]})}var aD=/\/+/g;function DT(t,r){return typeof t=="object"&&t!==null&&t.key!=null?X8(""+t.key):r.toString(36)}function gb(t,r,l,d,_){var x=typeof t;(x==="undefined"||x==="boolean")&&(t=null);var C=!1;if(t===null)C=!0;else switch(x){case"string":case"number":C=!0;break;case"object":switch(t.$$typeof){case Cx:case O8:C=!0}}if(C)return C=t,_=_(C),t=d===""?"."+DT(C,0):d,oD(_)?(l="",t!=null&&(l=t.replace(aD,"$&/")+"/"),gb(_,r,l,"",function(z){return z})):_!=null&&(_A(_)&&(_=Z8(_,l+(!_.key||C&&C.key===_.key?"":(""+_.key).replace(aD,"$&/")+"/")+t)),r.push(_)),1;if(C=0,d=d===""?".":d+":",oD(t))for(var s=0;s<t.length;s++){x=t[s];var k=d+DT(x,s);C+=gb(x,r,l,k,_)}else if(k=W8(t),typeof k=="function")for(t=k.call(t),s=0;!(x=t.next()).done;)x=x.value,k=d+DT(x,s++),C+=gb(x,r,l,k,_);else if(x==="object")throw r=String(t),Error("Objects are not valid as a React child (found: "+(r==="[object Object]"?"object with keys {"+Object.keys(t).join(", ")+"}":r)+"). If you meant to render a collection of children, use an array instead.");return C}function V1(t,r,l){if(t==null)return t;var d=[],_=0;return gb(t,d,"","",function(x){return r.call(l,x,_++)}),d}function Y8(t){if(t._status===-1){var r=t._result;r=r(),r.then(function(l){(t._status===0||t._status===-1)&&(t._status=1,t._result=l)},function(l){(t._status===0||t._status===-1)&&(t._status=2,t._result=l)}),t._status===-1&&(t._status=0,t._result=r)}if(t._status===1)return t._result.default;throw t._result}var Wo={current:null},_b={transition:null},K8={ReactCurrentDispatcher:Wo,ReactCurrentBatchConfig:_b,ReactCurrentOwner:gA};function e3(){throw Error("act(...) is not supported in production builds of React.")}pi.Children={map:V1,forEach:function(t,r,l){V1(t,function(){r.apply(this,arguments)},l)},count:function(t){var r=0;return V1(t,function(){r++}),r},toArray:function(t){return V1(t,function(r){return r})||[]},only:function(t){if(!_A(t))throw Error("React.Children.only expected to receive a single React element child.");return t}};pi.Component=Jg;pi.Fragment=F8;pi.Profiler=B8;pi.PureComponent=pA;pi.StrictMode=j8;pi.Suspense=G8;pi.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=K8;pi.act=e3;pi.cloneElement=function(t,r,l){if(t==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+t+".");var d=ZN({},t.props),_=t.key,x=t.ref,C=t._owner;if(r!=null){if(r.ref!==void 0&&(x=r.ref,C=gA.current),r.key!==void 0&&(_=""+r.key),t.type&&t.type.defaultProps)var s=t.type.defaultProps;for(k in r)KN.call(r,k)&&!QN.hasOwnProperty(k)&&(d[k]=r[k]===void 0&&s!==void 0?s[k]:r[k])}var k=arguments.length-2;if(k===1)d.children=l;else if(1<k){s=Array(k);for(var z=0;z<k;z++)s[z]=arguments[z+2];d.children=s}return{$$typeof:Cx,type:t.type,key:_,ref:x,props:d,_owner:C}};pi.createContext=function(t){return t={$$typeof:U8,_currentValue:t,_currentValue2:t,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},t.Provider={$$typeof:V8,_context:t},t.Consumer=t};pi.createElement=JN;pi.createFactory=function(t){var r=JN.bind(null,t);return r.type=t,r};pi.createRef=function(){return{current:null}};pi.forwardRef=function(t){return{$$typeof:$8,render:t}};pi.isValidElement=_A;pi.lazy=function(t){return{$$typeof:q8,_payload:{_status:-1,_result:t},_init:Y8}};pi.memo=function(t,r){return{$$typeof:H8,type:t,compare:r===void 0?null:r}};pi.startTransition=function(t){var r=_b.transition;_b.transition={};try{t()}finally{_b.transition=r}};pi.unstable_act=e3;pi.useCallback=function(t,r){return Wo.current.useCallback(t,r)};pi.useContext=function(t){return Wo.current.useContext(t)};pi.useDebugValue=function(){};pi.useDeferredValue=function(t){return Wo.current.useDeferredValue(t)};pi.useEffect=function(t,r){return Wo.current.useEffect(t,r)};pi.useId=function(){return Wo.current.useId()};pi.useImperativeHandle=function(t,r,l){return Wo.current.useImperativeHandle(t,r,l)};pi.useInsertionEffect=function(t,r){return Wo.current.useInsertionEffect(t,r)};pi.useLayoutEffect=function(t,r){return Wo.current.useLayoutEffect(t,r)};pi.useMemo=function(t,r){return Wo.current.useMemo(t,r)};pi.useReducer=function(t,r,l){return Wo.current.useReducer(t,r,l)};pi.useRef=function(t){return Wo.current.useRef(t)};pi.useState=function(t){return Wo.current.useState(t)};pi.useSyncExternalStore=function(t,r,l){return Wo.current.useSyncExternalStore(t,r,l)};pi.useTransition=function(){return Wo.current.useTransition()};pi.version="18.3.1";qN.exports=pi;var B=qN.exports;const Nt=zw(B),t3=N8({__proto__:null,default:Nt},[B]);/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Q8=B,J8=Symbol.for("react.element"),e$=Symbol.for("react.fragment"),t$=Object.prototype.hasOwnProperty,n$=Q8.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,r$={key:!0,ref:!0,__self:!0,__source:!0};function n3(t,r,l){var d,_={},x=null,C=null;l!==void 0&&(x=""+l),r.key!==void 0&&(x=""+r.key),r.ref!==void 0&&(C=r.ref);for(d in r)t$.call(r,d)&&!r$.hasOwnProperty(d)&&(_[d]=r[d]);if(t&&t.defaultProps)for(d in r=t.defaultProps,r)_[d]===void 0&&(_[d]=r[d]);return{$$typeof:J8,type:t,key:x,ref:C,props:_,_owner:n$.current}}Ow.Fragment=e$;Ow.jsx=n3;Ow.jsxs=n3;HN.exports=Ow;var w=HN.exports,r3={exports:{}},La={},i3={exports:{}},s3={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(t){function r(Be,ft){var Ct=Be.length;Be.push(ft);e:for(;0<Ct;){var Zt=Ct-1>>>1,fn=Be[Zt];if(0<_(fn,ft))Be[Zt]=ft,Be[Ct]=fn,Ct=Zt;else break e}}function l(Be){return Be.length===0?null:Be[0]}function d(Be){if(Be.length===0)return null;var ft=Be[0],Ct=Be.pop();if(Ct!==ft){Be[0]=Ct;e:for(var Zt=0,fn=Be.length,Qn=fn>>>1;Zt<Qn;){var $n=2*(Zt+1)-1,Hn=Be[$n],rn=$n+1,an=Be[rn];if(0>_(Hn,Ct))rn<fn&&0>_(an,Hn)?(Be[Zt]=an,Be[rn]=Ct,Zt=rn):(Be[Zt]=Hn,Be[$n]=Ct,Zt=$n);else if(rn<fn&&0>_(an,Ct))Be[Zt]=an,Be[rn]=Ct,Zt=rn;else break e}}return ft}function _(Be,ft){var Ct=Be.sortIndex-ft.sortIndex;return Ct!==0?Ct:Be.id-ft.id}if(typeof performance=="object"&&typeof performance.now=="function"){var x=performance;t.unstable_now=function(){return x.now()}}else{var C=Date,s=C.now();t.unstable_now=function(){return C.now()-s}}var k=[],z=[],V=1,U=null,$=3,se=!1,ae=!1,H=!1,ne=typeof setTimeout=="function"?setTimeout:null,Y=typeof clearTimeout=="function"?clearTimeout:null,te=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function de(Be){for(var ft=l(z);ft!==null;){if(ft.callback===null)d(z);else if(ft.startTime<=Be)d(z),ft.sortIndex=ft.expirationTime,r(k,ft);else break;ft=l(z)}}function Me(Be){if(H=!1,de(Be),!ae)if(l(k)!==null)ae=!0,Je(Le);else{var ft=l(z);ft!==null&&mt(Me,ft.startTime-Be)}}function Le(Be,ft){ae=!1,H&&(H=!1,Y(Ye),Ye=-1),se=!0;var Ct=$;try{for(de(ft),U=l(k);U!==null&&(!(U.expirationTime>ft)||Be&&!Ut());){var Zt=U.callback;if(typeof Zt=="function"){U.callback=null,$=U.priorityLevel;var fn=Zt(U.expirationTime<=ft);ft=t.unstable_now(),typeof fn=="function"?U.callback=fn:U===l(k)&&d(k),de(ft)}else d(k);U=l(k)}if(U!==null)var Qn=!0;else{var $n=l(z);$n!==null&&mt(Me,$n.startTime-ft),Qn=!1}return Qn}finally{U=null,$=Ct,se=!1}}var lt=!1,Pe=null,Ye=-1,vt=5,It=-1;function Ut(){return!(t.unstable_now()-It<vt)}function Pt(){if(Pe!==null){var Be=t.unstable_now();It=Be;var ft=!0;try{ft=Pe(!0,Be)}finally{ft?$t():(lt=!1,Pe=null)}}else lt=!1}var $t;if(typeof te=="function")$t=function(){te(Pt)};else if(typeof MessageChannel<"u"){var Ve=new MessageChannel,jt=Ve.port2;Ve.port1.onmessage=Pt,$t=function(){jt.postMessage(null)}}else $t=function(){ne(Pt,0)};function Je(Be){Pe=Be,lt||(lt=!0,$t())}function mt(Be,ft){Ye=ne(function(){Be(t.unstable_now())},ft)}t.unstable_IdlePriority=5,t.unstable_ImmediatePriority=1,t.unstable_LowPriority=4,t.unstable_NormalPriority=3,t.unstable_Profiling=null,t.unstable_UserBlockingPriority=2,t.unstable_cancelCallback=function(Be){Be.callback=null},t.unstable_continueExecution=function(){ae||se||(ae=!0,Je(Le))},t.unstable_forceFrameRate=function(Be){0>Be||125<Be?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):vt=0<Be?Math.floor(1e3/Be):5},t.unstable_getCurrentPriorityLevel=function(){return $},t.unstable_getFirstCallbackNode=function(){return l(k)},t.unstable_next=function(Be){switch($){case 1:case 2:case 3:var ft=3;break;default:ft=$}var Ct=$;$=ft;try{return Be()}finally{$=Ct}},t.unstable_pauseExecution=function(){},t.unstable_requestPaint=function(){},t.unstable_runWithPriority=function(Be,ft){switch(Be){case 1:case 2:case 3:case 4:case 5:break;default:Be=3}var Ct=$;$=Be;try{return ft()}finally{$=Ct}},t.unstable_scheduleCallback=function(Be,ft,Ct){var Zt=t.unstable_now();switch(typeof Ct=="object"&&Ct!==null?(Ct=Ct.delay,Ct=typeof Ct=="number"&&0<Ct?Zt+Ct:Zt):Ct=Zt,Be){case 1:var fn=-1;break;case 2:fn=250;break;case 5:fn=1073741823;break;case 4:fn=1e4;break;default:fn=5e3}return fn=Ct+fn,Be={id:V++,callback:ft,priorityLevel:Be,startTime:Ct,expirationTime:fn,sortIndex:-1},Ct>Zt?(Be.sortIndex=Ct,r(z,Be),l(k)===null&&Be===l(z)&&(H?(Y(Ye),Ye=-1):H=!0,mt(Me,Ct-Zt))):(Be.sortIndex=fn,r(k,Be),ae||se||(ae=!0,Je(Le))),Be},t.unstable_shouldYield=Ut,t.unstable_wrapCallback=function(Be){var ft=$;return function(){var Ct=$;$=ft;try{return Be.apply(this,arguments)}finally{$=Ct}}}})(s3);i3.exports=s3;var i$=i3.exports;/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var s$=B,Da=i$;function un(t){for(var r="https://reactjs.org/docs/error-decoder.html?invariant="+t,l=1;l<arguments.length;l++)r+="&args[]="+encodeURIComponent(arguments[l]);return"Minified React error #"+t+"; visit "+r+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var o3=new Set,Nv={};function mp(t,r){Ng(t,r),Ng(t+"Capture",r)}function Ng(t,r){for(Nv[t]=r,t=0;t<r.length;t++)o3.add(r[t])}var Su=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),EE=Object.prototype.hasOwnProperty,o$=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,lD={},cD={};function a$(t){return EE.call(cD,t)?!0:EE.call(lD,t)?!1:o$.test(t)?cD[t]=!0:(lD[t]=!0,!1)}function l$(t,r,l,d){if(l!==null&&l.type===0)return!1;switch(typeof r){case"function":case"symbol":return!0;case"boolean":return d?!1:l!==null?!l.acceptsBooleans:(t=t.toLowerCase().slice(0,5),t!=="data-"&&t!=="aria-");default:return!1}}function c$(t,r,l,d){if(r===null||typeof r>"u"||l$(t,r,l,d))return!0;if(d)return!1;if(l!==null)switch(l.type){case 3:return!r;case 4:return r===!1;case 5:return isNaN(r);case 6:return isNaN(r)||1>r}return!1}function Zo(t,r,l,d,_,x,C){this.acceptsBooleans=r===2||r===3||r===4,this.attributeName=d,this.attributeNamespace=_,this.mustUseProperty=l,this.propertyName=t,this.type=r,this.sanitizeURL=x,this.removeEmptyString=C}var go={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(t){go[t]=new Zo(t,0,!1,t,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(t){var r=t[0];go[r]=new Zo(r,1,!1,t[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(t){go[t]=new Zo(t,2,!1,t.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(t){go[t]=new Zo(t,2,!1,t,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(t){go[t]=new Zo(t,3,!1,t.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(t){go[t]=new Zo(t,3,!0,t,null,!1,!1)});["capture","download"].forEach(function(t){go[t]=new Zo(t,4,!1,t,null,!1,!1)});["cols","rows","size","span"].forEach(function(t){go[t]=new Zo(t,6,!1,t,null,!1,!1)});["rowSpan","start"].forEach(function(t){go[t]=new Zo(t,5,!1,t.toLowerCase(),null,!1,!1)});var yA=/[\-:]([a-z])/g;function vA(t){return t[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(t){var r=t.replace(yA,vA);go[r]=new Zo(r,1,!1,t,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(t){var r=t.replace(yA,vA);go[r]=new Zo(r,1,!1,t,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(t){var r=t.replace(yA,vA);go[r]=new Zo(r,1,!1,t,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(t){go[t]=new Zo(t,1,!1,t.toLowerCase(),null,!1,!1)});go.xlinkHref=new Zo("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(t){go[t]=new Zo(t,1,!1,t.toLowerCase(),null,!0,!0)});function xA(t,r,l,d){var _=go.hasOwnProperty(r)?go[r]:null;(_!==null?_.type!==0:d||!(2<r.length)||r[0]!=="o"&&r[0]!=="O"||r[1]!=="n"&&r[1]!=="N")&&(c$(r,l,_,d)&&(l=null),d||_===null?a$(r)&&(l===null?t.removeAttribute(r):t.setAttribute(r,""+l)):_.mustUseProperty?t[_.propertyName]=l===null?_.type===3?!1:"":l:(r=_.attributeName,d=_.attributeNamespace,l===null?t.removeAttribute(r):(_=_.type,l=_===3||_===4&&l===!0?"":""+l,d?t.setAttributeNS(d,r,l):t.setAttribute(r,l))))}var Ru=s$.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,U1=Symbol.for("react.element"),Xm=Symbol.for("react.portal"),Ym=Symbol.for("react.fragment"),bA=Symbol.for("react.strict_mode"),CE=Symbol.for("react.profiler"),a3=Symbol.for("react.provider"),l3=Symbol.for("react.context"),wA=Symbol.for("react.forward_ref"),AE=Symbol.for("react.suspense"),IE=Symbol.for("react.suspense_list"),SA=Symbol.for("react.memo"),Rd=Symbol.for("react.lazy"),c3=Symbol.for("react.offscreen"),uD=Symbol.iterator;function Jy(t){return t===null||typeof t!="object"?null:(t=uD&&t[uD]||t["@@iterator"],typeof t=="function"?t:null)}var hs=Object.assign,LT;function fv(t){if(LT===void 0)try{throw Error()}catch(l){var r=l.stack.trim().match(/\n( *(at )?)/);LT=r&&r[1]||""}return`
`+LT+t}var NT=!1;function zT(t,r){if(!t||NT)return"";NT=!0;var l=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(r)if(r=function(){throw Error()},Object.defineProperty(r.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(r,[])}catch(z){var d=z}Reflect.construct(t,[],r)}else{try{r.call()}catch(z){d=z}t.call(r.prototype)}else{try{throw Error()}catch(z){d=z}t()}}catch(z){if(z&&d&&typeof z.stack=="string"){for(var _=z.stack.split(`
`),x=d.stack.split(`
`),C=_.length-1,s=x.length-1;1<=C&&0<=s&&_[C]!==x[s];)s--;for(;1<=C&&0<=s;C--,s--)if(_[C]!==x[s]){if(C!==1||s!==1)do if(C--,s--,0>s||_[C]!==x[s]){var k=`
`+_[C].replace(" at new "," at ");return t.displayName&&k.includes("<anonymous>")&&(k=k.replace("<anonymous>",t.displayName)),k}while(1<=C&&0<=s);break}}}finally{NT=!1,Error.prepareStackTrace=l}return(t=t?t.displayName||t.name:"")?fv(t):""}function u$(t){switch(t.tag){case 5:return fv(t.type);case 16:return fv("Lazy");case 13:return fv("Suspense");case 19:return fv("SuspenseList");case 0:case 2:case 15:return t=zT(t.type,!1),t;case 11:return t=zT(t.type.render,!1),t;case 1:return t=zT(t.type,!0),t;default:return""}}function PE(t){if(t==null)return null;if(typeof t=="function")return t.displayName||t.name||null;if(typeof t=="string")return t;switch(t){case Ym:return"Fragment";case Xm:return"Portal";case CE:return"Profiler";case bA:return"StrictMode";case AE:return"Suspense";case IE:return"SuspenseList"}if(typeof t=="object")switch(t.$$typeof){case l3:return(t.displayName||"Context")+".Consumer";case a3:return(t._context.displayName||"Context")+".Provider";case wA:var r=t.render;return t=t.displayName,t||(t=r.displayName||r.name||"",t=t!==""?"ForwardRef("+t+")":"ForwardRef"),t;case SA:return r=t.displayName||null,r!==null?r:PE(t.type)||"Memo";case Rd:r=t._payload,t=t._init;try{return PE(t(r))}catch{}}return null}function d$(t){var r=t.type;switch(t.tag){case 24:return"Cache";case 9:return(r.displayName||"Context")+".Consumer";case 10:return(r._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return t=r.render,t=t.displayName||t.name||"",r.displayName||(t!==""?"ForwardRef("+t+")":"ForwardRef");case 7:return"Fragment";case 5:return r;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return PE(r);case 8:return r===bA?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof r=="function")return r.displayName||r.name||null;if(typeof r=="string")return r}return null}function sh(t){switch(typeof t){case"boolean":case"number":case"string":case"undefined":return t;case"object":return t;default:return""}}function u3(t){var r=t.type;return(t=t.nodeName)&&t.toLowerCase()==="input"&&(r==="checkbox"||r==="radio")}function h$(t){var r=u3(t)?"checked":"value",l=Object.getOwnPropertyDescriptor(t.constructor.prototype,r),d=""+t[r];if(!t.hasOwnProperty(r)&&typeof l<"u"&&typeof l.get=="function"&&typeof l.set=="function"){var _=l.get,x=l.set;return Object.defineProperty(t,r,{configurable:!0,get:function(){return _.call(this)},set:function(C){d=""+C,x.call(this,C)}}),Object.defineProperty(t,r,{enumerable:l.enumerable}),{getValue:function(){return d},setValue:function(C){d=""+C},stopTracking:function(){t._valueTracker=null,delete t[r]}}}}function $1(t){t._valueTracker||(t._valueTracker=h$(t))}function d3(t){if(!t)return!1;var r=t._valueTracker;if(!r)return!0;var l=r.getValue(),d="";return t&&(d=u3(t)?t.checked?"true":"false":t.value),t=d,t!==l?(r.setValue(t),!0):!1}function jb(t){if(t=t||(typeof document<"u"?document:void 0),typeof t>"u")return null;try{return t.activeElement||t.body}catch{return t.body}}function ME(t,r){var l=r.checked;return hs({},r,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:l??t._wrapperState.initialChecked})}function dD(t,r){var l=r.defaultValue==null?"":r.defaultValue,d=r.checked!=null?r.checked:r.defaultChecked;l=sh(r.value!=null?r.value:l),t._wrapperState={initialChecked:d,initialValue:l,controlled:r.type==="checkbox"||r.type==="radio"?r.checked!=null:r.value!=null}}function h3(t,r){r=r.checked,r!=null&&xA(t,"checked",r,!1)}function RE(t,r){h3(t,r);var l=sh(r.value),d=r.type;if(l!=null)d==="number"?(l===0&&t.value===""||t.value!=l)&&(t.value=""+l):t.value!==""+l&&(t.value=""+l);else if(d==="submit"||d==="reset"){t.removeAttribute("value");return}r.hasOwnProperty("value")?kE(t,r.type,l):r.hasOwnProperty("defaultValue")&&kE(t,r.type,sh(r.defaultValue)),r.checked==null&&r.defaultChecked!=null&&(t.defaultChecked=!!r.defaultChecked)}function hD(t,r,l){if(r.hasOwnProperty("value")||r.hasOwnProperty("defaultValue")){var d=r.type;if(!(d!=="submit"&&d!=="reset"||r.value!==void 0&&r.value!==null))return;r=""+t._wrapperState.initialValue,l||r===t.value||(t.value=r),t.defaultValue=r}l=t.name,l!==""&&(t.name=""),t.defaultChecked=!!t._wrapperState.initialChecked,l!==""&&(t.name=l)}function kE(t,r,l){(r!=="number"||jb(t.ownerDocument)!==t)&&(l==null?t.defaultValue=""+t._wrapperState.initialValue:t.defaultValue!==""+l&&(t.defaultValue=""+l))}var pv=Array.isArray;function cg(t,r,l,d){if(t=t.options,r){r={};for(var _=0;_<l.length;_++)r["$"+l[_]]=!0;for(l=0;l<t.length;l++)_=r.hasOwnProperty("$"+t[l].value),t[l].selected!==_&&(t[l].selected=_),_&&d&&(t[l].defaultSelected=!0)}else{for(l=""+sh(l),r=null,_=0;_<t.length;_++){if(t[_].value===l){t[_].selected=!0,d&&(t[_].defaultSelected=!0);return}r!==null||t[_].disabled||(r=t[_])}r!==null&&(r.selected=!0)}}function DE(t,r){if(r.dangerouslySetInnerHTML!=null)throw Error(un(91));return hs({},r,{value:void 0,defaultValue:void 0,children:""+t._wrapperState.initialValue})}function fD(t,r){var l=r.value;if(l==null){if(l=r.children,r=r.defaultValue,l!=null){if(r!=null)throw Error(un(92));if(pv(l)){if(1<l.length)throw Error(un(93));l=l[0]}r=l}r==null&&(r=""),l=r}t._wrapperState={initialValue:sh(l)}}function f3(t,r){var l=sh(r.value),d=sh(r.defaultValue);l!=null&&(l=""+l,l!==t.value&&(t.value=l),r.defaultValue==null&&t.defaultValue!==l&&(t.defaultValue=l)),d!=null&&(t.defaultValue=""+d)}function pD(t){var r=t.textContent;r===t._wrapperState.initialValue&&r!==""&&r!==null&&(t.value=r)}function p3(t){switch(t){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function LE(t,r){return t==null||t==="http://www.w3.org/1999/xhtml"?p3(r):t==="http://www.w3.org/2000/svg"&&r==="foreignObject"?"http://www.w3.org/1999/xhtml":t}var G1,m3=function(t){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(r,l,d,_){MSApp.execUnsafeLocalFunction(function(){return t(r,l,d,_)})}:t}(function(t,r){if(t.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in t)t.innerHTML=r;else{for(G1=G1||document.createElement("div"),G1.innerHTML="<svg>"+r.valueOf().toString()+"</svg>",r=G1.firstChild;t.firstChild;)t.removeChild(t.firstChild);for(;r.firstChild;)t.appendChild(r.firstChild)}});function zv(t,r){if(r){var l=t.firstChild;if(l&&l===t.lastChild&&l.nodeType===3){l.nodeValue=r;return}}t.textContent=r}var wv={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},f$=["Webkit","ms","Moz","O"];Object.keys(wv).forEach(function(t){f$.forEach(function(r){r=r+t.charAt(0).toUpperCase()+t.substring(1),wv[r]=wv[t]})});function g3(t,r,l){return r==null||typeof r=="boolean"||r===""?"":l||typeof r!="number"||r===0||wv.hasOwnProperty(t)&&wv[t]?(""+r).trim():r+"px"}function _3(t,r){t=t.style;for(var l in r)if(r.hasOwnProperty(l)){var d=l.indexOf("--")===0,_=g3(l,r[l],d);l==="float"&&(l="cssFloat"),d?t.setProperty(l,_):t[l]=_}}var p$=hs({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function NE(t,r){if(r){if(p$[t]&&(r.children!=null||r.dangerouslySetInnerHTML!=null))throw Error(un(137,t));if(r.dangerouslySetInnerHTML!=null){if(r.children!=null)throw Error(un(60));if(typeof r.dangerouslySetInnerHTML!="object"||!("__html"in r.dangerouslySetInnerHTML))throw Error(un(61))}if(r.style!=null&&typeof r.style!="object")throw Error(un(62))}}function zE(t,r){if(t.indexOf("-")===-1)return typeof r.is=="string";switch(t){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var OE=null;function TA(t){return t=t.target||t.srcElement||window,t.correspondingUseElement&&(t=t.correspondingUseElement),t.nodeType===3?t.parentNode:t}var FE=null,ug=null,dg=null;function mD(t){if(t=Px(t)){if(typeof FE!="function")throw Error(un(280));var r=t.stateNode;r&&(r=Uw(r),FE(t.stateNode,t.type,r))}}function y3(t){ug?dg?dg.push(t):dg=[t]:ug=t}function v3(){if(ug){var t=ug,r=dg;if(dg=ug=null,mD(t),r)for(t=0;t<r.length;t++)mD(r[t])}}function x3(t,r){return t(r)}function b3(){}var OT=!1;function w3(t,r,l){if(OT)return t(r,l);OT=!0;try{return x3(t,r,l)}finally{OT=!1,(ug!==null||dg!==null)&&(b3(),v3())}}function Ov(t,r){var l=t.stateNode;if(l===null)return null;var d=Uw(l);if(d===null)return null;l=d[r];e:switch(r){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(d=!d.disabled)||(t=t.type,d=!(t==="button"||t==="input"||t==="select"||t==="textarea")),t=!d;break e;default:t=!1}if(t)return null;if(l&&typeof l!="function")throw Error(un(231,r,typeof l));return l}var jE=!1;if(Su)try{var ev={};Object.defineProperty(ev,"passive",{get:function(){jE=!0}}),window.addEventListener("test",ev,ev),window.removeEventListener("test",ev,ev)}catch{jE=!1}function m$(t,r,l,d,_,x,C,s,k){var z=Array.prototype.slice.call(arguments,3);try{r.apply(l,z)}catch(V){this.onError(V)}}var Sv=!1,Bb=null,Vb=!1,BE=null,g$={onError:function(t){Sv=!0,Bb=t}};function _$(t,r,l,d,_,x,C,s,k){Sv=!1,Bb=null,m$.apply(g$,arguments)}function y$(t,r,l,d,_,x,C,s,k){if(_$.apply(this,arguments),Sv){if(Sv){var z=Bb;Sv=!1,Bb=null}else throw Error(un(198));Vb||(Vb=!0,BE=z)}}function gp(t){var r=t,l=t;if(t.alternate)for(;r.return;)r=r.return;else{t=r;do r=t,r.flags&4098&&(l=r.return),t=r.return;while(t)}return r.tag===3?l:null}function S3(t){if(t.tag===13){var r=t.memoizedState;if(r===null&&(t=t.alternate,t!==null&&(r=t.memoizedState)),r!==null)return r.dehydrated}return null}function gD(t){if(gp(t)!==t)throw Error(un(188))}function v$(t){var r=t.alternate;if(!r){if(r=gp(t),r===null)throw Error(un(188));return r!==t?null:t}for(var l=t,d=r;;){var _=l.return;if(_===null)break;var x=_.alternate;if(x===null){if(d=_.return,d!==null){l=d;continue}break}if(_.child===x.child){for(x=_.child;x;){if(x===l)return gD(_),t;if(x===d)return gD(_),r;x=x.sibling}throw Error(un(188))}if(l.return!==d.return)l=_,d=x;else{for(var C=!1,s=_.child;s;){if(s===l){C=!0,l=_,d=x;break}if(s===d){C=!0,d=_,l=x;break}s=s.sibling}if(!C){for(s=x.child;s;){if(s===l){C=!0,l=x,d=_;break}if(s===d){C=!0,d=x,l=_;break}s=s.sibling}if(!C)throw Error(un(189))}}if(l.alternate!==d)throw Error(un(190))}if(l.tag!==3)throw Error(un(188));return l.stateNode.current===l?t:r}function T3(t){return t=v$(t),t!==null?E3(t):null}function E3(t){if(t.tag===5||t.tag===6)return t;for(t=t.child;t!==null;){var r=E3(t);if(r!==null)return r;t=t.sibling}return null}var C3=Da.unstable_scheduleCallback,_D=Da.unstable_cancelCallback,x$=Da.unstable_shouldYield,b$=Da.unstable_requestPaint,Ts=Da.unstable_now,w$=Da.unstable_getCurrentPriorityLevel,EA=Da.unstable_ImmediatePriority,A3=Da.unstable_UserBlockingPriority,Ub=Da.unstable_NormalPriority,S$=Da.unstable_LowPriority,I3=Da.unstable_IdlePriority,Fw=null,Ac=null;function T$(t){if(Ac&&typeof Ac.onCommitFiberRoot=="function")try{Ac.onCommitFiberRoot(Fw,t,void 0,(t.current.flags&128)===128)}catch{}}var Nl=Math.clz32?Math.clz32:A$,E$=Math.log,C$=Math.LN2;function A$(t){return t>>>=0,t===0?32:31-(E$(t)/C$|0)|0}var H1=64,q1=4194304;function mv(t){switch(t&-t){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return t&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return t&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return t}}function $b(t,r){var l=t.pendingLanes;if(l===0)return 0;var d=0,_=t.suspendedLanes,x=t.pingedLanes,C=l&268435455;if(C!==0){var s=C&~_;s!==0?d=mv(s):(x&=C,x!==0&&(d=mv(x)))}else C=l&~_,C!==0?d=mv(C):x!==0&&(d=mv(x));if(d===0)return 0;if(r!==0&&r!==d&&!(r&_)&&(_=d&-d,x=r&-r,_>=x||_===16&&(x&4194240)!==0))return r;if(d&4&&(d|=l&16),r=t.entangledLanes,r!==0)for(t=t.entanglements,r&=d;0<r;)l=31-Nl(r),_=1<<l,d|=t[l],r&=~_;return d}function I$(t,r){switch(t){case 1:case 2:case 4:return r+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return r+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function P$(t,r){for(var l=t.suspendedLanes,d=t.pingedLanes,_=t.expirationTimes,x=t.pendingLanes;0<x;){var C=31-Nl(x),s=1<<C,k=_[C];k===-1?(!(s&l)||s&d)&&(_[C]=I$(s,r)):k<=r&&(t.expiredLanes|=s),x&=~s}}function VE(t){return t=t.pendingLanes&-1073741825,t!==0?t:t&1073741824?1073741824:0}function P3(){var t=H1;return H1<<=1,!(H1&4194240)&&(H1=64),t}function FT(t){for(var r=[],l=0;31>l;l++)r.push(t);return r}function Ax(t,r,l){t.pendingLanes|=r,r!==536870912&&(t.suspendedLanes=0,t.pingedLanes=0),t=t.eventTimes,r=31-Nl(r),t[r]=l}function M$(t,r){var l=t.pendingLanes&~r;t.pendingLanes=r,t.suspendedLanes=0,t.pingedLanes=0,t.expiredLanes&=r,t.mutableReadLanes&=r,t.entangledLanes&=r,r=t.entanglements;var d=t.eventTimes;for(t=t.expirationTimes;0<l;){var _=31-Nl(l),x=1<<_;r[_]=0,d[_]=-1,t[_]=-1,l&=~x}}function CA(t,r){var l=t.entangledLanes|=r;for(t=t.entanglements;l;){var d=31-Nl(l),_=1<<d;_&r|t[d]&r&&(t[d]|=r),l&=~_}}var Vi=0;function M3(t){return t&=-t,1<t?4<t?t&268435455?16:536870912:4:1}var R3,AA,k3,D3,L3,UE=!1,W1=[],Xd=null,Yd=null,Kd=null,Fv=new Map,jv=new Map,Dd=[],R$="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function yD(t,r){switch(t){case"focusin":case"focusout":Xd=null;break;case"dragenter":case"dragleave":Yd=null;break;case"mouseover":case"mouseout":Kd=null;break;case"pointerover":case"pointerout":Fv.delete(r.pointerId);break;case"gotpointercapture":case"lostpointercapture":jv.delete(r.pointerId)}}function tv(t,r,l,d,_,x){return t===null||t.nativeEvent!==x?(t={blockedOn:r,domEventName:l,eventSystemFlags:d,nativeEvent:x,targetContainers:[_]},r!==null&&(r=Px(r),r!==null&&AA(r)),t):(t.eventSystemFlags|=d,r=t.targetContainers,_!==null&&r.indexOf(_)===-1&&r.push(_),t)}function k$(t,r,l,d,_){switch(r){case"focusin":return Xd=tv(Xd,t,r,l,d,_),!0;case"dragenter":return Yd=tv(Yd,t,r,l,d,_),!0;case"mouseover":return Kd=tv(Kd,t,r,l,d,_),!0;case"pointerover":var x=_.pointerId;return Fv.set(x,tv(Fv.get(x)||null,t,r,l,d,_)),!0;case"gotpointercapture":return x=_.pointerId,jv.set(x,tv(jv.get(x)||null,t,r,l,d,_)),!0}return!1}function N3(t){var r=Nf(t.target);if(r!==null){var l=gp(r);if(l!==null){if(r=l.tag,r===13){if(r=S3(l),r!==null){t.blockedOn=r,L3(t.priority,function(){k3(l)});return}}else if(r===3&&l.stateNode.current.memoizedState.isDehydrated){t.blockedOn=l.tag===3?l.stateNode.containerInfo:null;return}}}t.blockedOn=null}function yb(t){if(t.blockedOn!==null)return!1;for(var r=t.targetContainers;0<r.length;){var l=$E(t.domEventName,t.eventSystemFlags,r[0],t.nativeEvent);if(l===null){l=t.nativeEvent;var d=new l.constructor(l.type,l);OE=d,l.target.dispatchEvent(d),OE=null}else return r=Px(l),r!==null&&AA(r),t.blockedOn=l,!1;r.shift()}return!0}function vD(t,r,l){yb(t)&&l.delete(r)}function D$(){UE=!1,Xd!==null&&yb(Xd)&&(Xd=null),Yd!==null&&yb(Yd)&&(Yd=null),Kd!==null&&yb(Kd)&&(Kd=null),Fv.forEach(vD),jv.forEach(vD)}function nv(t,r){t.blockedOn===r&&(t.blockedOn=null,UE||(UE=!0,Da.unstable_scheduleCallback(Da.unstable_NormalPriority,D$)))}function Bv(t){function r(_){return nv(_,t)}if(0<W1.length){nv(W1[0],t);for(var l=1;l<W1.length;l++){var d=W1[l];d.blockedOn===t&&(d.blockedOn=null)}}for(Xd!==null&&nv(Xd,t),Yd!==null&&nv(Yd,t),Kd!==null&&nv(Kd,t),Fv.forEach(r),jv.forEach(r),l=0;l<Dd.length;l++)d=Dd[l],d.blockedOn===t&&(d.blockedOn=null);for(;0<Dd.length&&(l=Dd[0],l.blockedOn===null);)N3(l),l.blockedOn===null&&Dd.shift()}var hg=Ru.ReactCurrentBatchConfig,Gb=!0;function L$(t,r,l,d){var _=Vi,x=hg.transition;hg.transition=null;try{Vi=1,IA(t,r,l,d)}finally{Vi=_,hg.transition=x}}function N$(t,r,l,d){var _=Vi,x=hg.transition;hg.transition=null;try{Vi=4,IA(t,r,l,d)}finally{Vi=_,hg.transition=x}}function IA(t,r,l,d){if(Gb){var _=$E(t,r,l,d);if(_===null)ZT(t,r,d,Hb,l),yD(t,d);else if(k$(_,t,r,l,d))d.stopPropagation();else if(yD(t,d),r&4&&-1<R$.indexOf(t)){for(;_!==null;){var x=Px(_);if(x!==null&&R3(x),x=$E(t,r,l,d),x===null&&ZT(t,r,d,Hb,l),x===_)break;_=x}_!==null&&d.stopPropagation()}else ZT(t,r,d,null,l)}}var Hb=null;function $E(t,r,l,d){if(Hb=null,t=TA(d),t=Nf(t),t!==null)if(r=gp(t),r===null)t=null;else if(l=r.tag,l===13){if(t=S3(r),t!==null)return t;t=null}else if(l===3){if(r.stateNode.current.memoizedState.isDehydrated)return r.tag===3?r.stateNode.containerInfo:null;t=null}else r!==t&&(t=null);return Hb=t,null}function z3(t){switch(t){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(w$()){case EA:return 1;case A3:return 4;case Ub:case S$:return 16;case I3:return 536870912;default:return 16}default:return 16}}var qd=null,PA=null,vb=null;function O3(){if(vb)return vb;var t,r=PA,l=r.length,d,_="value"in qd?qd.value:qd.textContent,x=_.length;for(t=0;t<l&&r[t]===_[t];t++);var C=l-t;for(d=1;d<=C&&r[l-d]===_[x-d];d++);return vb=_.slice(t,1<d?1-d:void 0)}function xb(t){var r=t.keyCode;return"charCode"in t?(t=t.charCode,t===0&&r===13&&(t=13)):t=r,t===10&&(t=13),32<=t||t===13?t:0}function Z1(){return!0}function xD(){return!1}function Na(t){function r(l,d,_,x,C){this._reactName=l,this._targetInst=_,this.type=d,this.nativeEvent=x,this.target=C,this.currentTarget=null;for(var s in t)t.hasOwnProperty(s)&&(l=t[s],this[s]=l?l(x):x[s]);return this.isDefaultPrevented=(x.defaultPrevented!=null?x.defaultPrevented:x.returnValue===!1)?Z1:xD,this.isPropagationStopped=xD,this}return hs(r.prototype,{preventDefault:function(){this.defaultPrevented=!0;var l=this.nativeEvent;l&&(l.preventDefault?l.preventDefault():typeof l.returnValue!="unknown"&&(l.returnValue=!1),this.isDefaultPrevented=Z1)},stopPropagation:function(){var l=this.nativeEvent;l&&(l.stopPropagation?l.stopPropagation():typeof l.cancelBubble!="unknown"&&(l.cancelBubble=!0),this.isPropagationStopped=Z1)},persist:function(){},isPersistent:Z1}),r}var e_={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(t){return t.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},MA=Na(e_),Ix=hs({},e_,{view:0,detail:0}),z$=Na(Ix),jT,BT,rv,jw=hs({},Ix,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:RA,button:0,buttons:0,relatedTarget:function(t){return t.relatedTarget===void 0?t.fromElement===t.srcElement?t.toElement:t.fromElement:t.relatedTarget},movementX:function(t){return"movementX"in t?t.movementX:(t!==rv&&(rv&&t.type==="mousemove"?(jT=t.screenX-rv.screenX,BT=t.screenY-rv.screenY):BT=jT=0,rv=t),jT)},movementY:function(t){return"movementY"in t?t.movementY:BT}}),bD=Na(jw),O$=hs({},jw,{dataTransfer:0}),F$=Na(O$),j$=hs({},Ix,{relatedTarget:0}),VT=Na(j$),B$=hs({},e_,{animationName:0,elapsedTime:0,pseudoElement:0}),V$=Na(B$),U$=hs({},e_,{clipboardData:function(t){return"clipboardData"in t?t.clipboardData:window.clipboardData}}),$$=Na(U$),G$=hs({},e_,{data:0}),wD=Na(G$),H$={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},q$={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},W$={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function Z$(t){var r=this.nativeEvent;return r.getModifierState?r.getModifierState(t):(t=W$[t])?!!r[t]:!1}function RA(){return Z$}var X$=hs({},Ix,{key:function(t){if(t.key){var r=H$[t.key]||t.key;if(r!=="Unidentified")return r}return t.type==="keypress"?(t=xb(t),t===13?"Enter":String.fromCharCode(t)):t.type==="keydown"||t.type==="keyup"?q$[t.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:RA,charCode:function(t){return t.type==="keypress"?xb(t):0},keyCode:function(t){return t.type==="keydown"||t.type==="keyup"?t.keyCode:0},which:function(t){return t.type==="keypress"?xb(t):t.type==="keydown"||t.type==="keyup"?t.keyCode:0}}),Y$=Na(X$),K$=hs({},jw,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),SD=Na(K$),Q$=hs({},Ix,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:RA}),J$=Na(Q$),eG=hs({},e_,{propertyName:0,elapsedTime:0,pseudoElement:0}),tG=Na(eG),nG=hs({},jw,{deltaX:function(t){return"deltaX"in t?t.deltaX:"wheelDeltaX"in t?-t.wheelDeltaX:0},deltaY:function(t){return"deltaY"in t?t.deltaY:"wheelDeltaY"in t?-t.wheelDeltaY:"wheelDelta"in t?-t.wheelDelta:0},deltaZ:0,deltaMode:0}),rG=Na(nG),iG=[9,13,27,32],kA=Su&&"CompositionEvent"in window,Tv=null;Su&&"documentMode"in document&&(Tv=document.documentMode);var sG=Su&&"TextEvent"in window&&!Tv,F3=Su&&(!kA||Tv&&8<Tv&&11>=Tv),TD=" ",ED=!1;function j3(t,r){switch(t){case"keyup":return iG.indexOf(r.keyCode)!==-1;case"keydown":return r.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function B3(t){return t=t.detail,typeof t=="object"&&"data"in t?t.data:null}var Km=!1;function oG(t,r){switch(t){case"compositionend":return B3(r);case"keypress":return r.which!==32?null:(ED=!0,TD);case"textInput":return t=r.data,t===TD&&ED?null:t;default:return null}}function aG(t,r){if(Km)return t==="compositionend"||!kA&&j3(t,r)?(t=O3(),vb=PA=qd=null,Km=!1,t):null;switch(t){case"paste":return null;case"keypress":if(!(r.ctrlKey||r.altKey||r.metaKey)||r.ctrlKey&&r.altKey){if(r.char&&1<r.char.length)return r.char;if(r.which)return String.fromCharCode(r.which)}return null;case"compositionend":return F3&&r.locale!=="ko"?null:r.data;default:return null}}var lG={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function CD(t){var r=t&&t.nodeName&&t.nodeName.toLowerCase();return r==="input"?!!lG[t.type]:r==="textarea"}function V3(t,r,l,d){y3(d),r=qb(r,"onChange"),0<r.length&&(l=new MA("onChange","change",null,l,d),t.push({event:l,listeners:r}))}var Ev=null,Vv=null;function cG(t){Q3(t,0)}function Bw(t){var r=eg(t);if(d3(r))return t}function uG(t,r){if(t==="change")return r}var U3=!1;if(Su){var UT;if(Su){var $T="oninput"in document;if(!$T){var AD=document.createElement("div");AD.setAttribute("oninput","return;"),$T=typeof AD.oninput=="function"}UT=$T}else UT=!1;U3=UT&&(!document.documentMode||9<document.documentMode)}function ID(){Ev&&(Ev.detachEvent("onpropertychange",$3),Vv=Ev=null)}function $3(t){if(t.propertyName==="value"&&Bw(Vv)){var r=[];V3(r,Vv,t,TA(t)),w3(cG,r)}}function dG(t,r,l){t==="focusin"?(ID(),Ev=r,Vv=l,Ev.attachEvent("onpropertychange",$3)):t==="focusout"&&ID()}function hG(t){if(t==="selectionchange"||t==="keyup"||t==="keydown")return Bw(Vv)}function fG(t,r){if(t==="click")return Bw(r)}function pG(t,r){if(t==="input"||t==="change")return Bw(r)}function mG(t,r){return t===r&&(t!==0||1/t===1/r)||t!==t&&r!==r}var Bl=typeof Object.is=="function"?Object.is:mG;function Uv(t,r){if(Bl(t,r))return!0;if(typeof t!="object"||t===null||typeof r!="object"||r===null)return!1;var l=Object.keys(t),d=Object.keys(r);if(l.length!==d.length)return!1;for(d=0;d<l.length;d++){var _=l[d];if(!EE.call(r,_)||!Bl(t[_],r[_]))return!1}return!0}function PD(t){for(;t&&t.firstChild;)t=t.firstChild;return t}function MD(t,r){var l=PD(t);t=0;for(var d;l;){if(l.nodeType===3){if(d=t+l.textContent.length,t<=r&&d>=r)return{node:l,offset:r-t};t=d}e:{for(;l;){if(l.nextSibling){l=l.nextSibling;break e}l=l.parentNode}l=void 0}l=PD(l)}}function G3(t,r){return t&&r?t===r?!0:t&&t.nodeType===3?!1:r&&r.nodeType===3?G3(t,r.parentNode):"contains"in t?t.contains(r):t.compareDocumentPosition?!!(t.compareDocumentPosition(r)&16):!1:!1}function H3(){for(var t=window,r=jb();r instanceof t.HTMLIFrameElement;){try{var l=typeof r.contentWindow.location.href=="string"}catch{l=!1}if(l)t=r.contentWindow;else break;r=jb(t.document)}return r}function DA(t){var r=t&&t.nodeName&&t.nodeName.toLowerCase();return r&&(r==="input"&&(t.type==="text"||t.type==="search"||t.type==="tel"||t.type==="url"||t.type==="password")||r==="textarea"||t.contentEditable==="true")}function gG(t){var r=H3(),l=t.focusedElem,d=t.selectionRange;if(r!==l&&l&&l.ownerDocument&&G3(l.ownerDocument.documentElement,l)){if(d!==null&&DA(l)){if(r=d.start,t=d.end,t===void 0&&(t=r),"selectionStart"in l)l.selectionStart=r,l.selectionEnd=Math.min(t,l.value.length);else if(t=(r=l.ownerDocument||document)&&r.defaultView||window,t.getSelection){t=t.getSelection();var _=l.textContent.length,x=Math.min(d.start,_);d=d.end===void 0?x:Math.min(d.end,_),!t.extend&&x>d&&(_=d,d=x,x=_),_=MD(l,x);var C=MD(l,d);_&&C&&(t.rangeCount!==1||t.anchorNode!==_.node||t.anchorOffset!==_.offset||t.focusNode!==C.node||t.focusOffset!==C.offset)&&(r=r.createRange(),r.setStart(_.node,_.offset),t.removeAllRanges(),x>d?(t.addRange(r),t.extend(C.node,C.offset)):(r.setEnd(C.node,C.offset),t.addRange(r)))}}for(r=[],t=l;t=t.parentNode;)t.nodeType===1&&r.push({element:t,left:t.scrollLeft,top:t.scrollTop});for(typeof l.focus=="function"&&l.focus(),l=0;l<r.length;l++)t=r[l],t.element.scrollLeft=t.left,t.element.scrollTop=t.top}}var _G=Su&&"documentMode"in document&&11>=document.documentMode,Qm=null,GE=null,Cv=null,HE=!1;function RD(t,r,l){var d=l.window===l?l.document:l.nodeType===9?l:l.ownerDocument;HE||Qm==null||Qm!==jb(d)||(d=Qm,"selectionStart"in d&&DA(d)?d={start:d.selectionStart,end:d.selectionEnd}:(d=(d.ownerDocument&&d.ownerDocument.defaultView||window).getSelection(),d={anchorNode:d.anchorNode,anchorOffset:d.anchorOffset,focusNode:d.focusNode,focusOffset:d.focusOffset}),Cv&&Uv(Cv,d)||(Cv=d,d=qb(GE,"onSelect"),0<d.length&&(r=new MA("onSelect","select",null,r,l),t.push({event:r,listeners:d}),r.target=Qm)))}function X1(t,r){var l={};return l[t.toLowerCase()]=r.toLowerCase(),l["Webkit"+t]="webkit"+r,l["Moz"+t]="moz"+r,l}var Jm={animationend:X1("Animation","AnimationEnd"),animationiteration:X1("Animation","AnimationIteration"),animationstart:X1("Animation","AnimationStart"),transitionend:X1("Transition","TransitionEnd")},GT={},q3={};Su&&(q3=document.createElement("div").style,"AnimationEvent"in window||(delete Jm.animationend.animation,delete Jm.animationiteration.animation,delete Jm.animationstart.animation),"TransitionEvent"in window||delete Jm.transitionend.transition);function Vw(t){if(GT[t])return GT[t];if(!Jm[t])return t;var r=Jm[t],l;for(l in r)if(r.hasOwnProperty(l)&&l in q3)return GT[t]=r[l];return t}var W3=Vw("animationend"),Z3=Vw("animationiteration"),X3=Vw("animationstart"),Y3=Vw("transitionend"),K3=new Map,kD="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function gh(t,r){K3.set(t,r),mp(r,[t])}for(var HT=0;HT<kD.length;HT++){var qT=kD[HT],yG=qT.toLowerCase(),vG=qT[0].toUpperCase()+qT.slice(1);gh(yG,"on"+vG)}gh(W3,"onAnimationEnd");gh(Z3,"onAnimationIteration");gh(X3,"onAnimationStart");gh("dblclick","onDoubleClick");gh("focusin","onFocus");gh("focusout","onBlur");gh(Y3,"onTransitionEnd");Ng("onMouseEnter",["mouseout","mouseover"]);Ng("onMouseLeave",["mouseout","mouseover"]);Ng("onPointerEnter",["pointerout","pointerover"]);Ng("onPointerLeave",["pointerout","pointerover"]);mp("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));mp("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));mp("onBeforeInput",["compositionend","keypress","textInput","paste"]);mp("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));mp("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));mp("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var gv="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),xG=new Set("cancel close invalid load scroll toggle".split(" ").concat(gv));function DD(t,r,l){var d=t.type||"unknown-event";t.currentTarget=l,y$(d,r,void 0,t),t.currentTarget=null}function Q3(t,r){r=(r&4)!==0;for(var l=0;l<t.length;l++){var d=t[l],_=d.event;d=d.listeners;e:{var x=void 0;if(r)for(var C=d.length-1;0<=C;C--){var s=d[C],k=s.instance,z=s.currentTarget;if(s=s.listener,k!==x&&_.isPropagationStopped())break e;DD(_,s,z),x=k}else for(C=0;C<d.length;C++){if(s=d[C],k=s.instance,z=s.currentTarget,s=s.listener,k!==x&&_.isPropagationStopped())break e;DD(_,s,z),x=k}}}if(Vb)throw t=BE,Vb=!1,BE=null,t}function ts(t,r){var l=r[YE];l===void 0&&(l=r[YE]=new Set);var d=t+"__bubble";l.has(d)||(J3(r,t,2,!1),l.add(d))}function WT(t,r,l){var d=0;r&&(d|=4),J3(l,t,d,r)}var Y1="_reactListening"+Math.random().toString(36).slice(2);function $v(t){if(!t[Y1]){t[Y1]=!0,o3.forEach(function(l){l!=="selectionchange"&&(xG.has(l)||WT(l,!1,t),WT(l,!0,t))});var r=t.nodeType===9?t:t.ownerDocument;r===null||r[Y1]||(r[Y1]=!0,WT("selectionchange",!1,r))}}function J3(t,r,l,d){switch(z3(r)){case 1:var _=L$;break;case 4:_=N$;break;default:_=IA}l=_.bind(null,r,l,t),_=void 0,!jE||r!=="touchstart"&&r!=="touchmove"&&r!=="wheel"||(_=!0),d?_!==void 0?t.addEventListener(r,l,{capture:!0,passive:_}):t.addEventListener(r,l,!0):_!==void 0?t.addEventListener(r,l,{passive:_}):t.addEventListener(r,l,!1)}function ZT(t,r,l,d,_){var x=d;if(!(r&1)&&!(r&2)&&d!==null)e:for(;;){if(d===null)return;var C=d.tag;if(C===3||C===4){var s=d.stateNode.containerInfo;if(s===_||s.nodeType===8&&s.parentNode===_)break;if(C===4)for(C=d.return;C!==null;){var k=C.tag;if((k===3||k===4)&&(k=C.stateNode.containerInfo,k===_||k.nodeType===8&&k.parentNode===_))return;C=C.return}for(;s!==null;){if(C=Nf(s),C===null)return;if(k=C.tag,k===5||k===6){d=x=C;continue e}s=s.parentNode}}d=d.return}w3(function(){var z=x,V=TA(l),U=[];e:{var $=K3.get(t);if($!==void 0){var se=MA,ae=t;switch(t){case"keypress":if(xb(l)===0)break e;case"keydown":case"keyup":se=Y$;break;case"focusin":ae="focus",se=VT;break;case"focusout":ae="blur",se=VT;break;case"beforeblur":case"afterblur":se=VT;break;case"click":if(l.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":se=bD;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":se=F$;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":se=J$;break;case W3:case Z3:case X3:se=V$;break;case Y3:se=tG;break;case"scroll":se=z$;break;case"wheel":se=rG;break;case"copy":case"cut":case"paste":se=$$;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":se=SD}var H=(r&4)!==0,ne=!H&&t==="scroll",Y=H?$!==null?$+"Capture":null:$;H=[];for(var te=z,de;te!==null;){de=te;var Me=de.stateNode;if(de.tag===5&&Me!==null&&(de=Me,Y!==null&&(Me=Ov(te,Y),Me!=null&&H.push(Gv(te,Me,de)))),ne)break;te=te.return}0<H.length&&($=new se($,ae,null,l,V),U.push({event:$,listeners:H}))}}if(!(r&7)){e:{if($=t==="mouseover"||t==="pointerover",se=t==="mouseout"||t==="pointerout",$&&l!==OE&&(ae=l.relatedTarget||l.fromElement)&&(Nf(ae)||ae[Tu]))break e;if((se||$)&&($=V.window===V?V:($=V.ownerDocument)?$.defaultView||$.parentWindow:window,se?(ae=l.relatedTarget||l.toElement,se=z,ae=ae?Nf(ae):null,ae!==null&&(ne=gp(ae),ae!==ne||ae.tag!==5&&ae.tag!==6)&&(ae=null)):(se=null,ae=z),se!==ae)){if(H=bD,Me="onMouseLeave",Y="onMouseEnter",te="mouse",(t==="pointerout"||t==="pointerover")&&(H=SD,Me="onPointerLeave",Y="onPointerEnter",te="pointer"),ne=se==null?$:eg(se),de=ae==null?$:eg(ae),$=new H(Me,te+"leave",se,l,V),$.target=ne,$.relatedTarget=de,Me=null,Nf(V)===z&&(H=new H(Y,te+"enter",ae,l,V),H.target=de,H.relatedTarget=ne,Me=H),ne=Me,se&&ae)t:{for(H=se,Y=ae,te=0,de=H;de;de=Vm(de))te++;for(de=0,Me=Y;Me;Me=Vm(Me))de++;for(;0<te-de;)H=Vm(H),te--;for(;0<de-te;)Y=Vm(Y),de--;for(;te--;){if(H===Y||Y!==null&&H===Y.alternate)break t;H=Vm(H),Y=Vm(Y)}H=null}else H=null;se!==null&&LD(U,$,se,H,!1),ae!==null&&ne!==null&&LD(U,ne,ae,H,!0)}}e:{if($=z?eg(z):window,se=$.nodeName&&$.nodeName.toLowerCase(),se==="select"||se==="input"&&$.type==="file")var Le=uG;else if(CD($))if(U3)Le=pG;else{Le=hG;var lt=dG}else(se=$.nodeName)&&se.toLowerCase()==="input"&&($.type==="checkbox"||$.type==="radio")&&(Le=fG);if(Le&&(Le=Le(t,z))){V3(U,Le,l,V);break e}lt&&lt(t,$,z),t==="focusout"&&(lt=$._wrapperState)&&lt.controlled&&$.type==="number"&&kE($,"number",$.value)}switch(lt=z?eg(z):window,t){case"focusin":(CD(lt)||lt.contentEditable==="true")&&(Qm=lt,GE=z,Cv=null);break;case"focusout":Cv=GE=Qm=null;break;case"mousedown":HE=!0;break;case"contextmenu":case"mouseup":case"dragend":HE=!1,RD(U,l,V);break;case"selectionchange":if(_G)break;case"keydown":case"keyup":RD(U,l,V)}var Pe;if(kA)e:{switch(t){case"compositionstart":var Ye="onCompositionStart";break e;case"compositionend":Ye="onCompositionEnd";break e;case"compositionupdate":Ye="onCompositionUpdate";break e}Ye=void 0}else Km?j3(t,l)&&(Ye="onCompositionEnd"):t==="keydown"&&l.keyCode===229&&(Ye="onCompositionStart");Ye&&(F3&&l.locale!=="ko"&&(Km||Ye!=="onCompositionStart"?Ye==="onCompositionEnd"&&Km&&(Pe=O3()):(qd=V,PA="value"in qd?qd.value:qd.textContent,Km=!0)),lt=qb(z,Ye),0<lt.length&&(Ye=new wD(Ye,t,null,l,V),U.push({event:Ye,listeners:lt}),Pe?Ye.data=Pe:(Pe=B3(l),Pe!==null&&(Ye.data=Pe)))),(Pe=sG?oG(t,l):aG(t,l))&&(z=qb(z,"onBeforeInput"),0<z.length&&(V=new wD("onBeforeInput","beforeinput",null,l,V),U.push({event:V,listeners:z}),V.data=Pe))}Q3(U,r)})}function Gv(t,r,l){return{instance:t,listener:r,currentTarget:l}}function qb(t,r){for(var l=r+"Capture",d=[];t!==null;){var _=t,x=_.stateNode;_.tag===5&&x!==null&&(_=x,x=Ov(t,l),x!=null&&d.unshift(Gv(t,x,_)),x=Ov(t,r),x!=null&&d.push(Gv(t,x,_))),t=t.return}return d}function Vm(t){if(t===null)return null;do t=t.return;while(t&&t.tag!==5);return t||null}function LD(t,r,l,d,_){for(var x=r._reactName,C=[];l!==null&&l!==d;){var s=l,k=s.alternate,z=s.stateNode;if(k!==null&&k===d)break;s.tag===5&&z!==null&&(s=z,_?(k=Ov(l,x),k!=null&&C.unshift(Gv(l,k,s))):_||(k=Ov(l,x),k!=null&&C.push(Gv(l,k,s)))),l=l.return}C.length!==0&&t.push({event:r,listeners:C})}var bG=/\r\n?/g,wG=/\u0000|\uFFFD/g;function ND(t){return(typeof t=="string"?t:""+t).replace(bG,`
`).replace(wG,"")}function K1(t,r,l){if(r=ND(r),ND(t)!==r&&l)throw Error(un(425))}function Wb(){}var qE=null,WE=null;function ZE(t,r){return t==="textarea"||t==="noscript"||typeof r.children=="string"||typeof r.children=="number"||typeof r.dangerouslySetInnerHTML=="object"&&r.dangerouslySetInnerHTML!==null&&r.dangerouslySetInnerHTML.__html!=null}var XE=typeof setTimeout=="function"?setTimeout:void 0,SG=typeof clearTimeout=="function"?clearTimeout:void 0,zD=typeof Promise=="function"?Promise:void 0,TG=typeof queueMicrotask=="function"?queueMicrotask:typeof zD<"u"?function(t){return zD.resolve(null).then(t).catch(EG)}:XE;function EG(t){setTimeout(function(){throw t})}function XT(t,r){var l=r,d=0;do{var _=l.nextSibling;if(t.removeChild(l),_&&_.nodeType===8)if(l=_.data,l==="/$"){if(d===0){t.removeChild(_),Bv(r);return}d--}else l!=="$"&&l!=="$?"&&l!=="$!"||d++;l=_}while(l);Bv(r)}function Qd(t){for(;t!=null;t=t.nextSibling){var r=t.nodeType;if(r===1||r===3)break;if(r===8){if(r=t.data,r==="$"||r==="$!"||r==="$?")break;if(r==="/$")return null}}return t}function OD(t){t=t.previousSibling;for(var r=0;t;){if(t.nodeType===8){var l=t.data;if(l==="$"||l==="$!"||l==="$?"){if(r===0)return t;r--}else l==="/$"&&r++}t=t.previousSibling}return null}var t_=Math.random().toString(36).slice(2),Tc="__reactFiber$"+t_,Hv="__reactProps$"+t_,Tu="__reactContainer$"+t_,YE="__reactEvents$"+t_,CG="__reactListeners$"+t_,AG="__reactHandles$"+t_;function Nf(t){var r=t[Tc];if(r)return r;for(var l=t.parentNode;l;){if(r=l[Tu]||l[Tc]){if(l=r.alternate,r.child!==null||l!==null&&l.child!==null)for(t=OD(t);t!==null;){if(l=t[Tc])return l;t=OD(t)}return r}t=l,l=t.parentNode}return null}function Px(t){return t=t[Tc]||t[Tu],!t||t.tag!==5&&t.tag!==6&&t.tag!==13&&t.tag!==3?null:t}function eg(t){if(t.tag===5||t.tag===6)return t.stateNode;throw Error(un(33))}function Uw(t){return t[Hv]||null}var KE=[],tg=-1;function _h(t){return{current:t}}function rs(t){0>tg||(t.current=KE[tg],KE[tg]=null,tg--)}function Xi(t,r){tg++,KE[tg]=t.current,t.current=r}var oh={},Po=_h(oh),da=_h(!1),Xf=oh;function zg(t,r){var l=t.type.contextTypes;if(!l)return oh;var d=t.stateNode;if(d&&d.__reactInternalMemoizedUnmaskedChildContext===r)return d.__reactInternalMemoizedMaskedChildContext;var _={},x;for(x in l)_[x]=r[x];return d&&(t=t.stateNode,t.__reactInternalMemoizedUnmaskedChildContext=r,t.__reactInternalMemoizedMaskedChildContext=_),_}function ha(t){return t=t.childContextTypes,t!=null}function Zb(){rs(da),rs(Po)}function FD(t,r,l){if(Po.current!==oh)throw Error(un(168));Xi(Po,r),Xi(da,l)}function ez(t,r,l){var d=t.stateNode;if(r=r.childContextTypes,typeof d.getChildContext!="function")return l;d=d.getChildContext();for(var _ in d)if(!(_ in r))throw Error(un(108,d$(t)||"Unknown",_));return hs({},l,d)}function Xb(t){return t=(t=t.stateNode)&&t.__reactInternalMemoizedMergedChildContext||oh,Xf=Po.current,Xi(Po,t),Xi(da,da.current),!0}function jD(t,r,l){var d=t.stateNode;if(!d)throw Error(un(169));l?(t=ez(t,r,Xf),d.__reactInternalMemoizedMergedChildContext=t,rs(da),rs(Po),Xi(Po,t)):rs(da),Xi(da,l)}var mu=null,$w=!1,YT=!1;function tz(t){mu===null?mu=[t]:mu.push(t)}function IG(t){$w=!0,tz(t)}function yh(){if(!YT&&mu!==null){YT=!0;var t=0,r=Vi;try{var l=mu;for(Vi=1;t<l.length;t++){var d=l[t];do d=d(!0);while(d!==null)}mu=null,$w=!1}catch(_){throw mu!==null&&(mu=mu.slice(t+1)),C3(EA,yh),_}finally{Vi=r,YT=!1}}return null}var ng=[],rg=0,Yb=null,Kb=0,Wa=[],Za=0,Yf=null,_u=1,yu="";function Df(t,r){ng[rg++]=Kb,ng[rg++]=Yb,Yb=t,Kb=r}function nz(t,r,l){Wa[Za++]=_u,Wa[Za++]=yu,Wa[Za++]=Yf,Yf=t;var d=_u;t=yu;var _=32-Nl(d)-1;d&=~(1<<_),l+=1;var x=32-Nl(r)+_;if(30<x){var C=_-_%5;x=(d&(1<<C)-1).toString(32),d>>=C,_-=C,_u=1<<32-Nl(r)+_|l<<_|d,yu=x+t}else _u=1<<x|l<<_|d,yu=t}function LA(t){t.return!==null&&(Df(t,1),nz(t,1,0))}function NA(t){for(;t===Yb;)Yb=ng[--rg],ng[rg]=null,Kb=ng[--rg],ng[rg]=null;for(;t===Yf;)Yf=Wa[--Za],Wa[Za]=null,yu=Wa[--Za],Wa[Za]=null,_u=Wa[--Za],Wa[Za]=null}var Pa=null,Aa=null,ss=!1,Il=null;function rz(t,r){var l=Xa(5,null,null,0);l.elementType="DELETED",l.stateNode=r,l.return=t,r=t.deletions,r===null?(t.deletions=[l],t.flags|=16):r.push(l)}function BD(t,r){switch(t.tag){case 5:var l=t.type;return r=r.nodeType!==1||l.toLowerCase()!==r.nodeName.toLowerCase()?null:r,r!==null?(t.stateNode=r,Pa=t,Aa=Qd(r.firstChild),!0):!1;case 6:return r=t.pendingProps===""||r.nodeType!==3?null:r,r!==null?(t.stateNode=r,Pa=t,Aa=null,!0):!1;case 13:return r=r.nodeType!==8?null:r,r!==null?(l=Yf!==null?{id:_u,overflow:yu}:null,t.memoizedState={dehydrated:r,treeContext:l,retryLane:1073741824},l=Xa(18,null,null,0),l.stateNode=r,l.return=t,t.child=l,Pa=t,Aa=null,!0):!1;default:return!1}}function QE(t){return(t.mode&1)!==0&&(t.flags&128)===0}function JE(t){if(ss){var r=Aa;if(r){var l=r;if(!BD(t,r)){if(QE(t))throw Error(un(418));r=Qd(l.nextSibling);var d=Pa;r&&BD(t,r)?rz(d,l):(t.flags=t.flags&-4097|2,ss=!1,Pa=t)}}else{if(QE(t))throw Error(un(418));t.flags=t.flags&-4097|2,ss=!1,Pa=t}}}function VD(t){for(t=t.return;t!==null&&t.tag!==5&&t.tag!==3&&t.tag!==13;)t=t.return;Pa=t}function Q1(t){if(t!==Pa)return!1;if(!ss)return VD(t),ss=!0,!1;var r;if((r=t.tag!==3)&&!(r=t.tag!==5)&&(r=t.type,r=r!=="head"&&r!=="body"&&!ZE(t.type,t.memoizedProps)),r&&(r=Aa)){if(QE(t))throw iz(),Error(un(418));for(;r;)rz(t,r),r=Qd(r.nextSibling)}if(VD(t),t.tag===13){if(t=t.memoizedState,t=t!==null?t.dehydrated:null,!t)throw Error(un(317));e:{for(t=t.nextSibling,r=0;t;){if(t.nodeType===8){var l=t.data;if(l==="/$"){if(r===0){Aa=Qd(t.nextSibling);break e}r--}else l!=="$"&&l!=="$!"&&l!=="$?"||r++}t=t.nextSibling}Aa=null}}else Aa=Pa?Qd(t.stateNode.nextSibling):null;return!0}function iz(){for(var t=Aa;t;)t=Qd(t.nextSibling)}function Og(){Aa=Pa=null,ss=!1}function zA(t){Il===null?Il=[t]:Il.push(t)}var PG=Ru.ReactCurrentBatchConfig;function iv(t,r,l){if(t=l.ref,t!==null&&typeof t!="function"&&typeof t!="object"){if(l._owner){if(l=l._owner,l){if(l.tag!==1)throw Error(un(309));var d=l.stateNode}if(!d)throw Error(un(147,t));var _=d,x=""+t;return r!==null&&r.ref!==null&&typeof r.ref=="function"&&r.ref._stringRef===x?r.ref:(r=function(C){var s=_.refs;C===null?delete s[x]:s[x]=C},r._stringRef=x,r)}if(typeof t!="string")throw Error(un(284));if(!l._owner)throw Error(un(290,t))}return t}function J1(t,r){throw t=Object.prototype.toString.call(r),Error(un(31,t==="[object Object]"?"object with keys {"+Object.keys(r).join(", ")+"}":t))}function UD(t){var r=t._init;return r(t._payload)}function sz(t){function r(Y,te){if(t){var de=Y.deletions;de===null?(Y.deletions=[te],Y.flags|=16):de.push(te)}}function l(Y,te){if(!t)return null;for(;te!==null;)r(Y,te),te=te.sibling;return null}function d(Y,te){for(Y=new Map;te!==null;)te.key!==null?Y.set(te.key,te):Y.set(te.index,te),te=te.sibling;return Y}function _(Y,te){return Y=nh(Y,te),Y.index=0,Y.sibling=null,Y}function x(Y,te,de){return Y.index=de,t?(de=Y.alternate,de!==null?(de=de.index,de<te?(Y.flags|=2,te):de):(Y.flags|=2,te)):(Y.flags|=1048576,te)}function C(Y){return t&&Y.alternate===null&&(Y.flags|=2),Y}function s(Y,te,de,Me){return te===null||te.tag!==6?(te=rE(de,Y.mode,Me),te.return=Y,te):(te=_(te,de),te.return=Y,te)}function k(Y,te,de,Me){var Le=de.type;return Le===Ym?V(Y,te,de.props.children,Me,de.key):te!==null&&(te.elementType===Le||typeof Le=="object"&&Le!==null&&Le.$$typeof===Rd&&UD(Le)===te.type)?(Me=_(te,de.props),Me.ref=iv(Y,te,de),Me.return=Y,Me):(Me=Ab(de.type,de.key,de.props,null,Y.mode,Me),Me.ref=iv(Y,te,de),Me.return=Y,Me)}function z(Y,te,de,Me){return te===null||te.tag!==4||te.stateNode.containerInfo!==de.containerInfo||te.stateNode.implementation!==de.implementation?(te=iE(de,Y.mode,Me),te.return=Y,te):(te=_(te,de.children||[]),te.return=Y,te)}function V(Y,te,de,Me,Le){return te===null||te.tag!==7?(te=Wf(de,Y.mode,Me,Le),te.return=Y,te):(te=_(te,de),te.return=Y,te)}function U(Y,te,de){if(typeof te=="string"&&te!==""||typeof te=="number")return te=rE(""+te,Y.mode,de),te.return=Y,te;if(typeof te=="object"&&te!==null){switch(te.$$typeof){case U1:return de=Ab(te.type,te.key,te.props,null,Y.mode,de),de.ref=iv(Y,null,te),de.return=Y,de;case Xm:return te=iE(te,Y.mode,de),te.return=Y,te;case Rd:var Me=te._init;return U(Y,Me(te._payload),de)}if(pv(te)||Jy(te))return te=Wf(te,Y.mode,de,null),te.return=Y,te;J1(Y,te)}return null}function $(Y,te,de,Me){var Le=te!==null?te.key:null;if(typeof de=="string"&&de!==""||typeof de=="number")return Le!==null?null:s(Y,te,""+de,Me);if(typeof de=="object"&&de!==null){switch(de.$$typeof){case U1:return de.key===Le?k(Y,te,de,Me):null;case Xm:return de.key===Le?z(Y,te,de,Me):null;case Rd:return Le=de._init,$(Y,te,Le(de._payload),Me)}if(pv(de)||Jy(de))return Le!==null?null:V(Y,te,de,Me,null);J1(Y,de)}return null}function se(Y,te,de,Me,Le){if(typeof Me=="string"&&Me!==""||typeof Me=="number")return Y=Y.get(de)||null,s(te,Y,""+Me,Le);if(typeof Me=="object"&&Me!==null){switch(Me.$$typeof){case U1:return Y=Y.get(Me.key===null?de:Me.key)||null,k(te,Y,Me,Le);case Xm:return Y=Y.get(Me.key===null?de:Me.key)||null,z(te,Y,Me,Le);case Rd:var lt=Me._init;return se(Y,te,de,lt(Me._payload),Le)}if(pv(Me)||Jy(Me))return Y=Y.get(de)||null,V(te,Y,Me,Le,null);J1(te,Me)}return null}function ae(Y,te,de,Me){for(var Le=null,lt=null,Pe=te,Ye=te=0,vt=null;Pe!==null&&Ye<de.length;Ye++){Pe.index>Ye?(vt=Pe,Pe=null):vt=Pe.sibling;var It=$(Y,Pe,de[Ye],Me);if(It===null){Pe===null&&(Pe=vt);break}t&&Pe&&It.alternate===null&&r(Y,Pe),te=x(It,te,Ye),lt===null?Le=It:lt.sibling=It,lt=It,Pe=vt}if(Ye===de.length)return l(Y,Pe),ss&&Df(Y,Ye),Le;if(Pe===null){for(;Ye<de.length;Ye++)Pe=U(Y,de[Ye],Me),Pe!==null&&(te=x(Pe,te,Ye),lt===null?Le=Pe:lt.sibling=Pe,lt=Pe);return ss&&Df(Y,Ye),Le}for(Pe=d(Y,Pe);Ye<de.length;Ye++)vt=se(Pe,Y,Ye,de[Ye],Me),vt!==null&&(t&&vt.alternate!==null&&Pe.delete(vt.key===null?Ye:vt.key),te=x(vt,te,Ye),lt===null?Le=vt:lt.sibling=vt,lt=vt);return t&&Pe.forEach(function(Ut){return r(Y,Ut)}),ss&&Df(Y,Ye),Le}function H(Y,te,de,Me){var Le=Jy(de);if(typeof Le!="function")throw Error(un(150));if(de=Le.call(de),de==null)throw Error(un(151));for(var lt=Le=null,Pe=te,Ye=te=0,vt=null,It=de.next();Pe!==null&&!It.done;Ye++,It=de.next()){Pe.index>Ye?(vt=Pe,Pe=null):vt=Pe.sibling;var Ut=$(Y,Pe,It.value,Me);if(Ut===null){Pe===null&&(Pe=vt);break}t&&Pe&&Ut.alternate===null&&r(Y,Pe),te=x(Ut,te,Ye),lt===null?Le=Ut:lt.sibling=Ut,lt=Ut,Pe=vt}if(It.done)return l(Y,Pe),ss&&Df(Y,Ye),Le;if(Pe===null){for(;!It.done;Ye++,It=de.next())It=U(Y,It.value,Me),It!==null&&(te=x(It,te,Ye),lt===null?Le=It:lt.sibling=It,lt=It);return ss&&Df(Y,Ye),Le}for(Pe=d(Y,Pe);!It.done;Ye++,It=de.next())It=se(Pe,Y,Ye,It.value,Me),It!==null&&(t&&It.alternate!==null&&Pe.delete(It.key===null?Ye:It.key),te=x(It,te,Ye),lt===null?Le=It:lt.sibling=It,lt=It);return t&&Pe.forEach(function(Pt){return r(Y,Pt)}),ss&&Df(Y,Ye),Le}function ne(Y,te,de,Me){if(typeof de=="object"&&de!==null&&de.type===Ym&&de.key===null&&(de=de.props.children),typeof de=="object"&&de!==null){switch(de.$$typeof){case U1:e:{for(var Le=de.key,lt=te;lt!==null;){if(lt.key===Le){if(Le=de.type,Le===Ym){if(lt.tag===7){l(Y,lt.sibling),te=_(lt,de.props.children),te.return=Y,Y=te;break e}}else if(lt.elementType===Le||typeof Le=="object"&&Le!==null&&Le.$$typeof===Rd&&UD(Le)===lt.type){l(Y,lt.sibling),te=_(lt,de.props),te.ref=iv(Y,lt,de),te.return=Y,Y=te;break e}l(Y,lt);break}else r(Y,lt);lt=lt.sibling}de.type===Ym?(te=Wf(de.props.children,Y.mode,Me,de.key),te.return=Y,Y=te):(Me=Ab(de.type,de.key,de.props,null,Y.mode,Me),Me.ref=iv(Y,te,de),Me.return=Y,Y=Me)}return C(Y);case Xm:e:{for(lt=de.key;te!==null;){if(te.key===lt)if(te.tag===4&&te.stateNode.containerInfo===de.containerInfo&&te.stateNode.implementation===de.implementation){l(Y,te.sibling),te=_(te,de.children||[]),te.return=Y,Y=te;break e}else{l(Y,te);break}else r(Y,te);te=te.sibling}te=iE(de,Y.mode,Me),te.return=Y,Y=te}return C(Y);case Rd:return lt=de._init,ne(Y,te,lt(de._payload),Me)}if(pv(de))return ae(Y,te,de,Me);if(Jy(de))return H(Y,te,de,Me);J1(Y,de)}return typeof de=="string"&&de!==""||typeof de=="number"?(de=""+de,te!==null&&te.tag===6?(l(Y,te.sibling),te=_(te,de),te.return=Y,Y=te):(l(Y,te),te=rE(de,Y.mode,Me),te.return=Y,Y=te),C(Y)):l(Y,te)}return ne}var Fg=sz(!0),oz=sz(!1),Qb=_h(null),Jb=null,ig=null,OA=null;function FA(){OA=ig=Jb=null}function jA(t){var r=Qb.current;rs(Qb),t._currentValue=r}function eC(t,r,l){for(;t!==null;){var d=t.alternate;if((t.childLanes&r)!==r?(t.childLanes|=r,d!==null&&(d.childLanes|=r)):d!==null&&(d.childLanes&r)!==r&&(d.childLanes|=r),t===l)break;t=t.return}}function fg(t,r){Jb=t,OA=ig=null,t=t.dependencies,t!==null&&t.firstContext!==null&&(t.lanes&r&&(ua=!0),t.firstContext=null)}function Qa(t){var r=t._currentValue;if(OA!==t)if(t={context:t,memoizedValue:r,next:null},ig===null){if(Jb===null)throw Error(un(308));ig=t,Jb.dependencies={lanes:0,firstContext:t}}else ig=ig.next=t;return r}var zf=null;function BA(t){zf===null?zf=[t]:zf.push(t)}function az(t,r,l,d){var _=r.interleaved;return _===null?(l.next=l,BA(r)):(l.next=_.next,_.next=l),r.interleaved=l,Eu(t,d)}function Eu(t,r){t.lanes|=r;var l=t.alternate;for(l!==null&&(l.lanes|=r),l=t,t=t.return;t!==null;)t.childLanes|=r,l=t.alternate,l!==null&&(l.childLanes|=r),l=t,t=t.return;return l.tag===3?l.stateNode:null}var kd=!1;function VA(t){t.updateQueue={baseState:t.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function lz(t,r){t=t.updateQueue,r.updateQueue===t&&(r.updateQueue={baseState:t.baseState,firstBaseUpdate:t.firstBaseUpdate,lastBaseUpdate:t.lastBaseUpdate,shared:t.shared,effects:t.effects})}function bu(t,r){return{eventTime:t,lane:r,tag:0,payload:null,callback:null,next:null}}function Jd(t,r,l){var d=t.updateQueue;if(d===null)return null;if(d=d.shared,Mi&2){var _=d.pending;return _===null?r.next=r:(r.next=_.next,_.next=r),d.pending=r,Eu(t,l)}return _=d.interleaved,_===null?(r.next=r,BA(d)):(r.next=_.next,_.next=r),d.interleaved=r,Eu(t,l)}function bb(t,r,l){if(r=r.updateQueue,r!==null&&(r=r.shared,(l&4194240)!==0)){var d=r.lanes;d&=t.pendingLanes,l|=d,r.lanes=l,CA(t,l)}}function $D(t,r){var l=t.updateQueue,d=t.alternate;if(d!==null&&(d=d.updateQueue,l===d)){var _=null,x=null;if(l=l.firstBaseUpdate,l!==null){do{var C={eventTime:l.eventTime,lane:l.lane,tag:l.tag,payload:l.payload,callback:l.callback,next:null};x===null?_=x=C:x=x.next=C,l=l.next}while(l!==null);x===null?_=x=r:x=x.next=r}else _=x=r;l={baseState:d.baseState,firstBaseUpdate:_,lastBaseUpdate:x,shared:d.shared,effects:d.effects},t.updateQueue=l;return}t=l.lastBaseUpdate,t===null?l.firstBaseUpdate=r:t.next=r,l.lastBaseUpdate=r}function ew(t,r,l,d){var _=t.updateQueue;kd=!1;var x=_.firstBaseUpdate,C=_.lastBaseUpdate,s=_.shared.pending;if(s!==null){_.shared.pending=null;var k=s,z=k.next;k.next=null,C===null?x=z:C.next=z,C=k;var V=t.alternate;V!==null&&(V=V.updateQueue,s=V.lastBaseUpdate,s!==C&&(s===null?V.firstBaseUpdate=z:s.next=z,V.lastBaseUpdate=k))}if(x!==null){var U=_.baseState;C=0,V=z=k=null,s=x;do{var $=s.lane,se=s.eventTime;if((d&$)===$){V!==null&&(V=V.next={eventTime:se,lane:0,tag:s.tag,payload:s.payload,callback:s.callback,next:null});e:{var ae=t,H=s;switch($=r,se=l,H.tag){case 1:if(ae=H.payload,typeof ae=="function"){U=ae.call(se,U,$);break e}U=ae;break e;case 3:ae.flags=ae.flags&-65537|128;case 0:if(ae=H.payload,$=typeof ae=="function"?ae.call(se,U,$):ae,$==null)break e;U=hs({},U,$);break e;case 2:kd=!0}}s.callback!==null&&s.lane!==0&&(t.flags|=64,$=_.effects,$===null?_.effects=[s]:$.push(s))}else se={eventTime:se,lane:$,tag:s.tag,payload:s.payload,callback:s.callback,next:null},V===null?(z=V=se,k=U):V=V.next=se,C|=$;if(s=s.next,s===null){if(s=_.shared.pending,s===null)break;$=s,s=$.next,$.next=null,_.lastBaseUpdate=$,_.shared.pending=null}}while(!0);if(V===null&&(k=U),_.baseState=k,_.firstBaseUpdate=z,_.lastBaseUpdate=V,r=_.shared.interleaved,r!==null){_=r;do C|=_.lane,_=_.next;while(_!==r)}else x===null&&(_.shared.lanes=0);Qf|=C,t.lanes=C,t.memoizedState=U}}function GD(t,r,l){if(t=r.effects,r.effects=null,t!==null)for(r=0;r<t.length;r++){var d=t[r],_=d.callback;if(_!==null){if(d.callback=null,d=l,typeof _!="function")throw Error(un(191,_));_.call(d)}}}var Mx={},Ic=_h(Mx),qv=_h(Mx),Wv=_h(Mx);function Of(t){if(t===Mx)throw Error(un(174));return t}function UA(t,r){switch(Xi(Wv,r),Xi(qv,t),Xi(Ic,Mx),t=r.nodeType,t){case 9:case 11:r=(r=r.documentElement)?r.namespaceURI:LE(null,"");break;default:t=t===8?r.parentNode:r,r=t.namespaceURI||null,t=t.tagName,r=LE(r,t)}rs(Ic),Xi(Ic,r)}function jg(){rs(Ic),rs(qv),rs(Wv)}function cz(t){Of(Wv.current);var r=Of(Ic.current),l=LE(r,t.type);r!==l&&(Xi(qv,t),Xi(Ic,l))}function $A(t){qv.current===t&&(rs(Ic),rs(qv))}var cs=_h(0);function tw(t){for(var r=t;r!==null;){if(r.tag===13){var l=r.memoizedState;if(l!==null&&(l=l.dehydrated,l===null||l.data==="$?"||l.data==="$!"))return r}else if(r.tag===19&&r.memoizedProps.revealOrder!==void 0){if(r.flags&128)return r}else if(r.child!==null){r.child.return=r,r=r.child;continue}if(r===t)break;for(;r.sibling===null;){if(r.return===null||r.return===t)return null;r=r.return}r.sibling.return=r.return,r=r.sibling}return null}var KT=[];function GA(){for(var t=0;t<KT.length;t++)KT[t]._workInProgressVersionPrimary=null;KT.length=0}var wb=Ru.ReactCurrentDispatcher,QT=Ru.ReactCurrentBatchConfig,Kf=0,ds=null,$s=null,to=null,nw=!1,Av=!1,Zv=0,MG=0;function Eo(){throw Error(un(321))}function HA(t,r){if(r===null)return!1;for(var l=0;l<r.length&&l<t.length;l++)if(!Bl(t[l],r[l]))return!1;return!0}function qA(t,r,l,d,_,x){if(Kf=x,ds=r,r.memoizedState=null,r.updateQueue=null,r.lanes=0,wb.current=t===null||t.memoizedState===null?LG:NG,t=l(d,_),Av){x=0;do{if(Av=!1,Zv=0,25<=x)throw Error(un(301));x+=1,to=$s=null,r.updateQueue=null,wb.current=zG,t=l(d,_)}while(Av)}if(wb.current=rw,r=$s!==null&&$s.next!==null,Kf=0,to=$s=ds=null,nw=!1,r)throw Error(un(300));return t}function WA(){var t=Zv!==0;return Zv=0,t}function vc(){var t={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return to===null?ds.memoizedState=to=t:to=to.next=t,to}function Ja(){if($s===null){var t=ds.alternate;t=t!==null?t.memoizedState:null}else t=$s.next;var r=to===null?ds.memoizedState:to.next;if(r!==null)to=r,$s=t;else{if(t===null)throw Error(un(310));$s=t,t={memoizedState:$s.memoizedState,baseState:$s.baseState,baseQueue:$s.baseQueue,queue:$s.queue,next:null},to===null?ds.memoizedState=to=t:to=to.next=t}return to}function Xv(t,r){return typeof r=="function"?r(t):r}function JT(t){var r=Ja(),l=r.queue;if(l===null)throw Error(un(311));l.lastRenderedReducer=t;var d=$s,_=d.baseQueue,x=l.pending;if(x!==null){if(_!==null){var C=_.next;_.next=x.next,x.next=C}d.baseQueue=_=x,l.pending=null}if(_!==null){x=_.next,d=d.baseState;var s=C=null,k=null,z=x;do{var V=z.lane;if((Kf&V)===V)k!==null&&(k=k.next={lane:0,action:z.action,hasEagerState:z.hasEagerState,eagerState:z.eagerState,next:null}),d=z.hasEagerState?z.eagerState:t(d,z.action);else{var U={lane:V,action:z.action,hasEagerState:z.hasEagerState,eagerState:z.eagerState,next:null};k===null?(s=k=U,C=d):k=k.next=U,ds.lanes|=V,Qf|=V}z=z.next}while(z!==null&&z!==x);k===null?C=d:k.next=s,Bl(d,r.memoizedState)||(ua=!0),r.memoizedState=d,r.baseState=C,r.baseQueue=k,l.lastRenderedState=d}if(t=l.interleaved,t!==null){_=t;do x=_.lane,ds.lanes|=x,Qf|=x,_=_.next;while(_!==t)}else _===null&&(l.lanes=0);return[r.memoizedState,l.dispatch]}function eE(t){var r=Ja(),l=r.queue;if(l===null)throw Error(un(311));l.lastRenderedReducer=t;var d=l.dispatch,_=l.pending,x=r.memoizedState;if(_!==null){l.pending=null;var C=_=_.next;do x=t(x,C.action),C=C.next;while(C!==_);Bl(x,r.memoizedState)||(ua=!0),r.memoizedState=x,r.baseQueue===null&&(r.baseState=x),l.lastRenderedState=x}return[x,d]}function uz(){}function dz(t,r){var l=ds,d=Ja(),_=r(),x=!Bl(d.memoizedState,_);if(x&&(d.memoizedState=_,ua=!0),d=d.queue,ZA(pz.bind(null,l,d,t),[t]),d.getSnapshot!==r||x||to!==null&&to.memoizedState.tag&1){if(l.flags|=2048,Yv(9,fz.bind(null,l,d,_,r),void 0,null),no===null)throw Error(un(349));Kf&30||hz(l,r,_)}return _}function hz(t,r,l){t.flags|=16384,t={getSnapshot:r,value:l},r=ds.updateQueue,r===null?(r={lastEffect:null,stores:null},ds.updateQueue=r,r.stores=[t]):(l=r.stores,l===null?r.stores=[t]:l.push(t))}function fz(t,r,l,d){r.value=l,r.getSnapshot=d,mz(r)&&gz(t)}function pz(t,r,l){return l(function(){mz(r)&&gz(t)})}function mz(t){var r=t.getSnapshot;t=t.value;try{var l=r();return!Bl(t,l)}catch{return!0}}function gz(t){var r=Eu(t,1);r!==null&&zl(r,t,1,-1)}function HD(t){var r=vc();return typeof t=="function"&&(t=t()),r.memoizedState=r.baseState=t,t={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:Xv,lastRenderedState:t},r.queue=t,t=t.dispatch=DG.bind(null,ds,t),[r.memoizedState,t]}function Yv(t,r,l,d){return t={tag:t,create:r,destroy:l,deps:d,next:null},r=ds.updateQueue,r===null?(r={lastEffect:null,stores:null},ds.updateQueue=r,r.lastEffect=t.next=t):(l=r.lastEffect,l===null?r.lastEffect=t.next=t:(d=l.next,l.next=t,t.next=d,r.lastEffect=t)),t}function _z(){return Ja().memoizedState}function Sb(t,r,l,d){var _=vc();ds.flags|=t,_.memoizedState=Yv(1|r,l,void 0,d===void 0?null:d)}function Gw(t,r,l,d){var _=Ja();d=d===void 0?null:d;var x=void 0;if($s!==null){var C=$s.memoizedState;if(x=C.destroy,d!==null&&HA(d,C.deps)){_.memoizedState=Yv(r,l,x,d);return}}ds.flags|=t,_.memoizedState=Yv(1|r,l,x,d)}function qD(t,r){return Sb(8390656,8,t,r)}function ZA(t,r){return Gw(2048,8,t,r)}function yz(t,r){return Gw(4,2,t,r)}function vz(t,r){return Gw(4,4,t,r)}function xz(t,r){if(typeof r=="function")return t=t(),r(t),function(){r(null)};if(r!=null)return t=t(),r.current=t,function(){r.current=null}}function bz(t,r,l){return l=l!=null?l.concat([t]):null,Gw(4,4,xz.bind(null,r,t),l)}function XA(){}function wz(t,r){var l=Ja();r=r===void 0?null:r;var d=l.memoizedState;return d!==null&&r!==null&&HA(r,d[1])?d[0]:(l.memoizedState=[t,r],t)}function Sz(t,r){var l=Ja();r=r===void 0?null:r;var d=l.memoizedState;return d!==null&&r!==null&&HA(r,d[1])?d[0]:(t=t(),l.memoizedState=[t,r],t)}function Tz(t,r,l){return Kf&21?(Bl(l,r)||(l=P3(),ds.lanes|=l,Qf|=l,t.baseState=!0),r):(t.baseState&&(t.baseState=!1,ua=!0),t.memoizedState=l)}function RG(t,r){var l=Vi;Vi=l!==0&&4>l?l:4,t(!0);var d=QT.transition;QT.transition={};try{t(!1),r()}finally{Vi=l,QT.transition=d}}function Ez(){return Ja().memoizedState}function kG(t,r,l){var d=th(t);if(l={lane:d,action:l,hasEagerState:!1,eagerState:null,next:null},Cz(t))Az(r,l);else if(l=az(t,r,l,d),l!==null){var _=Ho();zl(l,t,d,_),Iz(l,r,d)}}function DG(t,r,l){var d=th(t),_={lane:d,action:l,hasEagerState:!1,eagerState:null,next:null};if(Cz(t))Az(r,_);else{var x=t.alternate;if(t.lanes===0&&(x===null||x.lanes===0)&&(x=r.lastRenderedReducer,x!==null))try{var C=r.lastRenderedState,s=x(C,l);if(_.hasEagerState=!0,_.eagerState=s,Bl(s,C)){var k=r.interleaved;k===null?(_.next=_,BA(r)):(_.next=k.next,k.next=_),r.interleaved=_;return}}catch{}finally{}l=az(t,r,_,d),l!==null&&(_=Ho(),zl(l,t,d,_),Iz(l,r,d))}}function Cz(t){var r=t.alternate;return t===ds||r!==null&&r===ds}function Az(t,r){Av=nw=!0;var l=t.pending;l===null?r.next=r:(r.next=l.next,l.next=r),t.pending=r}function Iz(t,r,l){if(l&4194240){var d=r.lanes;d&=t.pendingLanes,l|=d,r.lanes=l,CA(t,l)}}var rw={readContext:Qa,useCallback:Eo,useContext:Eo,useEffect:Eo,useImperativeHandle:Eo,useInsertionEffect:Eo,useLayoutEffect:Eo,useMemo:Eo,useReducer:Eo,useRef:Eo,useState:Eo,useDebugValue:Eo,useDeferredValue:Eo,useTransition:Eo,useMutableSource:Eo,useSyncExternalStore:Eo,useId:Eo,unstable_isNewReconciler:!1},LG={readContext:Qa,useCallback:function(t,r){return vc().memoizedState=[t,r===void 0?null:r],t},useContext:Qa,useEffect:qD,useImperativeHandle:function(t,r,l){return l=l!=null?l.concat([t]):null,Sb(4194308,4,xz.bind(null,r,t),l)},useLayoutEffect:function(t,r){return Sb(4194308,4,t,r)},useInsertionEffect:function(t,r){return Sb(4,2,t,r)},useMemo:function(t,r){var l=vc();return r=r===void 0?null:r,t=t(),l.memoizedState=[t,r],t},useReducer:function(t,r,l){var d=vc();return r=l!==void 0?l(r):r,d.memoizedState=d.baseState=r,t={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:t,lastRenderedState:r},d.queue=t,t=t.dispatch=kG.bind(null,ds,t),[d.memoizedState,t]},useRef:function(t){var r=vc();return t={current:t},r.memoizedState=t},useState:HD,useDebugValue:XA,useDeferredValue:function(t){return vc().memoizedState=t},useTransition:function(){var t=HD(!1),r=t[0];return t=RG.bind(null,t[1]),vc().memoizedState=t,[r,t]},useMutableSource:function(){},useSyncExternalStore:function(t,r,l){var d=ds,_=vc();if(ss){if(l===void 0)throw Error(un(407));l=l()}else{if(l=r(),no===null)throw Error(un(349));Kf&30||hz(d,r,l)}_.memoizedState=l;var x={value:l,getSnapshot:r};return _.queue=x,qD(pz.bind(null,d,x,t),[t]),d.flags|=2048,Yv(9,fz.bind(null,d,x,l,r),void 0,null),l},useId:function(){var t=vc(),r=no.identifierPrefix;if(ss){var l=yu,d=_u;l=(d&~(1<<32-Nl(d)-1)).toString(32)+l,r=":"+r+"R"+l,l=Zv++,0<l&&(r+="H"+l.toString(32)),r+=":"}else l=MG++,r=":"+r+"r"+l.toString(32)+":";return t.memoizedState=r},unstable_isNewReconciler:!1},NG={readContext:Qa,useCallback:wz,useContext:Qa,useEffect:ZA,useImperativeHandle:bz,useInsertionEffect:yz,useLayoutEffect:vz,useMemo:Sz,useReducer:JT,useRef:_z,useState:function(){return JT(Xv)},useDebugValue:XA,useDeferredValue:function(t){var r=Ja();return Tz(r,$s.memoizedState,t)},useTransition:function(){var t=JT(Xv)[0],r=Ja().memoizedState;return[t,r]},useMutableSource:uz,useSyncExternalStore:dz,useId:Ez,unstable_isNewReconciler:!1},zG={readContext:Qa,useCallback:wz,useContext:Qa,useEffect:ZA,useImperativeHandle:bz,useInsertionEffect:yz,useLayoutEffect:vz,useMemo:Sz,useReducer:eE,useRef:_z,useState:function(){return eE(Xv)},useDebugValue:XA,useDeferredValue:function(t){var r=Ja();return $s===null?r.memoizedState=t:Tz(r,$s.memoizedState,t)},useTransition:function(){var t=eE(Xv)[0],r=Ja().memoizedState;return[t,r]},useMutableSource:uz,useSyncExternalStore:dz,useId:Ez,unstable_isNewReconciler:!1};function El(t,r){if(t&&t.defaultProps){r=hs({},r),t=t.defaultProps;for(var l in t)r[l]===void 0&&(r[l]=t[l]);return r}return r}function tC(t,r,l,d){r=t.memoizedState,l=l(d,r),l=l==null?r:hs({},r,l),t.memoizedState=l,t.lanes===0&&(t.updateQueue.baseState=l)}var Hw={isMounted:function(t){return(t=t._reactInternals)?gp(t)===t:!1},enqueueSetState:function(t,r,l){t=t._reactInternals;var d=Ho(),_=th(t),x=bu(d,_);x.payload=r,l!=null&&(x.callback=l),r=Jd(t,x,_),r!==null&&(zl(r,t,_,d),bb(r,t,_))},enqueueReplaceState:function(t,r,l){t=t._reactInternals;var d=Ho(),_=th(t),x=bu(d,_);x.tag=1,x.payload=r,l!=null&&(x.callback=l),r=Jd(t,x,_),r!==null&&(zl(r,t,_,d),bb(r,t,_))},enqueueForceUpdate:function(t,r){t=t._reactInternals;var l=Ho(),d=th(t),_=bu(l,d);_.tag=2,r!=null&&(_.callback=r),r=Jd(t,_,d),r!==null&&(zl(r,t,d,l),bb(r,t,d))}};function WD(t,r,l,d,_,x,C){return t=t.stateNode,typeof t.shouldComponentUpdate=="function"?t.shouldComponentUpdate(d,x,C):r.prototype&&r.prototype.isPureReactComponent?!Uv(l,d)||!Uv(_,x):!0}function Pz(t,r,l){var d=!1,_=oh,x=r.contextType;return typeof x=="object"&&x!==null?x=Qa(x):(_=ha(r)?Xf:Po.current,d=r.contextTypes,x=(d=d!=null)?zg(t,_):oh),r=new r(l,x),t.memoizedState=r.state!==null&&r.state!==void 0?r.state:null,r.updater=Hw,t.stateNode=r,r._reactInternals=t,d&&(t=t.stateNode,t.__reactInternalMemoizedUnmaskedChildContext=_,t.__reactInternalMemoizedMaskedChildContext=x),r}function ZD(t,r,l,d){t=r.state,typeof r.componentWillReceiveProps=="function"&&r.componentWillReceiveProps(l,d),typeof r.UNSAFE_componentWillReceiveProps=="function"&&r.UNSAFE_componentWillReceiveProps(l,d),r.state!==t&&Hw.enqueueReplaceState(r,r.state,null)}function nC(t,r,l,d){var _=t.stateNode;_.props=l,_.state=t.memoizedState,_.refs={},VA(t);var x=r.contextType;typeof x=="object"&&x!==null?_.context=Qa(x):(x=ha(r)?Xf:Po.current,_.context=zg(t,x)),_.state=t.memoizedState,x=r.getDerivedStateFromProps,typeof x=="function"&&(tC(t,r,x,l),_.state=t.memoizedState),typeof r.getDerivedStateFromProps=="function"||typeof _.getSnapshotBeforeUpdate=="function"||typeof _.UNSAFE_componentWillMount!="function"&&typeof _.componentWillMount!="function"||(r=_.state,typeof _.componentWillMount=="function"&&_.componentWillMount(),typeof _.UNSAFE_componentWillMount=="function"&&_.UNSAFE_componentWillMount(),r!==_.state&&Hw.enqueueReplaceState(_,_.state,null),ew(t,l,_,d),_.state=t.memoizedState),typeof _.componentDidMount=="function"&&(t.flags|=4194308)}function Bg(t,r){try{var l="",d=r;do l+=u$(d),d=d.return;while(d);var _=l}catch(x){_=`
Error generating stack: `+x.message+`
`+x.stack}return{value:t,source:r,stack:_,digest:null}}function tE(t,r,l){return{value:t,source:null,stack:l??null,digest:r??null}}function rC(t,r){try{console.error(r.value)}catch(l){setTimeout(function(){throw l})}}var OG=typeof WeakMap=="function"?WeakMap:Map;function Mz(t,r,l){l=bu(-1,l),l.tag=3,l.payload={element:null};var d=r.value;return l.callback=function(){sw||(sw=!0,fC=d),rC(t,r)},l}function Rz(t,r,l){l=bu(-1,l),l.tag=3;var d=t.type.getDerivedStateFromError;if(typeof d=="function"){var _=r.value;l.payload=function(){return d(_)},l.callback=function(){rC(t,r)}}var x=t.stateNode;return x!==null&&typeof x.componentDidCatch=="function"&&(l.callback=function(){rC(t,r),typeof d!="function"&&(eh===null?eh=new Set([this]):eh.add(this));var C=r.stack;this.componentDidCatch(r.value,{componentStack:C!==null?C:""})}),l}function XD(t,r,l){var d=t.pingCache;if(d===null){d=t.pingCache=new OG;var _=new Set;d.set(r,_)}else _=d.get(r),_===void 0&&(_=new Set,d.set(r,_));_.has(l)||(_.add(l),t=KG.bind(null,t,r,l),r.then(t,t))}function YD(t){do{var r;if((r=t.tag===13)&&(r=t.memoizedState,r=r!==null?r.dehydrated!==null:!0),r)return t;t=t.return}while(t!==null);return null}function KD(t,r,l,d,_){return t.mode&1?(t.flags|=65536,t.lanes=_,t):(t===r?t.flags|=65536:(t.flags|=128,l.flags|=131072,l.flags&=-52805,l.tag===1&&(l.alternate===null?l.tag=17:(r=bu(-1,1),r.tag=2,Jd(l,r,1))),l.lanes|=1),t)}var FG=Ru.ReactCurrentOwner,ua=!1;function $o(t,r,l,d){r.child=t===null?oz(r,null,l,d):Fg(r,t.child,l,d)}function QD(t,r,l,d,_){l=l.render;var x=r.ref;return fg(r,_),d=qA(t,r,l,d,x,_),l=WA(),t!==null&&!ua?(r.updateQueue=t.updateQueue,r.flags&=-2053,t.lanes&=~_,Cu(t,r,_)):(ss&&l&&LA(r),r.flags|=1,$o(t,r,d,_),r.child)}function JD(t,r,l,d,_){if(t===null){var x=l.type;return typeof x=="function"&&!rI(x)&&x.defaultProps===void 0&&l.compare===null&&l.defaultProps===void 0?(r.tag=15,r.type=x,kz(t,r,x,d,_)):(t=Ab(l.type,null,d,r,r.mode,_),t.ref=r.ref,t.return=r,r.child=t)}if(x=t.child,!(t.lanes&_)){var C=x.memoizedProps;if(l=l.compare,l=l!==null?l:Uv,l(C,d)&&t.ref===r.ref)return Cu(t,r,_)}return r.flags|=1,t=nh(x,d),t.ref=r.ref,t.return=r,r.child=t}function kz(t,r,l,d,_){if(t!==null){var x=t.memoizedProps;if(Uv(x,d)&&t.ref===r.ref)if(ua=!1,r.pendingProps=d=x,(t.lanes&_)!==0)t.flags&131072&&(ua=!0);else return r.lanes=t.lanes,Cu(t,r,_)}return iC(t,r,l,d,_)}function Dz(t,r,l){var d=r.pendingProps,_=d.children,x=t!==null?t.memoizedState:null;if(d.mode==="hidden")if(!(r.mode&1))r.memoizedState={baseLanes:0,cachePool:null,transitions:null},Xi(og,Ea),Ea|=l;else{if(!(l&1073741824))return t=x!==null?x.baseLanes|l:l,r.lanes=r.childLanes=1073741824,r.memoizedState={baseLanes:t,cachePool:null,transitions:null},r.updateQueue=null,Xi(og,Ea),Ea|=t,null;r.memoizedState={baseLanes:0,cachePool:null,transitions:null},d=x!==null?x.baseLanes:l,Xi(og,Ea),Ea|=d}else x!==null?(d=x.baseLanes|l,r.memoizedState=null):d=l,Xi(og,Ea),Ea|=d;return $o(t,r,_,l),r.child}function Lz(t,r){var l=r.ref;(t===null&&l!==null||t!==null&&t.ref!==l)&&(r.flags|=512,r.flags|=2097152)}function iC(t,r,l,d,_){var x=ha(l)?Xf:Po.current;return x=zg(r,x),fg(r,_),l=qA(t,r,l,d,x,_),d=WA(),t!==null&&!ua?(r.updateQueue=t.updateQueue,r.flags&=-2053,t.lanes&=~_,Cu(t,r,_)):(ss&&d&&LA(r),r.flags|=1,$o(t,r,l,_),r.child)}function eL(t,r,l,d,_){if(ha(l)){var x=!0;Xb(r)}else x=!1;if(fg(r,_),r.stateNode===null)Tb(t,r),Pz(r,l,d),nC(r,l,d,_),d=!0;else if(t===null){var C=r.stateNode,s=r.memoizedProps;C.props=s;var k=C.context,z=l.contextType;typeof z=="object"&&z!==null?z=Qa(z):(z=ha(l)?Xf:Po.current,z=zg(r,z));var V=l.getDerivedStateFromProps,U=typeof V=="function"||typeof C.getSnapshotBeforeUpdate=="function";U||typeof C.UNSAFE_componentWillReceiveProps!="function"&&typeof C.componentWillReceiveProps!="function"||(s!==d||k!==z)&&ZD(r,C,d,z),kd=!1;var $=r.memoizedState;C.state=$,ew(r,d,C,_),k=r.memoizedState,s!==d||$!==k||da.current||kd?(typeof V=="function"&&(tC(r,l,V,d),k=r.memoizedState),(s=kd||WD(r,l,s,d,$,k,z))?(U||typeof C.UNSAFE_componentWillMount!="function"&&typeof C.componentWillMount!="function"||(typeof C.componentWillMount=="function"&&C.componentWillMount(),typeof C.UNSAFE_componentWillMount=="function"&&C.UNSAFE_componentWillMount()),typeof C.componentDidMount=="function"&&(r.flags|=4194308)):(typeof C.componentDidMount=="function"&&(r.flags|=4194308),r.memoizedProps=d,r.memoizedState=k),C.props=d,C.state=k,C.context=z,d=s):(typeof C.componentDidMount=="function"&&(r.flags|=4194308),d=!1)}else{C=r.stateNode,lz(t,r),s=r.memoizedProps,z=r.type===r.elementType?s:El(r.type,s),C.props=z,U=r.pendingProps,$=C.context,k=l.contextType,typeof k=="object"&&k!==null?k=Qa(k):(k=ha(l)?Xf:Po.current,k=zg(r,k));var se=l.getDerivedStateFromProps;(V=typeof se=="function"||typeof C.getSnapshotBeforeUpdate=="function")||typeof C.UNSAFE_componentWillReceiveProps!="function"&&typeof C.componentWillReceiveProps!="function"||(s!==U||$!==k)&&ZD(r,C,d,k),kd=!1,$=r.memoizedState,C.state=$,ew(r,d,C,_);var ae=r.memoizedState;s!==U||$!==ae||da.current||kd?(typeof se=="function"&&(tC(r,l,se,d),ae=r.memoizedState),(z=kd||WD(r,l,z,d,$,ae,k)||!1)?(V||typeof C.UNSAFE_componentWillUpdate!="function"&&typeof C.componentWillUpdate!="function"||(typeof C.componentWillUpdate=="function"&&C.componentWillUpdate(d,ae,k),typeof C.UNSAFE_componentWillUpdate=="function"&&C.UNSAFE_componentWillUpdate(d,ae,k)),typeof C.componentDidUpdate=="function"&&(r.flags|=4),typeof C.getSnapshotBeforeUpdate=="function"&&(r.flags|=1024)):(typeof C.componentDidUpdate!="function"||s===t.memoizedProps&&$===t.memoizedState||(r.flags|=4),typeof C.getSnapshotBeforeUpdate!="function"||s===t.memoizedProps&&$===t.memoizedState||(r.flags|=1024),r.memoizedProps=d,r.memoizedState=ae),C.props=d,C.state=ae,C.context=k,d=z):(typeof C.componentDidUpdate!="function"||s===t.memoizedProps&&$===t.memoizedState||(r.flags|=4),typeof C.getSnapshotBeforeUpdate!="function"||s===t.memoizedProps&&$===t.memoizedState||(r.flags|=1024),d=!1)}return sC(t,r,l,d,x,_)}function sC(t,r,l,d,_,x){Lz(t,r);var C=(r.flags&128)!==0;if(!d&&!C)return _&&jD(r,l,!1),Cu(t,r,x);d=r.stateNode,FG.current=r;var s=C&&typeof l.getDerivedStateFromError!="function"?null:d.render();return r.flags|=1,t!==null&&C?(r.child=Fg(r,t.child,null,x),r.child=Fg(r,null,s,x)):$o(t,r,s,x),r.memoizedState=d.state,_&&jD(r,l,!0),r.child}function Nz(t){var r=t.stateNode;r.pendingContext?FD(t,r.pendingContext,r.pendingContext!==r.context):r.context&&FD(t,r.context,!1),UA(t,r.containerInfo)}function tL(t,r,l,d,_){return Og(),zA(_),r.flags|=256,$o(t,r,l,d),r.child}var oC={dehydrated:null,treeContext:null,retryLane:0};function aC(t){return{baseLanes:t,cachePool:null,transitions:null}}function zz(t,r,l){var d=r.pendingProps,_=cs.current,x=!1,C=(r.flags&128)!==0,s;if((s=C)||(s=t!==null&&t.memoizedState===null?!1:(_&2)!==0),s?(x=!0,r.flags&=-129):(t===null||t.memoizedState!==null)&&(_|=1),Xi(cs,_&1),t===null)return JE(r),t=r.memoizedState,t!==null&&(t=t.dehydrated,t!==null)?(r.mode&1?t.data==="$!"?r.lanes=8:r.lanes=1073741824:r.lanes=1,null):(C=d.children,t=d.fallback,x?(d=r.mode,x=r.child,C={mode:"hidden",children:C},!(d&1)&&x!==null?(x.childLanes=0,x.pendingProps=C):x=Zw(C,d,0,null),t=Wf(t,d,l,null),x.return=r,t.return=r,x.sibling=t,r.child=x,r.child.memoizedState=aC(l),r.memoizedState=oC,t):YA(r,C));if(_=t.memoizedState,_!==null&&(s=_.dehydrated,s!==null))return jG(t,r,C,d,s,_,l);if(x){x=d.fallback,C=r.mode,_=t.child,s=_.sibling;var k={mode:"hidden",children:d.children};return!(C&1)&&r.child!==_?(d=r.child,d.childLanes=0,d.pendingProps=k,r.deletions=null):(d=nh(_,k),d.subtreeFlags=_.subtreeFlags&14680064),s!==null?x=nh(s,x):(x=Wf(x,C,l,null),x.flags|=2),x.return=r,d.return=r,d.sibling=x,r.child=d,d=x,x=r.child,C=t.child.memoizedState,C=C===null?aC(l):{baseLanes:C.baseLanes|l,cachePool:null,transitions:C.transitions},x.memoizedState=C,x.childLanes=t.childLanes&~l,r.memoizedState=oC,d}return x=t.child,t=x.sibling,d=nh(x,{mode:"visible",children:d.children}),!(r.mode&1)&&(d.lanes=l),d.return=r,d.sibling=null,t!==null&&(l=r.deletions,l===null?(r.deletions=[t],r.flags|=16):l.push(t)),r.child=d,r.memoizedState=null,d}function YA(t,r){return r=Zw({mode:"visible",children:r},t.mode,0,null),r.return=t,t.child=r}function eb(t,r,l,d){return d!==null&&zA(d),Fg(r,t.child,null,l),t=YA(r,r.pendingProps.children),t.flags|=2,r.memoizedState=null,t}function jG(t,r,l,d,_,x,C){if(l)return r.flags&256?(r.flags&=-257,d=tE(Error(un(422))),eb(t,r,C,d)):r.memoizedState!==null?(r.child=t.child,r.flags|=128,null):(x=d.fallback,_=r.mode,d=Zw({mode:"visible",children:d.children},_,0,null),x=Wf(x,_,C,null),x.flags|=2,d.return=r,x.return=r,d.sibling=x,r.child=d,r.mode&1&&Fg(r,t.child,null,C),r.child.memoizedState=aC(C),r.memoizedState=oC,x);if(!(r.mode&1))return eb(t,r,C,null);if(_.data==="$!"){if(d=_.nextSibling&&_.nextSibling.dataset,d)var s=d.dgst;return d=s,x=Error(un(419)),d=tE(x,d,void 0),eb(t,r,C,d)}if(s=(C&t.childLanes)!==0,ua||s){if(d=no,d!==null){switch(C&-C){case 4:_=2;break;case 16:_=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:_=32;break;case 536870912:_=268435456;break;default:_=0}_=_&(d.suspendedLanes|C)?0:_,_!==0&&_!==x.retryLane&&(x.retryLane=_,Eu(t,_),zl(d,t,_,-1))}return nI(),d=tE(Error(un(421))),eb(t,r,C,d)}return _.data==="$?"?(r.flags|=128,r.child=t.child,r=QG.bind(null,t),_._reactRetry=r,null):(t=x.treeContext,Aa=Qd(_.nextSibling),Pa=r,ss=!0,Il=null,t!==null&&(Wa[Za++]=_u,Wa[Za++]=yu,Wa[Za++]=Yf,_u=t.id,yu=t.overflow,Yf=r),r=YA(r,d.children),r.flags|=4096,r)}function nL(t,r,l){t.lanes|=r;var d=t.alternate;d!==null&&(d.lanes|=r),eC(t.return,r,l)}function nE(t,r,l,d,_){var x=t.memoizedState;x===null?t.memoizedState={isBackwards:r,rendering:null,renderingStartTime:0,last:d,tail:l,tailMode:_}:(x.isBackwards=r,x.rendering=null,x.renderingStartTime=0,x.last=d,x.tail=l,x.tailMode=_)}function Oz(t,r,l){var d=r.pendingProps,_=d.revealOrder,x=d.tail;if($o(t,r,d.children,l),d=cs.current,d&2)d=d&1|2,r.flags|=128;else{if(t!==null&&t.flags&128)e:for(t=r.child;t!==null;){if(t.tag===13)t.memoizedState!==null&&nL(t,l,r);else if(t.tag===19)nL(t,l,r);else if(t.child!==null){t.child.return=t,t=t.child;continue}if(t===r)break e;for(;t.sibling===null;){if(t.return===null||t.return===r)break e;t=t.return}t.sibling.return=t.return,t=t.sibling}d&=1}if(Xi(cs,d),!(r.mode&1))r.memoizedState=null;else switch(_){case"forwards":for(l=r.child,_=null;l!==null;)t=l.alternate,t!==null&&tw(t)===null&&(_=l),l=l.sibling;l=_,l===null?(_=r.child,r.child=null):(_=l.sibling,l.sibling=null),nE(r,!1,_,l,x);break;case"backwards":for(l=null,_=r.child,r.child=null;_!==null;){if(t=_.alternate,t!==null&&tw(t)===null){r.child=_;break}t=_.sibling,_.sibling=l,l=_,_=t}nE(r,!0,l,null,x);break;case"together":nE(r,!1,null,null,void 0);break;default:r.memoizedState=null}return r.child}function Tb(t,r){!(r.mode&1)&&t!==null&&(t.alternate=null,r.alternate=null,r.flags|=2)}function Cu(t,r,l){if(t!==null&&(r.dependencies=t.dependencies),Qf|=r.lanes,!(l&r.childLanes))return null;if(t!==null&&r.child!==t.child)throw Error(un(153));if(r.child!==null){for(t=r.child,l=nh(t,t.pendingProps),r.child=l,l.return=r;t.sibling!==null;)t=t.sibling,l=l.sibling=nh(t,t.pendingProps),l.return=r;l.sibling=null}return r.child}function BG(t,r,l){switch(r.tag){case 3:Nz(r),Og();break;case 5:cz(r);break;case 1:ha(r.type)&&Xb(r);break;case 4:UA(r,r.stateNode.containerInfo);break;case 10:var d=r.type._context,_=r.memoizedProps.value;Xi(Qb,d._currentValue),d._currentValue=_;break;case 13:if(d=r.memoizedState,d!==null)return d.dehydrated!==null?(Xi(cs,cs.current&1),r.flags|=128,null):l&r.child.childLanes?zz(t,r,l):(Xi(cs,cs.current&1),t=Cu(t,r,l),t!==null?t.sibling:null);Xi(cs,cs.current&1);break;case 19:if(d=(l&r.childLanes)!==0,t.flags&128){if(d)return Oz(t,r,l);r.flags|=128}if(_=r.memoizedState,_!==null&&(_.rendering=null,_.tail=null,_.lastEffect=null),Xi(cs,cs.current),d)break;return null;case 22:case 23:return r.lanes=0,Dz(t,r,l)}return Cu(t,r,l)}var Fz,lC,jz,Bz;Fz=function(t,r){for(var l=r.child;l!==null;){if(l.tag===5||l.tag===6)t.appendChild(l.stateNode);else if(l.tag!==4&&l.child!==null){l.child.return=l,l=l.child;continue}if(l===r)break;for(;l.sibling===null;){if(l.return===null||l.return===r)return;l=l.return}l.sibling.return=l.return,l=l.sibling}};lC=function(){};jz=function(t,r,l,d){var _=t.memoizedProps;if(_!==d){t=r.stateNode,Of(Ic.current);var x=null;switch(l){case"input":_=ME(t,_),d=ME(t,d),x=[];break;case"select":_=hs({},_,{value:void 0}),d=hs({},d,{value:void 0}),x=[];break;case"textarea":_=DE(t,_),d=DE(t,d),x=[];break;default:typeof _.onClick!="function"&&typeof d.onClick=="function"&&(t.onclick=Wb)}NE(l,d);var C;l=null;for(z in _)if(!d.hasOwnProperty(z)&&_.hasOwnProperty(z)&&_[z]!=null)if(z==="style"){var s=_[z];for(C in s)s.hasOwnProperty(C)&&(l||(l={}),l[C]="")}else z!=="dangerouslySetInnerHTML"&&z!=="children"&&z!=="suppressContentEditableWarning"&&z!=="suppressHydrationWarning"&&z!=="autoFocus"&&(Nv.hasOwnProperty(z)?x||(x=[]):(x=x||[]).push(z,null));for(z in d){var k=d[z];if(s=_!=null?_[z]:void 0,d.hasOwnProperty(z)&&k!==s&&(k!=null||s!=null))if(z==="style")if(s){for(C in s)!s.hasOwnProperty(C)||k&&k.hasOwnProperty(C)||(l||(l={}),l[C]="");for(C in k)k.hasOwnProperty(C)&&s[C]!==k[C]&&(l||(l={}),l[C]=k[C])}else l||(x||(x=[]),x.push(z,l)),l=k;else z==="dangerouslySetInnerHTML"?(k=k?k.__html:void 0,s=s?s.__html:void 0,k!=null&&s!==k&&(x=x||[]).push(z,k)):z==="children"?typeof k!="string"&&typeof k!="number"||(x=x||[]).push(z,""+k):z!=="suppressContentEditableWarning"&&z!=="suppressHydrationWarning"&&(Nv.hasOwnProperty(z)?(k!=null&&z==="onScroll"&&ts("scroll",t),x||s===k||(x=[])):(x=x||[]).push(z,k))}l&&(x=x||[]).push("style",l);var z=x;(r.updateQueue=z)&&(r.flags|=4)}};Bz=function(t,r,l,d){l!==d&&(r.flags|=4)};function sv(t,r){if(!ss)switch(t.tailMode){case"hidden":r=t.tail;for(var l=null;r!==null;)r.alternate!==null&&(l=r),r=r.sibling;l===null?t.tail=null:l.sibling=null;break;case"collapsed":l=t.tail;for(var d=null;l!==null;)l.alternate!==null&&(d=l),l=l.sibling;d===null?r||t.tail===null?t.tail=null:t.tail.sibling=null:d.sibling=null}}function Co(t){var r=t.alternate!==null&&t.alternate.child===t.child,l=0,d=0;if(r)for(var _=t.child;_!==null;)l|=_.lanes|_.childLanes,d|=_.subtreeFlags&14680064,d|=_.flags&14680064,_.return=t,_=_.sibling;else for(_=t.child;_!==null;)l|=_.lanes|_.childLanes,d|=_.subtreeFlags,d|=_.flags,_.return=t,_=_.sibling;return t.subtreeFlags|=d,t.childLanes=l,r}function VG(t,r,l){var d=r.pendingProps;switch(NA(r),r.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Co(r),null;case 1:return ha(r.type)&&Zb(),Co(r),null;case 3:return d=r.stateNode,jg(),rs(da),rs(Po),GA(),d.pendingContext&&(d.context=d.pendingContext,d.pendingContext=null),(t===null||t.child===null)&&(Q1(r)?r.flags|=4:t===null||t.memoizedState.isDehydrated&&!(r.flags&256)||(r.flags|=1024,Il!==null&&(gC(Il),Il=null))),lC(t,r),Co(r),null;case 5:$A(r);var _=Of(Wv.current);if(l=r.type,t!==null&&r.stateNode!=null)jz(t,r,l,d,_),t.ref!==r.ref&&(r.flags|=512,r.flags|=2097152);else{if(!d){if(r.stateNode===null)throw Error(un(166));return Co(r),null}if(t=Of(Ic.current),Q1(r)){d=r.stateNode,l=r.type;var x=r.memoizedProps;switch(d[Tc]=r,d[Hv]=x,t=(r.mode&1)!==0,l){case"dialog":ts("cancel",d),ts("close",d);break;case"iframe":case"object":case"embed":ts("load",d);break;case"video":case"audio":for(_=0;_<gv.length;_++)ts(gv[_],d);break;case"source":ts("error",d);break;case"img":case"image":case"link":ts("error",d),ts("load",d);break;case"details":ts("toggle",d);break;case"input":dD(d,x),ts("invalid",d);break;case"select":d._wrapperState={wasMultiple:!!x.multiple},ts("invalid",d);break;case"textarea":fD(d,x),ts("invalid",d)}NE(l,x),_=null;for(var C in x)if(x.hasOwnProperty(C)){var s=x[C];C==="children"?typeof s=="string"?d.textContent!==s&&(x.suppressHydrationWarning!==!0&&K1(d.textContent,s,t),_=["children",s]):typeof s=="number"&&d.textContent!==""+s&&(x.suppressHydrationWarning!==!0&&K1(d.textContent,s,t),_=["children",""+s]):Nv.hasOwnProperty(C)&&s!=null&&C==="onScroll"&&ts("scroll",d)}switch(l){case"input":$1(d),hD(d,x,!0);break;case"textarea":$1(d),pD(d);break;case"select":case"option":break;default:typeof x.onClick=="function"&&(d.onclick=Wb)}d=_,r.updateQueue=d,d!==null&&(r.flags|=4)}else{C=_.nodeType===9?_:_.ownerDocument,t==="http://www.w3.org/1999/xhtml"&&(t=p3(l)),t==="http://www.w3.org/1999/xhtml"?l==="script"?(t=C.createElement("div"),t.innerHTML="<script><\/script>",t=t.removeChild(t.firstChild)):typeof d.is=="string"?t=C.createElement(l,{is:d.is}):(t=C.createElement(l),l==="select"&&(C=t,d.multiple?C.multiple=!0:d.size&&(C.size=d.size))):t=C.createElementNS(t,l),t[Tc]=r,t[Hv]=d,Fz(t,r,!1,!1),r.stateNode=t;e:{switch(C=zE(l,d),l){case"dialog":ts("cancel",t),ts("close",t),_=d;break;case"iframe":case"object":case"embed":ts("load",t),_=d;break;case"video":case"audio":for(_=0;_<gv.length;_++)ts(gv[_],t);_=d;break;case"source":ts("error",t),_=d;break;case"img":case"image":case"link":ts("error",t),ts("load",t),_=d;break;case"details":ts("toggle",t),_=d;break;case"input":dD(t,d),_=ME(t,d),ts("invalid",t);break;case"option":_=d;break;case"select":t._wrapperState={wasMultiple:!!d.multiple},_=hs({},d,{value:void 0}),ts("invalid",t);break;case"textarea":fD(t,d),_=DE(t,d),ts("invalid",t);break;default:_=d}NE(l,_),s=_;for(x in s)if(s.hasOwnProperty(x)){var k=s[x];x==="style"?_3(t,k):x==="dangerouslySetInnerHTML"?(k=k?k.__html:void 0,k!=null&&m3(t,k)):x==="children"?typeof k=="string"?(l!=="textarea"||k!=="")&&zv(t,k):typeof k=="number"&&zv(t,""+k):x!=="suppressContentEditableWarning"&&x!=="suppressHydrationWarning"&&x!=="autoFocus"&&(Nv.hasOwnProperty(x)?k!=null&&x==="onScroll"&&ts("scroll",t):k!=null&&xA(t,x,k,C))}switch(l){case"input":$1(t),hD(t,d,!1);break;case"textarea":$1(t),pD(t);break;case"option":d.value!=null&&t.setAttribute("value",""+sh(d.value));break;case"select":t.multiple=!!d.multiple,x=d.value,x!=null?cg(t,!!d.multiple,x,!1):d.defaultValue!=null&&cg(t,!!d.multiple,d.defaultValue,!0);break;default:typeof _.onClick=="function"&&(t.onclick=Wb)}switch(l){case"button":case"input":case"select":case"textarea":d=!!d.autoFocus;break e;case"img":d=!0;break e;default:d=!1}}d&&(r.flags|=4)}r.ref!==null&&(r.flags|=512,r.flags|=2097152)}return Co(r),null;case 6:if(t&&r.stateNode!=null)Bz(t,r,t.memoizedProps,d);else{if(typeof d!="string"&&r.stateNode===null)throw Error(un(166));if(l=Of(Wv.current),Of(Ic.current),Q1(r)){if(d=r.stateNode,l=r.memoizedProps,d[Tc]=r,(x=d.nodeValue!==l)&&(t=Pa,t!==null))switch(t.tag){case 3:K1(d.nodeValue,l,(t.mode&1)!==0);break;case 5:t.memoizedProps.suppressHydrationWarning!==!0&&K1(d.nodeValue,l,(t.mode&1)!==0)}x&&(r.flags|=4)}else d=(l.nodeType===9?l:l.ownerDocument).createTextNode(d),d[Tc]=r,r.stateNode=d}return Co(r),null;case 13:if(rs(cs),d=r.memoizedState,t===null||t.memoizedState!==null&&t.memoizedState.dehydrated!==null){if(ss&&Aa!==null&&r.mode&1&&!(r.flags&128))iz(),Og(),r.flags|=98560,x=!1;else if(x=Q1(r),d!==null&&d.dehydrated!==null){if(t===null){if(!x)throw Error(un(318));if(x=r.memoizedState,x=x!==null?x.dehydrated:null,!x)throw Error(un(317));x[Tc]=r}else Og(),!(r.flags&128)&&(r.memoizedState=null),r.flags|=4;Co(r),x=!1}else Il!==null&&(gC(Il),Il=null),x=!0;if(!x)return r.flags&65536?r:null}return r.flags&128?(r.lanes=l,r):(d=d!==null,d!==(t!==null&&t.memoizedState!==null)&&d&&(r.child.flags|=8192,r.mode&1&&(t===null||cs.current&1?Hs===0&&(Hs=3):nI())),r.updateQueue!==null&&(r.flags|=4),Co(r),null);case 4:return jg(),lC(t,r),t===null&&$v(r.stateNode.containerInfo),Co(r),null;case 10:return jA(r.type._context),Co(r),null;case 17:return ha(r.type)&&Zb(),Co(r),null;case 19:if(rs(cs),x=r.memoizedState,x===null)return Co(r),null;if(d=(r.flags&128)!==0,C=x.rendering,C===null)if(d)sv(x,!1);else{if(Hs!==0||t!==null&&t.flags&128)for(t=r.child;t!==null;){if(C=tw(t),C!==null){for(r.flags|=128,sv(x,!1),d=C.updateQueue,d!==null&&(r.updateQueue=d,r.flags|=4),r.subtreeFlags=0,d=l,l=r.child;l!==null;)x=l,t=d,x.flags&=14680066,C=x.alternate,C===null?(x.childLanes=0,x.lanes=t,x.child=null,x.subtreeFlags=0,x.memoizedProps=null,x.memoizedState=null,x.updateQueue=null,x.dependencies=null,x.stateNode=null):(x.childLanes=C.childLanes,x.lanes=C.lanes,x.child=C.child,x.subtreeFlags=0,x.deletions=null,x.memoizedProps=C.memoizedProps,x.memoizedState=C.memoizedState,x.updateQueue=C.updateQueue,x.type=C.type,t=C.dependencies,x.dependencies=t===null?null:{lanes:t.lanes,firstContext:t.firstContext}),l=l.sibling;return Xi(cs,cs.current&1|2),r.child}t=t.sibling}x.tail!==null&&Ts()>Vg&&(r.flags|=128,d=!0,sv(x,!1),r.lanes=4194304)}else{if(!d)if(t=tw(C),t!==null){if(r.flags|=128,d=!0,l=t.updateQueue,l!==null&&(r.updateQueue=l,r.flags|=4),sv(x,!0),x.tail===null&&x.tailMode==="hidden"&&!C.alternate&&!ss)return Co(r),null}else 2*Ts()-x.renderingStartTime>Vg&&l!==1073741824&&(r.flags|=128,d=!0,sv(x,!1),r.lanes=4194304);x.isBackwards?(C.sibling=r.child,r.child=C):(l=x.last,l!==null?l.sibling=C:r.child=C,x.last=C)}return x.tail!==null?(r=x.tail,x.rendering=r,x.tail=r.sibling,x.renderingStartTime=Ts(),r.sibling=null,l=cs.current,Xi(cs,d?l&1|2:l&1),r):(Co(r),null);case 22:case 23:return tI(),d=r.memoizedState!==null,t!==null&&t.memoizedState!==null!==d&&(r.flags|=8192),d&&r.mode&1?Ea&1073741824&&(Co(r),r.subtreeFlags&6&&(r.flags|=8192)):Co(r),null;case 24:return null;case 25:return null}throw Error(un(156,r.tag))}function UG(t,r){switch(NA(r),r.tag){case 1:return ha(r.type)&&Zb(),t=r.flags,t&65536?(r.flags=t&-65537|128,r):null;case 3:return jg(),rs(da),rs(Po),GA(),t=r.flags,t&65536&&!(t&128)?(r.flags=t&-65537|128,r):null;case 5:return $A(r),null;case 13:if(rs(cs),t=r.memoizedState,t!==null&&t.dehydrated!==null){if(r.alternate===null)throw Error(un(340));Og()}return t=r.flags,t&65536?(r.flags=t&-65537|128,r):null;case 19:return rs(cs),null;case 4:return jg(),null;case 10:return jA(r.type._context),null;case 22:case 23:return tI(),null;case 24:return null;default:return null}}var tb=!1,Io=!1,$G=typeof WeakSet=="function"?WeakSet:Set,Wn=null;function sg(t,r){var l=t.ref;if(l!==null)if(typeof l=="function")try{l(null)}catch(d){_s(t,r,d)}else l.current=null}function cC(t,r,l){try{l()}catch(d){_s(t,r,d)}}var rL=!1;function GG(t,r){if(qE=Gb,t=H3(),DA(t)){if("selectionStart"in t)var l={start:t.selectionStart,end:t.selectionEnd};else e:{l=(l=t.ownerDocument)&&l.defaultView||window;var d=l.getSelection&&l.getSelection();if(d&&d.rangeCount!==0){l=d.anchorNode;var _=d.anchorOffset,x=d.focusNode;d=d.focusOffset;try{l.nodeType,x.nodeType}catch{l=null;break e}var C=0,s=-1,k=-1,z=0,V=0,U=t,$=null;t:for(;;){for(var se;U!==l||_!==0&&U.nodeType!==3||(s=C+_),U!==x||d!==0&&U.nodeType!==3||(k=C+d),U.nodeType===3&&(C+=U.nodeValue.length),(se=U.firstChild)!==null;)$=U,U=se;for(;;){if(U===t)break t;if($===l&&++z===_&&(s=C),$===x&&++V===d&&(k=C),(se=U.nextSibling)!==null)break;U=$,$=U.parentNode}U=se}l=s===-1||k===-1?null:{start:s,end:k}}else l=null}l=l||{start:0,end:0}}else l=null;for(WE={focusedElem:t,selectionRange:l},Gb=!1,Wn=r;Wn!==null;)if(r=Wn,t=r.child,(r.subtreeFlags&1028)!==0&&t!==null)t.return=r,Wn=t;else for(;Wn!==null;){r=Wn;try{var ae=r.alternate;if(r.flags&1024)switch(r.tag){case 0:case 11:case 15:break;case 1:if(ae!==null){var H=ae.memoizedProps,ne=ae.memoizedState,Y=r.stateNode,te=Y.getSnapshotBeforeUpdate(r.elementType===r.type?H:El(r.type,H),ne);Y.__reactInternalSnapshotBeforeUpdate=te}break;case 3:var de=r.stateNode.containerInfo;de.nodeType===1?de.textContent="":de.nodeType===9&&de.documentElement&&de.removeChild(de.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(un(163))}}catch(Me){_s(r,r.return,Me)}if(t=r.sibling,t!==null){t.return=r.return,Wn=t;break}Wn=r.return}return ae=rL,rL=!1,ae}function Iv(t,r,l){var d=r.updateQueue;if(d=d!==null?d.lastEffect:null,d!==null){var _=d=d.next;do{if((_.tag&t)===t){var x=_.destroy;_.destroy=void 0,x!==void 0&&cC(r,l,x)}_=_.next}while(_!==d)}}function qw(t,r){if(r=r.updateQueue,r=r!==null?r.lastEffect:null,r!==null){var l=r=r.next;do{if((l.tag&t)===t){var d=l.create;l.destroy=d()}l=l.next}while(l!==r)}}function uC(t){var r=t.ref;if(r!==null){var l=t.stateNode;switch(t.tag){case 5:t=l;break;default:t=l}typeof r=="function"?r(t):r.current=t}}function Vz(t){var r=t.alternate;r!==null&&(t.alternate=null,Vz(r)),t.child=null,t.deletions=null,t.sibling=null,t.tag===5&&(r=t.stateNode,r!==null&&(delete r[Tc],delete r[Hv],delete r[YE],delete r[CG],delete r[AG])),t.stateNode=null,t.return=null,t.dependencies=null,t.memoizedProps=null,t.memoizedState=null,t.pendingProps=null,t.stateNode=null,t.updateQueue=null}function Uz(t){return t.tag===5||t.tag===3||t.tag===4}function iL(t){e:for(;;){for(;t.sibling===null;){if(t.return===null||Uz(t.return))return null;t=t.return}for(t.sibling.return=t.return,t=t.sibling;t.tag!==5&&t.tag!==6&&t.tag!==18;){if(t.flags&2||t.child===null||t.tag===4)continue e;t.child.return=t,t=t.child}if(!(t.flags&2))return t.stateNode}}function dC(t,r,l){var d=t.tag;if(d===5||d===6)t=t.stateNode,r?l.nodeType===8?l.parentNode.insertBefore(t,r):l.insertBefore(t,r):(l.nodeType===8?(r=l.parentNode,r.insertBefore(t,l)):(r=l,r.appendChild(t)),l=l._reactRootContainer,l!=null||r.onclick!==null||(r.onclick=Wb));else if(d!==4&&(t=t.child,t!==null))for(dC(t,r,l),t=t.sibling;t!==null;)dC(t,r,l),t=t.sibling}function hC(t,r,l){var d=t.tag;if(d===5||d===6)t=t.stateNode,r?l.insertBefore(t,r):l.appendChild(t);else if(d!==4&&(t=t.child,t!==null))for(hC(t,r,l),t=t.sibling;t!==null;)hC(t,r,l),t=t.sibling}var uo=null,Al=!1;function wd(t,r,l){for(l=l.child;l!==null;)$z(t,r,l),l=l.sibling}function $z(t,r,l){if(Ac&&typeof Ac.onCommitFiberUnmount=="function")try{Ac.onCommitFiberUnmount(Fw,l)}catch{}switch(l.tag){case 5:Io||sg(l,r);case 6:var d=uo,_=Al;uo=null,wd(t,r,l),uo=d,Al=_,uo!==null&&(Al?(t=uo,l=l.stateNode,t.nodeType===8?t.parentNode.removeChild(l):t.removeChild(l)):uo.removeChild(l.stateNode));break;case 18:uo!==null&&(Al?(t=uo,l=l.stateNode,t.nodeType===8?XT(t.parentNode,l):t.nodeType===1&&XT(t,l),Bv(t)):XT(uo,l.stateNode));break;case 4:d=uo,_=Al,uo=l.stateNode.containerInfo,Al=!0,wd(t,r,l),uo=d,Al=_;break;case 0:case 11:case 14:case 15:if(!Io&&(d=l.updateQueue,d!==null&&(d=d.lastEffect,d!==null))){_=d=d.next;do{var x=_,C=x.destroy;x=x.tag,C!==void 0&&(x&2||x&4)&&cC(l,r,C),_=_.next}while(_!==d)}wd(t,r,l);break;case 1:if(!Io&&(sg(l,r),d=l.stateNode,typeof d.componentWillUnmount=="function"))try{d.props=l.memoizedProps,d.state=l.memoizedState,d.componentWillUnmount()}catch(s){_s(l,r,s)}wd(t,r,l);break;case 21:wd(t,r,l);break;case 22:l.mode&1?(Io=(d=Io)||l.memoizedState!==null,wd(t,r,l),Io=d):wd(t,r,l);break;default:wd(t,r,l)}}function sL(t){var r=t.updateQueue;if(r!==null){t.updateQueue=null;var l=t.stateNode;l===null&&(l=t.stateNode=new $G),r.forEach(function(d){var _=JG.bind(null,t,d);l.has(d)||(l.add(d),d.then(_,_))})}}function wl(t,r){var l=r.deletions;if(l!==null)for(var d=0;d<l.length;d++){var _=l[d];try{var x=t,C=r,s=C;e:for(;s!==null;){switch(s.tag){case 5:uo=s.stateNode,Al=!1;break e;case 3:uo=s.stateNode.containerInfo,Al=!0;break e;case 4:uo=s.stateNode.containerInfo,Al=!0;break e}s=s.return}if(uo===null)throw Error(un(160));$z(x,C,_),uo=null,Al=!1;var k=_.alternate;k!==null&&(k.return=null),_.return=null}catch(z){_s(_,r,z)}}if(r.subtreeFlags&12854)for(r=r.child;r!==null;)Gz(r,t),r=r.sibling}function Gz(t,r){var l=t.alternate,d=t.flags;switch(t.tag){case 0:case 11:case 14:case 15:if(wl(r,t),yc(t),d&4){try{Iv(3,t,t.return),qw(3,t)}catch(H){_s(t,t.return,H)}try{Iv(5,t,t.return)}catch(H){_s(t,t.return,H)}}break;case 1:wl(r,t),yc(t),d&512&&l!==null&&sg(l,l.return);break;case 5:if(wl(r,t),yc(t),d&512&&l!==null&&sg(l,l.return),t.flags&32){var _=t.stateNode;try{zv(_,"")}catch(H){_s(t,t.return,H)}}if(d&4&&(_=t.stateNode,_!=null)){var x=t.memoizedProps,C=l!==null?l.memoizedProps:x,s=t.type,k=t.updateQueue;if(t.updateQueue=null,k!==null)try{s==="input"&&x.type==="radio"&&x.name!=null&&h3(_,x),zE(s,C);var z=zE(s,x);for(C=0;C<k.length;C+=2){var V=k[C],U=k[C+1];V==="style"?_3(_,U):V==="dangerouslySetInnerHTML"?m3(_,U):V==="children"?zv(_,U):xA(_,V,U,z)}switch(s){case"input":RE(_,x);break;case"textarea":f3(_,x);break;case"select":var $=_._wrapperState.wasMultiple;_._wrapperState.wasMultiple=!!x.multiple;var se=x.value;se!=null?cg(_,!!x.multiple,se,!1):$!==!!x.multiple&&(x.defaultValue!=null?cg(_,!!x.multiple,x.defaultValue,!0):cg(_,!!x.multiple,x.multiple?[]:"",!1))}_[Hv]=x}catch(H){_s(t,t.return,H)}}break;case 6:if(wl(r,t),yc(t),d&4){if(t.stateNode===null)throw Error(un(162));_=t.stateNode,x=t.memoizedProps;try{_.nodeValue=x}catch(H){_s(t,t.return,H)}}break;case 3:if(wl(r,t),yc(t),d&4&&l!==null&&l.memoizedState.isDehydrated)try{Bv(r.containerInfo)}catch(H){_s(t,t.return,H)}break;case 4:wl(r,t),yc(t);break;case 13:wl(r,t),yc(t),_=t.child,_.flags&8192&&(x=_.memoizedState!==null,_.stateNode.isHidden=x,!x||_.alternate!==null&&_.alternate.memoizedState!==null||(JA=Ts())),d&4&&sL(t);break;case 22:if(V=l!==null&&l.memoizedState!==null,t.mode&1?(Io=(z=Io)||V,wl(r,t),Io=z):wl(r,t),yc(t),d&8192){if(z=t.memoizedState!==null,(t.stateNode.isHidden=z)&&!V&&t.mode&1)for(Wn=t,V=t.child;V!==null;){for(U=Wn=V;Wn!==null;){switch($=Wn,se=$.child,$.tag){case 0:case 11:case 14:case 15:Iv(4,$,$.return);break;case 1:sg($,$.return);var ae=$.stateNode;if(typeof ae.componentWillUnmount=="function"){d=$,l=$.return;try{r=d,ae.props=r.memoizedProps,ae.state=r.memoizedState,ae.componentWillUnmount()}catch(H){_s(d,l,H)}}break;case 5:sg($,$.return);break;case 22:if($.memoizedState!==null){aL(U);continue}}se!==null?(se.return=$,Wn=se):aL(U)}V=V.sibling}e:for(V=null,U=t;;){if(U.tag===5){if(V===null){V=U;try{_=U.stateNode,z?(x=_.style,typeof x.setProperty=="function"?x.setProperty("display","none","important"):x.display="none"):(s=U.stateNode,k=U.memoizedProps.style,C=k!=null&&k.hasOwnProperty("display")?k.display:null,s.style.display=g3("display",C))}catch(H){_s(t,t.return,H)}}}else if(U.tag===6){if(V===null)try{U.stateNode.nodeValue=z?"":U.memoizedProps}catch(H){_s(t,t.return,H)}}else if((U.tag!==22&&U.tag!==23||U.memoizedState===null||U===t)&&U.child!==null){U.child.return=U,U=U.child;continue}if(U===t)break e;for(;U.sibling===null;){if(U.return===null||U.return===t)break e;V===U&&(V=null),U=U.return}V===U&&(V=null),U.sibling.return=U.return,U=U.sibling}}break;case 19:wl(r,t),yc(t),d&4&&sL(t);break;case 21:break;default:wl(r,t),yc(t)}}function yc(t){var r=t.flags;if(r&2){try{e:{for(var l=t.return;l!==null;){if(Uz(l)){var d=l;break e}l=l.return}throw Error(un(160))}switch(d.tag){case 5:var _=d.stateNode;d.flags&32&&(zv(_,""),d.flags&=-33);var x=iL(t);hC(t,x,_);break;case 3:case 4:var C=d.stateNode.containerInfo,s=iL(t);dC(t,s,C);break;default:throw Error(un(161))}}catch(k){_s(t,t.return,k)}t.flags&=-3}r&4096&&(t.flags&=-4097)}function HG(t,r,l){Wn=t,Hz(t)}function Hz(t,r,l){for(var d=(t.mode&1)!==0;Wn!==null;){var _=Wn,x=_.child;if(_.tag===22&&d){var C=_.memoizedState!==null||tb;if(!C){var s=_.alternate,k=s!==null&&s.memoizedState!==null||Io;s=tb;var z=Io;if(tb=C,(Io=k)&&!z)for(Wn=_;Wn!==null;)C=Wn,k=C.child,C.tag===22&&C.memoizedState!==null?lL(_):k!==null?(k.return=C,Wn=k):lL(_);for(;x!==null;)Wn=x,Hz(x),x=x.sibling;Wn=_,tb=s,Io=z}oL(t)}else _.subtreeFlags&8772&&x!==null?(x.return=_,Wn=x):oL(t)}}function oL(t){for(;Wn!==null;){var r=Wn;if(r.flags&8772){var l=r.alternate;try{if(r.flags&8772)switch(r.tag){case 0:case 11:case 15:Io||qw(5,r);break;case 1:var d=r.stateNode;if(r.flags&4&&!Io)if(l===null)d.componentDidMount();else{var _=r.elementType===r.type?l.memoizedProps:El(r.type,l.memoizedProps);d.componentDidUpdate(_,l.memoizedState,d.__reactInternalSnapshotBeforeUpdate)}var x=r.updateQueue;x!==null&&GD(r,x,d);break;case 3:var C=r.updateQueue;if(C!==null){if(l=null,r.child!==null)switch(r.child.tag){case 5:l=r.child.stateNode;break;case 1:l=r.child.stateNode}GD(r,C,l)}break;case 5:var s=r.stateNode;if(l===null&&r.flags&4){l=s;var k=r.memoizedProps;switch(r.type){case"button":case"input":case"select":case"textarea":k.autoFocus&&l.focus();break;case"img":k.src&&(l.src=k.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(r.memoizedState===null){var z=r.alternate;if(z!==null){var V=z.memoizedState;if(V!==null){var U=V.dehydrated;U!==null&&Bv(U)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(un(163))}Io||r.flags&512&&uC(r)}catch($){_s(r,r.return,$)}}if(r===t){Wn=null;break}if(l=r.sibling,l!==null){l.return=r.return,Wn=l;break}Wn=r.return}}function aL(t){for(;Wn!==null;){var r=Wn;if(r===t){Wn=null;break}var l=r.sibling;if(l!==null){l.return=r.return,Wn=l;break}Wn=r.return}}function lL(t){for(;Wn!==null;){var r=Wn;try{switch(r.tag){case 0:case 11:case 15:var l=r.return;try{qw(4,r)}catch(k){_s(r,l,k)}break;case 1:var d=r.stateNode;if(typeof d.componentDidMount=="function"){var _=r.return;try{d.componentDidMount()}catch(k){_s(r,_,k)}}var x=r.return;try{uC(r)}catch(k){_s(r,x,k)}break;case 5:var C=r.return;try{uC(r)}catch(k){_s(r,C,k)}}}catch(k){_s(r,r.return,k)}if(r===t){Wn=null;break}var s=r.sibling;if(s!==null){s.return=r.return,Wn=s;break}Wn=r.return}}var qG=Math.ceil,iw=Ru.ReactCurrentDispatcher,KA=Ru.ReactCurrentOwner,Ya=Ru.ReactCurrentBatchConfig,Mi=0,no=null,Rs=null,mo=0,Ea=0,og=_h(0),Hs=0,Kv=null,Qf=0,Ww=0,QA=0,Pv=null,ca=null,JA=0,Vg=1/0,pu=null,sw=!1,fC=null,eh=null,nb=!1,Wd=null,ow=0,Mv=0,pC=null,Eb=-1,Cb=0;function Ho(){return Mi&6?Ts():Eb!==-1?Eb:Eb=Ts()}function th(t){return t.mode&1?Mi&2&&mo!==0?mo&-mo:PG.transition!==null?(Cb===0&&(Cb=P3()),Cb):(t=Vi,t!==0||(t=window.event,t=t===void 0?16:z3(t.type)),t):1}function zl(t,r,l,d){if(50<Mv)throw Mv=0,pC=null,Error(un(185));Ax(t,l,d),(!(Mi&2)||t!==no)&&(t===no&&(!(Mi&2)&&(Ww|=l),Hs===4&&Ld(t,mo)),fa(t,d),l===1&&Mi===0&&!(r.mode&1)&&(Vg=Ts()+500,$w&&yh()))}function fa(t,r){var l=t.callbackNode;P$(t,r);var d=$b(t,t===no?mo:0);if(d===0)l!==null&&_D(l),t.callbackNode=null,t.callbackPriority=0;else if(r=d&-d,t.callbackPriority!==r){if(l!=null&&_D(l),r===1)t.tag===0?IG(cL.bind(null,t)):tz(cL.bind(null,t)),TG(function(){!(Mi&6)&&yh()}),l=null;else{switch(M3(d)){case 1:l=EA;break;case 4:l=A3;break;case 16:l=Ub;break;case 536870912:l=I3;break;default:l=Ub}l=Jz(l,qz.bind(null,t))}t.callbackPriority=r,t.callbackNode=l}}function qz(t,r){if(Eb=-1,Cb=0,Mi&6)throw Error(un(327));var l=t.callbackNode;if(pg()&&t.callbackNode!==l)return null;var d=$b(t,t===no?mo:0);if(d===0)return null;if(d&30||d&t.expiredLanes||r)r=aw(t,d);else{r=d;var _=Mi;Mi|=2;var x=Zz();(no!==t||mo!==r)&&(pu=null,Vg=Ts()+500,qf(t,r));do try{XG();break}catch(s){Wz(t,s)}while(!0);FA(),iw.current=x,Mi=_,Rs!==null?r=0:(no=null,mo=0,r=Hs)}if(r!==0){if(r===2&&(_=VE(t),_!==0&&(d=_,r=mC(t,_))),r===1)throw l=Kv,qf(t,0),Ld(t,d),fa(t,Ts()),l;if(r===6)Ld(t,d);else{if(_=t.current.alternate,!(d&30)&&!WG(_)&&(r=aw(t,d),r===2&&(x=VE(t),x!==0&&(d=x,r=mC(t,x))),r===1))throw l=Kv,qf(t,0),Ld(t,d),fa(t,Ts()),l;switch(t.finishedWork=_,t.finishedLanes=d,r){case 0:case 1:throw Error(un(345));case 2:Lf(t,ca,pu);break;case 3:if(Ld(t,d),(d&130023424)===d&&(r=JA+500-Ts(),10<r)){if($b(t,0)!==0)break;if(_=t.suspendedLanes,(_&d)!==d){Ho(),t.pingedLanes|=t.suspendedLanes&_;break}t.timeoutHandle=XE(Lf.bind(null,t,ca,pu),r);break}Lf(t,ca,pu);break;case 4:if(Ld(t,d),(d&4194240)===d)break;for(r=t.eventTimes,_=-1;0<d;){var C=31-Nl(d);x=1<<C,C=r[C],C>_&&(_=C),d&=~x}if(d=_,d=Ts()-d,d=(120>d?120:480>d?480:1080>d?1080:1920>d?1920:3e3>d?3e3:4320>d?4320:1960*qG(d/1960))-d,10<d){t.timeoutHandle=XE(Lf.bind(null,t,ca,pu),d);break}Lf(t,ca,pu);break;case 5:Lf(t,ca,pu);break;default:throw Error(un(329))}}}return fa(t,Ts()),t.callbackNode===l?qz.bind(null,t):null}function mC(t,r){var l=Pv;return t.current.memoizedState.isDehydrated&&(qf(t,r).flags|=256),t=aw(t,r),t!==2&&(r=ca,ca=l,r!==null&&gC(r)),t}function gC(t){ca===null?ca=t:ca.push.apply(ca,t)}function WG(t){for(var r=t;;){if(r.flags&16384){var l=r.updateQueue;if(l!==null&&(l=l.stores,l!==null))for(var d=0;d<l.length;d++){var _=l[d],x=_.getSnapshot;_=_.value;try{if(!Bl(x(),_))return!1}catch{return!1}}}if(l=r.child,r.subtreeFlags&16384&&l!==null)l.return=r,r=l;else{if(r===t)break;for(;r.sibling===null;){if(r.return===null||r.return===t)return!0;r=r.return}r.sibling.return=r.return,r=r.sibling}}return!0}function Ld(t,r){for(r&=~QA,r&=~Ww,t.suspendedLanes|=r,t.pingedLanes&=~r,t=t.expirationTimes;0<r;){var l=31-Nl(r),d=1<<l;t[l]=-1,r&=~d}}function cL(t){if(Mi&6)throw Error(un(327));pg();var r=$b(t,0);if(!(r&1))return fa(t,Ts()),null;var l=aw(t,r);if(t.tag!==0&&l===2){var d=VE(t);d!==0&&(r=d,l=mC(t,d))}if(l===1)throw l=Kv,qf(t,0),Ld(t,r),fa(t,Ts()),l;if(l===6)throw Error(un(345));return t.finishedWork=t.current.alternate,t.finishedLanes=r,Lf(t,ca,pu),fa(t,Ts()),null}function eI(t,r){var l=Mi;Mi|=1;try{return t(r)}finally{Mi=l,Mi===0&&(Vg=Ts()+500,$w&&yh())}}function Jf(t){Wd!==null&&Wd.tag===0&&!(Mi&6)&&pg();var r=Mi;Mi|=1;var l=Ya.transition,d=Vi;try{if(Ya.transition=null,Vi=1,t)return t()}finally{Vi=d,Ya.transition=l,Mi=r,!(Mi&6)&&yh()}}function tI(){Ea=og.current,rs(og)}function qf(t,r){t.finishedWork=null,t.finishedLanes=0;var l=t.timeoutHandle;if(l!==-1&&(t.timeoutHandle=-1,SG(l)),Rs!==null)for(l=Rs.return;l!==null;){var d=l;switch(NA(d),d.tag){case 1:d=d.type.childContextTypes,d!=null&&Zb();break;case 3:jg(),rs(da),rs(Po),GA();break;case 5:$A(d);break;case 4:jg();break;case 13:rs(cs);break;case 19:rs(cs);break;case 10:jA(d.type._context);break;case 22:case 23:tI()}l=l.return}if(no=t,Rs=t=nh(t.current,null),mo=Ea=r,Hs=0,Kv=null,QA=Ww=Qf=0,ca=Pv=null,zf!==null){for(r=0;r<zf.length;r++)if(l=zf[r],d=l.interleaved,d!==null){l.interleaved=null;var _=d.next,x=l.pending;if(x!==null){var C=x.next;x.next=_,d.next=C}l.pending=d}zf=null}return t}function Wz(t,r){do{var l=Rs;try{if(FA(),wb.current=rw,nw){for(var d=ds.memoizedState;d!==null;){var _=d.queue;_!==null&&(_.pending=null),d=d.next}nw=!1}if(Kf=0,to=$s=ds=null,Av=!1,Zv=0,KA.current=null,l===null||l.return===null){Hs=1,Kv=r,Rs=null;break}e:{var x=t,C=l.return,s=l,k=r;if(r=mo,s.flags|=32768,k!==null&&typeof k=="object"&&typeof k.then=="function"){var z=k,V=s,U=V.tag;if(!(V.mode&1)&&(U===0||U===11||U===15)){var $=V.alternate;$?(V.updateQueue=$.updateQueue,V.memoizedState=$.memoizedState,V.lanes=$.lanes):(V.updateQueue=null,V.memoizedState=null)}var se=YD(C);if(se!==null){se.flags&=-257,KD(se,C,s,x,r),se.mode&1&&XD(x,z,r),r=se,k=z;var ae=r.updateQueue;if(ae===null){var H=new Set;H.add(k),r.updateQueue=H}else ae.add(k);break e}else{if(!(r&1)){XD(x,z,r),nI();break e}k=Error(un(426))}}else if(ss&&s.mode&1){var ne=YD(C);if(ne!==null){!(ne.flags&65536)&&(ne.flags|=256),KD(ne,C,s,x,r),zA(Bg(k,s));break e}}x=k=Bg(k,s),Hs!==4&&(Hs=2),Pv===null?Pv=[x]:Pv.push(x),x=C;do{switch(x.tag){case 3:x.flags|=65536,r&=-r,x.lanes|=r;var Y=Mz(x,k,r);$D(x,Y);break e;case 1:s=k;var te=x.type,de=x.stateNode;if(!(x.flags&128)&&(typeof te.getDerivedStateFromError=="function"||de!==null&&typeof de.componentDidCatch=="function"&&(eh===null||!eh.has(de)))){x.flags|=65536,r&=-r,x.lanes|=r;var Me=Rz(x,s,r);$D(x,Me);break e}}x=x.return}while(x!==null)}Yz(l)}catch(Le){r=Le,Rs===l&&l!==null&&(Rs=l=l.return);continue}break}while(!0)}function Zz(){var t=iw.current;return iw.current=rw,t===null?rw:t}function nI(){(Hs===0||Hs===3||Hs===2)&&(Hs=4),no===null||!(Qf&268435455)&&!(Ww&268435455)||Ld(no,mo)}function aw(t,r){var l=Mi;Mi|=2;var d=Zz();(no!==t||mo!==r)&&(pu=null,qf(t,r));do try{ZG();break}catch(_){Wz(t,_)}while(!0);if(FA(),Mi=l,iw.current=d,Rs!==null)throw Error(un(261));return no=null,mo=0,Hs}function ZG(){for(;Rs!==null;)Xz(Rs)}function XG(){for(;Rs!==null&&!x$();)Xz(Rs)}function Xz(t){var r=Qz(t.alternate,t,Ea);t.memoizedProps=t.pendingProps,r===null?Yz(t):Rs=r,KA.current=null}function Yz(t){var r=t;do{var l=r.alternate;if(t=r.return,r.flags&32768){if(l=UG(l,r),l!==null){l.flags&=32767,Rs=l;return}if(t!==null)t.flags|=32768,t.subtreeFlags=0,t.deletions=null;else{Hs=6,Rs=null;return}}else if(l=VG(l,r,Ea),l!==null){Rs=l;return}if(r=r.sibling,r!==null){Rs=r;return}Rs=r=t}while(r!==null);Hs===0&&(Hs=5)}function Lf(t,r,l){var d=Vi,_=Ya.transition;try{Ya.transition=null,Vi=1,YG(t,r,l,d)}finally{Ya.transition=_,Vi=d}return null}function YG(t,r,l,d){do pg();while(Wd!==null);if(Mi&6)throw Error(un(327));l=t.finishedWork;var _=t.finishedLanes;if(l===null)return null;if(t.finishedWork=null,t.finishedLanes=0,l===t.current)throw Error(un(177));t.callbackNode=null,t.callbackPriority=0;var x=l.lanes|l.childLanes;if(M$(t,x),t===no&&(Rs=no=null,mo=0),!(l.subtreeFlags&2064)&&!(l.flags&2064)||nb||(nb=!0,Jz(Ub,function(){return pg(),null})),x=(l.flags&15990)!==0,l.subtreeFlags&15990||x){x=Ya.transition,Ya.transition=null;var C=Vi;Vi=1;var s=Mi;Mi|=4,KA.current=null,GG(t,l),Gz(l,t),gG(WE),Gb=!!qE,WE=qE=null,t.current=l,HG(l),b$(),Mi=s,Vi=C,Ya.transition=x}else t.current=l;if(nb&&(nb=!1,Wd=t,ow=_),x=t.pendingLanes,x===0&&(eh=null),T$(l.stateNode),fa(t,Ts()),r!==null)for(d=t.onRecoverableError,l=0;l<r.length;l++)_=r[l],d(_.value,{componentStack:_.stack,digest:_.digest});if(sw)throw sw=!1,t=fC,fC=null,t;return ow&1&&t.tag!==0&&pg(),x=t.pendingLanes,x&1?t===pC?Mv++:(Mv=0,pC=t):Mv=0,yh(),null}function pg(){if(Wd!==null){var t=M3(ow),r=Ya.transition,l=Vi;try{if(Ya.transition=null,Vi=16>t?16:t,Wd===null)var d=!1;else{if(t=Wd,Wd=null,ow=0,Mi&6)throw Error(un(331));var _=Mi;for(Mi|=4,Wn=t.current;Wn!==null;){var x=Wn,C=x.child;if(Wn.flags&16){var s=x.deletions;if(s!==null){for(var k=0;k<s.length;k++){var z=s[k];for(Wn=z;Wn!==null;){var V=Wn;switch(V.tag){case 0:case 11:case 15:Iv(8,V,x)}var U=V.child;if(U!==null)U.return=V,Wn=U;else for(;Wn!==null;){V=Wn;var $=V.sibling,se=V.return;if(Vz(V),V===z){Wn=null;break}if($!==null){$.return=se,Wn=$;break}Wn=se}}}var ae=x.alternate;if(ae!==null){var H=ae.child;if(H!==null){ae.child=null;do{var ne=H.sibling;H.sibling=null,H=ne}while(H!==null)}}Wn=x}}if(x.subtreeFlags&2064&&C!==null)C.return=x,Wn=C;else e:for(;Wn!==null;){if(x=Wn,x.flags&2048)switch(x.tag){case 0:case 11:case 15:Iv(9,x,x.return)}var Y=x.sibling;if(Y!==null){Y.return=x.return,Wn=Y;break e}Wn=x.return}}var te=t.current;for(Wn=te;Wn!==null;){C=Wn;var de=C.child;if(C.subtreeFlags&2064&&de!==null)de.return=C,Wn=de;else e:for(C=te;Wn!==null;){if(s=Wn,s.flags&2048)try{switch(s.tag){case 0:case 11:case 15:qw(9,s)}}catch(Le){_s(s,s.return,Le)}if(s===C){Wn=null;break e}var Me=s.sibling;if(Me!==null){Me.return=s.return,Wn=Me;break e}Wn=s.return}}if(Mi=_,yh(),Ac&&typeof Ac.onPostCommitFiberRoot=="function")try{Ac.onPostCommitFiberRoot(Fw,t)}catch{}d=!0}return d}finally{Vi=l,Ya.transition=r}}return!1}function uL(t,r,l){r=Bg(l,r),r=Mz(t,r,1),t=Jd(t,r,1),r=Ho(),t!==null&&(Ax(t,1,r),fa(t,r))}function _s(t,r,l){if(t.tag===3)uL(t,t,l);else for(;r!==null;){if(r.tag===3){uL(r,t,l);break}else if(r.tag===1){var d=r.stateNode;if(typeof r.type.getDerivedStateFromError=="function"||typeof d.componentDidCatch=="function"&&(eh===null||!eh.has(d))){t=Bg(l,t),t=Rz(r,t,1),r=Jd(r,t,1),t=Ho(),r!==null&&(Ax(r,1,t),fa(r,t));break}}r=r.return}}function KG(t,r,l){var d=t.pingCache;d!==null&&d.delete(r),r=Ho(),t.pingedLanes|=t.suspendedLanes&l,no===t&&(mo&l)===l&&(Hs===4||Hs===3&&(mo&130023424)===mo&&500>Ts()-JA?qf(t,0):QA|=l),fa(t,r)}function Kz(t,r){r===0&&(t.mode&1?(r=q1,q1<<=1,!(q1&130023424)&&(q1=4194304)):r=1);var l=Ho();t=Eu(t,r),t!==null&&(Ax(t,r,l),fa(t,l))}function QG(t){var r=t.memoizedState,l=0;r!==null&&(l=r.retryLane),Kz(t,l)}function JG(t,r){var l=0;switch(t.tag){case 13:var d=t.stateNode,_=t.memoizedState;_!==null&&(l=_.retryLane);break;case 19:d=t.stateNode;break;default:throw Error(un(314))}d!==null&&d.delete(r),Kz(t,l)}var Qz;Qz=function(t,r,l){if(t!==null)if(t.memoizedProps!==r.pendingProps||da.current)ua=!0;else{if(!(t.lanes&l)&&!(r.flags&128))return ua=!1,BG(t,r,l);ua=!!(t.flags&131072)}else ua=!1,ss&&r.flags&1048576&&nz(r,Kb,r.index);switch(r.lanes=0,r.tag){case 2:var d=r.type;Tb(t,r),t=r.pendingProps;var _=zg(r,Po.current);fg(r,l),_=qA(null,r,d,t,_,l);var x=WA();return r.flags|=1,typeof _=="object"&&_!==null&&typeof _.render=="function"&&_.$$typeof===void 0?(r.tag=1,r.memoizedState=null,r.updateQueue=null,ha(d)?(x=!0,Xb(r)):x=!1,r.memoizedState=_.state!==null&&_.state!==void 0?_.state:null,VA(r),_.updater=Hw,r.stateNode=_,_._reactInternals=r,nC(r,d,t,l),r=sC(null,r,d,!0,x,l)):(r.tag=0,ss&&x&&LA(r),$o(null,r,_,l),r=r.child),r;case 16:d=r.elementType;e:{switch(Tb(t,r),t=r.pendingProps,_=d._init,d=_(d._payload),r.type=d,_=r.tag=t9(d),t=El(d,t),_){case 0:r=iC(null,r,d,t,l);break e;case 1:r=eL(null,r,d,t,l);break e;case 11:r=QD(null,r,d,t,l);break e;case 14:r=JD(null,r,d,El(d.type,t),l);break e}throw Error(un(306,d,""))}return r;case 0:return d=r.type,_=r.pendingProps,_=r.elementType===d?_:El(d,_),iC(t,r,d,_,l);case 1:return d=r.type,_=r.pendingProps,_=r.elementType===d?_:El(d,_),eL(t,r,d,_,l);case 3:e:{if(Nz(r),t===null)throw Error(un(387));d=r.pendingProps,x=r.memoizedState,_=x.element,lz(t,r),ew(r,d,null,l);var C=r.memoizedState;if(d=C.element,x.isDehydrated)if(x={element:d,isDehydrated:!1,cache:C.cache,pendingSuspenseBoundaries:C.pendingSuspenseBoundaries,transitions:C.transitions},r.updateQueue.baseState=x,r.memoizedState=x,r.flags&256){_=Bg(Error(un(423)),r),r=tL(t,r,d,l,_);break e}else if(d!==_){_=Bg(Error(un(424)),r),r=tL(t,r,d,l,_);break e}else for(Aa=Qd(r.stateNode.containerInfo.firstChild),Pa=r,ss=!0,Il=null,l=oz(r,null,d,l),r.child=l;l;)l.flags=l.flags&-3|4096,l=l.sibling;else{if(Og(),d===_){r=Cu(t,r,l);break e}$o(t,r,d,l)}r=r.child}return r;case 5:return cz(r),t===null&&JE(r),d=r.type,_=r.pendingProps,x=t!==null?t.memoizedProps:null,C=_.children,ZE(d,_)?C=null:x!==null&&ZE(d,x)&&(r.flags|=32),Lz(t,r),$o(t,r,C,l),r.child;case 6:return t===null&&JE(r),null;case 13:return zz(t,r,l);case 4:return UA(r,r.stateNode.containerInfo),d=r.pendingProps,t===null?r.child=Fg(r,null,d,l):$o(t,r,d,l),r.child;case 11:return d=r.type,_=r.pendingProps,_=r.elementType===d?_:El(d,_),QD(t,r,d,_,l);case 7:return $o(t,r,r.pendingProps,l),r.child;case 8:return $o(t,r,r.pendingProps.children,l),r.child;case 12:return $o(t,r,r.pendingProps.children,l),r.child;case 10:e:{if(d=r.type._context,_=r.pendingProps,x=r.memoizedProps,C=_.value,Xi(Qb,d._currentValue),d._currentValue=C,x!==null)if(Bl(x.value,C)){if(x.children===_.children&&!da.current){r=Cu(t,r,l);break e}}else for(x=r.child,x!==null&&(x.return=r);x!==null;){var s=x.dependencies;if(s!==null){C=x.child;for(var k=s.firstContext;k!==null;){if(k.context===d){if(x.tag===1){k=bu(-1,l&-l),k.tag=2;var z=x.updateQueue;if(z!==null){z=z.shared;var V=z.pending;V===null?k.next=k:(k.next=V.next,V.next=k),z.pending=k}}x.lanes|=l,k=x.alternate,k!==null&&(k.lanes|=l),eC(x.return,l,r),s.lanes|=l;break}k=k.next}}else if(x.tag===10)C=x.type===r.type?null:x.child;else if(x.tag===18){if(C=x.return,C===null)throw Error(un(341));C.lanes|=l,s=C.alternate,s!==null&&(s.lanes|=l),eC(C,l,r),C=x.sibling}else C=x.child;if(C!==null)C.return=x;else for(C=x;C!==null;){if(C===r){C=null;break}if(x=C.sibling,x!==null){x.return=C.return,C=x;break}C=C.return}x=C}$o(t,r,_.children,l),r=r.child}return r;case 9:return _=r.type,d=r.pendingProps.children,fg(r,l),_=Qa(_),d=d(_),r.flags|=1,$o(t,r,d,l),r.child;case 14:return d=r.type,_=El(d,r.pendingProps),_=El(d.type,_),JD(t,r,d,_,l);case 15:return kz(t,r,r.type,r.pendingProps,l);case 17:return d=r.type,_=r.pendingProps,_=r.elementType===d?_:El(d,_),Tb(t,r),r.tag=1,ha(d)?(t=!0,Xb(r)):t=!1,fg(r,l),Pz(r,d,_),nC(r,d,_,l),sC(null,r,d,!0,t,l);case 19:return Oz(t,r,l);case 22:return Dz(t,r,l)}throw Error(un(156,r.tag))};function Jz(t,r){return C3(t,r)}function e9(t,r,l,d){this.tag=t,this.key=l,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=r,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=d,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Xa(t,r,l,d){return new e9(t,r,l,d)}function rI(t){return t=t.prototype,!(!t||!t.isReactComponent)}function t9(t){if(typeof t=="function")return rI(t)?1:0;if(t!=null){if(t=t.$$typeof,t===wA)return 11;if(t===SA)return 14}return 2}function nh(t,r){var l=t.alternate;return l===null?(l=Xa(t.tag,r,t.key,t.mode),l.elementType=t.elementType,l.type=t.type,l.stateNode=t.stateNode,l.alternate=t,t.alternate=l):(l.pendingProps=r,l.type=t.type,l.flags=0,l.subtreeFlags=0,l.deletions=null),l.flags=t.flags&14680064,l.childLanes=t.childLanes,l.lanes=t.lanes,l.child=t.child,l.memoizedProps=t.memoizedProps,l.memoizedState=t.memoizedState,l.updateQueue=t.updateQueue,r=t.dependencies,l.dependencies=r===null?null:{lanes:r.lanes,firstContext:r.firstContext},l.sibling=t.sibling,l.index=t.index,l.ref=t.ref,l}function Ab(t,r,l,d,_,x){var C=2;if(d=t,typeof t=="function")rI(t)&&(C=1);else if(typeof t=="string")C=5;else e:switch(t){case Ym:return Wf(l.children,_,x,r);case bA:C=8,_|=8;break;case CE:return t=Xa(12,l,r,_|2),t.elementType=CE,t.lanes=x,t;case AE:return t=Xa(13,l,r,_),t.elementType=AE,t.lanes=x,t;case IE:return t=Xa(19,l,r,_),t.elementType=IE,t.lanes=x,t;case c3:return Zw(l,_,x,r);default:if(typeof t=="object"&&t!==null)switch(t.$$typeof){case a3:C=10;break e;case l3:C=9;break e;case wA:C=11;break e;case SA:C=14;break e;case Rd:C=16,d=null;break e}throw Error(un(130,t==null?t:typeof t,""))}return r=Xa(C,l,r,_),r.elementType=t,r.type=d,r.lanes=x,r}function Wf(t,r,l,d){return t=Xa(7,t,d,r),t.lanes=l,t}function Zw(t,r,l,d){return t=Xa(22,t,d,r),t.elementType=c3,t.lanes=l,t.stateNode={isHidden:!1},t}function rE(t,r,l){return t=Xa(6,t,null,r),t.lanes=l,t}function iE(t,r,l){return r=Xa(4,t.children!==null?t.children:[],t.key,r),r.lanes=l,r.stateNode={containerInfo:t.containerInfo,pendingChildren:null,implementation:t.implementation},r}function n9(t,r,l,d,_){this.tag=r,this.containerInfo=t,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=FT(0),this.expirationTimes=FT(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=FT(0),this.identifierPrefix=d,this.onRecoverableError=_,this.mutableSourceEagerHydrationData=null}function iI(t,r,l,d,_,x,C,s,k){return t=new n9(t,r,l,s,k),r===1?(r=1,x===!0&&(r|=8)):r=0,x=Xa(3,null,null,r),t.current=x,x.stateNode=t,x.memoizedState={element:d,isDehydrated:l,cache:null,transitions:null,pendingSuspenseBoundaries:null},VA(x),t}function r9(t,r,l){var d=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:Xm,key:d==null?null:""+d,children:t,containerInfo:r,implementation:l}}function eO(t){if(!t)return oh;t=t._reactInternals;e:{if(gp(t)!==t||t.tag!==1)throw Error(un(170));var r=t;do{switch(r.tag){case 3:r=r.stateNode.context;break e;case 1:if(ha(r.type)){r=r.stateNode.__reactInternalMemoizedMergedChildContext;break e}}r=r.return}while(r!==null);throw Error(un(171))}if(t.tag===1){var l=t.type;if(ha(l))return ez(t,l,r)}return r}function tO(t,r,l,d,_,x,C,s,k){return t=iI(l,d,!0,t,_,x,C,s,k),t.context=eO(null),l=t.current,d=Ho(),_=th(l),x=bu(d,_),x.callback=r??null,Jd(l,x,_),t.current.lanes=_,Ax(t,_,d),fa(t,d),t}function Xw(t,r,l,d){var _=r.current,x=Ho(),C=th(_);return l=eO(l),r.context===null?r.context=l:r.pendingContext=l,r=bu(x,C),r.payload={element:t},d=d===void 0?null:d,d!==null&&(r.callback=d),t=Jd(_,r,C),t!==null&&(zl(t,_,C,x),bb(t,_,C)),C}function lw(t){if(t=t.current,!t.child)return null;switch(t.child.tag){case 5:return t.child.stateNode;default:return t.child.stateNode}}function dL(t,r){if(t=t.memoizedState,t!==null&&t.dehydrated!==null){var l=t.retryLane;t.retryLane=l!==0&&l<r?l:r}}function sI(t,r){dL(t,r),(t=t.alternate)&&dL(t,r)}function i9(){return null}var nO=typeof reportError=="function"?reportError:function(t){console.error(t)};function oI(t){this._internalRoot=t}Yw.prototype.render=oI.prototype.render=function(t){var r=this._internalRoot;if(r===null)throw Error(un(409));Xw(t,r,null,null)};Yw.prototype.unmount=oI.prototype.unmount=function(){var t=this._internalRoot;if(t!==null){this._internalRoot=null;var r=t.containerInfo;Jf(function(){Xw(null,t,null,null)}),r[Tu]=null}};function Yw(t){this._internalRoot=t}Yw.prototype.unstable_scheduleHydration=function(t){if(t){var r=D3();t={blockedOn:null,target:t,priority:r};for(var l=0;l<Dd.length&&r!==0&&r<Dd[l].priority;l++);Dd.splice(l,0,t),l===0&&N3(t)}};function aI(t){return!(!t||t.nodeType!==1&&t.nodeType!==9&&t.nodeType!==11)}function Kw(t){return!(!t||t.nodeType!==1&&t.nodeType!==9&&t.nodeType!==11&&(t.nodeType!==8||t.nodeValue!==" react-mount-point-unstable "))}function hL(){}function s9(t,r,l,d,_){if(_){if(typeof d=="function"){var x=d;d=function(){var z=lw(C);x.call(z)}}var C=tO(r,d,t,0,null,!1,!1,"",hL);return t._reactRootContainer=C,t[Tu]=C.current,$v(t.nodeType===8?t.parentNode:t),Jf(),C}for(;_=t.lastChild;)t.removeChild(_);if(typeof d=="function"){var s=d;d=function(){var z=lw(k);s.call(z)}}var k=iI(t,0,!1,null,null,!1,!1,"",hL);return t._reactRootContainer=k,t[Tu]=k.current,$v(t.nodeType===8?t.parentNode:t),Jf(function(){Xw(r,k,l,d)}),k}function Qw(t,r,l,d,_){var x=l._reactRootContainer;if(x){var C=x;if(typeof _=="function"){var s=_;_=function(){var k=lw(C);s.call(k)}}Xw(r,C,t,_)}else C=s9(l,r,t,_,d);return lw(C)}R3=function(t){switch(t.tag){case 3:var r=t.stateNode;if(r.current.memoizedState.isDehydrated){var l=mv(r.pendingLanes);l!==0&&(CA(r,l|1),fa(r,Ts()),!(Mi&6)&&(Vg=Ts()+500,yh()))}break;case 13:Jf(function(){var d=Eu(t,1);if(d!==null){var _=Ho();zl(d,t,1,_)}}),sI(t,1)}};AA=function(t){if(t.tag===13){var r=Eu(t,134217728);if(r!==null){var l=Ho();zl(r,t,134217728,l)}sI(t,134217728)}};k3=function(t){if(t.tag===13){var r=th(t),l=Eu(t,r);if(l!==null){var d=Ho();zl(l,t,r,d)}sI(t,r)}};D3=function(){return Vi};L3=function(t,r){var l=Vi;try{return Vi=t,r()}finally{Vi=l}};FE=function(t,r,l){switch(r){case"input":if(RE(t,l),r=l.name,l.type==="radio"&&r!=null){for(l=t;l.parentNode;)l=l.parentNode;for(l=l.querySelectorAll("input[name="+JSON.stringify(""+r)+'][type="radio"]'),r=0;r<l.length;r++){var d=l[r];if(d!==t&&d.form===t.form){var _=Uw(d);if(!_)throw Error(un(90));d3(d),RE(d,_)}}}break;case"textarea":f3(t,l);break;case"select":r=l.value,r!=null&&cg(t,!!l.multiple,r,!1)}};x3=eI;b3=Jf;var o9={usingClientEntryPoint:!1,Events:[Px,eg,Uw,y3,v3,eI]},ov={findFiberByHostInstance:Nf,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},a9={bundleType:ov.bundleType,version:ov.version,rendererPackageName:ov.rendererPackageName,rendererConfig:ov.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:Ru.ReactCurrentDispatcher,findHostInstanceByFiber:function(t){return t=T3(t),t===null?null:t.stateNode},findFiberByHostInstance:ov.findFiberByHostInstance||i9,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var rb=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!rb.isDisabled&&rb.supportsFiber)try{Fw=rb.inject(a9),Ac=rb}catch{}}La.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=o9;La.createPortal=function(t,r){var l=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!aI(r))throw Error(un(200));return r9(t,r,null,l)};La.createRoot=function(t,r){if(!aI(t))throw Error(un(299));var l=!1,d="",_=nO;return r!=null&&(r.unstable_strictMode===!0&&(l=!0),r.identifierPrefix!==void 0&&(d=r.identifierPrefix),r.onRecoverableError!==void 0&&(_=r.onRecoverableError)),r=iI(t,1,!1,null,null,l,!1,d,_),t[Tu]=r.current,$v(t.nodeType===8?t.parentNode:t),new oI(r)};La.findDOMNode=function(t){if(t==null)return null;if(t.nodeType===1)return t;var r=t._reactInternals;if(r===void 0)throw typeof t.render=="function"?Error(un(188)):(t=Object.keys(t).join(","),Error(un(268,t)));return t=T3(r),t=t===null?null:t.stateNode,t};La.flushSync=function(t){return Jf(t)};La.hydrate=function(t,r,l){if(!Kw(r))throw Error(un(200));return Qw(null,t,r,!0,l)};La.hydrateRoot=function(t,r,l){if(!aI(t))throw Error(un(405));var d=l!=null&&l.hydratedSources||null,_=!1,x="",C=nO;if(l!=null&&(l.unstable_strictMode===!0&&(_=!0),l.identifierPrefix!==void 0&&(x=l.identifierPrefix),l.onRecoverableError!==void 0&&(C=l.onRecoverableError)),r=tO(r,null,t,1,l??null,_,!1,x,C),t[Tu]=r.current,$v(t),d)for(t=0;t<d.length;t++)l=d[t],_=l._getVersion,_=_(l._source),r.mutableSourceEagerHydrationData==null?r.mutableSourceEagerHydrationData=[l,_]:r.mutableSourceEagerHydrationData.push(l,_);return new Yw(r)};La.render=function(t,r,l){if(!Kw(r))throw Error(un(200));return Qw(null,t,r,!1,l)};La.unmountComponentAtNode=function(t){if(!Kw(t))throw Error(un(40));return t._reactRootContainer?(Jf(function(){Qw(null,null,t,!1,function(){t._reactRootContainer=null,t[Tu]=null})}),!0):!1};La.unstable_batchedUpdates=eI;La.unstable_renderSubtreeIntoContainer=function(t,r,l,d){if(!Kw(l))throw Error(un(200));if(t==null||t._reactInternals===void 0)throw Error(un(38));return Qw(t,r,l,!1,d)};La.version="18.3.1-next-f1338f8080-20240426";function rO(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(rO)}catch(t){console.error(t)}}rO(),r3.exports=La;var _p=r3.exports;const iO=zw(_p);var sO,fL=_p;sO=fL.createRoot,fL.hydrateRoot;const l9=1,c9=1e6;let sE=0;function u9(){return sE=(sE+1)%Number.MAX_SAFE_INTEGER,sE.toString()}const oE=new Map,pL=t=>{if(oE.has(t))return;const r=setTimeout(()=>{oE.delete(t),Rv({type:"REMOVE_TOAST",toastId:t})},c9);oE.set(t,r)},d9=(t,r)=>{switch(r.type){case"ADD_TOAST":return{...t,toasts:[r.toast,...t.toasts].slice(0,l9)};case"UPDATE_TOAST":return{...t,toasts:t.toasts.map(l=>l.id===r.toast.id?{...l,...r.toast}:l)};case"DISMISS_TOAST":{const{toastId:l}=r;return l?pL(l):t.toasts.forEach(d=>{pL(d.id)}),{...t,toasts:t.toasts.map(d=>d.id===l||l===void 0?{...d,open:!1}:d)}}case"REMOVE_TOAST":return r.toastId===void 0?{...t,toasts:[]}:{...t,toasts:t.toasts.filter(l=>l.id!==r.toastId)}}},Ib=[];let Pb={toasts:[]};function Rv(t){Pb=d9(Pb,t),Ib.forEach(r=>{r(Pb)})}function h9({...t}){const r=u9(),l=_=>Rv({type:"UPDATE_TOAST",toast:{..._,id:r}}),d=()=>Rv({type:"DISMISS_TOAST",toastId:r});return Rv({type:"ADD_TOAST",toast:{...t,id:r,open:!0,onOpenChange:_=>{_||d()}}}),{id:r,dismiss:d,update:l}}function yp(){const[t,r]=B.useState(Pb);return B.useEffect(()=>(Ib.push(r),()=>{const l=Ib.indexOf(r);l>-1&&Ib.splice(l,1)}),[t]),{...t,toast:h9,dismiss:l=>Rv({type:"DISMISS_TOAST",toastId:l})}}function mn(t,r,{checkForDefaultPrevented:l=!0}={}){return function(_){if(t==null||t(_),l===!1||!_.defaultPrevented)return r==null?void 0:r(_)}}function f9(t,r){typeof t=="function"?t(r):t!=null&&(t.current=r)}function Jw(...t){return r=>t.forEach(l=>f9(l,r))}function ni(...t){return B.useCallback(Jw(...t),t)}function p9(t,r=[]){let l=[];function d(x,C){const s=B.createContext(C),k=l.length;l=[...l,C];function z(U){const{scope:$,children:se,...ae}=U,H=($==null?void 0:$[t][k])||s,ne=B.useMemo(()=>ae,Object.values(ae));return w.jsx(H.Provider,{value:ne,children:se})}function V(U,$){const se=($==null?void 0:$[t][k])||s,ae=B.useContext(se);if(ae)return ae;if(C!==void 0)return C;throw new Error(`\`${U}\` must be used within \`${x}\``)}return z.displayName=x+"Provider",[z,V]}const _=()=>{const x=l.map(C=>B.createContext(C));return function(s){const k=(s==null?void 0:s[t])||x;return B.useMemo(()=>({[`__scope${t}`]:{...s,[t]:k}}),[s,k])}};return _.scopeName=t,[d,m9(_,...r)]}function m9(...t){const r=t[0];if(t.length===1)return r;const l=()=>{const d=t.map(_=>({useScope:_(),scopeName:_.scopeName}));return function(x){const C=d.reduce((s,{useScope:k,scopeName:z})=>{const U=k(x)[`__scope${z}`];return{...s,...U}},{});return B.useMemo(()=>({[`__scope${r.scopeName}`]:C}),[C])}};return l.scopeName=r.scopeName,l}var Rc=B.forwardRef((t,r)=>{const{children:l,...d}=t,_=B.Children.toArray(l),x=_.find(g9);if(x){const C=x.props.children,s=_.map(k=>k===x?B.Children.count(C)>1?B.Children.only(null):B.isValidElement(C)?C.props.children:null:k);return w.jsx(_C,{...d,ref:r,children:B.isValidElement(C)?B.cloneElement(C,void 0,s):null})}return w.jsx(_C,{...d,ref:r,children:l})});Rc.displayName="Slot";var _C=B.forwardRef((t,r)=>{const{children:l,...d}=t;if(B.isValidElement(l)){const _=y9(l);return B.cloneElement(l,{..._9(d,l.props),ref:r?Jw(r,_):_})}return B.Children.count(l)>1?B.Children.only(null):null});_C.displayName="SlotClone";var oO=({children:t})=>w.jsx(w.Fragment,{children:t});function g9(t){return B.isValidElement(t)&&t.type===oO}function _9(t,r){const l={...r};for(const d in r){const _=t[d],x=r[d];/^on[A-Z]/.test(d)?_&&x?l[d]=(...s)=>{x(...s),_(...s)}:_&&(l[d]=_):d==="style"?l[d]={..._,...x}:d==="className"&&(l[d]=[_,x].filter(Boolean).join(" "))}return{...t,...l}}function y9(t){var d,_;let r=(d=Object.getOwnPropertyDescriptor(t.props,"ref"))==null?void 0:d.get,l=r&&"isReactWarning"in r&&r.isReactWarning;return l?t.ref:(r=(_=Object.getOwnPropertyDescriptor(t,"ref"))==null?void 0:_.get,l=r&&"isReactWarning"in r&&r.isReactWarning,l?t.props.ref:t.props.ref||t.ref)}function e2(t){const r=t+"CollectionProvider",[l,d]=p9(r),[_,x]=l(r,{collectionRef:{current:null},itemMap:new Map}),C=se=>{const{scope:ae,children:H}=se,ne=Nt.useRef(null),Y=Nt.useRef(new Map).current;return w.jsx(_,{scope:ae,itemMap:Y,collectionRef:ne,children:H})};C.displayName=r;const s=t+"CollectionSlot",k=Nt.forwardRef((se,ae)=>{const{scope:H,children:ne}=se,Y=x(s,H),te=ni(ae,Y.collectionRef);return w.jsx(Rc,{ref:te,children:ne})});k.displayName=s;const z=t+"CollectionItemSlot",V="data-radix-collection-item",U=Nt.forwardRef((se,ae)=>{const{scope:H,children:ne,...Y}=se,te=Nt.useRef(null),de=ni(ae,te),Me=x(z,H);return Nt.useEffect(()=>(Me.itemMap.set(te,{ref:te,...Y}),()=>void Me.itemMap.delete(te))),w.jsx(Rc,{[V]:"",ref:de,children:ne})});U.displayName=z;function $(se){const ae=x(t+"CollectionConsumer",se);return Nt.useCallback(()=>{const ne=ae.collectionRef.current;if(!ne)return[];const Y=Array.from(ne.querySelectorAll(`[${V}]`));return Array.from(ae.itemMap.values()).sort((Me,Le)=>Y.indexOf(Me.ref.current)-Y.indexOf(Le.ref.current))},[ae.collectionRef,ae.itemMap])}return[{Provider:C,Slot:k,ItemSlot:U},$,d]}function v9(t,r){const l=B.createContext(r),d=x=>{const{children:C,...s}=x,k=B.useMemo(()=>s,Object.values(s));return w.jsx(l.Provider,{value:k,children:C})};d.displayName=t+"Provider";function _(x){const C=B.useContext(l);if(C)return C;if(r!==void 0)return r;throw new Error(`\`${x}\` must be used within \`${t}\``)}return[d,_]}function Gl(t,r=[]){let l=[];function d(x,C){const s=B.createContext(C),k=l.length;l=[...l,C];const z=U=>{var Y;const{scope:$,children:se,...ae}=U,H=((Y=$==null?void 0:$[t])==null?void 0:Y[k])||s,ne=B.useMemo(()=>ae,Object.values(ae));return w.jsx(H.Provider,{value:ne,children:se})};z.displayName=x+"Provider";function V(U,$){var H;const se=((H=$==null?void 0:$[t])==null?void 0:H[k])||s,ae=B.useContext(se);if(ae)return ae;if(C!==void 0)return C;throw new Error(`\`${U}\` must be used within \`${x}\``)}return[z,V]}const _=()=>{const x=l.map(C=>B.createContext(C));return function(s){const k=(s==null?void 0:s[t])||x;return B.useMemo(()=>({[`__scope${t}`]:{...s,[t]:k}}),[s,k])}};return _.scopeName=t,[d,x9(_,...r)]}function x9(...t){const r=t[0];if(t.length===1)return r;const l=()=>{const d=t.map(_=>({useScope:_(),scopeName:_.scopeName}));return function(x){const C=d.reduce((s,{useScope:k,scopeName:z})=>{const U=k(x)[`__scope${z}`];return{...s,...U}},{});return B.useMemo(()=>({[`__scope${r.scopeName}`]:C}),[C])}};return l.scopeName=r.scopeName,l}var b9=["a","button","div","form","h2","h3","img","input","label","li","nav","ol","p","span","svg","ul"],ir=b9.reduce((t,r)=>{const l=B.forwardRef((d,_)=>{const{asChild:x,...C}=d,s=x?Rc:r;return typeof window<"u"&&(window[Symbol.for("radix-ui")]=!0),w.jsx(s,{...C,ref:_})});return l.displayName=`Primitive.${r}`,{...t,[r]:l}},{});function lI(t,r){t&&_p.flushSync(()=>t.dispatchEvent(r))}function os(t){const r=B.useRef(t);return B.useEffect(()=>{r.current=t}),B.useMemo(()=>(...l)=>{var d;return(d=r.current)==null?void 0:d.call(r,...l)},[])}function w9(t,r=globalThis==null?void 0:globalThis.document){const l=os(t);B.useEffect(()=>{const d=_=>{_.key==="Escape"&&l(_)};return r.addEventListener("keydown",d,{capture:!0}),()=>r.removeEventListener("keydown",d,{capture:!0})},[l,r])}var S9="DismissableLayer",yC="dismissableLayer.update",T9="dismissableLayer.pointerDownOutside",E9="dismissableLayer.focusOutside",mL,aO=B.createContext({layers:new Set,layersWithOutsidePointerEventsDisabled:new Set,branches:new Set}),vp=B.forwardRef((t,r)=>{const{disableOutsidePointerEvents:l=!1,onEscapeKeyDown:d,onPointerDownOutside:_,onFocusOutside:x,onInteractOutside:C,onDismiss:s,...k}=t,z=B.useContext(aO),[V,U]=B.useState(null),$=(V==null?void 0:V.ownerDocument)??(globalThis==null?void 0:globalThis.document),[,se]=B.useState({}),ae=ni(r,Pe=>U(Pe)),H=Array.from(z.layers),[ne]=[...z.layersWithOutsidePointerEventsDisabled].slice(-1),Y=H.indexOf(ne),te=V?H.indexOf(V):-1,de=z.layersWithOutsidePointerEventsDisabled.size>0,Me=te>=Y,Le=A9(Pe=>{const Ye=Pe.target,vt=[...z.branches].some(It=>It.contains(Ye));!Me||vt||(_==null||_(Pe),C==null||C(Pe),Pe.defaultPrevented||s==null||s())},$),lt=I9(Pe=>{const Ye=Pe.target;[...z.branches].some(It=>It.contains(Ye))||(x==null||x(Pe),C==null||C(Pe),Pe.defaultPrevented||s==null||s())},$);return w9(Pe=>{te===z.layers.size-1&&(d==null||d(Pe),!Pe.defaultPrevented&&s&&(Pe.preventDefault(),s()))},$),B.useEffect(()=>{if(V)return l&&(z.layersWithOutsidePointerEventsDisabled.size===0&&(mL=$.body.style.pointerEvents,$.body.style.pointerEvents="none"),z.layersWithOutsidePointerEventsDisabled.add(V)),z.layers.add(V),gL(),()=>{l&&z.layersWithOutsidePointerEventsDisabled.size===1&&($.body.style.pointerEvents=mL)}},[V,$,l,z]),B.useEffect(()=>()=>{V&&(z.layers.delete(V),z.layersWithOutsidePointerEventsDisabled.delete(V),gL())},[V,z]),B.useEffect(()=>{const Pe=()=>se({});return document.addEventListener(yC,Pe),()=>document.removeEventListener(yC,Pe)},[]),w.jsx(ir.div,{...k,ref:ae,style:{pointerEvents:de?Me?"auto":"none":void 0,...t.style},onFocusCapture:mn(t.onFocusCapture,lt.onFocusCapture),onBlurCapture:mn(t.onBlurCapture,lt.onBlurCapture),onPointerDownCapture:mn(t.onPointerDownCapture,Le.onPointerDownCapture)})});vp.displayName=S9;var C9="DismissableLayerBranch",lO=B.forwardRef((t,r)=>{const l=B.useContext(aO),d=B.useRef(null),_=ni(r,d);return B.useEffect(()=>{const x=d.current;if(x)return l.branches.add(x),()=>{l.branches.delete(x)}},[l.branches]),w.jsx(ir.div,{...t,ref:_})});lO.displayName=C9;function A9(t,r=globalThis==null?void 0:globalThis.document){const l=os(t),d=B.useRef(!1),_=B.useRef(()=>{});return B.useEffect(()=>{const x=s=>{if(s.target&&!d.current){let k=function(){cO(T9,l,z,{discrete:!0})};const z={originalEvent:s};s.pointerType==="touch"?(r.removeEventListener("click",_.current),_.current=k,r.addEventListener("click",_.current,{once:!0})):k()}else r.removeEventListener("click",_.current);d.current=!1},C=window.setTimeout(()=>{r.addEventListener("pointerdown",x)},0);return()=>{window.clearTimeout(C),r.removeEventListener("pointerdown",x),r.removeEventListener("click",_.current)}},[r,l]),{onPointerDownCapture:()=>d.current=!0}}function I9(t,r=globalThis==null?void 0:globalThis.document){const l=os(t),d=B.useRef(!1);return B.useEffect(()=>{const _=x=>{x.target&&!d.current&&cO(E9,l,{originalEvent:x},{discrete:!1})};return r.addEventListener("focusin",_),()=>r.removeEventListener("focusin",_)},[r,l]),{onFocusCapture:()=>d.current=!0,onBlurCapture:()=>d.current=!1}}function gL(){const t=new CustomEvent(yC);document.dispatchEvent(t)}function cO(t,r,l,{discrete:d}){const _=l.originalEvent.target,x=new CustomEvent(t,{bubbles:!1,cancelable:!0,detail:l});r&&_.addEventListener(t,r,{once:!0}),d?lI(_,x):_.dispatchEvent(x)}var P9=vp,M9=lO,qs=globalThis!=null&&globalThis.document?B.useLayoutEffect:()=>{},R9="Portal",n_=B.forwardRef((t,r)=>{var s;const{container:l,...d}=t,[_,x]=B.useState(!1);qs(()=>x(!0),[]);const C=l||_&&((s=globalThis==null?void 0:globalThis.document)==null?void 0:s.body);return C?iO.createPortal(w.jsx(ir.div,{...d,ref:r}),C):null});n_.displayName=R9;function k9(t,r){return B.useReducer((l,d)=>r[l][d]??l,t)}var io=t=>{const{present:r,children:l}=t,d=D9(r),_=typeof l=="function"?l({present:d.isPresent}):B.Children.only(l),x=ni(d.ref,L9(_));return typeof l=="function"||d.isPresent?B.cloneElement(_,{ref:x}):null};io.displayName="Presence";function D9(t){const[r,l]=B.useState(),d=B.useRef({}),_=B.useRef(t),x=B.useRef("none"),C=t?"mounted":"unmounted",[s,k]=k9(C,{mounted:{UNMOUNT:"unmounted",ANIMATION_OUT:"unmountSuspended"},unmountSuspended:{MOUNT:"mounted",ANIMATION_END:"unmounted"},unmounted:{MOUNT:"mounted"}});return B.useEffect(()=>{const z=ib(d.current);x.current=s==="mounted"?z:"none"},[s]),qs(()=>{const z=d.current,V=_.current;if(V!==t){const $=x.current,se=ib(z);t?k("MOUNT"):se==="none"||(z==null?void 0:z.display)==="none"?k("UNMOUNT"):k(V&&$!==se?"ANIMATION_OUT":"UNMOUNT"),_.current=t}},[t,k]),qs(()=>{if(r){let z;const V=r.ownerDocument.defaultView??window,U=se=>{const H=ib(d.current).includes(se.animationName);if(se.target===r&&H&&(k("ANIMATION_END"),!_.current)){const ne=r.style.animationFillMode;r.style.animationFillMode="forwards",z=V.setTimeout(()=>{r.style.animationFillMode==="forwards"&&(r.style.animationFillMode=ne)})}},$=se=>{se.target===r&&(x.current=ib(d.current))};return r.addEventListener("animationstart",$),r.addEventListener("animationcancel",U),r.addEventListener("animationend",U),()=>{V.clearTimeout(z),r.removeEventListener("animationstart",$),r.removeEventListener("animationcancel",U),r.removeEventListener("animationend",U)}}else k("ANIMATION_END")},[r,k]),{isPresent:["mounted","unmountSuspended"].includes(s),ref:B.useCallback(z=>{z&&(d.current=getComputedStyle(z)),l(z)},[])}}function ib(t){return(t==null?void 0:t.animationName)||"none"}function L9(t){var d,_;let r=(d=Object.getOwnPropertyDescriptor(t.props,"ref"))==null?void 0:d.get,l=r&&"isReactWarning"in r&&r.isReactWarning;return l?t.ref:(r=(_=Object.getOwnPropertyDescriptor(t,"ref"))==null?void 0:_.get,l=r&&"isReactWarning"in r&&r.isReactWarning,l?t.props.ref:t.props.ref||t.ref)}function kc({prop:t,defaultProp:r,onChange:l=()=>{}}){const[d,_]=N9({defaultProp:r,onChange:l}),x=t!==void 0,C=x?t:d,s=os(l),k=B.useCallback(z=>{if(x){const U=typeof z=="function"?z(t):z;U!==t&&s(U)}else _(z)},[x,t,_,s]);return[C,k]}function N9({defaultProp:t,onChange:r}){const l=B.useState(t),[d]=l,_=B.useRef(d),x=os(r);return B.useEffect(()=>{_.current!==d&&(x(d),_.current=d)},[d,_,x]),l}var z9="VisuallyHidden",Rx=B.forwardRef((t,r)=>w.jsx(ir.span,{...t,ref:r,style:{position:"absolute",border:0,width:1,height:1,padding:0,margin:-1,overflow:"hidden",clip:"rect(0, 0, 0, 0)",whiteSpace:"nowrap",wordWrap:"normal",...t.style}}));Rx.displayName=z9;var O9=Rx,cI="ToastProvider",[uI,F9,j9]=e2("Toast"),[uO,Hte]=Gl("Toast",[j9]),[B9,t2]=uO(cI),dO=t=>{const{__scopeToast:r,label:l="Notification",duration:d=5e3,swipeDirection:_="right",swipeThreshold:x=50,children:C}=t,[s,k]=B.useState(null),[z,V]=B.useState(0),U=B.useRef(!1),$=B.useRef(!1);return l.trim()||console.error(`Invalid prop \`label\` supplied to \`${cI}\`. Expected non-empty \`string\`.`),w.jsx(uI.Provider,{scope:r,children:w.jsx(B9,{scope:r,label:l,duration:d,swipeDirection:_,swipeThreshold:x,toastCount:z,viewport:s,onViewportChange:k,onToastAdd:B.useCallback(()=>V(se=>se+1),[]),onToastRemove:B.useCallback(()=>V(se=>se-1),[]),isFocusedToastEscapeKeyDownRef:U,isClosePausedRef:$,children:C})})};dO.displayName=cI;var hO="ToastViewport",V9=["F8"],vC="toast.viewportPause",xC="toast.viewportResume",fO=B.forwardRef((t,r)=>{const{__scopeToast:l,hotkey:d=V9,label:_="Notifications ({hotkey})",...x}=t,C=t2(hO,l),s=F9(l),k=B.useRef(null),z=B.useRef(null),V=B.useRef(null),U=B.useRef(null),$=ni(r,U,C.onViewportChange),se=d.join("+").replace(/Key/g,"").replace(/Digit/g,""),ae=C.toastCount>0;B.useEffect(()=>{const ne=Y=>{var de;d.length!==0&&d.every(Me=>Y[Me]||Y.code===Me)&&((de=U.current)==null||de.focus())};return document.addEventListener("keydown",ne),()=>document.removeEventListener("keydown",ne)},[d]),B.useEffect(()=>{const ne=k.current,Y=U.current;if(ae&&ne&&Y){const te=()=>{if(!C.isClosePausedRef.current){const lt=new CustomEvent(vC);Y.dispatchEvent(lt),C.isClosePausedRef.current=!0}},de=()=>{if(C.isClosePausedRef.current){const lt=new CustomEvent(xC);Y.dispatchEvent(lt),C.isClosePausedRef.current=!1}},Me=lt=>{!ne.contains(lt.relatedTarget)&&de()},Le=()=>{ne.contains(document.activeElement)||de()};return ne.addEventListener("focusin",te),ne.addEventListener("focusout",Me),ne.addEventListener("pointermove",te),ne.addEventListener("pointerleave",Le),window.addEventListener("blur",te),window.addEventListener("focus",de),()=>{ne.removeEventListener("focusin",te),ne.removeEventListener("focusout",Me),ne.removeEventListener("pointermove",te),ne.removeEventListener("pointerleave",Le),window.removeEventListener("blur",te),window.removeEventListener("focus",de)}}},[ae,C.isClosePausedRef]);const H=B.useCallback(({tabbingDirection:ne})=>{const te=s().map(de=>{const Me=de.ref.current,Le=[Me,...e7(Me)];return ne==="forwards"?Le:Le.reverse()});return(ne==="forwards"?te.reverse():te).flat()},[s]);return B.useEffect(()=>{const ne=U.current;if(ne){const Y=te=>{var Le,lt,Pe;const de=te.altKey||te.ctrlKey||te.metaKey;if(te.key==="Tab"&&!de){const Ye=document.activeElement,vt=te.shiftKey;if(te.target===ne&&vt){(Le=z.current)==null||Le.focus();return}const Pt=H({tabbingDirection:vt?"backwards":"forwards"}),$t=Pt.findIndex(Ve=>Ve===Ye);aE(Pt.slice($t+1))?te.preventDefault():vt?(lt=z.current)==null||lt.focus():(Pe=V.current)==null||Pe.focus()}};return ne.addEventListener("keydown",Y),()=>ne.removeEventListener("keydown",Y)}},[s,H]),w.jsxs(M9,{ref:k,role:"region","aria-label":_.replace("{hotkey}",se),tabIndex:-1,style:{pointerEvents:ae?void 0:"none"},children:[ae&&w.jsx(bC,{ref:z,onFocusFromOutsideViewport:()=>{const ne=H({tabbingDirection:"forwards"});aE(ne)}}),w.jsx(uI.Slot,{scope:l,children:w.jsx(ir.ol,{tabIndex:-1,...x,ref:$})}),ae&&w.jsx(bC,{ref:V,onFocusFromOutsideViewport:()=>{const ne=H({tabbingDirection:"backwards"});aE(ne)}})]})});fO.displayName=hO;var pO="ToastFocusProxy",bC=B.forwardRef((t,r)=>{const{__scopeToast:l,onFocusFromOutsideViewport:d,..._}=t,x=t2(pO,l);return w.jsx(Rx,{"aria-hidden":!0,tabIndex:0,..._,ref:r,style:{position:"fixed"},onFocus:C=>{var z;const s=C.relatedTarget;!((z=x.viewport)!=null&&z.contains(s))&&d()}})});bC.displayName=pO;var n2="Toast",U9="toast.swipeStart",$9="toast.swipeMove",G9="toast.swipeCancel",H9="toast.swipeEnd",mO=B.forwardRef((t,r)=>{const{forceMount:l,open:d,defaultOpen:_,onOpenChange:x,...C}=t,[s=!0,k]=kc({prop:d,defaultProp:_,onChange:x});return w.jsx(io,{present:l||s,children:w.jsx(Z9,{open:s,...C,ref:r,onClose:()=>k(!1),onPause:os(t.onPause),onResume:os(t.onResume),onSwipeStart:mn(t.onSwipeStart,z=>{z.currentTarget.setAttribute("data-swipe","start")}),onSwipeMove:mn(t.onSwipeMove,z=>{const{x:V,y:U}=z.detail.delta;z.currentTarget.setAttribute("data-swipe","move"),z.currentTarget.style.setProperty("--radix-toast-swipe-move-x",`${V}px`),z.currentTarget.style.setProperty("--radix-toast-swipe-move-y",`${U}px`)}),onSwipeCancel:mn(t.onSwipeCancel,z=>{z.currentTarget.setAttribute("data-swipe","cancel"),z.currentTarget.style.removeProperty("--radix-toast-swipe-move-x"),z.currentTarget.style.removeProperty("--radix-toast-swipe-move-y"),z.currentTarget.style.removeProperty("--radix-toast-swipe-end-x"),z.currentTarget.style.removeProperty("--radix-toast-swipe-end-y")}),onSwipeEnd:mn(t.onSwipeEnd,z=>{const{x:V,y:U}=z.detail.delta;z.currentTarget.setAttribute("data-swipe","end"),z.currentTarget.style.removeProperty("--radix-toast-swipe-move-x"),z.currentTarget.style.removeProperty("--radix-toast-swipe-move-y"),z.currentTarget.style.setProperty("--radix-toast-swipe-end-x",`${V}px`),z.currentTarget.style.setProperty("--radix-toast-swipe-end-y",`${U}px`),k(!1)})})})});mO.displayName=n2;var[q9,W9]=uO(n2,{onClose(){}}),Z9=B.forwardRef((t,r)=>{const{__scopeToast:l,type:d="foreground",duration:_,open:x,onClose:C,onEscapeKeyDown:s,onPause:k,onResume:z,onSwipeStart:V,onSwipeMove:U,onSwipeCancel:$,onSwipeEnd:se,...ae}=t,H=t2(n2,l),[ne,Y]=B.useState(null),te=ni(r,Ve=>Y(Ve)),de=B.useRef(null),Me=B.useRef(null),Le=_||H.duration,lt=B.useRef(0),Pe=B.useRef(Le),Ye=B.useRef(0),{onToastAdd:vt,onToastRemove:It}=H,Ut=os(()=>{var jt;(ne==null?void 0:ne.contains(document.activeElement))&&((jt=H.viewport)==null||jt.focus()),C()}),Pt=B.useCallback(Ve=>{!Ve||Ve===1/0||(window.clearTimeout(Ye.current),lt.current=new Date().getTime(),Ye.current=window.setTimeout(Ut,Ve))},[Ut]);B.useEffect(()=>{const Ve=H.viewport;if(Ve){const jt=()=>{Pt(Pe.current),z==null||z()},Je=()=>{const mt=new Date().getTime()-lt.current;Pe.current=Pe.current-mt,window.clearTimeout(Ye.current),k==null||k()};return Ve.addEventListener(vC,Je),Ve.addEventListener(xC,jt),()=>{Ve.removeEventListener(vC,Je),Ve.removeEventListener(xC,jt)}}},[H.viewport,Le,k,z,Pt]),B.useEffect(()=>{x&&!H.isClosePausedRef.current&&Pt(Le)},[x,Le,H.isClosePausedRef,Pt]),B.useEffect(()=>(vt(),()=>It()),[vt,It]);const $t=B.useMemo(()=>ne?wO(ne):null,[ne]);return H.viewport?w.jsxs(w.Fragment,{children:[$t&&w.jsx(X9,{__scopeToast:l,role:"status","aria-live":d==="foreground"?"assertive":"polite","aria-atomic":!0,children:$t}),w.jsx(q9,{scope:l,onClose:Ut,children:_p.createPortal(w.jsx(uI.ItemSlot,{scope:l,children:w.jsx(P9,{asChild:!0,onEscapeKeyDown:mn(s,()=>{H.isFocusedToastEscapeKeyDownRef.current||Ut(),H.isFocusedToastEscapeKeyDownRef.current=!1}),children:w.jsx(ir.li,{role:"status","aria-live":"off","aria-atomic":!0,tabIndex:0,"data-state":x?"open":"closed","data-swipe-direction":H.swipeDirection,...ae,ref:te,style:{userSelect:"none",touchAction:"none",...t.style},onKeyDown:mn(t.onKeyDown,Ve=>{Ve.key==="Escape"&&(s==null||s(Ve.nativeEvent),Ve.nativeEvent.defaultPrevented||(H.isFocusedToastEscapeKeyDownRef.current=!0,Ut()))}),onPointerDown:mn(t.onPointerDown,Ve=>{Ve.button===0&&(de.current={x:Ve.clientX,y:Ve.clientY})}),onPointerMove:mn(t.onPointerMove,Ve=>{if(!de.current)return;const jt=Ve.clientX-de.current.x,Je=Ve.clientY-de.current.y,mt=!!Me.current,Be=["left","right"].includes(H.swipeDirection),ft=["left","up"].includes(H.swipeDirection)?Math.min:Math.max,Ct=Be?ft(0,jt):0,Zt=Be?0:ft(0,Je),fn=Ve.pointerType==="touch"?10:2,Qn={x:Ct,y:Zt},$n={originalEvent:Ve,delta:Qn};mt?(Me.current=Qn,sb($9,U,$n,{discrete:!1})):_L(Qn,H.swipeDirection,fn)?(Me.current=Qn,sb(U9,V,$n,{discrete:!1}),Ve.target.setPointerCapture(Ve.pointerId)):(Math.abs(jt)>fn||Math.abs(Je)>fn)&&(de.current=null)}),onPointerUp:mn(t.onPointerUp,Ve=>{const jt=Me.current,Je=Ve.target;if(Je.hasPointerCapture(Ve.pointerId)&&Je.releasePointerCapture(Ve.pointerId),Me.current=null,de.current=null,jt){const mt=Ve.currentTarget,Be={originalEvent:Ve,delta:jt};_L(jt,H.swipeDirection,H.swipeThreshold)?sb(H9,se,Be,{discrete:!0}):sb(G9,$,Be,{discrete:!0}),mt.addEventListener("click",ft=>ft.preventDefault(),{once:!0})}})})})}),H.viewport)})]}):null}),X9=t=>{const{__scopeToast:r,children:l,...d}=t,_=t2(n2,r),[x,C]=B.useState(!1),[s,k]=B.useState(!1);return Q9(()=>C(!0)),B.useEffect(()=>{const z=window.setTimeout(()=>k(!0),1e3);return()=>window.clearTimeout(z)},[]),s?null:w.jsx(n_,{asChild:!0,children:w.jsx(Rx,{...d,children:x&&w.jsxs(w.Fragment,{children:[_.label," ",l]})})})},Y9="ToastTitle",gO=B.forwardRef((t,r)=>{const{__scopeToast:l,...d}=t;return w.jsx(ir.div,{...d,ref:r})});gO.displayName=Y9;var K9="ToastDescription",_O=B.forwardRef((t,r)=>{const{__scopeToast:l,...d}=t;return w.jsx(ir.div,{...d,ref:r})});_O.displayName=K9;var yO="ToastAction",vO=B.forwardRef((t,r)=>{const{altText:l,...d}=t;return l.trim()?w.jsx(bO,{altText:l,asChild:!0,children:w.jsx(dI,{...d,ref:r})}):(console.error(`Invalid prop \`altText\` supplied to \`${yO}\`. Expected non-empty \`string\`.`),null)});vO.displayName=yO;var xO="ToastClose",dI=B.forwardRef((t,r)=>{const{__scopeToast:l,...d}=t,_=W9(xO,l);return w.jsx(bO,{asChild:!0,children:w.jsx(ir.button,{type:"button",...d,ref:r,onClick:mn(t.onClick,_.onClose)})})});dI.displayName=xO;var bO=B.forwardRef((t,r)=>{const{__scopeToast:l,altText:d,..._}=t;return w.jsx(ir.div,{"data-radix-toast-announce-exclude":"","data-radix-toast-announce-alt":d||void 0,..._,ref:r})});function wO(t){const r=[];return Array.from(t.childNodes).forEach(d=>{if(d.nodeType===d.TEXT_NODE&&d.textContent&&r.push(d.textContent),J9(d)){const _=d.ariaHidden||d.hidden||d.style.display==="none",x=d.dataset.radixToastAnnounceExclude==="";if(!_)if(x){const C=d.dataset.radixToastAnnounceAlt;C&&r.push(C)}else r.push(...wO(d))}}),r}function sb(t,r,l,{discrete:d}){const _=l.originalEvent.currentTarget,x=new CustomEvent(t,{bubbles:!0,cancelable:!0,detail:l});r&&_.addEventListener(t,r,{once:!0}),d?lI(_,x):_.dispatchEvent(x)}var _L=(t,r,l=0)=>{const d=Math.abs(t.x),_=Math.abs(t.y),x=d>_;return r==="left"||r==="right"?x&&d>l:!x&&_>l};function Q9(t=()=>{}){const r=os(t);qs(()=>{let l=0,d=0;return l=window.requestAnimationFrame(()=>d=window.requestAnimationFrame(r)),()=>{window.cancelAnimationFrame(l),window.cancelAnimationFrame(d)}},[r])}function J9(t){return t.nodeType===t.ELEMENT_NODE}function e7(t){const r=[],l=document.createTreeWalker(t,NodeFilter.SHOW_ELEMENT,{acceptNode:d=>{const _=d.tagName==="INPUT"&&d.type==="hidden";return d.disabled||d.hidden||_?NodeFilter.FILTER_SKIP:d.tabIndex>=0?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP}});for(;l.nextNode();)r.push(l.currentNode);return r}function aE(t){const r=document.activeElement;return t.some(l=>l===r?!0:(l.focus(),document.activeElement!==r))}var t7=dO,SO=fO,TO=mO,EO=gO,CO=_O,AO=vO,IO=dI;function PO(t){var r,l,d="";if(typeof t=="string"||typeof t=="number")d+=t;else if(typeof t=="object")if(Array.isArray(t)){var _=t.length;for(r=0;r<_;r++)t[r]&&(l=PO(t[r]))&&(d&&(d+=" "),d+=l)}else for(l in t)t[l]&&(d&&(d+=" "),d+=l);return d}function MO(){for(var t,r,l=0,d="",_=arguments.length;l<_;l++)(t=arguments[l])&&(r=PO(t))&&(d&&(d+=" "),d+=r);return d}const yL=t=>typeof t=="boolean"?`${t}`:t===0?"0":t,vL=MO,r_=(t,r)=>l=>{var d;if((r==null?void 0:r.variants)==null)return vL(t,l==null?void 0:l.class,l==null?void 0:l.className);const{variants:_,defaultVariants:x}=r,C=Object.keys(_).map(z=>{const V=l==null?void 0:l[z],U=x==null?void 0:x[z];if(V===null)return null;const $=yL(V)||yL(U);return _[z][$]}),s=l&&Object.entries(l).reduce((z,V)=>{let[U,$]=V;return $===void 0||(z[U]=$),z},{}),k=r==null||(d=r.compoundVariants)===null||d===void 0?void 0:d.reduce((z,V)=>{let{class:U,className:$,...se}=V;return Object.entries(se).every(ae=>{let[H,ne]=ae;return Array.isArray(ne)?ne.includes({...x,...s}[H]):{...x,...s}[H]===ne})?[...z,U,$]:z},[]);return vL(t,C,k,l==null?void 0:l.class,l==null?void 0:l.className)};/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const n7=t=>t.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),RO=(...t)=>t.filter((r,l,d)=>!!r&&r.trim()!==""&&d.indexOf(r)===l).join(" ").trim();/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */var r7={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const i7=B.forwardRef(({color:t="currentColor",size:r=24,strokeWidth:l=2,absoluteStrokeWidth:d,className:_="",children:x,iconNode:C,...s},k)=>B.createElement("svg",{ref:k,...r7,width:r,height:r,stroke:t,strokeWidth:d?Number(l)*24/Number(r):l,className:RO("lucide",_),...s},[...C.map(([z,V])=>B.createElement(z,V)),...Array.isArray(x)?x:[x]]));/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const dr=(t,r)=>{const l=B.forwardRef(({className:d,..._},x)=>B.createElement(i7,{ref:x,iconNode:r,className:RO(`lucide-${n7(t)}`,d),..._}));return l.displayName=`${t}`,l};/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const r2=dr("ArrowLeft",[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const kO=dr("Building",[["rect",{width:"16",height:"20",x:"4",y:"2",rx:"2",ry:"2",key:"76otgf"}],["path",{d:"M9 22v-4h6v4",key:"r93iot"}],["path",{d:"M8 6h.01",key:"1dz90k"}],["path",{d:"M16 6h.01",key:"1x0f13"}],["path",{d:"M12 6h.01",key:"1vi96p"}],["path",{d:"M12 10h.01",key:"1nrarc"}],["path",{d:"M12 14h.01",key:"1etili"}],["path",{d:"M16 10h.01",key:"1m94wz"}],["path",{d:"M16 14h.01",key:"1gbofw"}],["path",{d:"M8 10h.01",key:"19clt8"}],["path",{d:"M8 14h.01",key:"6423bh"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const vu=dr("Calendar",[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const hI=dr("Check",[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const DO=dr("ChevronDown",[["path",{d:"m6 9 6 6 6-6",key:"qrunsl"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const s7=dr("ChevronRight",[["path",{d:"m9 18 6-6-6-6",key:"mthhwq"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const o7=dr("ChevronUp",[["path",{d:"m18 15-6-6-6 6",key:"153udz"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const fI=dr("CircleAlert",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ep=dr("CircleCheckBig",[["path",{d:"M21.801 10A10 10 0 1 1 17 3.335",key:"yps3ct"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const LO=dr("CircleHelp",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3",key:"1u773s"}],["path",{d:"M12 17h.01",key:"p32p05"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Qv=dr("CircleX",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const a7=dr("Circle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Mb=dr("Clock",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polyline",{points:"12 6 12 12 16 14",key:"68esgv"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const xL=dr("Coffee",[["path",{d:"M10 2v2",key:"7u0qdc"}],["path",{d:"M14 2v2",key:"6buw04"}],["path",{d:"M16 8a1 1 0 0 1 1 1v8a4 4 0 0 1-4 4H7a4 4 0 0 1-4-4V9a1 1 0 0 1 1-1h14a4 4 0 1 1 0 8h-1",key:"pwadti"}],["path",{d:"M6 2v2",key:"colzsn"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const l7=dr("Crown",[["path",{d:"M11.562 3.266a.5.5 0 0 1 .876 0L15.39 8.87a1 1 0 0 0 1.516.294L21.183 5.5a.5.5 0 0 1 .798.519l-2.834 10.246a1 1 0 0 1-.956.734H5.81a1 1 0 0 1-.957-.734L2.02 6.02a.5.5 0 0 1 .798-.519l4.276 3.664a1 1 0 0 0 1.516-.294z",key:"1vdc57"}],["path",{d:"M5 21h14",key:"11awu3"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const wC=dr("ExternalLink",[["path",{d:"M15 3h6v6",key:"1q9fwt"}],["path",{d:"M10 14 21 3",key:"gplh6r"}],["path",{d:"M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6",key:"a6xqqp"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const bL=dr("Eye",[["path",{d:"M2.062 12.348a1 1 0 0 1 0-.696 10.75 10.75 0 0 1 19.876 0 1 1 0 0 1 0 .696 10.75 10.75 0 0 1-19.876 0",key:"1nclc0"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const NO=dr("Facebook",[["path",{d:"M18 2h-3a5 5 0 0 0-5 5v3H7v4h3v8h4v-8h3l1-4h-4V7a1 1 0 0 1 1-1h3z",key:"1jg4f8"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const zO=dr("Filter",[["polygon",{points:"22 3 2 3 10 12.46 10 19 14 21 14 12.46 22 3",key:"1yg77f"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const pI=dr("Flag",[["path",{d:"M4 15s1-1 4-1 5 2 8 2 4-1 4-1V3s-1 1-4 1-5-2-8-2-4 1-4 1z",key:"i9b6wo"}],["line",{x1:"4",x2:"4",y1:"22",y2:"15",key:"1cm3nv"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const tp=dr("Globe",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 2a14.5 14.5 0 0 0 0 20 14.5 14.5 0 0 0 0-20",key:"13o1zl"}],["path",{d:"M2 12h20",key:"9i4pu4"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const c7=dr("Hash",[["line",{x1:"4",x2:"20",y1:"9",y2:"9",key:"4lhtct"}],["line",{x1:"4",x2:"20",y1:"15",y2:"15",key:"vyu0kd"}],["line",{x1:"10",x2:"8",y1:"3",y2:"21",key:"1ggp8o"}],["line",{x1:"16",x2:"14",y1:"3",y2:"21",key:"weycgp"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const kv=dr("Heart",[["path",{d:"M19 14c1.49-1.46 3-3.21 3-5.5A5.5 5.5 0 0 0 16.5 3c-1.76 0-3 .5-4.5 2-1.5-1.5-2.74-2-4.5-2A5.5 5.5 0 0 0 2 8.5c0 2.3 1.5 4.05 3 5.5l7 7Z",key:"c3ymky"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const OO=dr("House",[["path",{d:"M15 21v-8a1 1 0 0 0-1-1h-4a1 1 0 0 0-1 1v8",key:"5wwlr5"}],["path",{d:"M3 10a2 2 0 0 1 .709-1.528l7-5.999a2 2 0 0 1 2.582 0l7 5.999A2 2 0 0 1 21 10v9a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z",key:"1d0kgt"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const u7=dr("Image",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",ry:"2",key:"1m3agn"}],["circle",{cx:"9",cy:"9",r:"2",key:"af1f0g"}],["path",{d:"m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21",key:"1xmnt7"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const FO=dr("Instagram",[["rect",{width:"20",height:"20",x:"2",y:"2",rx:"5",ry:"5",key:"2e1cvw"}],["path",{d:"M16 11.37A4 4 0 1 1 12.63 8 4 4 0 0 1 16 11.37z",key:"9exkf1"}],["line",{x1:"17.5",x2:"17.51",y1:"6.5",y2:"6.5",key:"r4j83e"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const jO=dr("Linkedin",[["path",{d:"M16 8a6 6 0 0 1 6 6v7h-4v-7a2 2 0 0 0-2-2 2 2 0 0 0-2 2v7h-4v-7a6 6 0 0 1 6-6z",key:"c2jq9f"}],["rect",{width:"4",height:"12",x:"2",y:"9",key:"mk3on5"}],["circle",{cx:"4",cy:"4",r:"2",key:"bt5ra8"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Jv=dr("LoaderCircle",[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const wL=dr("Lock",[["rect",{width:"18",height:"11",x:"3",y:"11",rx:"2",ry:"2",key:"1w4ew1"}],["path",{d:"M7 11V7a5 5 0 0 1 10 0v4",key:"fwvmzm"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const d7=dr("LogOut",[["path",{d:"M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4",key:"1uf3rs"}],["polyline",{points:"16 17 21 12 16 7",key:"1gabdz"}],["line",{x1:"21",x2:"9",y1:"12",y2:"12",key:"1uyos4"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const h7=dr("Mail",[["rect",{width:"20",height:"16",x:"2",y:"4",rx:"2",key:"18n3k1"}],["path",{d:"m22 7-8.97 5.7a1.94 1.94 0 0 1-2.06 0L2 7",key:"1ocrg3"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ro=dr("MapPin",[["path",{d:"M20 10c0 4.993-5.539 10.193-7.399 11.799a1 1 0 0 1-1.202 0C9.539 20.193 4 14.993 4 10a8 8 0 0 1 16 0",key:"1r0f0z"}],["circle",{cx:"12",cy:"10",r:"3",key:"ilqhr7"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ag=dr("MessageCircle",[["path",{d:"M7.9 20A9 9 0 1 0 4 16.1L2 22Z",key:"vv11sd"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Pc=dr("MessageSquare",[["path",{d:"M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z",key:"1lielz"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const BO=dr("Navigation",[["polygon",{points:"3 11 22 2 13 21 11 13 3 11",key:"1ltx0t"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ug=dr("Plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ex=dr("Search",[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["path",{d:"m21 21-4.3-4.3",key:"1qie3q"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const i2=dr("Send",[["path",{d:"M14.536 21.686a.5.5 0 0 0 .937-.024l6.5-19a.496.496 0 0 0-.635-.635l-19 6.5a.5.5 0 0 0-.024.937l7.93 3.18a2 2 0 0 1 1.112 1.11z",key:"1ffxy3"}],["path",{d:"m21.854 2.147-10.94 10.939",key:"12cjpa"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const f7=dr("Settings",[["path",{d:"M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z",key:"1qme2f"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const p7=dr("Share",[["path",{d:"M4 12v8a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2v-8",key:"1b2hhj"}],["polyline",{points:"16 6 12 2 8 6",key:"m901s6"}],["line",{x1:"12",x2:"12",y1:"2",y2:"15",key:"1p0rca"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const m7=dr("Shield",[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const g7=dr("Sparkles",[["path",{d:"M9.937 15.5A2 2 0 0 0 8.5 14.063l-6.135-1.582a.5.5 0 0 1 0-.962L8.5 9.936A2 2 0 0 0 9.937 8.5l1.582-6.135a.5.5 0 0 1 .963 0L14.063 8.5A2 2 0 0 0 15.5 9.937l6.135 1.581a.5.5 0 0 1 0 .964L15.5 14.063a2 2 0 0 0-1.437 1.437l-1.582 6.135a.5.5 0 0 1-.963 0z",key:"4pj2yx"}],["path",{d:"M20 3v4",key:"1olli1"}],["path",{d:"M22 5h-4",key:"1gvqau"}],["path",{d:"M4 17v2",key:"vumght"}],["path",{d:"M5 18H3",key:"zchphs"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const _7=dr("Trash2",[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17",key:"1uufr5"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17",key:"xtxkd"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const y7=dr("TrendingUp",[["polyline",{points:"22 7 13.5 15.5 8.5 10.5 2 17",key:"126l90"}],["polyline",{points:"16 7 22 7 22 13",key:"kwv8wd"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const v7=dr("TriangleAlert",[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3",key:"wmoenq"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const VO=dr("Twitter",[["path",{d:"M22 4s-.7 2.1-2 3.4c1.6 10-9.4 17.3-18 11.6 2.2.1 4.4-.6 6-2C3 15.5.5 9.6 3 5c2.2 2.6 5.6 4.1 9 4-.9-4.2 4-6.6 7-3.8 1.1 0 3-1.2 3-1.2z",key:"pff0z6"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const x7=dr("Upload",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"17 8 12 3 7 8",key:"t8dd8p"}],["line",{x1:"12",x2:"12",y1:"3",y2:"15",key:"widbto"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const b7=dr("UserPlus",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["line",{x1:"19",x2:"19",y1:"8",y2:"14",key:"1bvyxn"}],["line",{x1:"22",x2:"16",y1:"11",y2:"11",key:"1shjgl"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const np=dr("User",[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ho=dr("Users",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["path",{d:"M22 21v-2a4 4 0 0 0-3-3.87",key:"kshegd"}],["path",{d:"M16 3.13a4 4 0 0 1 0 7.75",key:"1da9ce"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const vh=dr("X",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const UO=dr("Youtube",[["path",{d:"M2.5 17a24.12 24.12 0 0 1 0-10 2 2 0 0 1 1.4-1.4 49.56 49.56 0 0 1 16.2 0A2 2 0 0 1 21.5 7a24.12 24.12 0 0 1 0 10 2 2 0 0 1-1.4 1.4 49.55 49.55 0 0 1-16.2 0A2 2 0 0 1 2.5 17",key:"1q2vi4"}],["path",{d:"m10 15 5-3-5-3z",key:"1jp15x"}]]),mI="-",w7=t=>{const r=T7(t),{conflictingClassGroups:l,conflictingClassGroupModifiers:d}=t;return{getClassGroupId:C=>{const s=C.split(mI);return s[0]===""&&s.length!==1&&s.shift(),$O(s,r)||S7(C)},getConflictingClassGroupIds:(C,s)=>{const k=l[C]||[];return s&&d[C]?[...k,...d[C]]:k}}},$O=(t,r)=>{var C;if(t.length===0)return r.classGroupId;const l=t[0],d=r.nextPart.get(l),_=d?$O(t.slice(1),d):void 0;if(_)return _;if(r.validators.length===0)return;const x=t.join(mI);return(C=r.validators.find(({validator:s})=>s(x)))==null?void 0:C.classGroupId},SL=/^\[(.+)\]$/,S7=t=>{if(SL.test(t)){const r=SL.exec(t)[1],l=r==null?void 0:r.substring(0,r.indexOf(":"));if(l)return"arbitrary.."+l}},T7=t=>{const{theme:r,prefix:l}=t,d={nextPart:new Map,validators:[]};return C7(Object.entries(t.classGroups),l).forEach(([x,C])=>{SC(C,d,x,r)}),d},SC=(t,r,l,d)=>{t.forEach(_=>{if(typeof _=="string"){const x=_===""?r:TL(r,_);x.classGroupId=l;return}if(typeof _=="function"){if(E7(_)){SC(_(d),r,l,d);return}r.validators.push({validator:_,classGroupId:l});return}Object.entries(_).forEach(([x,C])=>{SC(C,TL(r,x),l,d)})})},TL=(t,r)=>{let l=t;return r.split(mI).forEach(d=>{l.nextPart.has(d)||l.nextPart.set(d,{nextPart:new Map,validators:[]}),l=l.nextPart.get(d)}),l},E7=t=>t.isThemeGetter,C7=(t,r)=>r?t.map(([l,d])=>{const _=d.map(x=>typeof x=="string"?r+x:typeof x=="object"?Object.fromEntries(Object.entries(x).map(([C,s])=>[r+C,s])):x);return[l,_]}):t,A7=t=>{if(t<1)return{get:()=>{},set:()=>{}};let r=0,l=new Map,d=new Map;const _=(x,C)=>{l.set(x,C),r++,r>t&&(r=0,d=l,l=new Map)};return{get(x){let C=l.get(x);if(C!==void 0)return C;if((C=d.get(x))!==void 0)return _(x,C),C},set(x,C){l.has(x)?l.set(x,C):_(x,C)}}},GO="!",I7=t=>{const{separator:r,experimentalParseClassName:l}=t,d=r.length===1,_=r[0],x=r.length,C=s=>{const k=[];let z=0,V=0,U;for(let ne=0;ne<s.length;ne++){let Y=s[ne];if(z===0){if(Y===_&&(d||s.slice(ne,ne+x)===r)){k.push(s.slice(V,ne)),V=ne+x;continue}if(Y==="/"){U=ne;continue}}Y==="["?z++:Y==="]"&&z--}const $=k.length===0?s:s.substring(V),se=$.startsWith(GO),ae=se?$.substring(1):$,H=U&&U>V?U-V:void 0;return{modifiers:k,hasImportantModifier:se,baseClassName:ae,maybePostfixModifierPosition:H}};return l?s=>l({className:s,parseClassName:C}):C},P7=t=>{if(t.length<=1)return t;const r=[];let l=[];return t.forEach(d=>{d[0]==="["?(r.push(...l.sort(),d),l=[]):l.push(d)}),r.push(...l.sort()),r},M7=t=>({cache:A7(t.cacheSize),parseClassName:I7(t),...w7(t)}),R7=/\s+/,k7=(t,r)=>{const{parseClassName:l,getClassGroupId:d,getConflictingClassGroupIds:_}=r,x=[],C=t.trim().split(R7);let s="";for(let k=C.length-1;k>=0;k-=1){const z=C[k],{modifiers:V,hasImportantModifier:U,baseClassName:$,maybePostfixModifierPosition:se}=l(z);let ae=!!se,H=d(ae?$.substring(0,se):$);if(!H){if(!ae){s=z+(s.length>0?" "+s:s);continue}if(H=d($),!H){s=z+(s.length>0?" "+s:s);continue}ae=!1}const ne=P7(V).join(":"),Y=U?ne+GO:ne,te=Y+H;if(x.includes(te))continue;x.push(te);const de=_(H,ae);for(let Me=0;Me<de.length;++Me){const Le=de[Me];x.push(Y+Le)}s=z+(s.length>0?" "+s:s)}return s};function D7(){let t=0,r,l,d="";for(;t<arguments.length;)(r=arguments[t++])&&(l=HO(r))&&(d&&(d+=" "),d+=l);return d}const HO=t=>{if(typeof t=="string")return t;let r,l="";for(let d=0;d<t.length;d++)t[d]&&(r=HO(t[d]))&&(l&&(l+=" "),l+=r);return l};function L7(t,...r){let l,d,_,x=C;function C(k){const z=r.reduce((V,U)=>U(V),t());return l=M7(z),d=l.cache.get,_=l.cache.set,x=s,s(k)}function s(k){const z=d(k);if(z)return z;const V=k7(k,l);return _(k,V),V}return function(){return x(D7.apply(null,arguments))}}const es=t=>{const r=l=>l[t]||[];return r.isThemeGetter=!0,r},qO=/^\[(?:([a-z-]+):)?(.+)\]$/i,N7=/^\d+\/\d+$/,z7=new Set(["px","full","screen"]),O7=/^(\d+(\.\d+)?)?(xs|sm|md|lg|xl)$/,F7=/\d+(%|px|r?em|[sdl]?v([hwib]|min|max)|pt|pc|in|cm|mm|cap|ch|ex|r?lh|cq(w|h|i|b|min|max))|\b(calc|min|max|clamp)\(.+\)|^0$/,j7=/^(rgba?|hsla?|hwb|(ok)?(lab|lch))\(.+\)$/,B7=/^(inset_)?-?((\d+)?\.?(\d+)[a-z]+|0)_-?((\d+)?\.?(\d+)[a-z]+|0)/,V7=/^(url|image|image-set|cross-fade|element|(repeating-)?(linear|radial|conic)-gradient)\(.+\)$/,uu=t=>mg(t)||z7.has(t)||N7.test(t),Sd=t=>i_(t,"length",X7),mg=t=>!!t&&!Number.isNaN(Number(t)),lE=t=>i_(t,"number",mg),av=t=>!!t&&Number.isInteger(Number(t)),U7=t=>t.endsWith("%")&&mg(t.slice(0,-1)),Wr=t=>qO.test(t),Td=t=>O7.test(t),$7=new Set(["length","size","percentage"]),G7=t=>i_(t,$7,WO),H7=t=>i_(t,"position",WO),q7=new Set(["image","url"]),W7=t=>i_(t,q7,K7),Z7=t=>i_(t,"",Y7),lv=()=>!0,i_=(t,r,l)=>{const d=qO.exec(t);return d?d[1]?typeof r=="string"?d[1]===r:r.has(d[1]):l(d[2]):!1},X7=t=>F7.test(t)&&!j7.test(t),WO=()=>!1,Y7=t=>B7.test(t),K7=t=>V7.test(t),Q7=()=>{const t=es("colors"),r=es("spacing"),l=es("blur"),d=es("brightness"),_=es("borderColor"),x=es("borderRadius"),C=es("borderSpacing"),s=es("borderWidth"),k=es("contrast"),z=es("grayscale"),V=es("hueRotate"),U=es("invert"),$=es("gap"),se=es("gradientColorStops"),ae=es("gradientColorStopPositions"),H=es("inset"),ne=es("margin"),Y=es("opacity"),te=es("padding"),de=es("saturate"),Me=es("scale"),Le=es("sepia"),lt=es("skew"),Pe=es("space"),Ye=es("translate"),vt=()=>["auto","contain","none"],It=()=>["auto","hidden","clip","visible","scroll"],Ut=()=>["auto",Wr,r],Pt=()=>[Wr,r],$t=()=>["",uu,Sd],Ve=()=>["auto",mg,Wr],jt=()=>["bottom","center","left","left-bottom","left-top","right","right-bottom","right-top","top"],Je=()=>["solid","dashed","dotted","double","none"],mt=()=>["normal","multiply","screen","overlay","darken","lighten","color-dodge","color-burn","hard-light","soft-light","difference","exclusion","hue","saturation","color","luminosity"],Be=()=>["start","end","center","between","around","evenly","stretch"],ft=()=>["","0",Wr],Ct=()=>["auto","avoid","all","avoid-page","page","left","right","column"],Zt=()=>[mg,Wr];return{cacheSize:500,separator:":",theme:{colors:[lv],spacing:[uu,Sd],blur:["none","",Td,Wr],brightness:Zt(),borderColor:[t],borderRadius:["none","","full",Td,Wr],borderSpacing:Pt(),borderWidth:$t(),contrast:Zt(),grayscale:ft(),hueRotate:Zt(),invert:ft(),gap:Pt(),gradientColorStops:[t],gradientColorStopPositions:[U7,Sd],inset:Ut(),margin:Ut(),opacity:Zt(),padding:Pt(),saturate:Zt(),scale:Zt(),sepia:ft(),skew:Zt(),space:Pt(),translate:Pt()},classGroups:{aspect:[{aspect:["auto","square","video",Wr]}],container:["container"],columns:[{columns:[Td]}],"break-after":[{"break-after":Ct()}],"break-before":[{"break-before":Ct()}],"break-inside":[{"break-inside":["auto","avoid","avoid-page","avoid-column"]}],"box-decoration":[{"box-decoration":["slice","clone"]}],box:[{box:["border","content"]}],display:["block","inline-block","inline","flex","inline-flex","table","inline-table","table-caption","table-cell","table-column","table-column-group","table-footer-group","table-header-group","table-row-group","table-row","flow-root","grid","inline-grid","contents","list-item","hidden"],float:[{float:["right","left","none","start","end"]}],clear:[{clear:["left","right","both","none","start","end"]}],isolation:["isolate","isolation-auto"],"object-fit":[{object:["contain","cover","fill","none","scale-down"]}],"object-position":[{object:[...jt(),Wr]}],overflow:[{overflow:It()}],"overflow-x":[{"overflow-x":It()}],"overflow-y":[{"overflow-y":It()}],overscroll:[{overscroll:vt()}],"overscroll-x":[{"overscroll-x":vt()}],"overscroll-y":[{"overscroll-y":vt()}],position:["static","fixed","absolute","relative","sticky"],inset:[{inset:[H]}],"inset-x":[{"inset-x":[H]}],"inset-y":[{"inset-y":[H]}],start:[{start:[H]}],end:[{end:[H]}],top:[{top:[H]}],right:[{right:[H]}],bottom:[{bottom:[H]}],left:[{left:[H]}],visibility:["visible","invisible","collapse"],z:[{z:["auto",av,Wr]}],basis:[{basis:Ut()}],"flex-direction":[{flex:["row","row-reverse","col","col-reverse"]}],"flex-wrap":[{flex:["wrap","wrap-reverse","nowrap"]}],flex:[{flex:["1","auto","initial","none",Wr]}],grow:[{grow:ft()}],shrink:[{shrink:ft()}],order:[{order:["first","last","none",av,Wr]}],"grid-cols":[{"grid-cols":[lv]}],"col-start-end":[{col:["auto",{span:["full",av,Wr]},Wr]}],"col-start":[{"col-start":Ve()}],"col-end":[{"col-end":Ve()}],"grid-rows":[{"grid-rows":[lv]}],"row-start-end":[{row:["auto",{span:[av,Wr]},Wr]}],"row-start":[{"row-start":Ve()}],"row-end":[{"row-end":Ve()}],"grid-flow":[{"grid-flow":["row","col","dense","row-dense","col-dense"]}],"auto-cols":[{"auto-cols":["auto","min","max","fr",Wr]}],"auto-rows":[{"auto-rows":["auto","min","max","fr",Wr]}],gap:[{gap:[$]}],"gap-x":[{"gap-x":[$]}],"gap-y":[{"gap-y":[$]}],"justify-content":[{justify:["normal",...Be()]}],"justify-items":[{"justify-items":["start","end","center","stretch"]}],"justify-self":[{"justify-self":["auto","start","end","center","stretch"]}],"align-content":[{content:["normal",...Be(),"baseline"]}],"align-items":[{items:["start","end","center","baseline","stretch"]}],"align-self":[{self:["auto","start","end","center","stretch","baseline"]}],"place-content":[{"place-content":[...Be(),"baseline"]}],"place-items":[{"place-items":["start","end","center","baseline","stretch"]}],"place-self":[{"place-self":["auto","start","end","center","stretch"]}],p:[{p:[te]}],px:[{px:[te]}],py:[{py:[te]}],ps:[{ps:[te]}],pe:[{pe:[te]}],pt:[{pt:[te]}],pr:[{pr:[te]}],pb:[{pb:[te]}],pl:[{pl:[te]}],m:[{m:[ne]}],mx:[{mx:[ne]}],my:[{my:[ne]}],ms:[{ms:[ne]}],me:[{me:[ne]}],mt:[{mt:[ne]}],mr:[{mr:[ne]}],mb:[{mb:[ne]}],ml:[{ml:[ne]}],"space-x":[{"space-x":[Pe]}],"space-x-reverse":["space-x-reverse"],"space-y":[{"space-y":[Pe]}],"space-y-reverse":["space-y-reverse"],w:[{w:["auto","min","max","fit","svw","lvw","dvw",Wr,r]}],"min-w":[{"min-w":[Wr,r,"min","max","fit"]}],"max-w":[{"max-w":[Wr,r,"none","full","min","max","fit","prose",{screen:[Td]},Td]}],h:[{h:[Wr,r,"auto","min","max","fit","svh","lvh","dvh"]}],"min-h":[{"min-h":[Wr,r,"min","max","fit","svh","lvh","dvh"]}],"max-h":[{"max-h":[Wr,r,"min","max","fit","svh","lvh","dvh"]}],size:[{size:[Wr,r,"auto","min","max","fit"]}],"font-size":[{text:["base",Td,Sd]}],"font-smoothing":["antialiased","subpixel-antialiased"],"font-style":["italic","not-italic"],"font-weight":[{font:["thin","extralight","light","normal","medium","semibold","bold","extrabold","black",lE]}],"font-family":[{font:[lv]}],"fvn-normal":["normal-nums"],"fvn-ordinal":["ordinal"],"fvn-slashed-zero":["slashed-zero"],"fvn-figure":["lining-nums","oldstyle-nums"],"fvn-spacing":["proportional-nums","tabular-nums"],"fvn-fraction":["diagonal-fractions","stacked-fractons"],tracking:[{tracking:["tighter","tight","normal","wide","wider","widest",Wr]}],"line-clamp":[{"line-clamp":["none",mg,lE]}],leading:[{leading:["none","tight","snug","normal","relaxed","loose",uu,Wr]}],"list-image":[{"list-image":["none",Wr]}],"list-style-type":[{list:["none","disc","decimal",Wr]}],"list-style-position":[{list:["inside","outside"]}],"placeholder-color":[{placeholder:[t]}],"placeholder-opacity":[{"placeholder-opacity":[Y]}],"text-alignment":[{text:["left","center","right","justify","start","end"]}],"text-color":[{text:[t]}],"text-opacity":[{"text-opacity":[Y]}],"text-decoration":["underline","overline","line-through","no-underline"],"text-decoration-style":[{decoration:[...Je(),"wavy"]}],"text-decoration-thickness":[{decoration:["auto","from-font",uu,Sd]}],"underline-offset":[{"underline-offset":["auto",uu,Wr]}],"text-decoration-color":[{decoration:[t]}],"text-transform":["uppercase","lowercase","capitalize","normal-case"],"text-overflow":["truncate","text-ellipsis","text-clip"],"text-wrap":[{text:["wrap","nowrap","balance","pretty"]}],indent:[{indent:Pt()}],"vertical-align":[{align:["baseline","top","middle","bottom","text-top","text-bottom","sub","super",Wr]}],whitespace:[{whitespace:["normal","nowrap","pre","pre-line","pre-wrap","break-spaces"]}],break:[{break:["normal","words","all","keep"]}],hyphens:[{hyphens:["none","manual","auto"]}],content:[{content:["none",Wr]}],"bg-attachment":[{bg:["fixed","local","scroll"]}],"bg-clip":[{"bg-clip":["border","padding","content","text"]}],"bg-opacity":[{"bg-opacity":[Y]}],"bg-origin":[{"bg-origin":["border","padding","content"]}],"bg-position":[{bg:[...jt(),H7]}],"bg-repeat":[{bg:["no-repeat",{repeat:["","x","y","round","space"]}]}],"bg-size":[{bg:["auto","cover","contain",G7]}],"bg-image":[{bg:["none",{"gradient-to":["t","tr","r","br","b","bl","l","tl"]},W7]}],"bg-color":[{bg:[t]}],"gradient-from-pos":[{from:[ae]}],"gradient-via-pos":[{via:[ae]}],"gradient-to-pos":[{to:[ae]}],"gradient-from":[{from:[se]}],"gradient-via":[{via:[se]}],"gradient-to":[{to:[se]}],rounded:[{rounded:[x]}],"rounded-s":[{"rounded-s":[x]}],"rounded-e":[{"rounded-e":[x]}],"rounded-t":[{"rounded-t":[x]}],"rounded-r":[{"rounded-r":[x]}],"rounded-b":[{"rounded-b":[x]}],"rounded-l":[{"rounded-l":[x]}],"rounded-ss":[{"rounded-ss":[x]}],"rounded-se":[{"rounded-se":[x]}],"rounded-ee":[{"rounded-ee":[x]}],"rounded-es":[{"rounded-es":[x]}],"rounded-tl":[{"rounded-tl":[x]}],"rounded-tr":[{"rounded-tr":[x]}],"rounded-br":[{"rounded-br":[x]}],"rounded-bl":[{"rounded-bl":[x]}],"border-w":[{border:[s]}],"border-w-x":[{"border-x":[s]}],"border-w-y":[{"border-y":[s]}],"border-w-s":[{"border-s":[s]}],"border-w-e":[{"border-e":[s]}],"border-w-t":[{"border-t":[s]}],"border-w-r":[{"border-r":[s]}],"border-w-b":[{"border-b":[s]}],"border-w-l":[{"border-l":[s]}],"border-opacity":[{"border-opacity":[Y]}],"border-style":[{border:[...Je(),"hidden"]}],"divide-x":[{"divide-x":[s]}],"divide-x-reverse":["divide-x-reverse"],"divide-y":[{"divide-y":[s]}],"divide-y-reverse":["divide-y-reverse"],"divide-opacity":[{"divide-opacity":[Y]}],"divide-style":[{divide:Je()}],"border-color":[{border:[_]}],"border-color-x":[{"border-x":[_]}],"border-color-y":[{"border-y":[_]}],"border-color-s":[{"border-s":[_]}],"border-color-e":[{"border-e":[_]}],"border-color-t":[{"border-t":[_]}],"border-color-r":[{"border-r":[_]}],"border-color-b":[{"border-b":[_]}],"border-color-l":[{"border-l":[_]}],"divide-color":[{divide:[_]}],"outline-style":[{outline:["",...Je()]}],"outline-offset":[{"outline-offset":[uu,Wr]}],"outline-w":[{outline:[uu,Sd]}],"outline-color":[{outline:[t]}],"ring-w":[{ring:$t()}],"ring-w-inset":["ring-inset"],"ring-color":[{ring:[t]}],"ring-opacity":[{"ring-opacity":[Y]}],"ring-offset-w":[{"ring-offset":[uu,Sd]}],"ring-offset-color":[{"ring-offset":[t]}],shadow:[{shadow:["","inner","none",Td,Z7]}],"shadow-color":[{shadow:[lv]}],opacity:[{opacity:[Y]}],"mix-blend":[{"mix-blend":[...mt(),"plus-lighter","plus-darker"]}],"bg-blend":[{"bg-blend":mt()}],filter:[{filter:["","none"]}],blur:[{blur:[l]}],brightness:[{brightness:[d]}],contrast:[{contrast:[k]}],"drop-shadow":[{"drop-shadow":["","none",Td,Wr]}],grayscale:[{grayscale:[z]}],"hue-rotate":[{"hue-rotate":[V]}],invert:[{invert:[U]}],saturate:[{saturate:[de]}],sepia:[{sepia:[Le]}],"backdrop-filter":[{"backdrop-filter":["","none"]}],"backdrop-blur":[{"backdrop-blur":[l]}],"backdrop-brightness":[{"backdrop-brightness":[d]}],"backdrop-contrast":[{"backdrop-contrast":[k]}],"backdrop-grayscale":[{"backdrop-grayscale":[z]}],"backdrop-hue-rotate":[{"backdrop-hue-rotate":[V]}],"backdrop-invert":[{"backdrop-invert":[U]}],"backdrop-opacity":[{"backdrop-opacity":[Y]}],"backdrop-saturate":[{"backdrop-saturate":[de]}],"backdrop-sepia":[{"backdrop-sepia":[Le]}],"border-collapse":[{border:["collapse","separate"]}],"border-spacing":[{"border-spacing":[C]}],"border-spacing-x":[{"border-spacing-x":[C]}],"border-spacing-y":[{"border-spacing-y":[C]}],"table-layout":[{table:["auto","fixed"]}],caption:[{caption:["top","bottom"]}],transition:[{transition:["none","all","","colors","opacity","shadow","transform",Wr]}],duration:[{duration:Zt()}],ease:[{ease:["linear","in","out","in-out",Wr]}],delay:[{delay:Zt()}],animate:[{animate:["none","spin","ping","pulse","bounce",Wr]}],transform:[{transform:["","gpu","none"]}],scale:[{scale:[Me]}],"scale-x":[{"scale-x":[Me]}],"scale-y":[{"scale-y":[Me]}],rotate:[{rotate:[av,Wr]}],"translate-x":[{"translate-x":[Ye]}],"translate-y":[{"translate-y":[Ye]}],"skew-x":[{"skew-x":[lt]}],"skew-y":[{"skew-y":[lt]}],"transform-origin":[{origin:["center","top","top-right","right","bottom-right","bottom","bottom-left","left","top-left",Wr]}],accent:[{accent:["auto",t]}],appearance:[{appearance:["none","auto"]}],cursor:[{cursor:["auto","default","pointer","wait","text","move","help","not-allowed","none","context-menu","progress","cell","crosshair","vertical-text","alias","copy","no-drop","grab","grabbing","all-scroll","col-resize","row-resize","n-resize","e-resize","s-resize","w-resize","ne-resize","nw-resize","se-resize","sw-resize","ew-resize","ns-resize","nesw-resize","nwse-resize","zoom-in","zoom-out",Wr]}],"caret-color":[{caret:[t]}],"pointer-events":[{"pointer-events":["none","auto"]}],resize:[{resize:["none","y","x",""]}],"scroll-behavior":[{scroll:["auto","smooth"]}],"scroll-m":[{"scroll-m":Pt()}],"scroll-mx":[{"scroll-mx":Pt()}],"scroll-my":[{"scroll-my":Pt()}],"scroll-ms":[{"scroll-ms":Pt()}],"scroll-me":[{"scroll-me":Pt()}],"scroll-mt":[{"scroll-mt":Pt()}],"scroll-mr":[{"scroll-mr":Pt()}],"scroll-mb":[{"scroll-mb":Pt()}],"scroll-ml":[{"scroll-ml":Pt()}],"scroll-p":[{"scroll-p":Pt()}],"scroll-px":[{"scroll-px":Pt()}],"scroll-py":[{"scroll-py":Pt()}],"scroll-ps":[{"scroll-ps":Pt()}],"scroll-pe":[{"scroll-pe":Pt()}],"scroll-pt":[{"scroll-pt":Pt()}],"scroll-pr":[{"scroll-pr":Pt()}],"scroll-pb":[{"scroll-pb":Pt()}],"scroll-pl":[{"scroll-pl":Pt()}],"snap-align":[{snap:["start","end","center","align-none"]}],"snap-stop":[{snap:["normal","always"]}],"snap-type":[{snap:["none","x","y","both"]}],"snap-strictness":[{snap:["mandatory","proximity"]}],touch:[{touch:["auto","none","manipulation"]}],"touch-x":[{"touch-pan":["x","left","right"]}],"touch-y":[{"touch-pan":["y","up","down"]}],"touch-pz":["touch-pinch-zoom"],select:[{select:["none","text","all","auto"]}],"will-change":[{"will-change":["auto","scroll","contents","transform",Wr]}],fill:[{fill:[t,"none"]}],"stroke-w":[{stroke:[uu,Sd,lE]}],stroke:[{stroke:[t,"none"]}],sr:["sr-only","not-sr-only"],"forced-color-adjust":[{"forced-color-adjust":["auto","none"]}]},conflictingClassGroups:{overflow:["overflow-x","overflow-y"],overscroll:["overscroll-x","overscroll-y"],inset:["inset-x","inset-y","start","end","top","right","bottom","left"],"inset-x":["right","left"],"inset-y":["top","bottom"],flex:["basis","grow","shrink"],gap:["gap-x","gap-y"],p:["px","py","ps","pe","pt","pr","pb","pl"],px:["pr","pl"],py:["pt","pb"],m:["mx","my","ms","me","mt","mr","mb","ml"],mx:["mr","ml"],my:["mt","mb"],size:["w","h"],"font-size":["leading"],"fvn-normal":["fvn-ordinal","fvn-slashed-zero","fvn-figure","fvn-spacing","fvn-fraction"],"fvn-ordinal":["fvn-normal"],"fvn-slashed-zero":["fvn-normal"],"fvn-figure":["fvn-normal"],"fvn-spacing":["fvn-normal"],"fvn-fraction":["fvn-normal"],"line-clamp":["display","overflow"],rounded:["rounded-s","rounded-e","rounded-t","rounded-r","rounded-b","rounded-l","rounded-ss","rounded-se","rounded-ee","rounded-es","rounded-tl","rounded-tr","rounded-br","rounded-bl"],"rounded-s":["rounded-ss","rounded-es"],"rounded-e":["rounded-se","rounded-ee"],"rounded-t":["rounded-tl","rounded-tr"],"rounded-r":["rounded-tr","rounded-br"],"rounded-b":["rounded-br","rounded-bl"],"rounded-l":["rounded-tl","rounded-bl"],"border-spacing":["border-spacing-x","border-spacing-y"],"border-w":["border-w-s","border-w-e","border-w-t","border-w-r","border-w-b","border-w-l"],"border-w-x":["border-w-r","border-w-l"],"border-w-y":["border-w-t","border-w-b"],"border-color":["border-color-s","border-color-e","border-color-t","border-color-r","border-color-b","border-color-l"],"border-color-x":["border-color-r","border-color-l"],"border-color-y":["border-color-t","border-color-b"],"scroll-m":["scroll-mx","scroll-my","scroll-ms","scroll-me","scroll-mt","scroll-mr","scroll-mb","scroll-ml"],"scroll-mx":["scroll-mr","scroll-ml"],"scroll-my":["scroll-mt","scroll-mb"],"scroll-p":["scroll-px","scroll-py","scroll-ps","scroll-pe","scroll-pt","scroll-pr","scroll-pb","scroll-pl"],"scroll-px":["scroll-pr","scroll-pl"],"scroll-py":["scroll-pt","scroll-pb"],touch:["touch-x","touch-y","touch-pz"],"touch-x":["touch"],"touch-y":["touch"],"touch-pz":["touch"]},conflictingClassGroupModifiers:{"font-size":["leading"]}}},J7=L7(Q7);function rr(...t){return J7(MO(t))}const eH=t7,ZO=B.forwardRef(({className:t,...r},l)=>w.jsx(SO,{ref:l,className:rr("fixed top-0 z-[100] flex max-h-screen w-full flex-col-reverse p-4 sm:bottom-0 sm:right-0 sm:top-auto sm:flex-col md:max-w-[420px]",t),...r}));ZO.displayName=SO.displayName;const tH=r_("group pointer-events-auto relative flex w-full items-center justify-between space-x-4 overflow-hidden rounded-md border p-6 pr-8 shadow-lg transition-all data-[swipe=cancel]:translate-x-0 data-[swipe=end]:translate-x-[var(--radix-toast-swipe-end-x)] data-[swipe=move]:translate-x-[var(--radix-toast-swipe-move-x)] data-[swipe=move]:transition-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[swipe=end]:animate-out data-[state=closed]:fade-out-80 data-[state=closed]:slide-out-to-right-full data-[state=open]:slide-in-from-top-full data-[state=open]:sm:slide-in-from-bottom-full",{variants:{variant:{default:"border bg-background text-foreground",destructive:"destructive group border-destructive bg-destructive text-destructive-foreground"}},defaultVariants:{variant:"default"}}),XO=B.forwardRef(({className:t,variant:r,...l},d)=>w.jsx(TO,{ref:d,className:rr(tH({variant:r}),t),...l}));XO.displayName=TO.displayName;const nH=B.forwardRef(({className:t,...r},l)=>w.jsx(AO,{ref:l,className:rr("inline-flex h-8 shrink-0 items-center justify-center rounded-md border bg-transparent px-3 text-sm font-medium ring-offset-background transition-colors hover:bg-secondary focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 group-[.destructive]:border-muted/40 group-[.destructive]:hover:border-destructive/30 group-[.destructive]:hover:bg-destructive group-[.destructive]:hover:text-destructive-foreground group-[.destructive]:focus:ring-destructive",t),...r}));nH.displayName=AO.displayName;const YO=B.forwardRef(({className:t,...r},l)=>w.jsx(IO,{ref:l,className:rr("absolute right-2 top-2 rounded-md p-1 text-foreground/50 opacity-0 transition-opacity hover:text-foreground focus:opacity-100 focus:outline-none focus:ring-2 group-hover:opacity-100 group-[.destructive]:text-red-300 group-[.destructive]:hover:text-red-50 group-[.destructive]:focus:ring-red-400 group-[.destructive]:focus:ring-offset-red-600",t),"toast-close":"",...r,children:w.jsx(vh,{className:"h-4 w-4"})}));YO.displayName=IO.displayName;const KO=B.forwardRef(({className:t,...r},l)=>w.jsx(EO,{ref:l,className:rr("text-sm font-semibold",t),...r}));KO.displayName=EO.displayName;const QO=B.forwardRef(({className:t,...r},l)=>w.jsx(CO,{ref:l,className:rr("text-sm opacity-90",t),...r}));QO.displayName=CO.displayName;function rH(){const{toasts:t}=yp();return w.jsxs(eH,{children:[t.map(function({id:r,title:l,description:d,action:_,...x}){return w.jsxs(XO,{...x,children:[w.jsxs("div",{className:"grid gap-1",children:[l&&w.jsx(KO,{children:l}),d&&w.jsx(QO,{children:d})]}),_,w.jsx(YO,{})]},r)}),w.jsx(ZO,{})]})}var EL=["light","dark"],iH="(prefers-color-scheme: dark)",sH=B.createContext(void 0),oH={setTheme:t=>{},themes:[]},aH=()=>{var t;return(t=B.useContext(sH))!=null?t:oH};B.memo(({forcedTheme:t,storageKey:r,attribute:l,enableSystem:d,enableColorScheme:_,defaultTheme:x,value:C,attrs:s,nonce:k})=>{let z=x==="system",V=l==="class"?`var d=document.documentElement,c=d.classList;${`c.remove(${s.map(ae=>`'${ae}'`).join(",")})`};`:`var d=document.documentElement,n='${l}',s='setAttribute';`,U=_?EL.includes(x)&&x?`if(e==='light'||e==='dark'||!e)d.style.colorScheme=e||'${x}'`:"if(e==='light'||e==='dark')d.style.colorScheme=e":"",$=(ae,H=!1,ne=!0)=>{let Y=C?C[ae]:ae,te=H?ae+"|| ''":`'${Y}'`,de="";return _&&ne&&!H&&EL.includes(ae)&&(de+=`d.style.colorScheme = '${ae}';`),l==="class"?H||Y?de+=`c.add(${te})`:de+="null":Y&&(de+=`d[s](n,${te})`),de},se=t?`!function(){${V}${$(t)}}()`:d?`!function(){try{${V}var e=localStorage.getItem('${r}');if('system'===e||(!e&&${z})){var t='${iH}',m=window.matchMedia(t);if(m.media!==t||m.matches){${$("dark")}}else{${$("light")}}}else if(e){${C?`var x=${JSON.stringify(C)};`:""}${$(C?"x[e]":"e",!0)}}${z?"":"else{"+$(x,!1,!1)+"}"}${U}}catch(e){}}()`:`!function(){try{${V}var e=localStorage.getItem('${r}');if(e){${C?`var x=${JSON.stringify(C)};`:""}${$(C?"x[e]":"e",!0)}}else{${$(x,!1,!1)};}${U}}catch(t){}}();`;return B.createElement("script",{nonce:k,dangerouslySetInnerHTML:{__html:se}})});var lH=t=>{switch(t){case"success":return dH;case"info":return fH;case"warning":return hH;case"error":return pH;default:return null}},cH=Array(12).fill(0),uH=({visible:t})=>Nt.createElement("div",{className:"sonner-loading-wrapper","data-visible":t},Nt.createElement("div",{className:"sonner-spinner"},cH.map((r,l)=>Nt.createElement("div",{className:"sonner-loading-bar",key:`spinner-bar-${l}`})))),dH=Nt.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",height:"20",width:"20"},Nt.createElement("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zm3.857-9.809a.75.75 0 00-1.214-.882l-3.483 4.79-1.88-1.88a.75.75 0 10-1.06 1.061l2.5 2.5a.75.75 0 001.137-.089l4-5.5z",clipRule:"evenodd"})),hH=Nt.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor",height:"20",width:"20"},Nt.createElement("path",{fillRule:"evenodd",d:"M9.401 3.003c1.155-2 4.043-2 5.197 0l7.355 12.748c1.154 2-.29 4.5-2.599 4.5H4.645c-2.309 0-3.752-2.5-2.598-4.5L9.4 3.003zM12 8.25a.75.75 0 01.75.75v3.75a.75.75 0 01-1.5 0V9a.75.75 0 01.75-.75zm0 8.25a.75.75 0 100-1.5.75.75 0 000 1.5z",clipRule:"evenodd"})),fH=Nt.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",height:"20",width:"20"},Nt.createElement("path",{fillRule:"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a.75.75 0 000 1.5h.253a.25.25 0 01.244.304l-.459 2.066A1.75 1.75 0 0010.747 15H11a.75.75 0 000-1.5h-.253a.25.25 0 01-.244-.304l.459-2.066A1.75 1.75 0 009.253 9H9z",clipRule:"evenodd"})),pH=Nt.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",height:"20",width:"20"},Nt.createElement("path",{fillRule:"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-8-5a.75.75 0 01.75.75v4.5a.75.75 0 01-1.5 0v-4.5A.75.75 0 0110 5zm0 10a1 1 0 100-2 1 1 0 000 2z",clipRule:"evenodd"})),mH=()=>{let[t,r]=Nt.useState(document.hidden);return Nt.useEffect(()=>{let l=()=>{r(document.hidden)};return document.addEventListener("visibilitychange",l),()=>window.removeEventListener("visibilitychange",l)},[]),t},TC=1,gH=class{constructor(){this.subscribe=t=>(this.subscribers.push(t),()=>{let r=this.subscribers.indexOf(t);this.subscribers.splice(r,1)}),this.publish=t=>{this.subscribers.forEach(r=>r(t))},this.addToast=t=>{this.publish(t),this.toasts=[...this.toasts,t]},this.create=t=>{var r;let{message:l,...d}=t,_=typeof(t==null?void 0:t.id)=="number"||((r=t.id)==null?void 0:r.length)>0?t.id:TC++,x=this.toasts.find(s=>s.id===_),C=t.dismissible===void 0?!0:t.dismissible;return x?this.toasts=this.toasts.map(s=>s.id===_?(this.publish({...s,...t,id:_,title:l}),{...s,...t,id:_,dismissible:C,title:l}):s):this.addToast({title:l,...d,dismissible:C,id:_}),_},this.dismiss=t=>(t||this.toasts.forEach(r=>{this.subscribers.forEach(l=>l({id:r.id,dismiss:!0}))}),this.subscribers.forEach(r=>r({id:t,dismiss:!0})),t),this.message=(t,r)=>this.create({...r,message:t}),this.error=(t,r)=>this.create({...r,message:t,type:"error"}),this.success=(t,r)=>this.create({...r,type:"success",message:t}),this.info=(t,r)=>this.create({...r,type:"info",message:t}),this.warning=(t,r)=>this.create({...r,type:"warning",message:t}),this.loading=(t,r)=>this.create({...r,type:"loading",message:t}),this.promise=(t,r)=>{if(!r)return;let l;r.loading!==void 0&&(l=this.create({...r,promise:t,type:"loading",message:r.loading,description:typeof r.description!="function"?r.description:void 0}));let d=t instanceof Promise?t:t(),_=l!==void 0;return d.then(async x=>{if(yH(x)&&!x.ok){_=!1;let C=typeof r.error=="function"?await r.error(`HTTP error! status: ${x.status}`):r.error,s=typeof r.description=="function"?await r.description(`HTTP error! status: ${x.status}`):r.description;this.create({id:l,type:"error",message:C,description:s})}else if(r.success!==void 0){_=!1;let C=typeof r.success=="function"?await r.success(x):r.success,s=typeof r.description=="function"?await r.description(x):r.description;this.create({id:l,type:"success",message:C,description:s})}}).catch(async x=>{if(r.error!==void 0){_=!1;let C=typeof r.error=="function"?await r.error(x):r.error,s=typeof r.description=="function"?await r.description(x):r.description;this.create({id:l,type:"error",message:C,description:s})}}).finally(()=>{var x;_&&(this.dismiss(l),l=void 0),(x=r.finally)==null||x.call(r)}),l},this.custom=(t,r)=>{let l=(r==null?void 0:r.id)||TC++;return this.create({jsx:t(l),id:l,...r}),l},this.subscribers=[],this.toasts=[]}},Ta=new gH,_H=(t,r)=>{let l=(r==null?void 0:r.id)||TC++;return Ta.addToast({title:t,...r,id:l}),l},yH=t=>t&&typeof t=="object"&&"ok"in t&&typeof t.ok=="boolean"&&"status"in t&&typeof t.status=="number",vH=_H,xH=()=>Ta.toasts;Object.assign(vH,{success:Ta.success,info:Ta.info,warning:Ta.warning,error:Ta.error,custom:Ta.custom,message:Ta.message,promise:Ta.promise,dismiss:Ta.dismiss,loading:Ta.loading},{getHistory:xH});function bH(t,{insertAt:r}={}){if(typeof document>"u")return;let l=document.head||document.getElementsByTagName("head")[0],d=document.createElement("style");d.type="text/css",r==="top"&&l.firstChild?l.insertBefore(d,l.firstChild):l.appendChild(d),d.styleSheet?d.styleSheet.cssText=t:d.appendChild(document.createTextNode(t))}bH(`:where(html[dir="ltr"]),:where([data-sonner-toaster][dir="ltr"]){--toast-icon-margin-start: -3px;--toast-icon-margin-end: 4px;--toast-svg-margin-start: -1px;--toast-svg-margin-end: 0px;--toast-button-margin-start: auto;--toast-button-margin-end: 0;--toast-close-button-start: 0;--toast-close-button-end: unset;--toast-close-button-transform: translate(-35%, -35%)}:where(html[dir="rtl"]),:where([data-sonner-toaster][dir="rtl"]){--toast-icon-margin-start: 4px;--toast-icon-margin-end: -3px;--toast-svg-margin-start: 0px;--toast-svg-margin-end: -1px;--toast-button-margin-start: 0;--toast-button-margin-end: auto;--toast-close-button-start: unset;--toast-close-button-end: 0;--toast-close-button-transform: translate(35%, -35%)}:where([data-sonner-toaster]){position:fixed;width:var(--width);font-family:ui-sans-serif,system-ui,-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Helvetica Neue,Arial,Noto Sans,sans-serif,Apple Color Emoji,Segoe UI Emoji,Segoe UI Symbol,Noto Color Emoji;--gray1: hsl(0, 0%, 99%);--gray2: hsl(0, 0%, 97.3%);--gray3: hsl(0, 0%, 95.1%);--gray4: hsl(0, 0%, 93%);--gray5: hsl(0, 0%, 90.9%);--gray6: hsl(0, 0%, 88.7%);--gray7: hsl(0, 0%, 85.8%);--gray8: hsl(0, 0%, 78%);--gray9: hsl(0, 0%, 56.1%);--gray10: hsl(0, 0%, 52.3%);--gray11: hsl(0, 0%, 43.5%);--gray12: hsl(0, 0%, 9%);--border-radius: 8px;box-sizing:border-box;padding:0;margin:0;list-style:none;outline:none;z-index:999999999}:where([data-sonner-toaster][data-x-position="right"]){right:max(var(--offset),env(safe-area-inset-right))}:where([data-sonner-toaster][data-x-position="left"]){left:max(var(--offset),env(safe-area-inset-left))}:where([data-sonner-toaster][data-x-position="center"]){left:50%;transform:translate(-50%)}:where([data-sonner-toaster][data-y-position="top"]){top:max(var(--offset),env(safe-area-inset-top))}:where([data-sonner-toaster][data-y-position="bottom"]){bottom:max(var(--offset),env(safe-area-inset-bottom))}:where([data-sonner-toast]){--y: translateY(100%);--lift-amount: calc(var(--lift) * var(--gap));z-index:var(--z-index);position:absolute;opacity:0;transform:var(--y);filter:blur(0);touch-action:none;transition:transform .4s,opacity .4s,height .4s,box-shadow .2s;box-sizing:border-box;outline:none;overflow-wrap:anywhere}:where([data-sonner-toast][data-styled="true"]){padding:16px;background:var(--normal-bg);border:1px solid var(--normal-border);color:var(--normal-text);border-radius:var(--border-radius);box-shadow:0 4px 12px #0000001a;width:var(--width);font-size:13px;display:flex;align-items:center;gap:6px}:where([data-sonner-toast]:focus-visible){box-shadow:0 4px 12px #0000001a,0 0 0 2px #0003}:where([data-sonner-toast][data-y-position="top"]){top:0;--y: translateY(-100%);--lift: 1;--lift-amount: calc(1 * var(--gap))}:where([data-sonner-toast][data-y-position="bottom"]){bottom:0;--y: translateY(100%);--lift: -1;--lift-amount: calc(var(--lift) * var(--gap))}:where([data-sonner-toast]) :where([data-description]){font-weight:400;line-height:1.4;color:inherit}:where([data-sonner-toast]) :where([data-title]){font-weight:500;line-height:1.5;color:inherit}:where([data-sonner-toast]) :where([data-icon]){display:flex;height:16px;width:16px;position:relative;justify-content:flex-start;align-items:center;flex-shrink:0;margin-left:var(--toast-icon-margin-start);margin-right:var(--toast-icon-margin-end)}:where([data-sonner-toast][data-promise="true"]) :where([data-icon])>svg{opacity:0;transform:scale(.8);transform-origin:center;animation:sonner-fade-in .3s ease forwards}:where([data-sonner-toast]) :where([data-icon])>*{flex-shrink:0}:where([data-sonner-toast]) :where([data-icon]) svg{margin-left:var(--toast-svg-margin-start);margin-right:var(--toast-svg-margin-end)}:where([data-sonner-toast]) :where([data-content]){display:flex;flex-direction:column;gap:2px}[data-sonner-toast][data-styled=true] [data-button]{border-radius:4px;padding-left:8px;padding-right:8px;height:24px;font-size:12px;color:var(--normal-bg);background:var(--normal-text);margin-left:var(--toast-button-margin-start);margin-right:var(--toast-button-margin-end);border:none;cursor:pointer;outline:none;display:flex;align-items:center;flex-shrink:0;transition:opacity .4s,box-shadow .2s}:where([data-sonner-toast]) :where([data-button]):focus-visible{box-shadow:0 0 0 2px #0006}:where([data-sonner-toast]) :where([data-button]):first-of-type{margin-left:var(--toast-button-margin-start);margin-right:var(--toast-button-margin-end)}:where([data-sonner-toast]) :where([data-cancel]){color:var(--normal-text);background:rgba(0,0,0,.08)}:where([data-sonner-toast][data-theme="dark"]) :where([data-cancel]){background:rgba(255,255,255,.3)}:where([data-sonner-toast]) :where([data-close-button]){position:absolute;left:var(--toast-close-button-start);right:var(--toast-close-button-end);top:0;height:20px;width:20px;display:flex;justify-content:center;align-items:center;padding:0;background:var(--gray1);color:var(--gray12);border:1px solid var(--gray4);transform:var(--toast-close-button-transform);border-radius:50%;cursor:pointer;z-index:1;transition:opacity .1s,background .2s,border-color .2s}:where([data-sonner-toast]) :where([data-close-button]):focus-visible{box-shadow:0 4px 12px #0000001a,0 0 0 2px #0003}:where([data-sonner-toast]) :where([data-disabled="true"]){cursor:not-allowed}:where([data-sonner-toast]):hover :where([data-close-button]):hover{background:var(--gray2);border-color:var(--gray5)}:where([data-sonner-toast][data-swiping="true"]):before{content:"";position:absolute;left:0;right:0;height:100%;z-index:-1}:where([data-sonner-toast][data-y-position="top"][data-swiping="true"]):before{bottom:50%;transform:scaleY(3) translateY(50%)}:where([data-sonner-toast][data-y-position="bottom"][data-swiping="true"]):before{top:50%;transform:scaleY(3) translateY(-50%)}:where([data-sonner-toast][data-swiping="false"][data-removed="true"]):before{content:"";position:absolute;inset:0;transform:scaleY(2)}:where([data-sonner-toast]):after{content:"";position:absolute;left:0;height:calc(var(--gap) + 1px);bottom:100%;width:100%}:where([data-sonner-toast][data-mounted="true"]){--y: translateY(0);opacity:1}:where([data-sonner-toast][data-expanded="false"][data-front="false"]){--scale: var(--toasts-before) * .05 + 1;--y: translateY(calc(var(--lift-amount) * var(--toasts-before))) scale(calc(-1 * var(--scale)));height:var(--front-toast-height)}:where([data-sonner-toast])>*{transition:opacity .4s}:where([data-sonner-toast][data-expanded="false"][data-front="false"][data-styled="true"])>*{opacity:0}:where([data-sonner-toast][data-visible="false"]){opacity:0;pointer-events:none}:where([data-sonner-toast][data-mounted="true"][data-expanded="true"]){--y: translateY(calc(var(--lift) * var(--offset)));height:var(--initial-height)}:where([data-sonner-toast][data-removed="true"][data-front="true"][data-swipe-out="false"]){--y: translateY(calc(var(--lift) * -100%));opacity:0}:where([data-sonner-toast][data-removed="true"][data-front="false"][data-swipe-out="false"][data-expanded="true"]){--y: translateY(calc(var(--lift) * var(--offset) + var(--lift) * -100%));opacity:0}:where([data-sonner-toast][data-removed="true"][data-front="false"][data-swipe-out="false"][data-expanded="false"]){--y: translateY(40%);opacity:0;transition:transform .5s,opacity .2s}:where([data-sonner-toast][data-removed="true"][data-front="false"]):before{height:calc(var(--initial-height) + 20%)}[data-sonner-toast][data-swiping=true]{transform:var(--y) translateY(var(--swipe-amount, 0px));transition:none}[data-sonner-toast][data-swipe-out=true][data-y-position=bottom],[data-sonner-toast][data-swipe-out=true][data-y-position=top]{animation:swipe-out .2s ease-out forwards}@keyframes swipe-out{0%{transform:translateY(calc(var(--lift) * var(--offset) + var(--swipe-amount)));opacity:1}to{transform:translateY(calc(var(--lift) * var(--offset) + var(--swipe-amount) + var(--lift) * -100%));opacity:0}}@media (max-width: 600px){[data-sonner-toaster]{position:fixed;--mobile-offset: 16px;right:var(--mobile-offset);left:var(--mobile-offset);width:100%}[data-sonner-toaster] [data-sonner-toast]{left:0;right:0;width:calc(100% - var(--mobile-offset) * 2)}[data-sonner-toaster][data-x-position=left]{left:var(--mobile-offset)}[data-sonner-toaster][data-y-position=bottom]{bottom:20px}[data-sonner-toaster][data-y-position=top]{top:20px}[data-sonner-toaster][data-x-position=center]{left:var(--mobile-offset);right:var(--mobile-offset);transform:none}}[data-sonner-toaster][data-theme=light]{--normal-bg: #fff;--normal-border: var(--gray4);--normal-text: var(--gray12);--success-bg: hsl(143, 85%, 96%);--success-border: hsl(145, 92%, 91%);--success-text: hsl(140, 100%, 27%);--info-bg: hsl(208, 100%, 97%);--info-border: hsl(221, 91%, 91%);--info-text: hsl(210, 92%, 45%);--warning-bg: hsl(49, 100%, 97%);--warning-border: hsl(49, 91%, 91%);--warning-text: hsl(31, 92%, 45%);--error-bg: hsl(359, 100%, 97%);--error-border: hsl(359, 100%, 94%);--error-text: hsl(360, 100%, 45%)}[data-sonner-toaster][data-theme=light] [data-sonner-toast][data-invert=true]{--normal-bg: #000;--normal-border: hsl(0, 0%, 20%);--normal-text: var(--gray1)}[data-sonner-toaster][data-theme=dark] [data-sonner-toast][data-invert=true]{--normal-bg: #fff;--normal-border: var(--gray3);--normal-text: var(--gray12)}[data-sonner-toaster][data-theme=dark]{--normal-bg: #000;--normal-border: hsl(0, 0%, 20%);--normal-text: var(--gray1);--success-bg: hsl(150, 100%, 6%);--success-border: hsl(147, 100%, 12%);--success-text: hsl(150, 86%, 65%);--info-bg: hsl(215, 100%, 6%);--info-border: hsl(223, 100%, 12%);--info-text: hsl(216, 87%, 65%);--warning-bg: hsl(64, 100%, 6%);--warning-border: hsl(60, 100%, 12%);--warning-text: hsl(46, 87%, 65%);--error-bg: hsl(358, 76%, 10%);--error-border: hsl(357, 89%, 16%);--error-text: hsl(358, 100%, 81%)}[data-rich-colors=true][data-sonner-toast][data-type=success],[data-rich-colors=true][data-sonner-toast][data-type=success] [data-close-button]{background:var(--success-bg);border-color:var(--success-border);color:var(--success-text)}[data-rich-colors=true][data-sonner-toast][data-type=info],[data-rich-colors=true][data-sonner-toast][data-type=info] [data-close-button]{background:var(--info-bg);border-color:var(--info-border);color:var(--info-text)}[data-rich-colors=true][data-sonner-toast][data-type=warning],[data-rich-colors=true][data-sonner-toast][data-type=warning] [data-close-button]{background:var(--warning-bg);border-color:var(--warning-border);color:var(--warning-text)}[data-rich-colors=true][data-sonner-toast][data-type=error],[data-rich-colors=true][data-sonner-toast][data-type=error] [data-close-button]{background:var(--error-bg);border-color:var(--error-border);color:var(--error-text)}.sonner-loading-wrapper{--size: 16px;height:var(--size);width:var(--size);position:absolute;inset:0;z-index:10}.sonner-loading-wrapper[data-visible=false]{transform-origin:center;animation:sonner-fade-out .2s ease forwards}.sonner-spinner{position:relative;top:50%;left:50%;height:var(--size);width:var(--size)}.sonner-loading-bar{animation:sonner-spin 1.2s linear infinite;background:var(--gray11);border-radius:6px;height:8%;left:-10%;position:absolute;top:-3.9%;width:24%}.sonner-loading-bar:nth-child(1){animation-delay:-1.2s;transform:rotate(.0001deg) translate(146%)}.sonner-loading-bar:nth-child(2){animation-delay:-1.1s;transform:rotate(30deg) translate(146%)}.sonner-loading-bar:nth-child(3){animation-delay:-1s;transform:rotate(60deg) translate(146%)}.sonner-loading-bar:nth-child(4){animation-delay:-.9s;transform:rotate(90deg) translate(146%)}.sonner-loading-bar:nth-child(5){animation-delay:-.8s;transform:rotate(120deg) translate(146%)}.sonner-loading-bar:nth-child(6){animation-delay:-.7s;transform:rotate(150deg) translate(146%)}.sonner-loading-bar:nth-child(7){animation-delay:-.6s;transform:rotate(180deg) translate(146%)}.sonner-loading-bar:nth-child(8){animation-delay:-.5s;transform:rotate(210deg) translate(146%)}.sonner-loading-bar:nth-child(9){animation-delay:-.4s;transform:rotate(240deg) translate(146%)}.sonner-loading-bar:nth-child(10){animation-delay:-.3s;transform:rotate(270deg) translate(146%)}.sonner-loading-bar:nth-child(11){animation-delay:-.2s;transform:rotate(300deg) translate(146%)}.sonner-loading-bar:nth-child(12){animation-delay:-.1s;transform:rotate(330deg) translate(146%)}@keyframes sonner-fade-in{0%{opacity:0;transform:scale(.8)}to{opacity:1;transform:scale(1)}}@keyframes sonner-fade-out{0%{opacity:1;transform:scale(1)}to{opacity:0;transform:scale(.8)}}@keyframes sonner-spin{0%{opacity:1}to{opacity:.15}}@media (prefers-reduced-motion){[data-sonner-toast],[data-sonner-toast]>*,.sonner-loading-bar{transition:none!important;animation:none!important}}.sonner-loader{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);transform-origin:center;transition:opacity .2s,transform .2s}.sonner-loader[data-visible=false]{opacity:0;transform:scale(.8) translate(-50%,-50%)}
`);function ob(t){return t.label!==void 0}var wH=3,SH="32px",TH=4e3,EH=356,CH=14,AH=20,IH=200;function PH(...t){return t.filter(Boolean).join(" ")}var MH=t=>{var r,l,d,_,x,C,s,k,z,V;let{invert:U,toast:$,unstyled:se,interacting:ae,setHeights:H,visibleToasts:ne,heights:Y,index:te,toasts:de,expanded:Me,removeToast:Le,defaultRichColors:lt,closeButton:Pe,style:Ye,cancelButtonStyle:vt,actionButtonStyle:It,className:Ut="",descriptionClassName:Pt="",duration:$t,position:Ve,gap:jt,loadingIcon:Je,expandByDefault:mt,classNames:Be,icons:ft,closeButtonAriaLabel:Ct="Close toast",pauseWhenPageIsHidden:Zt,cn:fn}=t,[Qn,$n]=Nt.useState(!1),[Hn,rn]=Nt.useState(!1),[an,or]=Nt.useState(!1),[Mn,Mr]=Nt.useState(!1),[Lr,xr]=Nt.useState(0),[Tr,Ki]=Nt.useState(0),Cs=Nt.useRef(null),Ri=Nt.useRef(null),Ws=te===0,We=te+1<=ne,ut=$.type,Mt=$.dismissible!==!1,bn=$.className||"",pn=$.descriptionClassName||"",sn=Nt.useMemo(()=>Y.findIndex(Cn=>Cn.toastId===$.id)||0,[Y,$.id]),kn=Nt.useMemo(()=>{var Cn;return(Cn=$.closeButton)!=null?Cn:Pe},[$.closeButton,Pe]),pr=Nt.useMemo(()=>$.duration||$t||TH,[$.duration,$t]),Ni=Nt.useRef(0),Vr=Nt.useRef(0),Zs=Nt.useRef(0),As=Nt.useRef(null),[ko,Qi]=Ve.split("-"),Ns=Nt.useMemo(()=>Y.reduce((Cn,mi,gi)=>gi>=sn?Cn:Cn+mi.height,0),[Y,sn]),Do=mH(),Yo=$.invert||U,_o=ut==="loading";Vr.current=Nt.useMemo(()=>sn*jt+Ns,[sn,Ns]),Nt.useEffect(()=>{$n(!0)},[]),Nt.useLayoutEffect(()=>{if(!Qn)return;let Cn=Ri.current,mi=Cn.style.height;Cn.style.height="auto";let gi=Cn.getBoundingClientRect().height;Cn.style.height=mi,Ki(gi),H(Ui=>Ui.find(yo=>yo.toastId===$.id)?Ui.map(yo=>yo.toastId===$.id?{...yo,height:gi}:yo):[{toastId:$.id,height:gi,position:$.position},...Ui])},[Qn,$.title,$.description,H,$.id]);let zs=Nt.useCallback(()=>{rn(!0),xr(Vr.current),H(Cn=>Cn.filter(mi=>mi.toastId!==$.id)),setTimeout(()=>{Le($)},IH)},[$,Le,H,Vr]);Nt.useEffect(()=>{if($.promise&&ut==="loading"||$.duration===1/0||$.type==="loading")return;let Cn,mi=pr;return Me||ae||Zt&&Do?(()=>{if(Zs.current<Ni.current){let gi=new Date().getTime()-Ni.current;mi=mi-gi}Zs.current=new Date().getTime()})():mi!==1/0&&(Ni.current=new Date().getTime(),Cn=setTimeout(()=>{var gi;(gi=$.onAutoClose)==null||gi.call($,$),zs()},mi)),()=>clearTimeout(Cn)},[Me,ae,mt,$,pr,zs,$.promise,ut,Zt,Do]),Nt.useEffect(()=>{let Cn=Ri.current;if(Cn){let mi=Cn.getBoundingClientRect().height;return Ki(mi),H(gi=>[{toastId:$.id,height:mi,position:$.position},...gi]),()=>H(gi=>gi.filter(Ui=>Ui.toastId!==$.id))}},[H,$.id]),Nt.useEffect(()=>{$.delete&&zs()},[zs,$.delete]);function Wl(){return ft!=null&&ft.loading?Nt.createElement("div",{className:"sonner-loader","data-visible":ut==="loading"},ft.loading):Je?Nt.createElement("div",{className:"sonner-loader","data-visible":ut==="loading"},Je):Nt.createElement(uH,{visible:ut==="loading"})}return Nt.createElement("li",{"aria-live":$.important?"assertive":"polite","aria-atomic":"true",role:"status",tabIndex:0,ref:Ri,className:fn(Ut,bn,Be==null?void 0:Be.toast,(r=$==null?void 0:$.classNames)==null?void 0:r.toast,Be==null?void 0:Be.default,Be==null?void 0:Be[ut],(l=$==null?void 0:$.classNames)==null?void 0:l[ut]),"data-sonner-toast":"","data-rich-colors":(d=$.richColors)!=null?d:lt,"data-styled":!($.jsx||$.unstyled||se),"data-mounted":Qn,"data-promise":!!$.promise,"data-removed":Hn,"data-visible":We,"data-y-position":ko,"data-x-position":Qi,"data-index":te,"data-front":Ws,"data-swiping":an,"data-dismissible":Mt,"data-type":ut,"data-invert":Yo,"data-swipe-out":Mn,"data-expanded":!!(Me||mt&&Qn),style:{"--index":te,"--toasts-before":te,"--z-index":de.length-te,"--offset":`${Hn?Lr:Vr.current}px`,"--initial-height":mt?"auto":`${Tr}px`,...Ye,...$.style},onPointerDown:Cn=>{_o||!Mt||(Cs.current=new Date,xr(Vr.current),Cn.target.setPointerCapture(Cn.pointerId),Cn.target.tagName!=="BUTTON"&&(or(!0),As.current={x:Cn.clientX,y:Cn.clientY}))},onPointerUp:()=>{var Cn,mi,gi,Ui;if(Mn||!Mt)return;As.current=null;let yo=Number(((Cn=Ri.current)==null?void 0:Cn.style.getPropertyValue("--swipe-amount").replace("px",""))||0),tl=new Date().getTime()-((mi=Cs.current)==null?void 0:mi.getTime()),nl=Math.abs(yo)/tl;if(Math.abs(yo)>=AH||nl>.11){xr(Vr.current),(gi=$.onDismiss)==null||gi.call($,$),zs(),Mr(!0);return}(Ui=Ri.current)==null||Ui.style.setProperty("--swipe-amount","0px"),or(!1)},onPointerMove:Cn=>{var mi;if(!As.current||!Mt)return;let gi=Cn.clientY-As.current.y,Ui=Cn.clientX-As.current.x,yo=(ko==="top"?Math.min:Math.max)(0,gi),tl=Cn.pointerType==="touch"?10:2;Math.abs(yo)>tl?(mi=Ri.current)==null||mi.style.setProperty("--swipe-amount",`${gi}px`):Math.abs(Ui)>tl&&(As.current=null)}},kn&&!$.jsx?Nt.createElement("button",{"aria-label":Ct,"data-disabled":_o,"data-close-button":!0,onClick:_o||!Mt?()=>{}:()=>{var Cn;zs(),(Cn=$.onDismiss)==null||Cn.call($,$)},className:fn(Be==null?void 0:Be.closeButton,(_=$==null?void 0:$.classNames)==null?void 0:_.closeButton)},Nt.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",width:"12",height:"12",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"},Nt.createElement("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),Nt.createElement("line",{x1:"6",y1:"6",x2:"18",y2:"18"}))):null,$.jsx||Nt.isValidElement($.title)?$.jsx||$.title:Nt.createElement(Nt.Fragment,null,ut||$.icon||$.promise?Nt.createElement("div",{"data-icon":"",className:fn(Be==null?void 0:Be.icon,(x=$==null?void 0:$.classNames)==null?void 0:x.icon)},$.promise||$.type==="loading"&&!$.icon?$.icon||Wl():null,$.type!=="loading"?$.icon||(ft==null?void 0:ft[ut])||lH(ut):null):null,Nt.createElement("div",{"data-content":"",className:fn(Be==null?void 0:Be.content,(C=$==null?void 0:$.classNames)==null?void 0:C.content)},Nt.createElement("div",{"data-title":"",className:fn(Be==null?void 0:Be.title,(s=$==null?void 0:$.classNames)==null?void 0:s.title)},$.title),$.description?Nt.createElement("div",{"data-description":"",className:fn(Pt,pn,Be==null?void 0:Be.description,(k=$==null?void 0:$.classNames)==null?void 0:k.description)},$.description):null),Nt.isValidElement($.cancel)?$.cancel:$.cancel&&ob($.cancel)?Nt.createElement("button",{"data-button":!0,"data-cancel":!0,style:$.cancelButtonStyle||vt,onClick:Cn=>{var mi,gi;ob($.cancel)&&Mt&&((gi=(mi=$.cancel).onClick)==null||gi.call(mi,Cn),zs())},className:fn(Be==null?void 0:Be.cancelButton,(z=$==null?void 0:$.classNames)==null?void 0:z.cancelButton)},$.cancel.label):null,Nt.isValidElement($.action)?$.action:$.action&&ob($.action)?Nt.createElement("button",{"data-button":!0,"data-action":!0,style:$.actionButtonStyle||It,onClick:Cn=>{var mi,gi;ob($.action)&&(Cn.defaultPrevented||((gi=(mi=$.action).onClick)==null||gi.call(mi,Cn),zs()))},className:fn(Be==null?void 0:Be.actionButton,(V=$==null?void 0:$.classNames)==null?void 0:V.actionButton)},$.action.label):null))};function CL(){if(typeof window>"u"||typeof document>"u")return"ltr";let t=document.documentElement.getAttribute("dir");return t==="auto"||!t?window.getComputedStyle(document.documentElement).direction:t}var RH=t=>{let{invert:r,position:l="bottom-right",hotkey:d=["altKey","KeyT"],expand:_,closeButton:x,className:C,offset:s,theme:k="light",richColors:z,duration:V,style:U,visibleToasts:$=wH,toastOptions:se,dir:ae=CL(),gap:H=CH,loadingIcon:ne,icons:Y,containerAriaLabel:te="Notifications",pauseWhenPageIsHidden:de,cn:Me=PH}=t,[Le,lt]=Nt.useState([]),Pe=Nt.useMemo(()=>Array.from(new Set([l].concat(Le.filter(Zt=>Zt.position).map(Zt=>Zt.position)))),[Le,l]),[Ye,vt]=Nt.useState([]),[It,Ut]=Nt.useState(!1),[Pt,$t]=Nt.useState(!1),[Ve,jt]=Nt.useState(k!=="system"?k:typeof window<"u"&&window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light"),Je=Nt.useRef(null),mt=d.join("+").replace(/Key/g,"").replace(/Digit/g,""),Be=Nt.useRef(null),ft=Nt.useRef(!1),Ct=Nt.useCallback(Zt=>{var fn;(fn=Le.find(Qn=>Qn.id===Zt.id))!=null&&fn.delete||Ta.dismiss(Zt.id),lt(Qn=>Qn.filter(({id:$n})=>$n!==Zt.id))},[Le]);return Nt.useEffect(()=>Ta.subscribe(Zt=>{if(Zt.dismiss){lt(fn=>fn.map(Qn=>Qn.id===Zt.id?{...Qn,delete:!0}:Qn));return}setTimeout(()=>{iO.flushSync(()=>{lt(fn=>{let Qn=fn.findIndex($n=>$n.id===Zt.id);return Qn!==-1?[...fn.slice(0,Qn),{...fn[Qn],...Zt},...fn.slice(Qn+1)]:[Zt,...fn]})})})}),[]),Nt.useEffect(()=>{if(k!=="system"){jt(k);return}k==="system"&&(window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches?jt("dark"):jt("light")),typeof window<"u"&&window.matchMedia("(prefers-color-scheme: dark)").addEventListener("change",({matches:Zt})=>{jt(Zt?"dark":"light")})},[k]),Nt.useEffect(()=>{Le.length<=1&&Ut(!1)},[Le]),Nt.useEffect(()=>{let Zt=fn=>{var Qn,$n;d.every(Hn=>fn[Hn]||fn.code===Hn)&&(Ut(!0),(Qn=Je.current)==null||Qn.focus()),fn.code==="Escape"&&(document.activeElement===Je.current||($n=Je.current)!=null&&$n.contains(document.activeElement))&&Ut(!1)};return document.addEventListener("keydown",Zt),()=>document.removeEventListener("keydown",Zt)},[d]),Nt.useEffect(()=>{if(Je.current)return()=>{Be.current&&(Be.current.focus({preventScroll:!0}),Be.current=null,ft.current=!1)}},[Je.current]),Le.length?Nt.createElement("section",{"aria-label":`${te} ${mt}`,tabIndex:-1},Pe.map((Zt,fn)=>{var Qn;let[$n,Hn]=Zt.split("-");return Nt.createElement("ol",{key:Zt,dir:ae==="auto"?CL():ae,tabIndex:-1,ref:Je,className:C,"data-sonner-toaster":!0,"data-theme":Ve,"data-y-position":$n,"data-x-position":Hn,style:{"--front-toast-height":`${((Qn=Ye[0])==null?void 0:Qn.height)||0}px`,"--offset":typeof s=="number"?`${s}px`:s||SH,"--width":`${EH}px`,"--gap":`${H}px`,...U},onBlur:rn=>{ft.current&&!rn.currentTarget.contains(rn.relatedTarget)&&(ft.current=!1,Be.current&&(Be.current.focus({preventScroll:!0}),Be.current=null))},onFocus:rn=>{rn.target instanceof HTMLElement&&rn.target.dataset.dismissible==="false"||ft.current||(ft.current=!0,Be.current=rn.relatedTarget)},onMouseEnter:()=>Ut(!0),onMouseMove:()=>Ut(!0),onMouseLeave:()=>{Pt||Ut(!1)},onPointerDown:rn=>{rn.target instanceof HTMLElement&&rn.target.dataset.dismissible==="false"||$t(!0)},onPointerUp:()=>$t(!1)},Le.filter(rn=>!rn.position&&fn===0||rn.position===Zt).map((rn,an)=>{var or,Mn;return Nt.createElement(MH,{key:rn.id,icons:Y,index:an,toast:rn,defaultRichColors:z,duration:(or=se==null?void 0:se.duration)!=null?or:V,className:se==null?void 0:se.className,descriptionClassName:se==null?void 0:se.descriptionClassName,invert:r,visibleToasts:$,closeButton:(Mn=se==null?void 0:se.closeButton)!=null?Mn:x,interacting:Pt,position:Zt,style:se==null?void 0:se.style,unstyled:se==null?void 0:se.unstyled,classNames:se==null?void 0:se.classNames,cancelButtonStyle:se==null?void 0:se.cancelButtonStyle,actionButtonStyle:se==null?void 0:se.actionButtonStyle,removeToast:Ct,toasts:Le.filter(Mr=>Mr.position==rn.position),heights:Ye.filter(Mr=>Mr.position==rn.position),setHeights:vt,expandByDefault:_,gap:H,loadingIcon:ne,expanded:It,pauseWhenPageIsHidden:de,cn:Me})}))})):null};const kH=({...t})=>{const{theme:r="system"}=aH();return w.jsx(RH,{theme:r,className:"toaster group",toastOptions:{classNames:{toast:"group toast group-[.toaster]:bg-background group-[.toaster]:text-foreground group-[.toaster]:border-border group-[.toaster]:shadow-lg",description:"group-[.toast]:text-muted-foreground",actionButton:"group-[.toast]:bg-primary group-[.toast]:text-primary-foreground",cancelButton:"group-[.toast]:bg-muted group-[.toast]:text-muted-foreground"}},...t})};var DH=t3.useId||(()=>{}),LH=0;function Ol(t){const[r,l]=B.useState(DH());return qs(()=>{l(d=>d??String(LH++))},[t]),r?`radix-${r}`:""}const NH=["top","right","bottom","left"],ah=Math.min,Ca=Math.max,cw=Math.round,ab=Math.floor,lh=t=>({x:t,y:t}),zH={left:"right",right:"left",bottom:"top",top:"bottom"},OH={start:"end",end:"start"};function EC(t,r,l){return Ca(t,ah(r,l))}function Au(t,r){return typeof t=="function"?t(r):t}function Iu(t){return t.split("-")[0]}function s_(t){return t.split("-")[1]}function gI(t){return t==="x"?"y":"x"}function _I(t){return t==="y"?"height":"width"}function ch(t){return["top","bottom"].includes(Iu(t))?"y":"x"}function yI(t){return gI(ch(t))}function FH(t,r,l){l===void 0&&(l=!1);const d=s_(t),_=yI(t),x=_I(_);let C=_==="x"?d===(l?"end":"start")?"right":"left":d==="start"?"bottom":"top";return r.reference[x]>r.floating[x]&&(C=uw(C)),[C,uw(C)]}function jH(t){const r=uw(t);return[CC(t),r,CC(r)]}function CC(t){return t.replace(/start|end/g,r=>OH[r])}function BH(t,r,l){const d=["left","right"],_=["right","left"],x=["top","bottom"],C=["bottom","top"];switch(t){case"top":case"bottom":return l?r?_:d:r?d:_;case"left":case"right":return r?x:C;default:return[]}}function VH(t,r,l,d){const _=s_(t);let x=BH(Iu(t),l==="start",d);return _&&(x=x.map(C=>C+"-"+_),r&&(x=x.concat(x.map(CC)))),x}function uw(t){return t.replace(/left|right|bottom|top/g,r=>zH[r])}function UH(t){return{top:0,right:0,bottom:0,left:0,...t}}function JO(t){return typeof t!="number"?UH(t):{top:t,right:t,bottom:t,left:t}}function dw(t){const{x:r,y:l,width:d,height:_}=t;return{width:d,height:_,top:l,left:r,right:r+d,bottom:l+_,x:r,y:l}}function AL(t,r,l){let{reference:d,floating:_}=t;const x=ch(r),C=yI(r),s=_I(C),k=Iu(r),z=x==="y",V=d.x+d.width/2-_.width/2,U=d.y+d.height/2-_.height/2,$=d[s]/2-_[s]/2;let se;switch(k){case"top":se={x:V,y:d.y-_.height};break;case"bottom":se={x:V,y:d.y+d.height};break;case"right":se={x:d.x+d.width,y:U};break;case"left":se={x:d.x-_.width,y:U};break;default:se={x:d.x,y:d.y}}switch(s_(r)){case"start":se[C]-=$*(l&&z?-1:1);break;case"end":se[C]+=$*(l&&z?-1:1);break}return se}const $H=async(t,r,l)=>{const{placement:d="bottom",strategy:_="absolute",middleware:x=[],platform:C}=l,s=x.filter(Boolean),k=await(C.isRTL==null?void 0:C.isRTL(r));let z=await C.getElementRects({reference:t,floating:r,strategy:_}),{x:V,y:U}=AL(z,d,k),$=d,se={},ae=0;for(let H=0;H<s.length;H++){const{name:ne,fn:Y}=s[H],{x:te,y:de,data:Me,reset:Le}=await Y({x:V,y:U,initialPlacement:d,placement:$,strategy:_,middlewareData:se,rects:z,platform:C,elements:{reference:t,floating:r}});V=te??V,U=de??U,se={...se,[ne]:{...se[ne],...Me}},Le&&ae<=50&&(ae++,typeof Le=="object"&&(Le.placement&&($=Le.placement),Le.rects&&(z=Le.rects===!0?await C.getElementRects({reference:t,floating:r,strategy:_}):Le.rects),{x:V,y:U}=AL(z,$,k)),H=-1)}return{x:V,y:U,placement:$,strategy:_,middlewareData:se}};async function tx(t,r){var l;r===void 0&&(r={});const{x:d,y:_,platform:x,rects:C,elements:s,strategy:k}=t,{boundary:z="clippingAncestors",rootBoundary:V="viewport",elementContext:U="floating",altBoundary:$=!1,padding:se=0}=Au(r,t),ae=JO(se),ne=s[$?U==="floating"?"reference":"floating":U],Y=dw(await x.getClippingRect({element:(l=await(x.isElement==null?void 0:x.isElement(ne)))==null||l?ne:ne.contextElement||await(x.getDocumentElement==null?void 0:x.getDocumentElement(s.floating)),boundary:z,rootBoundary:V,strategy:k})),te=U==="floating"?{x:d,y:_,width:C.floating.width,height:C.floating.height}:C.reference,de=await(x.getOffsetParent==null?void 0:x.getOffsetParent(s.floating)),Me=await(x.isElement==null?void 0:x.isElement(de))?await(x.getScale==null?void 0:x.getScale(de))||{x:1,y:1}:{x:1,y:1},Le=dw(x.convertOffsetParentRelativeRectToViewportRelativeRect?await x.convertOffsetParentRelativeRectToViewportRelativeRect({elements:s,rect:te,offsetParent:de,strategy:k}):te);return{top:(Y.top-Le.top+ae.top)/Me.y,bottom:(Le.bottom-Y.bottom+ae.bottom)/Me.y,left:(Y.left-Le.left+ae.left)/Me.x,right:(Le.right-Y.right+ae.right)/Me.x}}const GH=t=>({name:"arrow",options:t,async fn(r){const{x:l,y:d,placement:_,rects:x,platform:C,elements:s,middlewareData:k}=r,{element:z,padding:V=0}=Au(t,r)||{};if(z==null)return{};const U=JO(V),$={x:l,y:d},se=yI(_),ae=_I(se),H=await C.getDimensions(z),ne=se==="y",Y=ne?"top":"left",te=ne?"bottom":"right",de=ne?"clientHeight":"clientWidth",Me=x.reference[ae]+x.reference[se]-$[se]-x.floating[ae],Le=$[se]-x.reference[se],lt=await(C.getOffsetParent==null?void 0:C.getOffsetParent(z));let Pe=lt?lt[de]:0;(!Pe||!await(C.isElement==null?void 0:C.isElement(lt)))&&(Pe=s.floating[de]||x.floating[ae]);const Ye=Me/2-Le/2,vt=Pe/2-H[ae]/2-1,It=ah(U[Y],vt),Ut=ah(U[te],vt),Pt=It,$t=Pe-H[ae]-Ut,Ve=Pe/2-H[ae]/2+Ye,jt=EC(Pt,Ve,$t),Je=!k.arrow&&s_(_)!=null&&Ve!==jt&&x.reference[ae]/2-(Ve<Pt?It:Ut)-H[ae]/2<0,mt=Je?Ve<Pt?Ve-Pt:Ve-$t:0;return{[se]:$[se]+mt,data:{[se]:jt,centerOffset:Ve-jt-mt,...Je&&{alignmentOffset:mt}},reset:Je}}}),HH=function(t){return t===void 0&&(t={}),{name:"flip",options:t,async fn(r){var l,d;const{placement:_,middlewareData:x,rects:C,initialPlacement:s,platform:k,elements:z}=r,{mainAxis:V=!0,crossAxis:U=!0,fallbackPlacements:$,fallbackStrategy:se="bestFit",fallbackAxisSideDirection:ae="none",flipAlignment:H=!0,...ne}=Au(t,r);if((l=x.arrow)!=null&&l.alignmentOffset)return{};const Y=Iu(_),te=ch(s),de=Iu(s)===s,Me=await(k.isRTL==null?void 0:k.isRTL(z.floating)),Le=$||(de||!H?[uw(s)]:jH(s)),lt=ae!=="none";!$&&lt&&Le.push(...VH(s,H,ae,Me));const Pe=[s,...Le],Ye=await tx(r,ne),vt=[];let It=((d=x.flip)==null?void 0:d.overflows)||[];if(V&&vt.push(Ye[Y]),U){const Ve=FH(_,C,Me);vt.push(Ye[Ve[0]],Ye[Ve[1]])}if(It=[...It,{placement:_,overflows:vt}],!vt.every(Ve=>Ve<=0)){var Ut,Pt;const Ve=(((Ut=x.flip)==null?void 0:Ut.index)||0)+1,jt=Pe[Ve];if(jt)return{data:{index:Ve,overflows:It},reset:{placement:jt}};let Je=(Pt=It.filter(mt=>mt.overflows[0]<=0).sort((mt,Be)=>mt.overflows[1]-Be.overflows[1])[0])==null?void 0:Pt.placement;if(!Je)switch(se){case"bestFit":{var $t;const mt=($t=It.filter(Be=>{if(lt){const ft=ch(Be.placement);return ft===te||ft==="y"}return!0}).map(Be=>[Be.placement,Be.overflows.filter(ft=>ft>0).reduce((ft,Ct)=>ft+Ct,0)]).sort((Be,ft)=>Be[1]-ft[1])[0])==null?void 0:$t[0];mt&&(Je=mt);break}case"initialPlacement":Je=s;break}if(_!==Je)return{reset:{placement:Je}}}return{}}}};function IL(t,r){return{top:t.top-r.height,right:t.right-r.width,bottom:t.bottom-r.height,left:t.left-r.width}}function PL(t){return NH.some(r=>t[r]>=0)}const qH=function(t){return t===void 0&&(t={}),{name:"hide",options:t,async fn(r){const{rects:l}=r,{strategy:d="referenceHidden",..._}=Au(t,r);switch(d){case"referenceHidden":{const x=await tx(r,{..._,elementContext:"reference"}),C=IL(x,l.reference);return{data:{referenceHiddenOffsets:C,referenceHidden:PL(C)}}}case"escaped":{const x=await tx(r,{..._,altBoundary:!0}),C=IL(x,l.floating);return{data:{escapedOffsets:C,escaped:PL(C)}}}default:return{}}}}};async function WH(t,r){const{placement:l,platform:d,elements:_}=t,x=await(d.isRTL==null?void 0:d.isRTL(_.floating)),C=Iu(l),s=s_(l),k=ch(l)==="y",z=["left","top"].includes(C)?-1:1,V=x&&k?-1:1,U=Au(r,t);let{mainAxis:$,crossAxis:se,alignmentAxis:ae}=typeof U=="number"?{mainAxis:U,crossAxis:0,alignmentAxis:null}:{mainAxis:U.mainAxis||0,crossAxis:U.crossAxis||0,alignmentAxis:U.alignmentAxis};return s&&typeof ae=="number"&&(se=s==="end"?ae*-1:ae),k?{x:se*V,y:$*z}:{x:$*z,y:se*V}}const ZH=function(t){return t===void 0&&(t=0),{name:"offset",options:t,async fn(r){var l,d;const{x:_,y:x,placement:C,middlewareData:s}=r,k=await WH(r,t);return C===((l=s.offset)==null?void 0:l.placement)&&(d=s.arrow)!=null&&d.alignmentOffset?{}:{x:_+k.x,y:x+k.y,data:{...k,placement:C}}}}},XH=function(t){return t===void 0&&(t={}),{name:"shift",options:t,async fn(r){const{x:l,y:d,placement:_}=r,{mainAxis:x=!0,crossAxis:C=!1,limiter:s={fn:ne=>{let{x:Y,y:te}=ne;return{x:Y,y:te}}},...k}=Au(t,r),z={x:l,y:d},V=await tx(r,k),U=ch(Iu(_)),$=gI(U);let se=z[$],ae=z[U];if(x){const ne=$==="y"?"top":"left",Y=$==="y"?"bottom":"right",te=se+V[ne],de=se-V[Y];se=EC(te,se,de)}if(C){const ne=U==="y"?"top":"left",Y=U==="y"?"bottom":"right",te=ae+V[ne],de=ae-V[Y];ae=EC(te,ae,de)}const H=s.fn({...r,[$]:se,[U]:ae});return{...H,data:{x:H.x-l,y:H.y-d,enabled:{[$]:x,[U]:C}}}}}},YH=function(t){return t===void 0&&(t={}),{options:t,fn(r){const{x:l,y:d,placement:_,rects:x,middlewareData:C}=r,{offset:s=0,mainAxis:k=!0,crossAxis:z=!0}=Au(t,r),V={x:l,y:d},U=ch(_),$=gI(U);let se=V[$],ae=V[U];const H=Au(s,r),ne=typeof H=="number"?{mainAxis:H,crossAxis:0}:{mainAxis:0,crossAxis:0,...H};if(k){const de=$==="y"?"height":"width",Me=x.reference[$]-x.floating[de]+ne.mainAxis,Le=x.reference[$]+x.reference[de]-ne.mainAxis;se<Me?se=Me:se>Le&&(se=Le)}if(z){var Y,te;const de=$==="y"?"width":"height",Me=["top","left"].includes(Iu(_)),Le=x.reference[U]-x.floating[de]+(Me&&((Y=C.offset)==null?void 0:Y[U])||0)+(Me?0:ne.crossAxis),lt=x.reference[U]+x.reference[de]+(Me?0:((te=C.offset)==null?void 0:te[U])||0)-(Me?ne.crossAxis:0);ae<Le?ae=Le:ae>lt&&(ae=lt)}return{[$]:se,[U]:ae}}}},KH=function(t){return t===void 0&&(t={}),{name:"size",options:t,async fn(r){var l,d;const{placement:_,rects:x,platform:C,elements:s}=r,{apply:k=()=>{},...z}=Au(t,r),V=await tx(r,z),U=Iu(_),$=s_(_),se=ch(_)==="y",{width:ae,height:H}=x.floating;let ne,Y;U==="top"||U==="bottom"?(ne=U,Y=$===(await(C.isRTL==null?void 0:C.isRTL(s.floating))?"start":"end")?"left":"right"):(Y=U,ne=$==="end"?"top":"bottom");const te=H-V.top-V.bottom,de=ae-V.left-V.right,Me=ah(H-V[ne],te),Le=ah(ae-V[Y],de),lt=!r.middlewareData.shift;let Pe=Me,Ye=Le;if((l=r.middlewareData.shift)!=null&&l.enabled.x&&(Ye=de),(d=r.middlewareData.shift)!=null&&d.enabled.y&&(Pe=te),lt&&!$){const It=Ca(V.left,0),Ut=Ca(V.right,0),Pt=Ca(V.top,0),$t=Ca(V.bottom,0);se?Ye=ae-2*(It!==0||Ut!==0?It+Ut:Ca(V.left,V.right)):Pe=H-2*(Pt!==0||$t!==0?Pt+$t:Ca(V.top,V.bottom))}await k({...r,availableWidth:Ye,availableHeight:Pe});const vt=await C.getDimensions(s.floating);return ae!==vt.width||H!==vt.height?{reset:{rects:!0}}:{}}}};function s2(){return typeof window<"u"}function o_(t){return eF(t)?(t.nodeName||"").toLowerCase():"#document"}function Ma(t){var r;return(t==null||(r=t.ownerDocument)==null?void 0:r.defaultView)||window}function zc(t){var r;return(r=(eF(t)?t.ownerDocument:t.document)||window.document)==null?void 0:r.documentElement}function eF(t){return s2()?t instanceof Node||t instanceof Ma(t).Node:!1}function Vl(t){return s2()?t instanceof Element||t instanceof Ma(t).Element:!1}function Dc(t){return s2()?t instanceof HTMLElement||t instanceof Ma(t).HTMLElement:!1}function ML(t){return!s2()||typeof ShadowRoot>"u"?!1:t instanceof ShadowRoot||t instanceof Ma(t).ShadowRoot}function kx(t){const{overflow:r,overflowX:l,overflowY:d,display:_}=Ul(t);return/auto|scroll|overlay|hidden|clip/.test(r+d+l)&&!["inline","contents"].includes(_)}function QH(t){return["table","td","th"].includes(o_(t))}function o2(t){return[":popover-open",":modal"].some(r=>{try{return t.matches(r)}catch{return!1}})}function vI(t){const r=xI(),l=Vl(t)?Ul(t):t;return l.transform!=="none"||l.perspective!=="none"||(l.containerType?l.containerType!=="normal":!1)||!r&&(l.backdropFilter?l.backdropFilter!=="none":!1)||!r&&(l.filter?l.filter!=="none":!1)||["transform","perspective","filter"].some(d=>(l.willChange||"").includes(d))||["paint","layout","strict","content"].some(d=>(l.contain||"").includes(d))}function JH(t){let r=uh(t);for(;Dc(r)&&!$g(r);){if(vI(r))return r;if(o2(r))return null;r=uh(r)}return null}function xI(){return typeof CSS>"u"||!CSS.supports?!1:CSS.supports("-webkit-backdrop-filter","none")}function $g(t){return["html","body","#document"].includes(o_(t))}function Ul(t){return Ma(t).getComputedStyle(t)}function a2(t){return Vl(t)?{scrollLeft:t.scrollLeft,scrollTop:t.scrollTop}:{scrollLeft:t.scrollX,scrollTop:t.scrollY}}function uh(t){if(o_(t)==="html")return t;const r=t.assignedSlot||t.parentNode||ML(t)&&t.host||zc(t);return ML(r)?r.host:r}function tF(t){const r=uh(t);return $g(r)?t.ownerDocument?t.ownerDocument.body:t.body:Dc(r)&&kx(r)?r:tF(r)}function nx(t,r,l){var d;r===void 0&&(r=[]),l===void 0&&(l=!0);const _=tF(t),x=_===((d=t.ownerDocument)==null?void 0:d.body),C=Ma(_);if(x){const s=AC(C);return r.concat(C,C.visualViewport||[],kx(_)?_:[],s&&l?nx(s):[])}return r.concat(_,nx(_,[],l))}function AC(t){return t.parent&&Object.getPrototypeOf(t.parent)?t.frameElement:null}function nF(t){const r=Ul(t);let l=parseFloat(r.width)||0,d=parseFloat(r.height)||0;const _=Dc(t),x=_?t.offsetWidth:l,C=_?t.offsetHeight:d,s=cw(l)!==x||cw(d)!==C;return s&&(l=x,d=C),{width:l,height:d,$:s}}function bI(t){return Vl(t)?t:t.contextElement}function gg(t){const r=bI(t);if(!Dc(r))return lh(1);const l=r.getBoundingClientRect(),{width:d,height:_,$:x}=nF(r);let C=(x?cw(l.width):l.width)/d,s=(x?cw(l.height):l.height)/_;return(!C||!Number.isFinite(C))&&(C=1),(!s||!Number.isFinite(s))&&(s=1),{x:C,y:s}}const eq=lh(0);function rF(t){const r=Ma(t);return!xI()||!r.visualViewport?eq:{x:r.visualViewport.offsetLeft,y:r.visualViewport.offsetTop}}function tq(t,r,l){return r===void 0&&(r=!1),!l||r&&l!==Ma(t)?!1:r}function rp(t,r,l,d){r===void 0&&(r=!1),l===void 0&&(l=!1);const _=t.getBoundingClientRect(),x=bI(t);let C=lh(1);r&&(d?Vl(d)&&(C=gg(d)):C=gg(t));const s=tq(x,l,d)?rF(x):lh(0);let k=(_.left+s.x)/C.x,z=(_.top+s.y)/C.y,V=_.width/C.x,U=_.height/C.y;if(x){const $=Ma(x),se=d&&Vl(d)?Ma(d):d;let ae=$,H=AC(ae);for(;H&&d&&se!==ae;){const ne=gg(H),Y=H.getBoundingClientRect(),te=Ul(H),de=Y.left+(H.clientLeft+parseFloat(te.paddingLeft))*ne.x,Me=Y.top+(H.clientTop+parseFloat(te.paddingTop))*ne.y;k*=ne.x,z*=ne.y,V*=ne.x,U*=ne.y,k+=de,z+=Me,ae=Ma(H),H=AC(ae)}}return dw({width:V,height:U,x:k,y:z})}function nq(t){let{elements:r,rect:l,offsetParent:d,strategy:_}=t;const x=_==="fixed",C=zc(d),s=r?o2(r.floating):!1;if(d===C||s&&x)return l;let k={scrollLeft:0,scrollTop:0},z=lh(1);const V=lh(0),U=Dc(d);if((U||!U&&!x)&&((o_(d)!=="body"||kx(C))&&(k=a2(d)),Dc(d))){const $=rp(d);z=gg(d),V.x=$.x+d.clientLeft,V.y=$.y+d.clientTop}return{width:l.width*z.x,height:l.height*z.y,x:l.x*z.x-k.scrollLeft*z.x+V.x,y:l.y*z.y-k.scrollTop*z.y+V.y}}function rq(t){return Array.from(t.getClientRects())}function IC(t,r){const l=a2(t).scrollLeft;return r?r.left+l:rp(zc(t)).left+l}function iq(t){const r=zc(t),l=a2(t),d=t.ownerDocument.body,_=Ca(r.scrollWidth,r.clientWidth,d.scrollWidth,d.clientWidth),x=Ca(r.scrollHeight,r.clientHeight,d.scrollHeight,d.clientHeight);let C=-l.scrollLeft+IC(t);const s=-l.scrollTop;return Ul(d).direction==="rtl"&&(C+=Ca(r.clientWidth,d.clientWidth)-_),{width:_,height:x,x:C,y:s}}function sq(t,r){const l=Ma(t),d=zc(t),_=l.visualViewport;let x=d.clientWidth,C=d.clientHeight,s=0,k=0;if(_){x=_.width,C=_.height;const z=xI();(!z||z&&r==="fixed")&&(s=_.offsetLeft,k=_.offsetTop)}return{width:x,height:C,x:s,y:k}}function oq(t,r){const l=rp(t,!0,r==="fixed"),d=l.top+t.clientTop,_=l.left+t.clientLeft,x=Dc(t)?gg(t):lh(1),C=t.clientWidth*x.x,s=t.clientHeight*x.y,k=_*x.x,z=d*x.y;return{width:C,height:s,x:k,y:z}}function RL(t,r,l){let d;if(r==="viewport")d=sq(t,l);else if(r==="document")d=iq(zc(t));else if(Vl(r))d=oq(r,l);else{const _=rF(t);d={...r,x:r.x-_.x,y:r.y-_.y}}return dw(d)}function iF(t,r){const l=uh(t);return l===r||!Vl(l)||$g(l)?!1:Ul(l).position==="fixed"||iF(l,r)}function aq(t,r){const l=r.get(t);if(l)return l;let d=nx(t,[],!1).filter(s=>Vl(s)&&o_(s)!=="body"),_=null;const x=Ul(t).position==="fixed";let C=x?uh(t):t;for(;Vl(C)&&!$g(C);){const s=Ul(C),k=vI(C);!k&&s.position==="fixed"&&(_=null),(x?!k&&!_:!k&&s.position==="static"&&!!_&&["absolute","fixed"].includes(_.position)||kx(C)&&!k&&iF(t,C))?d=d.filter(V=>V!==C):_=s,C=uh(C)}return r.set(t,d),d}function lq(t){let{element:r,boundary:l,rootBoundary:d,strategy:_}=t;const C=[...l==="clippingAncestors"?o2(r)?[]:aq(r,this._c):[].concat(l),d],s=C[0],k=C.reduce((z,V)=>{const U=RL(r,V,_);return z.top=Ca(U.top,z.top),z.right=ah(U.right,z.right),z.bottom=ah(U.bottom,z.bottom),z.left=Ca(U.left,z.left),z},RL(r,s,_));return{width:k.right-k.left,height:k.bottom-k.top,x:k.left,y:k.top}}function cq(t){const{width:r,height:l}=nF(t);return{width:r,height:l}}function uq(t,r,l){const d=Dc(r),_=zc(r),x=l==="fixed",C=rp(t,!0,x,r);let s={scrollLeft:0,scrollTop:0};const k=lh(0);if(d||!d&&!x)if((o_(r)!=="body"||kx(_))&&(s=a2(r)),d){const se=rp(r,!0,x,r);k.x=se.x+r.clientLeft,k.y=se.y+r.clientTop}else _&&(k.x=IC(_));let z=0,V=0;if(_&&!d&&!x){const se=_.getBoundingClientRect();V=se.top+s.scrollTop,z=se.left+s.scrollLeft-IC(_,se)}const U=C.left+s.scrollLeft-k.x-z,$=C.top+s.scrollTop-k.y-V;return{x:U,y:$,width:C.width,height:C.height}}function cE(t){return Ul(t).position==="static"}function kL(t,r){if(!Dc(t)||Ul(t).position==="fixed")return null;if(r)return r(t);let l=t.offsetParent;return zc(t)===l&&(l=l.ownerDocument.body),l}function sF(t,r){const l=Ma(t);if(o2(t))return l;if(!Dc(t)){let _=uh(t);for(;_&&!$g(_);){if(Vl(_)&&!cE(_))return _;_=uh(_)}return l}let d=kL(t,r);for(;d&&QH(d)&&cE(d);)d=kL(d,r);return d&&$g(d)&&cE(d)&&!vI(d)?l:d||JH(t)||l}const dq=async function(t){const r=this.getOffsetParent||sF,l=this.getDimensions,d=await l(t.floating);return{reference:uq(t.reference,await r(t.floating),t.strategy),floating:{x:0,y:0,width:d.width,height:d.height}}};function hq(t){return Ul(t).direction==="rtl"}const fq={convertOffsetParentRelativeRectToViewportRelativeRect:nq,getDocumentElement:zc,getClippingRect:lq,getOffsetParent:sF,getElementRects:dq,getClientRects:rq,getDimensions:cq,getScale:gg,isElement:Vl,isRTL:hq};function pq(t,r){let l=null,d;const _=zc(t);function x(){var s;clearTimeout(d),(s=l)==null||s.disconnect(),l=null}function C(s,k){s===void 0&&(s=!1),k===void 0&&(k=1),x();const{left:z,top:V,width:U,height:$}=t.getBoundingClientRect();if(s||r(),!U||!$)return;const se=ab(V),ae=ab(_.clientWidth-(z+U)),H=ab(_.clientHeight-(V+$)),ne=ab(z),te={rootMargin:-se+"px "+-ae+"px "+-H+"px "+-ne+"px",threshold:Ca(0,ah(1,k))||1};let de=!0;function Me(Le){const lt=Le[0].intersectionRatio;if(lt!==k){if(!de)return C();lt?C(!1,lt):d=setTimeout(()=>{C(!1,1e-7)},1e3)}de=!1}try{l=new IntersectionObserver(Me,{...te,root:_.ownerDocument})}catch{l=new IntersectionObserver(Me,te)}l.observe(t)}return C(!0),x}function mq(t,r,l,d){d===void 0&&(d={});const{ancestorScroll:_=!0,ancestorResize:x=!0,elementResize:C=typeof ResizeObserver=="function",layoutShift:s=typeof IntersectionObserver=="function",animationFrame:k=!1}=d,z=bI(t),V=_||x?[...z?nx(z):[],...nx(r)]:[];V.forEach(Y=>{_&&Y.addEventListener("scroll",l,{passive:!0}),x&&Y.addEventListener("resize",l)});const U=z&&s?pq(z,l):null;let $=-1,se=null;C&&(se=new ResizeObserver(Y=>{let[te]=Y;te&&te.target===z&&se&&(se.unobserve(r),cancelAnimationFrame($),$=requestAnimationFrame(()=>{var de;(de=se)==null||de.observe(r)})),l()}),z&&!k&&se.observe(z),se.observe(r));let ae,H=k?rp(t):null;k&&ne();function ne(){const Y=rp(t);H&&(Y.x!==H.x||Y.y!==H.y||Y.width!==H.width||Y.height!==H.height)&&l(),H=Y,ae=requestAnimationFrame(ne)}return l(),()=>{var Y;V.forEach(te=>{_&&te.removeEventListener("scroll",l),x&&te.removeEventListener("resize",l)}),U==null||U(),(Y=se)==null||Y.disconnect(),se=null,k&&cancelAnimationFrame(ae)}}const gq=ZH,_q=XH,yq=HH,vq=KH,xq=qH,DL=GH,bq=YH,wq=(t,r,l)=>{const d=new Map,_={platform:fq,...l},x={..._.platform,_c:d};return $H(t,r,{..._,platform:x})};var Rb=typeof document<"u"?B.useLayoutEffect:B.useEffect;function hw(t,r){if(t===r)return!0;if(typeof t!=typeof r)return!1;if(typeof t=="function"&&t.toString()===r.toString())return!0;let l,d,_;if(t&&r&&typeof t=="object"){if(Array.isArray(t)){if(l=t.length,l!==r.length)return!1;for(d=l;d--!==0;)if(!hw(t[d],r[d]))return!1;return!0}if(_=Object.keys(t),l=_.length,l!==Object.keys(r).length)return!1;for(d=l;d--!==0;)if(!{}.hasOwnProperty.call(r,_[d]))return!1;for(d=l;d--!==0;){const x=_[d];if(!(x==="_owner"&&t.$$typeof)&&!hw(t[x],r[x]))return!1}return!0}return t!==t&&r!==r}function oF(t){return typeof window>"u"?1:(t.ownerDocument.defaultView||window).devicePixelRatio||1}function LL(t,r){const l=oF(t);return Math.round(r*l)/l}function uE(t){const r=B.useRef(t);return Rb(()=>{r.current=t}),r}function Sq(t){t===void 0&&(t={});const{placement:r="bottom",strategy:l="absolute",middleware:d=[],platform:_,elements:{reference:x,floating:C}={},transform:s=!0,whileElementsMounted:k,open:z}=t,[V,U]=B.useState({x:0,y:0,strategy:l,placement:r,middlewareData:{},isPositioned:!1}),[$,se]=B.useState(d);hw($,d)||se(d);const[ae,H]=B.useState(null),[ne,Y]=B.useState(null),te=B.useCallback(Be=>{Be!==lt.current&&(lt.current=Be,H(Be))},[]),de=B.useCallback(Be=>{Be!==Pe.current&&(Pe.current=Be,Y(Be))},[]),Me=x||ae,Le=C||ne,lt=B.useRef(null),Pe=B.useRef(null),Ye=B.useRef(V),vt=k!=null,It=uE(k),Ut=uE(_),Pt=uE(z),$t=B.useCallback(()=>{if(!lt.current||!Pe.current)return;const Be={placement:r,strategy:l,middleware:$};Ut.current&&(Be.platform=Ut.current),wq(lt.current,Pe.current,Be).then(ft=>{const Ct={...ft,isPositioned:Pt.current!==!1};Ve.current&&!hw(Ye.current,Ct)&&(Ye.current=Ct,_p.flushSync(()=>{U(Ct)}))})},[$,r,l,Ut,Pt]);Rb(()=>{z===!1&&Ye.current.isPositioned&&(Ye.current.isPositioned=!1,U(Be=>({...Be,isPositioned:!1})))},[z]);const Ve=B.useRef(!1);Rb(()=>(Ve.current=!0,()=>{Ve.current=!1}),[]),Rb(()=>{if(Me&&(lt.current=Me),Le&&(Pe.current=Le),Me&&Le){if(It.current)return It.current(Me,Le,$t);$t()}},[Me,Le,$t,It,vt]);const jt=B.useMemo(()=>({reference:lt,floating:Pe,setReference:te,setFloating:de}),[te,de]),Je=B.useMemo(()=>({reference:Me,floating:Le}),[Me,Le]),mt=B.useMemo(()=>{const Be={position:l,left:0,top:0};if(!Je.floating)return Be;const ft=LL(Je.floating,V.x),Ct=LL(Je.floating,V.y);return s?{...Be,transform:"translate("+ft+"px, "+Ct+"px)",...oF(Je.floating)>=1.5&&{willChange:"transform"}}:{position:l,left:ft,top:Ct}},[l,s,Je.floating,V.x,V.y]);return B.useMemo(()=>({...V,update:$t,refs:jt,elements:Je,floatingStyles:mt}),[V,$t,jt,Je,mt])}const Tq=t=>{function r(l){return{}.hasOwnProperty.call(l,"current")}return{name:"arrow",options:t,fn(l){const{element:d,padding:_}=typeof t=="function"?t(l):t;return d&&r(d)?d.current!=null?DL({element:d.current,padding:_}).fn(l):{}:d?DL({element:d,padding:_}).fn(l):{}}}},Eq=(t,r)=>({...gq(t),options:[t,r]}),Cq=(t,r)=>({..._q(t),options:[t,r]}),Aq=(t,r)=>({...bq(t),options:[t,r]}),Iq=(t,r)=>({...yq(t),options:[t,r]}),Pq=(t,r)=>({...vq(t),options:[t,r]}),Mq=(t,r)=>({...xq(t),options:[t,r]}),Rq=(t,r)=>({...Tq(t),options:[t,r]});var kq="Arrow",aF=B.forwardRef((t,r)=>{const{children:l,width:d=10,height:_=5,...x}=t;return w.jsx(ir.svg,{...x,ref:r,width:d,height:_,viewBox:"0 0 30 10",preserveAspectRatio:"none",children:t.asChild?l:w.jsx("polygon",{points:"0,0 30,0 15,10"})})});aF.displayName=kq;var Dq=aF;function Lq(t,r=[]){let l=[];function d(x,C){const s=B.createContext(C),k=l.length;l=[...l,C];function z(U){const{scope:$,children:se,...ae}=U,H=($==null?void 0:$[t][k])||s,ne=B.useMemo(()=>ae,Object.values(ae));return w.jsx(H.Provider,{value:ne,children:se})}function V(U,$){const se=($==null?void 0:$[t][k])||s,ae=B.useContext(se);if(ae)return ae;if(C!==void 0)return C;throw new Error(`\`${U}\` must be used within \`${x}\``)}return z.displayName=x+"Provider",[z,V]}const _=()=>{const x=l.map(C=>B.createContext(C));return function(s){const k=(s==null?void 0:s[t])||x;return B.useMemo(()=>({[`__scope${t}`]:{...s,[t]:k}}),[s,k])}};return _.scopeName=t,[d,Nq(_,...r)]}function Nq(...t){const r=t[0];if(t.length===1)return r;const l=()=>{const d=t.map(_=>({useScope:_(),scopeName:_.scopeName}));return function(x){const C=d.reduce((s,{useScope:k,scopeName:z})=>{const U=k(x)[`__scope${z}`];return{...s,...U}},{});return B.useMemo(()=>({[`__scope${r.scopeName}`]:C}),[C])}};return l.scopeName=r.scopeName,l}function lF(t){const[r,l]=B.useState(void 0);return qs(()=>{if(t){l({width:t.offsetWidth,height:t.offsetHeight});const d=new ResizeObserver(_=>{if(!Array.isArray(_)||!_.length)return;const x=_[0];let C,s;if("borderBoxSize"in x){const k=x.borderBoxSize,z=Array.isArray(k)?k[0]:k;C=z.inlineSize,s=z.blockSize}else C=t.offsetWidth,s=t.offsetHeight;l({width:C,height:s})});return d.observe(t,{box:"border-box"}),()=>d.unobserve(t)}else l(void 0)},[t]),r}var wI="Popper",[cF,xh]=Lq(wI),[zq,uF]=cF(wI),dF=t=>{const{__scopePopper:r,children:l}=t,[d,_]=B.useState(null);return w.jsx(zq,{scope:r,anchor:d,onAnchorChange:_,children:l})};dF.displayName=wI;var hF="PopperAnchor",fF=B.forwardRef((t,r)=>{const{__scopePopper:l,virtualRef:d,..._}=t,x=uF(hF,l),C=B.useRef(null),s=ni(r,C);return B.useEffect(()=>{x.onAnchorChange((d==null?void 0:d.current)||C.current)}),d?null:w.jsx(ir.div,{..._,ref:s})});fF.displayName=hF;var SI="PopperContent",[Oq,Fq]=cF(SI),pF=B.forwardRef((t,r)=>{var an,or,Mn,Mr,Lr,xr;const{__scopePopper:l,side:d="bottom",sideOffset:_=0,align:x="center",alignOffset:C=0,arrowPadding:s=0,avoidCollisions:k=!0,collisionBoundary:z=[],collisionPadding:V=0,sticky:U="partial",hideWhenDetached:$=!1,updatePositionStrategy:se="optimized",onPlaced:ae,...H}=t,ne=uF(SI,l),[Y,te]=B.useState(null),de=ni(r,Tr=>te(Tr)),[Me,Le]=B.useState(null),lt=lF(Me),Pe=(lt==null?void 0:lt.width)??0,Ye=(lt==null?void 0:lt.height)??0,vt=d+(x!=="center"?"-"+x:""),It=typeof V=="number"?V:{top:0,right:0,bottom:0,left:0,...V},Ut=Array.isArray(z)?z:[z],Pt=Ut.length>0,$t={padding:It,boundary:Ut.filter(Bq),altBoundary:Pt},{refs:Ve,floatingStyles:jt,placement:Je,isPositioned:mt,middlewareData:Be}=Sq({strategy:"fixed",placement:vt,whileElementsMounted:(...Tr)=>mq(...Tr,{animationFrame:se==="always"}),elements:{reference:ne.anchor},middleware:[Eq({mainAxis:_+Ye,alignmentAxis:C}),k&&Cq({mainAxis:!0,crossAxis:!1,limiter:U==="partial"?Aq():void 0,...$t}),k&&Iq({...$t}),Pq({...$t,apply:({elements:Tr,rects:Ki,availableWidth:Cs,availableHeight:Ri})=>{const{width:Ws,height:We}=Ki.reference,ut=Tr.floating.style;ut.setProperty("--radix-popper-available-width",`${Cs}px`),ut.setProperty("--radix-popper-available-height",`${Ri}px`),ut.setProperty("--radix-popper-anchor-width",`${Ws}px`),ut.setProperty("--radix-popper-anchor-height",`${We}px`)}}),Me&&Rq({element:Me,padding:s}),Vq({arrowWidth:Pe,arrowHeight:Ye}),$&&Mq({strategy:"referenceHidden",...$t})]}),[ft,Ct]=_F(Je),Zt=os(ae);qs(()=>{mt&&(Zt==null||Zt())},[mt,Zt]);const fn=(an=Be.arrow)==null?void 0:an.x,Qn=(or=Be.arrow)==null?void 0:or.y,$n=((Mn=Be.arrow)==null?void 0:Mn.centerOffset)!==0,[Hn,rn]=B.useState();return qs(()=>{Y&&rn(window.getComputedStyle(Y).zIndex)},[Y]),w.jsx("div",{ref:Ve.setFloating,"data-radix-popper-content-wrapper":"",style:{...jt,transform:mt?jt.transform:"translate(0, -200%)",minWidth:"max-content",zIndex:Hn,"--radix-popper-transform-origin":[(Mr=Be.transformOrigin)==null?void 0:Mr.x,(Lr=Be.transformOrigin)==null?void 0:Lr.y].join(" "),...((xr=Be.hide)==null?void 0:xr.referenceHidden)&&{visibility:"hidden",pointerEvents:"none"}},dir:t.dir,children:w.jsx(Oq,{scope:l,placedSide:ft,onArrowChange:Le,arrowX:fn,arrowY:Qn,shouldHideArrow:$n,children:w.jsx(ir.div,{"data-side":ft,"data-align":Ct,...H,ref:de,style:{...H.style,animation:mt?void 0:"none"}})})})});pF.displayName=SI;var mF="PopperArrow",jq={top:"bottom",right:"left",bottom:"top",left:"right"},gF=B.forwardRef(function(r,l){const{__scopePopper:d,..._}=r,x=Fq(mF,d),C=jq[x.placedSide];return w.jsx("span",{ref:x.onArrowChange,style:{position:"absolute",left:x.arrowX,top:x.arrowY,[C]:0,transformOrigin:{top:"",right:"0 0",bottom:"center 0",left:"100% 0"}[x.placedSide],transform:{top:"translateY(100%)",right:"translateY(50%) rotate(90deg) translateX(-50%)",bottom:"rotate(180deg)",left:"translateY(50%) rotate(-90deg) translateX(50%)"}[x.placedSide],visibility:x.shouldHideArrow?"hidden":void 0},children:w.jsx(Dq,{..._,ref:l,style:{..._.style,display:"block"}})})});gF.displayName=mF;function Bq(t){return t!==null}var Vq=t=>({name:"transformOrigin",options:t,fn(r){var ne,Y,te;const{placement:l,rects:d,middlewareData:_}=r,C=((ne=_.arrow)==null?void 0:ne.centerOffset)!==0,s=C?0:t.arrowWidth,k=C?0:t.arrowHeight,[z,V]=_F(l),U={start:"0%",center:"50%",end:"100%"}[V],$=(((Y=_.arrow)==null?void 0:Y.x)??0)+s/2,se=(((te=_.arrow)==null?void 0:te.y)??0)+k/2;let ae="",H="";return z==="bottom"?(ae=C?U:`${$}px`,H=`${-k}px`):z==="top"?(ae=C?U:`${$}px`,H=`${d.floating.height+k}px`):z==="right"?(ae=`${-k}px`,H=C?U:`${se}px`):z==="left"&&(ae=`${d.floating.width+k}px`,H=C?U:`${se}px`),{data:{x:ae,y:H}}}});function _F(t){const[r,l="center"]=t.split("-");return[r,l]}var TI=dF,Dx=fF,l2=pF,c2=gF,[u2,qte]=Gl("Tooltip",[xh]),EI=xh(),yF="TooltipProvider",Uq=700,NL="tooltip.open",[$q,vF]=u2(yF),xF=t=>{const{__scopeTooltip:r,delayDuration:l=Uq,skipDelayDuration:d=300,disableHoverableContent:_=!1,children:x}=t,[C,s]=B.useState(!0),k=B.useRef(!1),z=B.useRef(0);return B.useEffect(()=>{const V=z.current;return()=>window.clearTimeout(V)},[]),w.jsx($q,{scope:r,isOpenDelayed:C,delayDuration:l,onOpen:B.useCallback(()=>{window.clearTimeout(z.current),s(!1)},[]),onClose:B.useCallback(()=>{window.clearTimeout(z.current),z.current=window.setTimeout(()=>s(!0),d)},[d]),isPointerInTransitRef:k,onPointerInTransitChange:B.useCallback(V=>{k.current=V},[]),disableHoverableContent:_,children:x})};xF.displayName=yF;var bF="Tooltip",[Wte,d2]=u2(bF),PC="TooltipTrigger",Gq=B.forwardRef((t,r)=>{const{__scopeTooltip:l,...d}=t,_=d2(PC,l),x=vF(PC,l),C=EI(l),s=B.useRef(null),k=ni(r,s,_.onTriggerChange),z=B.useRef(!1),V=B.useRef(!1),U=B.useCallback(()=>z.current=!1,[]);return B.useEffect(()=>()=>document.removeEventListener("pointerup",U),[U]),w.jsx(Dx,{asChild:!0,...C,children:w.jsx(ir.button,{"aria-describedby":_.open?_.contentId:void 0,"data-state":_.stateAttribute,...d,ref:k,onPointerMove:mn(t.onPointerMove,$=>{$.pointerType!=="touch"&&!V.current&&!x.isPointerInTransitRef.current&&(_.onTriggerEnter(),V.current=!0)}),onPointerLeave:mn(t.onPointerLeave,()=>{_.onTriggerLeave(),V.current=!1}),onPointerDown:mn(t.onPointerDown,()=>{z.current=!0,document.addEventListener("pointerup",U,{once:!0})}),onFocus:mn(t.onFocus,()=>{z.current||_.onOpen()}),onBlur:mn(t.onBlur,_.onClose),onClick:mn(t.onClick,_.onClose)})})});Gq.displayName=PC;var Hq="TooltipPortal",[Zte,qq]=u2(Hq,{forceMount:void 0}),Gg="TooltipContent",wF=B.forwardRef((t,r)=>{const l=qq(Gg,t.__scopeTooltip),{forceMount:d=l.forceMount,side:_="top",...x}=t,C=d2(Gg,t.__scopeTooltip);return w.jsx(io,{present:d||C.open,children:C.disableHoverableContent?w.jsx(SF,{side:_,...x,ref:r}):w.jsx(Wq,{side:_,...x,ref:r})})}),Wq=B.forwardRef((t,r)=>{const l=d2(Gg,t.__scopeTooltip),d=vF(Gg,t.__scopeTooltip),_=B.useRef(null),x=ni(r,_),[C,s]=B.useState(null),{trigger:k,onClose:z}=l,V=_.current,{onPointerInTransitChange:U}=d,$=B.useCallback(()=>{s(null),U(!1)},[U]),se=B.useCallback((ae,H)=>{const ne=ae.currentTarget,Y={x:ae.clientX,y:ae.clientY},te=Kq(Y,ne.getBoundingClientRect()),de=Qq(Y,te),Me=Jq(H.getBoundingClientRect()),Le=tW([...de,...Me]);s(Le),U(!0)},[U]);return B.useEffect(()=>()=>$(),[$]),B.useEffect(()=>{if(k&&V){const ae=ne=>se(ne,V),H=ne=>se(ne,k);return k.addEventListener("pointerleave",ae),V.addEventListener("pointerleave",H),()=>{k.removeEventListener("pointerleave",ae),V.removeEventListener("pointerleave",H)}}},[k,V,se,$]),B.useEffect(()=>{if(C){const ae=H=>{const ne=H.target,Y={x:H.clientX,y:H.clientY},te=(k==null?void 0:k.contains(ne))||(V==null?void 0:V.contains(ne)),de=!eW(Y,C);te?$():de&&($(),z())};return document.addEventListener("pointermove",ae),()=>document.removeEventListener("pointermove",ae)}},[k,V,C,z,$]),w.jsx(SF,{...t,ref:x})}),[Zq,Xq]=u2(bF,{isInside:!1}),SF=B.forwardRef((t,r)=>{const{__scopeTooltip:l,children:d,"aria-label":_,onEscapeKeyDown:x,onPointerDownOutside:C,...s}=t,k=d2(Gg,l),z=EI(l),{onClose:V}=k;return B.useEffect(()=>(document.addEventListener(NL,V),()=>document.removeEventListener(NL,V)),[V]),B.useEffect(()=>{if(k.trigger){const U=$=>{const se=$.target;se!=null&&se.contains(k.trigger)&&V()};return window.addEventListener("scroll",U,{capture:!0}),()=>window.removeEventListener("scroll",U,{capture:!0})}},[k.trigger,V]),w.jsx(vp,{asChild:!0,disableOutsidePointerEvents:!1,onEscapeKeyDown:x,onPointerDownOutside:C,onFocusOutside:U=>U.preventDefault(),onDismiss:V,children:w.jsxs(l2,{"data-state":k.stateAttribute,...z,...s,ref:r,style:{...s.style,"--radix-tooltip-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-tooltip-content-available-width":"var(--radix-popper-available-width)","--radix-tooltip-content-available-height":"var(--radix-popper-available-height)","--radix-tooltip-trigger-width":"var(--radix-popper-anchor-width)","--radix-tooltip-trigger-height":"var(--radix-popper-anchor-height)"},children:[w.jsx(oO,{children:d}),w.jsx(Zq,{scope:l,isInside:!0,children:w.jsx(O9,{id:k.contentId,role:"tooltip",children:_||d})})]})})});wF.displayName=Gg;var TF="TooltipArrow",Yq=B.forwardRef((t,r)=>{const{__scopeTooltip:l,...d}=t,_=EI(l);return Xq(TF,l).isInside?null:w.jsx(c2,{..._,...d,ref:r})});Yq.displayName=TF;function Kq(t,r){const l=Math.abs(r.top-t.y),d=Math.abs(r.bottom-t.y),_=Math.abs(r.right-t.x),x=Math.abs(r.left-t.x);switch(Math.min(l,d,_,x)){case x:return"left";case _:return"right";case l:return"top";case d:return"bottom";default:throw new Error("unreachable")}}function Qq(t,r,l=5){const d=[];switch(r){case"top":d.push({x:t.x-l,y:t.y+l},{x:t.x+l,y:t.y+l});break;case"bottom":d.push({x:t.x-l,y:t.y-l},{x:t.x+l,y:t.y-l});break;case"left":d.push({x:t.x+l,y:t.y-l},{x:t.x+l,y:t.y+l});break;case"right":d.push({x:t.x-l,y:t.y-l},{x:t.x-l,y:t.y+l});break}return d}function Jq(t){const{top:r,right:l,bottom:d,left:_}=t;return[{x:_,y:r},{x:l,y:r},{x:l,y:d},{x:_,y:d}]}function eW(t,r){const{x:l,y:d}=t;let _=!1;for(let x=0,C=r.length-1;x<r.length;C=x++){const s=r[x].x,k=r[x].y,z=r[C].x,V=r[C].y;k>d!=V>d&&l<(z-s)*(d-k)/(V-k)+s&&(_=!_)}return _}function tW(t){const r=t.slice();return r.sort((l,d)=>l.x<d.x?-1:l.x>d.x?1:l.y<d.y?-1:l.y>d.y?1:0),nW(r)}function nW(t){if(t.length<=1)return t.slice();const r=[];for(let d=0;d<t.length;d++){const _=t[d];for(;r.length>=2;){const x=r[r.length-1],C=r[r.length-2];if((x.x-C.x)*(_.y-C.y)>=(x.y-C.y)*(_.x-C.x))r.pop();else break}r.push(_)}r.pop();const l=[];for(let d=t.length-1;d>=0;d--){const _=t[d];for(;l.length>=2;){const x=l[l.length-1],C=l[l.length-2];if((x.x-C.x)*(_.y-C.y)>=(x.y-C.y)*(_.x-C.x))l.pop();else break}l.push(_)}return l.pop(),r.length===1&&l.length===1&&r[0].x===l[0].x&&r[0].y===l[0].y?r:r.concat(l)}var rW=xF,EF=wF;const iW=rW,sW=B.forwardRef(({className:t,sideOffset:r=4,...l},d)=>w.jsx(EF,{ref:d,sideOffset:r,className:rr("z-50 overflow-hidden rounded-md border bg-popover px-3 py-1.5 text-sm text-popover-foreground shadow-md animate-in fade-in-0 zoom-in-95 data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=closed]:zoom-out-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",t),...l}));sW.displayName=EF.displayName;var a_=class{constructor(){this.listeners=new Set,this.subscribe=this.subscribe.bind(this)}subscribe(t){return this.listeners.add(t),this.onSubscribe(),()=>{this.listeners.delete(t),this.onUnsubscribe()}}hasListeners(){return this.listeners.size>0}onSubscribe(){}onUnsubscribe(){}},ip=typeof window>"u"||"Deno"in globalThis;function Ha(){}function oW(t,r){return typeof t=="function"?t(r):t}function MC(t){return typeof t=="number"&&t>=0&&t!==1/0}function CF(t,r){return Math.max(t+(r||0)-Date.now(),0)}function _g(t,r){return typeof t=="function"?t(r):t}function Pl(t,r){return typeof t=="function"?t(r):t}function zL(t,r){const{type:l="all",exact:d,fetchStatus:_,predicate:x,queryKey:C,stale:s}=t;if(C){if(d){if(r.queryHash!==CI(C,r.options))return!1}else if(!rx(r.queryKey,C))return!1}if(l!=="all"){const k=r.isActive();if(l==="active"&&!k||l==="inactive"&&k)return!1}return!(typeof s=="boolean"&&r.isStale()!==s||_&&_!==r.state.fetchStatus||x&&!x(r))}function OL(t,r){const{exact:l,status:d,predicate:_,mutationKey:x}=t;if(x){if(!r.options.mutationKey)return!1;if(l){if(sp(r.options.mutationKey)!==sp(x))return!1}else if(!rx(r.options.mutationKey,x))return!1}return!(d&&r.state.status!==d||_&&!_(r))}function CI(t,r){return((r==null?void 0:r.queryKeyHashFn)||sp)(t)}function sp(t){return JSON.stringify(t,(r,l)=>RC(l)?Object.keys(l).sort().reduce((d,_)=>(d[_]=l[_],d),{}):l)}function rx(t,r){return t===r?!0:typeof t!=typeof r?!1:t&&r&&typeof t=="object"&&typeof r=="object"?!Object.keys(r).some(l=>!rx(t[l],r[l])):!1}function AF(t,r){if(t===r)return t;const l=FL(t)&&FL(r);if(l||RC(t)&&RC(r)){const d=l?t:Object.keys(t),_=d.length,x=l?r:Object.keys(r),C=x.length,s=l?[]:{};let k=0;for(let z=0;z<C;z++){const V=l?z:x[z];(!l&&d.includes(V)||l)&&t[V]===void 0&&r[V]===void 0?(s[V]=void 0,k++):(s[V]=AF(t[V],r[V]),s[V]===t[V]&&t[V]!==void 0&&k++)}return _===C&&k===_?t:s}return r}function fw(t,r){if(!r||Object.keys(t).length!==Object.keys(r).length)return!1;for(const l in t)if(t[l]!==r[l])return!1;return!0}function FL(t){return Array.isArray(t)&&t.length===Object.keys(t).length}function RC(t){if(!jL(t))return!1;const r=t.constructor;if(r===void 0)return!0;const l=r.prototype;return!(!jL(l)||!l.hasOwnProperty("isPrototypeOf")||Object.getPrototypeOf(t)!==Object.prototype)}function jL(t){return Object.prototype.toString.call(t)==="[object Object]"}function aW(t){return new Promise(r=>{setTimeout(r,t)})}function kC(t,r,l){return typeof l.structuralSharing=="function"?l.structuralSharing(t,r):l.structuralSharing!==!1?AF(t,r):r}function lW(t,r,l=0){const d=[...t,r];return l&&d.length>l?d.slice(1):d}function cW(t,r,l=0){const d=[r,...t];return l&&d.length>l?d.slice(0,-1):d}var AI=Symbol();function IF(t,r){return!t.queryFn&&(r!=null&&r.initialPromise)?()=>r.initialPromise:!t.queryFn||t.queryFn===AI?()=>Promise.reject(new Error(`Missing queryFn: '${t.queryHash}'`)):t.queryFn}var jf,Od,wg,NN,uW=(NN=class extends a_{constructor(){super();fr(this,jf);fr(this,Od);fr(this,wg);Fn(this,wg,r=>{if(!ip&&window.addEventListener){const l=()=>r();return window.addEventListener("visibilitychange",l,!1),()=>{window.removeEventListener("visibilitychange",l)}}})}onSubscribe(){tt(this,Od)||this.setEventListener(tt(this,wg))}onUnsubscribe(){var r;this.hasListeners()||((r=tt(this,Od))==null||r.call(this),Fn(this,Od,void 0))}setEventListener(r){var l;Fn(this,wg,r),(l=tt(this,Od))==null||l.call(this),Fn(this,Od,r(d=>{typeof d=="boolean"?this.setFocused(d):this.onFocus()}))}setFocused(r){tt(this,jf)!==r&&(Fn(this,jf,r),this.onFocus())}onFocus(){const r=this.isFocused();this.listeners.forEach(l=>{l(r)})}isFocused(){var r;return typeof tt(this,jf)=="boolean"?tt(this,jf):((r=globalThis.document)==null?void 0:r.visibilityState)!=="hidden"}},jf=new WeakMap,Od=new WeakMap,wg=new WeakMap,NN),II=new uW,Sg,Fd,Tg,zN,dW=(zN=class extends a_{constructor(){super();fr(this,Sg,!0);fr(this,Fd);fr(this,Tg);Fn(this,Tg,r=>{if(!ip&&window.addEventListener){const l=()=>r(!0),d=()=>r(!1);return window.addEventListener("online",l,!1),window.addEventListener("offline",d,!1),()=>{window.removeEventListener("online",l),window.removeEventListener("offline",d)}}})}onSubscribe(){tt(this,Fd)||this.setEventListener(tt(this,Tg))}onUnsubscribe(){var r;this.hasListeners()||((r=tt(this,Fd))==null||r.call(this),Fn(this,Fd,void 0))}setEventListener(r){var l;Fn(this,Tg,r),(l=tt(this,Fd))==null||l.call(this),Fn(this,Fd,r(this.setOnline.bind(this)))}setOnline(r){tt(this,Sg)!==r&&(Fn(this,Sg,r),this.listeners.forEach(d=>{d(r)}))}isOnline(){return tt(this,Sg)}},Sg=new WeakMap,Fd=new WeakMap,Tg=new WeakMap,zN),pw=new dW;function DC(){let t,r;const l=new Promise((_,x)=>{t=_,r=x});l.status="pending",l.catch(()=>{});function d(_){Object.assign(l,_),delete l.resolve,delete l.reject}return l.resolve=_=>{d({status:"fulfilled",value:_}),t(_)},l.reject=_=>{d({status:"rejected",reason:_}),r(_)},l}function hW(t){return Math.min(1e3*2**t,3e4)}function PF(t){return(t??"online")==="online"?pw.isOnline():!0}var MF=class extends Error{constructor(t){super("CancelledError"),this.revert=t==null?void 0:t.revert,this.silent=t==null?void 0:t.silent}};function dE(t){return t instanceof MF}function RF(t){let r=!1,l=0,d=!1,_;const x=DC(),C=H=>{var ne;d||($(new MF(H)),(ne=t.abort)==null||ne.call(t))},s=()=>{r=!0},k=()=>{r=!1},z=()=>II.isFocused()&&(t.networkMode==="always"||pw.isOnline())&&t.canRun(),V=()=>PF(t.networkMode)&&t.canRun(),U=H=>{var ne;d||(d=!0,(ne=t.onSuccess)==null||ne.call(t,H),_==null||_(),x.resolve(H))},$=H=>{var ne;d||(d=!0,(ne=t.onError)==null||ne.call(t,H),_==null||_(),x.reject(H))},se=()=>new Promise(H=>{var ne;_=Y=>{(d||z())&&H(Y)},(ne=t.onPause)==null||ne.call(t)}).then(()=>{var H;_=void 0,d||(H=t.onContinue)==null||H.call(t)}),ae=()=>{if(d)return;let H;const ne=l===0?t.initialPromise:void 0;try{H=ne??t.fn()}catch(Y){H=Promise.reject(Y)}Promise.resolve(H).then(U).catch(Y=>{var lt;if(d)return;const te=t.retry??(ip?0:3),de=t.retryDelay??hW,Me=typeof de=="function"?de(l,Y):de,Le=te===!0||typeof te=="number"&&l<te||typeof te=="function"&&te(l,Y);if(r||!Le){$(Y);return}l++,(lt=t.onFail)==null||lt.call(t,l,Y),aW(Me).then(()=>z()?void 0:se()).then(()=>{r?$(Y):ae()})})};return{promise:x,cancel:C,continue:()=>(_==null||_(),x),cancelRetry:s,continueRetry:k,canStart:V,start:()=>(V()?ae():se().then(ae),x)}}function fW(){let t=[],r=0,l=s=>{s()},d=s=>{s()},_=s=>setTimeout(s,0);const x=s=>{r?t.push(s):_(()=>{l(s)})},C=()=>{const s=t;t=[],s.length&&_(()=>{d(()=>{s.forEach(k=>{l(k)})})})};return{batch:s=>{let k;r++;try{k=s()}finally{r--,r||C()}return k},batchCalls:s=>(...k)=>{x(()=>{s(...k)})},schedule:x,setNotifyFunction:s=>{l=s},setBatchNotifyFunction:s=>{d=s},setScheduler:s=>{_=s}}}var Gs=fW(),Bf,ON,kF=(ON=class{constructor(){fr(this,Bf)}destroy(){this.clearGcTimeout()}scheduleGc(){this.clearGcTimeout(),MC(this.gcTime)&&Fn(this,Bf,setTimeout(()=>{this.optionalRemove()},this.gcTime))}updateGcTime(t){this.gcTime=Math.max(this.gcTime||0,t??(ip?1/0:5*60*1e3))}clearGcTimeout(){tt(this,Bf)&&(clearTimeout(tt(this,Bf)),Fn(this,Bf,void 0))}},Bf=new WeakMap,ON),Eg,Cg,Ga,Ao,wx,Vf,Cl,hu,FN,pW=(FN=class extends kF{constructor(r){super();fr(this,Cl);fr(this,Eg);fr(this,Cg);fr(this,Ga);fr(this,Ao);fr(this,wx);fr(this,Vf);Fn(this,Vf,!1),Fn(this,wx,r.defaultOptions),this.setOptions(r.options),this.observers=[],Fn(this,Ga,r.cache),this.queryKey=r.queryKey,this.queryHash=r.queryHash,Fn(this,Eg,mW(this.options)),this.state=r.state??tt(this,Eg),this.scheduleGc()}get meta(){return this.options.meta}get promise(){var r;return(r=tt(this,Ao))==null?void 0:r.promise}setOptions(r){this.options={...tt(this,wx),...r},this.updateGcTime(this.options.gcTime)}optionalRemove(){!this.observers.length&&this.state.fetchStatus==="idle"&&tt(this,Ga).remove(this)}setData(r,l){const d=kC(this.state.data,r,this.options);return Jr(this,Cl,hu).call(this,{data:d,type:"success",dataUpdatedAt:l==null?void 0:l.updatedAt,manual:l==null?void 0:l.manual}),d}setState(r,l){Jr(this,Cl,hu).call(this,{type:"setState",state:r,setStateOptions:l})}cancel(r){var d,_;const l=(d=tt(this,Ao))==null?void 0:d.promise;return(_=tt(this,Ao))==null||_.cancel(r),l?l.then(Ha).catch(Ha):Promise.resolve()}destroy(){super.destroy(),this.cancel({silent:!0})}reset(){this.destroy(),this.setState(tt(this,Eg))}isActive(){return this.observers.some(r=>Pl(r.options.enabled,this)!==!1)}isDisabled(){return this.getObserversCount()>0?!this.isActive():this.options.queryFn===AI||this.state.dataUpdateCount+this.state.errorUpdateCount===0}isStale(){return this.state.isInvalidated?!0:this.getObserversCount()>0?this.observers.some(r=>r.getCurrentResult().isStale):this.state.data===void 0}isStaleByTime(r=0){return this.state.isInvalidated||this.state.data===void 0||!CF(this.state.dataUpdatedAt,r)}onFocus(){var l;const r=this.observers.find(d=>d.shouldFetchOnWindowFocus());r==null||r.refetch({cancelRefetch:!1}),(l=tt(this,Ao))==null||l.continue()}onOnline(){var l;const r=this.observers.find(d=>d.shouldFetchOnReconnect());r==null||r.refetch({cancelRefetch:!1}),(l=tt(this,Ao))==null||l.continue()}addObserver(r){this.observers.includes(r)||(this.observers.push(r),this.clearGcTimeout(),tt(this,Ga).notify({type:"observerAdded",query:this,observer:r}))}removeObserver(r){this.observers.includes(r)&&(this.observers=this.observers.filter(l=>l!==r),this.observers.length||(tt(this,Ao)&&(tt(this,Vf)?tt(this,Ao).cancel({revert:!0}):tt(this,Ao).cancelRetry()),this.scheduleGc()),tt(this,Ga).notify({type:"observerRemoved",query:this,observer:r}))}getObserversCount(){return this.observers.length}invalidate(){this.state.isInvalidated||Jr(this,Cl,hu).call(this,{type:"invalidate"})}fetch(r,l){var k,z,V;if(this.state.fetchStatus!=="idle"){if(this.state.data!==void 0&&(l!=null&&l.cancelRefetch))this.cancel({silent:!0});else if(tt(this,Ao))return tt(this,Ao).continueRetry(),tt(this,Ao).promise}if(r&&this.setOptions(r),!this.options.queryFn){const U=this.observers.find($=>$.options.queryFn);U&&this.setOptions(U.options)}const d=new AbortController,_=U=>{Object.defineProperty(U,"signal",{enumerable:!0,get:()=>(Fn(this,Vf,!0),d.signal)})},x=()=>{const U=IF(this.options,l),$={queryKey:this.queryKey,meta:this.meta};return _($),Fn(this,Vf,!1),this.options.persister?this.options.persister(U,$,this):U($)},C={fetchOptions:l,options:this.options,queryKey:this.queryKey,state:this.state,fetchFn:x};_(C),(k=this.options.behavior)==null||k.onFetch(C,this),Fn(this,Cg,this.state),(this.state.fetchStatus==="idle"||this.state.fetchMeta!==((z=C.fetchOptions)==null?void 0:z.meta))&&Jr(this,Cl,hu).call(this,{type:"fetch",meta:(V=C.fetchOptions)==null?void 0:V.meta});const s=U=>{var $,se,ae,H;dE(U)&&U.silent||Jr(this,Cl,hu).call(this,{type:"error",error:U}),dE(U)||((se=($=tt(this,Ga).config).onError)==null||se.call($,U,this),(H=(ae=tt(this,Ga).config).onSettled)==null||H.call(ae,this.state.data,U,this)),this.scheduleGc()};return Fn(this,Ao,RF({initialPromise:l==null?void 0:l.initialPromise,fn:C.fetchFn,abort:d.abort.bind(d),onSuccess:U=>{var $,se,ae,H;if(U===void 0){s(new Error(`${this.queryHash} data is undefined`));return}try{this.setData(U)}catch(ne){s(ne);return}(se=($=tt(this,Ga).config).onSuccess)==null||se.call($,U,this),(H=(ae=tt(this,Ga).config).onSettled)==null||H.call(ae,U,this.state.error,this),this.scheduleGc()},onError:s,onFail:(U,$)=>{Jr(this,Cl,hu).call(this,{type:"failed",failureCount:U,error:$})},onPause:()=>{Jr(this,Cl,hu).call(this,{type:"pause"})},onContinue:()=>{Jr(this,Cl,hu).call(this,{type:"continue"})},retry:C.options.retry,retryDelay:C.options.retryDelay,networkMode:C.options.networkMode,canRun:()=>!0})),tt(this,Ao).start()}},Eg=new WeakMap,Cg=new WeakMap,Ga=new WeakMap,Ao=new WeakMap,wx=new WeakMap,Vf=new WeakMap,Cl=new WeakSet,hu=function(r){const l=d=>{switch(r.type){case"failed":return{...d,fetchFailureCount:r.failureCount,fetchFailureReason:r.error};case"pause":return{...d,fetchStatus:"paused"};case"continue":return{...d,fetchStatus:"fetching"};case"fetch":return{...d,...DF(d.data,this.options),fetchMeta:r.meta??null};case"success":return{...d,data:r.data,dataUpdateCount:d.dataUpdateCount+1,dataUpdatedAt:r.dataUpdatedAt??Date.now(),error:null,isInvalidated:!1,status:"success",...!r.manual&&{fetchStatus:"idle",fetchFailureCount:0,fetchFailureReason:null}};case"error":const _=r.error;return dE(_)&&_.revert&&tt(this,Cg)?{...tt(this,Cg),fetchStatus:"idle"}:{...d,error:_,errorUpdateCount:d.errorUpdateCount+1,errorUpdatedAt:Date.now(),fetchFailureCount:d.fetchFailureCount+1,fetchFailureReason:_,fetchStatus:"idle",status:"error"};case"invalidate":return{...d,isInvalidated:!0};case"setState":return{...d,...r.state}}};this.state=l(this.state),Gs.batch(()=>{this.observers.forEach(d=>{d.onQueryUpdate()}),tt(this,Ga).notify({query:this,type:"updated",action:r})})},FN);function DF(t,r){return{fetchFailureCount:0,fetchFailureReason:null,fetchStatus:PF(r.networkMode)?"fetching":"paused",...t===void 0&&{error:null,status:"pending"}}}function mW(t){const r=typeof t.initialData=="function"?t.initialData():t.initialData,l=r!==void 0,d=l?typeof t.initialDataUpdatedAt=="function"?t.initialDataUpdatedAt():t.initialDataUpdatedAt:0;return{data:r,dataUpdateCount:0,dataUpdatedAt:l?d??Date.now():0,error:null,errorUpdateCount:0,errorUpdatedAt:0,fetchFailureCount:0,fetchFailureReason:null,fetchMeta:null,isInvalidated:!1,status:l?"success":"pending",fetchStatus:"idle"}}var xc,jN,gW=(jN=class extends a_{constructor(r={}){super();fr(this,xc);this.config=r,Fn(this,xc,new Map)}build(r,l,d){const _=l.queryKey,x=l.queryHash??CI(_,l);let C=this.get(x);return C||(C=new pW({cache:this,queryKey:_,queryHash:x,options:r.defaultQueryOptions(l),state:d,defaultOptions:r.getQueryDefaults(_)}),this.add(C)),C}add(r){tt(this,xc).has(r.queryHash)||(tt(this,xc).set(r.queryHash,r),this.notify({type:"added",query:r}))}remove(r){const l=tt(this,xc).get(r.queryHash);l&&(r.destroy(),l===r&&tt(this,xc).delete(r.queryHash),this.notify({type:"removed",query:r}))}clear(){Gs.batch(()=>{this.getAll().forEach(r=>{this.remove(r)})})}get(r){return tt(this,xc).get(r)}getAll(){return[...tt(this,xc).values()]}find(r){const l={exact:!0,...r};return this.getAll().find(d=>zL(l,d))}findAll(r={}){const l=this.getAll();return Object.keys(r).length>0?l.filter(d=>zL(r,d)):l}notify(r){Gs.batch(()=>{this.listeners.forEach(l=>{l(r)})})}onFocus(){Gs.batch(()=>{this.getAll().forEach(r=>{r.onFocus()})})}onOnline(){Gs.batch(()=>{this.getAll().forEach(r=>{r.onOnline()})})}},xc=new WeakMap,jN),bc,Vo,Uf,wc,Cd,BN,_W=(BN=class extends kF{constructor(r){super();fr(this,wc);fr(this,bc);fr(this,Vo);fr(this,Uf);this.mutationId=r.mutationId,Fn(this,Vo,r.mutationCache),Fn(this,bc,[]),this.state=r.state||LF(),this.setOptions(r.options),this.scheduleGc()}setOptions(r){this.options=r,this.updateGcTime(this.options.gcTime)}get meta(){return this.options.meta}addObserver(r){tt(this,bc).includes(r)||(tt(this,bc).push(r),this.clearGcTimeout(),tt(this,Vo).notify({type:"observerAdded",mutation:this,observer:r}))}removeObserver(r){Fn(this,bc,tt(this,bc).filter(l=>l!==r)),this.scheduleGc(),tt(this,Vo).notify({type:"observerRemoved",mutation:this,observer:r})}optionalRemove(){tt(this,bc).length||(this.state.status==="pending"?this.scheduleGc():tt(this,Vo).remove(this))}continue(){var r;return((r=tt(this,Uf))==null?void 0:r.continue())??this.execute(this.state.variables)}async execute(r){var _,x,C,s,k,z,V,U,$,se,ae,H,ne,Y,te,de,Me,Le,lt,Pe;Fn(this,Uf,RF({fn:()=>this.options.mutationFn?this.options.mutationFn(r):Promise.reject(new Error("No mutationFn found")),onFail:(Ye,vt)=>{Jr(this,wc,Cd).call(this,{type:"failed",failureCount:Ye,error:vt})},onPause:()=>{Jr(this,wc,Cd).call(this,{type:"pause"})},onContinue:()=>{Jr(this,wc,Cd).call(this,{type:"continue"})},retry:this.options.retry??0,retryDelay:this.options.retryDelay,networkMode:this.options.networkMode,canRun:()=>tt(this,Vo).canRun(this)}));const l=this.state.status==="pending",d=!tt(this,Uf).canStart();try{if(!l){Jr(this,wc,Cd).call(this,{type:"pending",variables:r,isPaused:d}),await((x=(_=tt(this,Vo).config).onMutate)==null?void 0:x.call(_,r,this));const vt=await((s=(C=this.options).onMutate)==null?void 0:s.call(C,r));vt!==this.state.context&&Jr(this,wc,Cd).call(this,{type:"pending",context:vt,variables:r,isPaused:d})}const Ye=await tt(this,Uf).start();return await((z=(k=tt(this,Vo).config).onSuccess)==null?void 0:z.call(k,Ye,r,this.state.context,this)),await((U=(V=this.options).onSuccess)==null?void 0:U.call(V,Ye,r,this.state.context)),await((se=($=tt(this,Vo).config).onSettled)==null?void 0:se.call($,Ye,null,this.state.variables,this.state.context,this)),await((H=(ae=this.options).onSettled)==null?void 0:H.call(ae,Ye,null,r,this.state.context)),Jr(this,wc,Cd).call(this,{type:"success",data:Ye}),Ye}catch(Ye){try{throw await((Y=(ne=tt(this,Vo).config).onError)==null?void 0:Y.call(ne,Ye,r,this.state.context,this)),await((de=(te=this.options).onError)==null?void 0:de.call(te,Ye,r,this.state.context)),await((Le=(Me=tt(this,Vo).config).onSettled)==null?void 0:Le.call(Me,void 0,Ye,this.state.variables,this.state.context,this)),await((Pe=(lt=this.options).onSettled)==null?void 0:Pe.call(lt,void 0,Ye,r,this.state.context)),Ye}finally{Jr(this,wc,Cd).call(this,{type:"error",error:Ye})}}finally{tt(this,Vo).runNext(this)}}},bc=new WeakMap,Vo=new WeakMap,Uf=new WeakMap,wc=new WeakSet,Cd=function(r){const l=d=>{switch(r.type){case"failed":return{...d,failureCount:r.failureCount,failureReason:r.error};case"pause":return{...d,isPaused:!0};case"continue":return{...d,isPaused:!1};case"pending":return{...d,context:r.context,data:void 0,failureCount:0,failureReason:null,error:null,isPaused:r.isPaused,status:"pending",variables:r.variables,submittedAt:Date.now()};case"success":return{...d,data:r.data,failureCount:0,failureReason:null,error:null,status:"success",isPaused:!1};case"error":return{...d,data:void 0,error:r.error,failureCount:d.failureCount+1,failureReason:r.error,isPaused:!1,status:"error"}}};this.state=l(this.state),Gs.batch(()=>{tt(this,bc).forEach(d=>{d.onMutationUpdate(r)}),tt(this,Vo).notify({mutation:this,type:"updated",action:r})})},BN);function LF(){return{context:void 0,data:void 0,error:null,failureCount:0,failureReason:null,isPaused:!1,status:"idle",variables:void 0,submittedAt:0}}var Sa,Sx,VN,yW=(VN=class extends a_{constructor(r={}){super();fr(this,Sa);fr(this,Sx);this.config=r,Fn(this,Sa,new Map),Fn(this,Sx,Date.now())}build(r,l,d){const _=new _W({mutationCache:this,mutationId:++B1(this,Sx)._,options:r.defaultMutationOptions(l),state:d});return this.add(_),_}add(r){const l=lb(r),d=tt(this,Sa).get(l)??[];d.push(r),tt(this,Sa).set(l,d),this.notify({type:"added",mutation:r})}remove(r){var d;const l=lb(r);if(tt(this,Sa).has(l)){const _=(d=tt(this,Sa).get(l))==null?void 0:d.filter(x=>x!==r);_&&(_.length===0?tt(this,Sa).delete(l):tt(this,Sa).set(l,_))}this.notify({type:"removed",mutation:r})}canRun(r){var d;const l=(d=tt(this,Sa).get(lb(r)))==null?void 0:d.find(_=>_.state.status==="pending");return!l||l===r}runNext(r){var d;const l=(d=tt(this,Sa).get(lb(r)))==null?void 0:d.find(_=>_!==r&&_.state.isPaused);return(l==null?void 0:l.continue())??Promise.resolve()}clear(){Gs.batch(()=>{this.getAll().forEach(r=>{this.remove(r)})})}getAll(){return[...tt(this,Sa).values()].flat()}find(r){const l={exact:!0,...r};return this.getAll().find(d=>OL(l,d))}findAll(r={}){return this.getAll().filter(l=>OL(r,l))}notify(r){Gs.batch(()=>{this.listeners.forEach(l=>{l(r)})})}resumePausedMutations(){const r=this.getAll().filter(l=>l.state.isPaused);return Gs.batch(()=>Promise.all(r.map(l=>l.continue().catch(Ha))))}},Sa=new WeakMap,Sx=new WeakMap,VN);function lb(t){var r;return((r=t.options.scope)==null?void 0:r.id)??String(t.mutationId)}function BL(t){return{onFetch:(r,l)=>{var V,U,$,se,ae;const d=r.options,_=($=(U=(V=r.fetchOptions)==null?void 0:V.meta)==null?void 0:U.fetchMore)==null?void 0:$.direction,x=((se=r.state.data)==null?void 0:se.pages)||[],C=((ae=r.state.data)==null?void 0:ae.pageParams)||[];let s={pages:[],pageParams:[]},k=0;const z=async()=>{let H=!1;const ne=de=>{Object.defineProperty(de,"signal",{enumerable:!0,get:()=>(r.signal.aborted?H=!0:r.signal.addEventListener("abort",()=>{H=!0}),r.signal)})},Y=IF(r.options,r.fetchOptions),te=async(de,Me,Le)=>{if(H)return Promise.reject();if(Me==null&&de.pages.length)return Promise.resolve(de);const lt={queryKey:r.queryKey,pageParam:Me,direction:Le?"backward":"forward",meta:r.options.meta};ne(lt);const Pe=await Y(lt),{maxPages:Ye}=r.options,vt=Le?cW:lW;return{pages:vt(de.pages,Pe,Ye),pageParams:vt(de.pageParams,Me,Ye)}};if(_&&x.length){const de=_==="backward",Me=de?vW:VL,Le={pages:x,pageParams:C},lt=Me(d,Le);s=await te(Le,lt,de)}else{const de=t??x.length;do{const Me=k===0?C[0]??d.initialPageParam:VL(d,s);if(k>0&&Me==null)break;s=await te(s,Me),k++}while(k<de)}return s};r.options.persister?r.fetchFn=()=>{var H,ne;return(ne=(H=r.options).persister)==null?void 0:ne.call(H,z,{queryKey:r.queryKey,meta:r.options.meta,signal:r.signal},l)}:r.fetchFn=z}}}function VL(t,{pages:r,pageParams:l}){const d=r.length-1;return r.length>0?t.getNextPageParam(r[d],r,l[d],l):void 0}function vW(t,{pages:r,pageParams:l}){var d;return r.length>0?(d=t.getPreviousPageParam)==null?void 0:d.call(t,r[0],r,l[0],l):void 0}var gs,jd,Bd,Ag,Ig,Vd,Pg,Mg,UN,xW=(UN=class{constructor(t={}){fr(this,gs);fr(this,jd);fr(this,Bd);fr(this,Ag);fr(this,Ig);fr(this,Vd);fr(this,Pg);fr(this,Mg);Fn(this,gs,t.queryCache||new gW),Fn(this,jd,t.mutationCache||new yW),Fn(this,Bd,t.defaultOptions||{}),Fn(this,Ag,new Map),Fn(this,Ig,new Map),Fn(this,Vd,0)}mount(){B1(this,Vd)._++,tt(this,Vd)===1&&(Fn(this,Pg,II.subscribe(async t=>{t&&(await this.resumePausedMutations(),tt(this,gs).onFocus())})),Fn(this,Mg,pw.subscribe(async t=>{t&&(await this.resumePausedMutations(),tt(this,gs).onOnline())})))}unmount(){var t,r;B1(this,Vd)._--,tt(this,Vd)===0&&((t=tt(this,Pg))==null||t.call(this),Fn(this,Pg,void 0),(r=tt(this,Mg))==null||r.call(this),Fn(this,Mg,void 0))}isFetching(t){return tt(this,gs).findAll({...t,fetchStatus:"fetching"}).length}isMutating(t){return tt(this,jd).findAll({...t,status:"pending"}).length}getQueryData(t){var l;const r=this.defaultQueryOptions({queryKey:t});return(l=tt(this,gs).get(r.queryHash))==null?void 0:l.state.data}ensureQueryData(t){const r=this.getQueryData(t.queryKey);if(r===void 0)return this.fetchQuery(t);{const l=this.defaultQueryOptions(t),d=tt(this,gs).build(this,l);return t.revalidateIfStale&&d.isStaleByTime(_g(l.staleTime,d))&&this.prefetchQuery(l),Promise.resolve(r)}}getQueriesData(t){return tt(this,gs).findAll(t).map(({queryKey:r,state:l})=>{const d=l.data;return[r,d]})}setQueryData(t,r,l){const d=this.defaultQueryOptions({queryKey:t}),_=tt(this,gs).get(d.queryHash),x=_==null?void 0:_.state.data,C=oW(r,x);if(C!==void 0)return tt(this,gs).build(this,d).setData(C,{...l,manual:!0})}setQueriesData(t,r,l){return Gs.batch(()=>tt(this,gs).findAll(t).map(({queryKey:d})=>[d,this.setQueryData(d,r,l)]))}getQueryState(t){var l;const r=this.defaultQueryOptions({queryKey:t});return(l=tt(this,gs).get(r.queryHash))==null?void 0:l.state}removeQueries(t){const r=tt(this,gs);Gs.batch(()=>{r.findAll(t).forEach(l=>{r.remove(l)})})}resetQueries(t,r){const l=tt(this,gs),d={type:"active",...t};return Gs.batch(()=>(l.findAll(t).forEach(_=>{_.reset()}),this.refetchQueries(d,r)))}cancelQueries(t={},r={}){const l={revert:!0,...r},d=Gs.batch(()=>tt(this,gs).findAll(t).map(_=>_.cancel(l)));return Promise.all(d).then(Ha).catch(Ha)}invalidateQueries(t={},r={}){return Gs.batch(()=>{if(tt(this,gs).findAll(t).forEach(d=>{d.invalidate()}),t.refetchType==="none")return Promise.resolve();const l={...t,type:t.refetchType??t.type??"active"};return this.refetchQueries(l,r)})}refetchQueries(t={},r){const l={...r,cancelRefetch:(r==null?void 0:r.cancelRefetch)??!0},d=Gs.batch(()=>tt(this,gs).findAll(t).filter(_=>!_.isDisabled()).map(_=>{let x=_.fetch(void 0,l);return l.throwOnError||(x=x.catch(Ha)),_.state.fetchStatus==="paused"?Promise.resolve():x}));return Promise.all(d).then(Ha)}fetchQuery(t){const r=this.defaultQueryOptions(t);r.retry===void 0&&(r.retry=!1);const l=tt(this,gs).build(this,r);return l.isStaleByTime(_g(r.staleTime,l))?l.fetch(r):Promise.resolve(l.state.data)}prefetchQuery(t){return this.fetchQuery(t).then(Ha).catch(Ha)}fetchInfiniteQuery(t){return t.behavior=BL(t.pages),this.fetchQuery(t)}prefetchInfiniteQuery(t){return this.fetchInfiniteQuery(t).then(Ha).catch(Ha)}ensureInfiniteQueryData(t){return t.behavior=BL(t.pages),this.ensureQueryData(t)}resumePausedMutations(){return pw.isOnline()?tt(this,jd).resumePausedMutations():Promise.resolve()}getQueryCache(){return tt(this,gs)}getMutationCache(){return tt(this,jd)}getDefaultOptions(){return tt(this,Bd)}setDefaultOptions(t){Fn(this,Bd,t)}setQueryDefaults(t,r){tt(this,Ag).set(sp(t),{queryKey:t,defaultOptions:r})}getQueryDefaults(t){const r=[...tt(this,Ag).values()];let l={};return r.forEach(d=>{rx(t,d.queryKey)&&(l={...l,...d.defaultOptions})}),l}setMutationDefaults(t,r){tt(this,Ig).set(sp(t),{mutationKey:t,defaultOptions:r})}getMutationDefaults(t){const r=[...tt(this,Ig).values()];let l={};return r.forEach(d=>{rx(t,d.mutationKey)&&(l={...l,...d.defaultOptions})}),l}defaultQueryOptions(t){if(t._defaulted)return t;const r={...tt(this,Bd).queries,...this.getQueryDefaults(t.queryKey),...t,_defaulted:!0};return r.queryHash||(r.queryHash=CI(r.queryKey,r)),r.refetchOnReconnect===void 0&&(r.refetchOnReconnect=r.networkMode!=="always"),r.throwOnError===void 0&&(r.throwOnError=!!r.suspense),!r.networkMode&&r.persister&&(r.networkMode="offlineFirst"),r.enabled!==!0&&r.queryFn===AI&&(r.enabled=!1),r}defaultMutationOptions(t){return t!=null&&t._defaulted?t:{...tt(this,Bd).mutations,...(t==null?void 0:t.mutationKey)&&this.getMutationDefaults(t.mutationKey),...t,_defaulted:!0}}clear(){tt(this,gs).clear(),tt(this,jd).clear()}},gs=new WeakMap,jd=new WeakMap,Bd=new WeakMap,Ag=new WeakMap,Ig=new WeakMap,Vd=new WeakMap,Pg=new WeakMap,Mg=new WeakMap,UN),oa,bi,Tx,Uo,$f,Rg,Ud,Sc,Ex,kg,Dg,Gf,Hf,$d,Lg,Fi,_v,LC,NC,zC,OC,FC,jC,BC,NF,$N,bW=($N=class extends a_{constructor(r,l){super();fr(this,Fi);fr(this,oa);fr(this,bi);fr(this,Tx);fr(this,Uo);fr(this,$f);fr(this,Rg);fr(this,Ud);fr(this,Sc);fr(this,Ex);fr(this,kg);fr(this,Dg);fr(this,Gf);fr(this,Hf);fr(this,$d);fr(this,Lg,new Set);this.options=l,Fn(this,oa,r),Fn(this,Sc,null),Fn(this,Ud,DC()),this.options.experimental_prefetchInRender||tt(this,Ud).reject(new Error("experimental_prefetchInRender feature flag is not enabled")),this.bindMethods(),this.setOptions(l)}bindMethods(){this.refetch=this.refetch.bind(this)}onSubscribe(){this.listeners.size===1&&(tt(this,bi).addObserver(this),UL(tt(this,bi),this.options)?Jr(this,Fi,_v).call(this):this.updateResult(),Jr(this,Fi,OC).call(this))}onUnsubscribe(){this.hasListeners()||this.destroy()}shouldFetchOnReconnect(){return VC(tt(this,bi),this.options,this.options.refetchOnReconnect)}shouldFetchOnWindowFocus(){return VC(tt(this,bi),this.options,this.options.refetchOnWindowFocus)}destroy(){this.listeners=new Set,Jr(this,Fi,FC).call(this),Jr(this,Fi,jC).call(this),tt(this,bi).removeObserver(this)}setOptions(r,l){const d=this.options,_=tt(this,bi);if(this.options=tt(this,oa).defaultQueryOptions(r),this.options.enabled!==void 0&&typeof this.options.enabled!="boolean"&&typeof this.options.enabled!="function"&&typeof Pl(this.options.enabled,tt(this,bi))!="boolean")throw new Error("Expected enabled to be a boolean or a callback that returns a boolean");Jr(this,Fi,BC).call(this),tt(this,bi).setOptions(this.options),d._defaulted&&!fw(this.options,d)&&tt(this,oa).getQueryCache().notify({type:"observerOptionsUpdated",query:tt(this,bi),observer:this});const x=this.hasListeners();x&&$L(tt(this,bi),_,this.options,d)&&Jr(this,Fi,_v).call(this),this.updateResult(l),x&&(tt(this,bi)!==_||Pl(this.options.enabled,tt(this,bi))!==Pl(d.enabled,tt(this,bi))||_g(this.options.staleTime,tt(this,bi))!==_g(d.staleTime,tt(this,bi)))&&Jr(this,Fi,LC).call(this);const C=Jr(this,Fi,NC).call(this);x&&(tt(this,bi)!==_||Pl(this.options.enabled,tt(this,bi))!==Pl(d.enabled,tt(this,bi))||C!==tt(this,$d))&&Jr(this,Fi,zC).call(this,C)}getOptimisticResult(r){const l=tt(this,oa).getQueryCache().build(tt(this,oa),r),d=this.createResult(l,r);return SW(this,d)&&(Fn(this,Uo,d),Fn(this,Rg,this.options),Fn(this,$f,tt(this,bi).state)),d}getCurrentResult(){return tt(this,Uo)}trackResult(r,l){const d={};return Object.keys(r).forEach(_=>{Object.defineProperty(d,_,{configurable:!1,enumerable:!0,get:()=>(this.trackProp(_),l==null||l(_),r[_])})}),d}trackProp(r){tt(this,Lg).add(r)}getCurrentQuery(){return tt(this,bi)}refetch({...r}={}){return this.fetch({...r})}fetchOptimistic(r){const l=tt(this,oa).defaultQueryOptions(r),d=tt(this,oa).getQueryCache().build(tt(this,oa),l);return d.fetch().then(()=>this.createResult(d,l))}fetch(r){return Jr(this,Fi,_v).call(this,{...r,cancelRefetch:r.cancelRefetch??!0}).then(()=>(this.updateResult(),tt(this,Uo)))}createResult(r,l){var Ye;const d=tt(this,bi),_=this.options,x=tt(this,Uo),C=tt(this,$f),s=tt(this,Rg),z=r!==d?r.state:tt(this,Tx),{state:V}=r;let U={...V},$=!1,se;if(l._optimisticResults){const vt=this.hasListeners(),It=!vt&&UL(r,l),Ut=vt&&$L(r,d,l,_);(It||Ut)&&(U={...U,...DF(V.data,r.options)}),l._optimisticResults==="isRestoring"&&(U.fetchStatus="idle")}let{error:ae,errorUpdatedAt:H,status:ne}=U;if(l.select&&U.data!==void 0)if(x&&U.data===(C==null?void 0:C.data)&&l.select===tt(this,Ex))se=tt(this,kg);else try{Fn(this,Ex,l.select),se=l.select(U.data),se=kC(x==null?void 0:x.data,se,l),Fn(this,kg,se),Fn(this,Sc,null)}catch(vt){Fn(this,Sc,vt)}else se=U.data;if(l.placeholderData!==void 0&&se===void 0&&ne==="pending"){let vt;if(x!=null&&x.isPlaceholderData&&l.placeholderData===(s==null?void 0:s.placeholderData))vt=x.data;else if(vt=typeof l.placeholderData=="function"?l.placeholderData((Ye=tt(this,Dg))==null?void 0:Ye.state.data,tt(this,Dg)):l.placeholderData,l.select&&vt!==void 0)try{vt=l.select(vt),Fn(this,Sc,null)}catch(It){Fn(this,Sc,It)}vt!==void 0&&(ne="success",se=kC(x==null?void 0:x.data,vt,l),$=!0)}tt(this,Sc)&&(ae=tt(this,Sc),se=tt(this,kg),H=Date.now(),ne="error");const Y=U.fetchStatus==="fetching",te=ne==="pending",de=ne==="error",Me=te&&Y,Le=se!==void 0,Pe={status:ne,fetchStatus:U.fetchStatus,isPending:te,isSuccess:ne==="success",isError:de,isInitialLoading:Me,isLoading:Me,data:se,dataUpdatedAt:U.dataUpdatedAt,error:ae,errorUpdatedAt:H,failureCount:U.fetchFailureCount,failureReason:U.fetchFailureReason,errorUpdateCount:U.errorUpdateCount,isFetched:U.dataUpdateCount>0||U.errorUpdateCount>0,isFetchedAfterMount:U.dataUpdateCount>z.dataUpdateCount||U.errorUpdateCount>z.errorUpdateCount,isFetching:Y,isRefetching:Y&&!te,isLoadingError:de&&!Le,isPaused:U.fetchStatus==="paused",isPlaceholderData:$,isRefetchError:de&&Le,isStale:PI(r,l),refetch:this.refetch,promise:tt(this,Ud)};if(this.options.experimental_prefetchInRender){const vt=Pt=>{Pe.status==="error"?Pt.reject(Pe.error):Pe.data!==void 0&&Pt.resolve(Pe.data)},It=()=>{const Pt=Fn(this,Ud,Pe.promise=DC());vt(Pt)},Ut=tt(this,Ud);switch(Ut.status){case"pending":r.queryHash===d.queryHash&&vt(Ut);break;case"fulfilled":(Pe.status==="error"||Pe.data!==Ut.value)&&It();break;case"rejected":(Pe.status!=="error"||Pe.error!==Ut.reason)&&It();break}}return Pe}updateResult(r){const l=tt(this,Uo),d=this.createResult(tt(this,bi),this.options);if(Fn(this,$f,tt(this,bi).state),Fn(this,Rg,this.options),tt(this,$f).data!==void 0&&Fn(this,Dg,tt(this,bi)),fw(d,l))return;Fn(this,Uo,d);const _={},x=()=>{if(!l)return!0;const{notifyOnChangeProps:C}=this.options,s=typeof C=="function"?C():C;if(s==="all"||!s&&!tt(this,Lg).size)return!0;const k=new Set(s??tt(this,Lg));return this.options.throwOnError&&k.add("error"),Object.keys(tt(this,Uo)).some(z=>{const V=z;return tt(this,Uo)[V]!==l[V]&&k.has(V)})};(r==null?void 0:r.listeners)!==!1&&x()&&(_.listeners=!0),Jr(this,Fi,NF).call(this,{..._,...r})}onQueryUpdate(){this.updateResult(),this.hasListeners()&&Jr(this,Fi,OC).call(this)}},oa=new WeakMap,bi=new WeakMap,Tx=new WeakMap,Uo=new WeakMap,$f=new WeakMap,Rg=new WeakMap,Ud=new WeakMap,Sc=new WeakMap,Ex=new WeakMap,kg=new WeakMap,Dg=new WeakMap,Gf=new WeakMap,Hf=new WeakMap,$d=new WeakMap,Lg=new WeakMap,Fi=new WeakSet,_v=function(r){Jr(this,Fi,BC).call(this);let l=tt(this,bi).fetch(this.options,r);return r!=null&&r.throwOnError||(l=l.catch(Ha)),l},LC=function(){Jr(this,Fi,FC).call(this);const r=_g(this.options.staleTime,tt(this,bi));if(ip||tt(this,Uo).isStale||!MC(r))return;const d=CF(tt(this,Uo).dataUpdatedAt,r)+1;Fn(this,Gf,setTimeout(()=>{tt(this,Uo).isStale||this.updateResult()},d))},NC=function(){return(typeof this.options.refetchInterval=="function"?this.options.refetchInterval(tt(this,bi)):this.options.refetchInterval)??!1},zC=function(r){Jr(this,Fi,jC).call(this),Fn(this,$d,r),!(ip||Pl(this.options.enabled,tt(this,bi))===!1||!MC(tt(this,$d))||tt(this,$d)===0)&&Fn(this,Hf,setInterval(()=>{(this.options.refetchIntervalInBackground||II.isFocused())&&Jr(this,Fi,_v).call(this)},tt(this,$d)))},OC=function(){Jr(this,Fi,LC).call(this),Jr(this,Fi,zC).call(this,Jr(this,Fi,NC).call(this))},FC=function(){tt(this,Gf)&&(clearTimeout(tt(this,Gf)),Fn(this,Gf,void 0))},jC=function(){tt(this,Hf)&&(clearInterval(tt(this,Hf)),Fn(this,Hf,void 0))},BC=function(){const r=tt(this,oa).getQueryCache().build(tt(this,oa),this.options);if(r===tt(this,bi))return;const l=tt(this,bi);Fn(this,bi,r),Fn(this,Tx,r.state),this.hasListeners()&&(l==null||l.removeObserver(this),r.addObserver(this))},NF=function(r){Gs.batch(()=>{r.listeners&&this.listeners.forEach(l=>{l(tt(this,Uo))}),tt(this,oa).getQueryCache().notify({query:tt(this,bi),type:"observerResultsUpdated"})})},$N);function wW(t,r){return Pl(r.enabled,t)!==!1&&t.state.data===void 0&&!(t.state.status==="error"&&r.retryOnMount===!1)}function UL(t,r){return wW(t,r)||t.state.data!==void 0&&VC(t,r,r.refetchOnMount)}function VC(t,r,l){if(Pl(r.enabled,t)!==!1){const d=typeof l=="function"?l(t):l;return d==="always"||d!==!1&&PI(t,r)}return!1}function $L(t,r,l,d){return(t!==r||Pl(d.enabled,t)===!1)&&(!l.suspense||t.state.status!=="error")&&PI(t,l)}function PI(t,r){return Pl(r.enabled,t)!==!1&&t.isStaleByTime(_g(r.staleTime,t))}function SW(t,r){return!fw(t.getCurrentResult(),r)}var Gd,Hd,aa,gu,wu,kb,UC,GN,TW=(GN=class extends a_{constructor(l,d){super();fr(this,wu);fr(this,Gd);fr(this,Hd);fr(this,aa);fr(this,gu);Fn(this,Gd,l),this.setOptions(d),this.bindMethods(),Jr(this,wu,kb).call(this)}bindMethods(){this.mutate=this.mutate.bind(this),this.reset=this.reset.bind(this)}setOptions(l){var _;const d=this.options;this.options=tt(this,Gd).defaultMutationOptions(l),fw(this.options,d)||tt(this,Gd).getMutationCache().notify({type:"observerOptionsUpdated",mutation:tt(this,aa),observer:this}),d!=null&&d.mutationKey&&this.options.mutationKey&&sp(d.mutationKey)!==sp(this.options.mutationKey)?this.reset():((_=tt(this,aa))==null?void 0:_.state.status)==="pending"&&tt(this,aa).setOptions(this.options)}onUnsubscribe(){var l;this.hasListeners()||(l=tt(this,aa))==null||l.removeObserver(this)}onMutationUpdate(l){Jr(this,wu,kb).call(this),Jr(this,wu,UC).call(this,l)}getCurrentResult(){return tt(this,Hd)}reset(){var l;(l=tt(this,aa))==null||l.removeObserver(this),Fn(this,aa,void 0),Jr(this,wu,kb).call(this),Jr(this,wu,UC).call(this)}mutate(l,d){var _;return Fn(this,gu,d),(_=tt(this,aa))==null||_.removeObserver(this),Fn(this,aa,tt(this,Gd).getMutationCache().build(tt(this,Gd),this.options)),tt(this,aa).addObserver(this),tt(this,aa).execute(l)}},Gd=new WeakMap,Hd=new WeakMap,aa=new WeakMap,gu=new WeakMap,wu=new WeakSet,kb=function(){var d;const l=((d=tt(this,aa))==null?void 0:d.state)??LF();Fn(this,Hd,{...l,isPending:l.status==="pending",isSuccess:l.status==="success",isError:l.status==="error",isIdle:l.status==="idle",mutate:this.mutate,reset:this.reset})},UC=function(l){Gs.batch(()=>{var d,_,x,C,s,k,z,V;if(tt(this,gu)&&this.hasListeners()){const U=tt(this,Hd).variables,$=tt(this,Hd).context;(l==null?void 0:l.type)==="success"?((_=(d=tt(this,gu)).onSuccess)==null||_.call(d,l.data,U,$),(C=(x=tt(this,gu)).onSettled)==null||C.call(x,l.data,null,U,$)):(l==null?void 0:l.type)==="error"&&((k=(s=tt(this,gu)).onError)==null||k.call(s,l.error,U,$),(V=(z=tt(this,gu)).onSettled)==null||V.call(z,void 0,l.error,U,$))}this.listeners.forEach(U=>{U(tt(this,Hd))})})},GN),zF=B.createContext(void 0),h2=t=>{const r=B.useContext(zF);if(!r)throw new Error("No QueryClient set, use QueryClientProvider to set one");return r},EW=({client:t,children:r})=>(B.useEffect(()=>(t.mount(),()=>{t.unmount()}),[t]),w.jsx(zF.Provider,{value:t,children:r})),OF=B.createContext(!1),CW=()=>B.useContext(OF);OF.Provider;function AW(){let t=!1;return{clearReset:()=>{t=!1},reset:()=>{t=!0},isReset:()=>t}}var IW=B.createContext(AW()),PW=()=>B.useContext(IW);function FF(t,r){return typeof t=="function"?t(...r):!!t}function jF(){}var MW=(t,r)=>{(t.suspense||t.throwOnError)&&(r.isReset()||(t.retryOnMount=!1))},RW=t=>{B.useEffect(()=>{t.clearReset()},[t])},kW=({result:t,errorResetBoundary:r,throwOnError:l,query:d})=>t.isError&&!r.isReset()&&!t.isFetching&&d&&FF(l,[t.error,d]),DW=t=>{t.suspense&&(t.staleTime===void 0&&(t.staleTime=1e3),typeof t.gcTime=="number"&&(t.gcTime=Math.max(t.gcTime,1e3)))},LW=(t,r)=>t.isLoading&&t.isFetching&&!r,NW=(t,r)=>(t==null?void 0:t.suspense)&&r.isPending,GL=(t,r,l)=>r.fetchOptimistic(t).catch(()=>{l.clearReset()});function zW(t,r,l){var V,U,$,se,ae;const d=h2(),_=CW(),x=PW(),C=d.defaultQueryOptions(t);(U=(V=d.getDefaultOptions().queries)==null?void 0:V._experimental_beforeQuery)==null||U.call(V,C),C._optimisticResults=_?"isRestoring":"optimistic",DW(C),MW(C,x),RW(x);const s=!d.getQueryCache().get(C.queryHash),[k]=B.useState(()=>new r(d,C)),z=k.getOptimisticResult(C);if(B.useSyncExternalStore(B.useCallback(H=>{const ne=_?()=>{}:k.subscribe(Gs.batchCalls(H));return k.updateResult(),ne},[k,_]),()=>k.getCurrentResult(),()=>k.getCurrentResult()),B.useEffect(()=>{k.setOptions(C,{listeners:!1})},[C,k]),NW(C,z))throw GL(C,k,x);if(kW({result:z,errorResetBoundary:x,throwOnError:C.throwOnError,query:d.getQueryCache().get(C.queryHash)}))throw z.error;if((se=($=d.getDefaultOptions().queries)==null?void 0:$._experimental_afterQuery)==null||se.call($,C,z),C.experimental_prefetchInRender&&!ip&&LW(z,_)){const H=s?GL(C,k,x):(ae=d.getQueryCache().get(C.queryHash))==null?void 0:ae.promise;H==null||H.catch(jF).finally(()=>{k.updateResult()})}return C.notifyOnChangeProps?z:k.trackResult(z)}function Ia(t,r){return zW(t,bW)}function dh(t,r){const l=h2(),[d]=B.useState(()=>new TW(l,t));B.useEffect(()=>{d.setOptions(t)},[d,t]);const _=B.useSyncExternalStore(B.useCallback(C=>d.subscribe(Gs.batchCalls(C)),[d]),()=>d.getCurrentResult(),()=>d.getCurrentResult()),x=B.useCallback((C,s)=>{d.mutate(C,s).catch(jF)},[d]);if(_.error&&FF(d.options.throwOnError,[_.error]))throw _.error;return{..._,mutate:x,mutateAsync:_.mutate}}/**
 * @remix-run/router v1.20.0
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function ix(){return ix=Object.assign?Object.assign.bind():function(t){for(var r=1;r<arguments.length;r++){var l=arguments[r];for(var d in l)Object.prototype.hasOwnProperty.call(l,d)&&(t[d]=l[d])}return t},ix.apply(this,arguments)}var Zd;(function(t){t.Pop="POP",t.Push="PUSH",t.Replace="REPLACE"})(Zd||(Zd={}));const HL="popstate";function OW(t){t===void 0&&(t={});function r(d,_){let{pathname:x,search:C,hash:s}=d.location;return $C("",{pathname:x,search:C,hash:s},_.state&&_.state.usr||null,_.state&&_.state.key||"default")}function l(d,_){return typeof _=="string"?_:mw(_)}return jW(r,l,null,t)}function ks(t,r){if(t===!1||t===null||typeof t>"u")throw new Error(r)}function BF(t,r){if(!t){typeof console<"u"&&console.warn(r);try{throw new Error(r)}catch{}}}function FW(){return Math.random().toString(36).substr(2,8)}function qL(t,r){return{usr:t.state,key:t.key,idx:r}}function $C(t,r,l,d){return l===void 0&&(l=null),ix({pathname:typeof t=="string"?t:t.pathname,search:"",hash:""},typeof r=="string"?l_(r):r,{state:l,key:r&&r.key||d||FW()})}function mw(t){let{pathname:r="/",search:l="",hash:d=""}=t;return l&&l!=="?"&&(r+=l.charAt(0)==="?"?l:"?"+l),d&&d!=="#"&&(r+=d.charAt(0)==="#"?d:"#"+d),r}function l_(t){let r={};if(t){let l=t.indexOf("#");l>=0&&(r.hash=t.substr(l),t=t.substr(0,l));let d=t.indexOf("?");d>=0&&(r.search=t.substr(d),t=t.substr(0,d)),t&&(r.pathname=t)}return r}function jW(t,r,l,d){d===void 0&&(d={});let{window:_=document.defaultView,v5Compat:x=!1}=d,C=_.history,s=Zd.Pop,k=null,z=V();z==null&&(z=0,C.replaceState(ix({},C.state,{idx:z}),""));function V(){return(C.state||{idx:null}).idx}function U(){s=Zd.Pop;let ne=V(),Y=ne==null?null:ne-z;z=ne,k&&k({action:s,location:H.location,delta:Y})}function $(ne,Y){s=Zd.Push;let te=$C(H.location,ne,Y);z=V()+1;let de=qL(te,z),Me=H.createHref(te);try{C.pushState(de,"",Me)}catch(Le){if(Le instanceof DOMException&&Le.name==="DataCloneError")throw Le;_.location.assign(Me)}x&&k&&k({action:s,location:H.location,delta:1})}function se(ne,Y){s=Zd.Replace;let te=$C(H.location,ne,Y);z=V();let de=qL(te,z),Me=H.createHref(te);C.replaceState(de,"",Me),x&&k&&k({action:s,location:H.location,delta:0})}function ae(ne){let Y=_.location.origin!=="null"?_.location.origin:_.location.href,te=typeof ne=="string"?ne:mw(ne);return te=te.replace(/ $/,"%20"),ks(Y,"No window.location.(origin|href) available to create URL for href: "+te),new URL(te,Y)}let H={get action(){return s},get location(){return t(_,C)},listen(ne){if(k)throw new Error("A history only accepts one active listener");return _.addEventListener(HL,U),k=ne,()=>{_.removeEventListener(HL,U),k=null}},createHref(ne){return r(_,ne)},createURL:ae,encodeLocation(ne){let Y=ae(ne);return{pathname:Y.pathname,search:Y.search,hash:Y.hash}},push:$,replace:se,go(ne){return C.go(ne)}};return H}var WL;(function(t){t.data="data",t.deferred="deferred",t.redirect="redirect",t.error="error"})(WL||(WL={}));function BW(t,r,l){return l===void 0&&(l="/"),VW(t,r,l,!1)}function VW(t,r,l,d){let _=typeof r=="string"?l_(r):r,x=MI(_.pathname||"/",l);if(x==null)return null;let C=VF(t);UW(C);let s=null;for(let k=0;s==null&&k<C.length;++k){let z=JW(x);s=KW(C[k],z,d)}return s}function VF(t,r,l,d){r===void 0&&(r=[]),l===void 0&&(l=[]),d===void 0&&(d="");let _=(x,C,s)=>{let k={relativePath:s===void 0?x.path||"":s,caseSensitive:x.caseSensitive===!0,childrenIndex:C,route:x};k.relativePath.startsWith("/")&&(ks(k.relativePath.startsWith(d),'Absolute route path "'+k.relativePath+'" nested under path '+('"'+d+'" is not valid. An absolute child route path ')+"must start with the combined path of all its parent routes."),k.relativePath=k.relativePath.slice(d.length));let z=rh([d,k.relativePath]),V=l.concat(k);x.children&&x.children.length>0&&(ks(x.index!==!0,"Index routes must not have child routes. Please remove "+('all child routes from route path "'+z+'".')),VF(x.children,r,V,z)),!(x.path==null&&!x.index)&&r.push({path:z,score:XW(z,x.index),routesMeta:V})};return t.forEach((x,C)=>{var s;if(x.path===""||!((s=x.path)!=null&&s.includes("?")))_(x,C);else for(let k of UF(x.path))_(x,C,k)}),r}function UF(t){let r=t.split("/");if(r.length===0)return[];let[l,...d]=r,_=l.endsWith("?"),x=l.replace(/\?$/,"");if(d.length===0)return _?[x,""]:[x];let C=UF(d.join("/")),s=[];return s.push(...C.map(k=>k===""?x:[x,k].join("/"))),_&&s.push(...C),s.map(k=>t.startsWith("/")&&k===""?"/":k)}function UW(t){t.sort((r,l)=>r.score!==l.score?l.score-r.score:YW(r.routesMeta.map(d=>d.childrenIndex),l.routesMeta.map(d=>d.childrenIndex)))}const $W=/^:[\w-]+$/,GW=3,HW=2,qW=1,WW=10,ZW=-2,ZL=t=>t==="*";function XW(t,r){let l=t.split("/"),d=l.length;return l.some(ZL)&&(d+=ZW),r&&(d+=HW),l.filter(_=>!ZL(_)).reduce((_,x)=>_+($W.test(x)?GW:x===""?qW:WW),d)}function YW(t,r){return t.length===r.length&&t.slice(0,-1).every((d,_)=>d===r[_])?t[t.length-1]-r[r.length-1]:0}function KW(t,r,l){let{routesMeta:d}=t,_={},x="/",C=[];for(let s=0;s<d.length;++s){let k=d[s],z=s===d.length-1,V=x==="/"?r:r.slice(x.length)||"/",U=XL({path:k.relativePath,caseSensitive:k.caseSensitive,end:z},V),$=k.route;if(!U&&z&&l&&!d[d.length-1].route.index&&(U=XL({path:k.relativePath,caseSensitive:k.caseSensitive,end:!1},V)),!U)return null;Object.assign(_,U.params),C.push({params:_,pathname:rh([x,U.pathname]),pathnameBase:rZ(rh([x,U.pathnameBase])),route:$}),U.pathnameBase!=="/"&&(x=rh([x,U.pathnameBase]))}return C}function XL(t,r){typeof t=="string"&&(t={path:t,caseSensitive:!1,end:!0});let[l,d]=QW(t.path,t.caseSensitive,t.end),_=r.match(l);if(!_)return null;let x=_[0],C=x.replace(/(.)\/+$/,"$1"),s=_.slice(1);return{params:d.reduce((z,V,U)=>{let{paramName:$,isOptional:se}=V;if($==="*"){let H=s[U]||"";C=x.slice(0,x.length-H.length).replace(/(.)\/+$/,"$1")}const ae=s[U];return se&&!ae?z[$]=void 0:z[$]=(ae||"").replace(/%2F/g,"/"),z},{}),pathname:x,pathnameBase:C,pattern:t}}function QW(t,r,l){r===void 0&&(r=!1),l===void 0&&(l=!0),BF(t==="*"||!t.endsWith("*")||t.endsWith("/*"),'Route path "'+t+'" will be treated as if it were '+('"'+t.replace(/\*$/,"/*")+'" because the `*` character must ')+"always follow a `/` in the pattern. To get rid of this warning, "+('please change the route path to "'+t.replace(/\*$/,"/*")+'".'));let d=[],_="^"+t.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^${}|()[\]]/g,"\\$&").replace(/\/:([\w-]+)(\?)?/g,(C,s,k)=>(d.push({paramName:s,isOptional:k!=null}),k?"/?([^\\/]+)?":"/([^\\/]+)"));return t.endsWith("*")?(d.push({paramName:"*"}),_+=t==="*"||t==="/*"?"(.*)$":"(?:\\/(.+)|\\/*)$"):l?_+="\\/*$":t!==""&&t!=="/"&&(_+="(?:(?=\\/|$))"),[new RegExp(_,r?void 0:"i"),d]}function JW(t){try{return t.split("/").map(r=>decodeURIComponent(r).replace(/\//g,"%2F")).join("/")}catch(r){return BF(!1,'The URL path "'+t+'" could not be decoded because it is is a malformed URL segment. This is probably due to a bad percent '+("encoding ("+r+").")),t}}function MI(t,r){if(r==="/")return t;if(!t.toLowerCase().startsWith(r.toLowerCase()))return null;let l=r.endsWith("/")?r.length-1:r.length,d=t.charAt(l);return d&&d!=="/"?null:t.slice(l)||"/"}function eZ(t,r){r===void 0&&(r="/");let{pathname:l,search:d="",hash:_=""}=typeof t=="string"?l_(t):t;return{pathname:l?l.startsWith("/")?l:tZ(l,r):r,search:iZ(d),hash:sZ(_)}}function tZ(t,r){let l=r.replace(/\/+$/,"").split("/");return t.split("/").forEach(_=>{_===".."?l.length>1&&l.pop():_!=="."&&l.push(_)}),l.length>1?l.join("/"):"/"}function hE(t,r,l,d){return"Cannot include a '"+t+"' character in a manually specified "+("`to."+r+"` field ["+JSON.stringify(d)+"].  Please separate it out to the ")+("`to."+l+"` field. Alternatively you may provide the full path as ")+'a string in <Link to="..."> and the router will parse it for you.'}function nZ(t){return t.filter((r,l)=>l===0||r.route.path&&r.route.path.length>0)}function $F(t,r){let l=nZ(t);return r?l.map((d,_)=>_===l.length-1?d.pathname:d.pathnameBase):l.map(d=>d.pathnameBase)}function GF(t,r,l,d){d===void 0&&(d=!1);let _;typeof t=="string"?_=l_(t):(_=ix({},t),ks(!_.pathname||!_.pathname.includes("?"),hE("?","pathname","search",_)),ks(!_.pathname||!_.pathname.includes("#"),hE("#","pathname","hash",_)),ks(!_.search||!_.search.includes("#"),hE("#","search","hash",_)));let x=t===""||_.pathname==="",C=x?"/":_.pathname,s;if(C==null)s=l;else{let U=r.length-1;if(!d&&C.startsWith("..")){let $=C.split("/");for(;$[0]==="..";)$.shift(),U-=1;_.pathname=$.join("/")}s=U>=0?r[U]:"/"}let k=eZ(_,s),z=C&&C!=="/"&&C.endsWith("/"),V=(x||C===".")&&l.endsWith("/");return!k.pathname.endsWith("/")&&(z||V)&&(k.pathname+="/"),k}const rh=t=>t.join("/").replace(/\/\/+/g,"/"),rZ=t=>t.replace(/\/+$/,"").replace(/^\/*/,"/"),iZ=t=>!t||t==="?"?"":t.startsWith("?")?t:"?"+t,sZ=t=>!t||t==="#"?"":t.startsWith("#")?t:"#"+t;function oZ(t){return t!=null&&typeof t.status=="number"&&typeof t.statusText=="string"&&typeof t.internal=="boolean"&&"data"in t}const HF=["post","put","patch","delete"];new Set(HF);const aZ=["get",...HF];new Set(aZ);/**
 * React Router v6.27.0
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function sx(){return sx=Object.assign?Object.assign.bind():function(t){for(var r=1;r<arguments.length;r++){var l=arguments[r];for(var d in l)Object.prototype.hasOwnProperty.call(l,d)&&(t[d]=l[d])}return t},sx.apply(this,arguments)}const RI=B.createContext(null),lZ=B.createContext(null),xp=B.createContext(null),f2=B.createContext(null),bh=B.createContext({outlet:null,matches:[],isDataRoute:!1}),qF=B.createContext(null);function cZ(t,r){let{relative:l}=r===void 0?{}:r;Lx()||ks(!1);let{basename:d,navigator:_}=B.useContext(xp),{hash:x,pathname:C,search:s}=ZF(t,{relative:l}),k=C;return d!=="/"&&(k=C==="/"?d:rh([d,C])),_.createHref({pathname:k,search:s,hash:x})}function Lx(){return B.useContext(f2)!=null}function c_(){return Lx()||ks(!1),B.useContext(f2).location}function WF(t){B.useContext(xp).static||B.useLayoutEffect(t)}function Hl(){let{isDataRoute:t}=B.useContext(bh);return t?SZ():uZ()}function uZ(){Lx()||ks(!1);let t=B.useContext(RI),{basename:r,future:l,navigator:d}=B.useContext(xp),{matches:_}=B.useContext(bh),{pathname:x}=c_(),C=JSON.stringify($F(_,l.v7_relativeSplatPath)),s=B.useRef(!1);return WF(()=>{s.current=!0}),B.useCallback(function(z,V){if(V===void 0&&(V={}),!s.current)return;if(typeof z=="number"){d.go(z);return}let U=GF(z,JSON.parse(C),x,V.relative==="path");t==null&&r!=="/"&&(U.pathname=U.pathname==="/"?r:rh([r,U.pathname])),(V.replace?d.replace:d.push)(U,V.state,V)},[r,d,C,x,t])}function dZ(){let{matches:t}=B.useContext(bh),r=t[t.length-1];return r?r.params:{}}function ZF(t,r){let{relative:l}=r===void 0?{}:r,{future:d}=B.useContext(xp),{matches:_}=B.useContext(bh),{pathname:x}=c_(),C=JSON.stringify($F(_,d.v7_relativeSplatPath));return B.useMemo(()=>GF(t,JSON.parse(C),x,l==="path"),[t,C,x,l])}function hZ(t,r){return fZ(t,r)}function fZ(t,r,l,d){Lx()||ks(!1);let{navigator:_}=B.useContext(xp),{matches:x}=B.useContext(bh),C=x[x.length-1],s=C?C.params:{};C&&C.pathname;let k=C?C.pathnameBase:"/";C&&C.route;let z=c_(),V;if(r){var U;let ne=typeof r=="string"?l_(r):r;k==="/"||(U=ne.pathname)!=null&&U.startsWith(k)||ks(!1),V=ne}else V=z;let $=V.pathname||"/",se=$;if(k!=="/"){let ne=k.replace(/^\//,"").split("/");se="/"+$.replace(/^\//,"").split("/").slice(ne.length).join("/")}let ae=BW(t,{pathname:se}),H=yZ(ae&&ae.map(ne=>Object.assign({},ne,{params:Object.assign({},s,ne.params),pathname:rh([k,_.encodeLocation?_.encodeLocation(ne.pathname).pathname:ne.pathname]),pathnameBase:ne.pathnameBase==="/"?k:rh([k,_.encodeLocation?_.encodeLocation(ne.pathnameBase).pathname:ne.pathnameBase])})),x,l,d);return r&&H?B.createElement(f2.Provider,{value:{location:sx({pathname:"/",search:"",hash:"",state:null,key:"default"},V),navigationType:Zd.Pop}},H):H}function pZ(){let t=wZ(),r=oZ(t)?t.status+" "+t.statusText:t instanceof Error?t.message:JSON.stringify(t),l=t instanceof Error?t.stack:null,_={padding:"0.5rem",backgroundColor:"rgba(200,200,200, 0.5)"};return B.createElement(B.Fragment,null,B.createElement("h2",null,"Unexpected Application Error!"),B.createElement("h3",{style:{fontStyle:"italic"}},r),l?B.createElement("pre",{style:_},l):null,null)}const mZ=B.createElement(pZ,null);class gZ extends B.Component{constructor(r){super(r),this.state={location:r.location,revalidation:r.revalidation,error:r.error}}static getDerivedStateFromError(r){return{error:r}}static getDerivedStateFromProps(r,l){return l.location!==r.location||l.revalidation!=="idle"&&r.revalidation==="idle"?{error:r.error,location:r.location,revalidation:r.revalidation}:{error:r.error!==void 0?r.error:l.error,location:l.location,revalidation:r.revalidation||l.revalidation}}componentDidCatch(r,l){console.error("React Router caught the following error during render",r,l)}render(){return this.state.error!==void 0?B.createElement(bh.Provider,{value:this.props.routeContext},B.createElement(qF.Provider,{value:this.state.error,children:this.props.component})):this.props.children}}function _Z(t){let{routeContext:r,match:l,children:d}=t,_=B.useContext(RI);return _&&_.static&&_.staticContext&&(l.route.errorElement||l.route.ErrorBoundary)&&(_.staticContext._deepestRenderedBoundaryId=l.route.id),B.createElement(bh.Provider,{value:r},d)}function yZ(t,r,l,d){var _;if(r===void 0&&(r=[]),l===void 0&&(l=null),d===void 0&&(d=null),t==null){var x;if(!l)return null;if(l.errors)t=l.matches;else if((x=d)!=null&&x.v7_partialHydration&&r.length===0&&!l.initialized&&l.matches.length>0)t=l.matches;else return null}let C=t,s=(_=l)==null?void 0:_.errors;if(s!=null){let V=C.findIndex(U=>U.route.id&&(s==null?void 0:s[U.route.id])!==void 0);V>=0||ks(!1),C=C.slice(0,Math.min(C.length,V+1))}let k=!1,z=-1;if(l&&d&&d.v7_partialHydration)for(let V=0;V<C.length;V++){let U=C[V];if((U.route.HydrateFallback||U.route.hydrateFallbackElement)&&(z=V),U.route.id){let{loaderData:$,errors:se}=l,ae=U.route.loader&&$[U.route.id]===void 0&&(!se||se[U.route.id]===void 0);if(U.route.lazy||ae){k=!0,z>=0?C=C.slice(0,z+1):C=[C[0]];break}}}return C.reduceRight((V,U,$)=>{let se,ae=!1,H=null,ne=null;l&&(se=s&&U.route.id?s[U.route.id]:void 0,H=U.route.errorElement||mZ,k&&(z<0&&$===0?(ae=!0,ne=null):z===$&&(ae=!0,ne=U.route.hydrateFallbackElement||null)));let Y=r.concat(C.slice(0,$+1)),te=()=>{let de;return se?de=H:ae?de=ne:U.route.Component?de=B.createElement(U.route.Component,null):U.route.element?de=U.route.element:de=V,B.createElement(_Z,{match:U,routeContext:{outlet:V,matches:Y,isDataRoute:l!=null},children:de})};return l&&(U.route.ErrorBoundary||U.route.errorElement||$===0)?B.createElement(gZ,{location:l.location,revalidation:l.revalidation,component:H,error:se,children:te(),routeContext:{outlet:null,matches:Y,isDataRoute:!0}}):te()},null)}var XF=function(t){return t.UseBlocker="useBlocker",t.UseRevalidator="useRevalidator",t.UseNavigateStable="useNavigate",t}(XF||{}),gw=function(t){return t.UseBlocker="useBlocker",t.UseLoaderData="useLoaderData",t.UseActionData="useActionData",t.UseRouteError="useRouteError",t.UseNavigation="useNavigation",t.UseRouteLoaderData="useRouteLoaderData",t.UseMatches="useMatches",t.UseRevalidator="useRevalidator",t.UseNavigateStable="useNavigate",t.UseRouteId="useRouteId",t}(gw||{});function vZ(t){let r=B.useContext(RI);return r||ks(!1),r}function xZ(t){let r=B.useContext(lZ);return r||ks(!1),r}function bZ(t){let r=B.useContext(bh);return r||ks(!1),r}function YF(t){let r=bZ(),l=r.matches[r.matches.length-1];return l.route.id||ks(!1),l.route.id}function wZ(){var t;let r=B.useContext(qF),l=xZ(gw.UseRouteError),d=YF(gw.UseRouteError);return r!==void 0?r:(t=l.errors)==null?void 0:t[d]}function SZ(){let{router:t}=vZ(XF.UseNavigateStable),r=YF(gw.UseNavigateStable),l=B.useRef(!1);return WF(()=>{l.current=!0}),B.useCallback(function(_,x){x===void 0&&(x={}),l.current&&(typeof _=="number"?t.navigate(_):t.navigate(_,sx({fromRouteId:r},x)))},[t,r])}function Sl(t){ks(!1)}function TZ(t){let{basename:r="/",children:l=null,location:d,navigationType:_=Zd.Pop,navigator:x,static:C=!1,future:s}=t;Lx()&&ks(!1);let k=r.replace(/^\/*/,"/"),z=B.useMemo(()=>({basename:k,navigator:x,static:C,future:sx({v7_relativeSplatPath:!1},s)}),[k,s,x,C]);typeof d=="string"&&(d=l_(d));let{pathname:V="/",search:U="",hash:$="",state:se=null,key:ae="default"}=d,H=B.useMemo(()=>{let ne=MI(V,k);return ne==null?null:{location:{pathname:ne,search:U,hash:$,state:se,key:ae},navigationType:_}},[k,V,U,$,se,ae,_]);return H==null?null:B.createElement(xp.Provider,{value:z},B.createElement(f2.Provider,{children:l,value:H}))}function EZ(t){let{children:r,location:l}=t;return hZ(GC(r),l)}new Promise(()=>{});function GC(t,r){r===void 0&&(r=[]);let l=[];return B.Children.forEach(t,(d,_)=>{if(!B.isValidElement(d))return;let x=[...r,_];if(d.type===B.Fragment){l.push.apply(l,GC(d.props.children,x));return}d.type!==Sl&&ks(!1),!d.props.index||!d.props.children||ks(!1);let C={id:d.props.id||x.join("-"),caseSensitive:d.props.caseSensitive,element:d.props.element,Component:d.props.Component,index:d.props.index,path:d.props.path,loader:d.props.loader,action:d.props.action,errorElement:d.props.errorElement,ErrorBoundary:d.props.ErrorBoundary,hasErrorBoundary:d.props.ErrorBoundary!=null||d.props.errorElement!=null,shouldRevalidate:d.props.shouldRevalidate,handle:d.props.handle,lazy:d.props.lazy};d.props.children&&(C.children=GC(d.props.children,x)),l.push(C)}),l}/**
 * React Router DOM v6.27.0
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function HC(){return HC=Object.assign?Object.assign.bind():function(t){for(var r=1;r<arguments.length;r++){var l=arguments[r];for(var d in l)Object.prototype.hasOwnProperty.call(l,d)&&(t[d]=l[d])}return t},HC.apply(this,arguments)}function CZ(t,r){if(t==null)return{};var l={},d=Object.keys(t),_,x;for(x=0;x<d.length;x++)_=d[x],!(r.indexOf(_)>=0)&&(l[_]=t[_]);return l}function AZ(t){return!!(t.metaKey||t.altKey||t.ctrlKey||t.shiftKey)}function IZ(t,r){return t.button===0&&(!r||r==="_self")&&!AZ(t)}function qC(t){return t===void 0&&(t=""),new URLSearchParams(typeof t=="string"||Array.isArray(t)||t instanceof URLSearchParams?t:Object.keys(t).reduce((r,l)=>{let d=t[l];return r.concat(Array.isArray(d)?d.map(_=>[l,_]):[[l,d]])},[]))}function PZ(t,r){let l=qC(t);return r&&r.forEach((d,_)=>{l.has(_)||r.getAll(_).forEach(x=>{l.append(_,x)})}),l}const MZ=["onClick","relative","reloadDocument","replace","state","target","to","preventScrollReset","viewTransition"],RZ="6";try{window.__reactRouterVersion=RZ}catch{}const kZ="startTransition",YL=t3[kZ];function DZ(t){let{basename:r,children:l,future:d,window:_}=t,x=B.useRef();x.current==null&&(x.current=OW({window:_,v5Compat:!0}));let C=x.current,[s,k]=B.useState({action:C.action,location:C.location}),{v7_startTransition:z}=d||{},V=B.useCallback(U=>{z&&YL?YL(()=>k(U)):k(U)},[k,z]);return B.useLayoutEffect(()=>C.listen(V),[C,V]),B.createElement(TZ,{basename:r,children:l,location:s.location,navigationType:s.action,navigator:C,future:d})}const LZ=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u",NZ=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,Db=B.forwardRef(function(r,l){let{onClick:d,relative:_,reloadDocument:x,replace:C,state:s,target:k,to:z,preventScrollReset:V,viewTransition:U}=r,$=CZ(r,MZ),{basename:se}=B.useContext(xp),ae,H=!1;if(typeof z=="string"&&NZ.test(z)&&(ae=z,LZ))try{let de=new URL(window.location.href),Me=z.startsWith("//")?new URL(de.protocol+z):new URL(z),Le=MI(Me.pathname,se);Me.origin===de.origin&&Le!=null?z=Le+Me.search+Me.hash:H=!0}catch{}let ne=cZ(z,{relative:_}),Y=zZ(z,{replace:C,state:s,target:k,preventScrollReset:V,relative:_,viewTransition:U});function te(de){d&&d(de),de.defaultPrevented||Y(de)}return B.createElement("a",HC({},$,{href:ae||ne,onClick:H||x?d:te,ref:l,target:k}))});var KL;(function(t){t.UseScrollRestoration="useScrollRestoration",t.UseSubmit="useSubmit",t.UseSubmitFetcher="useSubmitFetcher",t.UseFetcher="useFetcher",t.useViewTransitionState="useViewTransitionState"})(KL||(KL={}));var QL;(function(t){t.UseFetcher="useFetcher",t.UseFetchers="useFetchers",t.UseScrollRestoration="useScrollRestoration"})(QL||(QL={}));function zZ(t,r){let{target:l,replace:d,state:_,preventScrollReset:x,relative:C,viewTransition:s}=r===void 0?{}:r,k=Hl(),z=c_(),V=ZF(t,{relative:C});return B.useCallback(U=>{if(IZ(U,l)){U.preventDefault();let $=d!==void 0?d:mw(z)===mw(V);k(t,{replace:$,state:_,preventScrollReset:x,relative:C,viewTransition:s})}},[z,k,V,d,_,l,t,x,C,s])}function OZ(t){let r=B.useRef(qC(t)),l=B.useRef(!1),d=c_(),_=B.useMemo(()=>PZ(d.search,l.current?null:r.current),[d.search]),x=Hl(),C=B.useCallback((s,k)=>{const z=qC(typeof s=="function"?s(_):s);l.current=!0,x("?"+z,k)},[x,_]);return[_,C]}let JL=!1;function FZ(){return new Promise((t,r)=>{if(JL&&window.google&&window.google.accounts){t();return}const l=document.createElement("script");l.src="https://accounts.google.com/gsi/client",l.async=!0,l.defer=!0,l.onload=()=>{JL=!0,t()},l.onerror=r,document.head.appendChild(l)})}async function jZ(){if(await FZ(),!window.google)throw new Error("Google API not loaded");window.google.accounts.id.initialize({client_id:"593373477089-ltev0f1kk304ijlmbvpmqfpa62kluifo.apps.googleusercontent.com",callback:BZ})}function BZ(t){const r=t.credential,l=JSON.parse(atob(r.split(".")[1])),d={id:l.sub,email:l.email,name:l.name,picture:l.picture,googleId:l.sub};localStorage.setItem("googleUser",JSON.stringify(d)),localStorage.setItem("googleToken",r),window.dispatchEvent(new CustomEvent("authStateChange",{detail:d}))}function VZ(){if(!window.google)throw new Error("Google API not initialized");window.google.accounts.id.prompt()}function UZ(){localStorage.removeItem("googleUser"),localStorage.removeItem("googleToken"),window.google&&window.google.accounts&&window.google.accounts.id.disableAutoSelect(),window.dispatchEvent(new CustomEvent("authStateChange",{detail:null}))}function $Z(){const t=localStorage.getItem("googleUser");return t?JSON.parse(t):null}function GZ(){return localStorage.getItem("googleToken")}function HZ(t){const r=$Z();t(r);const l=d=>{t(d.detail)};return window.addEventListener("authStateChange",l),()=>{window.removeEventListener("authStateChange",l)}}const KF="crisis-moderator-key";function QF(){return localStorage.getItem("moderatorKey")===KF}function eN(){const t=prompt("Enter moderator access key:");return t===KF?(localStorage.setItem("moderatorKey",t),!0):(alert("Invalid moderator key"),!1)}function JF(){const t=localStorage.getItem("moderatorKey");return t?{"x-moderator-key":t}:{}}const qZ=async({queryKey:t})=>{const[r]=t;return op(r)},Pu=new xW({defaultOptions:{queries:{staleTime:5*60*1e3,retry:1,queryFn:qZ},mutations:{retry:1}}});async function op(t,r={}){let l;t.startsWith("http")||t.startsWith("/api/")?l=t:l=`/api${t.startsWith("/")?t:`/${t}`}`;const d={"Content-Type":"application/json",...JF()},_={...r,headers:{...d,...r.headers}},x=await fetch(l,_);if(!x.ok)throw new Error(`HTTP error! status: ${x.status}`);const C=x.headers.get("content-type");return C&&C.includes("application/json")?x.json():x.text()}const ej=B.createContext(void 0);function WZ({children:t}){const[r,l]=B.useState(null),[d,_]=B.useState(null),[x,C]=B.useState(!0),s=async se=>{try{const ae=GZ();return await op("/api/auth/user",{method:"GET",headers:{Authorization:`Bearer ${ae}`}})}catch(ae){return console.error("Error fetching user data:",ae),null}},k=async()=>{if(r){const se=await s();_(se)}};B.useEffect(()=>{let se=!0;jZ().catch(H=>{console.error("Failed to initialize Google Auth:",H)});const ae=HZ(async H=>{if(se){if(l(H),H){const ne=await s();se&&_(ne)}else se&&_(null);se&&C(!1)}});return()=>{se=!1,ae()}},[]);const z=()=>{VZ()},V=async()=>{UZ(),_(null),l(null)},U=(d==null?void 0:d.isVerifiedHost)&&(d==null?void 0:d.verifiedHostExpiresAt)&&new Date(d.verifiedHostExpiresAt)>new Date,$={googleUser:r,user:d,loading:x,isVerifiedHost:U,signIn:z,signOut:V,refreshUser:k};return w.jsx(ej.Provider,{value:$,children:t})}function u_(){const t=B.useContext(ej);if(t===void 0)throw new Error("useAuth must be used within an AuthProvider");return t}var tj={exports:{}};(function(t,r){(function(l,d){t.exports=d()})(z8,function(){var l,d,_;function x(s,k){if(!l)l=k;else if(!d)d=k;else{var z="self.onerror = function() { console.error('An error occurred while parsing the WebWorker bundle. This is most likely due to improper transpilation by Babel; please see https://docs.mapbox.com/mapbox-gl-js/guides/install/#transpiling'); }; var sharedChunk = {}; ("+l+")(sharedChunk); ("+d+")(sharedChunk); self.onerror = null;",V={};l(V),_=k(V),typeof window<"u"&&window&&window.URL&&window.URL.createObjectURL&&(_.workerUrl=window.URL.createObjectURL(new Blob([z],{type:"text/javascript"})))}}x(["exports"],function(s){var k=1e-6,z=typeof Float32Array<"u"?Float32Array:Array;function V(o,e){var i=e[0],c=e[1],u=e[2],p=e[3],m=i*p-u*c;return m?(o[0]=p*(m=1/m),o[1]=-c*m,o[2]=-u*m,o[3]=i*m,o):null}function U(){var o=new z(9);return z!=Float32Array&&(o[1]=0,o[2]=0,o[3]=0,o[5]=0,o[6]=0,o[7]=0),o[0]=1,o[4]=1,o[8]=1,o}function $(o,e){var i=e[0],c=e[1],u=e[2],p=e[3],m=e[4],v=e[5],S=e[6],T=e[7],I=e[8];return o[0]=m*I-v*T,o[1]=u*T-c*I,o[2]=c*v-u*m,o[3]=v*S-p*I,o[4]=i*I-u*S,o[5]=u*p-i*v,o[6]=p*T-m*S,o[7]=c*S-i*T,o[8]=i*m-c*p,o}function se(o,e,i){var c=e[0],u=e[1],p=e[2],m=e[3],v=e[4],S=e[5],T=e[6],I=e[7],P=e[8],M=i[0],L=i[1],O=i[2],G=i[3],Z=i[4],Q=i[5],le=i[6],ce=i[7],q=i[8];return o[0]=M*c+L*m+O*T,o[1]=M*u+L*v+O*I,o[2]=M*p+L*S+O*P,o[3]=G*c+Z*m+Q*T,o[4]=G*u+Z*v+Q*I,o[5]=G*p+Z*S+Q*P,o[6]=le*c+ce*m+q*T,o[7]=le*u+ce*v+q*I,o[8]=le*p+ce*S+q*P,o}function ae(){var o=new z(16);return z!=Float32Array&&(o[1]=0,o[2]=0,o[3]=0,o[4]=0,o[6]=0,o[7]=0,o[8]=0,o[9]=0,o[11]=0,o[12]=0,o[13]=0,o[14]=0),o[0]=1,o[5]=1,o[10]=1,o[15]=1,o}function H(o){return o[0]=1,o[1]=0,o[2]=0,o[3]=0,o[4]=0,o[5]=1,o[6]=0,o[7]=0,o[8]=0,o[9]=0,o[10]=1,o[11]=0,o[12]=0,o[13]=0,o[14]=0,o[15]=1,o}function ne(o,e){var i=e[0],c=e[1],u=e[2],p=e[3],m=e[4],v=e[5],S=e[6],T=e[7],I=e[8],P=e[9],M=e[10],L=e[11],O=e[12],G=e[13],Z=e[14],Q=e[15],le=i*v-c*m,ce=i*S-u*m,q=i*T-p*m,re=c*S-u*v,ue=c*T-p*v,pe=u*T-p*S,Ae=I*G-P*O,Te=I*Z-M*O,Ie=I*Q-L*O,Ne=P*Z-M*G,Ke=P*Q-L*G,yt=M*Q-L*Z,at=le*yt-ce*Ke+q*Ne+re*Ie-ue*Te+pe*Ae;return at?(o[0]=(v*yt-S*Ke+T*Ne)*(at=1/at),o[1]=(u*Ke-c*yt-p*Ne)*at,o[2]=(G*pe-Z*ue+Q*re)*at,o[3]=(M*ue-P*pe-L*re)*at,o[4]=(S*Ie-m*yt-T*Te)*at,o[5]=(i*yt-u*Ie+p*Te)*at,o[6]=(Z*q-O*pe-Q*ce)*at,o[7]=(I*pe-M*q+L*ce)*at,o[8]=(m*Ke-v*Ie+T*Ae)*at,o[9]=(c*Ie-i*Ke-p*Ae)*at,o[10]=(O*ue-G*q+Q*le)*at,o[11]=(P*q-I*ue-L*le)*at,o[12]=(v*Te-m*Ne-S*Ae)*at,o[13]=(i*Ne-c*Te+u*Ae)*at,o[14]=(G*ce-O*re-Z*le)*at,o[15]=(I*re-P*ce+M*le)*at,o):null}function Y(o,e,i){var c=e[0],u=e[1],p=e[2],m=e[3],v=e[4],S=e[5],T=e[6],I=e[7],P=e[8],M=e[9],L=e[10],O=e[11],G=e[12],Z=e[13],Q=e[14],le=e[15],ce=i[0],q=i[1],re=i[2],ue=i[3];return o[0]=ce*c+q*v+re*P+ue*G,o[1]=ce*u+q*S+re*M+ue*Z,o[2]=ce*p+q*T+re*L+ue*Q,o[3]=ce*m+q*I+re*O+ue*le,o[4]=(ce=i[4])*c+(q=i[5])*v+(re=i[6])*P+(ue=i[7])*G,o[5]=ce*u+q*S+re*M+ue*Z,o[6]=ce*p+q*T+re*L+ue*Q,o[7]=ce*m+q*I+re*O+ue*le,o[8]=(ce=i[8])*c+(q=i[9])*v+(re=i[10])*P+(ue=i[11])*G,o[9]=ce*u+q*S+re*M+ue*Z,o[10]=ce*p+q*T+re*L+ue*Q,o[11]=ce*m+q*I+re*O+ue*le,o[12]=(ce=i[12])*c+(q=i[13])*v+(re=i[14])*P+(ue=i[15])*G,o[13]=ce*u+q*S+re*M+ue*Z,o[14]=ce*p+q*T+re*L+ue*Q,o[15]=ce*m+q*I+re*O+ue*le,o}function te(o,e,i){var c,u,p,m,v,S,T,I,P,M,L,O,G=i[0],Z=i[1],Q=i[2];return e===o?(o[12]=e[0]*G+e[4]*Z+e[8]*Q+e[12],o[13]=e[1]*G+e[5]*Z+e[9]*Q+e[13],o[14]=e[2]*G+e[6]*Z+e[10]*Q+e[14],o[15]=e[3]*G+e[7]*Z+e[11]*Q+e[15]):(u=e[1],p=e[2],m=e[3],v=e[4],S=e[5],T=e[6],I=e[7],P=e[8],M=e[9],L=e[10],O=e[11],o[0]=c=e[0],o[1]=u,o[2]=p,o[3]=m,o[4]=v,o[5]=S,o[6]=T,o[7]=I,o[8]=P,o[9]=M,o[10]=L,o[11]=O,o[12]=c*G+v*Z+P*Q+e[12],o[13]=u*G+S*Z+M*Q+e[13],o[14]=p*G+T*Z+L*Q+e[14],o[15]=m*G+I*Z+O*Q+e[15]),o}function de(o,e,i){var c=i[0],u=i[1],p=i[2];return o[0]=e[0]*c,o[1]=e[1]*c,o[2]=e[2]*c,o[3]=e[3]*c,o[4]=e[4]*u,o[5]=e[5]*u,o[6]=e[6]*u,o[7]=e[7]*u,o[8]=e[8]*p,o[9]=e[9]*p,o[10]=e[10]*p,o[11]=e[11]*p,o[12]=e[12],o[13]=e[13],o[14]=e[14],o[15]=e[15],o}function Me(o,e,i){var c=Math.sin(i),u=Math.cos(i),p=e[4],m=e[5],v=e[6],S=e[7],T=e[8],I=e[9],P=e[10],M=e[11];return e!==o&&(o[0]=e[0],o[1]=e[1],o[2]=e[2],o[3]=e[3],o[12]=e[12],o[13]=e[13],o[14]=e[14],o[15]=e[15]),o[4]=p*u+T*c,o[5]=m*u+I*c,o[6]=v*u+P*c,o[7]=S*u+M*c,o[8]=T*u-p*c,o[9]=I*u-m*c,o[10]=P*u-v*c,o[11]=M*u-S*c,o}function Le(o,e,i){var c=Math.sin(i),u=Math.cos(i),p=e[0],m=e[1],v=e[2],S=e[3],T=e[8],I=e[9],P=e[10],M=e[11];return e!==o&&(o[4]=e[4],o[5]=e[5],o[6]=e[6],o[7]=e[7],o[12]=e[12],o[13]=e[13],o[14]=e[14],o[15]=e[15]),o[0]=p*u-T*c,o[1]=m*u-I*c,o[2]=v*u-P*c,o[3]=S*u-M*c,o[8]=p*c+T*u,o[9]=m*c+I*u,o[10]=v*c+P*u,o[11]=S*c+M*u,o}function lt(o,e,i){var c=Math.sin(i),u=Math.cos(i),p=e[0],m=e[1],v=e[2],S=e[3],T=e[4],I=e[5],P=e[6],M=e[7];return e!==o&&(o[8]=e[8],o[9]=e[9],o[10]=e[10],o[11]=e[11],o[12]=e[12],o[13]=e[13],o[14]=e[14],o[15]=e[15]),o[0]=p*u+T*c,o[1]=m*u+I*c,o[2]=v*u+P*c,o[3]=S*u+M*c,o[4]=T*u-p*c,o[5]=I*u-m*c,o[6]=P*u-v*c,o[7]=M*u-S*c,o}function Pe(o,e){return o[0]=e[0],o[1]=0,o[2]=0,o[3]=0,o[4]=0,o[5]=e[1],o[6]=0,o[7]=0,o[8]=0,o[9]=0,o[10]=e[2],o[11]=0,o[12]=0,o[13]=0,o[14]=0,o[15]=1,o}function Ye(o,e,i){var c,u,p,m=i[0],v=i[1],S=i[2],T=Math.hypot(m,v,S);return T<k?null:(m*=T=1/T,v*=T,S*=T,c=Math.sin(e),u=Math.cos(e),o[0]=m*m*(p=1-u)+u,o[1]=v*m*p+S*c,o[2]=S*m*p-v*c,o[3]=0,o[4]=m*v*p-S*c,o[5]=v*v*p+u,o[6]=S*v*p+m*c,o[7]=0,o[8]=m*S*p+v*c,o[9]=v*S*p-m*c,o[10]=S*S*p+u,o[11]=0,o[12]=0,o[13]=0,o[14]=0,o[15]=1,o)}function vt(o,e){var i=e[0],c=e[1],u=e[2],p=e[3],m=i+i,v=c+c,S=u+u,T=i*m,I=c*m,P=c*v,M=u*m,L=u*v,O=u*S,G=p*m,Z=p*v,Q=p*S;return o[0]=1-P-O,o[1]=I+Q,o[2]=M-Z,o[3]=0,o[4]=I-Q,o[5]=1-T-O,o[6]=L+G,o[7]=0,o[8]=M+Z,o[9]=L-G,o[10]=1-T-P,o[11]=0,o[12]=0,o[13]=0,o[14]=0,o[15]=1,o}Math.hypot||(Math.hypot=function(){for(var o=0,e=arguments.length;e--;)o+=arguments[e]*arguments[e];return Math.sqrt(o)});var It=Y;function Ut(){var o=new z(3);return z!=Float32Array&&(o[0]=0,o[1]=0,o[2]=0),o}function Pt(o){var e=new z(3);return e[0]=o[0],e[1]=o[1],e[2]=o[2],e}function $t(o){return Math.hypot(o[0],o[1],o[2])}function Ve(o,e,i){var c=new z(3);return c[0]=o,c[1]=e,c[2]=i,c}function jt(o,e,i){return o[0]=e[0]+i[0],o[1]=e[1]+i[1],o[2]=e[2]+i[2],o}function Je(o,e,i){return o[0]=e[0]-i[0],o[1]=e[1]-i[1],o[2]=e[2]-i[2],o}function mt(o,e,i){return o[0]=e[0]*i[0],o[1]=e[1]*i[1],o[2]=e[2]*i[2],o}function Be(o,e,i){return o[0]=Math.min(e[0],i[0]),o[1]=Math.min(e[1],i[1]),o[2]=Math.min(e[2],i[2]),o}function ft(o,e,i){return o[0]=Math.max(e[0],i[0]),o[1]=Math.max(e[1],i[1]),o[2]=Math.max(e[2],i[2]),o}function Ct(o,e,i){return o[0]=e[0]*i,o[1]=e[1]*i,o[2]=e[2]*i,o}function Zt(o,e,i,c){return o[0]=e[0]+i[0]*c,o[1]=e[1]+i[1]*c,o[2]=e[2]+i[2]*c,o}function fn(o,e){var i=e[0]-o[0],c=e[1]-o[1],u=e[2]-o[2];return i*i+c*c+u*u}function Qn(o){var e=o[0],i=o[1],c=o[2];return e*e+i*i+c*c}function $n(o,e){return o[0]=-e[0],o[1]=-e[1],o[2]=-e[2],o}function Hn(o,e){var i=e[0],c=e[1],u=e[2],p=i*i+c*c+u*u;return p>0&&(p=1/Math.sqrt(p)),o[0]=e[0]*p,o[1]=e[1]*p,o[2]=e[2]*p,o}function rn(o,e){return o[0]*e[0]+o[1]*e[1]+o[2]*e[2]}function an(o,e,i){var c=e[0],u=e[1],p=e[2],m=i[0],v=i[1],S=i[2];return o[0]=u*S-p*v,o[1]=p*m-c*S,o[2]=c*v-u*m,o}function or(o,e,i,c){var u=e[0],p=e[1],m=e[2];return o[0]=u+c*(i[0]-u),o[1]=p+c*(i[1]-p),o[2]=m+c*(i[2]-m),o}function Mn(o,e,i){var c=e[0],u=e[1],p=e[2],m=i[3]*c+i[7]*u+i[11]*p+i[15];return o[0]=(i[0]*c+i[4]*u+i[8]*p+i[12])/(m=m||1),o[1]=(i[1]*c+i[5]*u+i[9]*p+i[13])/m,o[2]=(i[2]*c+i[6]*u+i[10]*p+i[14])/m,o}function Mr(o,e,i){var c=e[0],u=e[1],p=e[2];return o[0]=c*i[0]+u*i[3]+p*i[6],o[1]=c*i[1]+u*i[4]+p*i[7],o[2]=c*i[2]+u*i[5]+p*i[8],o}function Lr(o,e,i){var c=i[0],u=i[1],p=i[2],m=e[0],v=e[1],S=e[2],T=u*S-p*v,I=p*m-c*S,P=c*v-u*m,M=u*P-p*I,L=p*T-c*P,O=c*I-u*T,G=2*i[3];return I*=G,P*=G,L*=2,O*=2,o[0]=m+(T*=G)+(M*=2),o[1]=v+I+L,o[2]=S+P+O,o}function xr(o,e){return o[0]===e[0]&&o[1]===e[1]&&o[2]===e[2]}var Tr=Je,Ki=mt,Cs=$t;function Ri(){var o=new z(4);return z!=Float32Array&&(o[0]=0,o[1]=0,o[2]=0,o[3]=0),o}function Ws(o,e,i){return o[0]=e[0]*i,o[1]=e[1]*i,o[2]=e[2]*i,o[3]=e[3]*i,o}function We(o,e){var i=e[0],c=e[1],u=e[2],p=e[3],m=i*i+c*c+u*u+p*p;return m>0&&(m=1/Math.sqrt(m)),o[0]=i*m,o[1]=c*m,o[2]=u*m,o[3]=p*m,o}function ut(o,e,i){var c=e[0],u=e[1],p=e[2],m=e[3];return o[0]=i[0]*c+i[4]*u+i[8]*p+i[12]*m,o[1]=i[1]*c+i[5]*u+i[9]*p+i[13]*m,o[2]=i[2]*c+i[6]*u+i[10]*p+i[14]*m,o[3]=i[3]*c+i[7]*u+i[11]*p+i[15]*m,o}function Mt(){var o=new z(4);return z!=Float32Array&&(o[0]=0,o[1]=0,o[2]=0),o[3]=1,o}function bn(o){return o[0]=0,o[1]=0,o[2]=0,o[3]=1,o}function pn(o,e,i){i*=.5;var c=e[0],u=e[1],p=e[2],m=e[3],v=Math.sin(i),S=Math.cos(i);return o[0]=c*S+m*v,o[1]=u*S+p*v,o[2]=p*S-u*v,o[3]=m*S-c*v,o}function sn(o,e,i){i*=.5;var c=e[0],u=e[1],p=e[2],m=e[3],v=Math.sin(i),S=Math.cos(i);return o[0]=c*S-p*v,o[1]=u*S+m*v,o[2]=p*S+c*v,o[3]=m*S-u*v,o}Ut(),Ri();var kn,pr,Ni,Vr,Zs,As=We,ko=(kn=Ut(),pr=Ve(1,0,0),Ni=Ve(0,1,0),function(o,e,i){var c=rn(e,i);return c<-.999999?(an(kn,pr,e),Cs(kn)<1e-6&&an(kn,Ni,e),Hn(kn,kn),function(u,p,m){m*=.5;var v=Math.sin(m);u[0]=v*p[0],u[1]=v*p[1],u[2]=v*p[2],u[3]=Math.cos(m)}(o,kn,Math.PI),o):c>.999999?(o[0]=0,o[1]=0,o[2]=0,o[3]=1,o):(an(kn,e,i),o[0]=kn[0],o[1]=kn[1],o[2]=kn[2],o[3]=1+c,As(o,o))});function Qi(){var o=new z(2);return z!=Float32Array&&(o[0]=0,o[1]=0),o}function Ns(o,e){var i=new z(2);return i[0]=o,i[1]=e,i}function Do(o,e,i){return o[0]=e[0]+i[0],o[1]=e[1]+i[1],o}function Yo(o,e,i){return o[0]=e[0]-i[0],o[1]=e[1]-i[1],o}function _o(o,e,i){return o[0]=e[0]*i,o[1]=e[1]*i,o}function zs(o){return Math.hypot(o[0],o[1])}function Wl(o,e){var i=e[0],c=e[1],u=i*i+c*c;return u>0&&(u=1/Math.sqrt(u)),o[0]=e[0]*u,o[1]=e[1]*u,o}function Cn(o,e){return o[0]*e[0]+o[1]*e[1]}function mi(o){return o&&o.__esModule&&Object.prototype.hasOwnProperty.call(o,"default")?o.default:o}Mt(),Mt(),U(),Qi();var gi,Ui,yo=function(){if(Zs)return Vr;function o(e,i,c,u){this.cx=3*e,this.bx=3*(c-e)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*i,this.by=3*(u-i)-this.cy,this.ay=1-this.cy-this.by,this.p1x=e,this.p1y=i,this.p2x=c,this.p2y=u}return Zs=1,Vr=o,o.prototype={sampleCurveX:function(e){return((this.ax*e+this.bx)*e+this.cx)*e},sampleCurveY:function(e){return((this.ay*e+this.by)*e+this.cy)*e},sampleCurveDerivativeX:function(e){return(3*this.ax*e+2*this.bx)*e+this.cx},solveCurveX:function(e,i){if(i===void 0&&(i=1e-6),e<0)return 0;if(e>1)return 1;for(var c=e,u=0;u<8;u++){var p=this.sampleCurveX(c)-e;if(Math.abs(p)<i)return c;var m=this.sampleCurveDerivativeX(c);if(Math.abs(m)<1e-6)break;c-=p/m}var v=0,S=1;for(c=e,u=0;u<20&&(p=this.sampleCurveX(c),!(Math.abs(p-e)<i));u++)e>p?v=c:S=c,c=.5*(S-v)+v;return c},solve:function(e,i){return this.sampleCurveY(this.solveCurveX(e,i))}},Vr}(),tl=mi(yo);function nl(){if(Ui)return gi;function o(e,i){this.x=e,this.y=i}return Ui=1,gi=o,o.prototype={clone:function(){return new o(this.x,this.y)},add:function(e){return this.clone()._add(e)},sub:function(e){return this.clone()._sub(e)},multByPoint:function(e){return this.clone()._multByPoint(e)},divByPoint:function(e){return this.clone()._divByPoint(e)},mult:function(e){return this.clone()._mult(e)},div:function(e){return this.clone()._div(e)},rotate:function(e){return this.clone()._rotate(e)},rotateAround:function(e,i){return this.clone()._rotateAround(e,i)},matMult:function(e){return this.clone()._matMult(e)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(e){return this.x===e.x&&this.y===e.y},dist:function(e){return Math.sqrt(this.distSqr(e))},distSqr:function(e){var i=e.x-this.x,c=e.y-this.y;return i*i+c*c},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(e){return Math.atan2(this.y-e.y,this.x-e.x)},angleWith:function(e){return this.angleWithSep(e.x,e.y)},angleWithSep:function(e,i){return Math.atan2(this.x*i-this.y*e,this.x*e+this.y*i)},_matMult:function(e){var i=e[2]*this.x+e[3]*this.y;return this.x=e[0]*this.x+e[1]*this.y,this.y=i,this},_add:function(e){return this.x+=e.x,this.y+=e.y,this},_sub:function(e){return this.x-=e.x,this.y-=e.y,this},_mult:function(e){return this.x*=e,this.y*=e,this},_div:function(e){return this.x/=e,this.y/=e,this},_multByPoint:function(e){return this.x*=e.x,this.y*=e.y,this},_divByPoint:function(e){return this.x/=e.x,this.y/=e.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var e=this.y;return this.y=this.x,this.x=-e,this},_rotate:function(e){var i=Math.cos(e),c=Math.sin(e),u=c*this.x+i*this.y;return this.x=i*this.x-c*this.y,this.y=u,this},_rotateAround:function(e,i){var c=Math.cos(e),u=Math.sin(e),p=i.y+u*(this.x-i.x)+c*(this.y-i.y);return this.x=i.x+c*(this.x-i.x)-u*(this.y-i.y),this.y=p,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},o.convert=function(e){return e instanceof o?e:Array.isArray(e)?new o(e[0],e[1]):e},gi}var Dt=mi(nl());function rl(o,e){if(Array.isArray(o)){if(!Array.isArray(e)||o.length!==e.length)return!1;for(let i=0;i<o.length;i++)if(!rl(o[i],e[i]))return!1;return!0}if(typeof o=="object"&&o!==null&&e!==null){if(typeof e!="object"||Object.keys(o).length!==Object.keys(e).length)return!1;for(const i in o)if(!rl(o[i],e[i]))return!1;return!0}return o===e}const h_=Math.PI/180,Eh=180/Math.PI;function mr(o){return o*h_}function He(o){return o*Eh}const J=[[0,0],[1,0],[1,1],[0,1]];function oe(o){if(o<=0)return 0;if(o>=1)return 1;const e=o*o,i=e*o;return 4*(o<.5?i:3*(o-e)+i-.75)}function ge(o,e,i,c){const u=new tl(o,e,i,c);return function(p){return u.solve(p)}}const Ce=ge(.25,.1,.25,1);function xe(o,e,i){return Math.min(i,Math.max(e,o))}function ke(o,e,i){return(i=xe((i-o)/(e-o),0,1))*i*(3-2*i)}function Ue(o,e,i){const c=i-e,u=((o-e)%c+c)%c+e;return u===e?i:u}function De(o,e,i){if(!o.length)return i(null,[]);let c=o.length;const u=new Array(o.length);let p=null;o.forEach((m,v)=>{e(m,(S,T)=>{S&&(p=S),u[v]=T,--c==0&&i(p,u)})})}function $e(o,...e){for(const i of e)for(const c in i)o[c]=i[c];return o}let ct=1;function qe(){return ct++}function kt(o){return o<=1?1:Math.pow(2,Math.ceil(Math.log(o)/Math.LN2))}function Qt(o,e){o.forEach(i=>{e[i]&&(e[i]=e[i].bind(e))})}function en(o,e,i){const c={};for(const u in o)c[u]=e.call(this,o[u],u,o);return c}function Tn(o,e,i){const c={};for(const u in o)e.call(this,o[u],u,o)&&(c[u]=o[u]);return c}function In(o){return Array.isArray(o)?o.map(In):typeof o=="object"&&o?en(o,In):o}function Rn(o,e){for(let i=0;i<o.length;i++)if(e.indexOf(o[i])>=0)return!0;return!1}const Kn={};function On(o){Kn[o]||(typeof console<"u"&&console.warn(o),Kn[o]=!0)}function Ur(o,e,i){return(i.y-o.y)*(e.x-o.x)>(e.y-o.y)*(i.x-o.x)}function li(o){let e=0;for(let i,c,u=0,p=o.length,m=p-1;u<p;m=u++)i=o[u],c=o[m],e+=(c.x-i.x)*(i.y+c.y);return e}function ci([o,e,i]){const c=mr(e+90),u=mr(i);return{x:o*Math.cos(c)*Math.sin(u),y:o*Math.sin(c)*Math.sin(u),z:o*Math.cos(u),azimuthal:e,polar:i}}function Rr(o){return(typeof self<"u"||o!==void 0)&&typeof WorkerGlobalScope<"u"&&(o!==void 0?o:self)instanceof WorkerGlobalScope}function _r(o){const e={};if(o.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(i,c,u,p)=>{const m=u||p;return e[c]=!m||m.toLowerCase(),""}),e["max-age"]){const i=parseInt(e["max-age"],10);isNaN(i)?delete e["max-age"]:e["max-age"]=i}return e}let ki=null;function Si(o,e){return[o[4*e],o[4*e+1],o[4*e+2],o[4*e+3]]}function _i(o,e,i,c){for(;e<i;){const u=e+i>>1;o[u]<c?e=u+1:i=u}return e}function fs(o,e,i,c){for(;e<i;){const u=e+i>>1;o[u]<=c?e=u+1:i=u}return e}function so(o){return o>0?1/(1.001-o):1+o}function Os(o){return o>0?1-1/(1.001-o):-o}function Ch(o,e,i){return(o-e.min)*(i.max-i.min)/(e.max-e.min)+i.min}const vs={API_URL:"https://api.mapbox.com",get API_URL_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i},get API_TILEJSON_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/v[0-9]*\/.*\.json.*$)/i},get API_SPRITE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*\/sprite.*\..*$)/i},get API_FONTS_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/fonts\/v[0-9]*\/)(.*\.pbf.*$)/i},get API_STYLE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*$)/i},get API_CDN_URL_REGEX(){return/^((https?:)?\/\/)?api\.mapbox\.c(n|om)(\/mapbox-gl-js\/)(.*$)/i},get EVENTS_URL(){if(!vs.API_URL)return null;try{const o=new URL(vs.API_URL);return o.hostname==="api.mapbox.cn"?"https://events.mapbox.cn/events/v2":o.hostname==="api.mapbox.com"?"https://events.mapbox.com/events/v2":null}catch{return null}},SESSION_PATH:"/map-sessions/v1",FEEDBACK_URL:"https://apps.mapbox.com/feedback",TILE_URL_VERSION:"v4",RASTER_URL_PREFIX:"raster/v1",RASTERARRAYS_URL_PREFIX:"rasterarrays/v1",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,DEFAULT_STYLE:"mapbox://styles/mapbox/standard",MAX_PARALLEL_IMAGE_REQUESTS:16,DRACO_URL:"https://api.mapbox.com/mapbox-gl-js/draco_decoder_gltf_v1.5.6.wasm",MESHOPT_URL:"https://api.mapbox.com/mapbox-gl-js/meshopt_base_v0.20.wasm",MESHOPT_SIMD_URL:"https://api.mapbox.com/mapbox-gl-js/meshopt_simd_v0.20.wasm",BUILDING_GEN_URL:"https://api.mapbox.com/mapbox-gl-js/building-gen/building_gen_v0.3.0.wasm",GLYPHS_URL:"mapbox://fonts/mapbox/{fontstack}/{range}.pbf",TILES3D_URL_PREFIX:"3dtiles/v1"};function Zl(o){return vs.API_URL_REGEX.test(o)}function Sp(o){return vs.API_SPRITE_REGEX.test(o)}let Ah,Ih,Tp,Ep,Fc,Ph;function Cp(){return Ah==null&&(Ah=self.OffscreenCanvas&&new OffscreenCanvas(1,1).getContext("2d")&&typeof self.createImageBitmap=="function"),Ah}const pa={now:()=>Ep!==void 0?Ep:performance.now(),setNow(o){Ep=o},restoreNow(){Ep=void 0},frame(o){const e=requestAnimationFrame(o);return{cancel:()=>cancelAnimationFrame(e)}},getImageData(o,e=0){const{width:i,height:c}=o;Fc||(Fc=document.createElement("canvas"));const u=Fc.getContext("2d",{willReadFrequently:!0});if(!u)throw new Error("failed to create canvas 2d context");return(i>Fc.width||c>Fc.height)&&(Fc.width=i,Fc.height=c),u.clearRect(-e,-e,i+2*e,c+2*e),u.drawImage(o,0,0,i,c),u.getImageData(-e,-e,i+2*e,c+2*e)},resolveURL:o=>(Ih||(Ih=document.createElement("a")),Ih.href=o,Ih.href),get devicePixelRatio(){return window.devicePixelRatio},get prefersReducedMotion(){return!!window.matchMedia&&(Tp==null&&(Tp=window.matchMedia("(prefers-reduced-motion: reduce)")),Tp.matches)},hasCanvasFingerprintNoise(){if(Ph!==void 0)return Ph;if(!Cp())return Ph=!1,!1;const o=new OffscreenCanvas(85,1),e=o.getContext("2d",{willReadFrequently:!0});let i=0;for(let u=0;u<o.width;++u)e.fillStyle=`rgba(${i++},${i++},${i++}, 255)`,e.fillRect(u,0,1,1);const c=e.getImageData(0,0,o.width,o.height);i=0;for(let u=0;u<c.data.length;++u)if(u%4!=3&&i++!==c.data[u])return Ph=!0,!0;return Ph=!1,!1}};function Lo(o,e){const i=o.indexOf("?");if(i<0)return`${o}?${new URLSearchParams(e).toString()}`;const c=new URLSearchParams(o.slice(i));for(const u in e)c.set(u,e[u]);return`${o.slice(0,i)}?${c.toString()}`}function Ko(o,e={persistentParams:[]}){const i=o.indexOf("?");if(i<0)return o;const c=new URLSearchParams,u=new URLSearchParams(o.slice(i));for(const m of e.persistentParams){const v=u.get(m);v&&c.set(m,v)}const p=c.toString();return`${o.slice(0,i)}${p.length>0?`?${p}`:""}`}const il="mapbox-tiles";let ma=500,sl=50;const Mh=["language","worldview","jobid"];let za,Rh;function jc(){try{return caches}catch{}}function ku(){const o=jc();o&&za==null&&(za=o.open(il))}let f_=1/0;const p_={supported:!1,testSupport:function(o){!kh&&Bc&&(Du?Hx(o):oo=o)}};let oo,Bc,kh=!1,Du=!1;const Gx=typeof self<"u"?self:{};function Hx(o){const e=o.createTexture();o.bindTexture(o.TEXTURE_2D,e);try{if(o.texImage2D(o.TEXTURE_2D,0,o.RGBA,o.RGBA,o.UNSIGNED_BYTE,Bc),o.isContextLost())return;p_.supported=!0}catch{}o.deleteTexture(e),kh=!0}Gx.document&&(Bc=Gx.document.createElement("img"),Bc.onload=function(){oo&&Hx(oo),oo=null,Du=!0},Bc.onerror=function(){kh=!0,oo=null},Bc.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");const Dh={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Iconset:"Iconset",Image:"Image",Model:"Model"};typeof Object.freeze=="function"&&Object.freeze(Dh);class ur extends Error{constructor(e,i,c){i===401&&Zl(c)&&(e+=": you may have provided an invalid Mapbox access token. See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes"),super(e),this.status=i,this.url=c}toString(){return`${this.name}: ${this.message} (${this.status}): ${this.url}`}}const Ap=Rr()?()=>self.worker.referrer:()=>(location.protocol==="blob:"?parent:self).location.href,Lu=function(o,e){if(!(/^file:/.test(i=o.url)||/^file:/.test(Ap())&&!/^\w+:/.test(i))){if(self.fetch&&self.Request&&self.AbortController&&Request.prototype.hasOwnProperty("signal"))return function(c,u){const p=new AbortController,m=new Request(c.url,{method:c.method||"GET",body:c.body,credentials:c.credentials,headers:c.headers,referrer:Ap(),referrerPolicy:c.referrerPolicy,signal:p.signal});let v=!1,S=!1;const T=(I=m.url).indexOf("sku=")>0&&Zl(I);var I;c.type==="json"&&m.headers.set("Accept","application/json");const P=(L,O,G)=>{if(S)return;if(L&&L.message!=="SecurityError"&&On(L.toString()),O&&G)return M(O);const Z=Date.now();fetch(m).then(Q=>{if(Q.ok){const le=T?Q.clone():null;return M(Q,le,Z)}return u(new ur(Q.statusText,Q.status,c.url))}).catch(Q=>{Q.name!=="AbortError"&&u(new Error(`${Q.message} ${c.url}`))})},M=(L,O,G)=>{(c.type==="arrayBuffer"?L.arrayBuffer():c.type==="json"?L.json():L.text()).then(Z=>{S||(O&&G&&function(Q,le,ce){if(ku(),za==null)return;const q=_r(le.headers.get("Cache-Control")||"");if(q["no-store"])return;const re={status:le.status,statusText:le.statusText,headers:new Headers};le.headers.forEach((Ae,Te)=>re.headers.set(Te,Ae)),q["max-age"]&&re.headers.set("Expires",new Date(ce+1e3*q["max-age"]).toUTCString());const ue=re.headers.get("Expires");if(!ue||new Date(ue).getTime()-ce<42e4)return;let pe=Ko(Q.url,{persistentParams:Mh});if(le.status===206){const Ae=Q.headers.get("Range");if(!Ae)return;re.status=200,pe=Lo(pe,{range:Ae})}(function(Ae,Te){if(Rh===void 0)try{new Response(new ReadableStream),Rh=!0}catch{Rh=!1}Rh?Te(Ae.body):Ae.blob().then(Te).catch(Ie=>On(Ie.message))})(le,Ae=>{const Te=new Response((Ie=le.status)!==200&&Ie!==404&&[101,103,204,205,304].includes(Ie)?null:Ae,re);var Ie;ku(),za!=null&&za.then(Ne=>Ne.put(pe,Te)).catch(Ne=>On(Ne.message))})}(m,O,G),v=!0,u(null,Z,L.headers.get("Cache-Control"),L.headers.get("Expires")))}).catch(Z=>{S||u(new Error(Z.message))})};return T?function(L,O){if(ku(),za==null)return O(null);za.then(G=>{let Z=Ko(L.url,{persistentParams:Mh});const Q=L.headers.get("Range");Q&&(Z=Lo(Z,{range:Q})),G.match(Z).then(le=>{const ce=function(q){if(!q)return!1;const re=new Date(q.headers.get("Expires")||0),ue=_r(q.headers.get("Cache-Control")||"");return Number(re)>Date.now()&&!ue["no-cache"]}(le);G.delete(Z).catch(O),ce&&G.put(Z,le.clone()).catch(O),O(null,le,ce)}).catch(O)}).catch(O)}(m,P):P(null,null),{cancel:()=>{S=!0,v||p.abort()}}}(o,e);if(Rr(self)&&self.worker.actor)return self.worker.actor.send("getResource",o,e,void 0,!0)}var i;return function(c,u){const p=new XMLHttpRequest;p.open(c.method||"GET",c.url,!0),c.type==="arrayBuffer"&&(p.responseType="arraybuffer");for(const m in c.headers)p.setRequestHeader(m,c.headers[m]);return c.type==="json"&&(p.responseType="text",p.setRequestHeader("Accept","application/json")),p.withCredentials=c.credentials==="include",p.onerror=()=>{u(new Error(p.statusText))},p.onload=()=>{if((p.status>=200&&p.status<300||p.status===0)&&p.response!==null){let m=p.response;if(c.type==="json")try{m=JSON.parse(p.response)}catch(v){return u(v)}u(null,m,p.getResponseHeader("Cache-Control"),p.getResponseHeader("Expires"))}else u(new ur(p.statusText,p.status,c.url))},p.send(c.body),{cancel:()=>p.abort()}}(o,e)},Lh=function(o,e){return Lu($e(o,{type:"arrayBuffer"}),e)};function k2(o){const e=document.createElement("a");return e.href=o,e.protocol===location.protocol&&e.host===location.host}const Nh="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";let Vc,Xl;Vc=[],Xl=0;const m_=function(o,e){if(p_.supported&&(o.headers||(o.headers={}),o.headers.accept="image/webp,*/*"),Xl>=vs.MAX_PARALLEL_IMAGE_REQUESTS){const p={requestParameters:o,callback:e,cancelled:!1,cancel(){this.cancelled=!0}};return Vc.push(p),p}Xl++;let i=!1;const c=()=>{if(!i)for(i=!0,Xl--;Vc.length&&Xl<vs.MAX_PARALLEL_IMAGE_REQUESTS;){const p=Vc.shift(),{requestParameters:m,callback:v,cancelled:S}=p;S||(p.cancel=m_(m,v).cancel)}},u=Lh(o,(p,m,v,S)=>{c(),p?e(p):m&&(self.createImageBitmap?function(T,I){const P=new Blob([new Uint8Array(T)],{type:"image/png"});createImageBitmap(P).then(M=>{I(null,M)}).catch(M=>{I(new Error(`Could not load image because of ${M.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))})}(m,(T,I)=>e(T,I,v,S)):function(T,I){const P=new Image;P.onload=()=>{I(null,P),URL.revokeObjectURL(P.src),P.onload=null,requestAnimationFrame(()=>{P.src=Nh})},P.onerror=()=>I(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const M=new Blob([new Uint8Array(T)],{type:"image/png"});P.src=T.byteLength?URL.createObjectURL(M):Nh}(m,(T,I)=>e(T,I,v,S)))});return{cancel:()=>{u.cancel(),c()}}};var g_,Uc,qx,ol={exports:{}},Ip={exports:{}},Pp={exports:{}},ga=function(){if(qx)return ol.exports;qx=1;var o=(g_||(g_=1,Ip.exports=function(i,c){var u,p,m,v,S,T,I,P;for(p=i.length-(u=3&i.length),m=c,S=3432918353,T=461845907,P=0;P<p;)I=255&i.charCodeAt(P)|(255&i.charCodeAt(++P))<<8|(255&i.charCodeAt(++P))<<16|(255&i.charCodeAt(++P))<<24,++P,m=27492+(65535&(v=5*(65535&(m=(m^=I=(65535&(I=(I=(65535&I)*S+(((I>>>16)*S&65535)<<16)&4294967295)<<15|I>>>17))*T+(((I>>>16)*T&65535)<<16)&4294967295)<<13|m>>>19))+((5*(m>>>16)&65535)<<16)&4294967295))+((58964+(v>>>16)&65535)<<16);switch(I=0,u){case 3:I^=(255&i.charCodeAt(P+2))<<16;case 2:I^=(255&i.charCodeAt(P+1))<<8;case 1:m^=I=(65535&(I=(I=(65535&(I^=255&i.charCodeAt(P)))*S+(((I>>>16)*S&65535)<<16)&4294967295)<<15|I>>>17))*T+(((I>>>16)*T&65535)<<16)&4294967295}return m^=i.length,m=2246822507*(65535&(m^=m>>>16))+((2246822507*(m>>>16)&65535)<<16)&4294967295,m=3266489909*(65535&(m^=m>>>13))+((3266489909*(m>>>16)&65535)<<16)&4294967295,(m^=m>>>16)>>>0}),Ip.exports),e=(Uc||(Uc=1,Pp.exports=function(i,c){for(var u,p=i.length,m=c^p,v=0;p>=4;)u=1540483477*(65535&(u=255&i.charCodeAt(v)|(255&i.charCodeAt(++v))<<8|(255&i.charCodeAt(++v))<<16|(255&i.charCodeAt(++v))<<24))+((1540483477*(u>>>16)&65535)<<16),m=1540483477*(65535&m)+((1540483477*(m>>>16)&65535)<<16)^(u=1540483477*(65535&(u^=u>>>24))+((1540483477*(u>>>16)&65535)<<16)),p-=4,++v;switch(p){case 3:m^=(255&i.charCodeAt(v+2))<<16;case 2:m^=(255&i.charCodeAt(v+1))<<8;case 1:m=1540483477*(65535&(m^=255&i.charCodeAt(v)))+((1540483477*(m>>>16)&65535)<<16)}return m=1540483477*(65535&(m^=m>>>13))+((1540483477*(m>>>16)&65535)<<16),(m^=m>>>15)>>>0}),Pp.exports);return ol.exports=o,ol.exports.murmur3=o,ol.exports.murmur2=e,ol.exports}(),zh=mi(ga);class $c{constructor(e,...i){$e(this,i[0]||{}),this.type=e}}class Mp extends $c{constructor(e,i={}){super("error",$e({error:e},i))}}function __(o,e,i){i[o]&&i[o].indexOf(e)!==-1||(i[o]=i[o]||[],i[o].push(e))}function Rp(o,e,i){if(i&&i[o]){const c=i[o].indexOf(e);c!==-1&&i[o].splice(c,1)}}class Gc{on(e,i){return this._listeners=this._listeners||{},__(e,i,this._listeners),this}off(e,i){return Rp(e,i,this._listeners),Rp(e,i,this._oneTimeListeners),this}once(e,i){return i?(this._oneTimeListeners=this._oneTimeListeners||{},__(e,i,this._oneTimeListeners),this):new Promise(c=>{this.once(e,c)})}fire(e,i){const c=typeof e=="string"?new $c(e,i):e,u=c.type;if(this.listens(u)){c.target=this;const p=this._listeners&&this._listeners[u]?this._listeners[u].slice():[];for(const S of p)S.call(this,c);const m=this._oneTimeListeners&&this._oneTimeListeners[u]?this._oneTimeListeners[u].slice():[];for(const S of m)Rp(u,S,this._oneTimeListeners),S.call(this,c);const v=this._eventedParent;v&&($e(c,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),v.fire(c))}else c instanceof Mp&&console.error(c.error);return this}listens(e){return!!(this._listeners&&this._listeners[e]&&this._listeners[e].length>0||this._oneTimeListeners&&this._oneTimeListeners[e]&&this._oneTimeListeners[e].length>0||this._eventedParent&&this._eventedParent.listens(e))}setEventedParent(e,i){return this._eventedParent=e,this._eventedParentData=i,this}}class vo{constructor(e){typeof e=="string"?this.name=e:(this.name=e.name,this.iconsetId=e.iconsetId)}static from(e){return new vo(e)}static toString(e){return e.iconsetId?`${e.name}${e.iconsetId}`:e.name}static parse(e){const[i,c]=e.split("");return new vo({name:i,iconsetId:c})}static isEqual(e,i){return e.name===i.name&&e.iconsetId===i.iconsetId}toString(){return vo.toString(this)}serialize(){return{name:this.name,iconsetId:this.iconsetId}}}var y_,Nu={},Hc=function(){if(y_)return Nu;y_=1;var o={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function e(p){return(p=Math.round(p))<0?0:p>255?255:p}function i(p){return e(p[p.length-1]==="%"?parseFloat(p)/100*255:parseInt(p))}function c(p){return(m=p[p.length-1]==="%"?parseFloat(p)/100:parseFloat(p))<0?0:m>1?1:m;var m}function u(p,m,v){return v<0?v+=1:v>1&&(v-=1),6*v<1?p+(m-p)*v*6:2*v<1?m:3*v<2?p+(m-p)*(2/3-v)*6:p}try{Nu.parseCSSColor=function(p){var m,v=p.replace(/ /g,"").toLowerCase();if(v in o)return o[v].slice();if(v[0]==="#")return v.length===4?(m=parseInt(v.substr(1),16))>=0&&m<=4095?[(3840&m)>>4|(3840&m)>>8,240&m|(240&m)>>4,15&m|(15&m)<<4,1]:null:v.length===7&&(m=parseInt(v.substr(1),16))>=0&&m<=16777215?[(16711680&m)>>16,(65280&m)>>8,255&m,1]:null;var S=v.indexOf("("),T=v.indexOf(")");if(S!==-1&&T+1===v.length){var I=v.substr(0,S),P=v.substr(S+1,T-(S+1)).split(","),M=1;switch(I){case"rgba":if(P.length!==4)return null;M=c(P.pop());case"rgb":return P.length!==3?null:[i(P[0]),i(P[1]),i(P[2]),M];case"hsla":if(P.length!==4)return null;M=c(P.pop());case"hsl":if(P.length!==3)return null;var L=(parseFloat(P[0])%360+360)%360/360,O=c(P[1]),G=c(P[2]),Z=G<=.5?G*(O+1):G+O-G*O,Q=2*G-Z;return[e(255*u(Q,Z,L+1/3)),e(255*u(Q,Z,L)),e(255*u(Q,Z,L-1/3)),M];default:return null}}return null}}catch{}return Nu}();class Er{constructor(e,i,c,u=1){this.r=e,this.g=i,this.b=c,this.a=u}static parse(e){if(!e)return;if(e instanceof Er)return e;if(typeof e!="string")return;const i=Hc.parseCSSColor(e);return i?new Er(i[0]/255,i[1]/255,i[2]/255,i[3]):void 0}toString(){const[e,i,c,u]=[this.r,this.g,this.b,this.a];return`rgba(${Math.round(255*e)},${Math.round(255*i)},${Math.round(255*c)},${u})`}toNonPremultipliedRenderColor(e){const{r:i,g:c,b:u,a:p}=this;return new D2(e,i,c,u,p)}toPremultipliedRenderColor(e){const{r:i,g:c,b:u,a:p}=this;return new v_(e,i*p,c*p,u*p,p)}clone(){return new Er(this.r,this.g,this.b,this.a)}}class _a{constructor(e,i,c,u,p,m=!1){if(this.premultiplied=!1,this.premultiplied=m,e){const v=e.image.height,S=v*v;this.premultiplied?(i=p===0?0:i/p*(v-1),c=p===0?0:c/p*(v-1),u=p===0?0:u/p*(v-1)):(i*=v-1,c*=v-1,u*=v-1);const T=Math.floor(i),I=Math.floor(c),P=Math.floor(u),M=Math.ceil(i),L=Math.ceil(c),O=Math.ceil(u),G=i-T,Z=c-I,Q=u-P,le=e.image.data,ce=4*(T+I*S+P*v),q=4*(T+I*S+O*v),re=4*(T+L*S+P*v),ue=4*(T+L*S+O*v),pe=4*(M+I*S+P*v),Ae=4*(M+I*S+O*v),Te=4*(M+L*S+P*v),Ie=4*(M+L*S+O*v);if(ce<0||Ie>=le.length)throw new Error("out of range");this.r=vn(vn(vn(le[ce],le[q],Q),vn(le[re],le[ue],Q),Z),vn(vn(le[pe],le[Ae],Q),vn(le[Te],le[Ie],Q),Z),G)/255*(this.premultiplied?p:1),this.g=vn(vn(vn(le[ce+1],le[q+1],Q),vn(le[re+1],le[ue+1],Q),Z),vn(vn(le[pe+1],le[Ae+1],Q),vn(le[Te+1],le[Ie+1],Q),Z),G)/255*(this.premultiplied?p:1),this.b=vn(vn(vn(le[ce+2],le[q+2],Q),vn(le[re+2],le[ue+2],Q),Z),vn(vn(le[pe+2],le[Ae+2],Q),vn(le[Te+2],le[Ie+2],Q),Z),G)/255*(this.premultiplied?p:1),this.a=p}else this.r=i,this.g=c,this.b=u,this.a=p}toArray(){const{r:e,g:i,b:c,a:u}=this;return[255*e,255*i,255*c,u]}toHslaArray(){let{r:e,g:i,b:c,a:u}=this;if(this.premultiplied){if(u===0)return[0,0,0,0];e/=u,i/=u,c/=u}const p=Math.min(Math.max(e,0),1),m=Math.min(Math.max(i,0),1),v=Math.min(Math.max(c,0),1),S=Math.min(p,m,v),T=Math.max(p,m,v),I=(S+T)/2;if(S===T)return[0,0,100*I,u];const P=T-S,M=I>.5?P/(2-T-S):P/(T+S);let L=0;return T===p?L=(m-v)/P+(m<v?6:0):T===m?L=(v-p)/P+2:T===v&&(L=(p-m)/P+4),L*=60,[Math.min(Math.max(L,0),360),Math.min(Math.max(100*M,0),100),Math.min(Math.max(100*I,0),100),u]}toArray01(){const{r:e,g:i,b:c,a:u}=this;return[e,i,c,u]}toArray01Scaled(e){const{r:i,g:c,b:u}=this;return[i*e,c*e,u*e]}toArray01Linear(){const{r:e,g:i,b:c,a:u}=this;return[Math.pow(e,2.2),Math.pow(i,2.2),Math.pow(c,2.2),u]}}class D2 extends _a{constructor(e,i,c,u,p){super(e,i,c,u,p,!1)}}class v_ extends _a{constructor(e,i,c,u,p){super(e,i,c,u,p,!0)}}function vn(o,e,i){return o*(1-i)+e*i}function kp(o,e,i){return o.map((c,u)=>vn(c,e[u],i))}Er.black=new Er(0,0,0,1),Er.white=new Er(1,1,1,1),Er.transparent=new Er(0,0,0,0),Er.red=new Er(1,0,0,1),Er.blue=new Er(0,0,1,1);var Oh=Object.freeze({__proto__:null,array:kp,color:function(o,e,i){return new Er(vn(o.r,e.r,i),vn(o.g,e.g,i),vn(o.b,e.b,i),vn(o.a,e.a,i))},number:vn});function qc(o,...e){for(const i of e)for(const c in i)o[c]=i[c];return o}class No extends Error{constructor(e,i){super(i),this.message=i,this.key=e}}class x_{constructor(e,i=[]){this.parent=e,this.bindings={};for(const[c,u]of i)this.bindings[c]=u}concat(e){return new x_(this,e)}get(e){if(this.bindings[e])return this.bindings[e];if(this.parent)return this.parent.get(e);throw new Error(`${e} not found in scope.`)}has(e){return!!this.bindings[e]||!!this.parent&&this.parent.has(e)}}const zu={kind:"null"},nn={kind:"number"},Nr={kind:"string"},br={kind:"boolean"},xo={kind:"color"},al={kind:"object"},Cr={kind:"value"},Dp={kind:"collator"},Fh={kind:"formatted"},jh={kind:"resolvedImage"};function Xs(o,e){return{kind:"array",itemType:o,N:e}}function qi(o){if(o.kind==="array"){const e=qi(o.itemType);return typeof o.N=="number"?`array<${e}, ${o.N}>`:o.itemType.kind==="value"?"array":`array<${e}>`}return o.kind}const L2=[zu,nn,Nr,br,xo,Fh,al,Xs(Cr),jh];function Ou(o,e){if(e.kind==="error")return null;if(o.kind==="array"){if(e.kind==="array"&&(e.N===0&&e.itemType.kind==="value"||!Ou(o.itemType,e.itemType))&&(typeof o.N!="number"||o.N===e.N))return null}else{if(o.kind===e.kind)return null;if(o.kind==="value"){for(const i of L2)if(!Ou(i,e))return null}}return`Expected ${qi(o)} but found ${qi(e)} instead.`}function Yl(o,e){return e.some(i=>i.kind===o.kind)}function Bh(o,e){return e.some(i=>i==="null"?o===null:i==="array"?Array.isArray(o):i==="object"?o&&!Array.isArray(o)&&typeof o=="object":i===typeof o)}function Lp(o,e){return o.kind==="array"&&e.kind==="array"?o.N===e.N&&Lp(o.itemType,e.itemType):o.kind===e.kind}class Vh{constructor(e,i,c){this.sensitivity=e?i?"variant":"case":i?"accent":"base",this.locale=c,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(e,i){return this.collator.compare(e,i)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class Np{constructor(e,i,c,u,p){this.text=e.normalize?e.normalize():e,this.image=i,this.scale=c,this.fontStack=u,this.textColor=p}}class Ys{constructor(e){this.sections=e}static fromString(e){return new Ys([new Np(e,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some(e=>e.text.length!==0||!!e.image&&e.image.hasPrimary())}static factory(e){return e instanceof Ys?e:Ys.fromString(e)}toString(){return this.sections.length===0?"":this.sections.map(e=>e.text).join("")}serialize(){const e=["format"];for(const i of this.sections){if(i.image){const u=i.image.getPrimary().id.toString();e.push(["image",u]);continue}e.push(i.text);const c={};i.fontStack&&(c["text-font"]=["literal",i.fontStack.split(",")]),i.scale&&(c["font-scale"]=i.scale),i.textColor&&(c["text-color"]=["rgba"].concat(i.textColor.toNonPremultipliedRenderColor(null).toArray())),e.push(c)}return e}}class ll{constructor(e,i={}){if(this.id=vo.from(e),this.options=Object.assign({},i),i.transform){const{a:c,b:u,c:p,d:m,e:v,f:S}=i.transform;this.options.transform=new DOMMatrix([c,u,p,m,v,S])}else this.options.transform=new DOMMatrix([1,0,0,1,0,0])}toString(){const{a:e,b:i,c,d:u,e:p,f:m}=this.options.transform;return JSON.stringify({name:this.id.name,iconsetId:this.id.iconsetId,params:this.options.params,transform:{a:e,b:i,c,d:u,e:p,f:m}})}static parse(e){let i,c,u,p;try{({name:i,iconsetId:c,params:u,transform:p}=JSON.parse(e)||{})}catch{return null}if(!i)return null;const{a:m,b:v,c:S,d:T,e:I,f:P}=p||{};return new ll({name:i,iconsetId:c},{params:u,transform:new DOMMatrix([m,v,S,T,I,P])})}scaleSelf(e,i){return this.options.transform.scaleSelf(e,i),this}}class ao{constructor(e,i,c,u,p=!1){this.primaryId=vo.from(e),this.primaryOptions=i,c&&(this.secondaryId=vo.from(c)),this.secondaryOptions=u,this.available=p}toString(){return this.primaryId&&this.secondaryId?`[${this.primaryId.name},${this.secondaryId.name}]`:this.primaryId.name}hasPrimary(){return!!this.primaryId}getPrimary(){return new ll(this.primaryId,this.primaryOptions)}hasSecondary(){return!!this.secondaryId}getSecondary(){return this.secondaryId?new ll(this.secondaryId,this.secondaryOptions):null}static from(e){return typeof e=="string"?ao.build({name:e}):e}static build(e,i,c,u){return!e||typeof e=="object"&&!("name"in e)?null:new ao(e,c,i,u)}}function Wc(o,e,i,c){return typeof o=="number"&&o>=0&&o<=255&&typeof e=="number"&&e>=0&&e<=255&&typeof i=="number"&&i>=0&&i<=255?c===void 0||typeof c=="number"&&c>=0&&c<=1?null:`Invalid rgba value [${[o,e,i,c].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof c=="number"?[o,e,i,c]:[o,e,i]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function Zn(o){if(o===null||typeof o=="string"||typeof o=="boolean"||typeof o=="number"||o instanceof Er||o instanceof Vh||o instanceof Ys||o instanceof ao)return!0;if(Array.isArray(o)){for(const e of o)if(!Zn(e))return!1;return!0}if(typeof o=="object"){for(const e in o)if(!Zn(o[e]))return!1;return!0}return!1}function Gt(o){if(o===null)return zu;if(typeof o=="string")return Nr;if(typeof o=="boolean")return br;if(typeof o=="number")return nn;if(o instanceof Er)return xo;if(o instanceof Vh)return Dp;if(o instanceof Ys)return Fh;if(o instanceof ao)return jh;if(Array.isArray(o)){const e=o.length;let i;for(const c of o){const u=Gt(c);if(i){if(i===u)continue;i=Cr;break}i=u}return Xs(i||Cr,e)}return al}function Qo(o){const e=typeof o;return o===null?"":e==="string"||e==="number"||e==="boolean"?String(o):o instanceof Ys||o instanceof ao||o instanceof Er?o.toString():JSON.stringify(o)}class En{constructor(e,i){this.type=e,this.value=i}static parse(e,i){if(e.length!==2)return i.error(`'literal' expression requires exactly one argument, but found ${e.length-1} instead.`);if(!Zn(e[1]))return i.error("invalid value");const c=e[1];let u=Gt(c);const p=i.expectedType;return u.kind!=="array"||u.N!==0||!p||p.kind!=="array"||typeof p.N=="number"&&p.N!==0||(u=p),new En(u,c)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}serialize(){return this.type.kind==="array"||this.type.kind==="object"?["literal",this.value]:this.value instanceof Er?["rgba"].concat(this.value.toNonPremultipliedRenderColor(null).toArray()):this.value instanceof Ys?this.value.serialize():this.value}}class $i{constructor(e){this.name="ExpressionEvaluationError",this.message=e}toJSON(){return this.message}}const Uh={string:Nr,number:nn,boolean:br,object:al};class _n{constructor(e,i){this.type=e,this.args=i}static parse(e,i){if(e.length<2)return i.error("Expected at least one argument.");let c,u=1;const p=e[0];if(p==="array"){let v,S;if(e.length>2){const T=e[1];if(typeof T!="string"||!(T in Uh)||T==="object")return i.error('The item type argument of "array" must be one of string, number, boolean',1);v=Uh[T],u++}else v=Cr;if(e.length>3){if(e[2]!==null&&(typeof e[2]!="number"||e[2]<0||e[2]!==Math.floor(e[2])))return i.error('The length argument to "array" must be a positive integer literal',2);S=e[2],u++}c=Xs(v,S)}else c=Uh[p];const m=[];for(;u<e.length;u++){const v=i.parse(e[u],u,Cr);if(!v)return null;m.push(v)}return new _n(c,m)}evaluate(e){for(let i=0;i<this.args.length;i++){const c=this.args[i].evaluate(e);if(!Ou(this.type,Gt(c)))return c;if(i===this.args.length-1)throw new $i(`The expression ${JSON.stringify(this.args[i].serialize())} evaluated to ${qi(Gt(c))} but was expected to be of type ${qi(this.type)}.`)}return null}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){const e=this.type,i=[e.kind];if(e.kind==="array"){const c=e.itemType;if(c.kind==="string"||c.kind==="number"||c.kind==="boolean"){i.push(c.kind);const u=e.N;(typeof u=="number"||this.args.length>1)&&i.push(u)}}return i.concat(this.args.map(c=>c.serialize()))}}class Fu{constructor(e){this.type=Fh,this.sections=e}static parse(e,i){if(e.length<2)return i.error("Expected at least one argument.");const c=e[1];if(!Array.isArray(c)&&typeof c=="object")return i.error("First argument must be an image or text section.");const u=[];let p=!1;for(let m=1;m<=e.length-1;++m){const v=e[m];if(p&&typeof v=="object"&&!Array.isArray(v)){p=!1;let S=null;if(v["font-scale"]&&(S=i.parseObjectValue(v["font-scale"],m,"font-scale",nn),!S))return null;let T=null;if(v["text-font"]&&(T=i.parseObjectValue(v["text-font"],m,"text-font",Xs(Nr)),!T))return null;let I=null;if(v["text-color"]&&(I=i.parseObjectValue(v["text-color"],m,"text-color",xo),!I))return null;const P=u[u.length-1];P.scale=S,P.font=T,P.textColor=I}else{const S=i.parse(e[m],m,Cr);if(!S)return null;const T=S.type.kind;if(T!=="string"&&T!=="value"&&T!=="null"&&T!=="resolvedImage")return i.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");p=!0,u.push({content:S,scale:null,font:null,textColor:null})}}return new Fu(u)}evaluate(e){return new Ys(this.sections.map(i=>{const c=i.content.evaluate(e);return Lp(Gt(c),jh)?new Np("",c,null,null,null):new Np(Qo(c),null,i.scale?i.scale.evaluate(e):null,i.font?i.font.evaluate(e).join(","):null,i.textColor?i.textColor.evaluate(e):null)}))}eachChild(e){for(const i of this.sections)e(i.content),i.scale&&e(i.scale),i.font&&e(i.font),i.textColor&&e(i.textColor)}outputDefined(){return!1}serialize(){const e=["format"];for(const i of this.sections){e.push(i.content.serialize());const c={};i.scale&&(c["font-scale"]=i.scale.serialize()),i.font&&(c["text-font"]=i.font.serialize()),i.textColor&&(c["text-color"]=i.textColor.serialize()),e.push(c)}return e}}class ju{constructor(e,i,c,u){this._imageWarnHistory={},this.type=jh,this.namePrimary=e,this.nameSecondary=i,c&&(this.paramsPrimary=c.params,this.iconsetIdPrimary=c.iconset?c.iconset.id:void 0),u&&(this.paramsSecondary=u.params,this.iconsetIdSecondary=u.iconset?u.iconset.id:void 0)}static parse(e,i){if(e.length<2)return i.error("Expected two or more arguments.");let c=1;const u=[];function p(){if(c<e.length){const v=i.parse(e[c],c++,Nr);return v?(u.push({image:v,options:{}}),!0):(i.error(u.length?"Secondary image variant is not a string.":"No image name provided."),!1)}return!0}function m(){if(c<e.length){const S=e[c];if((v=S)===null||typeof v!="object"||Array.isArray(v))return!0;const T=S.params,I=S.iconset,P=i.concat(c);if(!T&&!I)return c++,!0;if(T){if(typeof T!="object"||T.constructor!==Object)return P.error('Image options "params" should be an object'),!1;const M={},L=P.concat(void 0,"params");for(const O in T){if(!O)return L.error("Image parameter name should be non-empty"),!1;const G=L.concat(void 0,O).parse(T[O],void 0,xo,void 0,{typeAnnotation:"coerce"});if(!G)return!1;M[O]=G}u[u.length-1].options.params=M}if(I){if(typeof I!="object"||I.constructor!==Object)return P.error('Image options "iconset" should be an object'),!1;if(!I.id)return P.error('Image options "iconset" should have an "id" property'),!1;u[u.length-1].options.iconset=I}return c++,!0}var v;return!0}for(let v=0;v<2;v++)if(!p()||!m())return;return new ju(u[0].image,u[1]?u[1].image:void 0,u[0].options,u[1]?u[1].options:void 0)}evaluateParams(e,i){const c={};if(i){for(const u in i)if(i[u])try{c[u]=i[u].evaluate(e)}catch{continue}if(Object.keys(c).length!==0)return{params:c}}}evaluate(e){const i={name:this.namePrimary.evaluate(e),iconsetId:this.iconsetIdPrimary},c=this.nameSecondary?{name:this.nameSecondary.evaluate(e),iconsetId:this.iconsetIdSecondary}:void 0,u=ao.build(i,c,this.paramsPrimary?this.evaluateParams(e,this.paramsPrimary):void 0,this.paramsSecondary?this.evaluateParams(e,this.paramsSecondary):void 0);if(u&&e.availableImages){const p=u.getPrimary().id;if(u.available=e.availableImages.some(m=>vo.isEqual(m,p)),u.available){const m=u.getSecondary()?u.getSecondary().id:null;m&&(u.available=e.availableImages.some(v=>vo.isEqual(v,m)))}}return u}eachChild(e){if(e(this.namePrimary),this.paramsPrimary)for(const i in this.paramsPrimary)this.paramsPrimary[i]&&e(this.paramsPrimary[i]);if(this.nameSecondary&&(e(this.nameSecondary),this.paramsSecondary))for(const i in this.paramsSecondary)this.paramsSecondary[i]&&e(this.paramsSecondary[i])}outputDefined(){return!1}serializeOptions(e,i){const c={};if(i&&(c.iconset={id:i}),e){c.params={};for(const u in e)e[u]&&(c.params[u]=e[u].serialize())}return Object.keys(c).length>0?c:void 0}serialize(){const e=["image",this.namePrimary.serialize()];if(this.paramsPrimary||this.iconsetIdPrimary){const i=this.serializeOptions(this.paramsPrimary,this.iconsetIdPrimary);i&&e.push(i)}if(this.nameSecondary&&(e.push(this.nameSecondary.serialize()),this.paramsSecondary||this.iconsetIdSecondary)){const i=this.serializeOptions(this.paramsSecondary,this.iconsetIdSecondary);i&&e.push(i)}return e}}function Kl(o){return o instanceof Number?"number":o instanceof String?"string":o instanceof Boolean?"boolean":Array.isArray(o)?"array":o===null?"null":typeof o}const Wx={"to-boolean":br,"to-color":xo,"to-number":nn,"to-string":Nr};class Jo{constructor(e,i){this.type=e,this.args=i}static parse(e,i){if(e.length<2)return i.error("Expected at least one argument.");const c=e[0],u=[];let p=zu;if(c==="to-array"){if(!Array.isArray(e[1]))return null;const m=e[1].length;if(i.expectedType){if(i.expectedType.kind!=="array")return i.error(`Expected ${i.expectedType.kind} but found array.`);p=Xs(i.expectedType.itemType,m)}else{if(!(m>0&&Zn(e[1][0])))return null;p=Xs(Gt(e[1][0]),m)}for(let v=0;v<m;v++){const S=e[1][v];let T;if(Kl(S)==="array")T=i.parse(S,void 0,p.itemType);else{const I=Kl(S);if(I!==p.itemType.kind)return i.error(`Expected ${p.itemType.kind} but found ${I}.`);T=i.registry.literal.parse(["literal",S===void 0?null:S],i)}if(!T)return null;u.push(T)}}else{if((c==="to-boolean"||c==="to-string")&&e.length!==2)return i.error("Expected one argument.");p=Wx[c];for(let m=1;m<e.length;m++){const v=i.parse(e[m],m,Cr);if(!v)return null;u.push(v)}}return new Jo(p,u)}evaluate(e){if(this.type.kind==="boolean")return!!this.args[0].evaluate(e);if(this.type.kind==="color"){let i,c;for(const u of this.args){if(i=u.evaluate(e),c=null,i instanceof Er)return i;if(typeof i=="string"){const p=e.parseColor(i);if(p)return p}else if(Array.isArray(i)&&(c=i.length<3||i.length>4?`Invalid rbga value ${JSON.stringify(i)}: expected an array containing either three or four numeric values.`:Wc(i[0],i[1],i[2],i[3]),!c))return new Er(i[0]/255,i[1]/255,i[2]/255,i[3])}throw new $i(c||`Could not parse color from value '${typeof i=="string"?i:String(JSON.stringify(i))}'`)}if(this.type.kind==="number"){let i=null;for(const c of this.args){if(i=c.evaluate(e),i===null)return 0;const u=Number(i);if(!isNaN(u))return u}throw new $i(`Could not convert ${JSON.stringify(i)} to number.`)}return this.type.kind==="formatted"?Ys.fromString(Qo(this.args[0].evaluate(e))):this.type.kind==="resolvedImage"?ao.build(Qo(this.args[0].evaluate(e))):this.type.kind==="array"?this.args.map(i=>i.evaluate(e)):Qo(this.args[0].evaluate(e))}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){if(this.type.kind==="formatted")return new Fu([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if(this.type.kind==="resolvedImage")return new ju(this.args[0]).serialize();const e=this.type.kind==="array"?[]:[`to-${this.type.kind}`];return this.eachChild(i=>{e.push(i.serialize())}),e}}const Ks=["Unknown","Point","LineString","Polygon"];class $h{constructor(e,i){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null,this.featureTileCoord=null,this.featureDistanceData=null,this.scope=e,this.options=i}id(){return this.feature&&this.feature.id!==void 0?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?Ks[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}measureLight(e){return this.globals.brightness||0}distanceFromCenter(){if(this.featureTileCoord&&this.featureDistanceData){const e=this.featureDistanceData.center,i=this.featureDistanceData.scale,{x:c,y:u}=this.featureTileCoord;return this.featureDistanceData.bearing[0]*(c*i-e[0])+this.featureDistanceData.bearing[1]*(u*i-e[1])}return 0}parseColor(e){let i=this._parseColorCache[e];return i||(i=this._parseColorCache[e]=Er.parse(e)),i}getConfig(e){return this.options?this.options.get(e):null}}class ps{constructor(e,i,c,u,p){this.name=e,this.type=i,this._evaluate=c,this.args=u,this._overloadIndex=p}evaluate(e){if(!this._evaluate){const i=ps.definitions[this.name];this._evaluate=Array.isArray(i)?i[2]:i.overloads[this._overloadIndex][1]}return this._evaluate(e,this.args)}eachChild(e){this.args.forEach(e)}outputDefined(){return!1}serialize(){return[this.name].concat(this.args.map(e=>e.serialize()))}static parse(e,i){const c=e[0],u=ps.definitions[c];if(!u)return i.error(`Unknown expression "${c}". If you wanted a literal array, use ["literal", [...]].`,0);const p=Array.isArray(u)?u[0]:u.type,m=Array.isArray(u)?[[u[1],u[2]]]:u.overloads,v=[];let S=null,T=-1;for(const[I,P]of m){if(Array.isArray(I)&&I.length!==e.length-1)continue;v.push(I),T++,S=new Wp(i.registry,i.path,null,i.scope,void 0,i._scope,i.options);const M=[];let L=!1;for(let O=1;O<e.length;O++){const G=e[O],Z=Array.isArray(I)?I[O-1]:I.type,Q=S.parse(G,1+M.length,Z);if(!Q){L=!0;break}M.push(Q)}if(!L)if(Array.isArray(I)&&I.length!==M.length)S.error(`Expected ${I.length} arguments, but found ${M.length} instead.`);else{for(let O=0;O<M.length;O++){const G=Array.isArray(I)?I[O]:I.type,Z=M[O];S.concat(O+1).checkSubtype(G,Z.type)}if(S.errors.length===0)return new ps(c,p,P,M,T)}}if(v.length===1)i.errors.push(...S.errors);else{const I=(v.length?v:m.map(([M])=>M)).map(b_).join(" | "),P=[];for(let M=1;M<e.length;M++){const L=i.parse(e[M],1+P.length);if(!L)return null;P.push(qi(L.type))}i.error(`Expected arguments of type ${I}, but found (${P.join(", ")}) instead.`)}return null}static register(e,i){ps.definitions=i;for(const c in i)e[c]=ps}}function b_(o){return Array.isArray(o)?`(${o.map(qi).join(", ")})`:`(${qi(o.type)}...)`}class Oa{constructor(e,i,c){this.type=Dp,this.locale=c,this.caseSensitive=e,this.diacriticSensitive=i}static parse(e,i){if(e.length!==2)return i.error("Expected one argument.");const c=e[1];if(typeof c!="object"||Array.isArray(c))return i.error("Collator options argument must be an object.");const u=c["case-sensitive"]===void 0?i.parse(!1,1,br):i.parseObjectValue(c["case-sensitive"],1,"case-sensitive",br);if(!u)return null;const p=c["diacritic-sensitive"]===void 0?i.parse(!1,1,br):i.parseObjectValue(c["diacritic-sensitive"],1,"diacritic-sensitive",br);if(!p)return null;let m=null;return c.locale&&(m=i.parseObjectValue(c.locale,1,"locale",Nr),!m)?null:new Oa(u,p,m)}evaluate(e){return new Vh(this.caseSensitive.evaluate(e),this.diacriticSensitive.evaluate(e),this.locale?this.locale.evaluate(e):null)}eachChild(e){e(this.caseSensitive),e(this.diacriticSensitive),this.locale&&e(this.locale)}outputDefined(){return!1}serialize(){const e={};return e["case-sensitive"]=this.caseSensitive.serialize(),e["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(e.locale=this.locale.serialize()),["collator",e]}}function Fs(o,e,i=0,c=o.length-1,u=N2){for(;c>i;){if(c-i>600){const S=c-i+1,T=e-i+1,I=Math.log(S),P=.5*Math.exp(2*I/3),M=.5*Math.sqrt(I*P*(S-P)/S)*(T-S/2<0?-1:1);Fs(o,e,Math.max(i,Math.floor(e-T*P/S+M)),Math.min(c,Math.floor(e+(S-T)*P/S+M)),u)}const p=o[e];let m=i,v=c;for(Gh(o,i,e),u(o[c],p)>0&&Gh(o,i,c);m<v;){for(Gh(o,m,v),m++,v--;u(o[m],p)<0;)m++;for(;u(o[v],p)>0;)v--}u(o[i],p)===0?Gh(o,i,v):(v++,Gh(o,v,c)),v<=e&&(i=v+1),e<=v&&(c=v-1)}}function Gh(o,e,i){const c=o[e];o[e]=o[i],o[i]=c}function N2(o,e){return o<e?-1:o>e?1:0}function z2(o){let e=0;for(let i,c,u=0,p=o.length,m=p-1;u<p;m=u++)i=o[u],c=o[m],e+=(c.x-i.x)*(i.y+c.y);return e}function Ql(o,e){o[0]=Math.min(o[0],e[0]),o[1]=Math.min(o[1],e[1]),o[2]=Math.max(o[2],e[0]),o[3]=Math.max(o[3],e[1])}function Bu(o,e){return!(o[0]<=e[0]||o[2]>=e[2]||o[1]<=e[1]||o[3]>=e[3])}function Zc(o,e,i){const c=o[0]-e[0],u=o[1]-e[1],p=o[0]-i[0],m=o[1]-i[1];return c*m-p*u==0&&c*p<=0&&u*m<=0}function Vu(o,e,i=!1){let c=!1;for(let v=0,S=e.length;v<S;v++){const T=e[v];for(let I=0,P=T.length,M=P-1;I<P;M=I++){const L=T[M],O=T[I];if(Zc(o,L,O))return i;(p=L)[1]>(u=o)[1]!=(m=O)[1]>u[1]&&u[0]<(m[0]-p[0])*(u[1]-p[1])/(m[1]-p[1])+p[0]&&(c=!c)}}var u,p,m;return c}function Zx(o,e,i,c){const u=c[0]-i[0],p=c[1]-i[1],m=(o[0]-i[0])*p-u*(o[1]-i[1]),v=(e[0]-i[0])*p-u*(e[1]-i[1]);return m>0&&v<0||m<0&&v>0}function zp(o,e,i,c){return(u=[c[0]-i[0],c[1]-i[1]])[0]*(p=[e[0]-o[0],e[1]-o[1]])[1]-u[1]*p[0]!=0&&!(!Zx(o,e,i,c)||!Zx(i,c,o,e));var u,p}function w_(o){const e=new Dt(Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY),i=new Dt(Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY);for(const c of o[0])e.x>c.x&&(e.x=c.x),e.y>c.y&&(e.y=c.y),i.x<c.x&&(i.x=c.x),i.y<c.y&&(i.y=c.y);return{min:e,max:i}}const cl=8192;function O2(o,e){const i=(180+o[0])/360,c=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+o[1]*Math.PI/360)))/360,u=Math.pow(2,e.z);return[Math.round(i*u*cl),Math.round(c*u*cl)]}function F2(o,e){for(let i=0;i<e.length;i++)if(Vu(o,e[i]))return!0;return!1}function Xx(o,e,i){for(const c of i)for(let u=0,p=c.length,m=p-1;u<p;m=u++)if(zp(o,e,c[m],c[u]))return!0;return!1}function Yx(o,e){for(let i=0;i<o.length;++i)if(!Vu(o[i],e))return!1;for(let i=0;i<o.length-1;++i)if(Xx(o[i],o[i+1],e))return!1;return!0}function Xc(o,e){for(let i=0;i<e.length;i++)if(Yx(o,e[i]))return!0;return!1}function S_(o,e,i){const c=[];for(let u=0;u<o.length;u++){const p=[];for(let m=0;m<o[u].length;m++){const v=O2(o[u][m],i);Ql(e,v),p.push(v)}c.push(p)}return c}function Kx(o,e,i){const c=[];for(let u=0;u<o.length;u++){const p=S_(o[u],e,i);c.push(p)}return c}function Op(o,e,i,c){if(o[0]<i[0]||o[0]>i[2]){const u=.5*c;let p=o[0]-i[0]>u?-c:i[0]-o[0]>u?c:0;p===0&&(p=o[0]-i[2]>u?-c:i[2]-o[0]>u?c:0),o[0]+=p}Ql(e,o)}function T_(o,e,i,c){const u=Math.pow(2,c.z)*cl,p=[c.x*cl,c.y*cl],m=[];if(!o)return m;for(const v of o)for(const S of v){const T=[S.x+p[0],S.y+p[1]];Op(T,e,i,u),m.push(T)}return m}function E_(o,e,i,c){const u=Math.pow(2,c.z)*cl,p=[c.x*cl,c.y*cl],m=[];if(!o)return m;for(const S of o){const T=[];for(const I of S){const P=[I.x+p[0],I.y+p[1]];Ql(e,P),T.push(P)}m.push(T)}if(e[2]-e[0]<=u/2){(v=e)[0]=v[1]=1/0,v[2]=v[3]=-1/0;for(const S of m)for(const T of S)Op(T,e,i,u)}var v;return m}class js{constructor(e,i){this.type=br,this.geojson=e,this.geometries=i}static parse(e,i){if(e.length!==2)return i.error(`'within' expression requires exactly one argument, but found ${e.length-1} instead.`);if(Zn(e[1])){const c=e[1];if(c.type==="FeatureCollection")for(let u=0;u<c.features.length;++u){const p=c.features[u].geometry.type;if(p==="Polygon"||p==="MultiPolygon")return new js(c,c.features[u].geometry)}else if(c.type==="Feature"){const u=c.geometry.type;if(u==="Polygon"||u==="MultiPolygon")return new js(c,c.geometry)}else if(c.type==="Polygon"||c.type==="MultiPolygon")return new js(c,c)}return i.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(e){if(e.geometry()!=null&&e.canonicalID()!=null){if(e.geometryType()==="Point")return function(i,c){const u=[1/0,1/0,-1/0,-1/0],p=[1/0,1/0,-1/0,-1/0],m=i.canonicalID();if(!m)return!1;if(c.type==="Polygon"){const v=S_(c.coordinates,p,m),S=T_(i.geometry(),u,p,m);if(!Bu(u,p))return!1;for(const T of S)if(!Vu(T,v))return!1}if(c.type==="MultiPolygon"){const v=Kx(c.coordinates,p,m),S=T_(i.geometry(),u,p,m);if(!Bu(u,p))return!1;for(const T of S)if(!F2(T,v))return!1}return!0}(e,this.geometries);if(e.geometryType()==="LineString")return function(i,c){const u=[1/0,1/0,-1/0,-1/0],p=[1/0,1/0,-1/0,-1/0],m=i.canonicalID();if(!m)return!1;if(c.type==="Polygon"){const v=S_(c.coordinates,p,m),S=E_(i.geometry(),u,p,m);if(!Bu(u,p))return!1;for(const T of S)if(!Yx(T,v))return!1}if(c.type==="MultiPolygon"){const v=Kx(c.coordinates,p,m),S=E_(i.geometry(),u,p,m);if(!Bu(u,p))return!1;for(const T of S)if(!Xc(T,v))return!1}return!0}(e,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}serialize(){return["within",this.geojson]}}const Hh={kilometers:1,miles:1e3/1609.344,nauticalmiles:1e3/1852,meters:1e3,metres:1e3,yards:1e3/.9144,feet:1e3/.3048,inches:1e3/.0254},C_=1/298.257223563,A_=C_*(2-C_),Uu=Math.PI/180;class $u{static fromTile(e,i,c){const u=Math.PI*(1-2*(e+.5)/Math.pow(2,i)),p=Math.atan(.5*(Math.exp(u)-Math.exp(-u)))/Uu;return new $u(p,c)}static get units(){return Hh}constructor(e,i){if(e===void 0)throw new Error("No latitude given.");if(i&&!Hh[i])throw new Error(`Unknown unit ${i}. Use one of: ${Object.keys(Hh).join(", ")}`);const c=6378.137*Uu*(i?Hh[i]:1),u=Math.cos(e*Uu),p=1/(1-A_*(1-u*u)),m=Math.sqrt(p);this.kx=c*m*u,this.ky=c*m*p*(1-A_)}distance(e,i){const c=zo(e[0]-i[0])*this.kx,u=(e[1]-i[1])*this.ky;return Math.sqrt(c*c+u*u)}bearing(e,i){const c=zo(i[0]-e[0])*this.kx;return Math.atan2(c,(i[1]-e[1])*this.ky)/Uu}destination(e,i,c){const u=c*Uu;return this.offset(e,Math.sin(u)*i,Math.cos(u)*i)}offset(e,i,c){return[e[0]+i/this.kx,e[1]+c/this.ky]}lineDistance(e){let i=0;for(let c=0;c<e.length-1;c++)i+=this.distance(e[c],e[c+1]);return i}area(e){let i=0;for(let c=0;c<e.length;c++){const u=e[c];for(let p=0,m=u.length,v=m-1;p<m;v=p++)i+=zo(u[p][0]-u[v][0])*(u[p][1]+u[v][1])*(c?-1:1)}return Math.abs(i)/2*this.kx*this.ky}along(e,i){let c=0;if(i<=0)return e[0];for(let u=0;u<e.length-1;u++){const p=e[u],m=e[u+1],v=this.distance(p,m);if(c+=v,c>i)return Fp(p,m,(i-(c-v))/v)}return e[e.length-1]}pointToSegmentDistance(e,i,c){let[u,p]=i,m=zo(c[0]-u)*this.kx,v=(c[1]-p)*this.ky;if(m!==0||v!==0){const S=(zo(e[0]-u)*this.kx*m+(e[1]-p)*this.ky*v)/(m*m+v*v);S>1?(u=c[0],p=c[1]):S>0&&(u+=m/this.kx*S,p+=v/this.ky*S)}return m=zo(e[0]-u)*this.kx,v=(e[1]-p)*this.ky,Math.sqrt(m*m+v*v)}pointOnLine(e,i){let c=1/0,u=e[0][0],p=e[0][1],m=0,v=0;for(let S=0;S<e.length-1;S++){let T=e[S][0],I=e[S][1],P=zo(e[S+1][0]-T)*this.kx,M=(e[S+1][1]-I)*this.ky,L=0;P===0&&M===0||(L=(zo(i[0]-T)*this.kx*P+(i[1]-I)*this.ky*M)/(P*P+M*M),L>1?(T=e[S+1][0],I=e[S+1][1]):L>0&&(T+=P/this.kx*L,I+=M/this.ky*L)),P=zo(i[0]-T)*this.kx,M=(i[1]-I)*this.ky;const O=P*P+M*M;O<c&&(c=O,u=T,p=I,m=S,v=L)}return{point:[u,p],index:m,t:Math.max(0,Math.min(1,v))}}lineSlice(e,i,c){let u=this.pointOnLine(c,e),p=this.pointOnLine(c,i);if(u.index>p.index||u.index===p.index&&u.t>p.t){const T=u;u=p,p=T}const m=[u.point],v=u.index+1,S=p.index;!I_(c[v],m[0])&&v<=S&&m.push(c[v]);for(let T=v+1;T<=S;T++)m.push(c[T]);return I_(c[S],p.point)||m.push(p.point),m}lineSliceAlong(e,i,c){let u=0;const p=[];for(let m=0;m<c.length-1;m++){const v=c[m],S=c[m+1],T=this.distance(v,S);if(u+=T,u>e&&p.length===0&&p.push(Fp(v,S,(e-(u-T))/T)),u>=i)return p.push(Fp(v,S,(i-(u-T))/T)),p;u>e&&p.push(S)}return p}bufferPoint(e,i){const c=i/this.ky,u=i/this.kx;return[e[0]-u,e[1]-c,e[0]+u,e[1]+c]}bufferBBox(e,i){const c=i/this.ky,u=i/this.kx;return[e[0]-u,e[1]-c,e[2]+u,e[3]+c]}insideBBox(e,i){return zo(e[0]-i[0])>=0&&zo(e[0]-i[2])<=0&&e[1]>=i[1]&&e[1]<=i[3]}}function I_(o,e){return o[0]===e[0]&&o[1]===e[1]}function Fp(o,e,i){const c=zo(e[0]-o[0]);return[o[0]+c*i,o[1]+(e[1]-o[1])*i]}function zo(o){for(;o<-180;)o+=360;for(;o>180;)o-=360;return o}class jp{constructor(e=[],i=(c,u)=>c<u?-1:c>u?1:0){if(this.data=e,this.length=this.data.length,this.compare=i,this.length>0)for(let c=(this.length>>1)-1;c>=0;c--)this._down(c)}push(e){this.data.push(e),this._up(this.length++)}pop(){if(this.length===0)return;const e=this.data[0],i=this.data.pop();return--this.length>0&&(this.data[0]=i,this._down(0)),e}peek(){return this.data[0]}_up(e){const{data:i,compare:c}=this,u=i[e];for(;e>0;){const p=e-1>>1,m=i[p];if(c(u,m)>=0)break;i[e]=m,e=p}i[e]=u}_down(e){const{data:i,compare:c}=this,u=this.length>>1,p=i[e];for(;e<u;){let m=1+(e<<1);const v=m+1;if(v<this.length&&c(i[v],i[m])<0&&(m=v),c(i[m],p)>=0)break;i[e]=i[m],e=m}i[e]=p}}var Lt=8192;function P_(o,e){return e.dist-o.dist}const Gu=100,Hu=50;function qh(o){const e=[1/0,1/0,-1/0,-1/0];if(e.length!==o.length)return!1;for(let i=0;i<e.length;i++)if(e[i]!==o[i])return!1;return!0}function Wh(o){return o[1]-o[0]+1}function Fa(o,e){const i=o[1]>=o[0]&&o[1]<e;return i||console.warn("Distance Expression: Index is out of range"),i}function Bp(o,e){if(o[0]>o[1])return[null,null];const i=Wh(o);if(e){if(i===2)return[o,null];const c=Math.floor(i/2);return[[o[0],o[0]+c],[o[0]+c,o[1]]]}{if(i===1)return[o,null];const c=Math.floor(i/2)-1;return[[o[0],o[0]+c],[o[0]+c+1,o[1]]]}}function ea(o,e){const i=[1/0,1/0,-1/0,-1/0];if(!Fa(e,o.length))return i;for(let c=e[0];c<=e[1];++c)Ql(i,o[c]);return i}function sr(o){const e=[1/0,1/0,-1/0,-1/0];for(let i=0;i<o.length;++i)for(let c=0;c<o[i].length;++c)Ql(e,o[i][c]);return e}function qu(o,e,i){if(qh(o)||qh(e))return NaN;let c=0,u=0;return o[2]<e[0]&&(c=e[0]-o[2]),o[0]>e[2]&&(c=o[0]-e[2]),o[1]>e[3]&&(u=o[1]-e[3]),o[3]<e[1]&&(u=e[1]-o[3]),i.distance([0,0],[c,u])}function j2(o){return 360*o-180}function B2(o){return 360/Math.PI*Math.atan(Math.exp((180-360*o)*Math.PI/180))-90}function Vp(o,e){const i=Math.pow(2,e.z),c=(o.y/Lt+e.y)/i;return[j2((o.x/Lt+e.x)/i),B2(c)]}function V2(o,e){const i=[];for(let c=0;c<o.length;++c)i.push(Vp(o[c],e));return i}function yi(o,e,i){const c=i.pointOnLine(e,o).point;return i.distance(o,c)}function Qx(o,e,i,c,u){const p=i.slice(c[0],c[1]+1);let m=1/0;for(let v=e[0];v<=e[1];++v)if((m=Math.min(m,yi(o[v],p,u)))===0)return 0;return m}function M_(o,e,i,c,u){const p=Math.min(u.pointToSegmentDistance(o,i,c),u.pointToSegmentDistance(e,i,c)),m=Math.min(u.pointToSegmentDistance(i,o,e),u.pointToSegmentDistance(c,o,e));return Math.min(p,m)}function U2(o,e,i,c,u){if(!Fa(e,o.length)||!Fa(c,i.length))return NaN;let p=1/0;for(let m=e[0];m<e[1];++m)for(let v=c[0];v<c[1];++v){if(zp(o[m],o[m+1],i[v],i[v+1]))return 0;p=Math.min(p,M_(o[m],o[m+1],i[v],i[v+1],u))}return p}function $2(o,e,i,c,u){if(!Fa(e,o.length)||!Fa(c,i.length))return NaN;let p=1/0;for(let m=e[0];m<=e[1];++m)for(let v=c[0];v<=c[1];++v)if((p=Math.min(p,u.distance(o[m],i[v])))===0)return p;return p}function G2(o,e,i){if(Vu(o,e,!0))return 0;let c=1/0;for(const u of e){const p=u.length;if(p<2)return console.warn("Distance Expression: Invalid polygon!"),NaN;if(u[0]!==u[p-1]&&(c=Math.min(c,i.pointToSegmentDistance(o,u[p-1],u[0])))===0||(c=Math.min(c,yi(o,u,i)))===0)return c}return c}function H2(o,e,i,c){if(!Fa(e,o.length))return NaN;for(let p=e[0];p<=e[1];++p)if(Vu(o[p],i,!0))return 0;let u=1/0;for(let p=e[0];p<e[1];++p)for(const m of i)for(let v=0,S=m.length,T=S-1;v<S;T=v++){if(zp(o[p],o[p+1],m[T],m[v]))return 0;u=Math.min(u,M_(o[p],o[p+1],m[T],m[v],c))}return u}function Jx(o,e){for(const i of o)for(let c=0;c<=i.length-1;++c)if(Vu(i[c],e,!0))return!0;return!1}function q2(o,e,i,c=1/0){const u=sr(o),p=sr(e);if(c!==1/0&&qu(u,p,i)>=c)return c;if(Bu(u,p)){if(Jx(o,e))return 0}else if(Jx(e,o))return 0;let m=c;for(const v of o)for(let S=0,T=v.length,I=T-1;S<T;I=S++)for(const P of e)for(let M=0,L=P.length,O=L-1;M<L;O=M++){if(zp(v[I],v[S],P[O],P[M]))return 0;m=Math.min(m,M_(v[I],v[S],P[O],P[M],i))}return m}function Up(o,e,i,c,u,p,m){if(p===null||m===null)return;const v=qu(ea(c,p),ea(u,m),i);v<e&&o.push({dist:v,range1:p,range2:m})}function W2(o,e,i,c,u=1/0){let p=Math.min(c.distance(o[0],i[0][0]),u);if(p===0)return p;const m=new jp([{dist:0,range1:[0,o.length-1],range2:[0,0]}],P_),v=e?Hu:Gu,S=sr(i);for(;m.length;){const T=m.pop();if(T.dist>=p)continue;const I=T.range1;if(Wh(I)<=v){if(!Fa(I,o.length))return NaN;if(e){const P=H2(o,I,i,c);if((p=Math.min(p,P))===0)return p}else for(let P=I[0];P<=I[1];++P){const M=G2(o[P],i,c);if((p=Math.min(p,M))===0)return p}}else{const P=Bp(I,e);if(P[0]!==null){const M=qu(ea(o,P[0]),S,c);M<p&&m.push({dist:M,range1:P[0],range2:[0,0]})}if(P[1]!==null){const M=qu(ea(o,P[1]),S,c);M<p&&m.push({dist:M,range1:P[1],range2:[0,0]})}}}return p}function e0(o,e,i,c,u,p=1/0){let m=Math.min(p,u.distance(o[0],i[0]));if(m===0)return m;const v=new jp([{dist:0,range1:[0,o.length-1],range2:[0,i.length-1]}],P_),S=e?Hu:Gu,T=c?Hu:Gu;for(;v.length;){const I=v.pop();if(I.dist>=m)continue;const P=I.range1,M=I.range2;if(Wh(P)<=S&&Wh(M)<=T){if(!Fa(P,o.length)||!Fa(M,i.length))return NaN;if(e&&c?m=Math.min(m,U2(o,P,i,M,u)):e||c?e&&!c?m=Math.min(m,Qx(i,M,o,P,u)):!e&&c&&(m=Math.min(m,Qx(o,P,i,M,u))):m=Math.min(m,$2(o,P,i,M,u)),m===0)return m}else{const L=Bp(P,e),O=Bp(M,c);Up(v,m,u,o,i,L[0],O[0]),Up(v,m,u,o,i,L[0],O[1]),Up(v,m,u,o,i,L[1],O[0]),Up(v,m,u,o,i,L[1],O[1])}}return m}function R_(o,e,i,c,u=1/0){let p=u;const m=ea(o,[0,o.length-1]);for(const v of i)if(!(p!==1/0&&qu(m,ea(v,[0,v.length-1]),c)>=p)&&(p=Math.min(p,e0(o,e,v,!0,c,p)),p===0))return p;return p}function $p(o,e,i,c,u=1/0){let p=u;const m=ea(o,[0,o.length-1]);for(const v of i){if(p!==1/0&&qu(m,sr(v),c)>=p)continue;const S=W2(o,e,v,c,p);if(isNaN(S))return S;if((p=Math.min(p,S))===0)return p}return p}function k_(o){return o==="Point"||o==="MultiPoint"||o==="LineString"||o==="MultiLineString"||o==="Polygon"||o==="MultiPolygon"}class Yc{constructor(e,i){this.type=nn,this.geojson=e,this.geometries=i}static parse(e,i){if(e.length!==2)return i.error(`'distance' expression requires either one argument, but found ' ${e.length-1} instead.`);if(Zn(e[1])){const c=e[1];if(c.type==="FeatureCollection"){for(let u=0;u<c.features.length;++u)if(k_(c.features[u].geometry.type))return new Yc(c,c.features[u].geometry)}else if(c.type==="Feature"){if(k_(c.geometry.type))return new Yc(c,c.geometry)}else if(k_(c.type))return new Yc(c,c)}return i.error("'distance' expression needs to be an array with format ['Distance', GeoJSONObj].")}evaluate(e){const i=e.geometry(),c=e.canonicalID();if(i!=null&&c!=null){if(e.geometryType()==="Point")return function(u,p,m){const v=[];for(const T of u)for(const I of T)v.push(Vp(I,p));const S=new $u(v[0][1],"meters");return m.type==="Point"||m.type==="MultiPoint"||m.type==="LineString"?e0(v,!1,m.type==="Point"?[m.coordinates]:m.coordinates,m.type==="LineString",S):m.type==="MultiLineString"?R_(v,!1,m.coordinates,S):m.type==="Polygon"||m.type==="MultiPolygon"?$p(v,!1,m.type==="Polygon"?[m.coordinates]:m.coordinates,S):null}(i,c,this.geometries);if(e.geometryType()==="LineString")return function(u,p,m){const v=[];for(const T of u){const I=[];for(const P of T)I.push(Vp(P,p));v.push(I)}const S=new $u(v[0][0][1],"meters");if(m.type==="Point"||m.type==="MultiPoint"||m.type==="LineString")return R_(m.type==="Point"?[m.coordinates]:m.coordinates,m.type==="LineString",v,S);if(m.type==="MultiLineString"){let T=1/0;for(let I=0;I<m.coordinates.length;I++){const P=R_(m.coordinates[I],!0,v,S,T);if(isNaN(P))return P;if((T=Math.min(T,P))===0)return T}return T}if(m.type==="Polygon"||m.type==="MultiPolygon"){let T=1/0;for(let I=0;I<v.length;I++){const P=$p(v[I],!0,m.type==="Polygon"?[m.coordinates]:m.coordinates,S,T);if(isNaN(P))return P;if((T=Math.min(T,P))===0)return T}return T}return null}(i,c,this.geometries);if(e.geometryType()==="Polygon")return function(u,p,m){const v=[];for(const T of function(I,P){const M=I.length;if(M<=1)return[I];const L=[];let O,G;for(let Z=0;Z<M;Z++){const Q=z2(I[Z]);Q!==0&&(I[Z].area=Math.abs(Q),G===void 0&&(G=Q<0),G===Q<0?(O&&L.push(O),O=[I[Z]]):O.push(I[Z]))}return O&&L.push(O),L}(u)){const I=[];for(let P=0;P<T.length;++P)I.push(V2(T[P],p));v.push(I)}const S=new $u(v[0][0][0][1],"meters");if(m.type==="Point"||m.type==="MultiPoint"||m.type==="LineString")return $p(m.type==="Point"?[m.coordinates]:m.coordinates,m.type==="LineString",v,S);if(m.type==="MultiLineString"){let T=1/0;for(let I=0;I<m.coordinates.length;I++){const P=$p(m.coordinates[I],!0,v,S,T);if(isNaN(P))return P;if((T=Math.min(T,P))===0)return T}return T}return m.type==="Polygon"||m.type==="MultiPolygon"?function(T,I,P){let M=1/0;for(const L of T)for(const O of I){const G=q2(L,O,P,M);if(isNaN(G))return G;if((M=Math.min(M,G))===0)return M}return M}(m.type==="Polygon"?[m.coordinates]:m.coordinates,v,S):null}(i,c,this.geometries);console.warn("Distance Expression: currently only evaluates valid Point/LineString/Polygon geometries.")}else console.warn("Distance Expression: requirs valid feature and canonical information.");return null}eachChild(){}outputDefined(){return!0}serialize(){return["distance",this.geojson]}}function Wu(o){if(o instanceof ps&&(o.name==="get"&&o.args.length===1||o.name==="feature-state"||o.name==="has"&&o.args.length===1||o.name==="properties"||o.name==="geometry-type"||o.name==="id"||/^filter-/.test(o.name))||o instanceof js||o instanceof Yc)return!1;if(o instanceof Xu)return o.featureConstant;let e=!0;return o.eachChild(i=>{e&&!Wu(i)&&(e=!1)}),e}function Gp(o){if(o instanceof ps&&o.name==="feature-state")return!1;let e=!0;return o.eachChild(i=>{e&&!Gp(i)&&(e=!1)}),e}function Hp(o){if(o instanceof Xu)return new Set([o.key]);let e=new Set;return o.eachChild(i=>{e=new Set([...e,...Hp(i)])}),e}function Zu(o,e){if(o instanceof ps&&e.indexOf(o.name)>=0)return!1;let i=!0;return o.eachChild(c=>{i&&!Zu(c,e)&&(i=!1)}),i}function t0(o,e,i){return[o,e,i].filter(Boolean).join("")}function D_(o,e){switch(o){case"string":return Qo(e);case"number":return+e;case"boolean":return!!e;case"color":return Er.parse(e);case"formatted":return Ys.fromString(Qo(e));case"resolvedImage":return ao.build(Qo(e))}return e}function n0(o,e,i,c){return c!==void 0&&(o=c*Math.round(o/c)),e!==void 0&&o<e&&(o=e),i!==void 0&&o>i&&(o=i),o}class Xu{constructor(e,i,c,u=!1){this.type=e,this.key=i,this.scope=c,this.featureConstant=u}static parse(e,i){let c=i.expectedType;if(c==null&&(c=Cr),e.length<2||e.length>3)return i.error("Invalid number of arguments for 'config' expression.");const u=i.parse(e[1],1);if(!(u instanceof En))return i.error("Key name of 'config' expression must be a string literal.");let p,m=!0;const v=Qo(u.value);if(e.length>=3){const S=i.parse(e[2],2);if(!(S instanceof En))return i.error("Scope of 'config' expression must be a string literal.");p=Qo(S.value)}if(i.options){const S=t0(v,p,i._scope),T=i.options.get(S);T&&(m=Wu(T.value||T.default))}return new Xu(c,v,p,m)}evaluate(e){const i=t0(this.key,this.scope,e.scope),c=e.getConfig(i);if(!c)return null;const{type:u,value:p,values:m,minValue:v,maxValue:S,stepValue:T}=c,I=c.default.evaluate(e);let P=I;if(p){const M=e.scope;e.scope=(M||"").split("").slice(1).join(""),P=p.evaluate(e),e.scope=M}return u&&(P=D_(u,P)),P===void 0||v===void 0&&S===void 0&&T===void 0||(typeof P=="number"?P=n0(P,v,S,T):Array.isArray(P)&&(P=P.map(M=>typeof M=="number"?n0(M,v,S,T):M))),p!==void 0&&P!==void 0&&m&&!m.includes(P)&&(P=I,u&&(P=D_(u,P))),(u&&u!==this.type||P!==void 0&&!Lp(Gt(P),this.type))&&(P=D_(this.type.kind,P)),P}eachChild(){}outputDefined(){return!1}serialize(){const e=["config",this.key];return this.scope&&e.concat(this.scope),e}}class qp{constructor(e,i){this.type=i.type,this.name=e,this.boundExpression=i}static parse(e,i){if(e.length!==2||typeof e[1]!="string")return i.error("'var' expression requires exactly one string literal argument.");const c=e[1];return i.scope.has(c)?new qp(c,i.scope.get(c)):i.error(`Unknown variable "${c}". Make sure "${c}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(e){return this.boundExpression.evaluate(e)}eachChild(){}outputDefined(){return!1}serialize(){return["var",this.name]}}class Wp{constructor(e,i=[],c,u=new x_,p=[],m,v){this.registry=e,this.path=i,this.key=i.map(S=>typeof S=="string"?`['${S}']`:`[${S}]`).join(""),this.scope=u,this.errors=p,this.expectedType=c,this._scope=m,this.options=v}parse(e,i,c,u,p={}){return i||c?this.concat(i,null,c,u)._parse(e,p):this._parse(e,p)}parseObjectValue(e,i,c,u,p,m={}){return this.concat(i,c,u,p)._parse(e,m)}_parse(e,i){function c(u,p,m){return m==="assert"?new _n(p,[u]):m==="coerce"?new Jo(p,[u]):u}if(e!==null&&typeof e!="string"&&typeof e!="boolean"&&typeof e!="number"||(e=["literal",e]),Array.isArray(e)){if(e.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const u=typeof e[0]=="string"?this.registry[e[0]]:void 0;if(u){let p=u.parse(e,this);if(!p)return null;if(this.expectedType){const m=this.expectedType,v=p.type;if(m.kind!=="string"&&m.kind!=="number"&&m.kind!=="boolean"&&m.kind!=="object"&&m.kind!=="array"||v.kind!=="value")if(m.kind!=="color"&&m.kind!=="formatted"&&m.kind!=="resolvedImage"||v.kind!=="value"&&v.kind!=="string"){if(this.checkSubtype(m,v))return null}else p=c(p,m,i.typeAnnotation||"coerce");else p=c(p,m,i.typeAnnotation||"assert")}if(!(p instanceof En)&&p.type.kind!=="resolvedImage"&&L_(p)){const m=new $h(this._scope,this.options);try{p=new En(p.type,p.evaluate(m))}catch(v){return this.error(v.message),null}}return p}return Jo.parse(["to-array",e],this)}return this.error(e===void 0?"'undefined' value invalid. Use null instead.":typeof e=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof e} instead.`)}concat(e,i,c,u){let p=typeof e=="number"?this.path.concat(e):this.path;p=typeof i=="string"?p.concat(i):p;const m=u?this.scope.concat(u):this.scope;return new Wp(this.registry,p,c||null,m,this.errors,this._scope,this.options)}error(e,...i){const c=`${this.key}${i.map(u=>`[${u}]`).join("")}`;this.errors.push(new No(c,e))}checkSubtype(e,i){const c=Ou(e,i);return c&&this.error(c),c}}function L_(o){if(o instanceof qp)return L_(o.boundExpression);if(o instanceof ps&&o.name==="error"||o instanceof Oa||o instanceof js||o instanceof Yc||o instanceof Xu)return!1;const e=o instanceof Jo||o instanceof _n;let i=!0;return o.eachChild(c=>{i=e?i&&L_(c):i&&c instanceof En}),!!i&&Wu(o)&&Zu(o,["zoom","heatmap-density","worldview","line-progress","raster-value","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center","measure-light","raster-particle-speed"])}function Zp(o,e){const i=o.length-1;let c,u,p=0,m=i,v=0;for(;p<=m;)if(v=Math.floor((p+m)/2),c=o[v],u=o[v+1],c<=e){if(v===i||e<u)return v;p=v+1}else{if(!(c>e))throw new $i("Input is not a number.");m=v-1}return 0}class Zh{constructor(e,i,c){this.type=e,this.input=i,this.labels=[],this.outputs=[];for(const[u,p]of c)this.labels.push(u),this.outputs.push(p)}static parse(e,i){if(e.length-1<4)return i.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return i.error("Expected an even number of arguments.");const c=i.parse(e[1],1,nn);if(!c)return null;const u=[];let p=null;i.expectedType&&i.expectedType.kind!=="value"&&(p=i.expectedType);for(let m=1;m<e.length;m+=2){const v=m===1?-1/0:e[m],S=e[m+1],T=m,I=m+1;if(typeof v!="number")return i.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',T);if(u.length&&u[u.length-1][0]>=v)return i.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',T);const P=i.parse(S,I,p);if(!P)return null;p=p||P.type,u.push([v,P])}return new Zh(p,c,u)}evaluate(e){const i=this.labels,c=this.outputs;if(i.length===1)return c[0].evaluate(e);const u=this.input.evaluate(e);if(u<=i[0])return c[0].evaluate(e);const p=i.length;return u>=i[p-1]?c[p-1].evaluate(e):c[Zp(i,u)].evaluate(e)}eachChild(e){e(this.input);for(const i of this.outputs)e(i)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}serialize(){const e=["step",this.input.serialize()];for(let i=0;i<this.labels.length;i++)i>0&&e.push(this.labels[i]),e.push(this.outputs[i].serialize());return e}}const r0=.95047,i0=1.08883,s0=4/29,Jl=6/29,o0=3*Jl*Jl,a0=Jl*Jl*Jl,Z2=Math.PI/180,X2=180/Math.PI;function N_(o){return o>a0?Math.pow(o,1/3):o/o0+s0}function Xp(o){return o>Jl?o*o*o:o0*(o-s0)}function Yp(o){return 255*(o<=.0031308?12.92*o:1.055*Math.pow(o,1/2.4)-.055)}function ec(o){return(o/=255)<=.04045?o/12.92:Math.pow((o+.055)/1.055,2.4)}function z_(o){const e=ec(o.r),i=ec(o.g),c=ec(o.b),u=N_((.4124564*e+.3575761*i+.1804375*c)/r0),p=N_((.2126729*e+.7151522*i+.072175*c)/1);return{l:116*p-16,a:500*(u-p),b:200*(p-N_((.0193339*e+.119192*i+.9503041*c)/i0)),alpha:o.a}}function O_(o){let e=(o.l+16)/116,i=isNaN(o.a)?e:e+o.a/500,c=isNaN(o.b)?e:e-o.b/200;return e=1*Xp(e),i=r0*Xp(i),c=i0*Xp(c),new Er(Yp(3.2404542*i-1.5371385*e-.4985314*c),Yp(-.969266*i+1.8760108*e+.041556*c),Yp(.0556434*i-.2040259*e+1.0572252*c),o.alpha)}function Y2(o,e,i){const c=e-o;return o+i*(c>180||c<-180?c-360*Math.round(c/360):c)}const Kc={forward:z_,reverse:O_,interpolate:function(o,e,i){return{l:vn(o.l,e.l,i),a:vn(o.a,e.a,i),b:vn(o.b,e.b,i),alpha:vn(o.alpha,e.alpha,i)}}},Qc={forward:function(o){const{l:e,a:i,b:c}=z_(o),u=Math.atan2(c,i)*X2;return{h:u<0?u+360:u,c:Math.sqrt(i*i+c*c),l:e,alpha:o.a}},reverse:function(o){const e=o.h*Z2,i=o.c;return O_({l:o.l,a:Math.cos(e)*i,b:Math.sin(e)*i,alpha:o.alpha})},interpolate:function(o,e,i){return{h:Y2(o.h,e.h,i),c:vn(o.c,e.c,i),l:vn(o.l,e.l,i),alpha:vn(o.alpha,e.alpha,i)}}};var l0=Object.freeze({__proto__:null,hcl:Qc,lab:Kc});class Oo{constructor(e,i,c,u,p){this.type=e,this.operator=i,this.interpolation=c,this.input=u,this.labels=[],this.outputs=[];for(const[m,v]of p)this.labels.push(m),this.outputs.push(v)}static interpolationFactor(e,i,c,u){let p=0;if(e.name==="exponential")p=Kp(i,e.base,c,u);else if(e.name==="linear")p=Kp(i,1,c,u);else if(e.name==="cubic-bezier"){const m=e.controlPoints;p=new tl(m[0],m[1],m[2],m[3]).solve(Kp(i,1,c,u))}return p}static parse(e,i){let[c,u,p,...m]=e;if(!Array.isArray(u)||u.length===0)return i.error("Expected an interpolation type expression.",1);if(u[0]==="linear")u={name:"linear"};else if(u[0]==="exponential"){const T=u[1];if(typeof T!="number")return i.error("Exponential interpolation requires a numeric base.",1,1);u={name:"exponential",base:T}}else{if(u[0]!=="cubic-bezier")return i.error(`Unknown interpolation type ${String(u[0])}`,1,0);{const T=u.slice(1);if(T.length!==4||T.some(I=>typeof I!="number"||I<0||I>1))return i.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);u={name:"cubic-bezier",controlPoints:T}}}if(e.length-1<4)return i.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if(e.length-1>3&&(e.length-1)%2!=0)return i.error("Expected an even number of arguments.");if(p=i.parse(p,2,nn),!p)return null;const v=[];let S=null;c==="interpolate-hcl"||c==="interpolate-lab"?S=xo:i.expectedType&&i.expectedType.kind!=="value"&&(S=i.expectedType);for(let T=0;T<m.length;T+=2){const I=m[T],P=m[T+1],M=T+3,L=T+4;if(typeof I!="number")return i.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',M);if(v.length&&v[v.length-1][0]>=I)return i.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',M);const O=i.parse(P,L,S);if(!O)return null;S=S||O.type,v.push([I,O])}return S.kind==="number"||S.kind==="color"||S.kind==="array"&&S.itemType.kind==="number"&&typeof S.N=="number"?new Oo(S,c,u,p,v):i.error(`Type ${qi(S)} is not interpolatable.`)}evaluate(e){const i=this.labels,c=this.outputs;if(i.length===1)return c[0].evaluate(e);const u=this.input.evaluate(e);if(u<=i[0])return c[0].evaluate(e);const p=i.length;if(u>=i[p-1])return c[p-1].evaluate(e);const m=Zp(i,u),v=Oo.interpolationFactor(this.interpolation,u,i[m],i[m+1]),S=c[m].evaluate(e),T=c[m+1].evaluate(e);return this.operator==="interpolate"?Oh[this.type.kind.toLowerCase()](S,T,v):this.operator==="interpolate-hcl"?Qc.reverse(Qc.interpolate(Qc.forward(S),Qc.forward(T),v)):Kc.reverse(Kc.interpolate(Kc.forward(S),Kc.forward(T),v))}eachChild(e){e(this.input);for(const i of this.outputs)e(i)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}serialize(){let e;e=this.interpolation.name==="linear"?["linear"]:this.interpolation.name==="exponential"?this.interpolation.base===1?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier",...this.interpolation.controlPoints];const i=[this.operator,e,this.input.serialize()];for(let c=0;c<this.labels.length;c++)i.push(this.labels[c],this.outputs[c].serialize());return i}}function Kp(o,e,i,c){const u=c-i,p=o-i;return u===0?0:e===1?p/u:(Math.pow(e,p)-1)/(Math.pow(e,u)-1)}class Xh{constructor(e,i){this.type=e,this.args=i}static parse(e,i){if(e.length<2)return i.error("Expectected at least one argument.");let c=null;const u=i.expectedType;u&&u.kind!=="value"&&(c=u);const p=[];for(const v of e.slice(1)){const S=i.parse(v,1+p.length,c,void 0,{typeAnnotation:"omit"});if(!S)return null;c=c||S.type,p.push(S)}const m=u&&p.some(v=>Ou(u,v.type));return new Xh(m?Cr:c,p)}evaluate(e){let i,c=null,u=0;for(const p of this.args){if(u++,c=p.evaluate(e),c&&c instanceof ao&&!c.available&&(i||(i=c),c=null,u===this.args.length))return i;if(c!==null)break}return c}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){const e=["coalesce"];return this.eachChild(i=>{e.push(i.serialize())}),e}}class Qp{constructor(e,i){this.type=i.type,this.bindings=[].concat(e),this.result=i}evaluate(e){return this.result.evaluate(e)}eachChild(e){for(const i of this.bindings)e(i[1]);e(this.result)}static parse(e,i){if(e.length<4)return i.error(`Expected at least 3 arguments, but found ${e.length-1} instead.`);const c=[];for(let p=1;p<e.length-1;p+=2){const m=e[p];if(typeof m!="string")return i.error(`Expected string, but found ${typeof m} instead.`,p);if(/[^a-zA-Z0-9_]/.test(m))return i.error("Variable names must contain only alphanumeric characters or '_'.",p);const v=i.parse(e[p+1],p+1);if(!v)return null;c.push([m,v])}const u=i.parse(e[e.length-1],e.length-1,i.expectedType,c);return u?new Qp(c,u):null}outputDefined(){return this.result.outputDefined()}serialize(){const e=["let"];for(const[i,c]of this.bindings)e.push(i,c.serialize());return e.push(this.result.serialize()),e}}class F_{constructor(e,i,c){this.type=e,this.index=i,this.input=c}static parse(e,i){if(e.length!==3)return i.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const c=i.parse(e[1],1,nn),u=i.parse(e[2],2,Xs(i.expectedType||Cr));return c&&u?new F_(u.type.itemType,c,u):null}evaluate(e){const i=this.index.evaluate(e),c=this.input.evaluate(e);if(i<0)throw new $i(`Array index out of bounds: ${i} < 0.`);if(i>=c.length)throw new $i(`Array index out of bounds: ${i} > ${c.length-1}.`);if(i!==Math.floor(i))throw new $i(`Array index must be an integer, but found ${i} instead. Use at-interpolated to retrieve interpolated result with a fractional index.`);return c[i]}eachChild(e){e(this.index),e(this.input)}outputDefined(){return!1}serialize(){return["at",this.index.serialize(),this.input.serialize()]}}class j_{constructor(e,i,c){this.type=e,this.index=i,this.input=c}static parse(e,i){if(e.length!==3)return i.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const c=i.parse(e[1],1,nn),u=i.parse(e[2],2,Xs(i.expectedType||Cr));return c&&u?new j_(u.type.itemType,c,u):null}evaluate(e){const i=this.index.evaluate(e),c=this.input.evaluate(e);if(i<0)throw new $i(`Array index out of bounds: ${i} < 0.`);if(i>c.length-1)throw new $i(`Array index out of bounds: ${i} > ${c.length-1}.`);if(i===Math.floor(i))return c[i];const u=Math.floor(i),p=Math.ceil(i),m=c[u],v=c[p];if(typeof m!="number"||typeof v!="number")throw new $i(`Cannot interpolate between non-number values at index ${i}.`);const S=i-u;return m*(1-S)+v*S}eachChild(e){e(this.index),e(this.input)}outputDefined(){return!1}serialize(){return["at-interpolated",this.index.serialize(),this.input.serialize()]}}class Jp{constructor(e,i){this.type=br,this.needle=e,this.haystack=i}static parse(e,i){if(e.length!==3)return i.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const c=i.parse(e[1],1,Cr),u=i.parse(e[2],2,Cr);return c&&u?Yl(c.type,[br,Nr,nn,zu,Cr])?new Jp(c,u):i.error(`Expected first argument to be of type boolean, string, number or null, but found ${qi(c.type)} instead`):null}evaluate(e){const i=this.needle.evaluate(e),c=this.haystack.evaluate(e);if(c==null)return!1;if(!Bh(i,["boolean","string","number","null"]))throw new $i(`Expected first argument to be of type boolean, string, number or null, but found ${qi(Gt(i))} instead.`);if(!Bh(c,["string","array"]))throw new $i(`Expected second argument to be of type array or string, but found ${qi(Gt(c))} instead.`);return c.indexOf(i)>=0}eachChild(e){e(this.needle),e(this.haystack)}outputDefined(){return!0}serialize(){return["in",this.needle.serialize(),this.haystack.serialize()]}}class Yh{constructor(e,i,c){this.type=nn,this.needle=e,this.haystack=i,this.fromIndex=c}static parse(e,i){if(e.length<=2||e.length>=5)return i.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const c=i.parse(e[1],1,Cr),u=i.parse(e[2],2,Cr);if(!c||!u)return null;if(!Yl(c.type,[br,Nr,nn,zu,Cr]))return i.error(`Expected first argument to be of type boolean, string, number or null, but found ${qi(c.type)} instead`);if(e.length===4){const p=i.parse(e[3],3,nn);return p?new Yh(c,u,p):null}return new Yh(c,u)}evaluate(e){const i=this.needle.evaluate(e),c=this.haystack.evaluate(e);if(!Bh(i,["boolean","string","number","null"]))throw new $i(`Expected first argument to be of type boolean, string, number or null, but found ${qi(Gt(i))} instead.`);if(!Bh(c,["string","array"]))throw new $i(`Expected second argument to be of type array or string, but found ${qi(Gt(c))} instead.`);if(this.fromIndex){const u=this.fromIndex.evaluate(e);return c.indexOf(i,u)}return c.indexOf(i)}eachChild(e){e(this.needle),e(this.haystack),this.fromIndex&&e(this.fromIndex)}outputDefined(){return!1}serialize(){if(this.fromIndex!=null&&this.fromIndex!==void 0){const e=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),e]}return["index-of",this.needle.serialize(),this.haystack.serialize()]}}class Yu{constructor(e,i,c,u,p,m){this.inputType=e,this.type=i,this.input=c,this.cases=u,this.outputs=p,this.otherwise=m}static parse(e,i){if(e.length<5)return i.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if(e.length%2!=1)return i.error("Expected an even number of arguments.");let c,u;i.expectedType&&i.expectedType.kind!=="value"&&(u=i.expectedType);const p={},m=[];for(let T=2;T<e.length-1;T+=2){let I=e[T];const P=e[T+1];Array.isArray(I)||(I=[I]);const M=i.concat(T);if(I.length===0)return M.error("Expected at least one branch label.");for(const O of I){if(typeof O!="number"&&typeof O!="string")return M.error("Branch labels must be numbers or strings.");if(typeof O=="number"&&Math.abs(O)>Number.MAX_SAFE_INTEGER)return M.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof O=="number"&&Math.floor(O)!==O)return M.error("Numeric branch labels must be integer values.");if(c){if(M.checkSubtype(c,Gt(O)))return null}else c=Gt(O);if(p[String(O)]!==void 0)return M.error("Branch labels must be unique.");p[String(O)]=m.length}const L=i.parse(P,T,u);if(!L)return null;u=u||L.type,m.push(L)}const v=i.parse(e[1],1,Cr);if(!v)return null;const S=i.parse(e[e.length-1],e.length-1,u);return S?v.type.kind!=="value"&&i.concat(1).checkSubtype(c,v.type)?null:new Yu(c,u,v,p,m,S):null}evaluate(e){const i=this.input.evaluate(e);return(Lp(Gt(i),this.inputType)&&this.outputs[this.cases[i]]||this.otherwise).evaluate(e)}eachChild(e){e(this.input),this.outputs.forEach(e),e(this.otherwise)}outputDefined(){return this.outputs.every(e=>e.outputDefined())&&this.otherwise.outputDefined()}serialize(){const e=["match",this.input.serialize()],i=Object.keys(this.cases).sort(),c=[],u={};for(const m of i){const v=u[this.cases[m]];v===void 0?(u[this.cases[m]]=c.length,c.push([this.cases[m],[m]])):c[v][1].push(m)}const p=m=>this.inputType.kind==="number"?Number(m):m;for(const[m,v]of c)e.push(v.length===1?p(v[0]):v.map(p)),e.push(this.outputs[m].serialize());return e.push(this.otherwise.serialize()),e}}class B_{constructor(e,i,c){this.type=e,this.branches=i,this.otherwise=c}static parse(e,i){if(e.length<4)return i.error(`Expected at least 3 arguments, but found only ${e.length-1}.`);if(e.length%2!=0)return i.error("Expected an odd number of arguments.");let c;i.expectedType&&i.expectedType.kind!=="value"&&(c=i.expectedType);const u=[];for(let m=1;m<e.length-1;m+=2){const v=i.parse(e[m],m,br);if(!v)return null;const S=i.parse(e[m+1],m+1,c);if(!S)return null;u.push([v,S]),c=c||S.type}const p=i.parse(e[e.length-1],e.length-1,c);return p?new B_(c,u,p):null}evaluate(e){for(const[i,c]of this.branches)if(i.evaluate(e))return c.evaluate(e);return this.otherwise.evaluate(e)}eachChild(e){for(const[i,c]of this.branches)e(i),e(c);e(this.otherwise)}outputDefined(){return this.branches.every(([e,i])=>i.outputDefined())&&this.otherwise.outputDefined()}serialize(){const e=["case"];return this.eachChild(i=>{e.push(i.serialize())}),e}}class Kh{constructor(e,i,c,u){this.type=e,this.input=i,this.beginIndex=c,this.endIndex=u}static parse(e,i){if(e.length<=2||e.length>=5)return i.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const c=i.parse(e[1],1,Cr),u=i.parse(e[2],2,nn);if(!c||!u)return null;if(!Yl(c.type,[Xs(Cr),Nr,Cr]))return i.error(`Expected first argument to be of type array or string, but found ${qi(c.type)} instead`);if(e.length===4){const p=i.parse(e[3],3,nn);return p?new Kh(c.type,c,u,p):null}return new Kh(c.type,c,u)}evaluate(e){const i=this.input.evaluate(e),c=this.beginIndex.evaluate(e);if(!Bh(i,["string","array"]))throw new $i(`Expected first argument to be of type array or string, but found ${qi(Gt(i))} instead.`);if(this.endIndex){const u=this.endIndex.evaluate(e);return i.slice(c,u)}return i.slice(c)}eachChild(e){e(this.input),e(this.beginIndex),this.endIndex&&e(this.endIndex)}outputDefined(){return!1}serialize(){if(this.endIndex!=null&&this.endIndex!==void 0){const e=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),e]}return["slice",this.input.serialize(),this.beginIndex.serialize()]}}function c0(o,e){return o==="=="||o==="!="?e.kind==="boolean"||e.kind==="string"||e.kind==="number"||e.kind==="null"||e.kind==="value":e.kind==="string"||e.kind==="number"||e.kind==="value"}function u0(o,e,i,c){return c.compare(e,i)===0}function Jc(o,e,i){const c=o!=="=="&&o!=="!=";return class nj{constructor(p,m,v){this.type=br,this.lhs=p,this.rhs=m,this.collator=v,this.hasUntypedArgument=p.type.kind==="value"||m.type.kind==="value"}static parse(p,m){if(p.length!==3&&p.length!==4)return m.error("Expected two or three arguments.");const v=p[0];let S=m.parse(p[1],1,Cr);if(!S)return null;if(!c0(v,S.type))return m.concat(1).error(`"${v}" comparisons are not supported for type '${qi(S.type)}'.`);let T=m.parse(p[2],2,Cr);if(!T)return null;if(!c0(v,T.type))return m.concat(2).error(`"${v}" comparisons are not supported for type '${qi(T.type)}'.`);if(S.type.kind!==T.type.kind&&S.type.kind!=="value"&&T.type.kind!=="value")return m.error(`Cannot compare types '${qi(S.type)}' and '${qi(T.type)}'.`);c&&(S.type.kind==="value"&&T.type.kind!=="value"?S=new _n(T.type,[S]):S.type.kind!=="value"&&T.type.kind==="value"&&(T=new _n(S.type,[T])));let I=null;if(p.length===4){if(S.type.kind!=="string"&&T.type.kind!=="string"&&S.type.kind!=="value"&&T.type.kind!=="value")return m.error("Cannot use collator to compare non-string types.");if(I=m.parse(p[3],3,Dp),!I)return null}return new nj(S,T,I)}evaluate(p){const m=this.lhs.evaluate(p),v=this.rhs.evaluate(p);if(c&&this.hasUntypedArgument){const S=Gt(m),T=Gt(v);if(S.kind!==T.kind||S.kind!=="string"&&S.kind!=="number")throw new $i(`Expected arguments for "${o}" to be (string, string) or (number, number), but found (${S.kind}, ${T.kind}) instead.`)}if(this.collator&&!c&&this.hasUntypedArgument){const S=Gt(m),T=Gt(v);if(S.kind!=="string"||T.kind!=="string")return e(p,m,v)}return this.collator?i(p,m,v,this.collator.evaluate(p)):e(p,m,v)}eachChild(p){p(this.lhs),p(this.rhs),this.collator&&p(this.collator)}outputDefined(){return!0}serialize(){const p=[o];return this.eachChild(m=>{p.push(m.serialize())}),p}}}const d0=Jc("==",function(o,e,i){return e===i},u0),K2=Jc("!=",function(o,e,i){return e!==i},function(o,e,i,c){return!u0(0,e,i,c)}),Q2=Jc("<",function(o,e,i){return e<i},function(o,e,i,c){return c.compare(e,i)<0}),J2=Jc(">",function(o,e,i){return e>i},function(o,e,i,c){return c.compare(e,i)>0}),em=Jc("<=",function(o,e,i){return e<=i},function(o,e,i,c){return c.compare(e,i)<=0}),eS=Jc(">=",function(o,e,i){return e>=i},function(o,e,i,c){return c.compare(e,i)>=0});class tm{constructor(e,i,c,u,p,m){this.type=Nr,this.number=e,this.locale=i,this.currency=c,this.unit=u,this.minFractionDigits=p,this.maxFractionDigits=m}static parse(e,i){if(e.length!==3)return i.error("Expected two arguments.");const c=i.parse(e[1],1,nn);if(!c)return null;const u=e[2];if(typeof u!="object"||Array.isArray(u))return i.error("NumberFormat options argument must be an object.");let p=null;if(u.locale&&(p=i.parseObjectValue(u.locale,2,"locale",Nr),!p))return null;let m=null;if(u.currency&&(m=i.parseObjectValue(u.currency,2,"currency",Nr),!m))return null;let v=null;if(u.unit&&(v=i.parseObjectValue(u.unit,2,"unit",Nr),!v))return null;let S=null;if(u["min-fraction-digits"]&&(S=i.parseObjectValue(u["min-fraction-digits"],2,"min-fraction-digits",nn),!S))return null;let T=null;return u["max-fraction-digits"]&&(T=i.parseObjectValue(u["max-fraction-digits"],2,"max-fraction-digits",nn),!T)?null:new tm(c,p,m,v,S,T)}evaluate(e){return new Intl.NumberFormat(this.locale?this.locale.evaluate(e):[],{style:(this.currency?"currency":this.unit&&"unit")||"decimal",currency:this.currency?this.currency.evaluate(e):void 0,unit:this.unit?this.unit.evaluate(e):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(e):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(e):void 0}).format(this.number.evaluate(e))}eachChild(e){e(this.number),this.locale&&e(this.locale),this.currency&&e(this.currency),this.unit&&e(this.unit),this.minFractionDigits&&e(this.minFractionDigits),this.maxFractionDigits&&e(this.maxFractionDigits)}outputDefined(){return!1}serialize(){const e={};return this.locale&&(e.locale=this.locale.serialize()),this.currency&&(e.currency=this.currency.serialize()),this.unit&&(e.unit=this.unit.serialize()),this.minFractionDigits&&(e["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(e["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),e]}}class V_{constructor(e){this.type=nn,this.input=e}static parse(e,i){if(e.length!==2)return i.error(`Expected 1 argument, but found ${e.length-1} instead.`);const c=i.parse(e[1],1);return c?c.type.kind!=="array"&&c.type.kind!=="string"&&c.type.kind!=="value"?i.error(`Expected argument of type string or array, but found ${qi(c.type)} instead.`):new V_(c):null}evaluate(e){const i=this.input.evaluate(e);if(typeof i=="string"||Array.isArray(i))return i.length;throw new $i(`Expected value to be of type string or array, but found ${qi(Gt(i))} instead.`)}eachChild(e){e(this.input)}outputDefined(){return!1}serialize(){const e=["length"];return this.eachChild(i=>{e.push(i.serialize())}),e}}function h0(o){return function(){o=1831565813+(o|=0)|0;let e=Math.imul(o^o>>>15,1|o);return e=e+Math.imul(e^e>>>7,61|e)^e,((e^e>>>14)>>>0)/4294967296}}const eu={"==":d0,"!=":K2,">":J2,"<":Q2,">=":eS,"<=":em,array:_n,at:F_,"at-interpolated":j_,boolean:_n,case:B_,coalesce:Xh,collator:Oa,format:Fu,image:ju,in:Jp,"index-of":Yh,interpolate:Oo,"interpolate-hcl":Oo,"interpolate-lab":Oo,length:V_,let:Qp,literal:En,match:Yu,number:_n,"number-format":tm,object:_n,slice:Kh,step:Zh,string:_n,"to-boolean":Jo,"to-color":Jo,"to-number":Jo,"to-string":Jo,var:qp,within:js,distance:Yc,config:Xu};function U_(o,[e,i,c,u]){e=e.evaluate(o),i=i.evaluate(o),c=c.evaluate(o);const p=u?u.evaluate(o):1,m=Wc(e,i,c,p);if(m)throw new $i(m);return new Er(e/255,i/255,c/255,p)}function $_(o,[e,i,c,u]){e=e.evaluate(o),i=i.evaluate(o),c=c.evaluate(o);const p=u?u.evaluate(o):1,m=function(T,I,P,M){return typeof T=="number"&&T>=0&&T<=360?typeof I=="number"&&I>=0&&I<=100&&typeof P=="number"&&P>=0&&P<=100?M===void 0||typeof M=="number"&&M>=0&&M<=1?null:`Invalid hsla value [${[T,I,P,M].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid hsla value [${(typeof M=="number"?[T,I,P,M]:[T,I,P]).join(", ")}]: 's', and 'l' must be between 0 and 100.`:`Invalid hsla value [${(typeof M=="number"?[T,I,P,M]:[T,I,P]).join(", ")}]: 'h' must be between 0 and 360.`}(e,i,c,p);if(m)throw new $i(m);const v=`hsla(${e}, ${i}%, ${c}%, ${p})`,S=Er.parse(v);if(!S)throw new $i(`Failed to parse HSLA color: ${v}`);return S}function f0(o,e){return o in e}function tc(o,e){const i=e[o];return i===void 0?null:i}function tu(o){return{type:o}}function p0(o){return{result:"success",value:o}}function nc(o){return{result:"error",value:o}}function nm(o,e){return!!o&&!!o.parameters&&o.parameters.indexOf(e)>-1}function Qh(o){return o["property-type"]==="data-driven"}function G_(o){return nm(o.expression,"measure-light")}function H_(o){return nm(o.expression,"zoom")}function Jh(o){return!!o.expression&&o.expression.interpolated}function ef(o){return typeof o=="object"&&o!==null&&!Array.isArray(o)}function m0(o){return o}function g0(o,e){const i=e.type==="color",c=o.stops&&typeof o.stops[0][0]=="object",u=c||!(c||o.property!==void 0),p=o.type||(Jh(e)?"exponential":"interval");if(i&&((o=qc({},o)).stops&&(o.stops=o.stops.map(T=>[T[0],Er.parse(T[1])])),o.default=Er.parse(o.default?o.default:e.default)),o.colorSpace&&o.colorSpace!=="rgb"&&!l0[o.colorSpace])throw new Error(`Unknown color space: ${o.colorSpace}`);let m,v,S;if(p==="exponential")m=q_;else if(p==="interval")m=nS;else if(p==="categorical"){m=tS,v=Object.create(null);for(const T of o.stops)v[T[0]]=T[1];S=typeof o.stops[0][0]}else{if(p!=="identity")throw new Error(`Unknown function type "${p}"`);m=rS}if(c){const T={},I=[];for(let L=0;L<o.stops.length;L++){const O=o.stops[L],G=O[0].zoom;T[G]===void 0&&(T[G]={zoom:G,type:o.type,property:o.property,default:o.default,stops:[]},I.push(G)),T[G].stops.push([O[0].value,O[1]])}const P=[];for(const L of I)P.push([T[L].zoom,g0(T[L],e)]);const M={name:"linear"};return{kind:"composite",interpolationType:M,interpolationFactor:Oo.interpolationFactor.bind(void 0,M),zoomStops:P.map(L=>L[0]),evaluate:({zoom:L},O)=>q_({stops:P,base:o.base},e,L).evaluate(L,O)}}if(u){const T=p==="exponential"?{name:"exponential",base:o.base!==void 0?o.base:1}:null;return{kind:"camera",interpolationType:T,interpolationFactor:Oo.interpolationFactor.bind(void 0,T),zoomStops:o.stops.map(I=>I[0]),evaluate:({zoom:I})=>m(o,e,I,v,S)}}return{kind:"source",evaluate(T,I){const P=I&&I.properties?I.properties[o.property]:void 0;return P===void 0?ta(o.default,e.default):m(o,e,P,v,S)}}}function ta(o,e,i){return o!==void 0?o:e!==void 0?e:i!==void 0?i:void 0}function tS(o,e,i,c,u){return ta(typeof i===u?c[i]:void 0,o.default,e.default)}function nS(o,e,i){if(Kl(i)!=="number")return ta(o.default,e.default);const c=o.stops.length;if(c===1||i<=o.stops[0][0])return o.stops[0][1];if(i>=o.stops[c-1][0])return o.stops[c-1][1];const u=Zp(o.stops.map(p=>p[0]),i);return o.stops[u][1]}function q_(o,e,i){const c=o.base!==void 0?o.base:1;if(Kl(i)!=="number")return ta(o.default,e.default);const u=o.stops.length;if(u===1||i<=o.stops[0][0])return o.stops[0][1];if(i>=o.stops[u-1][0])return o.stops[u-1][1];const p=Zp(o.stops.map(I=>I[0]),i),m=function(I,P,M,L){const O=L-M,G=I-M;return O===0?0:P===1?G/O:(Math.pow(P,G)-1)/(Math.pow(P,O)-1)}(i,c,o.stops[p][0],o.stops[p+1][0]),v=o.stops[p][1],S=o.stops[p+1][1];let T=Oh[e.type]||m0;if(o.colorSpace&&o.colorSpace!=="rgb"){const I=l0[o.colorSpace];T=(P,M)=>I.reverse(I.interpolate(I.forward(P),I.forward(M),m))}return typeof v.evaluate=="function"?{evaluate(...I){const P=v.evaluate.apply(void 0,I),M=S.evaluate.apply(void 0,I);if(P!==void 0&&M!==void 0)return T(P,M,m)}}:T(v,S,m)}function rS(o,e,i){return e.type==="color"?i=Er.parse(i):e.type==="formatted"?i=Ys.fromString(i.toString()):e.type==="resolvedImage"?i=ao.build(i.toString()):Kl(i)===e.type||e.type==="enum"&&e.values[i]||(i=void 0),ta(i,o.default,e.default)}ps.register(eu,{error:[{kind:"error"},[Nr],(o,[e])=>{throw new $i(e.evaluate(o))}],typeof:[Nr,[Cr],(o,[e])=>qi(Gt(e.evaluate(o)))],"to-rgba":[Xs(nn,4),[xo],(o,[e])=>e.evaluate(o).toNonPremultipliedRenderColor(null).toArray()],"to-hsla":[Xs(nn,4),[xo],(o,[e])=>e.evaluate(o).toNonPremultipliedRenderColor(null).toHslaArray()],rgb:[xo,[nn,nn,nn],U_],rgba:[xo,[nn,nn,nn,nn],U_],hsl:[xo,[nn,nn,nn],$_],hsla:[xo,[nn,nn,nn,nn],$_],has:{type:br,overloads:[[[Nr],(o,[e])=>f0(e.evaluate(o),o.properties())],[[Nr,al],(o,[e,i])=>f0(e.evaluate(o),i.evaluate(o))]]},get:{type:Cr,overloads:[[[Nr],(o,[e])=>tc(e.evaluate(o),o.properties())],[[Nr,al],(o,[e,i])=>tc(e.evaluate(o),i.evaluate(o))]]},"feature-state":[Cr,[Nr],(o,[e])=>tc(e.evaluate(o),o.featureState||{})],properties:[al,[],o=>o.properties()],"geometry-type":[Nr,[],o=>o.geometryType()],worldview:[Nr,[],o=>o.globals.worldview||""],id:[Cr,[],o=>o.id()],zoom:[nn,[],o=>o.globals.zoom],pitch:[nn,[],o=>o.globals.pitch||0],"distance-from-center":[nn,[],o=>o.distanceFromCenter()],"measure-light":[nn,[Nr],(o,[e])=>o.measureLight(e.evaluate(o))],"heatmap-density":[nn,[],o=>o.globals.heatmapDensity||0],"line-progress":[nn,[],o=>o.globals.lineProgress||0],"raster-value":[nn,[],o=>o.globals.rasterValue||0],"raster-particle-speed":[nn,[],o=>o.globals.rasterParticleSpeed||0],"sky-radial-progress":[nn,[],o=>o.globals.skyRadialProgress||0],accumulated:[Cr,[],o=>o.globals.accumulated===void 0?null:o.globals.accumulated],"+":[nn,tu(nn),(o,e)=>{let i=0;for(const c of e)i+=c.evaluate(o);return i}],"*":[nn,tu(nn),(o,e)=>{let i=1;for(const c of e)i*=c.evaluate(o);return i}],"-":{type:nn,overloads:[[[nn,nn],(o,[e,i])=>e.evaluate(o)-i.evaluate(o)],[[nn],(o,[e])=>-e.evaluate(o)]]},"/":[nn,[nn,nn],(o,[e,i])=>e.evaluate(o)/i.evaluate(o)],"%":[nn,[nn,nn],(o,[e,i])=>e.evaluate(o)%i.evaluate(o)],ln2:[nn,[],()=>Math.LN2],pi:[nn,[],()=>Math.PI],e:[nn,[],()=>Math.E],"^":[nn,[nn,nn],(o,[e,i])=>Math.pow(e.evaluate(o),i.evaluate(o))],sqrt:[nn,[nn],(o,[e])=>Math.sqrt(e.evaluate(o))],log10:[nn,[nn],(o,[e])=>Math.log(e.evaluate(o))/Math.LN10],ln:[nn,[nn],(o,[e])=>Math.log(e.evaluate(o))],log2:[nn,[nn],(o,[e])=>Math.log(e.evaluate(o))/Math.LN2],sin:[nn,[nn],(o,[e])=>Math.sin(e.evaluate(o))],cos:[nn,[nn],(o,[e])=>Math.cos(e.evaluate(o))],tan:[nn,[nn],(o,[e])=>Math.tan(e.evaluate(o))],asin:[nn,[nn],(o,[e])=>Math.asin(e.evaluate(o))],acos:[nn,[nn],(o,[e])=>Math.acos(e.evaluate(o))],atan:[nn,[nn],(o,[e])=>Math.atan(e.evaluate(o))],min:[nn,tu(nn),(o,e)=>Math.min(...e.map(i=>i.evaluate(o)))],max:[nn,tu(nn),(o,e)=>Math.max(...e.map(i=>i.evaluate(o)))],abs:[nn,[nn],(o,[e])=>Math.abs(e.evaluate(o))],round:[nn,[nn],(o,[e])=>{const i=e.evaluate(o);return i<0?-Math.round(-i):Math.round(i)}],floor:[nn,[nn],(o,[e])=>Math.floor(e.evaluate(o))],ceil:[nn,[nn],(o,[e])=>Math.ceil(e.evaluate(o))],"filter-==":[br,[Nr,Cr],(o,[e,i])=>o.properties()[e.value]===i.value],"filter-id-==":[br,[Cr],(o,[e])=>o.id()===e.value],"filter-type-==":[br,[Nr],(o,[e])=>o.geometryType()===e.value],"filter-<":[br,[Nr,Cr],(o,[e,i])=>{const c=o.properties()[e.value],u=i.value;return typeof c==typeof u&&c<u}],"filter-id-<":[br,[Cr],(o,[e])=>{const i=o.id(),c=e.value;return typeof i==typeof c&&i<c}],"filter->":[br,[Nr,Cr],(o,[e,i])=>{const c=o.properties()[e.value],u=i.value;return typeof c==typeof u&&c>u}],"filter-id->":[br,[Cr],(o,[e])=>{const i=o.id(),c=e.value;return typeof i==typeof c&&i>c}],"filter-<=":[br,[Nr,Cr],(o,[e,i])=>{const c=o.properties()[e.value],u=i.value;return typeof c==typeof u&&c<=u}],"filter-id-<=":[br,[Cr],(o,[e])=>{const i=o.id(),c=e.value;return typeof i==typeof c&&i<=c}],"filter->=":[br,[Nr,Cr],(o,[e,i])=>{const c=o.properties()[e.value],u=i.value;return typeof c==typeof u&&c>=u}],"filter-id->=":[br,[Cr],(o,[e])=>{const i=o.id(),c=e.value;return typeof i==typeof c&&i>=c}],"filter-has":[br,[Cr],(o,[e])=>e.value in o.properties()],"filter-has-id":[br,[],o=>o.id()!==null&&o.id()!==void 0],"filter-type-in":[br,[Xs(Nr)],(o,[e])=>e.value.indexOf(o.geometryType())>=0],"filter-id-in":[br,[Xs(Cr)],(o,[e])=>e.value.indexOf(o.id())>=0],"filter-in-small":[br,[Nr,Xs(Cr)],(o,[e,i])=>i.value.indexOf(o.properties()[e.value])>=0],"filter-in-large":[br,[Nr,Xs(Cr)],(o,[e,i])=>function(c,u,p,m){for(;p<=m;){const v=p+m>>1;if(u[v]===c)return!0;u[v]>c?m=v-1:p=v+1}return!1}(o.properties()[e.value],i.value,0,i.value.length-1)],all:{type:br,overloads:[[[br,br],(o,[e,i])=>e.evaluate(o)&&i.evaluate(o)],[tu(br),(o,e)=>{for(const i of e)if(!i.evaluate(o))return!1;return!0}]]},any:{type:br,overloads:[[[br,br],(o,[e,i])=>e.evaluate(o)||i.evaluate(o)],[tu(br),(o,e)=>{for(const i of e)if(i.evaluate(o))return!0;return!1}]]},"!":[br,[br],(o,[e])=>!e.evaluate(o)],"is-supported-script":[br,[Nr],(o,[e])=>{const i=o.globals&&o.globals.isSupportedScript;return!i||i(e.evaluate(o))}],upcase:[Nr,[Nr],(o,[e])=>e.evaluate(o).toUpperCase()],downcase:[Nr,[Nr],(o,[e])=>e.evaluate(o).toLowerCase()],concat:[Nr,tu(Cr),(o,e)=>e.map(i=>Qo(i.evaluate(o))).join("")],"resolved-locale":[Nr,[Dp],(o,[e])=>e.evaluate(o).resolvedLocale()],random:[nn,[nn,nn,Cr],(o,e)=>{const[i,c,u]=e.map(m=>m.evaluate(o));if(i>c||i===c)return i;let p;if(typeof u=="string")p=function(m){let v=0;if(m.length===0)return v;for(let S=0;S<m.length;S++)v=(v<<5)-v+m.charCodeAt(S),v|=0;return v}(u);else{if(typeof u!="number")throw new $i(`Invalid seed input: ${u}`);p=u}return i+h0(p)()*(c-i)}]});class Ku{constructor(e,i,c,u){this.expression=e,this._warningHistory={},this._evaluator=new $h(c,u),this._defaultValue=i?function(p){return p.type==="color"&&(ef(p.default)||Array.isArray(p.default))?new Er(0,0,0,0):p.type==="color"?Er.parse(p.default)||null:p.default===void 0?null:p.default}(i):null,this._enumValues=i&&i.type==="enum"?i.values:null,this.configDependencies=Hp(e)}evaluateWithoutErrorHandling(e,i,c,u,p,m,v,S){return this._evaluator.globals=e,this._evaluator.feature=i,this._evaluator.featureState=c,this._evaluator.canonical=u||null,this._evaluator.availableImages=p||null,this._evaluator.formattedSection=m,this._evaluator.featureTileCoord=v||null,this._evaluator.featureDistanceData=S||null,this.expression.evaluate(this._evaluator)}evaluate(e,i,c,u,p,m,v,S){this._evaluator.globals=e,this._evaluator.feature=i||null,this._evaluator.featureState=c||null,this._evaluator.canonical=u||null,this._evaluator.availableImages=p||null,this._evaluator.formattedSection=m||null,this._evaluator.featureTileCoord=v||null,this._evaluator.featureDistanceData=S||null;try{const T=this.expression.evaluate(this._evaluator);if(T==null||typeof T=="number"&&T!=T)return this._defaultValue;if(this._enumValues&&!(T in this._enumValues))throw new $i(`Expected value to be one of ${Object.keys(this._enumValues).map(I=>JSON.stringify(I)).join(", ")}, but found ${JSON.stringify(T)} instead.`);return T}catch(T){return this._warningHistory[T.message]||(this._warningHistory[T.message]=!0,typeof console<"u"&&console.warn(`Failed to evaluate expression "${JSON.stringify(this.expression.serialize())}". ${T.message}`)),this._defaultValue}}}function rm(o){return Array.isArray(o)&&o.length>0&&typeof o[0]=="string"&&o[0]in eu}function ul(o,e,i,c){const u=new Wp(eu,[],e?function(m){const v={color:xo,string:Nr,number:nn,enum:Nr,boolean:br,formatted:Fh,resolvedImage:jh};return m.type==="array"?Xs(v[m.value]||Cr,m.length):v[m.type]}(e):void 0,void 0,void 0,i,c),p=u.parse(o,void 0,void 0,void 0,e&&e.type==="string"?{typeAnnotation:"coerce"}:void 0);return p?p0(new Ku(p,e,i,c)):nc(u.errors)}class tf{constructor(e,i,c,u){this.kind=e,this._styleExpression=i,this.isLightConstant=c,this.isLineProgressConstant=u,this.isStateDependent=e!=="constant"&&!Gp(i.expression),this.configDependencies=Hp(i.expression)}evaluateWithoutErrorHandling(e,i,c,u,p,m){return this._styleExpression.evaluateWithoutErrorHandling(e,i,c,u,p,m)}evaluate(e,i,c,u,p,m){return this._styleExpression.evaluate(e,i,c,u,p,m)}}class nf{constructor(e,i,c,u,p,m){this.kind=e,this.zoomStops=c,this._styleExpression=i,this.isStateDependent=e!=="camera"&&!Gp(i.expression),this.isLightConstant=p,this.isLineProgressConstant=m,this.configDependencies=Hp(i.expression),this.interpolationType=u}evaluateWithoutErrorHandling(e,i,c,u,p,m){return this._styleExpression.evaluateWithoutErrorHandling(e,i,c,u,p,m)}evaluate(e,i,c,u,p,m){return this._styleExpression.evaluate(e,i,c,u,p,m)}interpolationFactor(e,i,c){return this.interpolationType?Oo.interpolationFactor(this.interpolationType,e,i,c):0}}function _0(o,e,i,c){if((o=ul(o,e,i,c)).result==="error")return o;const u=o.value.expression,p=Wu(u);if(!p&&!Qh(e))return nc([new No("","data expressions not supported")]);const m=Zu(u,["zoom","pitch","distance-from-center"]);if(!m&&!H_(e))return nc([new No("","zoom expressions not supported")]);const v=Zu(u,["measure-light"]);if(!v&&!G_(e))return nc([new No("","measure-light expression not supported")]);const S=Zu(u,["line-progress"]);if(!S&&!function(P){return nm(P.expression,"line-progress")}(e))return nc([new No("","line-progress expression not supported")]);const T=e.expression&&e.expression.relaxZoomRestriction,I=Ju(u);return I||m||T?I instanceof No?nc([I]):I instanceof Oo&&!Jh(e)?nc([new No("",'"interpolate" expressions cannot be used with this property')]):p0(I?new nf(p&&S?"camera":"composite",o.value,I.labels,I instanceof Oo?I.interpolation:void 0,v,S):new tf(p&&S?"constant":"source",o.value,v,S)):nc([new No("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression, or in the properties of atmosphere.')])}class Qu{constructor(e,i){this._parameters=e,this._specification=i,qc(this,g0(this._parameters,this._specification))}static deserialize(e){return new Qu(e._parameters,e._specification)}static serialize(e){return{_parameters:e._parameters,_specification:e._specification}}}function Ju(o){let e=null;if(o instanceof Qp)e=Ju(o.result);else if(o instanceof Xh){for(const i of o.args)if(e=Ju(i),e)break}else(o instanceof Zh||o instanceof Oo)&&o.input instanceof ps&&o.input.name==="zoom"&&(e=o);return e instanceof No||o.eachChild(i=>{const c=Ju(i);c instanceof No?e=c:e&&c&&e!==c&&(e=new No("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),e}var im,W_,Z_=function(){if(W_)return im;W_=1,im=e;var o=3;function e(i,c,u){var p=this.cells=[];if(i instanceof ArrayBuffer){this.arrayBuffer=i;var m=new Int32Array(this.arrayBuffer);i=m[0],this.d=(c=m[1])+2*(u=m[2]);for(var v=0;v<this.d*this.d;v++){var S=m[o+v],T=m[o+v+1];p.push(S===T?null:m.subarray(S,T))}var I=m[o+p.length+1];this.keys=m.subarray(m[o+p.length],I),this.bboxes=m.subarray(I),this.insert=this._insertReadonly}else{this.d=c+2*u;for(var P=0;P<this.d*this.d;P++)p.push([]);this.keys=[],this.bboxes=[]}this.n=c,this.extent=i,this.padding=u,this.scale=c/i,this.uid=0;var M=u/c*i;this.min=-M,this.max=i+M}return e.prototype.insert=function(i,c,u,p,m){this._forEachCell(c,u,p,m,this._insertCell,this.uid++),this.keys.push(i),this.bboxes.push(c),this.bboxes.push(u),this.bboxes.push(p),this.bboxes.push(m)},e.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},e.prototype._insertCell=function(i,c,u,p,m,v){this.cells[m].push(v)},e.prototype.query=function(i,c,u,p,m){var v=this.min,S=this.max;if(i<=v&&c<=v&&S<=u&&S<=p&&!m)return Array.prototype.slice.call(this.keys);var T=[];return this._forEachCell(i,c,u,p,this._queryCell,T,{},m),T},e.prototype._queryCell=function(i,c,u,p,m,v,S,T){var I=this.cells[m];if(I!==null)for(var P=this.keys,M=this.bboxes,L=0;L<I.length;L++){var O=I[L];if(S[O]===void 0){var G=4*O;(T?T(M[G+0],M[G+1],M[G+2],M[G+3]):i<=M[G+2]&&c<=M[G+3]&&u>=M[G+0]&&p>=M[G+1])?(S[O]=!0,v.push(P[O])):S[O]=!1}}},e.prototype._forEachCell=function(i,c,u,p,m,v,S,T){for(var I=this._convertToCellCoord(i),P=this._convertToCellCoord(c),M=this._convertToCellCoord(u),L=this._convertToCellCoord(p),O=I;O<=M;O++)for(var G=P;G<=L;G++){var Z=this.d*G+O;if((!T||T(this._convertFromCellCoord(O),this._convertFromCellCoord(G),this._convertFromCellCoord(O+1),this._convertFromCellCoord(G+1)))&&m.call(this,i,c,u,p,Z,v,S,T))return}},e.prototype._convertFromCellCoord=function(i){return(i-this.padding)/this.scale},e.prototype._convertToCellCoord=function(i){return Math.max(0,Math.min(this.d-1,Math.floor(i*this.scale)+this.padding))},e.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var i=this.cells,c=o+this.cells.length+1+1,u=0,p=0;p<this.cells.length;p++)u+=this.cells[p].length;var m=new Int32Array(c+u+this.keys.length+this.bboxes.length);m[0]=this.extent,m[1]=this.n,m[2]=this.padding;for(var v=c,S=0;S<i.length;S++){var T=i[S];m[o+S]=v,m.set(T,v),v+=T.length}return m[o+i.length]=v,m.set(this.keys,v),m[o+i.length+1]=v+=this.keys.length,m.set(this.bboxes,v),v+=this.bboxes.length,m.buffer},im}(),dl=mi(Z_);const hl={};function Ht(o,e,i={}){Object.defineProperty(o,"_classRegistryKey",{value:e,writable:!1}),hl[e]={klass:o,omit:i.omit||[]}}Ht(Object,"Object"),dl.serialize=function(o,e){const i=o.toArrayBuffer();return e&&e.add(i),{buffer:i}},dl.deserialize=function(o){return new dl(o.buffer)},Object.defineProperty(dl,"name",{value:"Grid"}),Ht(dl,"Grid"),typeof DOMMatrix<"u"&&Ht(DOMMatrix,"DOMMatrix"),Ht(Er,"Color"),Ht(Error,"Error"),Ht(Ys,"Formatted"),Ht(Np,"FormattedSection"),Ht(ur,"AJAXError"),Ht(ao,"ResolvedImage"),Ht(Qu,"StylePropertyFunction"),Ht(Ku,"StyleExpression",{omit:["_evaluator"]}),Ht(vo,"ImageId"),Ht(ll,"ImageVariant"),Ht(nf,"ZoomDependentExpression"),Ht(tf,"ZoomConstantExpression"),Ht(ps,"CompoundExpression",{omit:["_evaluate"]});for(const o in eu)hl[eu[o]._classRegistryKey]||Ht(eu[o],`Expression${o}`);function y0(o){return o&&typeof ArrayBuffer<"u"&&(o instanceof ArrayBuffer||o.constructor&&o.constructor.name==="ArrayBuffer")}function v0(o){return self.ImageBitmap&&o instanceof ImageBitmap}function rc(o,e){if(o==null||typeof o=="boolean"||typeof o=="number"||typeof o=="string"||o instanceof Boolean||o instanceof Number||o instanceof String||o instanceof Date||o instanceof RegExp)return o;if(y0(o)||v0(o))return e&&e.add(o),o;if(ArrayBuffer.isView(o))return e&&e.add(o.buffer),o;if(o instanceof ImageData)return e&&e.add(o.data.buffer),o;if(Array.isArray(o)){const i=[];for(const c of o)i.push(rc(c,e));return i}if(o instanceof Map){const i={$name:"Map",entries:[]};for(const[c,u]of o.entries())i.entries.push(rc(c),rc(u,e));return i}if(o instanceof Set){const i={$name:"Set"};let c=0;for(const u of o.values())i[++c]=rc(u);return i}if(o instanceof DOMMatrix){const i={$name:"DOMMatrix"},c=["is2D","m11","m12","m13","m14","m21","m22","m23","m24","m31","m32","m33","m34","m41","m42","m43","m44","a","b","c","d","e","f"];for(const u of c)i[u]=o[u];return i}if(typeof o=="bigint")return{$name:"BigInt",value:o.toString()};if(typeof o=="object"){const i=o.constructor,c=i._classRegistryKey;if(!c)throw new Error(`Can't serialize object of unregistered class "${i.name}".`);const u=i.serialize?i.serialize(o,e):{};if(!i.serialize){for(const p in o)o.hasOwnProperty(p)&&(hl[c].omit.indexOf(p)>=0||(u[p]=rc(o[p],e)));o instanceof Error&&(u.message=o.message)}if(u.$name)throw new Error("$name property is reserved for worker serialization logic.");return c!=="Object"&&(u.$name=c),u}throw new Error("can't serialize object of type "+typeof o)}function ic(o){if(o==null||typeof o=="boolean"||typeof o=="number"||typeof o=="string"||o instanceof Boolean||o instanceof Number||o instanceof String||o instanceof Date||o instanceof RegExp||y0(o)||v0(o)||ArrayBuffer.isView(o)||o instanceof ImageData)return o;if(Array.isArray(o))return o.map(ic);if(typeof o=="object"){const e=o.$name||"Object";if(e==="Map"){const u=o.entries||[],p=new Map;for(let m=0;m<u.length;m+=2)p.set(ic(u[m]),ic(u[m+1]));return p}if(e==="Set"){const u=new Set;for(const p of Object.keys(o))p!=="$name"&&u.add(ic(o[p]));return u}if(e==="DOMMatrix"){let u;return u=o.is2D?[o.a,o.b,o.c,o.d,o.e,o.f]:[o.m11,o.m12,o.m13,o.m14,o.m21,o.m22,o.m23,o.m24,o.m31,o.m32,o.m33,o.m34,o.m41,o.m42,o.m43,o.m44],new DOMMatrix(u)}if(e==="BigInt")return BigInt(o.value);const{klass:i}=hl[e];if(!i)throw new Error(`Can't deserialize unregistered class "${e}".`);if(i.deserialize)return i.deserialize(o);const c=Object.create(i.prototype);for(const u of Object.keys(o))u!=="$name"&&(c[u]=ic(o[u]));return c}throw new Error("can't deserialize object of type "+typeof o)}const hn={"Latin-1 Supplement":o=>o>=128&&o<=255,Arabic:o=>o>=1536&&o<=1791,"Arabic Supplement":o=>o>=1872&&o<=1919,"Arabic Extended-A":o=>o>=2208&&o<=2303,"Hangul Jamo":o=>o>=4352&&o<=4607,"Unified Canadian Aboriginal Syllabics":o=>o>=5120&&o<=5759,Khmer:o=>o>=6016&&o<=6143,"Unified Canadian Aboriginal Syllabics Extended":o=>o>=6320&&o<=6399,"General Punctuation":o=>o>=8192&&o<=8303,"Letterlike Symbols":o=>o>=8448&&o<=8527,"Number Forms":o=>o>=8528&&o<=8591,"Miscellaneous Technical":o=>o>=8960&&o<=9215,"Control Pictures":o=>o>=9216&&o<=9279,"Optical Character Recognition":o=>o>=9280&&o<=9311,"Enclosed Alphanumerics":o=>o>=9312&&o<=9471,"Geometric Shapes":o=>o>=9632&&o<=9727,"Miscellaneous Symbols":o=>o>=9728&&o<=9983,"Miscellaneous Symbols and Arrows":o=>o>=11008&&o<=11263,"CJK Radicals Supplement":o=>o>=11904&&o<=12031,"Kangxi Radicals":o=>o>=12032&&o<=12255,"Ideographic Description Characters":o=>o>=12272&&o<=12287,"CJK Symbols and Punctuation":o=>o>=12288&&o<=12351,Hiragana:o=>o>=12352&&o<=12447,Katakana:o=>o>=12448&&o<=12543,Bopomofo:o=>o>=12544&&o<=12591,"Hangul Compatibility Jamo":o=>o>=12592&&o<=12687,Kanbun:o=>o>=12688&&o<=12703,"Bopomofo Extended":o=>o>=12704&&o<=12735,"CJK Strokes":o=>o>=12736&&o<=12783,"Katakana Phonetic Extensions":o=>o>=12784&&o<=12799,"Enclosed CJK Letters and Months":o=>o>=12800&&o<=13055,"CJK Compatibility":o=>o>=13056&&o<=13311,"CJK Unified Ideographs Extension A":o=>o>=13312&&o<=19903,"Yijing Hexagram Symbols":o=>o>=19904&&o<=19967,"CJK Unified Ideographs":o=>o>=19968&&o<=40959,"Yi Syllables":o=>o>=40960&&o<=42127,"Yi Radicals":o=>o>=42128&&o<=42191,"Hangul Jamo Extended-A":o=>o>=43360&&o<=43391,"Hangul Syllables":o=>o>=44032&&o<=55215,"Hangul Jamo Extended-B":o=>o>=55216&&o<=55295,"Private Use Area":o=>o>=57344&&o<=63743,"CJK Compatibility Ideographs":o=>o>=63744&&o<=64255,"Arabic Presentation Forms-A":o=>o>=64336&&o<=65023,"Vertical Forms":o=>o>=65040&&o<=65055,"CJK Compatibility Forms":o=>o>=65072&&o<=65103,"Small Form Variants":o=>o>=65104&&o<=65135,"Arabic Presentation Forms-B":o=>o>=65136&&o<=65279,"Halfwidth and Fullwidth Forms":o=>o>=65280&&o<=65519,Osage:o=>o>=66736&&o<=66815,"CJK Unified Ideographs Extension B":o=>o>=131072&&o<=173791};function rf(o){for(const e of o)if(X_(e.charCodeAt(0)))return!0;return!1}function iS(o){for(const e of o)if(!sS(e.charCodeAt(0)))return!1;return!0}function sS(o){return!(hn.Arabic(o)||hn["Arabic Supplement"](o)||hn["Arabic Extended-A"](o)||hn["Arabic Presentation Forms-A"](o)||hn["Arabic Presentation Forms-B"](o))}function X_(o){return!(o!==746&&o!==747&&(o<4352||!(hn["Bopomofo Extended"](o)||hn.Bopomofo(o)||hn["CJK Compatibility Forms"](o)&&!(o>=65097&&o<=65103)||hn["CJK Compatibility Ideographs"](o)||hn["CJK Compatibility"](o)||hn["CJK Radicals Supplement"](o)||hn["CJK Strokes"](o)||!(!hn["CJK Symbols and Punctuation"](o)||o>=12296&&o<=12305||o>=12308&&o<=12319||o===12336)||hn["CJK Unified Ideographs Extension A"](o)||hn["CJK Unified Ideographs"](o)||hn["Enclosed CJK Letters and Months"](o)||hn["Hangul Compatibility Jamo"](o)||hn["Hangul Jamo Extended-A"](o)||hn["Hangul Jamo Extended-B"](o)||hn["Hangul Jamo"](o)||hn["Hangul Syllables"](o)||hn.Hiragana(o)||hn["Ideographic Description Characters"](o)||hn.Kanbun(o)||hn["Kangxi Radicals"](o)||hn["Katakana Phonetic Extensions"](o)||hn.Katakana(o)&&o!==12540||!(!hn["Halfwidth and Fullwidth Forms"](o)||o===65288||o===65289||o===65293||o>=65306&&o<=65310||o===65339||o===65341||o===65343||o>=65371&&o<=65503||o===65507||o>=65512&&o<=65519)||!(!hn["Small Form Variants"](o)||o>=65112&&o<=65118||o>=65123&&o<=65126)||hn["Unified Canadian Aboriginal Syllabics"](o)||hn["Unified Canadian Aboriginal Syllabics Extended"](o)||hn["Vertical Forms"](o)||hn["Yijing Hexagram Symbols"](o)||hn["Yi Syllables"](o)||hn["Yi Radicals"](o))))}function x0(o){return!(X_(o)||function(e){return!!(hn["Latin-1 Supplement"](e)&&(e===167||e===169||e===174||e===177||e===188||e===189||e===190||e===215||e===247)||hn["General Punctuation"](e)&&(e===8214||e===8224||e===8225||e===8240||e===8241||e===8251||e===8252||e===8258||e===8263||e===8264||e===8265||e===8273)||hn["Letterlike Symbols"](e)||hn["Number Forms"](e)||hn["Miscellaneous Technical"](e)&&(e>=8960&&e<=8967||e>=8972&&e<=8991||e>=8996&&e<=9e3||e===9003||e>=9085&&e<=9114||e>=9150&&e<=9165||e===9167||e>=9169&&e<=9179||e>=9186&&e<=9215)||hn["Control Pictures"](e)&&e!==9251||hn["Optical Character Recognition"](e)||hn["Enclosed Alphanumerics"](e)||hn["Geometric Shapes"](e)||hn["Miscellaneous Symbols"](e)&&!(e>=9754&&e<=9759)||hn["Miscellaneous Symbols and Arrows"](e)&&(e>=11026&&e<=11055||e>=11088&&e<=11097||e>=11192&&e<=11243)||hn["CJK Symbols and Punctuation"](e)||hn.Katakana(e)||hn["Private Use Area"](e)||hn["CJK Compatibility Forms"](e)||hn["Small Form Variants"](e)||hn["Halfwidth and Fullwidth Forms"](e)||e===8734||e===8756||e===8757||e>=9984&&e<=10087||e>=10102&&e<=10131||e===65532||e===65533)}(o))}function oS(o){return hn.Arabic(o)||hn["Arabic Supplement"](o)||hn["Arabic Extended-A"](o)||hn["Arabic Presentation Forms-A"](o)||hn["Arabic Presentation Forms-B"](o)}function b0(o){return o>=1424&&o<=2303||hn["Arabic Presentation Forms-A"](o)||hn["Arabic Presentation Forms-B"](o)}function aS(o,e){return!(!e&&b0(o)||o>=2304&&o<=3583||o>=3840&&o<=4255||hn.Khmer(o))}function lS(o){for(const e of o)if(b0(e.charCodeAt(0)))return!0;return!1}const bo={unavailable:"unavailable",deferred:"deferred",loading:"loading",parsing:"parsing",parsed:"parsed",loaded:"loaded",error:"error"};let Y_=null,Qs=bo.unavailable,fl=null;const nu=function(o){o&&typeof o=="string"&&o.indexOf("NetworkError")>-1&&(Qs=bo.error),Y_&&Y_(o)};function sm(){om.fire(new $c("pluginStateChange",{pluginStatus:Qs,pluginURL:fl}))}const om=new Gc,ed=function(){return Qs},w0=function(){if(Qs!==bo.deferred||!fl)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");Qs=bo.loading,sm(),fl&&Lh({url:fl},o=>{o?nu(o):(Qs=bo.loaded,sm())})},pl={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>Qs===bo.loaded||pl.applyArabicShaping!=null,isLoading:()=>Qs===bo.loading,setState(o){Qs=o.pluginStatus,fl=o.pluginURL},isParsing:()=>Qs===bo.parsing,isParsed:()=>Qs===bo.parsed,getPluginURL:()=>fl};class Fr{constructor(e,i){this.zoom=e,i?(this.now=i.now,this.fadeDuration=i.fadeDuration,this.transition=i.transition,this.pitch=i.pitch,this.brightness=i.brightness,this.worldview=i.worldview):(this.now=0,this.fadeDuration=0,this.transition={},this.pitch=0,this.brightness=0)}isSupportedScript(e){return function(i,c){for(const u of i)if(!aS(u.charCodeAt(0),c))return!1;return!0}(e,pl.isLoaded())}}class sf{constructor(e,i,c,u){this.property=e,this.value=i,this.expression=function(p,m,v,S){if(ef(p))return new Qu(p,m);if(rm(p)||Array.isArray(p)&&p.length>0){const T=_0(p,m,v,S);if(T.result==="error")throw new Error(T.value.map(I=>`${I.key}: ${I.message}`).join(", "));return T.value}{let T=p;return typeof p=="string"&&m.type==="color"&&(T=Er.parse(p)),{kind:"constant",configDependencies:new Set,evaluate:()=>T}}}(i===void 0?e.specification.default:i,e.specification,c,u)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(e,i,c){return this.property.possiblyEvaluate(this,e,i,c)}}class sc{constructor(e,i,c){this.property=e,this.value=new sf(e,void 0,i,c)}transitioned(e,i){return new T0(this.property,this.value,i,$e({},e.transition,this.transition),e.now)}untransitioned(){return new T0(this.property,this.value,null,{},0)}}class S0{constructor(e,i,c){this._properties=e,this._values=Object.create(e.defaultTransitionablePropertyValues),this._scope=i,this._options=c,this.configDependencies=new Set}getValue(e){return In(this._values[e].value.value)}setValue(e,i){this._values.hasOwnProperty(e)||(this._values[e]=new sc(this._values[e].property,this._scope,this._options)),this._values[e].value=new sf(this._values[e].property,i===null?void 0:In(i),this._scope,this._options),this._values[e].value.expression.configDependencies&&(this.configDependencies=new Set([...this.configDependencies,...this._values[e].value.expression.configDependencies]))}setTransitionOrValue(e,i){i&&(this._options=i);const c=this._properties.properties;if(e)for(const u in e){const p=e[u];if(u.endsWith("-transition")){const m=u.slice(0,-11);c[m]&&this.setTransition(m,p)}else c.hasOwnProperty(u)&&this.setValue(u,p)}}getTransition(e){return In(this._values[e].transition)}setTransition(e,i){this._values.hasOwnProperty(e)||(this._values[e]=new sc(this._values[e].property)),this._values[e].transition=In(i)||void 0}serialize(){const e={};for(const i of Object.keys(this._values)){const c=this.getValue(i);c!==void 0&&(e[i]=c);const u=this.getTransition(i);u!==void 0&&(e[`${i}-transition`]=u)}return e}transitioned(e,i){const c=new E0(this._properties);for(const u of Object.keys(this._values))c._values[u]=this._values[u].transitioned(e,i._values[u]);return c}untransitioned(){const e=new E0(this._properties);for(const i of Object.keys(this._values))e._values[i]=this._values[i].untransitioned();return e}}class T0{constructor(e,i,c,u,p){const m=u.delay||0,v=u.duration||0;p=p||0,this.property=e,this.value=i,this.begin=p+m,this.end=this.begin+v,e.specification.transition&&(u.delay||u.duration)&&(this.prior=c)}possiblyEvaluate(e,i,c){const u=e.now||0,p=this.value.possiblyEvaluate(e,i,c),m=this.prior;if(m){if(u>this.end)return this.prior=null,p;if(this.value.isDataDriven())return this.prior=null,p;if(u<this.begin)return m.possiblyEvaluate(e,i,c);{const v=(u-this.begin)/(this.end-this.begin);return this.property.interpolate(m.possiblyEvaluate(e,i,c),p,oe(v))}}return p}}class E0{constructor(e){this._properties=e,this._values=Object.create(e.defaultTransitioningPropertyValues)}possiblyEvaluate(e,i,c){const u=new ru(this._properties);for(const p of Object.keys(this._values))u._values[p]=this._values[p].possiblyEvaluate(e,i,c);return u}hasTransition(){for(const e of Object.keys(this._values))if(this._values[e].prior)return!0;return!1}}class cS{constructor(e,i,c){this._properties=e,this._values=Object.create(e.defaultPropertyValues),this._scope=i,this._options=c,this.configDependencies=new Set}getValue(e){return In(this._values[e].value)}setValue(e,i){this._values[e]=new sf(this._values[e].property,i===null?void 0:In(i),this._scope,this._options),this._values[e].expression.configDependencies&&(this.configDependencies=new Set([...this.configDependencies,...this._values[e].expression.configDependencies]))}serialize(){const e={};for(const i of Object.keys(this._values)){const c=this.getValue(i);c!==void 0&&(e[i]=c)}return e}possiblyEvaluate(e,i,c){const u=new ru(this._properties);for(const p of Object.keys(this._values))u._values[p]=this._values[p].possiblyEvaluate(e,i,c);return u}}class td{constructor(e,i,c){this.property=e,this.value=i,this.parameters=c}isConstant(){return this.value.kind==="constant"}constantOr(e){return this.value.kind==="constant"?this.value.value:e}evaluate(e,i,c,u){return this.property.evaluate(this.value,this.parameters,e,i,c,u)}}class ru{constructor(e){this._properties=e,this._values=Object.create(e.defaultPossiblyEvaluatedValues)}get(e){return this._values[e]}}class bt{constructor(e){this.specification=e}possiblyEvaluate(e,i){return e.expression.evaluate(i)}interpolate(e,i,c){const u=Oh[this.specification.type];return u?u(e,i,c):e}}class Bt{constructor(e,i){this.specification=e,this.overrides=i}possiblyEvaluate(e,i,c,u){return new td(this,e.expression.kind==="constant"||e.expression.kind==="camera"?{kind:"constant",value:e.expression.evaluate(i,null,{},c,u)}:e.expression,i)}interpolate(e,i,c){if(e.value.kind!=="constant"||i.value.kind!=="constant")return e;if(e.value.value===void 0||i.value.value===void 0)return new td(this,{kind:"constant",value:void 0},e.parameters);const u=Oh[this.specification.type];return u?new td(this,{kind:"constant",value:u(e.value.value,i.value.value,c)},e.parameters):e}evaluate(e,i,c,u,p,m){return e.kind==="constant"?e.value:e.evaluate(i,c,u,p,m)}}class iu{constructor(e){this.specification=e}possiblyEvaluate(e,i,c,u){return!!e.expression.evaluate(i,null,{},c,u)}interpolate(){return!1}}class Ti{constructor(e){this.properties=e,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];const i=new Fr(0,{});for(const c in e){const u=e[c];u.specification.overridable&&this.overridableProperties.push(c);const p=this.defaultPropertyValues[c]=new sf(u,void 0),m=this.defaultTransitionablePropertyValues[c]=new sc(u);this.defaultTransitioningPropertyValues[c]=m.untransitioned(),this.defaultPossiblyEvaluatedValues[c]=p.possiblyEvaluate(i)}}}Ht(Bt,"DataDrivenProperty"),Ht(bt,"DataConstantProperty"),Ht(iu,"ColorRampProperty");var Oe=JSON.parse('{"$version":8,"$root":{"version":{"type":"enum","values":[8]},"fragment":{"type":"boolean"},"name":{"type":"string"},"metadata":{"type":"*"},"center":{"type":"array","value":"number"},"zoom":{"type":"number"},"bearing":{"type":"number","default":0,"period":360},"pitch":{"type":"number","default":0},"light":{"type":"light"},"lights":{"type":"array","value":"light-3d"},"terrain":{"type":"terrain","optional":true},"fog":{"type":"fog"},"snow":{"type":"snow"},"rain":{"type":"rain"},"camera":{"type":"camera"},"color-theme":{"type":"colorTheme"},"indoor":{"type":"indoor"},"imports":{"type":"array","value":"import"},"iconsets":{"type":"iconsets"},"schema":{"type":"schema"},"sources":{"type":"sources"},"sprite":{"type":"string"},"glyphs":{"type":"string","default":"mapbox://fonts/mapbox/{fontstack}/{range}.pbf"},"transition":{"type":"transition"},"projection":{"type":"projection"},"layers":{"type":"array","value":"layer"},"models":{"type":"models"},"featuresets":{"type":"featuresets"}},"featuresets":{"*":{"type":"featureset"}},"featureset":{"metadata":{"type":"*"},"selectors":{"type":"array","value":"selector"}},"selector":{"layer":{"type":"string"},"properties":{"type":"selectorProperty"},"featureNamespace":{"type":"string"},"_uniqueFeatureID":{"type":"boolean"}},"selectorProperty":{"*":{"type":"*"}},"model":{"type":"string"},"import":{"id":{"type":"string"},"url":{"type":"string"},"config":{"type":"config"},"data":{"type":"$root"},"color-theme":{"type":"colorTheme","optional":true}},"config":{"*":{"type":"*"}},"schema":{"*":{"type":"option"}},"option":{"default":{"type":"*","expression":{}},"type":{"type":"enum","values":{"string":1,"number":1,"boolean":1,"color":1}},"array":{"type":"boolean"},"minValue":{"type":"number"},"maxValue":{"type":"number"},"stepValue":{"type":"number"},"values":{"type":"array","value":"*"},"metadata":{"type":"*"}},"models":{"*":{"type":"model"}},"light-3d":{"id":{"type":"string"},"properties":{"type":"properties"},"type":{"type":"enum","values":{"ambient":{},"directional":{},"flat":{}}}},"properties":["properties_light_directional","properties_light_ambient","properties_light_flat"],"properties_light_directional":{"direction":{"type":"array","default":[210,30],"minimum":[0,0],"maximum":[360,90],"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"use-theme":true,"transition":true},"intensity":{"type":"number","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"cast-shadows":{"type":"boolean","default":false},"shadow-quality":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"parameters":["zoom"]}},"shadow-intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"properties_light_ambient":{"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"use-theme":true,"transition":true},"intensity":{"type":"number","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"properties_light_flat":{"anchor":{"type":"enum","default":"viewport","values":{"map":1,"viewport":1},"expression":{"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"use-theme":true,"transition":true},"intensity":{"type":"number","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"iconsets":{"*":{"type":"iconset"}},"iconset":["iconset_sprite","iconset_source"],"iconset_sprite":{"type":{"type":"enum","values":{"sprite":1}},"url":{"type":"string"}},"iconset_source":{"type":{"type":"enum","values":{"source":1}},"source":{"type":"string"}},"sources":{"*":{"type":"source"}},"source":["source_vector","source_raster","source_raster_dem","source_raster_array","source_geojson","source_video","source_image","source_model"],"source_vector":{"type":{"type":"enum","values":{"vector":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"extra_bounds":{"type":"array","value":{"type":"array","value":"number","length":4}},"scheme":{"type":"enum","values":{"xyz":1,"tms":1},"default":"xyz"},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"attribution":{"type":"string"},"promoteId":{"type":"promoteId"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster":{"type":{"type":"enum","values":{"raster":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"extra_bounds":{"type":"array","value":{"type":"array","value":"number","length":4}},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"scheme":{"type":"enum","values":{"xyz":1,"tms":1},"default":"xyz"},"attribution":{"type":"string"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_dem":{"type":{"type":"enum","values":{"raster-dem":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"extra_bounds":{"type":"array","value":{"type":"array","value":"number","length":4}},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"attribution":{"type":"string"},"encoding":{"type":"enum","values":{"terrarium":1,"mapbox":1},"default":"mapbox"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_array":{"type":{"type":"enum","values":{"raster-array":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"extra_bounds":{"type":"array","value":{"type":"array","value":"number","length":4}},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"attribution":{"type":"string"},"rasterLayers":{"type":"*"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_geojson":{"type":{"type":"enum","values":{"geojson":1}},"data":{"type":"*"},"maxzoom":{"type":"number","default":18},"minzoom":{"type":"number","default":0},"attribution":{"type":"string"},"buffer":{"type":"number","default":128,"maximum":512,"minimum":0},"filter":{"type":"*"},"tolerance":{"type":"number","default":0.375},"cluster":{"type":"boolean","default":false},"clusterRadius":{"type":"number","default":50,"minimum":0},"clusterMaxZoom":{"type":"number"},"clusterMinPoints":{"type":"number"},"clusterProperties":{"type":"*"},"lineMetrics":{"type":"boolean","default":false},"generateId":{"type":"boolean","default":false},"promoteId":{"type":"promoteId"},"dynamic":{"type":"boolean","default":false}},"source_video":{"type":{"type":"enum","values":{"video":1}},"urls":{"type":"array","value":"string"},"coordinates":{"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_image":{"type":{"type":"enum","values":{"image":1}},"url":{"type":"string"},"coordinates":{"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_model":{"type":{"type":"enum","values":{"model":1,"batched-model":1}},"maxzoom":{"type":"number","default":18},"minzoom":{"type":"number","default":0},"tiles":{"type":"array","value":"string"}},"layer":{"id":{"type":"string"},"type":{"type":"enum","values":{"fill":{},"line":{},"symbol":{},"circle":{},"heatmap":{},"fill-extrusion":{},"building":{},"raster":{},"raster-particle":{},"hillshade":{},"model":{},"background":{},"sky":{},"slot":{},"clip":{}}},"metadata":{"type":"*"},"source":{"type":"string"},"source-layer":{"type":"string"},"slot":{"type":"string"},"minzoom":{"type":"number","minimum":0,"maximum":24},"maxzoom":{"type":"number","minimum":0,"maximum":24},"filter":{"type":"filter"},"layout":{"type":"layout"},"paint":{"type":"paint"}},"layout":["layout_clip","layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_building","layout_symbol","layout_raster","layout_raster-particle","layout_hillshade","layout_background","layout_sky","layout_model"],"layout_background":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_sky":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_model":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}},"model-id":{"type":"string","default":"","property-type":"data-driven","expression":{"parameters":["zoom","feature"]}}},"layout_clip":{"clip-layer-types":{"type":"array","value":"enum","values":{"model":1,"symbol":1},"default":[],"expression":{}},"clip-layer-scope":{"type":"array","value":"string","default":[],"expression":{}}},"layout_fill":{"fill-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}},"fill-elevation-reference":{"type":"enum","values":{"none":1,"hd-road-base":1,"hd-road-markup":1},"default":"none","expression":{}},"fill-construct-bridge-guard-rail":{"type":"boolean","default":"true","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"}},"layout_circle":{"circle-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"circle-elevation-reference":{"type":"enum","values":{"none":1,"hd-road-markup":1},"default":"none","expression":{}},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_heatmap":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_fill-extrusion":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}},"fill-extrusion-edge-radius":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{}}},"layout_building":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}},"building-roof-shape":{"type":"enum","values":{"flat":1,"hipped":1,"gabled":1,"parapet":1,"mansard":1,"skillion":1,"pyramidal":1},"default":"flat","expression":{"parameters":["feature"]},"property-type":"data-driven"},"building-height":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{},"property-type":"data-driven"},"building-base":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{},"property-type":"data-driven"}},"layout_line":{"line-cap":{"type":"enum","values":{"butt":1,"round":1,"square":1},"default":"butt","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-join":{"type":"enum","values":{"bevel":1,"round":1,"miter":1,"none":1},"default":"miter","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{"type":"number","default":2,"expression":{"interpolated":true,"parameters":["zoom"]}},"line-round-limit":{"type":"number","default":1.05,"expression":{"interpolated":true,"parameters":["zoom"]}},"line-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-z-offset":{"type":"number","default":0,"expression":{"parameters":["zoom","feature","line-progress"]},"property-type":"data-driven"},"line-elevation-reference":{"type":"enum","values":{"none":1,"sea":1,"ground":1,"hd-road-markup":1},"default":"none","expression":{}},"line-cross-slope":{"type":"number","expression":{}},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}},"line-width-unit":{"type":"enum","values":{"pixels":1,"meters":1},"default":"pixels","expression":{"parameters":["zoom"]}}},"layout_symbol":{"symbol-placement":{"type":"enum","values":{"point":1,"line":1,"line-center":1},"default":"point","expression":{"parameters":["zoom"]}},"symbol-spacing":{"type":"number","default":250,"minimum":1,"expression":{"interpolated":true,"parameters":["zoom"]}},"symbol-avoid-edges":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"symbol-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{"type":"enum","values":{"auto":1,"viewport-y":1,"source":1},"default":"auto","expression":{"parameters":["zoom"]}},"symbol-z-elevate":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"symbol-elevation-reference":{"type":"enum","values":{"sea":1,"ground":1,"hd-road-markup":1},"default":"ground","expression":{"parameters":["zoom"]}},"icon-allow-overlap":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"icon-ignore-placement":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"icon-optional":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"icon-rotation-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]}},"icon-size":{"type":"number","default":1,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-size-scale-range":{"type":"array","value":"number","length":2,"default":[0.8,2],"minimum":0.1,"maximum":10,"expression":{}},"icon-text-fit":{"type":"enum","values":{"none":1,"width":1,"height":1,"both":1},"default":"none","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit-padding":{"type":"array","value":"number","length":4,"default":[0,0,0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-image":{"type":"resolvedImage","tokens":true,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{"type":"number","default":0,"period":360,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{"type":"number","default":2,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]}},"icon-keep-upright":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"icon-offset":{"type":"array","value":"number","length":2,"default":[0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{"type":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]}},"text-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]}},"text-rotation-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]}},"text-field":{"type":"formatted","default":"","tokens":true,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-font":{"type":"array","value":"string","default":["Open Sans Regular","Arial Unicode MS Regular"],"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size":{"type":"number","default":16,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size-scale-range":{"type":"array","value":"number","length":2,"default":[0.8,2],"minimum":0.1,"maximum":10,"expression":{}},"text-max-width":{"type":"number","default":10,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{"type":"number","default":1.2,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-letter-spacing":{"type":"number","default":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-justify":{"type":"enum","values":{"auto":1,"left":1,"center":1,"right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{"type":"number","default":0,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["zoom","feature"]}},"text-variable-anchor":{"type":"array","value":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"expression":{"parameters":["zoom"]}},"text-anchor":{"type":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{"type":"number","default":45,"expression":{"interpolated":true,"parameters":["zoom"]}},"text-writing-mode":{"type":"array","value":"enum","values":{"horizontal":1,"vertical":1},"expression":{"parameters":["zoom"]}},"text-rotate":{"type":"number","default":0,"period":360,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-padding":{"type":"number","default":2,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]}},"text-keep-upright":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]}},"text-transform":{"type":"enum","values":{"none":1,"uppercase":1,"lowercase":1},"default":"none","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-offset":{"type":"array","value":"number","length":2,"default":[0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"text-ignore-placement":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"text-optional":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_raster":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_raster-particle":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_hillshade":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"filter":{"type":"array","value":"*"},"filter_symbol":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature","pitch","distance-from-center"]}},"filter_fill":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_hillshade":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_raster":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_raster-particle":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_clip":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_model":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_line":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_circle":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_fill-extrusion":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_building":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_heatmap":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_operator":{"type":"enum","values":{"==":1,"!=":1,">":1,">=":1,"<":1,"<=":1,"in":1,"!in":1,"all":1,"any":1,"none":1,"has":1,"!has":1}},"geometry_type":{"type":"enum","values":{"Point":1,"LineString":1,"Polygon":1}},"function":{"expression":{"type":"expression"},"stops":{"type":"array","value":"function_stop"},"base":{"type":"number","default":1,"minimum":0},"property":{"type":"string","default":"$zoom"},"type":{"type":"enum","values":{"identity":1,"exponential":1,"interval":1,"categorical":1},"default":"exponential"},"colorSpace":{"type":"enum","values":{"rgb":1,"lab":1,"hcl":1},"default":"rgb"},"default":{"type":"*"}},"function_stop":{"type":"array","minimum":0,"maximum":24,"value":["number","color"],"length":2},"expression":{"type":"array","value":"*","minimum":1},"fog":{"range":{"type":"array","default":[0.5,10],"minimum":-20,"maximum":20,"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"high-color":{"type":"color","default":"#245cdf","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"space-color":{"type":"color","default":["interpolate",["linear"],["zoom"],4,"#010b19",7,"#367ab9"],"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"horizon-blend":{"type":"number","default":["interpolate",["linear"],["zoom"],4,0.2,7,0.1],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"star-intensity":{"type":"number","default":["interpolate",["linear"],["zoom"],5,0.35,6,0],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vertical-range":{"type":"array","default":[0,0],"minimum":0,"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}}},"snow":{"density":{"type":"number","default":["interpolate",["linear"],["zoom"],11,0,13,0.85],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette":{"type":"number","default":["interpolate",["linear"],["zoom"],11,0,13,0.3],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette-color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"center-thinning":{"type":"number","default":0.4,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"direction":{"type":"array","default":[0,50],"minimum":0,"maximum":360,"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"flake-size":{"type":"number","default":0.71,"minimum":0,"maximum":5,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true}},"rain":{"density":{"type":"number","default":["interpolate",["linear"],["zoom"],11,0,13,0.5],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"color":{"type":"color","default":["interpolate",["linear"],["measure-light","brightness"],0,"#03113d",0.3,"#a8adbc"],"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"opacity":{"type":"number","default":["interpolate",["linear"],["measure-light","brightness"],0,0.88,1,0.7],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette":{"type":"number","default":["interpolate",["linear"],["zoom"],11,0,13,1],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette-color":{"type":"color","default":["interpolate",["linear"],["measure-light","brightness"],0,"#001736",0.3,"#464646"],"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"center-thinning":{"type":"number","default":0.57,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"direction":{"type":"array","default":[0,80],"minimum":0,"maximum":360,"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"droplet-size":{"type":"array","default":[2.6,18.2],"minimum":0,"maximum":50,"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"distortion-strength":{"type":"number","default":0.7,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true}},"camera":{"camera-projection":{"type":"enum","values":{"perspective":1,"orthographic":1},"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"default":"perspective"}},"colorTheme":{"data":{"type":"string","expression":{}}},"indoor":{"floorplanFeaturesetId":{"type":"string","expression":{}},"buildingFeaturesetId":{"type":"string","expression":{}}},"light":{"anchor":{"type":"enum","default":"viewport","values":{"map":1,"viewport":1},"expression":{"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"use-theme":true,"transition":true},"intensity":{"type":"number","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"projection":{"name":{"type":"enum","values":{"albers":1,"equalEarth":1,"equirectangular":1,"lambertConformalConic":1,"mercator":1,"naturalEarth":1,"winkelTripel":1,"globe":1},"default":"mercator"},"center":{"type":"array","length":2,"value":"number","minimum":[-180,-90],"maximum":[180,90]},"parallels":{"type":"array","length":2,"value":"number","minimum":[-90,-90],"maximum":[90,90]}},"terrain":{"source":{"type":"string"},"exaggeration":{"type":"number","default":1,"minimum":0,"maximum":1000,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"paint":["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_building","paint_symbol","paint_raster","paint_raster-particle","paint_hillshade","paint_background","paint_sky","paint_model"],"paint_fill":{"fill-antialias":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]}},"fill-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-outline-color":{"type":"color","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"fill-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-pattern-cross-fade":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-z-offset":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-bridge-guard-rail-color":{"type":"color","default":"rgba(241, 236, 225, 255)","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature"]},"property-type":"data-driven"},"fill-tunnel-structure-color":{"type":"color","default":"rgba(241, 236, 225, 255)","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature"]},"property-type":"data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-extrusion-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"fill-extrusion-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-extrusion-pattern-cross-fade":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-height":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-height-alignment":{"type":"enum","values":{"terrain":1,"flat":1},"default":"flat"},"fill-extrusion-base-alignment":{"type":"enum","values":{"terrain":1,"flat":1},"default":"terrain"},"fill-extrusion-vertical-gradient":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]}},"fill-extrusion-ambient-occlusion-intensity":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-radius":{"type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-wall-radius":{"type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-ground-radius":{"type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-ground-attenuation":{"type":"number","default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-flood-light-color":{"type":"color","default":"#ffffff","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-flood-light-intensity":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-flood-light-wall-radius":{"property-type":"data-driven","type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"fill-extrusion-flood-light-ground-radius":{"property-type":"data-driven","type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"fill-extrusion-flood-light-ground-attenuation":{"type":"number","default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-vertical-scale":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-rounded-roof":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]}},"fill-extrusion-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{}},"fill-extrusion-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature-state"]},"property-type":"data-driven"},"fill-extrusion-line-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-extrusion-cast-shadows":{"type":"boolean","default":true}},"paint_building":{"building-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"building-ambient-occlusion-wall-intensity":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"building-ambient-occlusion-ground-intensity":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"building-ambient-occlusion-ground-radius":{"type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"building-ambient-occlusion-ground-attenuation":{"type":"number","default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"building-vertical-scale":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"building-cast-shadows":{"type":"boolean","default":true},"building-color":{"type":"color","default":"rgba(193, 154, 127, 1)","use-theme":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]},"property-type":"data-driven"},"building-emissive-strength":{"type":"number","default":0,"minimum":0,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"property-type":"data-driven"}},"paint_line":{"line-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"line-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"line-width":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light","line-progress"]},"property-type":"data-driven"},"line-gap-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-offset":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-dasharray":{"type":"array","value":"number","minimum":0,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-pattern-cross-fade":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"line-gradient":{"type":"color","use-theme":true,"expression":{"interpolated":true,"parameters":["line-progress"]}},"line-trim-offset":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1]},"line-trim-fade-range":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1],"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"line-trim-color":{"type":"color","default":"transparent","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"line-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"line-border-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-border-color":{"type":"color","default":"rgba(0, 0, 0, 0)","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-occlusion-opacity":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"paint_circle":{"circle-radius":{"type":"number","default":5,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-blur":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"circle-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"circle-pitch-scale":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"circle-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1},"default":"viewport","expression":{"parameters":["zoom"]}},"circle-stroke-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-stroke-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-stroke-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}}},"paint_heatmap":{"heatmap-radius":{"type":"number","default":30,"minimum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"heatmap-weight":{"type":"number","default":1,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"heatmap-intensity":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"heatmap-color":{"type":"color","default":["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",0.1,"royalblue",0.3,"cyan",0.5,"lime",0.7,"yellow",1,"red"],"use-theme":true,"expression":{"interpolated":true,"parameters":["heatmap-density"]}},"heatmap-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}}},"paint_symbol":{"icon-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-occlusion-opacity":{"type":"number","minimum":0,"maximum":1,"default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-emissive-strength":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature-state"]},"property-type":"data-driven"},"text-emissive-strength":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature-state"]},"property-type":"data-driven"},"icon-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"icon-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"icon-image-cross-fade":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"text-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-occlusion-opacity":{"type":"number","minimum":0,"maximum":1,"default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"overridable":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"text-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"icon-color-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"expression":{}},"icon-color-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"expression":{}},"icon-color-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{}},"icon-color-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{}},"symbol-z-offset":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"}},"paint_raster":{"raster-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-color":{"type":"color","use-theme":true,"expression":{"interpolated":true,"parameters":["raster-value"]}},"raster-color-mix":{"type":"array","default":[0.2126,0.7152,0.0722,0],"length":4,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-color-range":{"type":"array","length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-hue-rotate":{"type":"number","default":0,"period":360,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-resampling":{"type":"enum","values":{"linear":1,"nearest":1},"default":"linear","expression":{"parameters":["zoom"]}},"raster-fade-duration":{"type":"number","default":300,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"raster-array-band":{"type":"string"},"raster-elevation":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}}},"paint_raster-particle":{"raster-particle-array-band":{"type":"string"},"raster-particle-count":{"type":"number","default":512,"minimum":1},"raster-particle-color":{"type":"color","use-theme":true,"expression":{"interpolated":true,"parameters":["raster-particle-speed"]}},"raster-particle-max-speed":{"type":"number","default":1,"minimum":1},"raster-particle-speed-factor":{"type":"number","default":0.2,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-particle-fade-opacity-factor":{"type":"number","default":0.98,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-particle-reset-rate-factor":{"type":"number","default":0.8,"minimum":0,"maximum":1},"raster-particle-elevation":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}}},"paint_hillshade":{"hillshade-illumination-direction":{"type":"number","default":335,"minimum":0,"maximum":359,"expression":{"interpolated":true,"parameters":["zoom"]}},"hillshade-illumination-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"viewport","expression":{"parameters":["zoom"]}},"hillshade-exaggeration":{"type":"number","default":0.5,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"hillshade-shadow-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"hillshade-highlight-color":{"type":"color","default":"#FFFFFF","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"hillshade-accent-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"hillshade-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}}},"paint_background":{"background-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":[]}},"background-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"background-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom"]}},"background-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"background-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}}},"paint_sky":{"sky-type":{"type":"enum","values":{"gradient":1,"atmosphere":1},"default":"atmosphere","expression":{"parameters":["zoom"]}},"sky-atmosphere-sun":{"type":"array","value":"number","length":2,"minimum":[0,0],"maximum":[360,180],"expression":{"parameters":["zoom"]}},"sky-atmosphere-sun-intensity":{"type":"number","default":10,"minimum":0,"maximum":100},"sky-gradient-center":{"type":"array","value":"number","default":[0,0],"length":2,"minimum":[0,0],"maximum":[360,180],"expression":{"parameters":["zoom"]}},"sky-gradient-radius":{"type":"number","default":90,"minimum":0,"maximum":180,"expression":{"parameters":["zoom"]}},"sky-gradient":{"type":"color","default":["interpolate",["linear"],["sky-radial-progress"],0.8,"#87ceeb",1,"white"],"use-theme":true,"expression":{"interpolated":true,"parameters":["sky-radial-progress"]}},"sky-atmosphere-halo-color":{"type":"color","default":"white","use-theme":true},"sky-atmosphere-color":{"type":"color","default":"white","use-theme":true},"sky-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}}},"paint_model":{"model-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"property-type":"data-driven"},"model-rotation":{"type":"array","value":"number","length":3,"default":[0,0,0],"period":360,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-scale":{"type":"array","value":"number","length":3,"default":[1,1,1],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-translation":{"type":"array","value":"number","length":3,"default":[0,0,0],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-color":{"type":"color","default":"#ffffff","property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light","zoom"]},"use-theme":true,"transition":true},"model-color-mix-intensity":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-type":{"type":"enum","values":{"common-3d":1,"location-indicator":1},"default":"common-3d"},"model-cast-shadows":{"type":"boolean","default":true},"model-receive-shadows":{"type":"boolean","default":true},"model-ambient-occlusion-intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"model-emissive-strength":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":5,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-roughness":{"type":"number","default":1,"minimum":0,"maximum":1,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state"]},"transition":true},"model-height-based-emissive-strength-multiplier":{"type":"array","default":[1,1,1,1,0],"length":5,"value":"number","property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{}},"model-front-cutoff":{"type":"array","value":"number","expression":{"interpolated":true,"parameters":["zoom"]},"length":3,"default":[0,0,1],"minimum":[0,0,0],"maximum":[1,1,1]}},"transition":{"duration":{"type":"number","default":300,"minimum":0},"delay":{"type":"number","default":0,"minimum":0}},"promoteId":{"*":{"type":"*"}}}');function ya(o){return o instanceof Number||o instanceof String||o instanceof Boolean?o.valueOf():o}function am(o){if(Array.isArray(o))return o.map(am);if(o instanceof Object&&!(o instanceof Number||o instanceof String||o instanceof Boolean)){const e={};for(const i in o)e[i]=am(o[i]);return e}return ya(o)}function lm(o){if(o===!0||o===!1)return!0;if(!Array.isArray(o)||o.length===0)return!1;switch(o[0]){case"has":return o.length>=2&&o[1]!=="$id"&&o[1]!=="$type";case"in":return o.length>=3&&(typeof o[1]!="string"||Array.isArray(o[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return o.length!==3||Array.isArray(o[1])||Array.isArray(o[2]);case"any":case"all":for(const e of o.slice(1))if(!lm(e)&&typeof e!="boolean")return!1;return!0;default:return!0}}function K_(o,e="",i=null,c="fill"){if(o==null)return{filter:()=>!0,needGeometry:!1,needFeature:!1};lm(o)||(o=cm(o));const u=o;let p=!0;try{p=function(I){if(!nd(I))return I;let P=am(I);return A0(P),P=C0(P),P}(u)}catch{console.warn(`Failed to extract static filter. Filter will continue working, but at higher memory usage and slower framerate.
This is most likely a bug, please report this via https://github.com/mapbox/mapbox-gl-js/issues/new?assignees=&labels=&template=Bug_report.md
and paste the contents of this message in the report.
Thank you!
Filter Expression:
${JSON.stringify(u,null,2)}
        `)}let m=null,v=null;if(c!=="background"&&c!=="sky"&&c!=="slot"){v=Oe[`filter_${c}`];const I=ul(p,v,e,i);if(I.result==="error")throw new Error(I.value.map(P=>`${P.key}: ${P.message}`).join(", "));m=(P,M,L)=>I.value.evaluate(P,M,{},L)}let S=null,T=null;if(p!==u){const I=ul(u,v,e,i);if(I.result==="error")throw new Error(I.value.map(P=>`${P.key}: ${P.message}`).join(", "));S=(P,M,L,O,G)=>I.value.evaluate(P,M,{},L,void 0,void 0,O,G),T=!Wu(I.value.expression)}return{filter:m,dynamicFilter:S||void 0,needGeometry:I0(p),needFeature:!!T}}function C0(o){if(!Array.isArray(o))return o;const e=function(i){if(uS.has(i[0])){for(let c=1;c<i.length;c++)if(nd(i[c]))return!0}return i}(o);return e===!0?e:e.map(i=>C0(i))}function A0(o){let e=!1;const i=[];if(o[0]==="case"){for(let c=1;c<o.length-1;c+=2)e=e||nd(o[c]),i.push(o[c+1]);i.push(o[o.length-1])}else if(o[0]==="match"){e=e||nd(o[1]);for(let c=2;c<o.length-1;c+=2)i.push(o[c+1]);i.push(o[o.length-1])}else if(o[0]==="step"){e=e||nd(o[1]);for(let c=1;c<o.length-1;c+=2)i.push(o[c+1])}e&&(o.length=0,o.push("any",...i));for(let c=1;c<o.length;c++)A0(o[c])}function nd(o){if(!Array.isArray(o))return!1;if((e=o[0])==="pitch"||e==="distance-from-center")return!0;var e;for(let i=1;i<o.length;i++)if(nd(o[i]))return!0;return!1}const uS=new Set(["in","==","!=",">",">=","<","<=","to-boolean"]);function dS(o,e){return o<e?-1:o>e?1:0}function I0(o){if(!Array.isArray(o))return!1;if(o[0]==="within"||o[0]==="distance")return!0;for(let e=1;e<o.length;e++)if(I0(o[e]))return!0;return!1}function cm(o){if(!o)return!0;const e=o[0];return o.length<=1?e!=="any":e==="=="?Q_(o[1],o[2],"=="):e==="!="?um(Q_(o[1],o[2],"==")):e==="<"||e===">"||e==="<="||e===">="?Q_(o[1],o[2],e):e==="any"?(i=o.slice(1),["any"].concat(i.map(cm))):e==="all"?["all"].concat(o.slice(1).map(cm)):e==="none"?["all"].concat(o.slice(1).map(cm).map(um)):e==="in"?J_(o[1],o.slice(2)):e==="!in"?um(J_(o[1],o.slice(2))):e==="has"?P0(o[1]):e!=="!has"||um(P0(o[1]));var i}function Q_(o,e,i){switch(o){case"$type":return[`filter-type-${i}`,e];case"$id":return[`filter-id-${i}`,e];default:return[`filter-${i}`,o,e]}}function J_(o,e){if(e.length===0)return!1;switch(o){case"$type":return["filter-type-in",["literal",e]];case"$id":return["filter-id-in",["literal",e]];default:return e.length>200&&!e.some(i=>typeof i!=typeof e[0])?["filter-in-large",o,["literal",e.sort(dS)]]:["filter-in-small",o,["literal",e]]}}function P0(o){switch(o){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",o]}}function um(o){return["!",o]}const of="";function su(o,e){return e?`${o}${of}${e}`:o}const ey="-transition",oc=new Set(["fill","line","background","hillshade","raster"]);class Bs extends Gc{constructor(e,i,c,u,p){if(super(),this.id=e.id,this.fqid=su(this.id,c),this.type=e.type,this.scope=c,this.lut=u,this.options=p,this._featureFilter={filter:()=>!0,needGeometry:!1,needFeature:!1},this._filterCompiled=!1,this.configDependencies=new Set,e.type!=="custom"){if(this.metadata=e.metadata,this.minzoom=e.minzoom,this.maxzoom=e.maxzoom,e.type&&e.type!=="background"&&e.type!=="sky"&&e.type!=="slot"){this.source=e.source,this.sourceLayer=e["source-layer"],this.filter=e.filter;const m=ul(this.filter,Oe[`filter_${e.type}`]);m.result!=="error"&&(this.configDependencies=new Set([...this.configDependencies,...m.value.configDependencies]))}if(e.slot&&(this.slot=e.slot),i.layout&&(this._unevaluatedLayout=new cS(i.layout,this.scope,p),this.configDependencies=new Set([...this.configDependencies,...this._unevaluatedLayout.configDependencies])),i.paint){this._transitionablePaint=new S0(i.paint,this.scope,p);for(const m in e.paint)this.setPaintProperty(m,e.paint[m]);for(const m in e.layout)this.setLayoutProperty(m,e.layout[m]);this.configDependencies=new Set([...this.configDependencies,...this._transitionablePaint.configDependencies]),this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new ru(i.paint)}}}onAdd(e){}onRemove(e){}isDraped(e){return!this.is3D(!0)&&oc.has(this.type)}getLayoutProperty(e){return e==="visibility"?this.visibility:this._unevaluatedLayout.getValue(e)}setLayoutProperty(e,i){if(this.type==="custom"&&e==="visibility")return void(this.visibility=i);const c=this._unevaluatedLayout;c._properties.properties[e]&&(c.setValue(e,i),this.configDependencies=new Set([...this.configDependencies,...c.configDependencies]),e==="visibility"&&this.possiblyEvaluateVisibility())}possiblyEvaluateVisibility(){this._unevaluatedLayout._values.visibility&&(this.visibility=this._unevaluatedLayout._values.visibility.possiblyEvaluate({zoom:0}))}getPaintProperty(e){return e.endsWith(ey)?this._transitionablePaint.getTransition(e.slice(0,-11)):this._transitionablePaint.getValue(e)}setPaintProperty(e,i){const c=this._transitionablePaint,u=c._properties.properties;if(e.endsWith(ey)){const P=e.slice(0,-11);return u[P]&&c.setTransition(P,i||void 0),!1}if(!u[e])return!1;const p=c._values[e],m=p.value.isDataDriven(),v=p.value;c.setValue(e,i),this.configDependencies=new Set([...this.configDependencies,...c.configDependencies]),this._handleSpecialPaintPropertyUpdate(e);const S=c._values[e].value,T=S.isDataDriven(),I=e.endsWith("pattern")||e==="line-dasharray";return T||m||I||this._handleOverridablePaintPropertyUpdate(e,v,S)}_handleSpecialPaintPropertyUpdate(e){}getProgramIds(){return null}getDefaultProgramParams(e,i,c){return null}_handleOverridablePaintPropertyUpdate(e,i,c){return!1}isHidden(e){return!!(this.minzoom&&e<this.minzoom)||!!(this.maxzoom&&e>=this.maxzoom)||this.visibility==="none"}updateTransitions(e){this._transitioningPaint=this._transitionablePaint.transitioned(e,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(e,i){this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(e,void 0,i)),this.paint=this._transitioningPaint.possiblyEvaluate(e,void 0,i)}serialize(){return Tn({id:this.id,type:this.type,slot:this.slot,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()},(e,i)=>!(e===void 0||i==="layout"&&!Object.keys(e).length||i==="paint"&&!Object.keys(e).length))}is3D(e){return!1}hasElevation(){return!1}isSky(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}hasShadowPass(){return!1}canCastShadows(){return!1}hasLightBeamPass(){return!1}cutoffRange(){return 0}tileCoverLift(){return 0}resize(){}isStateDependent(){for(const e in this.paint._values){const i=this.paint.get(e);if(i instanceof td&&Qh(i.property.specification)&&(i.value.kind==="source"||i.value.kind==="composite")&&i.value.isStateDependent)return!0}return!1}compileFilter(e){this._filterCompiled||(this._featureFilter=K_(this.filter,this.scope,e),this._filterCompiled=!0)}invalidateCompiledFilter(){this._filterCompiled=!1}dynamicFilter(){return this._featureFilter.dynamicFilter}dynamicFilterNeedsFeature(){return this._featureFilter.needFeature}getLayerRenderingStats(){return this._stats}resetLayerRenderingStats(e){this._stats&&(e.renderPass==="shadow"?this._stats.numRenderedVerticesInShadowPass=0:this._stats.numRenderedVerticesInTransparentPass=0)}queryRadius(e){}queryIntersectsFeature(e,i,c,u,p,m,v,S,T){}}const hS={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class af{constructor(e,i){this._structArray=e,this._pos1=i*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class ui{constructor(){this.capacity=-1,this.resize(0)}static serialize(e,i){return e._trim(),i&&i.add(e.arrayBuffer),{length:e.length,arrayBuffer:e.arrayBuffer}}static deserialize(e){const i=Object.create(this.prototype);return i.arrayBuffer=e.arrayBuffer,i.length=e.length,i.capacity=e.arrayBuffer.byteLength/i.bytesPerElement,i._refreshViews(),i}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(e){this.reserve(e),this.length=e}reserve(e){if(e>this.capacity){this.capacity=Math.max(e,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const i=this.uint8;this._refreshViews(),i&&this.uint8.set(i)}}_refreshViews(){throw new Error("StructArray#_refreshViews() must be implemented by each concrete StructArray layout")}emplace(...e){throw new Error("StructArray#emplace() must be implemented by each concrete StructArray layout")}emplaceBack(...e){throw new Error("StructArray#emplaceBack() must be implemented by each concrete StructArray layout")}destroy(){this.int8=this.uint8=this.int16=this.uint16=this.int32=this.uint32=this.float32=null,this.arrayBuffer=null}}function hr(o,e=1){let i=0,c=0;return{members:o.map(u=>{const p=hS[u.type].BYTES_PER_ELEMENT,m=i=ty(i,Math.max(e,p)),v=u.components||1;return c=Math.max(c,p),i+=p*v,{name:u.name,type:u.type,components:v,offset:m}}),size:ty(i,Math.max(c,e)),alignment:e}}function ty(o,e){return Math.ceil(o/e)*e}class ml extends ui{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i){const c=this.length;return this.resize(c+1),this.emplace(c,e,i)}emplace(e,i,c){const u=2*e;return this.int16[u+0]=i,this.int16[u+1]=c,e}}ml.prototype.bytesPerElement=4,Ht(ml,"StructArrayLayout2i4");class lf extends ui{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,c){const u=this.length;return this.resize(u+1),this.emplace(u,e,i,c)}emplace(e,i,c,u){const p=3*e;return this.int16[p+0]=i,this.int16[p+1]=c,this.int16[p+2]=u,e}}lf.prototype.bytesPerElement=6,Ht(lf,"StructArrayLayout3i6");class rd extends ui{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,c,u){const p=this.length;return this.resize(p+1),this.emplace(p,e,i,c,u)}emplace(e,i,c,u,p){const m=4*e;return this.int16[m+0]=i,this.int16[m+1]=c,this.int16[m+2]=u,this.int16[m+3]=p,e}}rd.prototype.bytesPerElement=8,Ht(rd,"StructArrayLayout4i8");class ac extends ui{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e){const i=this.length;return this.resize(i+1),this.emplace(i,e)}emplace(e,i){return this.float32[1*e+0]=i,e}}ac.prototype.bytesPerElement=4,Ht(ac,"StructArrayLayout1f4");class ny extends ui{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,c){const u=this.length;return this.resize(u+1),this.emplace(u,e,i,c)}emplace(e,i,c,u){const p=4*e,m=2*e;return this.int16[p+0]=i,this.int16[p+1]=c,this.float32[m+1]=u,e}}ny.prototype.bytesPerElement=8,Ht(ny,"StructArrayLayout2i1f8");class dm extends ui{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,c){const u=this.length;return this.resize(u+1),this.emplace(u,e,i,c)}emplace(e,i,c,u){const p=4*e;return this.int16[p+0]=i,this.int16[p+1]=c,this.int16[p+2]=u,e}}dm.prototype.bytesPerElement=8,Ht(dm,"StructArrayLayout3i8");class id extends ui{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,c,u,p){const m=this.length;return this.resize(m+1),this.emplace(m,e,i,c,u,p)}emplace(e,i,c,u,p,m){const v=5*e;return this.int16[v+0]=i,this.int16[v+1]=c,this.int16[v+2]=u,this.int16[v+3]=p,this.int16[v+4]=m,e}}id.prototype.bytesPerElement=10,Ht(id,"StructArrayLayout5i10");class ry extends ui{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,c,u,p,m,v){const S=this.length;return this.resize(S+1),this.emplace(S,e,i,c,u,p,m,v)}emplace(e,i,c,u,p,m,v,S){const T=6*e,I=12*e,P=3*e;return this.int16[T+0]=i,this.int16[T+1]=c,this.uint8[I+4]=u,this.uint8[I+5]=p,this.uint8[I+6]=m,this.uint8[I+7]=v,this.float32[P+2]=S,e}}ry.prototype.bytesPerElement=12,Ht(ry,"StructArrayLayout2i4ub1f12");class ja extends ui{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,c){const u=this.length;return this.resize(u+1),this.emplace(u,e,i,c)}emplace(e,i,c,u){const p=3*e;return this.float32[p+0]=i,this.float32[p+1]=c,this.float32[p+2]=u,e}}ja.prototype.bytesPerElement=12,Ht(ja,"StructArrayLayout3f12");class lc extends ui{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,c,u,p){const m=this.length;return this.resize(m+1),this.emplace(m,e,i,c,u,p)}emplace(e,i,c,u,p,m){const v=6*e,S=3*e;return this.uint16[v+0]=i,this.uint16[v+1]=c,this.uint16[v+2]=u,this.uint16[v+3]=p,this.float32[S+2]=m,e}}lc.prototype.bytesPerElement=12,Ht(lc,"StructArrayLayout4ui1f12");class cf extends ui{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i,c,u){const p=this.length;return this.resize(p+1),this.emplace(p,e,i,c,u)}emplace(e,i,c,u,p){const m=4*e;return this.uint16[m+0]=i,this.uint16[m+1]=c,this.uint16[m+2]=u,this.uint16[m+3]=p,e}}cf.prototype.bytesPerElement=8,Ht(cf,"StructArrayLayout4ui8");class hm extends ui{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,c,u,p,m){const v=this.length;return this.resize(v+1),this.emplace(v,e,i,c,u,p,m)}emplace(e,i,c,u,p,m,v){const S=6*e;return this.int16[S+0]=i,this.int16[S+1]=c,this.int16[S+2]=u,this.int16[S+3]=p,this.int16[S+4]=m,this.int16[S+5]=v,e}}hm.prototype.bytesPerElement=12,Ht(hm,"StructArrayLayout6i12");class sd extends ui{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i,c,u,p,m,v,S,T,I,P,M){const L=this.length;return this.resize(L+1),this.emplace(L,e,i,c,u,p,m,v,S,T,I,P,M)}emplace(e,i,c,u,p,m,v,S,T,I,P,M,L){const O=12*e;return this.int16[O+0]=i,this.int16[O+1]=c,this.int16[O+2]=u,this.int16[O+3]=p,this.uint16[O+4]=m,this.uint16[O+5]=v,this.uint16[O+6]=S,this.uint16[O+7]=T,this.int16[O+8]=I,this.int16[O+9]=P,this.int16[O+10]=M,this.int16[O+11]=L,e}}sd.prototype.bytesPerElement=24,Ht(sd,"StructArrayLayout4i4ui4i24");class od extends ui{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,c,u,p,m){const v=this.length;return this.resize(v+1),this.emplace(v,e,i,c,u,p,m)}emplace(e,i,c,u,p,m,v){const S=10*e,T=5*e;return this.int16[S+0]=i,this.int16[S+1]=c,this.int16[S+2]=u,this.float32[T+2]=p,this.float32[T+3]=m,this.float32[T+4]=v,e}}od.prototype.bytesPerElement=20,Ht(od,"StructArrayLayout3i3f20");class xs extends ui{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,c,u){const p=this.length;return this.resize(p+1),this.emplace(p,e,i,c,u)}emplace(e,i,c,u,p){const m=4*e;return this.float32[m+0]=i,this.float32[m+1]=c,this.float32[m+2]=u,this.float32[m+3]=p,e}}xs.prototype.bytesPerElement=16,Ht(xs,"StructArrayLayout4f16");class ad extends ui{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e){const i=this.length;return this.resize(i+1),this.emplace(i,e)}emplace(e,i){return this.uint32[1*e+0]=i,e}}ad.prototype.bytesPerElement=4,Ht(ad,"StructArrayLayout1ul4");class cc extends ui{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i){const c=this.length;return this.resize(c+1),this.emplace(c,e,i)}emplace(e,i,c){const u=2*e;return this.uint16[u+0]=i,this.uint16[u+1]=c,e}}cc.prototype.bytesPerElement=4,Ht(cc,"StructArrayLayout2ui4");class iy extends ui{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i,c,u,p,m,v,S,T,I,P,M,L){const O=this.length;return this.resize(O+1),this.emplace(O,e,i,c,u,p,m,v,S,T,I,P,M,L)}emplace(e,i,c,u,p,m,v,S,T,I,P,M,L,O){const G=20*e,Z=10*e;return this.int16[G+0]=i,this.int16[G+1]=c,this.int16[G+2]=u,this.int16[G+3]=p,this.int16[G+4]=m,this.float32[Z+3]=v,this.float32[Z+4]=S,this.float32[Z+5]=T,this.float32[Z+6]=I,this.int16[G+14]=P,this.uint32[Z+8]=M,this.uint16[G+18]=L,this.uint16[G+19]=O,e}}iy.prototype.bytesPerElement=40,Ht(iy,"StructArrayLayout5i4f1i1ul2ui40");class fm extends ui{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,c,u,p,m,v){const S=this.length;return this.resize(S+1),this.emplace(S,e,i,c,u,p,m,v)}emplace(e,i,c,u,p,m,v,S){const T=8*e;return this.int16[T+0]=i,this.int16[T+1]=c,this.int16[T+2]=u,this.int16[T+4]=p,this.int16[T+5]=m,this.int16[T+6]=v,this.int16[T+7]=S,e}}fm.prototype.bytesPerElement=16,Ht(fm,"StructArrayLayout3i2i2i16");class sy extends ui{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,c,u,p){const m=this.length;return this.resize(m+1),this.emplace(m,e,i,c,u,p)}emplace(e,i,c,u,p,m){const v=4*e,S=8*e;return this.float32[v+0]=i,this.float32[v+1]=c,this.float32[v+2]=u,this.int16[S+6]=p,this.int16[S+7]=m,e}}sy.prototype.bytesPerElement=16,Ht(sy,"StructArrayLayout2f1f2i16");class uf extends ui{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,c,u,p,m){const v=this.length;return this.resize(v+1),this.emplace(v,e,i,c,u,p,m)}emplace(e,i,c,u,p,m,v){const S=20*e,T=5*e;return this.uint8[S+0]=i,this.uint8[S+1]=c,this.float32[T+1]=u,this.float32[T+2]=p,this.float32[T+3]=m,this.float32[T+4]=v,e}}uf.prototype.bytesPerElement=20,Ht(uf,"StructArrayLayout2ub4f20");class bs extends ui{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i,c){const u=this.length;return this.resize(u+1),this.emplace(u,e,i,c)}emplace(e,i,c,u){const p=3*e;return this.uint16[p+0]=i,this.uint16[p+1]=c,this.uint16[p+2]=u,e}}bs.prototype.bytesPerElement=6,Ht(bs,"StructArrayLayout3ui6");class df extends ui{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e,i,c,u,p,m,v,S,T,I,P,M,L,O,G,Z,Q,le,ce,q,re){const ue=this.length;return this.resize(ue+1),this.emplace(ue,e,i,c,u,p,m,v,S,T,I,P,M,L,O,G,Z,Q,le,ce,q,re)}emplace(e,i,c,u,p,m,v,S,T,I,P,M,L,O,G,Z,Q,le,ce,q,re,ue){const pe=30*e,Ae=15*e,Te=60*e;return this.int16[pe+0]=i,this.int16[pe+1]=c,this.int16[pe+2]=u,this.float32[Ae+2]=p,this.float32[Ae+3]=m,this.uint16[pe+8]=v,this.uint16[pe+9]=S,this.uint32[Ae+5]=T,this.uint32[Ae+6]=I,this.uint32[Ae+7]=P,this.uint16[pe+16]=M,this.uint16[pe+17]=L,this.uint16[pe+18]=O,this.float32[Ae+10]=G,this.float32[Ae+11]=Z,this.uint8[Te+48]=Q,this.uint8[Te+49]=le,this.uint8[Te+50]=ce,this.uint32[Ae+13]=q,this.int16[pe+28]=re,this.uint8[Te+58]=ue,e}}df.prototype.bytesPerElement=60,Ht(df,"StructArrayLayout3i2f2ui3ul3ui2f3ub1ul1i1ub60");class oy extends ui{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e,i,c,u,p,m,v,S,T,I,P,M,L,O,G,Z,Q,le,ce,q,re,ue,pe,Ae,Te,Ie,Ne,Ke,yt,at,_t,xt,et){const pt=this.length;return this.resize(pt+1),this.emplace(pt,e,i,c,u,p,m,v,S,T,I,P,M,L,O,G,Z,Q,le,ce,q,re,ue,pe,Ae,Te,Ie,Ne,Ke,yt,at,_t,xt,et)}emplace(e,i,c,u,p,m,v,S,T,I,P,M,L,O,G,Z,Q,le,ce,q,re,ue,pe,Ae,Te,Ie,Ne,Ke,yt,at,_t,xt,et,pt){const Ze=20*e,Qe=40*e,St=80*e;return this.float32[Ze+0]=i,this.float32[Ze+1]=c,this.int16[Qe+4]=u,this.int16[Qe+5]=p,this.int16[Qe+6]=m,this.int16[Qe+7]=v,this.int16[Qe+8]=S,this.int16[Qe+9]=T,this.int16[Qe+10]=I,this.int16[Qe+11]=P,this.int16[Qe+12]=M,this.uint16[Qe+13]=L,this.uint16[Qe+14]=O,this.uint16[Qe+15]=G,this.uint16[Qe+16]=Z,this.uint16[Qe+17]=Q,this.uint16[Qe+18]=le,this.uint16[Qe+19]=ce,this.uint16[Qe+20]=q,this.uint16[Qe+21]=re,this.uint16[Qe+22]=ue,this.uint16[Qe+23]=pe,this.uint16[Qe+24]=Ae,this.uint16[Qe+25]=Te,this.uint16[Qe+26]=Ie,this.uint16[Qe+27]=Ne,this.uint32[Ze+14]=Ke,this.float32[Ze+15]=yt,this.float32[Ze+16]=at,this.float32[Ze+17]=_t,this.float32[Ze+18]=xt,this.uint8[St+76]=et,this.uint16[Qe+39]=pt,e}}oy.prototype.bytesPerElement=80,Ht(oy,"StructArrayLayout2f9i15ui1ul4f1ub1ui80");class ay extends ui{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,c,u,p,m){const v=this.length;return this.resize(v+1),this.emplace(v,e,i,c,u,p,m)}emplace(e,i,c,u,p,m,v){const S=6*e;return this.float32[S+0]=i,this.float32[S+1]=c,this.float32[S+2]=u,this.float32[S+3]=p,this.float32[S+4]=m,this.float32[S+5]=v,e}}ay.prototype.bytesPerElement=24,Ht(ay,"StructArrayLayout6f24");class uc extends ui{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,c,u,p){const m=this.length;return this.resize(m+1),this.emplace(m,e,i,c,u,p)}emplace(e,i,c,u,p,m){const v=5*e;return this.float32[v+0]=i,this.float32[v+1]=c,this.float32[v+2]=u,this.float32[v+3]=p,this.float32[v+4]=m,e}}uc.prototype.bytesPerElement=20,Ht(uc,"StructArrayLayout5f20");class hf extends ui{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,c,u,p,m,v){const S=this.length;return this.resize(S+1),this.emplace(S,e,i,c,u,p,m,v)}emplace(e,i,c,u,p,m,v,S){const T=7*e;return this.float32[T+0]=i,this.float32[T+1]=c,this.float32[T+2]=u,this.float32[T+3]=p,this.float32[T+4]=m,this.float32[T+5]=v,this.float32[T+6]=S,e}}hf.prototype.bytesPerElement=28,Ht(hf,"StructArrayLayout7f28");class ly extends ui{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,c,u,p,m,v,S,T,I,P){const M=this.length;return this.resize(M+1),this.emplace(M,e,i,c,u,p,m,v,S,T,I,P)}emplace(e,i,c,u,p,m,v,S,T,I,P,M){const L=11*e;return this.float32[L+0]=i,this.float32[L+1]=c,this.float32[L+2]=u,this.float32[L+3]=p,this.float32[L+4]=m,this.float32[L+5]=v,this.float32[L+6]=S,this.float32[L+7]=T,this.float32[L+8]=I,this.float32[L+9]=P,this.float32[L+10]=M,e}}ly.prototype.bytesPerElement=44,Ht(ly,"StructArrayLayout11f44");class pm extends ui{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,c,u,p,m,v,S,T){const I=this.length;return this.resize(I+1),this.emplace(I,e,i,c,u,p,m,v,S,T)}emplace(e,i,c,u,p,m,v,S,T,I){const P=9*e;return this.float32[P+0]=i,this.float32[P+1]=c,this.float32[P+2]=u,this.float32[P+3]=p,this.float32[P+4]=m,this.float32[P+5]=v,this.float32[P+6]=S,this.float32[P+7]=T,this.float32[P+8]=I,e}}pm.prototype.bytesPerElement=36,Ht(pm,"StructArrayLayout9f36");class ou extends ui{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i){const c=this.length;return this.resize(c+1),this.emplace(c,e,i)}emplace(e,i,c){const u=2*e;return this.float32[u+0]=i,this.float32[u+1]=c,e}}ou.prototype.bytesPerElement=8,Ht(ou,"StructArrayLayout2f8");class cy extends ui{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i,c,u){const p=this.length;return this.resize(p+1),this.emplace(p,e,i,c,u)}emplace(e,i,c,u,p){const m=6*e;return this.uint32[3*e+0]=i,this.uint16[m+2]=c,this.uint16[m+3]=u,this.uint16[m+4]=p,e}}cy.prototype.bytesPerElement=12,Ht(cy,"StructArrayLayout1ul3ui12");class ff extends ui{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e){const i=this.length;return this.resize(i+1),this.emplace(i,e)}emplace(e,i){return this.uint16[1*e+0]=i,e}}ff.prototype.bytesPerElement=2,Ht(ff,"StructArrayLayout1ui2");class ld extends ui{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,c,u,p,m,v,S,T,I,P,M,L,O,G,Z){const Q=this.length;return this.resize(Q+1),this.emplace(Q,e,i,c,u,p,m,v,S,T,I,P,M,L,O,G,Z)}emplace(e,i,c,u,p,m,v,S,T,I,P,M,L,O,G,Z,Q){const le=16*e;return this.float32[le+0]=i,this.float32[le+1]=c,this.float32[le+2]=u,this.float32[le+3]=p,this.float32[le+4]=m,this.float32[le+5]=v,this.float32[le+6]=S,this.float32[le+7]=T,this.float32[le+8]=I,this.float32[le+9]=P,this.float32[le+10]=M,this.float32[le+11]=L,this.float32[le+12]=O,this.float32[le+13]=G,this.float32[le+14]=Z,this.float32[le+15]=Q,e}}ld.prototype.bytesPerElement=64,Ht(ld,"StructArrayLayout16f64");class pf extends ui{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,c,u,p,m,v){const S=this.length;return this.resize(S+1),this.emplace(S,e,i,c,u,p,m,v)}emplace(e,i,c,u,p,m,v,S){const T=10*e,I=5*e;return this.uint16[T+0]=i,this.uint16[T+1]=c,this.uint16[T+2]=u,this.uint16[T+3]=p,this.float32[I+2]=m,this.float32[I+3]=v,this.float32[I+4]=S,e}}pf.prototype.bytesPerElement=20,Ht(pf,"StructArrayLayout4ui3f20");class uy extends ui{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e){const i=this.length;return this.resize(i+1),this.emplace(i,e)}emplace(e,i){return this.int16[1*e+0]=i,e}}uy.prototype.bytesPerElement=2,Ht(uy,"StructArrayLayout1i2");class mm extends ui{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer)}emplaceBack(e){const i=this.length;return this.resize(i+1),this.emplace(i,e)}emplace(e,i){return this.uint8[1*e+0]=i,e}}mm.prototype.bytesPerElement=1,Ht(mm,"StructArrayLayout1ub1");class M0 extends af{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.int16[this._pos2+3]}get tileAnchorY(){return this._structArray.int16[this._pos2+4]}get x1(){return this._structArray.float32[this._pos4+3]}get y1(){return this._structArray.float32[this._pos4+4]}get x2(){return this._structArray.float32[this._pos4+5]}get y2(){return this._structArray.float32[this._pos4+6]}get padding(){return this._structArray.int16[this._pos2+14]}get featureIndex(){return this._structArray.uint32[this._pos4+8]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+18]}get bucketIndex(){return this._structArray.uint16[this._pos2+19]}}M0.prototype.size=40;class gm extends iy{get(e){return new M0(this,e)}}Ht(gm,"CollisionBoxArray");class R0 extends af{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+8]}get numGlyphs(){return this._structArray.uint16[this._pos2+9]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+5]}get lineStartIndex(){return this._structArray.uint32[this._pos4+6]}get lineLength(){return this._structArray.uint32[this._pos4+7]}get segment(){return this._structArray.uint16[this._pos2+16]}get lowerSize(){return this._structArray.uint16[this._pos2+17]}get upperSize(){return this._structArray.uint16[this._pos2+18]}get lineOffsetX(){return this._structArray.float32[this._pos4+10]}get lineOffsetY(){return this._structArray.float32[this._pos4+11]}get writingMode(){return this._structArray.uint8[this._pos1+48]}get placedOrientation(){return this._structArray.uint8[this._pos1+49]}set placedOrientation(e){this._structArray.uint8[this._pos1+49]=e}get hidden(){return this._structArray.uint8[this._pos1+50]}set hidden(e){this._structArray.uint8[this._pos1+50]=e}get crossTileID(){return this._structArray.uint32[this._pos4+13]}set crossTileID(e){this._structArray.uint32[this._pos4+13]=e}get associatedIconIndex(){return this._structArray.int16[this._pos2+28]}get flipState(){return this._structArray.uint8[this._pos1+58]}set flipState(e){this._structArray.uint8[this._pos1+58]=e}}R0.prototype.size=60;class k0 extends df{get(e){return new R0(this,e)}}Ht(k0,"PlacedSymbolArray");class D0 extends af{get tileAnchorX(){return this._structArray.float32[this._pos4+0]}get tileAnchorY(){return this._structArray.float32[this._pos4+1]}get projectedAnchorX(){return this._structArray.int16[this._pos2+4]}get projectedAnchorY(){return this._structArray.int16[this._pos2+5]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+6]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+7]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+8]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+9]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+10]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+11]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+12]}get key(){return this._structArray.uint16[this._pos2+13]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+14]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+15]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+16]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+17]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+18]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+19]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+20]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+21]}get featureIndex(){return this._structArray.uint16[this._pos2+22]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+23]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+24]}get numIconVertices(){return this._structArray.uint16[this._pos2+25]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+26]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+27]}get crossTileID(){return this._structArray.uint32[this._pos4+14]}set crossTileID(e){this._structArray.uint32[this._pos4+14]=e}get textOffset0(){return this._structArray.float32[this._pos4+15]}get textOffset1(){return this._structArray.float32[this._pos4+16]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+17]}get zOffset(){return this._structArray.float32[this._pos4+18]}set zOffset(e){this._structArray.float32[this._pos4+18]=e}get hasIconTextFit(){return this._structArray.uint8[this._pos1+76]}get elevationFeatureIndex(){return this._structArray.uint16[this._pos2+39]}}D0.prototype.size=80;class L0 extends oy{get(e){return new D0(this,e)}}Ht(L0,"SymbolInstanceArray");class dy extends ac{getoffsetX(e){return this.float32[1*e+0]}}Ht(dy,"GlyphOffsetArray");class N0 extends ml{getx(e){return this.int16[2*e+0]}gety(e){return this.int16[2*e+1]}}Ht(N0,"SymbolLineVertexArray");class z0 extends af{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}get layoutVertexArrayOffset(){return this._structArray.uint16[this._pos2+4]}}z0.prototype.size=12;class O0 extends cy{get(e){return new z0(this,e)}}Ht(O0,"FeatureIndexArray");class F0 extends cc{geta_centroid_pos0(e){return this.uint16[2*e+0]}geta_centroid_pos1(e){return this.uint16[2*e+1]}}Ht(F0,"FillExtrusionCentroidArray");class j0 extends af{get a_join_normal_inside0(){return this._structArray.int16[this._pos2+0]}get a_join_normal_inside1(){return this._structArray.int16[this._pos2+1]}get a_join_normal_inside2(){return this._structArray.int16[this._pos2+2]}}j0.prototype.size=6;class B0 extends lf{get(e){return new j0(this,e)}}Ht(B0,"FillExtrusionWallArray");const fS=hr([{name:"a_pos",components:2,type:"Int16"}],4),pS=hr([{name:"a_circle_z_offset",components:1,type:"Float32"}],4),_m=hr([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]);class Ai{constructor(e=[]){this.segments=e}_prepareSegment(e,i,c,u){let p=this.segments[this.segments.length-1];return e>Ai.MAX_VERTEX_ARRAY_LENGTH&&On(`Max vertices per segment is ${Ai.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${e}`),(!p||p.vertexLength+e>Ai.MAX_VERTEX_ARRAY_LENGTH||p.sortKey!==u)&&(p={vertexOffset:i,primitiveOffset:c,vertexLength:0,primitiveLength:0},u!==void 0&&(p.sortKey=u),this.segments.push(p)),p}prepareSegment(e,i,c,u){return this._prepareSegment(e,i.length,c.length,u)}get(){return this.segments}destroy(){for(const e of this.segments)for(const i in e.vaos)e.vaos[i].destroy()}static simpleSegment(e,i,c,u){return new Ai([{vertexOffset:e,primitiveOffset:i,vertexLength:c,primitiveLength:u,vaos:{},sortKey:0}])}}function V0(o,e){return 256*(o=xe(Math.floor(o),0,255))+xe(Math.floor(e),0,255)}Ai.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,Ht(Ai,"SegmentVector");const ym=hr([{name:"a_pattern",components:4,type:"Uint16"},{name:"a_pixel_ratio",components:1,type:"Float32"}]),hy=hr([{name:"a_pattern_b",components:4,type:"Uint16"}]),U0=hr([{name:"a_dash",components:4,type:"Uint16"}]);class mf{constructor(){this.ids=[],this.uniqueIds=[],this.positions=[],this.indexed=!1}add(e,i,c,u){this.ids.push(fy(e)),this.positions.push(i,c,u)}eachPosition(e,i){const c=fy(e);let u=0,p=this.ids.length-1;for(;u<p;){const m=u+p>>1;this.ids[m]>=c?p=m:u=m+1}for(;this.ids[u]===c;)i(this.positions[3*u],this.positions[3*u+1],this.positions[3*u+2]),u++}static serialize(e,i){const c=new Float64Array(e.ids),u=new Uint32Array(e.positions);return vm(c,u,0,c.length-1),i&&(i.add(c.buffer),i.add(u.buffer)),{ids:c,positions:u}}static deserialize(e){const i=new mf;let c;i.ids=e.ids,i.positions=e.positions;for(const u of i.ids)u!==c&&i.uniqueIds.push(u),c=u;return i.indexed=!0,i}}function fy(o){const e=+o;return!isNaN(e)&&Number.MIN_SAFE_INTEGER<=e&&e<=Number.MAX_SAFE_INTEGER?e:zh(String(o))}function vm(o,e,i,c){for(;i<c;){const u=o[i+c>>1];let p=i-1,m=c+1;for(;;){do p++;while(o[p]<u);do m--;while(o[m]>u);if(p>=m)break;gf(o,p,m),gf(e,3*p,3*m),gf(e,3*p+1,3*m+1),gf(e,3*p+2,3*m+2)}m-i<c-m?(vm(o,e,i,m),i=m+1):(vm(o,e,m+1,c),c=m)}}function gf(o,e,i){const c=o[e];o[e]=o[i],o[i]=c}Ht(mf,"FeaturePositionMap");class gl{constructor(e){this.gl=e.gl,this.initialized=!1}fetchUniformLocation(e,i){return this.location||this.initialized||(this.location=this.gl.getUniformLocation(e,i),this.initialized=!0),!!this.location}set(e,i,c){throw new Error("Uniform#set() must be implemented by each concrete Uniform")}}class xm extends gl{constructor(e){super(e),this.current=0}set(e,i,c){this.fetchUniformLocation(e,i)&&this.current!==c&&(this.current=c,this.gl.uniform1i(this.location,c))}}class ji extends gl{constructor(e){super(e),this.current=0}set(e,i,c){this.fetchUniformLocation(e,i)&&this.current!==c&&(this.current=c,this.gl.uniform1f(this.location,c))}}class Ba extends gl{constructor(e){super(e),this.current=[0,0]}set(e,i,c){this.fetchUniformLocation(e,i)&&(c[0]===this.current[0]&&c[1]===this.current[1]||(this.current=c,this.gl.uniform2f(this.location,c[0],c[1])))}}class _f extends gl{constructor(e){super(e),this.current=[0,0,0]}set(e,i,c){this.fetchUniformLocation(e,i)&&(c[0]===this.current[0]&&c[1]===this.current[1]&&c[2]===this.current[2]||(this.current=c,this.gl.uniform3f(this.location,c[0],c[1],c[2])))}}class bm extends gl{constructor(e){super(e),this.current=[0,0,0,0]}set(e,i,c){this.fetchUniformLocation(e,i)&&(c[0]===this.current[0]&&c[1]===this.current[1]&&c[2]===this.current[2]&&c[3]===this.current[3]||(this.current=c,this.gl.uniform4f(this.location,c[0],c[1],c[2],c[3])))}}class $0 extends gl{constructor(e){super(e),this.current=Er.transparent.toPremultipliedRenderColor(null)}set(e,i,c){this.fetchUniformLocation(e,i)&&(c.r===this.current.r&&c.g===this.current.g&&c.b===this.current.b&&c.a===this.current.a||(this.current=c,this.gl.uniform4f(this.location,c.r,c.g,c.b,c.a)))}}const mS=new Float32Array(16);class cd extends gl{constructor(e){super(e),this.current=mS}set(e,i,c){if(this.fetchUniformLocation(e,i)){if(c[12]!==this.current[12]||c[0]!==this.current[0])return this.current=c,void this.gl.uniformMatrix4fv(this.location,!1,c);for(let u=1;u<16;u++)if(c[u]!==this.current[u]){this.current=c,this.gl.uniformMatrix4fv(this.location,!1,c);break}}}}const py=new Float32Array(9),Va=new Float32Array(4);class yf extends gl{constructor(e){super(e),this.current=Va}set(e,i,c){if(this.fetchUniformLocation(e,i)){for(let u=0;u<4;u++)if(c[u]!==this.current[u]){this.current=c,this.gl.uniformMatrix2fv(this.location,!1,c);break}}}}function my(o){return[V0(255*o.r,255*o.g),V0(255*o.b,255*o.a)]}class vf{constructor(e,i,c,u){this.value=e,this.uniformNames=i.map(p=>`u_${p}`),this.type=c,this.context=u}setUniform(e,i,c,u,p){const m=u.constantOr(this.value);i.set(e,p,m instanceof Er?m.toPremultipliedRenderColor(this.lutExpression&&this.lutExpression.value==="none"?null:this.context.lut):m)}getBinding(e,i){return this.type==="color"?new $0(e):new ji(e)}}class ud{constructor(e,i){this.uniformNames=i.map(c=>`u_${c}`),this.pattern=null,this.patternTransition=null,this.pixelRatio=1}setConstantPatternPositions(e,i){this.pixelRatio=e.pixelRatio||1,this.pattern=e.tl.concat(e.br),this.patternTransition=i?i.tl.concat(i.br):this.pattern}setUniform(e,i,c,u,p){let m=null;p!=="u_pattern"&&p!=="u_dash"||(m=this.pattern),p==="u_pattern_b"&&(m=this.patternTransition),p==="u_pixel_ratio"&&(m=this.pixelRatio),m&&i.set(e,p,m)}getBinding(e,i){return i==="u_pattern"||i==="u_pattern_b"||i==="u_dash"?new bm(e):new ji(e)}}class _l{constructor(e,i,c,u){this.expression=e,this.type=c,this.maxValue=0,this.paintVertexAttributes=i.map(p=>({name:`a_${p}`,type:"Float32",components:c==="color"?2:1,offset:0})),this.paintVertexArray=new u}populatePaintArray(e,i,c,u,p,m,v,S){const T=this.paintVertexArray.length,I=this.expression.kind==="composite"||this.expression.kind==="source"?this.expression.evaluate(new Fr(0,{brightness:m,worldview:S}),i,{},p,u,v):this.expression.kind==="constant"&&this.expression.value,P=!!this.lutExpression&&(this.lutExpression.kind==="composite"||this.lutExpression.kind==="source"?this.lutExpression.evaluate(new Fr(0,{brightness:m,worldview:S}),i,{},p,u,v):this.lutExpression.value)==="none";this.paintVertexArray.resize(e),this._setPaintValue(T,e,I,P?null:this.context.lut)}updatePaintArray(e,i,c,u,p,m,v,S){const T=this.expression.kind==="composite"||this.expression.kind==="source"?this.expression.evaluate({zoom:0,brightness:v,worldview:S},c,u,void 0,p):this.expression.kind==="constant"&&this.expression.value,I=!!this.lutExpression&&(this.lutExpression.kind==="composite"||this.lutExpression.kind==="source"?this.lutExpression.evaluate(new Fr(0,{brightness:v,worldview:S}),c,u,void 0,p):this.lutExpression.value)==="none";this._setPaintValue(e,i,T,I?null:this.context.lut)}_setPaintValue(e,i,c,u){if(this.type==="color"){const p=my(c.toPremultipliedRenderColor(u));for(let m=e;m<i;m++)this.paintVertexArray.emplace(m,p[0],p[1])}else{for(let p=e;p<i;p++)this.paintVertexArray.emplace(p,c);this.maxValue=Math.max(this.maxValue,Math.abs(c))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.lutExpression&&this.lutExpression.kind!=="constant"&&(this.lutExpression.isStateDependent||!this.lutExpression.isLightConstant)||this.expression.kind!=="constant"&&(this.expression.isStateDependent||!this.expression.isLightConstant)))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class va{constructor(e,i,c,u,p,m){this.expression=e,this.uniformNames=i.map(v=>`u_${v}_t`),this.type=c,this.useIntegerZoom=u,this.context=p,this.maxValue=0,this.paintVertexAttributes=i.map(v=>({name:`a_${v}`,type:"Float32",components:c==="color"?4:2,offset:0})),this.paintVertexArray=new m}populatePaintArray(e,i,c,u,p,m,v,S){const T=this.expression.evaluate(new Fr(this.context.zoom,{brightness:m,worldview:S}),i,{},p,u,v),I=this.expression.evaluate(new Fr(this.context.zoom+1,{brightness:m,worldview:S}),i,{},p,u,v),P=!!this.lutExpression&&(this.lutExpression.kind==="composite"||this.lutExpression.kind==="source"?this.lutExpression.evaluate(new Fr(0,{brightness:m,worldview:S}),i,{},p,u,v):this.lutExpression.value)==="none",M=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValue(M,e,T,I,P?null:this.context.lut)}updatePaintArray(e,i,c,u,p,m,v,S){const T=this.expression.evaluate({zoom:this.context.zoom,brightness:v,worldview:S},c,u,void 0,p),I=this.expression.evaluate({zoom:this.context.zoom+1,brightness:v,worldview:S},c,u,void 0,p),P=!!this.lutExpression&&(this.lutExpression.kind==="composite"||this.lutExpression.kind==="source"?this.lutExpression.evaluate(new Fr(0,{brightness:v,worldview:S}),c,u,void 0,p):this.lutExpression.value)==="none";this._setPaintValue(e,i,T,I,P?null:this.context.lut)}_setPaintValue(e,i,c,u,p){if(this.type==="color"){const m=my(c.toPremultipliedRenderColor(p)),v=my(c.toPremultipliedRenderColor(p));for(let S=e;S<i;S++)this.paintVertexArray.emplace(S,m[0],m[1],v[0],v[1])}else{for(let m=e;m<i;m++)this.paintVertexArray.emplace(m,c,u);this.maxValue=Math.max(this.maxValue,Math.abs(c),Math.abs(u))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent||!this.expression.isLightConstant))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(e,i,c,u,p){const m=this.useIntegerZoom?Math.floor(c.zoom):c.zoom,v=xe(this.expression.interpolationFactor(m,this.context.zoom,this.context.zoom+1),0,1);i.set(e,p,v)}getBinding(e,i){return new ji(e)}}class na{constructor(e,i,c,u,p){this.expression=e,this.layerId=p,this.paintVertexAttributes=(c==="array"?U0:ym).members;for(let m=0;m<i.length;++m);this.paintVertexArray=new u,this.paintTransitionVertexArray=new cf}populatePaintArray(e,i,c,u){const p=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValues(p,e,i.patterns&&i.patterns[this.layerId],c)}updatePaintArray(e,i,c,u,p,m,v){this._setPaintValues(e,i,c.patterns&&c.patterns[this.layerId],m)}_setPaintValues(e,i,c,u){if(!u||!c)return;const p=u[c[0]],m=u[c[1]];if(p){if(p){const{tl:v,br:S,pixelRatio:T}=p;for(let I=e;I<i;I++)this.paintVertexArray.emplace(I,v[0],v[1],S[0],S[1],T)}if(m){this.paintTransitionVertexArray.resize(this.paintVertexArray.length);const{tl:v,br:S}=m;for(let T=e;T<i;T++)this.paintTransitionVertexArray.emplace(T,v[0],v[1],S[0],S[1])}}}upload(e){const i=this.expression.isStateDependent||!this.expression.isLightConstant;this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,i)),this.paintTransitionVertexArray&&this.paintTransitionVertexArray.length&&(this.paintTransitionVertexBuffer=e.createVertexBuffer(this.paintTransitionVertexArray,hy.members,i))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy(),this.paintTransitionVertexBuffer&&this.paintTransitionVertexBuffer.destroy()}}class dd{constructor(e,i,c=()=>!0){this.binders={},this._buffers=[],this.context=i;const u=[];for(const p in e.paint._values){const m=e.paint.get(p);if(p.endsWith("-use-theme")||!c(p)||!(m instanceof td&&Qh(m.property.specification)))continue;const v=a(p,e.type),S=m.value,T=m.property.specification.type,I=!!m.property.useIntegerZoom,P=p==="line-dasharray"||p.endsWith("pattern"),M=e.paint.get(`${p}-use-theme`),L=p==="line-dasharray"&&e.layout.get("line-cap").value.kind!=="constant"||M&&M.value.kind!=="constant";if(S.kind!=="constant"||L)if(S.kind==="source"||L||P){const O=y(p,T,"source");this.binders[p]=P?new na(S,v,T,O,e.id):new _l(S,v,T,O),u.push(`/a_${p}`)}else{const O=y(p,T,"composite");this.binders[p]=new va(S,v,T,I,i,O),u.push(`/z_${p}`)}else this.binders[p]=P?new ud(S.value,v):new vf(S.value,v,T,i),u.push(`/u_${p}`);M&&(this.binders[p].lutExpression=M.value)}this.cacheKey=u.sort().join("")}getMaxValue(e){const i=this.binders[e];return i instanceof _l||i instanceof va?i.maxValue:0}populatePaintArrays(e,i,c,u,p,m,v,S){for(const T in this.binders){const I=this.binders[T];I.context=this.context,(I instanceof _l||I instanceof va||I instanceof na)&&I.populatePaintArray(e,i,c,u,p,m,v,S)}}setConstantPatternPositions(e,i){for(const c in this.binders){const u=this.binders[c];u instanceof ud&&u.setConstantPatternPositions(e,i)}}getPatternTransitionVertexBuffer(e){const i=this.binders[e];return i instanceof na?i.paintTransitionVertexBuffer:null}updatePaintArrays(e,i,c,u,p,m,v,S,T,I){let P=!1;const M=Object.keys(e),L=M.length!==0&&!S,O=L?M:i.uniqueIds;this.context.lut=p.lut;for(const G in this.binders){const Z=this.binders[G];if(Z.context=this.context,(Z instanceof _l||Z instanceof va||Z instanceof na)&&Z.expression&&Z.expression.kind&&Z.expression.kind!=="constant"&&(Z.expression.isStateDependent===!0||Z.expression.isLightConstant===!1)){const Q=p.paint.get(G);Z.expression=Q.value;for(const le of O){const ce=e[le.toString()];i.eachPosition(le,(q,re,ue)=>{const pe=u.feature(q);Z.updatePaintArray(re,ue,pe,ce,m,v,T,I)})}if(!L)for(const le of c.uniqueIds){const ce=e[le.toString()];c.eachPosition(le,(q,re,ue)=>{const pe=u.feature(q);Z.updatePaintArray(re,ue,pe,ce,m,v,T,I)})}P=!0}}return P}defines(){const e=[];for(const i in this.binders){const c=this.binders[i];(c instanceof vf||c instanceof ud)&&e.push(...c.uniformNames.map(u=>`#define HAS_UNIFORM_${u}`))}return e}getBinderAttributes(){const e=[];for(const i in this.binders){const c=this.binders[i];if(c instanceof _l||c instanceof va||c instanceof na)for(let u=0;u<c.paintVertexAttributes.length;u++)e.push(c.paintVertexAttributes[u].name);if(c instanceof na)for(let u=0;u<hy.members.length;u++)e.push(hy.members[u].name)}return e}getBinderUniforms(){const e=[];for(const i in this.binders){const c=this.binders[i];if(c instanceof vf||c instanceof ud||c instanceof va)for(const u of c.uniformNames)e.push(u)}return e}getPaintVertexBuffers(){return this._buffers}getUniforms(e){const i=[];for(const c in this.binders){const u=this.binders[c];if(u instanceof vf||u instanceof ud||u instanceof va)for(const p of u.uniformNames)i.push({name:p,property:c,binding:u.getBinding(e,p)})}return i}setUniforms(e,i,c,u,p){for(const{name:m,property:v,binding:S}of c)this.binders[v].setUniform(e,S,p,u.get(v),m)}updatePaintBuffers(){this._buffers=[];for(const e in this.binders){const i=this.binders[e];(i instanceof _l||i instanceof va||i instanceof na)&&i.paintVertexBuffer&&this._buffers.push(i.paintVertexBuffer),i instanceof na&&i.paintTransitionVertexBuffer&&this._buffers.push(i.paintTransitionVertexBuffer)}}upload(e){for(const i in this.binders){const c=this.binders[i];(c instanceof _l||c instanceof va||c instanceof na)&&c.upload(e)}this.updatePaintBuffers()}destroy(){for(const e in this.binders){const i=this.binders[e];(i instanceof _l||i instanceof va||i instanceof na)&&i.destroy()}}}class h{constructor(e,i,c=()=>!0){this.programConfigurations={};for(const u of e)this.programConfigurations[u.id]=new dd(u,i,c);this.needsUpload=!1,this._featureMap=new mf,this._featureMapWithoutIds=new mf,this._bufferOffset=0,this._idlessCounter=0}populatePaintArrays(e,i,c,u,p,m,v,S,T){for(const I in this.programConfigurations)this.programConfigurations[I].populatePaintArrays(e,i,u,p,m,v,S,T);i.id!==void 0?this._featureMap.add(i.id,c,this._bufferOffset,e):(this._featureMapWithoutIds.add(this._idlessCounter,c,this._bufferOffset,e),this._idlessCounter+=1),this._bufferOffset=e,this.needsUpload=!0}updatePaintArrays(e,i,c,u,p,m,v,S){for(const T of c)this.needsUpload=this.programConfigurations[T.id].updatePaintArrays(e,this._featureMap,this._featureMapWithoutIds,i,T,u,p,m,v||0,S)||this.needsUpload}get(e){return this.programConfigurations[e]}upload(e){if(this.needsUpload){for(const i in this.programConfigurations)this.programConfigurations[i].upload(e);this.needsUpload=!1}}destroy(){for(const e in this.programConfigurations)this.programConfigurations[e].destroy()}}const n={"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-occlusion-opacity":["occlusion_opacity"],"icon-occlusion-opacity":["occlusion_opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-emissive-strength":["emissive_strength"],"icon-emissive-strength":["emissive_strength"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"symbol-z-offset":["z_offset"],"line-gap-width":["gapwidth"],"line-pattern":["pattern","pixel_ratio","pattern_b"],"fill-pattern":["pattern","pixel_ratio","pattern_b"],"fill-extrusion-pattern":["pattern","pixel_ratio","pattern_b"],"line-dasharray":["dash"],"fill-bridge-guard-rail-color":["structure_color"],"fill-tunnel-structure-color":["structure_color"]};function a(o,e){return n[o]||[o.replace(`${e}-`,"").replace(/-/g,"_")]}const f={"line-pattern":{source:lc,composite:lc},"fill-pattern":{source:lc,composite:lc},"fill-extrusion-pattern":{source:lc,composite:lc},"line-dasharray":{source:cf,composite:cf}},g={color:{source:ou,composite:xs},number:{source:ac,composite:ou}};function y(o,e,i){const c=f[o];return c&&c[i]||g[e][i]}Ht(vf,"ConstantBinder"),Ht(ud,"PatternConstantBinder"),Ht(_l,"SourceExpressionBinder"),Ht(na,"PatternCompositeBinder"),Ht(va,"CompositeExpressionBinder"),Ht(dd,"ProgramConfiguration",{omit:["_buffers"]}),Ht(h,"ProgramConfigurationSet");const b=Lt/Math.PI/2,E=5,A=6,R=16383,D=64,F=[D,32,16],N=-b,j=b;function X(o,e,i,c=b){return i=mr(i),[o*Math.sin(i)*c,-e*c,o*Math.cos(i)*c]}function W(o,e,i){return X(Math.cos(mr(o)),Math.sin(mr(o)),e,i)}const K=63710088e-1,ee=2*Math.PI*K;class ie{constructor(e,i){if(isNaN(e)||isNaN(i))throw new Error(`Invalid LngLat object: (${e}, ${i})`);if(this.lng=+e,this.lat=+i,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new ie(Ue(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(e){const i=Math.PI/180,c=this.lat*i,u=e.lat*i,p=Math.sin(c)*Math.sin(u)+Math.cos(c)*Math.cos(u)*Math.cos((e.lng-this.lng)*i);return K*Math.acos(Math.min(p,1))}toBounds(e=0){const i=360*e/40075017,c=i/Math.cos(Math.PI/180*this.lat);return new fe({lng:this.lng-c,lat:this.lat-i},{lng:this.lng+c,lat:this.lat+i})}toEcef(e){return W(this.lat,this.lng,b+e*b/K)}static convert(e){if(e instanceof ie)return e;if(Array.isArray(e)&&(e.length===2||e.length===3))return new ie(Number(e[0]),Number(e[1]));if(!Array.isArray(e)&&typeof e=="object"&&e!==null)return new ie(Number("lng"in e?e.lng:e.lon),Number(e.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}class fe{constructor(e,i){if(e)if(i)this.setSouthWest(e).setNorthEast(i);else if(e.length===4){const c=e;this.setSouthWest([c[0],c[1]]).setNorthEast([c[2],c[3]])}else{const c=e;this.setSouthWest(c[0]).setNorthEast(c[1])}}setNorthEast(e){return this._ne=e instanceof ie?new ie(e.lng,e.lat):ie.convert(e),this}setSouthWest(e){return this._sw=e instanceof ie?new ie(e.lng,e.lat):ie.convert(e),this}extend(e){const i=this._sw,c=this._ne;let u,p;if(e instanceof ie)u=e,p=e;else{if(!(e instanceof fe))return Array.isArray(e)?e.length===4||e.every(Array.isArray)?this.extend(fe.convert(e)):this.extend(ie.convert(e)):typeof e=="object"&&e!==null&&e.hasOwnProperty("lat")&&(e.hasOwnProperty("lon")||e.hasOwnProperty("lng"))?this.extend(ie.convert(e)):this;if(u=e._sw,p=e._ne,!u||!p)return this}return i||c?(i.lng=Math.min(u.lng,i.lng),i.lat=Math.min(u.lat,i.lat),c.lng=Math.max(p.lng,c.lng),c.lat=Math.max(p.lat,c.lat)):(this._sw=new ie(u.lng,u.lat),this._ne=new ie(p.lng,p.lat)),this}getCenter(){return new ie((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new ie(this.getWest(),this.getNorth())}getSouthEast(){return new ie(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(e){const{lng:i,lat:c}=ie.convert(e);let u=this._sw.lng<=i&&i<=this._ne.lng;return this._sw.lng>this._ne.lng&&(u=this._sw.lng>=i&&i>=this._ne.lng),this._sw.lat<=c&&c<=this._ne.lat&&u}static convert(e){if(e)return e instanceof fe?e:new fe(e)}}const _e=0,we=25.5;function be(o){return ee*Math.cos(o*Math.PI/180)}function ve(o){return(180+o)/360}function ye(o){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+o*Math.PI/360)))/360}function Se(o,e){return o/be(e)}function Ee(o){return 360*o-180}function Fe(o){return 360/Math.PI*Math.atan(Math.exp((180-360*o)*Math.PI/180))-90}function je(o,e){return o*be(Fe(e))}const rt=85.051129;function it(o){return Math.cos(mr(xe(o,-85.051129,rt)))}function gt(o,e){const i=xe(e,_e,we),c=Math.pow(2,i);return it(o)*ee/(512*c)}function ze(o){return 1/Math.cos(o*Math.PI/180)}function Xe(o,e=0){const i=Math.exp(Math.PI*(1-(o.y+e/Lt)/(1<<o.z)*2));return 80150034*i/(i*i+1)/Lt/(1<<o.z)}class Re{constructor(e,i,c=0){this.x=+e,this.y=+i,this.z=+c}static fromLngLat(e,i=0){const c=ie.convert(e);return new Re(ve(c.lng),ye(c.lat),Se(i,c.lat))}toLngLat(){return new ie(Ee(this.x),Fe(this.y))}toAltitude(){return je(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/ee*ze(Fe(this.y))}}function ot(o,e,i,c,u,p,m,v,S){const T=(e+c)/2,I=(i+u)/2,P=new Dt(T,I);v(P),function(M,L,O,G,Z,Q){const le=O-Z,ce=G-Q;return Math.abs((G-L)*le-(O-M)*ce)/Math.hypot(le,ce)}(P.x,P.y,p.x,p.y,m.x,m.y)>=S?(ot(o,e,i,T,I,p,P,v,S),ot(o,T,I,c,u,P,m,v,S)):o.push(m)}function Ge(o,e,i){let c=o[0],u=c.x,p=c.y;e(c);const m=[c];for(let v=1;v<o.length;v++){const S=o[v],{x:T,y:I}=S;e(S),ot(m,u,p,T,I,c,S,e,i),u=T,p=I,c=S}return m}function dt(o,e,i,c){if(c(e,i)){const u=e.add(i)._mult(.5);dt(o,e,u,c),dt(o,u,i,c)}else o.push(i)}function At(o,e){let i=o[0];const c=[i];for(let u=1;u<o.length;u++){const p=o[u];dt(c,i,p,e),i=p}return c}const st=Math.pow(2,14)-1,Tt=-st-1;function qt(o,e){const i=Math.round(o.x*e),c=Math.round(o.y*e);return o.x=xe(i,Tt,st),o.y=xe(c,Tt,st),(i<o.x||i>o.x+1||c<o.y||c>o.y+1)&&On("Geometry exceeds allowed extent, reduce your vector tile buffer size"),o}function Wt(o,e,i){const c=o.loadGeometry(),u=o.extent,p=Lt/u;if(e&&i&&i.projection.isReprojectedInTileSpace){const m=1<<e.z,{scale:v,x:S,y:T,projection:I}=i,P=M=>{const L=Ee((e.x+M.x/u)/m),O=Fe((e.y+M.y/u)/m),G=I.project(L,O);M.x=(G.x*v-S)*u,M.y=(G.y*v-T)*u};for(let M=0;M<c.length;M++)if(o.type!==1)c[M]=Ge(c[M],P,1);else{const L=[];for(const O of c[M])O.x<0||O.x>=u||O.y<0||O.y>=u||(P(O),L.push(O));c[M]=L}}for(const m of c)for(const v of m)qt(v,p);return c}function Vt(o,e){return{type:o.type,id:o.id,properties:o.properties,geometry:e?Wt(o):[]}}var tn,on,cn,wn,Bn,Ar,Zr,kr={};function zr(){if(on)return tn;on=1;var o=nl();function e(u,p,m,v,S){this.properties={},this.extent=m,this.type=0,this._pbf=u,this._geometry=-1,this._keys=v,this._values=S,u.readFields(i,this,p)}function i(u,p,m){u==1?p.id=m.readVarint():u==2?function(v,S){for(var T=v.readVarint()+v.pos;v.pos<T;){var I=S._keys[v.readVarint()],P=S._values[v.readVarint()];S.properties[I]=P}}(m,p):u==3?p.type=m.readVarint():u==4&&(p._geometry=m.pos)}function c(u){for(var p,m,v=0,S=0,T=u.length,I=T-1;S<T;I=S++)v+=((m=u[I]).x-(p=u[S]).x)*(p.y+m.y);return v}return tn=e,e.types=["Unknown","Point","LineString","Polygon"],e.prototype.loadGeometry=function(){var u=this._pbf;u.pos=this._geometry;for(var p,m=u.readVarint()+u.pos,v=1,S=0,T=0,I=0,P=[];u.pos<m;){if(S<=0){var M=u.readVarint();v=7&M,S=M>>3}if(S--,v===1||v===2)T+=u.readSVarint(),I+=u.readSVarint(),v===1&&(p&&P.push(p),p=[]),p.push(new o(T,I));else{if(v!==7)throw new Error("unknown command "+v);p&&p.push(p[0].clone())}}return p&&P.push(p),P},e.prototype.bbox=function(){var u=this._pbf;u.pos=this._geometry;for(var p=u.readVarint()+u.pos,m=1,v=0,S=0,T=0,I=1/0,P=-1/0,M=1/0,L=-1/0;u.pos<p;){if(v<=0){var O=u.readVarint();m=7&O,v=O>>3}if(v--,m===1||m===2)(S+=u.readSVarint())<I&&(I=S),S>P&&(P=S),(T+=u.readSVarint())<M&&(M=T),T>L&&(L=T);else if(m!==7)throw new Error("unknown command "+m)}return[I,M,P,L]},e.prototype.toGeoJSON=function(u,p,m){var v,S,T=this.extent*Math.pow(2,m),I=this.extent*u,P=this.extent*p,M=this.loadGeometry(),L=e.types[this.type];function O(Q){for(var le=0;le<Q.length;le++){var ce=Q[le];Q[le]=[360*(ce.x+I)/T-180,360/Math.PI*Math.atan(Math.exp((180-360*(ce.y+P)/T)*Math.PI/180))-90]}}switch(this.type){case 1:var G=[];for(v=0;v<M.length;v++)G[v]=M[v][0];O(M=G);break;case 2:for(v=0;v<M.length;v++)O(M[v]);break;case 3:for(M=function(Q){var le=Q.length;if(le<=1)return[Q];for(var ce,q,re=[],ue=0;ue<le;ue++){var pe=c(Q[ue]);pe!==0&&(q===void 0&&(q=pe<0),q===pe<0?(ce&&re.push(ce),ce=[Q[ue]]):ce.push(Q[ue]))}return ce&&re.push(ce),re}(M),v=0;v<M.length;v++)for(S=0;S<M[v].length;S++)O(M[v][S])}M.length===1?M=M[0]:L="Multi"+L;var Z={type:"Feature",geometry:{type:L,coordinates:M},properties:this.properties};return"id"in this&&(Z.id=this.id),Z},tn}function Di(){if(wn)return cn;wn=1;var o=zr();function e(c,u){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=c,this._keys=[],this._values=[],this._features=[],c.readFields(i,this,u),this.length=this._features.length}function i(c,u,p){c===15?u.version=p.readVarint():c===1?u.name=p.readString():c===5?u.extent=p.readVarint():c===2?u._features.push(p.pos):c===3?u._keys.push(p.readString()):c===4&&u._values.push(function(m){for(var v=null,S=m.readVarint()+m.pos;m.pos<S;){var T=m.readVarint()>>3;v=T===1?m.readString():T===2?m.readFloat():T===3?m.readDouble():T===4?m.readVarint64():T===5?m.readVarint():T===6?m.readSVarint():T===7?m.readBoolean():null}return v}(p))}return cn=e,e.prototype.feature=function(c){if(c<0||c>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[c];var u=this._pbf.readVarint()+this._pbf.pos;return new o(this._pbf,u,this.extent,this._keys,this._values)},cn}function Dn(){return Zr||(Zr=1,kr.VectorTile=function(){if(Ar)return Bn;Ar=1;var o=Di();function e(i,c,u){if(i===3){var p=new o(u,u.readVarint()+u.pos);p.length&&(c[p.name]=p)}}return Bn=function(i,c){this.layers=i.readFields(e,{},c)},Bn}(),kr.VectorTileFeature=zr(),kr.VectorTileLayer=Di()),kr}var Gn=Dn();const Jn="3d_elevation_id",ri="level";class Gi{constructor(){this._valid=!1}reset(e){return this.feature=e,this._valid=!0,this._geometry=e.loadGeometry(),this._geometry.length!==0&&this._geometry[0].length!==0||(this._valid=!1),this}geometry(e,i){return this._valid&&e(i(this._geometry)),this}require(e,i,c){return this.get(e,!0,i,c)}optional(e,i,c){return this.get(e,!1,i,c)}success(){return this._valid}get(e,i,c,u){const p=this.feature.properties.hasOwnProperty(e)?+this.feature.properties[e]:void 0;return this._valid&&p!==void 0&&!Number.isNaN(p)?c(u?u(p):p):i&&(this._valid=!1),this}}class Xr{constructor(e,i){this.featureFunc=e,this.vertexFunc=i}parseFeature(e,i,c){return this.featureFunc(e,i,c)}parseVertex(e,i,c){return this.vertexFunc(e,i,c)}}const yr=new Xr((o,e,i)=>o.reset(e).require(Jn,c=>{i.id=c}).optional("fixed_height_relative",c=>{i.constantHeight=c},lr.decodeRelativeHeight).geometry(c=>{i.bounds=c},w_).success(),(o,e,i)=>o.reset(e).require(Jn,c=>{i.id=c}).require("elevation_idx",c=>{i.idx=c}).require("extent",c=>{i.extent=c}).require("height_relative",c=>{i.height=c},lr.decodeRelativeHeight).geometry(c=>{i.position=c},lr.getPoint).success()),Ei=new Xr((o,e,i)=>o.reset(e).require(Jn,c=>{i.id=c}).optional("fixed_height",c=>{i.constantHeight=c},lr.decodeMetricHeight).geometry(c=>{i.bounds=c},w_).success(),(o,e,i)=>o.reset(e).require(Jn,c=>{i.id=c}).require("elevation_idx",c=>{i.idx=c}).require("extent",c=>{i.extent=c}).require("height",c=>{i.height=c},lr.decodeMetricHeight).geometry(c=>{i.position=c},lr.getPoint).success());class lr{static getPoint(e){return Ns(e[0][0].x,e[0][0].y)}static decodeRelativeHeight(e){return 1e-4*e*5}static decodeMetricHeight(e){return 1e-4*e}static parse(e){const i=[],c=[],u=e.length,p=new Gi;for(let v=0;v<u;v++){const S=e.feature(v),T=S.properties.hasOwnProperty("version")?String(S.properties.version):void 0,I=(m=T)?m==="1.0.1"?Ei:void 0:yr;if(I===void 0){On(`Unknown elevation feature version number ${T||"(unknown)"}`);continue}const P=S.properties.hasOwnProperty("type")?S.properties.type:void 0;if(P){if(Gn.VectorTileFeature.types[S.type]==="Point"&&P==="curve_point"){const M={};I.parseVertex(p,S,M)&&i.push(M)}else if(Gn.VectorTileFeature.types[S.type]==="Polygon"&&P==="curve_meta"){const M={};I.parseFeature(p,S,M)&&c.push(M)}}}var m;return{vertices:i,features:c}}}class Bi{constructor(e,i){this.pos=e,this.dir=i}intersectsPlane(e,i,c){const u=Cn(i,this.dir);if(Math.abs(u)<1e-6)return!1;const p=((e[0]-this.pos[0])*i[0]+(e[1]-this.pos[1])*i[1])/u;return c[0]=this.pos[0]+this.dir[0]*p,c[1]=this.pos[1]+this.dir[1]*p,!0}}class ii{constructor(e,i){this.pos=e,this.dir=i}intersectsPlane(e,i,c){const u=rn(i,this.dir);if(Math.abs(u)<1e-6)return!1;const p=((e[0]-this.pos[0])*i[0]+(e[1]-this.pos[1])*i[1]+(e[2]-this.pos[2])*i[2])/u;return c[0]=this.pos[0]+this.dir[0]*p,c[1]=this.pos[1]+this.dir[1]*p,c[2]=this.pos[2]+this.dir[2]*p,!0}closestPointOnSphere(e,i,c){if(function(L,O){var G=L[0],Z=L[1],Q=L[2],le=O[0],ce=O[1],q=O[2];return Math.abs(G-le)<=k*Math.max(1,Math.abs(G),Math.abs(le))&&Math.abs(Z-ce)<=k*Math.max(1,Math.abs(Z),Math.abs(ce))&&Math.abs(Q-q)<=k*Math.max(1,Math.abs(Q),Math.abs(q))}(this.pos,e)||i===0)return c[0]=c[1]=c[2]=0,!1;const[u,p,m]=this.dir,v=this.pos[0]-e[0],S=this.pos[1]-e[1],T=this.pos[2]-e[2],I=u*u+p*p+m*m,P=2*(v*u+S*p+T*m),M=P*P-4*I*(v*v+S*S+T*T-i*i);if(M<0){const L=Math.max(-P/2,0),O=v+u*L,G=S+p*L,Z=T+m*L,Q=Math.hypot(O,G,Z);return c[0]=O*i/Q,c[1]=G*i/Q,c[2]=Z*i/Q,!1}{const L=(-P-Math.sqrt(M))/(2*I);if(L<0){const O=Math.hypot(v,S,T);return c[0]=v*i/O,c[1]=S*i/O,c[2]=T*i/O,!1}return c[0]=v+u*L,c[1]=S+p*L,c[2]=T+m*L,!0}}}class Gr{constructor(e,i,c,u,p){this.TL=e,this.TR=i,this.BR=c,this.BL=u,this.horizon=p}static fromInvProjectionMatrix(e,i,c){const u=[-1,1,1],p=[1,1,1],m=[1,-1,1],v=[-1,-1,1],S=Mn(u,u,e),T=Mn(p,p,e),I=Mn(m,m,e),P=Mn(v,v,e);return new Gr(S,T,I,P,i/c)}}function si(o,e,i){let c=1/0,u=-1/0;const p=[];for(const m of o){Tr(p,m,e);const v=rn(p,i);c=Math.min(c,v),u=Math.max(u,v)}return[c,u]}function wr(o,e){let i=!0;for(let c=0;c<o.planes.length;c++){const u=o.planes[c];let p=0;for(let m=0;m<e.length;m++)p+=rn(u,e[m])+u[3]>=0;if(p===0)return 0;p!==e.length&&(i=!1)}return i?2:1}function Ii(o,e){for(const i of o.projections){const c=si(e,o.points[0],i.axis);if(i.projection[1]<c[0]||i.projection[0]>c[1])return 0}return 1}function ws(o,e){let i=0;const c=[0,0,0,0];for(let m=0;m<o.length;m++)c[0]=o[m][0],c[1]=o[m][1],c[2]=o[m][2],c[3]=1,(u=c)[0]*(p=e)[0]+u[1]*p[1]+u[2]*p[2]+u[3]*p[3]>=0&&i++;var u,p;return i}class di{constructor(e,i){this.points=e||new Array(8).fill([0,0,0]),this.planes=i||new Array(6).fill([0,0,0,0]),this.bounds=gr.fromPoints(this.points),this.projections=[],this.frustumEdges=[Tr([],this.points[2],this.points[3]),Tr([],this.points[0],this.points[3]),Tr([],this.points[4],this.points[0]),Tr([],this.points[5],this.points[1]),Tr([],this.points[6],this.points[2]),Tr([],this.points[7],this.points[3])];for(const c of this.frustumEdges){const u=[0,-c[2],c[1]],p=[c[2],0,-c[0]];this.projections.push({axis:u,projection:si(this.points,this.points[0],u)}),this.projections.push({axis:p,projection:si(this.points,this.points[0],p)})}}static fromInvProjectionMatrix(e,i,c,u){const p=Math.pow(2,c),m=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(T=>{const I=ut([],T,e),P=1/I[3]/i*p;return(M=I)[0]=(L=I)[0]*(O=[P,P,u?1/I[3]:P,P])[0],M[1]=L[1]*O[1],M[2]=L[2]*O[2],M[3]=L[3]*O[3],M;var M,L,O}),v=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(T=>{const I=Hn([],an([],Tr([],m[T[0]],m[T[1]]),Tr([],m[T[2]],m[T[1]]))),P=-rn(I,m[T[1]]);return I.concat(P)}),S=[];for(let T=0;T<m.length;T++)S.push([m[T][0],m[T][1],m[T][2]]);return new di(S,v)}intersectsPrecise(e,i,c){for(let u=0;u<i.length;u++)if(!ws(e,i[u]))return 0;for(let u=0;u<this.planes.length;u++)if(!ws(e,this.planes[u]))return 0;for(const u of c)for(const p of this.frustumEdges){const m=an([],u,p),v=$t(m);if(v===0)continue;Ct(m,m,1/v);const S=si(this.points,this.points[0],m),T=si(e,this.points[0],m);if(S[0]>T[1]||T[0]>S[1])return 0}return 1}containsPoint(e){for(const i of this.planes){const c=i[3];if(rn([i[0],i[1],i[2]],e)+c<0)return!1}return!0}}class gr{static fromPoints(e){const i=[1/0,1/0,1/0],c=[-1/0,-1/0,-1/0];for(const u of e)Be(i,i,u),ft(c,c,u);return new gr(i,c)}static fromTileIdAndHeight(e,i,c){const u=1<<e.canonical.z,p=e.canonical.x,m=e.canonical.y;return new gr([p/u,m/u,i],[(p+1)/u,(m+1)/u,c])}static applyTransform(e,i){const c=e.getCorners();for(let u=0;u<c.length;++u)Mn(c[u],c[u],i);return gr.fromPoints(c)}static applyTransformFast(e,i){const c=[i[12],i[13],i[14]],u=[...c];for(let p=0;p<3;p++)for(let m=0;m<3;m++){const v=i[4*m+p],S=v*e.min[m],T=v*e.max[m];c[p]+=Math.min(S,T),u[p]+=Math.max(S,T)}return new gr(c,u)}static projectAabbCorners(e,i){const c=e.getCorners();for(let u=0;u<c.length;++u)Mn(c[u],c[u],i);return c}constructor(e,i){this.min=e,this.max=i,this.center=Ct([],jt([],this.min,this.max),.5)}quadrant(e){const i=[e%2==0,e<2],c=Pt(this.min),u=Pt(this.max);for(let p=0;p<i.length;p++)c[p]=i[p]?this.min[p]:this.center[p],u[p]=i[p]?this.center[p]:this.max[p];return u[2]=this.max[2],new gr(c,u)}distanceX(e){return Math.max(Math.min(this.max[0],e[0]),this.min[0])-e[0]}distanceY(e){return Math.max(Math.min(this.max[1],e[1]),this.min[1])-e[1]}distanceZ(e){return Math.max(Math.min(this.max[2],e[2]),this.min[2])-e[2]}getCorners(){const e=this.min,i=this.max;return[[e[0],e[1],e[2]],[i[0],e[1],e[2]],[i[0],i[1],e[2]],[e[0],i[1],e[2]],[e[0],e[1],i[2]],[i[0],e[1],i[2]],[i[0],i[1],i[2]],[e[0],i[1],i[2]]]}intersects(e){return this.intersectsAabb(e.bounds)?wr(e,this.getCorners()):0}intersectsFlat(e){return this.intersectsAabb(e.bounds)?wr(e,[[this.min[0],this.min[1],0],[this.max[0],this.min[1],0],[this.max[0],this.max[1],0],[this.min[0],this.max[1],0]]):0}intersectsPrecise(e,i){return i||this.intersects(e)?Ii(e,this.getCorners()):0}intersectsPreciseFlat(e,i){return i||this.intersectsFlat(e)?Ii(e,[[this.min[0],this.min[1],0],[this.max[0],this.min[1],0],[this.max[0],this.max[1],0],[this.min[0],this.max[1],0]]):0}intersectsAabb(e){for(let i=0;i<3;++i)if(this.min[i]>e.max[i]||e.min[i]>this.max[i])return!1;return!0}intersectsAabbXY(e){return!(this.min[0]>e.max[0]||e.min[0]>this.max[0]||this.min[1]>e.max[1]||e.min[1]>this.max[1])}encapsulate(e){for(let i=0;i<3;i++)this.min[i]=Math.min(this.min[i],e.min[i]),this.max[i]=Math.max(this.max[i],e.max[i])}encapsulatePoint(e){for(let i=0;i<3;i++)this.min[i]=Math.min(this.min[i],e[i]),this.max[i]=Math.max(this.max[i],e[i])}closestPoint(e){return[Math.max(Math.min(this.max[0],e[0]),this.min[0]),Math.max(Math.min(this.max[1],e[1]),this.min[1]),Math.max(Math.min(this.max[2],e[2]),this.min[2])]}}Ht(gr,"Aabb");class wo{constructor(e,i){this.feature=e,this.metersToTile=i,this.index=0}get(){const e=this.feature.vertices[this.index],i=this.feature.vertexProps[this.index].dir,c=i[1],u=-i[0],p=(e.extent+1)*this.metersToTile;return[new Dt(Math.trunc(e.position[0]+c*p),Math.trunc(e.position[1]+u*p)),new Dt(Math.trunc(e.position[0]-c*p),Math.trunc(e.position[1]-u*p))]}next(){this.index++}valid(){return this.index<this.feature.vertices.length}}class lo{constructor(e,i,c,u,p,m){if(this.vertices=new Array,this.vertexProps=new Array,this.edges=new Array,this.edgeProps=new Array,this.id=e,this.heightRange={min:c,max:c},this.safeArea=i,this.constantHeight=c,this.constantHeight==null&&(this.constantHeight!=null||u.length!==0)){this.vertices=u,this.edges=p,this.edges=this.edges.filter(v=>{return v.a<this.vertices.length&&v.b<this.vertices.length&&!((S=this.vertices[v.a].position)[0]===(T=this.vertices[v.b].position)[0]&&S[1]===T[1]);var S,T}),this.heightRange={min:Number.POSITIVE_INFINITY,max:Number.NEGATIVE_INFINITY};for(const v of this.vertices)this.vertexProps.push({dir:Ns(0,0)}),this.heightRange.min=Math.min(this.heightRange.min,v.height),this.heightRange.max=Math.max(this.heightRange.max,v.height);for(const v of this.edges){const S=this.vertices[v.a].position,T=this.vertices[v.b].position,I=Yo(Qi(),T,S),P=zs(I),M=_o(Qi(),I,1/P);this.edgeProps.push({vec:I,dir:M,len:P});const L=this.vertexProps[v.a].dir,O=this.vertexProps[v.b].dir;Do(L,L,M),Do(O,O,M)}for(const v of this.vertexProps)v.dir[0]===0&&v.dir[1]===0||Wl(v.dir,v.dir);this.tessellate(m)}}pointElevation(e){if(this.constantHeight!=null)return this.constantHeight;const i=this.getClosestEdge(e);if(i==null)return 0;const[c,u]=i;return vn(this.vertices[this.edges[c].a].height,this.vertices[this.edges[c].b].height,u)}computeSlopeNormal(e,i){const c=this.getClosestEdge(e);if(!c)return Ve(0,0,1);const u=c[0],p=this.edges[u],m=this.edgeProps[u].vec,v=Ve(m[0],m[1],(this.vertices[p.b].height-this.vertices[p.a].height)*i),S=Ve(v[1],-v[0],0);an(S,S,v);const T=$t(S);return T>0?Ct(S,S,1/T):Ve(0,0,1)}getSafeArea(){return this.safeArea}isTunnel(){return this.heightRange.max<=-5}getClosestEdge(e){if(this.edges.length===0)return;let i=0,c=Number.POSITIVE_INFINITY,u=0;const p=Ns(e.x,e.y);for(let m=0;m<this.edges.length;m++){const v=this.edges[m],S=this.edgeProps[m].dir,T=new Bi(p,this.edgeProps[m].dir),I=this.vertices[v.a].position,P=this.vertices[v.b].position,M=Qi(),L=Qi(),O=T.intersectsPlane(I,this.vertexProps[v.a].dir,M),G=T.intersectsPlane(P,this.vertexProps[v.b].dir,L);if(!O||!G)continue;const Z=Yo(Qi(),L,M),Q=Yo(Qi(),p,M),le=Cn(Z,Z),ce=le>0?Cn(Q,Z)/le:0,q=xe(ce,0,1),re=Math.abs((ce-q)*this.edgeProps[m].len),ue=Yo(Qi(),p,I),pe=re+Math.abs(Cn(ue,Ns(S[1],-S[0])));pe<c&&(i=m,c=pe,u=q)}return[i,u]}tessellate(e){for(let i=this.edges.length-1;i>=0;--i){const c=this.edges[i].a,u=this.edges[i].b,{position:p,height:m,extent:v}=this.vertices[c],{position:S,height:T,extent:I}=this.vertices[u],P=this.vertexProps[c].dir,M=this.vertexProps[u].dir,L=Ve(p[0]/e,p[1]/e,m),O=Ve(S[0]/e,S[1]/e,T),G=Ve(P[1],-P[0],0);Ct(G,G,v);const Z=Ve(M[1],-M[0],0);if(Ct(Z,Z,I),this.distSqLines(Ve(L[0]+.5*G[0],L[1]+.5*G[1],L[2]+.5*G[2]),Ve(O[0]-.5*Z[0],O[1]-.5*Z[1],O[2]-.5*Z[2]),Ve(L[0]-.5*G[0],L[1]-.5*G[1],L[2]-.5*G[2]),Ve(O[0]+.5*Z[0],O[1]+.5*Z[1],O[2]+.5*Z[2]))<=.0025000000000000005)continue;const Q=this.vertices.length,le=Do(Qi(),p,S);this.vertices.push({position:_o(le,le,.5),height:.5*(m+T),extent:.5*(v+I)});const ce=Do(Qi(),P,M);this.vertexProps.push({dir:Wl(ce,ce)}),this.edges.splice(i,1),this.edgeProps.splice(i,1),this.edges.push({a:c,b:Q}),this.edges.push({a:Q,b:u});const q=Yo(Qi(),this.vertices[Q].position,p),re=zs(q),ue={vec:q,dir:_o(Qi(),q,1/re),len:re};this.edgeProps.push(ue),this.edgeProps.push(ue)}}distSqLines(e,i,c,u){const p=Je(Ut(),i,e),m=Je(Ut(),u,c),v=Je(Ut(),e,c),S=rn(p,p),T=rn(p,m),I=rn(p,v),P=rn(m,m),M=rn(m,v),L=S*P-T*T;if(L===0){const Z=rn(v,m)/rn(m,m);return fn(or(Ut(),c,u,Z),e)}const O=(T*M-I*P)/L,G=(S*M-T*I)/L;return fn(or(Ut(),e,i,O),or(Ut(),c,u,G))}}class Fo{static parseFrom(e,i){const c=lr.parse(e);if(!c)return[];let{vertices:u,features:p}=c;const m=1/Xe(i);p.sort((I,P)=>I.id-P.id),u.sort((I,P)=>I.id-P.id||I.idx-P.idx),u=u.filter((I,P,M)=>P===M.findIndex(L=>L.id===I.id&&L.idx===I.idx));const v=new Array;let S=0;const T=u.length;for(const I of p){if(I.constantHeight){v.push(new lo(I.id,I.bounds,I.constantHeight));continue}for(;S!==T&&u[S].id<I.id;)S++;if(S===T||u[S].id!==I.id)continue;const P=new Array,M=new Array,L=S;for(;S!==T&&u[S].id===I.id;){const O=u[S];if(P.push({position:O.position,height:O.height,extent:O.extent}),S!==L&&u[S-1].idx===O.idx-1){const G=S-L;M.push({a:G-1,b:G})}S++}v.push(new lo(I.id,I.bounds,void 0,P,M,m))}return v}static getElevationFeature(e,i){if(!i)return;const c=+e.properties[Jn];return Number.isNaN(c)?void 0:i.find(u=>u.id===c)}}class xa{constructor(e,i){this.zScale=1,this.xOffset=0,this.yOffset=0,e.equals(i)||(this.zScale=Math.pow(2,i.z-e.z),this.xOffset=(e.x*this.zScale-i.x)*Lt,this.yOffset=(e.y*this.zScale-i.y)*Lt)}constantElevation(e,i){if(e.constantHeight!=null)return this.computeBiasedHeight(e.constantHeight,i)}pointElevation(e,i,c){const u=this.constantElevation(i,c);return u??(e.x=e.x*this.zScale+this.xOffset,e.y=e.y*this.zScale+this.yOffset,this.computeBiasedHeight(i.pointElevation(e),c))}computeBiasedHeight(e,i){return i<=0?e:e+i*ke(0,i,e>=0?e:Math.abs(.5*e))}}Ht(lo,"ElevationFeature");class ra{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(i=>i.fqid),this.index=e.index,this.hasPattern=!1,this.projection=e.projection,this.layoutVertexArray=new ml,this.indexArray=new bs,this.segments=new Ai,this.programConfigurations=new h(e.layers,{zoom:e.zoom,lut:e.lut}),this.stateDependentLayerIds=this.layers.filter(i=>i.isStateDependent()).map(i=>i.id),this.elevationMode=this.layers[0].layout.get("circle-elevation-reference"),this.hasElevation=!1,this.elevationMode!=="none"&&(this.elevatedLayoutVertexArray=new ac),this.worldview=e.worldview}updateFootprints(e,i){}populate(e,i,c,u){const p=this.layers[0],m=[];let v=null;p.type==="circle"&&(v=p.layout.get("circle-sort-key"));for(const{feature:T,id:I,index:P,sourceLayerIndex:M}of e){const L=this.layers[0]._featureFilter.needGeometry,O=Vt(T,L);if(!this.layers[0]._featureFilter.filter(new Fr(this.zoom,{worldview:this.worldview}),O,c))continue;const G=v?v.evaluate(O,{},c):void 0,Z={id:I,properties:T.properties,type:T.type,sourceLayerIndex:M,index:P,geometry:L?O.geometry:Wt(T,c,u),patterns:{},sortKey:G};m.push(Z)}v&&m.sort((T,I)=>T.sortKey-I.sortKey);let S=null;u.projection.name==="globe"&&(this.globeExtVertexArray=new hm,S=u.projection);for(const T of m){const{geometry:I,index:P,sourceLayerIndex:M}=T,L=e[P].feature;this.addFeature(T,I,P,i.availableImages,c,S,i.brightness,i.elevationFeatures),i.featureIndex.insert(L,I,P,M,this.index)}this.hasElevation||(this.elevatedLayoutVertexArray=void 0)}update(e,i,c,u,p,m,v){this.programConfigurations.updatePaintArrays(e,i,p,c,u,m,v,this.worldview)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,fS.members),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.globeExtVertexArray&&(this.globeExtVertexBuffer=e.createVertexBuffer(this.globeExtVertexArray,_m.members)),this.elevatedLayoutVertexArray&&(this.elevatedLayoutVertexBuffer=e.createVertexBuffer(this.elevatedLayoutVertexArray,pS.members))),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy(),this.elevatedLayoutVertexBuffer&&this.elevatedLayoutVertexBuffer.destroy())}addFeature(e,i,c,u,p,m,v,S){let T;this.elevationMode!=="none"&&(T=Fo.getElevationFeature(e,S));for(const I of i)for(const P of I){const M=P.x,L=P.y;if(M<0||M>=Lt||L<0||L>=Lt)continue;if(m){const Z=m.projectTilePoint(M,L,p),Q=m.upVector(p,M,L);this.addGlobeExtVertex(Z,Q),this.addGlobeExtVertex(Z,Q),this.addGlobeExtVertex(Z,Q),this.addGlobeExtVertex(Z,Q)}const O=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,e.sortKey),G=O.vertexLength;if(this.addCircleVertex(M,L,-1,-1),this.addCircleVertex(M,L,1,-1),this.addCircleVertex(M,L,1,1),this.addCircleVertex(M,L,-1,1),this.elevationMode!=="none"){const Z=T?T.pointElevation(new Dt(M,L)):0;this.hasElevation=this.hasElevation||Z!==0;for(let Q=0;Q<4;Q++)this.elevatedLayoutVertexArray.emplaceBack(Z)}this.indexArray.emplaceBack(G,G+1,G+2),this.indexArray.emplaceBack(G,G+2,G+3),O.vertexLength+=4,O.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,c,{},u,p,v,void 0,this.worldview)}addCircleVertex(e,i,c,u){this.layoutVertexArray.emplaceBack(2*e+(c+1)/2,2*i+(u+1)/2)}addGlobeExtVertex(e,i){this.globeExtVertexArray.emplaceBack(e.x,e.y,e.z,i[0]*16384,i[1]*16384,i[2]*16384)}}function co(o,e){for(let i=0;i<o.length;i++)if(Ua(e,o[i]))return!0;for(let i=0;i<e.length;i++)if(Ua(o,e[i]))return!0;return!!xf(o,e)}function dc(o,e,i){return!!Ua(o,e)||!!bf(e,o,i)}function ba(o,e){if(o.length===1)return Sm(e,o[0]);for(let i=0;i<e.length;i++){const c=e[i];for(let u=0;u<c.length;u++)if(Ua(o,c[u]))return!0}for(let i=0;i<o.length;i++)if(Sm(e,o[i]))return!0;for(let i=0;i<e.length;i++)if(xf(o,e[i]))return!0;return!1}function hc(o,e,i){if(o.length>1){if(xf(o,e))return!0;for(let c=0;c<e.length;c++)if(bf(e[c],o,i))return!0}for(let c=0;c<o.length;c++)if(bf(o[c],e,i))return!0;return!1}function xf(o,e){if(o.length===0||e.length===0)return!1;for(let i=0;i<o.length-1;i++){const c=o[i],u=o[i+1];for(let p=0;p<e.length-1;p++)if(gy(c,u,e[p],e[p+1]))return!0}return!1}function gy(o,e,i,c){return Ur(o,i,c)!==Ur(e,i,c)&&Ur(o,e,i)!==Ur(o,e,c)}function hd(o,e,i){return(o.x-i.x)*(e.y-i.y)-(o.y-i.y)*(e.x-i.x)}function _y(o,e,i,c){const u=hd(o,e,c),p=hd(o,e,i);if(Math.sign(u)===Math.sign(p))return;const m=hd(i,c,o),v=m+p-u;return Math.sign(m)!==Math.sign(v)?[m/(m-v),p/(p-u)]:void 0}function bf(o,e,i){const c=i*i;if(e.length===1)return o.distSqr(e[0])<c;for(let u=1;u<e.length;u++)if(wm(o,e[u-1],e[u])<c)return!0;return!1}function wm(o,e,i){const c=e.distSqr(i);if(c===0)return o.distSqr(e);const u=((o.x-e.x)*(i.x-e.x)+(o.y-e.y)*(i.y-e.y))/c;return o.distSqr(u<0?e:u>1?i:i.sub(e)._mult(u)._add(e))}function Sm(o,e){let i,c,u,p=!1;for(let m=0;m<o.length;m++){i=o[m];for(let v=0,S=i.length-1;v<i.length;S=v++)c=i[v],u=i[S],c.y>e.y!=u.y>e.y&&e.x<(u.x-c.x)*(e.y-c.y)/(u.y-c.y)+c.x&&(p=!p)}return p}function Ua(o,e){let i=!1;for(let c=0,u=o.length-1;c<o.length;u=c++){const p=o[c],m=o[u];p.y>e.y!=m.y>e.y&&e.x<(m.x-p.x)*(e.y-p.y)/(m.y-p.y)+p.x&&(i=!i)}return i}function fd(o,e,i,c,u){for(const m of o)if(e<=m.x&&i<=m.y&&c>=m.x&&u>=m.y)return!0;const p=[new Dt(e,i),new Dt(e,u),new Dt(c,u),new Dt(c,i)];if(o.length>2){for(const m of p)if(Ua(o,m))return!0}for(let m=0;m<o.length-1;m++)if(au(o[m],o[m+1],p))return!0;return!1}function au(o,e,i){const c=i[0],u=i[2];if(o.x<c.x&&e.x<c.x||o.x>u.x&&e.x>u.x||o.y<c.y&&e.y<c.y||o.y>u.y&&e.y>u.y)return!1;const p=Ur(o,e,i[0]);return p!==Ur(o,e,i[1])||p!==Ur(o,e,i[2])||p!==Ur(o,e,i[3])}function fc(o,e,i,c,u,p){let m=e.y-o.y,v=o.x-e.x;if(p=p||0){const S=m*m+v*v;if(S===0)return!0;const T=Math.sqrt(S);m/=T,v/=T}return!((i.x-o.x)*m+(i.y-o.y)*v-p<0||(c.x-o.x)*m+(c.y-o.y)*v-p<0||(u.x-o.x)*m+(u.y-o.y)*v-p<0)}function gS(o,e,i,c,u,p,m){return!(fc(o,e,c,u,p,m)||fc(e,i,c,u,p,m)||fc(i,o,c,u,p,m)||fc(c,u,o,e,i,m)||fc(u,p,o,e,i,m)||fc(p,c,o,e,i,m))}function Tm(o,e,i){const c=e.paint.get(o).value;return c.kind==="constant"?c.value:i.programConfigurations.get(e.id).getMaxValue(o)}function G0(o){return Math.sqrt(o[0]*o[0]+o[1]*o[1])}function dP(o,e,i,c,u){if(!e[0]&&!e[1])return o;const p=Dt.convert(e)._mult(u);i==="viewport"&&p._rotate(-c);const m=[];for(let v=0;v<o.length;v++)m.push(o[v].sub(p));return m}function hP(o,e,i,c){const u=Dt.convert(o)._mult(c);return e==="viewport"&&u._rotate(-i),u}let fP,pP;function mP(o,e,i){var c=2*Math.PI*6378137/256/Math.pow(2,i);return[o*c-2*Math.PI*6378137/2,e*c-2*Math.PI*6378137/2]}Ht(ra,"CircleBucket",{omit:["layers"]});class wf{constructor(e,i,c){this.z=e,this.x=i,this.y=c,this.key=Em(0,e,e,i,c)}equals(e){return this.z===e.z&&this.x===e.x&&this.y===e.y}url(e,i){const c=function(p,m,v){var S=mP(256*p,256*(m=Math.pow(2,v)-m-1),v),T=mP(256*(p+1),256*(m+1),v);return S[0]+","+S[1]+","+T[0]+","+T[1]}(this.x,this.y,this.z),u=function(p,m,v){let S,T="";for(let I=p;I>0;I--)S=1<<I-1,T+=(m&S?1:0)+(v&S?2:0);return T}(this.z,this.x,this.y);return e[(this.x+this.y)%e.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(i==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",u).replace("{bbox-epsg-3857}",c)}toString(){return`${this.z}/${this.x}/${this.y}`}}class gP{constructor(e,i){this.wrap=e,this.canonical=i,this.key=Em(e,i.z,i.z,i.x,i.y)}}class Js{constructor(e,i,c,u,p){this.overscaledZ=e,this.wrap=i,this.canonical=new wf(c,+u,+p),this.key=i===0&&e===c?this.canonical.key:Em(i,e,c,u,p)}equals(e){return this.overscaledZ===e.overscaledZ&&this.wrap===e.wrap&&this.canonical.equals(e.canonical)}scaledTo(e){const i=this.canonical.z-e;return e>this.canonical.z?new Js(e,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new Js(e,this.wrap,e,this.canonical.x>>i,this.canonical.y>>i)}calculateScaledKey(e,i=!0){if(this.overscaledZ===e&&i)return this.key;if(e>this.canonical.z)return Em(this.wrap*+i,e,this.canonical.z,this.canonical.x,this.canonical.y);{const c=this.canonical.z-e;return Em(this.wrap*+i,e,e,this.canonical.x>>c,this.canonical.y>>c)}}isChildOf(e){if(e.wrap!==this.wrap)return!1;const i=this.canonical.z-e.canonical.z;return e.overscaledZ===0||e.overscaledZ<this.overscaledZ&&e.canonical.z<this.canonical.z&&e.canonical.x===this.canonical.x>>i&&e.canonical.y===this.canonical.y>>i}children(e){if(this.overscaledZ>=e)return[new Js(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const i=this.canonical.z+1,c=2*this.canonical.x,u=2*this.canonical.y;return[new Js(i,this.wrap,i,c,u),new Js(i,this.wrap,i,c+1,u),new Js(i,this.wrap,i,c,u+1),new Js(i,this.wrap,i,c+1,u+1)]}isLessThan(e){return this.wrap<e.wrap||!(this.wrap>e.wrap)&&(this.overscaledZ<e.overscaledZ||!(this.overscaledZ>e.overscaledZ)&&(this.canonical.x<e.canonical.x||!(this.canonical.x>e.canonical.x)&&this.canonical.y<e.canonical.y))}wrapped(){return new Js(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(e){return new Js(this.overscaledZ,e,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new gP(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}}function Em(o,e,i,c,u){const p=1<<Math.min(i,22);let m=p*(u%p)+c%p;return o&&i<22&&(m+=p*p*((o<0?-2*o-1:2*o)%(1<<2*(22-i)))),16*(32*m+i)+(e-i)}const _V=[o=>{let e=o.canonical.x-1,i=o.wrap;return e<0&&(e=(1<<o.canonical.z)-1,i--),new Js(o.overscaledZ,i,o.canonical.z,e,o.canonical.y)},o=>{let e=o.canonical.x+1,i=o.wrap;return e===1<<o.canonical.z&&(e=0,i++),new Js(o.overscaledZ,i,o.canonical.z,e,o.canonical.y)},o=>new Js(o.overscaledZ,o.wrap,o.canonical.z,o.canonical.x,(o.canonical.y===0?1<<o.canonical.z:o.canonical.y)-1),o=>new Js(o.overscaledZ,o.wrap,o.canonical.z,o.canonical.x,o.canonical.y===(1<<o.canonical.z)-1?0:o.canonical.y+1)];Ht(wf,"CanonicalTileID"),Ht(Js,"OverscaledTileID",{omit:["projMatrix","expandedProjMatrix"]});const yV=hr([{type:"Float32",name:"a_globe_pos",components:3},{type:"Float32",name:"a_uv",components:2}]),{members:H0}=yV,vV=hr([{name:"a_pos_3",components:3,type:"Int16"}]);var _P=hr([{name:"a_pos",type:"Int16",components:2}]);function q0(o){return o*b/K}const xV=[new gr([N,N,N],[j,j,j]),new gr([N,N,N],[0,0,j]),new gr([0,N,N],[j,0,j]),new gr([N,0,N],[0,j,j]),new gr([0,0,N],[j,j,j])];function yP(o,e,i,c=!0){const u=Ct([],o._camera.position,o.worldSize),p=[e,i,1,1];ut(p,p,o.pixelMatrixInverse),Ws(p,p,1/p[3]);const m=Hn([],Tr([],p,u)),v=o.globeMatrix,S=[v[12],v[13],v[14]],T=Tr([],S,u),I=$t(T),P=Hn([],T),M=o.worldSize/(2*Math.PI),L=rn(P,m),O=Math.asin(M/I);if(O<Math.acos(L)){if(!c)return null;const Ie=[],Ne=[];Ct(Ie,m,I/L),Hn(Ne,Tr(Ne,Ie,T)),Hn(m,jt(m,T,Ct(m,Ne,Math.tan(O)*I)))}const G=[];new ii(u,m).closestPointOnSphere(S,M,G);const Z=Hn([],Si(v,0)),Q=Hn([],Si(v,1)),le=Hn([],Si(v,2)),ce=rn(Z,G),q=rn(Q,G),re=rn(le,G),ue=He(Math.asin(-q/M));let pe=He(Math.atan2(ce,re));pe=o.center.lng+function(Ie,Ne){const Ke=(Ne-Ie+180)%360-180;return Ke<-180?Ke+360:Ke}(o.center.lng,pe);const Ae=ve(pe),Te=xe(ye(ue),0,1);return new Re(Ae,Te)}class bV{constructor(e,i,c){this.a=Tr([],e,c),this.b=Tr([],i,c),this.center=c;const u=Hn([],this.a),p=Hn([],this.b);this.angle=Math.acos(rn(u,p))}}function _S(o,e){if(o.angle===0)return null;let i;return i=o.a[e]===0?1/o.angle*.5*Math.PI:1/o.angle*Math.atan(o.b[e]/o.a[e]/Math.sin(o.angle)-1/Math.tan(o.angle)),i<0||i>1?null:function(c,u,p,m){const v=Math.sin(p);return c*(Math.sin((1-m)*p)/v)+u*(Math.sin(m*p)/v)}(o.a[e],o.b[e],o.angle,xe(i,0,1))+o.center[e]}function pc(o){if(o.z<=1)return xV[o.z+2*o.y+o.x];const e=yS(W0(o));return gr.fromPoints(e)}function lu(o,e,i){return Ct(o,o,1-i),Zt(o,o,e,i)}function vP(o,e,i){for(const c of o)Mn(c,c,e),Ct(c,c,i)}function xP(o,e,i,c){const u=e/o.worldSize,p=o.globeMatrix;if(i.z<=1){const Te=pc(i).getCorners();return vP(Te,p,u),gr.fromPoints(Te)}const m=W0(i,c),v=yS(m,b+q0(o._tileCoverLift));vP(v,p,u);const S=Number.MAX_VALUE,T=[-S,-S,-S],I=[S,S,S];if(m.contains(o.center)){for(const Ne of v)Be(I,I,Ne),ft(T,T,Ne);T[2]=0;const Te=o.point,Ie=[Te.x*u,Te.y*u,0];return Be(I,I,Ie),ft(T,T,Ie),new gr(I,T)}if(o._tileCoverLift>0){for(const Te of v)Be(I,I,Te),ft(T,T,Te);return new gr(I,T)}const P=[p[12]*u,p[13]*u,p[14]*u],M=m.getCenter(),L=xe(o.center.lat,-85.051129,rt),O=xe(M.lat,-85.051129,rt),G=ve(o.center.lng),Z=ye(L);let Q=G-ve(M.lng);const le=Z-ye(O);Q>.5?Q-=1:Q<-.5&&(Q+=1);let ce=0;Math.abs(Q)>Math.abs(le)?ce=Q>=0?1:3:(ce=le>=0?0:2,Zt(P,P,[p[4]*u,p[5]*u,p[6]*u],-Math.sin(mr(le>=0?m.getSouth():m.getNorth()))*b));const q=v[ce],re=v[(ce+1)%4],ue=new bV(q,re,P),pe=[_S(ue,0)||q[0],_S(ue,1)||q[1],_S(ue,2)||q[2]],Ae=pd(o.zoom);if(Ae>0){const Te=function({x:Ne,y:Ke,z:yt},at,_t,xt,et){const pt=1/(1<<yt);let Ze=Ne*pt,Qe=Ze+pt,St=Ke*pt,Et=St+pt,ln=0;const Kt=(Ze+Qe)/2-xt;return Kt>.5?ln=-1:Kt<-.5&&(ln=1),Ze=((Ze+ln)*at-(xt*=at))*_t+xt,Qe=((Qe+ln)*at-xt)*_t+xt,St=(St*at-(et*=at))*_t+et,Et=(Et*at-et)*_t+et,[[Ze,Et,0],[Qe,Et,0],[Qe,St,0],[Ze,St,0]]}(i,e,o._pixelsPerMercatorPixel,G,Z);for(let Ne=0;Ne<v.length;Ne++)lu(v[Ne],Te[Ne],Ae);const Ie=jt([],Te[ce],Te[(ce+1)%4]);Ct(Ie,Ie,.5),lu(pe,Ie,Ae)}for(const Te of v)Be(I,I,Te),ft(T,T,Te);return I[2]=Math.min(q[2],re[2]),Be(I,I,pe),ft(T,T,pe),new gr(I,T)}function W0({x:o,y:e,z:i},c=!1){const u=1/(1<<i),p=new ie(Ee(o*u),e===(1<<i)-1&&c?-90:Fe((e+1)*u)),m=new ie(Ee((o+1)*u),e===0&&c?90:Fe(e*u));return new fe(p,m)}function yS(o,e=b){const i=mr(o.getNorth()),c=mr(o.getSouth()),u=Math.cos(i),p=Math.cos(c),m=Math.sin(i),v=Math.sin(c),S=o.getWest(),T=o.getEast();return[X(p,v,S,e),X(p,v,T,e),X(u,m,T,e),X(u,m,S,e)]}function yy(o,e,i,c){const u=1<<i.z,p=(o/Lt+i.x)/u;return W(Fe((e/Lt+i.y)/u),Ee(p),c)}function Z0({min:o,max:e}){return R/Math.max(e[0]-o[0],e[1]-o[1],e[2]-o[2])}const bP=new Float64Array(16);function X0(o){const e=Z0(o),i=Pe(bP,[e,e,e]);return te(i,i,$n([],o.min))}function vS(o){const e=(c=o.min,(i=bP)[0]=1,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=1,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=1,i[11]=0,i[12]=c[0],i[13]=c[1],i[14]=c[2],i[15]=1,i);var i,c;const u=1/Z0(o);return de(e,e,[u,u,u])}function xS(o){const e=Lt/(2*Math.PI);return o/(2*Math.PI)/e}function wP(o,e){return Lt/(512*Math.pow(2,o))*Z0(pc(e))}function SP(o,e,i,c,u){const p=xS(i),m=[o,e,-i/(2*Math.PI)],v=H(new Float64Array(16));return te(v,v,m),de(v,v,[p,p,p]),Me(v,v,mr(-u)),Le(v,v,mr(-c)),v}function pd(o){return ke(E,A,o)}function TP(o,e){const i=W(e.lat,e.lng),c=function(O){const G=W(O._center.lat,O._center.lng);let Z=an([],Ve(0,1,0),G);const Q=Ye([],-O.angle,G);Z=Mn(Z,Z,Q),Ye(Q,-O._pitch,Z);const le=Hn([],G);return Ct(le,le,q0(O.cameraToCenterDistance/O.pixelsPerMeter)),Mn(le,le,Q),jt([],G,le)}(o);return m=(u=Je([],c,i))[0],v=u[1],S=u[2],T=(p=i)[0],I=p[1],P=p[2],L=(M=Math.sqrt(m*m+v*v+S*S)*Math.sqrt(T*T+I*I+P*P))&&rn(u,p)/M,Math.acos(Math.min(Math.max(L,-1),1));var u,p,m,v,S,T,I,P,M,L}function bS(o,e){return TP(o,e)>Math.PI/2*1.01}const EP=mr(85),wV=Math.cos(EP),SV=Math.sin(EP),TV=ae(),CP=o=>{const e=[];return o.paint.get("circle-pitch-alignment")==="map"&&e.push("PITCH_WITH_MAP"),o.paint.get("circle-pitch-scale")==="map"&&e.push("SCALE_WITH_MAP"),e};function AP(o,e,i,c,u,p,m,v,S){if(p&&o.queryGeometry.isAboveHorizon)return!1;p&&(S*=o.pixelToTileUnitsFactor);const T=o.tileID.canonical,I=i.projection.upVectorScale(T,i.center.lat,i.worldSize).metersToTile;for(const P of e)for(const M of P){const L=M.add(v),O=u&&i.elevation?i.elevation.exaggeration()*u.getElevationAt(L.x,L.y,!0):0,G=i.projection.projectTilePoint(L.x,L.y,T);if(O>0){const ce=i.projection.upVector(T,L.x,L.y);G.x+=ce[0]*I*O,G.y+=ce[1]*I*O,G.z+=ce[2]*I*O}const Z=p?L:EV(G.x,G.y,G.z,c),Q=p?o.tilespaceRays.map(ce=>AV(ce,O)):o.queryGeometry.screenGeometry,le=ut([],[G.x,G.y,G.z,1],c);if(!m&&p?S*=le[3]/i.cameraToCenterDistance:m&&!p&&(S*=i.cameraToCenterDistance/le[3]),p){const ce=Fe((M.y/Lt+T.y)/(1<<T.z));S/=i.projection.pixelsPerMeter(ce,1)/Se(1,ce)}if(dc(Q,Z,S))return!0}return!1}function EV(o,e,i,c){const u=ut([],[o,e,i,1],c);return new Dt(u[0]/u[3],u[1]/u[3])}const IP=Ve(0,0,0),CV=Ve(0,0,1);function AV(o,e){const i=Ut();return IP[2]=e,o.intersectsPlane(IP,CV,i),new Dt(i[0],i[1])}class PP extends ra{}let MP,RP,kP,DP;function LP(o,{width:e,height:i},c,u){if(u){if(u instanceof Uint8ClampedArray)u=new Uint8Array(u.buffer);else if(u.length!==e*i*c)throw new RangeError("mismatched image size")}else u=new Uint8Array(e*i*c);return o.width=e,o.height=i,o.data=u,o}function NP(o,e,i){const{width:c,height:u}=e;c===o.width&&u===o.height||(wS(o,e,{x:0,y:0},{x:0,y:0},{width:Math.min(o.width,c),height:Math.min(o.height,u)},i,null),o.width=c,o.height=u,o.data=e.data)}function wS(o,e,i,c,u,p,m,v){if(u.width===0||u.height===0)return e;if(u.width>o.width||u.height>o.height||i.x>o.width-u.width||i.y>o.height-u.height)throw new RangeError("out of range source coordinates for image copy");if(u.width>e.width||u.height>e.height||c.x>e.width-u.width||c.y>e.height-u.height)throw new RangeError("out of range destination coordinates for image copy");const S=o.data,T=e.data,I=p===4&&v;for(let P=0;P<u.height;P++){const M=((i.y+P)*o.width+i.x)*p,L=((c.y+P)*e.width+c.x)*p;if(I)for(let O=0;O<u.width;O++){const G=M+O*p+3,Z=L+O*p;T[Z+0]=255,T[Z+1]=255,T[Z+2]=255,T[Z+3]=S[G]}else if(m)for(let O=0;O<u.width;O++){const G=M+O*p,Z=L+O*p,Q=new Er(S[G+0]/255,S[G+1]/255,S[G+2]/255,S[G+3]).toNonPremultipliedRenderColor(m).toArray();T[Z+0]=Q[0],T[Z+1]=Q[1],T[Z+2]=Q[2],T[Z+3]=Q[3]}else for(let O=0;O<u.width*p;O++)T[L+O]=S[M+O]}return e}Ht(PP,"HeatmapBucket",{omit:["layers"]});class md{constructor(e,i){LP(this,e,1,i)}resize(e){NP(this,new md(e),1)}clone(){return new md({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,i,c,u,p){wS(e,i,c,u,p,1,null)}}class Is{constructor(e,i){LP(this,e,4,i)}resize(e){NP(this,new Is(e),4)}replace(e,i){i?this.data.set(e):this.data=e instanceof Uint8ClampedArray?new Uint8Array(e.buffer):e}clone(){return new Is({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,i,c,u,p,m,v){wS(e,i,c,u,p,4,m,v)}}class zP{constructor(e,i){this.width=e.width,this.height=e.height,this.data=i instanceof Uint8Array?new Float32Array(i.buffer):i}}function vy(o){const e={},i=o.resolution||256,c=o.clips?o.clips.length:1,u=o.image||new Is({width:i,height:c}),p=(m,v,S)=>{e[o.evaluationKey]=S;const T=o.expression.evaluate(e),I=T?T.toNonPremultipliedRenderColor(null):null;I&&(u.data[m+v+0]=Math.floor(255*I.r),u.data[m+v+1]=Math.floor(255*I.g),u.data[m+v+2]=Math.floor(255*I.b),u.data[m+v+3]=Math.floor(255*I.a))};if(o.clips)for(let m=0,v=0;m<c;++m,v+=4*i)for(let S=0,T=0;S<i;S++,T+=4){const I=S/(i-1),{start:P,end:M}=o.clips[m];p(v,T,P*(1-I)+M*I)}else for(let m=0,v=0;m<i;m++,v+=4)p(0,v,m/(i-1));return u}Ht(md,"AlphaImage"),Ht(Is,"RGBAImage");const IV=hr([{name:"a_pos",components:2,type:"Int16"}],4),PV=hr([{name:"a_road_z_offset",components:1,type:"Float32"}],4),MV=hr([{name:"a_pos",components:2,type:"Int16"},{name:"a_height",components:1,type:"Float32"}],4),RV=hr([{name:"a_pos_normal_3",components:3,type:"Int16"}],4);function xy(o,e,i=2){const c=e&&e.length,u=c?e[0]*i:o.length;let p=OP(o,0,u,i,!0);const m=[];if(!p||p.next===p.prev)return m;let v,S,T;if(c&&(p=function(I,P,M,L){const O=[];for(let G=0,Z=P.length;G<Z;G++){const Q=OP(I,P[G]*L,G<Z-1?P[G+1]*L:I.length,L,!1);Q===Q.next&&(Q.steiner=!0),O.push(jV(Q))}O.sort(zV);for(let G=0;G<O.length;G++)M=OV(O[G],M);return M}(o,e,p,i)),o.length>80*i){v=1/0,S=1/0;let I=-1/0,P=-1/0;for(let M=i;M<u;M+=i){const L=o[M],O=o[M+1];L<v&&(v=L),O<S&&(S=O),L>I&&(I=L),O>P&&(P=O)}T=Math.max(I-v,P-S),T=T!==0?32767/T:0}return by(p,m,i,v,S,T,0),m}function OP(o,e,i,c,u){let p;if(u===function(m,v,S,T){let I=0;for(let P=v,M=S-T;P<S;P+=T)I+=(m[M]-m[P])*(m[P+1]+m[M+1]),M=P;return I}(o,e,i,c)>0)for(let m=e;m<i;m+=c)p=VP(m/c|0,o[m],o[m+1],p);else for(let m=i-c;m>=e;m-=c)p=VP(m/c|0,o[m],o[m+1],p);return p&&Cm(p,p.next)&&(Ty(p),p=p.next),p}function Sf(o,e){if(!o)return o;e||(e=o);let i,c=o;do if(i=!1,c.steiner||!Cm(c,c.next)&&as(c.prev,c,c.next)!==0)c=c.next;else{if(Ty(c),c=e=c.prev,c===c.next)break;i=!0}while(i||c!==e);return e}function by(o,e,i,c,u,p,m){if(!o)return;!m&&p&&function(S,T,I,P){let M=S;do M.z===0&&(M.z=SS(M.x,M.y,T,I,P)),M.prevZ=M.prev,M.nextZ=M.next,M=M.next;while(M!==S);M.prevZ.nextZ=null,M.prevZ=null,function(L){let O,G=1;do{let Z,Q=L;L=null;let le=null;for(O=0;Q;){O++;let ce=Q,q=0;for(let ue=0;ue<G&&(q++,ce=ce.nextZ,ce);ue++);let re=G;for(;q>0||re>0&&ce;)q!==0&&(re===0||!ce||Q.z<=ce.z)?(Z=Q,Q=Q.nextZ,q--):(Z=ce,ce=ce.nextZ,re--),le?le.nextZ=Z:L=Z,Z.prevZ=le,le=Z;Q=ce}le.nextZ=null,G*=2}while(O>1)}(M)}(o,c,u,p);let v=o;for(;o.prev!==o.next;){const S=o.prev,T=o.next;if(p?DV(o,c,u,p):kV(o))e.push(S.i,o.i,T.i),Ty(o),o=T.next,v=T.next;else if((o=T)===v){m?m===1?by(o=LV(Sf(o),e),e,i,c,u,p,2):m===2&&NV(o,e,i,c,u,p):by(Sf(o),e,i,c,u,p,1);break}}}function kV(o){const e=o.prev,i=o,c=o.next;if(as(e,i,c)>=0)return!1;const u=e.x,p=i.x,m=c.x,v=e.y,S=i.y,T=c.y,I=Math.min(u,p,m),P=Math.min(v,S,T),M=Math.max(u,p,m),L=Math.max(v,S,T);let O=c.next;for(;O!==e;){if(O.x>=I&&O.x<=M&&O.y>=P&&O.y<=L&&wy(u,v,p,S,m,T,O.x,O.y)&&as(O.prev,O,O.next)>=0)return!1;O=O.next}return!0}function DV(o,e,i,c){const u=o.prev,p=o,m=o.next;if(as(u,p,m)>=0)return!1;const v=u.x,S=p.x,T=m.x,I=u.y,P=p.y,M=m.y,L=Math.min(v,S,T),O=Math.min(I,P,M),G=Math.max(v,S,T),Z=Math.max(I,P,M),Q=SS(L,O,e,i,c),le=SS(G,Z,e,i,c);let ce=o.prevZ,q=o.nextZ;for(;ce&&ce.z>=Q&&q&&q.z<=le;){if(ce.x>=L&&ce.x<=G&&ce.y>=O&&ce.y<=Z&&ce!==u&&ce!==m&&wy(v,I,S,P,T,M,ce.x,ce.y)&&as(ce.prev,ce,ce.next)>=0||(ce=ce.prevZ,q.x>=L&&q.x<=G&&q.y>=O&&q.y<=Z&&q!==u&&q!==m&&wy(v,I,S,P,T,M,q.x,q.y)&&as(q.prev,q,q.next)>=0))return!1;q=q.nextZ}for(;ce&&ce.z>=Q;){if(ce.x>=L&&ce.x<=G&&ce.y>=O&&ce.y<=Z&&ce!==u&&ce!==m&&wy(v,I,S,P,T,M,ce.x,ce.y)&&as(ce.prev,ce,ce.next)>=0)return!1;ce=ce.prevZ}for(;q&&q.z<=le;){if(q.x>=L&&q.x<=G&&q.y>=O&&q.y<=Z&&q!==u&&q!==m&&wy(v,I,S,P,T,M,q.x,q.y)&&as(q.prev,q,q.next)>=0)return!1;q=q.nextZ}return!0}function LV(o,e){let i=o;do{const c=i.prev,u=i.next.next;!Cm(c,u)&&jP(c,i,i.next,u)&&Sy(c,u)&&Sy(u,c)&&(e.push(c.i,i.i,u.i),Ty(i),Ty(i.next),i=o=u),i=i.next}while(i!==o);return Sf(i)}function NV(o,e,i,c,u,p){let m=o;do{let v=m.next.next;for(;v!==m.prev;){if(m.i!==v.i&&BV(m,v)){let S=BP(m,v);return m=Sf(m,m.next),S=Sf(S,S.next),by(m,e,i,c,u,p,0),void by(S,e,i,c,u,p,0)}v=v.next}m=m.next}while(m!==o)}function zV(o,e){let i=o.x-e.x;return i===0&&(i=o.y-e.y,i===0)&&(i=(o.next.y-o.y)/(o.next.x-o.x)-(e.next.y-e.y)/(e.next.x-e.x)),i}function OV(o,e){const i=function(u,p){let m=p;const v=u.x,S=u.y;let T,I=-1/0;if(Cm(u,m))return m;do{if(Cm(u,m.next))return m.next;if(S<=m.y&&S>=m.next.y&&m.next.y!==m.y){const G=m.x+(S-m.y)*(m.next.x-m.x)/(m.next.y-m.y);if(G<=v&&G>I&&(I=G,T=m.x<m.next.x?m:m.next,G===v))return T}m=m.next}while(m!==p);if(!T)return null;const P=T,M=T.x,L=T.y;let O=1/0;m=T;do{if(v>=m.x&&m.x>=M&&v!==m.x&&FP(S<L?v:I,S,M,L,S<L?I:v,S,m.x,m.y)){const G=Math.abs(S-m.y)/(v-m.x);Sy(m,u)&&(G<O||G===O&&(m.x>T.x||m.x===T.x&&FV(T,m)))&&(T=m,O=G)}m=m.next}while(m!==P);return T}(o,e);if(!i)return e;const c=BP(i,o);return Sf(c,c.next),Sf(i,i.next)}function FV(o,e){return as(o.prev,o,e.prev)<0&&as(e.next,o,o.next)<0}function SS(o,e,i,c,u){return(o=1431655765&((o=858993459&((o=252645135&((o=16711935&((o=(o-i)*u|0)|o<<8))|o<<4))|o<<2))|o<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=(e-c)*u|0)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function jV(o){let e=o,i=o;do(e.x<i.x||e.x===i.x&&e.y<i.y)&&(i=e),e=e.next;while(e!==o);return i}function FP(o,e,i,c,u,p,m,v){return(u-m)*(e-v)>=(o-m)*(p-v)&&(o-m)*(c-v)>=(i-m)*(e-v)&&(i-m)*(p-v)>=(u-m)*(c-v)}function wy(o,e,i,c,u,p,m,v){return!(o===m&&e===v)&&FP(o,e,i,c,u,p,m,v)}function BV(o,e){return o.next.i!==e.i&&o.prev.i!==e.i&&!function(i,c){let u=i;do{if(u.i!==i.i&&u.next.i!==i.i&&u.i!==c.i&&u.next.i!==c.i&&jP(u,u.next,i,c))return!0;u=u.next}while(u!==i);return!1}(o,e)&&(Sy(o,e)&&Sy(e,o)&&function(i,c){let u=i,p=!1;const m=(i.x+c.x)/2,v=(i.y+c.y)/2;do u.y>v!=u.next.y>v&&u.next.y!==u.y&&m<(u.next.x-u.x)*(v-u.y)/(u.next.y-u.y)+u.x&&(p=!p),u=u.next;while(u!==i);return p}(o,e)&&(as(o.prev,o,e.prev)||as(o,e.prev,e))||Cm(o,e)&&as(o.prev,o,o.next)>0&&as(e.prev,e,e.next)>0)}function as(o,e,i){return(e.y-o.y)*(i.x-e.x)-(e.x-o.x)*(i.y-e.y)}function Cm(o,e){return o.x===e.x&&o.y===e.y}function jP(o,e,i,c){const u=K0(as(o,e,i)),p=K0(as(o,e,c)),m=K0(as(i,c,o)),v=K0(as(i,c,e));return u!==p&&m!==v||!(u!==0||!Y0(o,i,e))||!(p!==0||!Y0(o,c,e))||!(m!==0||!Y0(i,o,c))||!(v!==0||!Y0(i,e,c))}function Y0(o,e,i){return e.x<=Math.max(o.x,i.x)&&e.x>=Math.min(o.x,i.x)&&e.y<=Math.max(o.y,i.y)&&e.y>=Math.min(o.y,i.y)}function K0(o){return o>0?1:o<0?-1:0}function Sy(o,e){return as(o.prev,o,o.next)<0?as(o,e,o.next)>=0&&as(o,o.prev,e)>=0:as(o,e,o.prev)<0||as(o,o.next,e)<0}function BP(o,e){const i=TS(o.i,o.x,o.y),c=TS(e.i,e.x,e.y),u=o.next,p=e.prev;return o.next=e,e.prev=o,i.next=u,u.prev=i,c.next=i,i.prev=c,p.next=c,c.prev=p,c}function VP(o,e,i,c){const u=TS(o,e,i);return c?(u.next=c.next,u.prev=c,c.next.prev=u,c.next=u):(u.prev=u,u.next=u),u}function Ty(o){o.next.prev=o.prev,o.prev.next=o.next,o.prevZ&&(o.prevZ.nextZ=o.nextZ),o.nextZ&&(o.nextZ.prevZ=o.prevZ)}function TS(o,e,i){return{i:o,x:e,y:i,prev:null,next:null,z:0,prevZ:null,nextZ:null,steiner:!1}}function Q0(o,e){const i=o.length;if(i<=1)return[o];const c=[];let u,p;for(let m=0;m<i;m++){const v=li(o[m]);v!==0&&(o[m].area=Math.abs(v),p===void 0&&(p=v<0),p===v<0?(u&&c.push(u),u=[o[m]]):u.push(o[m]))}if(u&&c.push(u),e>1)for(let m=0;m<c.length;m++)c[m].length<=e||(Fs(c[m],e,1,c[m].length-1,VV),c[m]=c[m].slice(0,e));return c}function VV(o,e){return e.area-o.area}function UP(o,e,i=1){if(!o)return null;const c=typeof o=="string"?ao.from(o).getPrimary():o.getPrimary(),u=typeof o=="string"?null:o.getSecondary();for(const p of[c,u]){if(!p)continue;const m=p.id.toString();e.has(m)||e.set(m,[]),p.scaleSelf(i),e.get(m).push(p)}return{primary:c.toString(),secondary:u?u.toString():null}}function ES(o,e,i,c){const u=c.patternDependencies;let p=!1;for(const m of e){const v=m.paint.get(`${o}-pattern`);v.isConstant()||(p=!0),UP(v.constantOr(null),u,i)&&(p=!0)}return p}function CS(o,e,i,c,u,p){const m=p.patternDependencies;for(const v of e){const S=v.paint.get(`${o}-pattern`).value;if(S.kind!=="constant"){let T=S.evaluate({zoom:c},i,{},p.availableImages);T=T&&T.name?T.name:T;const I=UP(T,m,u);if(!I)continue;const{primary:P,secondary:M}=I;P&&(i.patterns[v.id]=[P,M].filter(Boolean))}}return i}class $P{constructor(){this.polygons=new Map}add(e,...i){this.polygons.has(e)?this.polygons.get(e).push(...i):this.polygons.set(e,i)}merge(e){for(const[i,c]of e.polygons)this.add(i,...c)}}class Tf{constructor(){this.portals=[]}static evaluate(e){if(e.length===0)return new Tf;let i=[];for(const T of e)i.push(...T.portals);if(i.length===0)return new Tf;const c=(T,I)=>T<=0&&I<=0||T>=Lt&&I>=Lt;for(const T of i){const I=T.va,P=T.vb;(c(I.x,P.x)||c(I.y,P.y))&&(T.type="border")}const u=i.filter(T=>T.type!=="unevaluated"),p=i.filter(T=>T.type==="unevaluated");if(p.length===0)return new Tf;p.sort((T,I)=>T.hash===I.hash?T.isTunnel===I.isTunnel?0:T.isTunnel?-1:1:T.hash<I.hash?1:-1),i=u.concat(p);let m=u.length,v=m,S=m;do if(v++,v===i.length||i[m].hash!==i[v].hash){if(v-m==2){S<m&&(i[S]=i[m],i[m]=null);const T=i[S],I=i[v-1];T.type=T.isTunnel!==I.isTunnel?"tunnel":"polygon",T.connection={a:T.connection.a,b:I.connection.a},S++}m=v}while(m!==i.length);return i.splice(S),i.sort((T,I)=>T.hash<I.hash?1:-1),{portals:i}}}Ht(Tf,"ElevationPortalGraph"),Ht($P,"ElevationPolygons");class UV{constructor(e,i,c){this.outPositions=e,this.outNormals=i,this.outIndices=c,this.vertexLookup=new Map,this.buffer=new ArrayBuffer(4),this.view=new DataView(this.buffer)}addVertex(e,i,c){let u=e[2];c!=null&&(u*=c);const p=this.getVec3Bits(e)<<96n|this.getVec3Bits(i),m=this.vertexLookup.get(p);if(m!=null)return m;const v=this.outPositions.length;this.vertexLookup.set(p,v);const S=Math.trunc(16384*i[0]),T=Math.trunc(16384*i[1]),I=Math.trunc(16384*i[2]);return this.outPositions.emplaceBack(e[0],e[1],u),this.outNormals.emplaceBack(S,T,I),v}addVertices(e,i,...c){const u=[];for(const p of c){const m=this.addVertex(p,e,i);u.push(m)}return u}addTriangles(e,i,c){if(i&&c){const u=c.length===1,p=Ve(0,0,0);for(let m=0;m<e.length;m+=3){const v=i[e[m+0]],S=i[e[m+1]],T=i[e[m+2]],I=u?c[0]:c[e[m+1]],P=u?c[0]:c[e[m+2]],M=this.addVertex(Ve(v.x,v.y,u?c[0]:c[e[m+0]]),p),L=this.addVertex(Ve(S.x,S.y,I),p),O=this.addVertex(Ve(T.x,T.y,P),p);this.outIndices.emplaceBack(M,L,O)}}else for(let u=0;u<e.length;u+=3)this.outIndices.emplaceBack(e[u+0],e[u+1],e[u+2])}addQuad(e,i){const c=this.addVertices(i,void 0,...e.map(S=>Ve(S.coord.x,S.coord.y,S.height))),[u,p,m,v]=c;this.addTriangles([u,p,m,m,v,u])}getVertexCount(){return this.outPositions.length}clearVertexLookup(){this.vertexLookup.clear()}getBits(e){return this.view.setFloat32(0,e),BigInt(this.view.getUint32(0))}getVec3Bits(e){return this.getBits(e[0])<<64n|this.getBits(e[1])<<32n|this.getBits(e[2])}}class ia{constructor(e,i,c,u){this.unevaluatedPortals=new Tf,this.portalPolygons=new $P,this.bridgeFeatureSections=[],this.tunnelFeatureSections=[],this.vertexHashLookup=new Map,this.unevalVertices=[],this.unevalHeights=[],this.unevalTriangles=[],this.unevalTunnelTriangles=[],this.unevalEdges=[],this.vertexPositions=new ny,this.vertexNormals=new dm,this.indexArray=new bs,this.tileToMeters=Xe(e),this.bridgeProgramConfigurations=new h(i,{zoom:c,lut:u},p=>p!=="fill-tunnel-structure-color"),this.tunnelProgramConfigurations=new h(i,{zoom:c,lut:u},p=>p!=="fill-bridge-guard-rail-color")}addVertices(e,i){const c=this.unevalVertices.length;for(let u=0;u<e.length;u++)this.unevalVertices.push(e[u]),this.unevalHeights.push(i[u]);return c}addTriangles(e,i,c){const u=c?this.unevalTunnelTriangles:this.unevalTriangles;for(const p of e)u.push(p+i)}addRenderableRing(e,i,c,u,p,m){const v=[new Dt(p.min.x,p.min.y),new Dt(p.max.x,p.min.y),new Dt(p.max.x,p.max.y),new Dt(p.min.x,p.max.y)];for(let S=0;S<c-1;S++){const T=i+S,I=T+1,P=this.unevalVertices[T],M=this.unevalVertices[I];if(!(P.x>=p.min.x&&P.x<=p.max.x&&P.y>=p.min.y&&P.y<=p.max.y||M.x>=p.min.x&&M.x<=p.max.x&&M.y>=p.min.y&&M.y<=p.max.y||au(P,M,v))||this.isOnBorder(P.x,M.x)||this.isOnBorder(P.y,M.y))continue;const L=ia.computeEdgeHash(this.unevalVertices[T],this.unevalVertices[I]);let O,G=this.vertexHashLookup.get(ia.computePosHash(P));G!=null?O=G.next:(G=this.vertexHashLookup.get(ia.computePosHash(M)),O=G!=null?G.prev:L),this.unevalEdges.push({polygonIdx:e,a:T,b:I,hash:L,portalHash:O,isTunnel:u,type:"unevaluated",featureInfo:m})}}addPortalCandidates(e,i,c,u,p){if(i.length===0)return;this.portalPolygons.add(e,{geometry:i,zLevel:p});const m=i[0];this.vertexHashLookup.clear();let v=ia.computeEdgeHash(m[m.length-2],m[m.length-1]);for(let S=0;S<m.length-1;S++){const T=m[S+0],I=m[S+1],P=Ns(I.x-T.x,I.y-T.y),M=zs(P);if(M===0)continue;let L="unevaluated";const O=u.pointElevation(T),G=u.pointElevation(I);Math.abs(O)<.01&&Math.abs(G)<.01?L="entrance":(this.isOnBorder(T.x,I.x)||this.isOnBorder(T.y,I.y))&&(L="border");const Z=ia.computeEdgeHash(T,I);this.unevaluatedPortals.portals.push({connection:{a:e,b:void 0},va:T,vb:I,vab:P,length:M,hash:Z,isTunnel:c,type:L});const Q=ia.computePosHash(T);this.vertexHashLookup.set(Q,{prev:v,next:Z}),v=Z}}construct(e){if(this.unevalVertices.length===0)return;const i=()=>({vertexOffset:0,primitiveOffset:this.indexArray.length}),c=M=>{M.primitiveLength=this.indexArray.length-M.primitiveOffset},u=new UV(this.vertexPositions,this.vertexNormals,this.indexArray);this.prepareEdges(e.portals,this.unevalEdges);const p=i(),m=i(),v=i(),S=(M,L)=>{M.sort((G,Z)=>G.type===L&&Z.type!==L?-1:G.type!==L&&Z.type===L?1:0);const O=M.findIndex(G=>G.type!==L);return O>=0?O:M.length};let T=0;this.unevalEdges.length>0&&(T=S(this.unevalEdges,"none"),this.constructBridgeStructures(u,this.unevalVertices,this.unevalHeights,this.unevalEdges,{min:0,max:T},this.tileToMeters)),c(v);const I=i(),P=i();if(this.unevalEdges.length>0){const M=this.unevalEdges.splice(T),L=S(M,"tunnel")+T;this.unevalEdges.push(...M),this.constructTunnelStructures(u,this.unevalVertices,this.unevalHeights,this.unevalEdges,{min:0,max:T},{min:T,max:L})}c(I),u.addTriangles(this.unevalTriangles,this.unevalVertices,this.unevalHeights),c(P),u.addTriangles(this.unevalTunnelTriangles,this.unevalVertices,this.unevalHeights),c(m),u.addTriangles(this.unevalTunnelTriangles,this.unevalVertices,[-.1]),c(p),this.maskSegments=Ai.simpleSegment(0,P.primitiveOffset,0,P.primitiveLength),this.depthSegments=Ai.simpleSegment(0,m.primitiveOffset,0,m.primitiveLength),this.renderableBridgeSegments=Ai.simpleSegment(0,v.primitiveOffset,0,v.primitiveLength),this.renderableTunnelSegments=Ai.simpleSegment(0,I.primitiveOffset,0,I.primitiveLength),this.shadowCasterSegments=Ai.simpleSegment(0,p.primitiveOffset,0,p.primitiveLength)}update(e,i,c,u,p,m,v,S){this.bridgeProgramConfigurations.updatePaintArrays(e,i,p,c,u,m,v,S),this.tunnelProgramConfigurations.updatePaintArrays(e,i,p,c,u,m,v,S)}upload(e){this.vertexBuffer||this.vertexPositions.length===0||this.vertexNormals.length===0||this.indexArray.length===0||(this.vertexBuffer=e.createVertexBuffer(this.vertexPositions,MV.members),this.vertexBufferNormal=e.createVertexBuffer(this.vertexNormals,RV.members),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.bridgeProgramConfigurations.upload(e),this.tunnelProgramConfigurations.upload(e))}destroy(){this.vertexBuffer&&(this.vertexBuffer.destroy(),this.vertexBufferNormal.destroy(),this.indexBuffer.destroy()),this.maskSegments&&(this.maskSegments.destroy(),this.depthSegments.destroy(),this.renderableBridgeSegments.destroy(),this.renderableTunnelSegments.destroy(),this.shadowCasterSegments.destroy()),this.bridgeProgramConfigurations.destroy(),this.tunnelProgramConfigurations.destroy()}populatePaintArrays(e,i,c,u,p){const m=(v,S)=>{for(let T=0;T<S.length-1;T++){const I=S[T].featureIndex,P=S[T+1].vertexStart,M=e.feature(I);v.populatePaintArrays(P,M,I,{},c,i,u,void 0,p)}};m(this.bridgeProgramConfigurations,this.bridgeFeatureSections),m(this.tunnelProgramConfigurations,this.tunnelFeatureSections)}computeVertexConnections(e,i,c,u,p){const m=new Map;for(let v=u;v<p;v++){const S=c[v],T=S.a,I=S.b,P=ia.computePosHash(e[T]),M=ia.computePosHash(e[I]);m.has(P)||m.set(P,{}),m.has(M)||m.set(M,{});const L=m.get(P),O=m.get(M);i[T]<=0&&i[I]<=0||(L.to=I,O.from=T)}return m}constructBridgeStructures(e,i,c,u,p,m){e.clearVertexLookup();const v=this.computeVertexConnections(i,c,u,p.min,p.max),S=1/m,T=.5*S,I=L=>Ve(i[L].x,i[L].y,c[L]*S),P=L=>{const O=v.get(ia.computePosHash(i[L])),G=O.from,Z=O.to;if(!G||!Z)return;const Q=I(G),le=I(L),ce=I(Z),q=Ve(0,0,0);if(!xr(Q,le)){const ue=Tr(Ut(),le,Q);jt(q,q,Hn(ue,ue))}if(!xr(ce,le)){const ue=Tr(Ut(),ce,le);jt(q,q,Hn(ue,ue))}const re=Cs(q);return re>0?Ct(q,q,1/re):void 0};let M=Number.POSITIVE_INFINITY;this.sortSubarray(u,p.min,p.max,(L,O)=>L.featureInfo.featureIndex-O.featureInfo.featureIndex);for(let L=p.min;L<p.max;L++){const O=u[L];if(!O.featureInfo.guardRailEnabled)continue;const G=this.prepareEdgePoints(i,c,O,(Pn,Yt)=>Pn>Yt);if(G==null)continue;const Z=G[0],Q=G[1],le=Ve(Z.coord.x,Z.coord.y,S*Z.height),ce=Ve(Q.coord.x,Q.coord.y,S*Q.height);if(xr(le,ce))continue;const q=Tr(Ut(),ce,le);Hn(q,q);const re=Pn=>Hn(Pn,Pn),ue=P(O.a)||q,pe=P(O.b)||q,Ae=re(Ve(ue[1],-ue[0],0)),Te=re(Ve(pe[1],-pe[0],0)),Ie=re(an(Ut(),Ae,ue)),Ne=re(an(Ut(),Te,pe)),Ke=Ut(),yt=[jt(Ut(),le,Ct(Ke,Tr(Ke,Ae,Ie),T)),jt(Ut(),le,Ct(Ke,jt(Ke,Ae,Ie),T)),jt(Ut(),le,Ct(Ke,Ie,T)),le],at=[jt(Ut(),ce,Ct(Ke,Tr(Ke,Te,Ne),T)),jt(Ut(),ce,Ct(Ke,jt(Ke,Te,Ne),T)),jt(Ut(),ce,Ct(Ke,Ne,T)),ce];M=this.addFeatureSection(O.featureInfo.featureIndex,M,this.bridgeFeatureSections,e);const[_t,xt]=e.addVertices(Ae,m,yt[0],yt[1]),[et,pt]=e.addVertices(Te,m,at[0],at[1]);e.addTriangles([_t,xt,et,xt,pt,et]);const[Ze,Qe]=e.addVertices(Ie,m,yt[1],yt[2]),[St,Et]=e.addVertices(Ne,m,at[1],at[2]);e.addTriangles([Ze,Qe,St,Qe,Et,St]);const[ln,Kt]=e.addVertices($n(Ae,Ae),m,yt[2],yt[3]),[Ot,wt]=e.addVertices($n(Te,Te),m,at[2],at[3]);e.addTriangles([ln,Kt,Ot,Kt,wt,Ot])}this.bridgeFeatureSections.push({featureIndex:Number.POSITIVE_INFINITY,vertexStart:e.getVertexCount()})}constructTunnelStructures(e,i,c,u,p,m){e.clearVertexLookup();let v=Number.POSITIVE_INFINITY;const S=(I,P)=>I.featureInfo.featureIndex-P.featureInfo.featureIndex;this.sortSubarray(u,p.min,p.max,S),this.sortSubarray(u,m.min,m.max,S);const T=I=>Hn(I,I);for(let I=p.min;I<p.max;I++){const P=this.prepareEdgePoints(i,c,u[I],(G,Z)=>G<Z);if(P==null)continue;const[M,L]=P,O=T(Ve(-(L.coord.y-M.coord.y),L.coord.x-M.coord.x,0));v=this.addFeatureSection(u[I].featureInfo.featureIndex,v,this.tunnelFeatureSections,e),e.addQuad([M,L,{coord:L.coord,height:u[I].isTunnel?-.1:0},{coord:M.coord,height:u[I].isTunnel?-.1:0}],O)}for(let I=m.min;I<m.max;I++){const P=u[I];P.isTunnel&&([P.a,P.b]=[P.b,P.a]);const M=i[P.a],L=i[P.b],O=T(Ve(-(L.y-M.y),L.x-M.x,0));v=this.addFeatureSection(P.featureInfo.featureIndex,v,this.tunnelFeatureSections,e),e.addQuad([{coord:L,height:0},{coord:M,height:0},{coord:M,height:c[P.a]+4},{coord:L,height:c[P.b]+4}],O),e.addQuad([{coord:M,height:0},{coord:L,height:0},{coord:L,height:c[P.b]+4},{coord:M,height:c[P.a]+4}],O)}this.tunnelFeatureSections.push({featureIndex:Number.POSITIVE_INFINITY,vertexStart:e.getVertexCount()})}prepareEdgePoints(e,i,c,u){let p=i[c.a],m=i[c.b];const v=u(p,0),S=u(m,0);if(v&&S)return[{coord:e[c.a],height:p},{coord:e[c.b],height:m}];if(!v&&!S)return;const T=e[c.a].clone(),I=e[c.b].clone();if(v){if(!S){const P=m/(m-p);I.x=vn(I.x,T.x,P),I.y=vn(I.y,T.y,P),m=vn(m,p,P)}}else{const P=p/(p-m);T.x=vn(T.x,I.x,P),T.y=vn(T.y,I.y,P),p=vn(p,m,P)}return[{coord:T,height:p},{coord:I,height:m}]}prepareEdges(e,i){if(i.length===0)return;i.sort((v,S)=>v.hash===S.hash?S.polygonIdx-v.polygonIdx:S.hash>v.hash?1:-1);let c=0,u=0,p=0,m=i[c].polygonIdx;do u++,(u===i.length||i[c].hash!==i[u].hash)&&((u-c==1||i[u-1].polygonIdx!==m)&&(p<c&&(i[p]=i[c],i[c]=null),i[p].type="none",p++),c=u,c!==i.length&&(m=i[c].polygonIdx));while(c!==i.length);if(i.splice(p),i.length!==0&&e.length!==0){i.sort((T,I)=>T.portalHash<I.portalHash?1:-1);let v=0,S=0;for(;v!==i.length&&S!==e.length;){const T=i[v],I=e[S];T.portalHash>I.hash?v++:I.hash>T.portalHash?S++:(T.type=I.type,v++)}}}isOnBorder(e,i){return e<=0&&i<=0||e>=Lt&&i>=Lt}addFeatureSection(e,i,c,u){return e!==i&&(i=e,c.push({featureIndex:e,vertexStart:u.getVertexCount()}),u.clearVertexLookup()),i}sortSubarray(e,i,c,u){const p=e.slice(i,c);p.sort(u),e.splice(i,p.length,...p)}static computeEdgeHash(e,i){return(e.y===i.y&&e.x>i.x||e.y>i.y)&&([e,i]=[i,e]),BigInt(ia.computePosHash(e))<<32n|BigInt(ia.computePosHash(i))}static computePosHash(e){return((65535&e.x)<<16|65535&e.y)>>>0}}var GP,HP={exports:{}},qP=(GP||(GP=1,function(o,e){(function(i){function c(he,me){return he>me?1:he<me?-1:0}var u=function(he,me){he===void 0&&(he=c),me===void 0&&(me=!1),this._compare=he,this._root=null,this._size=0,this._noDuplicates=!!me},p={size:{configurable:!0}};function m(he,me,nt,Rt,Ft){var zt=Ft-Rt;if(zt>0){var Xt=Rt+Math.floor(zt/2),yn={key:me[Xt],data:nt[Xt],parent:he};return yn.left=m(yn,me,nt,Rt,Xt),yn.right=m(yn,me,nt,Xt+1,Ft),yn}return null}function v(he,me,nt,Rt,Ft){if(!(nt>=Rt)){for(var zt=he[nt+Rt>>1],Xt=nt-1,yn=Rt+1;;){do Xt++;while(Ft(he[Xt],zt)<0);do yn--;while(Ft(he[yn],zt)>0);if(Xt>=yn)break;var er=he[Xt];he[Xt]=he[yn],he[yn]=er,er=me[Xt],me[Xt]=me[yn],me[yn]=er}v(he,me,nt,yn,Ft),v(he,me,yn+1,Rt,Ft)}}u.prototype.rotateLeft=function(he){var me=he.right;me&&(he.right=me.left,me.left&&(me.left.parent=he),me.parent=he.parent),he.parent?he===he.parent.left?he.parent.left=me:he.parent.right=me:this._root=me,me&&(me.left=he),he.parent=me},u.prototype.rotateRight=function(he){var me=he.left;me&&(he.left=me.right,me.right&&(me.right.parent=he),me.parent=he.parent),he.parent?he===he.parent.left?he.parent.left=me:he.parent.right=me:this._root=me,me&&(me.right=he),he.parent=me},u.prototype._splay=function(he){for(;he.parent;){var me=he.parent;me.parent?me.left===he&&me.parent.left===me?(this.rotateRight(me.parent),this.rotateRight(me)):me.right===he&&me.parent.right===me?(this.rotateLeft(me.parent),this.rotateLeft(me)):me.left===he&&me.parent.right===me?(this.rotateRight(me),this.rotateLeft(me)):(this.rotateLeft(me),this.rotateRight(me)):me.left===he?this.rotateRight(me):this.rotateLeft(me)}},u.prototype.splay=function(he){for(var me,nt,Rt,Ft,zt;he.parent;)(nt=(me=he.parent).parent)&&nt.parent?((Rt=nt.parent).left===nt?Rt.left=he:Rt.right=he,he.parent=Rt):(he.parent=null,this._root=he),Ft=he.left,zt=he.right,he===me.left?(nt&&(nt.left===me?(me.right?(nt.left=me.right,nt.left.parent=nt):nt.left=null,me.right=nt,nt.parent=me):(Ft?(nt.right=Ft,Ft.parent=nt):nt.right=null,he.left=nt,nt.parent=he)),zt?(me.left=zt,zt.parent=me):me.left=null,he.right=me,me.parent=he):(nt&&(nt.right===me?(me.left?(nt.right=me.left,nt.right.parent=nt):nt.right=null,me.left=nt,nt.parent=me):(zt?(nt.left=zt,zt.parent=nt):nt.left=null,he.right=nt,nt.parent=he)),Ft?(me.right=Ft,Ft.parent=me):me.right=null,he.left=me,me.parent=he)},u.prototype.replace=function(he,me){he.parent?he===he.parent.left?he.parent.left=me:he.parent.right=me:this._root=me,me&&(me.parent=he.parent)},u.prototype.minNode=function(he){if(he===void 0&&(he=this._root),he)for(;he.left;)he=he.left;return he},u.prototype.maxNode=function(he){if(he===void 0&&(he=this._root),he)for(;he.right;)he=he.right;return he},u.prototype.insert=function(he,me){var nt=this._root,Rt=null,Ft=this._compare;if(this._noDuplicates)for(;nt;){if(Rt=nt,Ft(nt.key,he)===0)return;nt=Ft(nt.key,he)<0?nt.right:nt.left}else for(;nt;)Rt=nt,nt=Ft(nt.key,he)<0?nt.right:nt.left;return nt={key:he,data:me,left:null,right:null,parent:Rt},Rt?Ft(Rt.key,nt.key)<0?Rt.right=nt:Rt.left=nt:this._root=nt,this.splay(nt),this._size++,nt},u.prototype.find=function(he){for(var me=this._root,nt=this._compare;me;){var Rt=nt(me.key,he);if(Rt<0)me=me.right;else{if(!(Rt>0))return me;me=me.left}}return null},u.prototype.contains=function(he){for(var me=this._root,nt=this._compare;me;){var Rt=nt(he,me.key);if(Rt===0)return!0;me=Rt<0?me.left:me.right}return!1},u.prototype.remove=function(he){var me=this.find(he);if(!me)return!1;if(this.splay(me),me.left)if(me.right){var nt=this.minNode(me.right);nt.parent!==me&&(this.replace(nt,nt.right),nt.right=me.right,nt.right.parent=nt),this.replace(me,nt),nt.left=me.left,nt.left.parent=nt}else this.replace(me,me.left);else this.replace(me,me.right);return this._size--,!0},u.prototype.removeNode=function(he){if(!he)return!1;if(this.splay(he),he.left)if(he.right){var me=this.minNode(he.right);me.parent!==he&&(this.replace(me,me.right),me.right=he.right,me.right.parent=me),this.replace(he,me),me.left=he.left,me.left.parent=me}else this.replace(he,he.left);else this.replace(he,he.right);return this._size--,!0},u.prototype.erase=function(he){var me=this.find(he);if(me){this.splay(me);var nt=me.left,Rt=me.right,Ft=null;nt&&(nt.parent=null,Ft=this.maxNode(nt),this.splay(Ft),this._root=Ft),Rt&&(nt?Ft.right=Rt:this._root=Rt,Rt.parent=Ft),this._size--}},u.prototype.pop=function(){var he=this._root,me=null;if(he){for(;he.left;)he=he.left;me={key:he.key,data:he.data},this.remove(he.key)}return me},u.prototype.next=function(he){var me=he;if(me)if(me.right)for(me=me.right;me&&me.left;)me=me.left;else for(me=he.parent;me&&me.right===he;)he=me,me=me.parent;return me},u.prototype.prev=function(he){var me=he;if(me)if(me.left)for(me=me.left;me&&me.right;)me=me.right;else for(me=he.parent;me&&me.left===he;)he=me,me=me.parent;return me},u.prototype.forEach=function(he){for(var me=this._root,nt=[],Rt=!1,Ft=0;!Rt;)me?(nt.push(me),me=me.left):nt.length>0?(he(me=nt.pop(),Ft++),me=me.right):Rt=!0;return this},u.prototype.range=function(he,me,nt,Rt){for(var Ft=[],zt=this._compare,Xt=this._root;Ft.length!==0||Xt;)if(Xt)Ft.push(Xt),Xt=Xt.left;else{if(zt((Xt=Ft.pop()).key,me)>0)break;if(zt(Xt.key,he)>=0&&nt.call(Rt,Xt))return this;Xt=Xt.right}return this},u.prototype.keys=function(){for(var he=this._root,me=[],nt=[],Rt=!1;!Rt;)he?(me.push(he),he=he.left):me.length>0?(he=me.pop(),nt.push(he.key),he=he.right):Rt=!0;return nt},u.prototype.values=function(){for(var he=this._root,me=[],nt=[],Rt=!1;!Rt;)he?(me.push(he),he=he.left):me.length>0?(he=me.pop(),nt.push(he.data),he=he.right):Rt=!0;return nt},u.prototype.at=function(he){for(var me=this._root,nt=[],Rt=!1,Ft=0;!Rt;)if(me)nt.push(me),me=me.left;else if(nt.length>0){if(me=nt.pop(),Ft===he)return me;Ft++,me=me.right}else Rt=!0;return null},u.prototype.load=function(he,me,nt){if(he===void 0&&(he=[]),me===void 0&&(me=[]),nt===void 0&&(nt=!1),this._size!==0)throw new Error("bulk-load: tree is not empty");var Rt=he.length;return nt&&v(he,me,0,Rt-1,this._compare),this._root=m(null,he,me,0,Rt),this._size=Rt,this},u.prototype.min=function(){var he=this.minNode(this._root);return he?he.key:null},u.prototype.max=function(){var he=this.maxNode(this._root);return he?he.key:null},u.prototype.isEmpty=function(){return this._root===null},p.size.get=function(){return this._size},u.createTree=function(he,me,nt,Rt,Ft){return new u(nt,Ft).load(he,me,Rt)},Object.defineProperties(u.prototype,p);var S=0,T=1,I=2,P=3,M=0,L=1,O=2,G=3;function Z(he,me,nt){me===null?(he.inOut=!1,he.otherInOut=!0):(he.isSubject===me.isSubject?(he.inOut=!me.inOut,he.otherInOut=me.otherInOut):(he.inOut=!me.otherInOut,he.otherInOut=me.isVertical()?!me.inOut:me.inOut),me&&(he.prevInResult=!Q(me,nt)||me.isVertical()?me.prevInResult:me));var Rt=Q(he,nt);he.resultTransition=Rt?function(Ft,zt){var Xt,yn=!Ft.inOut,er=!Ft.otherInOut;switch(zt){case M:Xt=yn&&er;break;case L:Xt=yn||er;break;case G:Xt=yn^er;break;case O:Xt=Ft.isSubject?yn&&!er:er&&!yn}return Xt?1:-1}(he,nt):0}function Q(he,me){switch(he.type){case S:switch(me){case M:return!he.otherInOut;case L:return he.otherInOut;case O:return he.isSubject&&he.otherInOut||!he.isSubject&&!he.otherInOut;case G:return!0}break;case I:return me===M||me===L;case P:return me===O;case T:return!1}return!1}var le=function(he,me,nt,Rt,Ft){this.left=me,this.point=he,this.otherEvent=nt,this.isSubject=Rt,this.type=Ft||S,this.inOut=!1,this.otherInOut=!1,this.prevInResult=null,this.resultTransition=0,this.otherPos=-1,this.outputContourId=-1,this.isExteriorRing=!0},ce={inResult:{configurable:!0}};function q(he,me){return he[0]===me[0]&&he[1]===me[1]}le.prototype.isBelow=function(he){var me=this.point,nt=this.otherEvent.point;return this.left?(me[0]-he[0])*(nt[1]-he[1])-(nt[0]-he[0])*(me[1]-he[1])>0:(nt[0]-he[0])*(me[1]-he[1])-(me[0]-he[0])*(nt[1]-he[1])>0},le.prototype.isAbove=function(he){return!this.isBelow(he)},le.prototype.isVertical=function(){return this.point[0]===this.otherEvent.point[0]},ce.inResult.get=function(){return this.resultTransition!==0},le.prototype.clone=function(){var he=new le(this.point,this.left,this.otherEvent,this.isSubject,this.type);return he.contourId=this.contourId,he.resultTransition=this.resultTransition,he.prevInResult=this.prevInResult,he.isExteriorRing=this.isExteriorRing,he.inOut=this.inOut,he.otherInOut=this.otherInOut,he},Object.defineProperties(le.prototype,ce);var re=11102230246251565e-32,ue=134217729,pe=(3+8*re)*re;function Ae(he,me,nt,Rt,Ft){var zt,Xt,yn,er,tr=me[0],Un=Rt[0],Dr=0,Hr=0;Un>tr==Un>-tr?(zt=tr,tr=me[++Dr]):(zt=Un,Un=Rt[++Hr]);var nr=0;if(Dr<he&&Hr<nt)for(Un>tr==Un>-tr?(yn=zt-((Xt=tr+zt)-tr),tr=me[++Dr]):(yn=zt-((Xt=Un+zt)-Un),Un=Rt[++Hr]),zt=Xt,yn!==0&&(Ft[nr++]=yn);Dr<he&&Hr<nt;)Un>tr==Un>-tr?(yn=zt-((Xt=zt+tr)-(er=Xt-zt))+(tr-er),tr=me[++Dr]):(yn=zt-((Xt=zt+Un)-(er=Xt-zt))+(Un-er),Un=Rt[++Hr]),zt=Xt,yn!==0&&(Ft[nr++]=yn);for(;Dr<he;)yn=zt-((Xt=zt+tr)-(er=Xt-zt))+(tr-er),tr=me[++Dr],zt=Xt,yn!==0&&(Ft[nr++]=yn);for(;Hr<nt;)yn=zt-((Xt=zt+Un)-(er=Xt-zt))+(Un-er),Un=Rt[++Hr],zt=Xt,yn!==0&&(Ft[nr++]=yn);return zt===0&&nr!==0||(Ft[nr++]=zt),nr}function Te(he){return new Float64Array(he)}var Ie=33306690738754716e-32,Ne=22204460492503146e-32,Ke=11093356479670487e-47,yt=Te(4),at=Te(8),_t=Te(12),xt=Te(16),et=Te(4);function pt(he,me,nt){var Rt=function(Ft,zt,Xt,yn,er,tr){var Un=(zt-tr)*(Xt-er),Dr=(Ft-er)*(yn-tr),Hr=Un-Dr;if(Un===0||Dr===0||Un>0!=Dr>0)return Hr;var nr=Math.abs(Un+Dr);return Math.abs(Hr)>=Ie*nr?Hr:-function(vi,Kr,Pr,Li,oi,qr,Qr){var Or,qn,jr,xi,gn,cr,ai,Pi,hi,Wi,Br,Hi,So,Ps,Ss,To,_c,Zi,is=vi-oi,Ms=Pr-oi,eo=Kr-qr,Vs=Li-qr;yt[0]=(Ss=(Pi=is-(ai=(cr=ue*is)-(cr-is)))*(Wi=Vs-(hi=(cr=ue*Vs)-(cr-Vs)))-((Ps=is*Vs)-ai*hi-Pi*hi-ai*Wi))-((Br=Ss-(_c=(Pi=eo-(ai=(cr=ue*eo)-(cr-eo)))*(Wi=Ms-(hi=(cr=ue*Ms)-(cr-Ms)))-((To=eo*Ms)-ai*hi-Pi*hi-ai*Wi)))+(gn=Ss-Br))+(gn-_c),yt[1]=(So=Ps-((Hi=Ps+Br)-(gn=Hi-Ps))+(Br-gn))-((Br=So-To)+(gn=So-Br))+(gn-To),yt[2]=Hi-((Zi=Hi+Br)-(gn=Zi-Hi))+(Br-gn),yt[3]=Zi;var bd=function($te,tD){for(var nD=tD[0],RT=1;RT<4;RT++)nD+=tD[RT];return nD}(0,yt),Qy=Ne*Qr;if(bd>=Qy||-bd>=Qy||(Or=vi-(is+(gn=vi-is))+(gn-oi),jr=Pr-(Ms+(gn=Pr-Ms))+(gn-oi),qn=Kr-(eo+(gn=Kr-eo))+(gn-qr),xi=Li-(Vs+(gn=Li-Vs))+(gn-qr),Or===0&&qn===0&&jr===0&&xi===0)||(Qy=Ke*Qr+pe*Math.abs(bd),(bd+=is*xi+Vs*Or-(eo*jr+Ms*qn))>=Qy||-bd>=Qy))return bd;et[0]=(Ss=(Pi=Or-(ai=(cr=ue*Or)-(cr-Or)))*(Wi=Vs-(hi=(cr=ue*Vs)-(cr-Vs)))-((Ps=Or*Vs)-ai*hi-Pi*hi-ai*Wi))-((Br=Ss-(_c=(Pi=qn-(ai=(cr=ue*qn)-(cr-qn)))*(Wi=Ms-(hi=(cr=ue*Ms)-(cr-Ms)))-((To=qn*Ms)-ai*hi-Pi*hi-ai*Wi)))+(gn=Ss-Br))+(gn-_c),et[1]=(So=Ps-((Hi=Ps+Br)-(gn=Hi-Ps))+(Br-gn))-((Br=So-To)+(gn=So-Br))+(gn-To),et[2]=Hi-((Zi=Hi+Br)-(gn=Zi-Hi))+(Br-gn),et[3]=Zi;var M8=Ae(4,yt,4,et,at);et[0]=(Ss=(Pi=is-(ai=(cr=ue*is)-(cr-is)))*(Wi=xi-(hi=(cr=ue*xi)-(cr-xi)))-((Ps=is*xi)-ai*hi-Pi*hi-ai*Wi))-((Br=Ss-(_c=(Pi=eo-(ai=(cr=ue*eo)-(cr-eo)))*(Wi=jr-(hi=(cr=ue*jr)-(cr-jr)))-((To=eo*jr)-ai*hi-Pi*hi-ai*Wi)))+(gn=Ss-Br))+(gn-_c),et[1]=(So=Ps-((Hi=Ps+Br)-(gn=Hi-Ps))+(Br-gn))-((Br=So-To)+(gn=So-Br))+(gn-To),et[2]=Hi-((Zi=Hi+Br)-(gn=Zi-Hi))+(Br-gn),et[3]=Zi;var R8=Ae(M8,at,4,et,_t);et[0]=(Ss=(Pi=Or-(ai=(cr=ue*Or)-(cr-Or)))*(Wi=xi-(hi=(cr=ue*xi)-(cr-xi)))-((Ps=Or*xi)-ai*hi-Pi*hi-ai*Wi))-((Br=Ss-(_c=(Pi=qn-(ai=(cr=ue*qn)-(cr-qn)))*(Wi=jr-(hi=(cr=ue*jr)-(cr-jr)))-((To=qn*jr)-ai*hi-Pi*hi-ai*Wi)))+(gn=Ss-Br))+(gn-_c),et[1]=(So=Ps-((Hi=Ps+Br)-(gn=Hi-Ps))+(Br-gn))-((Br=So-To)+(gn=So-Br))+(gn-To),et[2]=Hi-((Zi=Hi+Br)-(gn=Zi-Hi))+(Br-gn),et[3]=Zi;var k8=Ae(R8,_t,4,et,xt);return xt[k8-1]}(Ft,zt,Xt,yn,er,tr,nr)}(he[0],he[1],me[0],me[1],nt[0],nt[1]);return Rt>0?-1:Rt<0?1:0}function Ze(he,me){var nt=he.point,Rt=me.point;return nt[0]>Rt[0]?1:nt[0]<Rt[0]?-1:nt[1]!==Rt[1]?nt[1]>Rt[1]?1:-1:function(Ft,zt,Xt,yn){return Ft.left!==zt.left?Ft.left?1:-1:pt(Xt,Ft.otherEvent.point,zt.otherEvent.point)!==0?Ft.isBelow(zt.otherEvent.point)?-1:1:!Ft.isSubject&&zt.isSubject?1:-1}(he,me,nt)}function Qe(he,me,nt){var Rt=new le(me,!1,he,he.isSubject),Ft=new le(me,!0,he.otherEvent,he.isSubject);return q(he.point,he.otherEvent.point)&&console.warn("what is that, a collapsed segment?",he),Rt.contourId=Ft.contourId=he.contourId,Ze(Ft,he.otherEvent)>0&&(he.otherEvent.left=!0,Ft.left=!1),he.otherEvent.otherEvent=Ft,he.otherEvent=Rt,nt.push(Ft),nt.push(Rt),nt}function St(he,me){return he[0]*me[1]-he[1]*me[0]}function Et(he,me){return he[0]*me[0]+he[1]*me[1]}function ln(he,me,nt){var Rt=function(er,tr,Un,Dr,Hr){var nr=[tr[0]-er[0],tr[1]-er[1]],vi=[Dr[0]-Un[0],Dr[1]-Un[1]];function Kr(cr,ai,Pi){return[cr[0]+ai*Pi[0],cr[1]+ai*Pi[1]]}var Pr=[Un[0]-er[0],Un[1]-er[1]],Li=St(nr,vi),oi=Li*Li,qr=Et(nr,nr);if(oi>0){var Qr=St(Pr,vi)/Li;if(Qr<0||Qr>1)return null;var Or=St(Pr,nr)/Li;return Or<0||Or>1?null:Qr===0||Qr===1?[Kr(er,Qr,nr)]:Or===0||Or===1?[Kr(Un,Or,vi)]:[Kr(er,Qr,nr)]}if((oi=(Li=St(Pr,nr))*Li)>0)return null;var qn=Et(nr,Pr)/qr,jr=qn+Et(nr,vi)/qr,xi=Math.min(qn,jr),gn=Math.max(qn,jr);return xi<=1&&gn>=0?xi===1?[Kr(er,xi>0?xi:0,nr)]:gn===0?[Kr(er,gn<1?gn:1,nr)]:[Kr(er,xi>0?xi:0,nr),Kr(er,gn<1?gn:1,nr)]:null}(he.point,he.otherEvent.point,me.point,me.otherEvent.point),Ft=Rt?Rt.length:0;if(Ft===0||Ft===1&&(q(he.point,me.point)||q(he.otherEvent.point,me.otherEvent.point))||Ft===2&&he.isSubject===me.isSubject)return 0;if(Ft===1)return q(he.point,Rt[0])||q(he.otherEvent.point,Rt[0])||Qe(he,Rt[0],nt),q(me.point,Rt[0])||q(me.otherEvent.point,Rt[0])||Qe(me,Rt[0],nt),1;var zt=[],Xt=!1,yn=!1;return q(he.point,me.point)?Xt=!0:Ze(he,me)===1?zt.push(me,he):zt.push(he,me),q(he.otherEvent.point,me.otherEvent.point)?yn=!0:Ze(he.otherEvent,me.otherEvent)===1?zt.push(me.otherEvent,he.otherEvent):zt.push(he.otherEvent,me.otherEvent),Xt&&yn||Xt?(me.type=T,he.type=me.inOut===he.inOut?I:P,Xt&&!yn&&Qe(zt[1].otherEvent,zt[0].point,nt),2):yn?(Qe(zt[0],zt[1].point,nt),3):zt[0]!==zt[3].otherEvent?(Qe(zt[0],zt[1].point,nt),Qe(zt[1],zt[2].point,nt),3):(Qe(zt[0],zt[1].point,nt),Qe(zt[3].otherEvent,zt[2].point,nt),3)}function Kt(he,me){if(he===me)return 0;if(pt(he.point,he.otherEvent.point,me.point)!==0||pt(he.point,he.otherEvent.point,me.otherEvent.point)!==0)return q(he.point,me.point)?he.isBelow(me.otherEvent.point)?-1:1:he.point[0]===me.point[0]?he.point[1]<me.point[1]?-1:1:Ze(he,me)===1?me.isAbove(he.point)?-1:1:he.isBelow(me.point)?-1:1;if(he.isSubject!==me.isSubject)return he.isSubject?-1:1;var nt=he.point,Rt=me.point;return nt[0]===Rt[0]&&nt[1]===Rt[1]?(nt=he.otherEvent.point)[0]===(Rt=me.otherEvent.point)[0]&&nt[1]===Rt[1]?0:he.contourId>me.contourId?1:-1:Ze(he,me)===1?1:-1}var Ot=function(){this.points=[],this.holeIds=[],this.holeOf=null,this.depth=null};function wt(he,me,nt,Rt){var Ft,zt=he+1,Xt=me[he].point,yn=me.length;for(zt<yn&&(Ft=me[zt].point);zt<yn&&Ft[0]===Xt[0]&&Ft[1]===Xt[1];){if(!nt[zt])return zt;++zt<yn&&(Ft=me[zt].point)}for(zt=he-1;nt[zt]&&zt>Rt;)zt--;return zt}Ot.prototype.isExterior=function(){return this.holeOf==null};var Pn=Jt,Yt=Jt;function Jt(he,me){if(!(this instanceof Jt))return new Jt(he,me);if(this.data=he||[],this.length=this.data.length,this.compare=me||xn,this.length>0)for(var nt=(this.length>>1)-1;nt>=0;nt--)this._down(nt)}function xn(he,me){return he<me?-1:he>me?1:0}Jt.prototype={push:function(he){this.data.push(he),this.length++,this._up(this.length-1)},pop:function(){if(this.length!==0){var he=this.data[0];return this.length--,this.length>0&&(this.data[0]=this.data[this.length],this._down(0)),this.data.pop(),he}},peek:function(){return this.data[0]},_up:function(he){for(var me=this.data,nt=this.compare,Rt=me[he];he>0;){var Ft=he-1>>1,zt=me[Ft];if(nt(Rt,zt)>=0)break;me[he]=zt,he=Ft}me[he]=Rt},_down:function(he){for(var me=this.data,nt=this.compare,Rt=this.length>>1,Ft=me[he];he<Rt;){var zt=1+(he<<1),Xt=zt+1,yn=me[zt];if(Xt<this.length&&nt(me[Xt],yn)<0&&(zt=Xt,yn=me[Xt]),nt(yn,Ft)>=0)break;me[he]=yn,he=zt}me[he]=Ft}},Pn.default=Yt;var zn=Math.max,Nn=Math.min,Xn=0;function Vn(he,me,nt,Rt,Ft,zt){var Xt,yn,er,tr,Un,Dr;for(Xt=0,yn=he.length-1;Xt<yn;Xt++)if(tr=he[Xt+1],Un=new le(er=he[Xt],!1,void 0,me),Dr=new le(tr,!1,Un,me),Un.otherEvent=Dr,er[0]!==tr[0]||er[1]!==tr[1]){Un.contourId=Dr.contourId=nt,zt||(Un.isExteriorRing=!1,Dr.isExteriorRing=!1),Ze(Un,Dr)>0?Dr.left=!0:Un.left=!0;var Hr=er[0],nr=er[1];Ft[0]=Nn(Ft[0],Hr),Ft[1]=Nn(Ft[1],nr),Ft[2]=zn(Ft[2],Hr),Ft[3]=zn(Ft[3],nr),Rt.push(Un),Rt.push(Dr)}}var Yn=[];function Ir(he,me,nt){typeof he[0][0][0]=="number"&&(he=[he]),typeof me[0][0][0]=="number"&&(me=[me]);var Rt=function(nr,vi,Kr){var Pr=null;return nr.length*vi.length==0&&(Kr===M?Pr=Yn:Kr===O?Pr=nr:Kr!==L&&Kr!==G||(Pr=nr.length===0?vi:nr)),Pr}(he,me,nt);if(Rt)return Rt===Yn?null:Rt;var Ft=[1/0,1/0,-1/0,-1/0],zt=[1/0,1/0,-1/0,-1/0],Xt=function(nr,vi,Kr,Pr,Li){var oi,qr,Qr,Or,qn,jr,xi=new Pn(null,Ze);for(Qr=0,Or=nr.length;Qr<Or;Qr++)for(qn=0,jr=(oi=nr[Qr]).length;qn<jr;qn++)(qr=qn===0)&&Xn++,Vn(oi[qn],!0,Xn,xi,Kr,qr);for(Qr=0,Or=vi.length;Qr<Or;Qr++)for(qn=0,jr=(oi=vi[Qr]).length;qn<jr;qn++)qr=qn===0,Li===O&&(qr=!1),qr&&Xn++,Vn(oi[qn],!1,Xn,xi,Pr,qr);return xi}(he,me,Ft,zt,nt);if(Rt=function(nr,vi,Kr,Pr,Li){var oi=null;return(Kr[0]>Pr[2]||Pr[0]>Kr[2]||Kr[1]>Pr[3]||Pr[1]>Kr[3])&&(Li===M?oi=Yn:Li===O?oi=nr:Li!==L&&Li!==G||(oi=nr.concat(vi))),oi}(he,me,Ft,zt,nt))return Rt===Yn?null:Rt;for(var yn=function(nr){var vi,Kr,Pr=function(Qr){var Or,qn,jr,xi,gn=[];for(qn=0,jr=Qr.length;qn<jr;qn++)((Or=Qr[qn]).left&&Or.inResult||!Or.left&&Or.otherEvent.inResult)&&gn.push(Or);for(var cr=!1;!cr;)for(cr=!0,qn=0,jr=gn.length;qn<jr;qn++)qn+1<jr&&Ze(gn[qn],gn[qn+1])===1&&(xi=gn[qn],gn[qn]=gn[qn+1],gn[qn+1]=xi,cr=!1);for(qn=0,jr=gn.length;qn<jr;qn++)(Or=gn[qn]).otherPos=qn;for(qn=0,jr=gn.length;qn<jr;qn++)(Or=gn[qn]).left||(xi=Or.otherPos,Or.otherPos=Or.otherEvent.otherPos,Or.otherEvent.otherPos=xi);return gn}(nr),Li={},oi=[],qr=function(){if(!Li[vi]){var Qr=oi.length,Or=function(gn,cr,ai){var Pi=new Ot;if(gn.prevInResult!=null){var hi=gn.prevInResult,Wi=hi.outputContourId;if(hi.resultTransition>0){var Br=cr[Wi];if(Br.holeOf!=null){var Hi=Br.holeOf;cr[Hi].holeIds.push(ai),Pi.holeOf=Hi,Pi.depth=cr[Wi].depth}else cr[Wi].holeIds.push(ai),Pi.holeOf=Wi,Pi.depth=cr[Wi].depth+1}else Pi.holeOf=null,Pi.depth=cr[Wi].depth}else Pi.holeOf=null,Pi.depth=0;return Pi}(Pr[vi],oi,Qr),qn=function(gn){Li[gn]=!0,gn<Pr.length&&Pr[gn]&&(Pr[gn].outputContourId=Qr)},jr=vi,xi=vi;for(Or.points.push(Pr[vi].point);qn(jr),qn(jr=Pr[jr].otherPos),Or.points.push(Pr[jr].point),!((jr=wt(jr,Pr,Li,xi))==xi||jr>=Pr.length)&&Pr[jr];);oi.push(Or)}};for(vi=0,Kr=Pr.length;vi<Kr;vi++)qr();return oi}(function(nr,vi,Kr,Pr,Li,oi){for(var qr,Qr,Or,qn=new u(Kt),jr=[],xi=Math.min(Pr[2],Li[2]);nr.length!==0;){var gn=nr.pop();if(jr.push(gn),oi===M&&gn.point[0]>xi||oi===O&&gn.point[0]>Pr[2])break;if(gn.left){Qr=qr=qn.insert(gn),qr=qr!==(Or=qn.minNode())?qn.prev(qr):null,Qr=qn.next(Qr);var cr=qr?qr.key:null;if(Z(gn,cr,oi),Qr&&ln(gn,Qr.key,nr)===2&&(Z(gn,cr,oi),Z(Qr.key,gn,oi)),qr&&ln(qr.key,gn,nr)===2){var ai=qr;Z(cr,(ai=ai!==Or?qn.prev(ai):null)?ai.key:null,oi),Z(gn,cr,oi)}}else Qr=qr=qn.find(gn=gn.otherEvent),qr&&Qr&&(qr=qr!==Or?qn.prev(qr):null,Qr=qn.next(Qr),qn.remove(gn),Qr&&qr&&ln(qr.key,Qr.key,nr))}return jr}(Xt,0,0,Ft,zt,nt)),er=[],tr=0;tr<yn.length;tr++){var Un=yn[tr];if(Un.isExterior()){for(var Dr=[Un.points],Hr=0;Hr<Un.holeIds.length;Hr++)Dr.push(yn[Un.holeIds[Hr]].points);er.push(Dr)}}return er}var Yr={UNION:L,DIFFERENCE:O,INTERSECTION:M,XOR:G};i.diff=function(he,me){return Ir(he,me,O)},i.intersection=function(he,me){return Ir(he,me,M)},i.operations=Yr,i.union=function(he,me){return Ir(he,me,L)},i.xor=function(he,me){return Ir(he,me,G)},Object.defineProperty(i,"__esModule",{value:!0})})(e)}(0,HP.exports)),HP.exports);/**
 * martinez v0.7.4
 * Martinez polygon clipping algorithm, does boolean operation on polygons (multipolygons, polygons with holes etc): intersection, union, difference, xor
 *
 * @author Alex Milevski <info@w8r.name>
 * @license MIT
 * @preserve
 */function J0(o,e,i,c){const u=[],p=c===0?(m,v,S,T,I,P)=>{m.push(new Dt(P,S+(P-v)/(T-v)*(I-S)))}:(m,v,S,T,I,P)=>{m.push(new Dt(v+(P-S)/(I-S)*(T-v),P))};for(const m of o){const v=[];for(const S of m){if(S.length<=2)continue;const T=[];for(let M=0;M<S.length-1;M++){const L=S[M].x,O=S[M].y,G=S[M+1].x,Z=S[M+1].y,Q=c===0?L:O,le=c===0?G:Z;Q<e?le>e&&p(T,L,O,G,Z,e):Q>i?le<i&&p(T,L,O,G,Z,i):T.push(S[M]),le<e&&Q>=e&&p(T,L,O,G,Z,e),le>i&&Q<=i&&p(T,L,O,G,Z,i)}let I=S[S.length-1];const P=c===0?I.x:I.y;P>=e&&P<=i&&T.push(I),T.length&&(I=T[T.length-1],T[0].x===I.x&&T[0].y===I.y||T.push(T[0]),v.push(T))}v.length&&u.push(v)}return u}function $V(o,e){const i=AS(o),c=AS([e]),u=qP.intersection(i,c);return u==null?[]:WP(u)}function GV(o,e){let c=AS(o,65536);for(;e.valid();e.next()){const[u,p]=e.get(),m=u.x*65536,v=u.y*65536,S=p.x*65536,T=p.y*65536,I=S-m,P=T-v,M=Math.hypot(I,P),L=Math.trunc(P/M*3),O=-Math.trunc(I/M*3);c=qP.diff(c,[[[m,v],[S,T],[S+L,T+O],[m+L,v+O],[m,v]]])}return WP(c,1/65536)}function AS(o,e=1){return[o.map(i=>i.map(c=>[c.x*e,c.y*e]))]}function WP(o,e=1){return o.map(i=>i.map((c,u)=>{const p=c.map(m=>new Dt(m[0]*e,m[1]*e).round());return u>0&&p.reverse(),p}))}class IS{constructor(e,i){this.layoutVertexArray=new ml,this.indexArray=new bs,this.lineIndexArray=new cc,this.triangleSegments=new Ai,this.lineSegments=new Ai,this.programConfigurations=new h(e.layers,{zoom:e.zoom,lut:e.lut}),this.uploaded=!1,i&&(this.elevatedLayoutVertexArray=new ac)}update(e,i,c,u,p,m,v,S){this.programConfigurations.updatePaintArrays(e,i,p,c,u,m,v,S)}isEmpty(){return this.layoutVertexArray.length===0}needsUpload(){return this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,IV.members),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.lineIndexBuffer=e.createIndexBuffer(this.lineIndexArray),this.elevatedLayoutVertexArray&&this.elevatedLayoutVertexArray.length>0&&(this.elevatedLayoutVertexBuffer=e.createVertexBuffer(this.elevatedLayoutVertexArray,PV.members))),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.elevatedLayoutVertexBuffer&&this.elevatedLayoutVertexBuffer.destroy(),this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.lineIndexBuffer.destroy(),this.programConfigurations.destroy(),this.triangleSegments.destroy(),this.lineSegments.destroy())}populatePaintArrays(e,i,c,u,p,m,v){this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,i,c,u,p,m,void 0,v)}}class PS{constructor(e){this.zoom=e.zoom,this.pixelRatio=e.pixelRatio,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(i=>i.fqid),this.index=e.index,this.hasPattern=!1,this.patternFeatures=[],this.lut=e.lut,this.bufferData=new IS(e,!1),this.elevationBufferData=new IS(e,!0),this.stateDependentLayerIds=this.layers.filter(i=>i.isStateDependent()).map(i=>i.id),this.projection=e.projection,this.elevationMode=this.layers[0].layout.get("fill-elevation-reference"),this.sourceLayerIndex=e.sourceLayerIndex,this.worldview=e.worldview}updateFootprints(e,i){}populate(e,i,c,u){this.hasPattern=ES("fill",this.layers,this.pixelRatio,i);const p=this.layers[0].layout.get("fill-sort-key"),m=[];for(const{feature:v,id:S,index:T,sourceLayerIndex:I}of e){const P=this.layers[0]._featureFilter.needGeometry,M=Vt(v,P);if(!this.layers[0]._featureFilter.filter(new Fr(this.zoom,{worldview:this.worldview}),M,c))continue;const L=p?p.evaluate(M,{},c,i.availableImages):void 0,O={id:S,properties:v.properties,type:v.type,sourceLayerIndex:I,index:T,geometry:P?M.geometry:Wt(v,c,u),patterns:{},sortKey:L};m.push(O)}p&&m.sort((v,S)=>v.sortKey-S.sortKey);for(const v of m){const{geometry:S,index:T,sourceLayerIndex:I}=v;if(this.hasPattern){const P=CS("fill",this.layers,v,this.zoom,this.pixelRatio,i);this.patternFeatures.push(P)}else this.addFeature(v,S,T,c,{},i.availableImages,i.brightness,i.elevationFeatures);i.featureIndex.insert(e[T].feature,S,T,I,this.index)}}update(e,i,c,u,p,m,v){this.bufferData.update(e,i,c,u,p,m,v,this.worldview),this.elevationBufferData.update(e,i,c,u,p,m,v,this.worldview),this.elevatedStructures&&this.elevatedStructures.update(e,i,c,u,p,m,v,this.worldview)}addFeatures(e,i,c,u,p,m){for(const v of this.patternFeatures)this.addFeature(v,v.geometry,v.index,i,c,u,m,e.elevationFeatures)}isEmpty(){return this.bufferData.isEmpty()&&this.elevationBufferData.isEmpty()}uploadPending(){return!this.uploaded||this.bufferData.needsUpload()||this.elevationBufferData.needsUpload()}upload(e){this.bufferData.upload(e),this.elevationBufferData.upload(e),this.elevatedStructures&&this.elevatedStructures.upload(e)}destroy(){this.bufferData.destroy(),this.elevationBufferData.destroy(),this.elevatedStructures&&this.elevatedStructures.destroy()}addFeature(e,i,c,u,p,m=[],v,S){const T=Q0(i,500);this.elevationMode!=="none"?this.addElevatedRoadFeature(e,T,u,c,S):this.addGeometry(T,this.bufferData),this.bufferData.populatePaintArrays(e,c,p,m,u,v,this.worldview),this.elevationBufferData.populatePaintArrays(e,c,p,m,u,v,this.worldview)}getUnevaluatedPortalGraph(){return this.elevatedStructures?this.elevatedStructures.unevaluatedPortals:void 0}getElevationPolygons(){return this.elevatedStructures?this.elevatedStructures.portalPolygons:void 0}setEvaluatedPortalGraph(e,i,c,u,p){this.elevatedStructures&&(this.elevatedStructures.construct(e),this.elevatedStructures.populatePaintArrays(i,c,u,p,this.worldview))}addElevatedRoadFeature(e,i,c,u,p){const m=new Array,v=Fo.getElevationFeature(e,p);if(!v)return void this.addGeometry(i,this.bufferData);{const T=this.clipPolygonsToTile(i,1);T.length>0&&m.push({polygons:T,elevationFeature:v,elevationTileID:c})}const S={guardRailEnabled:this.layers[0].layout.get("fill-construct-bridge-guard-rail").evaluate(e,{},c),featureIndex:u};for(const T of m)if(T.elevationFeature){if(this.elevationMode==="hd-road-base"){this.elevatedStructures||(this.elevatedStructures=new ia(T.elevationTileID,this.layers,this.zoom,this.lut));const P=T.elevationFeature.isTunnel();let M=0;e.properties.hasOwnProperty(ri)&&(M=+e.properties[ri]);for(const L of T.polygons)this.elevatedStructures.addPortalCandidates(T.elevationFeature.id,L,P,T.elevationFeature,M)}T.elevationFeature.constantHeight==null&&(T.polygons=this.prepareElevatedPolygons(T.polygons,T.elevationFeature,T.elevationTileID));const I=new xa(c,T.elevationTileID);this.addElevatedGeometry(T.polygons,I,T.elevationFeature,this.elevationMode==="hd-road-base"?0:.05,u,S)}}addElevatedGeometry(e,i,c,u,p,m){const v={elevation:c,elevationSampler:i,bias:u,index:p,featureInfo:m},[S,T]=this.addGeometry(e,this.elevationBufferData,v);this.elevationBufferData.heightRange==null?this.elevationBufferData.heightRange={min:S,max:T}:(this.elevationBufferData.heightRange.min=Math.min(this.elevationBufferData.heightRange.min,S),this.elevationBufferData.heightRange.max=Math.max(this.elevationBufferData.heightRange.max,T))}addGeometry(e,i,c){let u=Number.POSITIVE_INFINITY,p=Number.NEGATIVE_INFINITY,m=null;c&&(m=c.elevationSampler.constantElevation(c.elevation,c.bias),m!=null&&(u=m,p=m));const v=(S,T,I)=>{if(c!=null)if(T.push(S),m!=null)i.elevatedLayoutVertexArray.emplaceBack(m),I.push(m);else{const P=c.elevationSampler.pointElevation(S,c.elevation,c.bias);i.elevatedLayoutVertexArray.emplaceBack(P),I.push(P),u=Math.min(u,P),p=Math.max(p,P)}};for(const S of e){let T=0;for(const ce of S)T+=ce.length;const I=i.triangleSegments.prepareSegment(T,i.layoutVertexArray,i.indexArray),P=I.vertexLength,M=[],L=[],O=[],G=[],Z=[],Q=i.layoutVertexArray.length;for(const ce of S){if(ce.length===0)continue;ce!==S[0]&&L.push(M.length/2);const q=i.lineSegments.prepareSegment(ce.length,i.layoutVertexArray,i.lineIndexArray),re=q.vertexLength;c&&Z.push(i.layoutVertexArray.length-Q),v(ce[0],O,G),i.layoutVertexArray.emplaceBack(ce[0].x,ce[0].y),i.lineIndexArray.emplaceBack(re+ce.length-1,re),M.push(ce[0].x),M.push(ce[0].y);for(let ue=1;ue<ce.length;ue++)v(ce[ue],O,G),i.layoutVertexArray.emplaceBack(ce[ue].x,ce[ue].y),i.lineIndexArray.emplaceBack(re+ue-1,re+ue),M.push(ce[ue].x),M.push(ce[ue].y);q.vertexLength+=ce.length,q.primitiveLength+=ce.length}const le=xy(M,L);for(let ce=0;ce<le.length;ce+=3)i.indexArray.emplaceBack(P+le[ce],P+le[ce+1],P+le[ce+2]);if(le.length>0&&c&&this.elevationMode==="hd-road-base"){const ce=c.elevation.isTunnel(),q=c.elevation.safeArea,re=this.elevatedStructures.addVertices(O,G);this.elevatedStructures.addTriangles(le,re,ce);const ue=Z.length;if(ue>0){for(let pe=0;pe<ue-1;pe++)this.elevatedStructures.addRenderableRing(c.index,Z[pe]+re,Z[pe+1]-Z[pe],ce,q,c.featureInfo);this.elevatedStructures.addRenderableRing(c.index,Z[ue-1]+re,O.length-Z[ue-1],ce,q,c.featureInfo)}}I.vertexLength+=T,I.primitiveLength+=le.length/3}return[u,p]}prepareElevatedPolygons(e,i,c){const u=1/Xe(c),p=[];for(const m of e){const v=GV(m,new wo(i,u));p.push(...v)}return p}clipPolygonsToTile(e,i){const c=-i,u=-i,p=Lt+i,m=Lt+i;let v=0;const S=[],T=[];for(;v<e.length;v++){const M=e[v],L=w_(M);(L.min.x>=c&&L.max.x<=p&&L.min.y>=u&&L.max.y<=m?S:T).push(M)}if(S.length===e.length)return e;const I=[new Dt(c,u),new Dt(p,u),new Dt(p,m),new Dt(c,m),new Dt(c,u)],P=S;for(const M of T)P.push(...$V(M,I));return P}}let ZP,XP,YP,KP;Ht(PS,"FillBucket",{omit:["layers","patternFeatures"]}),Ht(IS,"FillBufferData"),Ht(ia,"ElevatedStructures");class MS{constructor(e,i,c,u){if(this.triangleCount=i.length/3,this.min=new Dt(0,0),this.max=new Dt(0,0),this.xScale=0,this.yScale=0,this.cellsX=0,this.cellsY=0,this.cells=[],this.payload=[],this.triangleCount===0||e.length===0)return;const[p,m]=[e[0].clone(),e[0].clone()];for(let P=1;P<e.length;++P){const M=e[P];p.x=Math.min(p.x,M.x),p.y=Math.min(p.y,M.y),m.x=Math.max(m.x,M.x),m.y=Math.max(m.y,M.y)}if(u){const P=Math.ceil(Math.max(m.x-p.x,m.y-p.y)/u);c=Math.max(c,P)}if(c===0)return;this.min=p,this.max=m;const v=this.max.sub(this.min);v.x=Math.max(v.x,1),v.y=Math.max(v.y,1);const S=Math.max(v.x,v.y)/c;this.cellsX=Math.max(1,Math.ceil(v.x/S)),this.cellsY=Math.max(1,Math.ceil(v.y/S)),this.xScale=1/S,this.yScale=1/S;const T=[];for(let P=0;P<this.triangleCount;P++){const M=e[i[3*P+0]].sub(this.min),L=e[i[3*P+1]].sub(this.min),O=e[i[3*P+2]].sub(this.min),G=mc(Math.floor(Math.min(M.x,L.x,O.x)),this.xScale,this.cellsX),Z=mc(Math.floor(Math.max(M.x,L.x,O.x)),this.xScale,this.cellsX),Q=mc(Math.floor(Math.min(M.y,L.y,O.y)),this.yScale,this.cellsY),le=mc(Math.floor(Math.max(M.y,L.y,O.y)),this.yScale,this.cellsY),ce=new Dt(0,0),q=new Dt(0,0),re=new Dt(0,0),ue=new Dt(0,0);for(let pe=Q;pe<=le;++pe){ce.y=q.y=pe*S,re.y=ue.y=(pe+1)*S;for(let Ae=G;Ae<=Z;++Ae)ce.x=re.x=Ae*S,q.x=ue.x=(Ae+1)*S,(gS(M,L,O,ce,q,ue)||gS(M,L,O,ce,ue,re))&&T.push({cellIdx:pe*this.cellsX+Ae,triIdx:P})}}if(T.length===0)return;T.sort((P,M)=>P.cellIdx-M.cellIdx||P.triIdx-M.triIdx);let I=0;for(;I<T.length;){const P=T[I].cellIdx,M={start:this.payload.length,len:0};for(;I<T.length&&T[I].cellIdx===P;)++M.len,this.payload.push(T[I++].triIdx);this.cells[P]=M}}_lazyInitLookup(){this.lookup||(this.lookup=new Uint8Array(Math.ceil(this.triangleCount/8))),this.lookup.fill(0)}queryPoint(e,i){if(this.triangleCount===0||this.cells.length===0||e.x>this.max.x||this.min.x>e.x||e.y>this.max.y||this.min.y>e.y)return;const c=mc(e.x-this.min.x,this.xScale,this.cellsX),u=mc(e.y-this.min.y,this.yScale,this.cellsY),p=this.cells[u*this.cellsX+c];if(p){this._lazyInitLookup();for(let m=0;m<p.len;m++){const v=this.payload[p.start+m],S=Math.floor(v/8),T=1<<v%8;if(!(this.lookup[S]&T)&&(this.lookup[S]|=T,i.push(v),i.length===this.triangleCount))return}}}query(e,i,c){if(this.triangleCount===0||this.cells.length===0||e.x>this.max.x||this.min.x>i.x||e.y>this.max.y||this.min.y>i.y)return;this._lazyInitLookup();const u=mc(e.x-this.min.x,this.xScale,this.cellsX),p=mc(i.x-this.min.x,this.xScale,this.cellsX),m=mc(e.y-this.min.y,this.yScale,this.cellsY),v=mc(i.y-this.min.y,this.yScale,this.cellsY);for(let S=m;S<=v;S++)for(let T=u;T<=p;T++){const I=this.cells[S*this.cellsX+T];if(I)for(let P=0;P<I.len;P++){const M=this.payload[I.start+P],L=Math.floor(M/8),O=1<<M%8;if(!(this.lookup[L]&O)&&(this.lookup[L]|=O,c.push(M),c.length===this.triangleCount))return}}}}function mc(o,e,i){return Math.max(0,Math.min(i-1,Math.floor(o*e)))}Ht(MS,"TriangleGridIndex");class QP{constructor(e){this.zoom=e.zoom,this.layers=e.layers,this.layerIds=this.layers.map(i=>i.fqid),this.index=e.index,this.hasPattern=!1,this.stateDependentLayerIds=this.layers.filter(i=>i.isStateDependent()).map(i=>i.id),this.footprints=[],this.worldview=e.worldview}updateFootprints(e,i){for(const c of this.footprints)i.push({footprint:c,id:e})}populate(e,i,c,u){const p=[];for(const{feature:m,id:v,index:S,sourceLayerIndex:T}of e){const I=this.layers[0]._featureFilter.needGeometry,P=Vt(m,I);if(!this.layers[0]._featureFilter.filter(new Fr(this.zoom,{worldview:this.worldview}),P,c))continue;const M={id:v,properties:m.properties,type:m.type,sourceLayerIndex:T,index:S,geometry:I?P.geometry:Wt(m,c,u),patterns:{}};p.push(M)}for(const m of p){const{geometry:v,index:S,sourceLayerIndex:T}=m;this.addFeature(m,v,S,c,{},i.availableImages,i.brightness),i.featureIndex.insert(e[S].feature,v,S,T,this.index)}}isEmpty(){return this.footprints.length===0}uploadPending(){return!1}upload(e){}update(e,i,c,u,p,m,v){}destroy(){}addFeature(e,i,c,u,p,m=[],v){for(const S of Q0(i,2)){const T=[],I=[],P=[],M=new Dt(1/0,1/0),L=new Dt(-1/0,-1/0);for(const Z of S)if(Z.length!==0){Z!==S[0]&&P.push(I.length/2);for(let Q=0;Q<Z.length;Q++)I.push(Z[Q].x),I.push(Z[Q].y),T.push(Z[Q]),M.x=Math.min(M.x,Z[Q].x),M.y=Math.min(M.y,Z[Q].y),L.x=Math.max(L.x,Z[Q].x),L.y=Math.max(L.y,Z[Q].y)}const O=xy(I,P),G=new MS(T,O,8,256);this.footprints.push({vertices:T,indices:O,grid:G,min:M,max:L})}}}Ht(QP,"ClipBucket",{omit:["layers"]});const HV=hr([{name:"a_pos_normal_ed",components:4,type:"Int16"}]),qV=hr([{name:"a_pos_end",components:4,type:"Int16"},{name:"a_angular_offset_factor",components:1,type:"Int16"}]),WV=hr([{name:"a_centroid_pos",components:2,type:"Uint16"}]),ZV=hr([{name:"a_join_normal_inside",components:3,type:"Int16"}]),XV=hr([{name:"a_hidden_by_landmark",components:1,type:"Uint8"}]),YV=hr([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]),{members:KV}=HV,e1=Number.MAX_SAFE_INTEGER;function JP(o,e,i,c){return o.order<e||o.order===e1||!(o.clipMask&i)||function(u,p){return p.length!==0&&p.find(m=>m===u)===void 0}(c,o.clipScope)}function t1(o,e){return o.x-e.x||o.y-e.y}function eM(o,e){return t1(o.min,e.min)===0&&t1(o.max,e.max)===0}function RS(o,e){return!(o.min.x>e.max.x||o.max.x<e.min.x||o.min.y>e.max.y||o.max.y<e.min.y)}function kS(o,e){if(o.length!==e.length)return!1;for(let i=0;i<o.length;i++)if(o[i].sourceId!==e[i].sourceId||!eM(o[i],e[i])||o[i].order!==e[i].order||o[i].clipMask!==e[i].clipMask||!rl(o[i].clipScope,e[i].clipScope))return!1;return!0}function tM(o,e,i){const c=1/Lt,u=1/(1<<i.canonical.z),p=(e.x*c+i.canonical.x)*u+i.wrap,m=(e.y*c+i.canonical.y)*u;return{min:new Dt((o.x*c+i.canonical.x)*u+i.wrap,(o.y*c+i.canonical.y)*u),max:new Dt(p,m)}}function QV(o,e,i){const c=1<<i.canonical.z,u=((e.x-i.wrap)*c-i.canonical.x)*Lt,p=(e.y*c-i.canonical.y)*Lt;return{min:new Dt(((o.x-i.wrap)*c-i.canonical.x)*Lt,(o.y*c-i.canonical.y)*Lt),max:new Dt(u,p)}}function nM(o,e,i,c,u,p,m){const v=o.indices,S=o.vertices,T=[];for(let I=c;I<c+u;I+=3){const P=e[i[I+0]+p],M=e[i[I+1]+p],L=e[i[I+2]+p],O=Math.min(P.x,M.x,L.x),G=Math.max(P.x,M.x,L.x),Z=Math.min(P.y,M.y,L.y),Q=Math.max(P.y,M.y,L.y);T.length=0,o.grid.query(new Dt(O,Z),new Dt(G,Q),T);for(let le=0;le<T.length;le++){const ce=T[le];if(gS(S[v[3*ce+0]],S[v[3*ce+1]],S[v[3*ce+2]],P,M,L,m))return!0}}return!1}function rM(o,e,i,c){if(!o||!i)return!1;let u=o.vertices;if(!e.canonical.equals(c.canonical)||e.wrap!==c.wrap){if(i.vertices.length<o.vertices.length)return rM(i,c,o,e);const p=e.canonical,m=c.canonical,v=Math.pow(2,m.z-p.z);u=o.vertices.map(S=>new Dt((S.x+p.x*Lt)*v-m.x*Lt,(S.y+p.y*Lt)*v-m.y*Lt))}return nM(i,u,o.indices,0,o.indices.length,0,0)}function iM(o,e,i,c){const u=Math.pow(2,c.z-i.z);return new Dt((o+i.x*Lt)*u-c.x*Lt,(e+i.y*Lt)*u-c.y*Lt)}function sM(o,e){const i=[];e.grid.queryPoint(o,i);const c=e.indices,u=e.vertices;for(let p=0;p<i.length;p++){const m=i[p];if(Ua([u[c[3*m+0]],u[c[3*m+1]],u[c[3*m+2]]],o))return!0}return!1}const DS=[new Dt(0,0),new Dt(Lt,0),new Dt(Lt,Lt),new Dt(0,Lt)];function oM(o,e){const i=[];let c=[];if(!e||o.length<2)return[o];if(o.length===2)return au(o[0],o[1],DS)?[o]:[];for(let u=0;u<o.length+2;u++){const p=o[u%o.length],m=o[(u+1)%o.length],v=au(u===0?o[o.length-1]:o[(u-1)%o.length],p,DS),S=au(p,m,DS),T=v||S;T&&c.push(p),T&&S||c.length>0&&(c.length>1&&i.push(c),c=[])}return c.length>1&&i.push(c),i}const LS=Gn.VectorTileFeature.types,JV=["fill-extrusion-base","fill-extrusion-height","fill-extrusion-color","fill-extrusion-pattern","fill-extrusion-flood-light-wall-radius","fill-extrusion-line-width","fill-extrusion-emissive-strength"],e6=["fill-extrusion-flood-light-ground-radius"],t6=Math.pow(2,13),n6=Math.pow(2,15)-1,aM=new Dt(0,1),gd=2147483648;function Ey(o,e,i,c,u,p,m,v){o.emplaceBack((e<<1)+m,(i<<1)+p,(Math.floor(c*t6)<<1)+u,Math.round(v))}function Cy(o,e,i){o.emplaceBack(e.x*Lt,e.y*Lt,i?1:0)}function n1(o,e,i,c,u,p){o.emplaceBack(e.x,e.y,(i.x<<1)+c,(i.y<<1)+u,p)}function Ay(o,e,i){o.emplaceBack(e.x,e.y,e.z,i[0]*16384,i[1]*16384,i[2]*16384)}class lM{constructor(){this.vertexOffset=0,this.vertexCount=0,this.indexOffset=0,this.indexCount=0}}class cM{constructor(){this.centroidXY=new Dt(0,0),this.vertexArrayOffset=0,this.vertexCount=0,this.groundVertexArrayOffset=0,this.groundVertexCount=0,this.flags=0,this.footprintSegIdx=-1,this.footprintSegLen=0,this.polygonSegIdx=-1,this.polygonSegLen=0,this.min=new Dt(Number.MAX_VALUE,Number.MAX_VALUE),this.max=new Dt(-Number.MAX_VALUE,-Number.MAX_VALUE),this.height=0}span(){return new Dt(this.max.x-this.min.x,this.max.y-this.min.y)}}class uM{constructor(){this.acc=new Dt(0,0),this.accCount=0,this.centroidDataIndex=0}startRing(e,i){e.min.x===Number.MAX_VALUE&&(e.min.x=e.max.x=i.x,e.min.y=e.max.y=i.y)}appendEdge(e,i,c){this.accCount++,this.acc._add(i);let u=!!this.borders;i.x<e.min.x?(e.min.x=i.x,u=!0):i.x>e.max.x&&(e.max.x=i.x,u=!0),i.y<e.min.y?(e.min.y=i.y,u=!0):i.y>e.max.y&&(e.max.y=i.y,u=!0),((i.x===0||i.x===Lt)&&i.x===c.x)!=((i.y===0||i.y===Lt)&&i.y===c.y)&&this.processBorderOverlap(i,c),u&&this.checkBorderIntersection(i,c)}checkBorderIntersection(e,i){i.x<0!=e.x<0&&this.addBorderIntersection(0,vn(i.y,e.y,(0-i.x)/(e.x-i.x))),i.x>Lt!=e.x>Lt&&this.addBorderIntersection(1,vn(i.y,e.y,(Lt-i.x)/(e.x-i.x))),i.y<0!=e.y<0&&this.addBorderIntersection(2,vn(i.x,e.x,(0-i.y)/(e.y-i.y))),i.y>Lt!=e.y>Lt&&this.addBorderIntersection(3,vn(i.x,e.x,(Lt-i.y)/(e.y-i.y)))}addBorderIntersection(e,i){this.borders||(this.borders=[[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE]]);const c=this.borders[e];i<c[0]&&(c[0]=i),i>c[1]&&(c[1]=i)}processBorderOverlap(e,i){if(e.x===i.x){if(e.y===i.y)return;const c=e.x===0?0:1;this.addBorderIntersection(c,i.y),this.addBorderIntersection(c,e.y)}else{const c=e.y===0?2:3;this.addBorderIntersection(c,i.x),this.addBorderIntersection(c,e.x)}}centroid(){return this.accCount===0?new Dt(0,0):new Dt(Math.floor(Math.max(0,this.acc.x)/this.accCount),Math.floor(Math.max(0,this.acc.y)/this.accCount))}intersectsCount(){return this.borders?this.borders.reduce((e,i)=>e+ +(i[0]!==Number.MAX_VALUE),0):0}}function dM(o,e){const i=o.add(e)._unit(),c=xe(o.x*i.x+o.y*i.y,-1,1);var u,p,m;return u=Math.acos(c),Math.min(4,Math.max(-4,Math.tan(u)))/4*n6*((p=o).x*(m=e).y-p.y*m.x<0?-1:1)}const r6=[o=>o.x<0,o=>o.x>Lt,o=>o.y<0,o=>o.y>Lt];function i6(o,e,i,c){const u=[4];if(c===0)return u;i._mult(c);const p=o.sub(i),m=e.sub(i),v=[o,e,p,m];for(let S=0;S<4;S++)for(const T of v)if(r6[S](T)){u.push(S);break}return u}class hM{constructor(e){this.vertexArray=new id,this.indexArray=new bs,this.programConfigurations=new h(e.layers,{zoom:e.zoom,lut:e.lut},i=>e6.includes(i)),this._segments=new Ai,this.hiddenByLandmarkVertexArray=new mm,this._segmentToGroundQuads={},this._segmentToGroundQuads[0]=[],this._segmentToRegionTriCounts={},this._segmentToRegionTriCounts[0]=[0,0,0,0,0],this.regionSegments={},this.regionSegments[4]=new Ai}getDefaultSegment(){return this.regionSegments[4]}hasData(){return this.vertexArray.length!==0}addData(e,i,c,u=!1){const p=e.length;if(p>2){let m=Math.max(0,this._segments.get().length-1);const v=this._segments._prepareSegment(4*p,this.vertexArray.length,2*this._segmentToGroundQuads[m].length);let S;m!==this._segments.get().length-1&&(m++,this._segmentToGroundQuads[m]=[],this._segmentToRegionTriCounts[m]=[0,0,0,0,0]);{const T=e[0],I=e[1];S=dM(T.sub(e[p-1])._perp()._unit(),I.sub(T)._perp()._unit())}for(let T=0;T<p;T++){const I=T===p-1?0:T+1,P=e[T],M=e[I],L=e[I===p-1?0:I+1],O=M.sub(P)._perp()._unit(),G=dM(O,L.sub(M)._perp()._unit()),Z=S,Q=G;if(NS(P,M,i)||u&&mM(P,i)&&mM(M,i)){S=G;continue}const le=v.vertexLength;n1(this.vertexArray,P,M,1,1,Z),n1(this.vertexArray,P,M,1,0,Z),n1(this.vertexArray,P,M,0,1,Q),n1(this.vertexArray,P,M,0,0,Q),v.vertexLength+=4;const ce=i6(P,M,O,c);for(const q of ce)this._segmentToGroundQuads[m].push({id:le,region:q}),this._segmentToRegionTriCounts[m][q]+=2,v.primitiveLength+=2;S=G}}}prepareBorderSegments(){if(!this.hasData())return;const e=this._segments.get(),i=e.length;for(let c=0;c<i;c++)this._segmentToGroundQuads[c].sort((u,p)=>u.region-p.region);for(let c=0;c<i;c++){const u=this._segmentToGroundQuads[c],p=e[c],m=this._segmentToRegionTriCounts[c];m.reduce((S,T)=>S+T,0);let v=0;for(let S=0;S<=4;S++){const T=m[S];if(T!==0){let I=this.regionSegments[S];I||(I=this.regionSegments[S]=new Ai);const P={vertexOffset:p.vertexOffset,primitiveOffset:p.primitiveOffset+v,vertexLength:p.vertexLength,primitiveLength:T};I.get().push(P)}v+=T}for(let S=0;S<u.length;S++){const T=u[S].id;this.indexArray.emplaceBack(T,T+1,T+3),this.indexArray.emplaceBack(T,T+3,T+2)}}this._segmentToGroundQuads=null,this._segmentToRegionTriCounts=null,this._segments.destroy(),this._segments=null}addPaintPropertiesData(e,i,c,u,p,m,v){this.hasData()&&this.programConfigurations.populatePaintArrays(this.vertexArray.length,e,i,c,u,p,m,void 0,v)}upload(e){this.hasData()&&(this.vertexBuffer=e.createVertexBuffer(this.vertexArray,qV.members),this.indexBuffer=e.createIndexBuffer(this.indexArray))}uploadPaintProperties(e){this.hasData()&&this.programConfigurations.upload(e)}update(e,i,c,u,p,m,v,S){this.hasData()&&this.programConfigurations.updatePaintArrays(e,i,c,u,p,m,v,S)}updateHiddenByLandmark(e){if(!this.hasData())return;const i=e.groundVertexCount+e.groundVertexArrayOffset;if(e.groundVertexCount===0)return;const c=e.flags&gd?1:0;for(let u=e.groundVertexArrayOffset;u<i;++u)this.hiddenByLandmarkVertexArray.emplace(u,c);this._needsHiddenByLandmarkUpdate=!0}uploadHiddenByLandmark(e){this.hasData()&&this._needsHiddenByLandmarkUpdate&&(!this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexArray.length>0?this.hiddenByLandmarkVertexBuffer=e.createVertexBuffer(this.hiddenByLandmarkVertexArray,XV.members,!0):this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexBuffer.updateData(this.hiddenByLandmarkVertexArray),this._needsHiddenByLandmarkUpdate=!1)}destroy(){if(this.vertexBuffer){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexBuffer.destroy(),this._segments&&this._segments.destroy(),this.programConfigurations.destroy();for(let e=0;e<=4;e++){const i=this.regionSegments[e];i&&i.destroy()}}}}class r1{constructor(e){this.zoom=e.zoom,this.canonical=e.canonical,this.overscaling=e.overscaling,this.layers=e.layers,this.pixelRatio=e.pixelRatio,this.layerIds=this.layers.map(i=>i.fqid),this.index=e.index,this.hasPattern=!1,this.edgeRadius=0,this.projection=e.projection,this.activeReplacements=[],this.replacementUpdateTime=0,this.centroidData=[],this.footprintIndices=new bs,this.footprintVertices=new ml,this.footprintSegments=[],this.layoutVertexArray=new rd,this.centroidVertexArray=new F0,this.wallVertexArray=new B0,this.indexArray=new bs,this.programConfigurations=new h(e.layers,{zoom:e.zoom,lut:e.lut},i=>JV.includes(i)),this.segments=new Ai,this.stateDependentLayerIds=this.layers.filter(i=>i.isStateDependent()).map(i=>i.id),this.groundEffect=new hM(e),this.maxHeight=0,this.partLookup={},this.triangleSubSegments=[],this.polygonSegments=[],this.worldview=e.worldview}updateFootprints(e,i){}populate(e,i,c,u){this.features=[],this.hasPattern=ES("fill-extrusion",this.layers,this.pixelRatio,i),this.featuresOnBorder=[],this.borderFeatureIndices=[[],[],[],[]],this.borderDoneWithNeighborZ=[-1,-1,-1,-1],this.selfDEMTileTimestamp=Number.MAX_VALUE,this.borderDEMTileTimestamp=[Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE],this.tileToMeter=Xe(c),this.edgeRadius=this.layers[0].layout.get("fill-extrusion-edge-radius")/this.tileToMeter,this.wallMode=this.layers[0].paint.get("fill-extrusion-line-width").constantOr(1)!==0;for(const{feature:p,id:m,index:v,sourceLayerIndex:S}of e){const T=this.layers[0]._featureFilter.needGeometry,I=Vt(p,T);if(!this.layers[0]._featureFilter.filter(new Fr(this.zoom,{worldview:this.worldview}),I,c))continue;const P={id:m,sourceLayerIndex:S,index:v,geometry:T?I.geometry:Wt(p,c,u),properties:p.properties,type:p.type,patterns:{}},M=this.layoutVertexArray.length,L=LS[P.type]==="Polygon";if(this.hasPattern)this.features.push(CS("fill-extrusion",this.layers,P,this.zoom,this.pixelRatio,i));else if(this.wallMode)for(const O of P.geometry)for(const G of oM(O,L))this.addFeature(P,[G],v,c,{},i.availableImages,u,i.brightness);else this.addFeature(P,P.geometry,v,c,{},i.availableImages,u,i.brightness);i.featureIndex.insert(p,P.geometry,v,S,this.index,M)}this.sortBorders(),this.projection.name==="mercator"&&this.splitToSubtiles(),this.groundEffect.prepareBorderSegments(),this.polygonSegments.length=0}addFeatures(e,i,c,u,p,m){for(const v of this.features){const S=LS[v.type]==="Polygon",{geometry:T}=v;if(this.wallMode)for(const I of T)for(const P of oM(I,S))this.addFeature(v,[P],v.index,i,c,u,p,m);else this.addFeature(v,T,v.index,i,c,u,p,m)}this.sortBorders(),this.projection.name==="mercator"&&this.splitToSubtiles()}update(e,i,c,u,p,m,v){this.programConfigurations.updatePaintArrays(e,i,p,c,u,m,v,this.worldview),this.groundEffect.update(e,i,p,c,u,m,v,this.worldview)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload||this.groundEffect.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,KV),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.wallVertexBuffer=e.createVertexBuffer(this.wallVertexArray,ZV.members),this.layoutVertexExtArray&&(this.layoutVertexExtBuffer=e.createVertexBuffer(this.layoutVertexExtArray,YV.members,!0)),this.groundEffect.upload(e)),this.groundEffect.uploadPaintProperties(e),this.programConfigurations.upload(e),this.uploaded=!0}uploadCentroid(e){this.groundEffect.uploadHiddenByLandmark(e),this.needsCentroidUpdate&&(!this.centroidVertexBuffer&&this.centroidVertexArray.length>0?this.centroidVertexBuffer=e.createVertexBuffer(this.centroidVertexArray,WV.members,!0):this.centroidVertexBuffer&&this.centroidVertexBuffer.updateData(this.centroidVertexArray),this.needsCentroidUpdate=!1)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.centroidVertexBuffer&&this.centroidVertexBuffer.destroy(),this.layoutVertexExtBuffer&&this.layoutVertexExtBuffer.destroy(),this.groundEffect.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(e,i,c,u,p,m,v,S){const T=this.layers[0].paint.get("fill-extrusion-flood-light-ground-radius").evaluate(e,{})/this.tileToMeter,I=[new Dt(0,0),new Dt(Lt,Lt)],P=v.projection,M=P.name==="globe",L=this.wallMode||LS[e.type]==="Polygon",O=new uM;O.centroidDataIndex=this.centroidData.length;const G=new cM,Z=this.layers[0].paint.get("fill-extrusion-base").evaluate(e,{},u)<=0,Q=this.layers[0].paint.get("fill-extrusion-height").evaluate(e,{},u);let le;if(G.height=Q,G.vertexArrayOffset=this.layoutVertexArray.length,G.groundVertexArrayOffset=this.groundEffect.vertexArray.length,M&&!this.layoutVertexExtArray&&(this.layoutVertexExtArray=new hm),this.wallMode){if(M)return void On("Non zero fill-extrusion-line-width is not yet supported on globe.");if(i.length!==1)return;le=function(Ie){const Ne=Ie[0].x===Ie[Ie.length-1].x&&Ie[0].y===Ie[Ie.length-1].y;(function(Ot){let wt=0;const Pn=Ot.length;for(let Yt=0;Yt<Pn;Yt++)wt+=(Ot[(Yt+1)%Pn].x-Ot[Yt].x)*(Ot[(Yt+1)%Pn].y+Ot[Yt].y);return wt>=0})(Ie)||(Ie=Ie.reverse());const yt={geometry:[],joinNormals:[],indices:[]},at=[],_t=[],xt=[];let et=Ie.length;for(;et>=2&&Ie[et-1].equals(Ie[et-2]);)et--;if(et<(Ne?3:2))return yt;let pt,Ze,Qe,St,Et,ln=0;for(;ln<et-1&&Ie[ln].equals(Ie[ln+1]);)ln++;Ne&&(pt=Ie[et-2],Et=Ie[ln].sub(pt)._unit()._perp());for(let Ot=ln;Ot<et;Ot++){if(Qe=Ot===et-1?Ne?Ie[ln+1]:void 0:Ie[Ot+1],Qe&&Ie[Ot].equals(Qe))continue;Et&&(St=Et),pt&&(Ze=pt),pt=Ie[Ot],Et=Qe?Qe.sub(pt)._unit()._perp():St,St=St||Et;let wt=St.add(Et);wt.x===0&&wt.y===0||wt._unit();const Pn=wt.x*Et.x+wt.y*Et.y,Yt=Pn!==0?1/Pn:1/0,Jt=St.x*Et.y-St.y*Et.x>0;let xn="miter";const zn=2;xn==="miter"&&Yt>zn&&(xn="bevel"),xn==="bevel"&&(Yt>100&&(xn="flipbevel"),Yt<zn&&(xn="miter"));const Nn=(Xn,Vn,Yn,Ir)=>{const Yr=new Dt(Xn.x,Xn.y),he=new Dt(Xn.x,Xn.y);Yr.x+=Vn.x*Ir,Yr.y+=Vn.y*Ir,he.x-=Vn.x*Math.max(Yn,1),he.y-=Vn.y*Math.max(Yn,1),xt.push(Vn),at.push(Yr),_t.push(he)};if(xn==="miter")wt._mult(Yt),Nn(pt,wt,0,0);else if(xn==="flipbevel")wt=Et.mult(-1),Nn(pt,wt,0,0),Nn(pt,wt.mult(-1),0,0);else{const Xn=-Math.sqrt(Yt*Yt-1),Vn=Jt?Xn:0,Yn=Jt?0:Xn;Ze&&Nn(pt,St,Vn,Yn),Qe&&Nn(pt,Et,Vn,Yn)}}yt.geometry=[...at,..._t.reverse(),at[0]],yt.joinNormals=[...xt,...xt.reverse(),xt[xt.length-1]];const Kt=yt.geometry.length-1;for(let Ot=0;Ot<Kt/2;Ot++)if(Ot+1<Kt/2){let wt=Ot,Pn=Ot+1,Yt=Kt-1-Ot,Jt=Kt-2-Ot;wt=wt===0?Kt-1:wt-1,Pn=Pn===0?Kt-1:Pn-1,Yt=Yt===0?Kt-1:Yt-1,Jt=Jt===0?Kt-1:Jt-1,yt.indices.push(Yt),yt.indices.push(Pn),yt.indices.push(wt),yt.indices.push(Yt),yt.indices.push(Jt),yt.indices.push(Pn)}return yt}(i[0]),i=[le.geometry]}const ce=(Ie,Ne)=>Ie<(Ne.length-1)/2||Ie===Ne.length-1,q=this.wallMode?[i]:Q0(i,500);for(let Ie=q.length-1;Ie>=0;Ie--){const Ne=q[Ie];(Ne.length===0||(re=Ne[0]).every(Ke=>Ke.x<=0)||re.every(Ke=>Ke.x>=Lt)||re.every(Ke=>Ke.y<=0)||re.every(Ke=>Ke.y>=Lt))&&q.splice(Ie,1)}var re;let ue;if(M)ue=vM(q,I,u);else{ue=[];for(const Ie of q)ue.push({polygon:Ie,bounds:I})}const pe=L?this.edgeRadius:0,Ae=pe>0&&this.zoom<17,Te=(Ie,Ne)=>{if(Ie.length===0)return!1;const Ke=Ie[Ie.length-1];return Ne.x===Ke.x&&Ne.y===Ke.y};for(const{polygon:Ie,bounds:Ne}of ue){let Ke=0,yt=0;for(const et of Ie)L&&!et[0].equals(et[et.length-1])&&et.push(et[0]),yt+=L?et.length-1:et.length;const at=this.segments.prepareSegment((L?5:4)*yt,this.layoutVertexArray,this.indexArray);G.footprintSegIdx<0&&(G.footprintSegIdx=this.footprintSegments.length),G.polygonSegIdx<0&&(G.polygonSegIdx=this.polygonSegments.length);const _t={triangleArrayOffset:this.indexArray.length,triangleCount:0,triangleSegIdx:this.segments.segments.length-1},xt=new lM;if(xt.vertexOffset=this.footprintVertices.length,xt.indexOffset=3*this.footprintIndices.length,xt.ringIndices=[],L){const et=[],pt=[];Ke=at.vertexLength;for(let Qe=0;Qe<Ie.length;Qe++){const St=Ie[Qe];St.length&&Qe!==0&&pt.push(et.length/2);const Et=[];let ln,Kt;ln=St[1].sub(St[0])._perp()._unit(),xt.ringIndices.push(St.length-1);for(let Ot=1;Ot<St.length;Ot++){const wt=St[Ot],Pn=St[Ot===St.length-1?1:Ot+1],Yt=wt.clone();if(pe){Kt=Pn.sub(wt)._perp()._unit();const Jt=ln.add(Kt)._unit(),xn=pe*Math.min(4,1/(ln.x*Jt.x+ln.y*Jt.y));Yt.x+=xn*Jt.x,Yt.y+=xn*Jt.y,Yt.x=Math.round(Yt.x),Yt.y=Math.round(Yt.y),ln=Kt}if(!Z||pe!==0&&!Ae||Te(Et,Yt)||Et.push(Yt),Ey(this.layoutVertexArray,Yt.x,Yt.y,0,0,1,1,0),this.wallMode){const Jt=ce(Ot,St);Cy(this.wallVertexArray,le.joinNormals[Ot],!Jt)}at.vertexLength++,this.footprintVertices.emplaceBack(wt.x,wt.y),et.push(wt.x,wt.y),M&&Ay(this.layoutVertexExtArray,P.projectTilePoint(Yt.x,Yt.y,u),P.upVector(u,Yt.x,Yt.y))}Z&&(pe===0||Ae)&&(Et.length!==0&&Te(Et,Et[0])&&Et.pop(),this.groundEffect.addData(Et,Ne,T))}const Ze=this.wallMode?le.indices:xy(et,pt);for(let Qe=0;Qe<Ze.length;Qe+=3)this.footprintIndices.emplaceBack(xt.vertexOffset+Ze[Qe+0],xt.vertexOffset+Ze[Qe+1],xt.vertexOffset+Ze[Qe+2]),this.indexArray.emplaceBack(Ke+Ze[Qe],Ke+Ze[Qe+2],Ke+Ze[Qe+1]),at.primitiveLength++;xt.indexCount+=Ze.length,xt.vertexCount+=this.footprintVertices.length-xt.vertexOffset}for(let et=0;et<Ie.length;et++){const pt=Ie[et];O.startRing(G,pt[0]);let Ze=pt.length>4&&gM(pt[pt.length-2],pt[0],pt[1]),Qe=pe?s6(pt[pt.length-2],pt[0],pt[1],pe):0;const St=[];let Et,ln,Kt;ln=pt[1].sub(pt[0])._perp()._unit();let Ot=!0;for(let wt=1,Pn=0;wt<pt.length;wt++){let Yt=pt[wt-1],Jt=pt[wt];const xn=pt[wt===pt.length-1?1:wt+1];if(O.appendEdge(G,Jt,Yt),NS(Jt,Yt,Ne)){pe&&(ln=xn.sub(Jt)._perp()._unit(),Ot=!Ot);continue}const zn=Jt.sub(Yt)._perp(),Nn=zn.x/(Math.abs(zn.x)+Math.abs(zn.y)),Xn=zn.y>0?1:0,Vn=Yt.dist(Jt);if(Pn+Vn>32768&&(Pn=0),pe){Kt=xn.sub(Jt)._perp()._unit();let he=pM(Yt,Jt,xn,fM(ln,Kt),pe);isNaN(he)&&(he=0);const me=Jt.sub(Yt)._unit();Yt=Yt.add(me.mult(Qe))._round(),Jt=Jt.add(me.mult(-he))._round(),Qe=he,ln=Kt,Z&&this.zoom>=17&&(Te(St,Yt)||St.push(Yt),Te(St,Jt)||St.push(Jt))}const Yn=at.vertexLength,Ir=pt.length>4&&gM(Yt,Jt,xn);let Yr=_M(Pn,Ze,Ot);if(Ey(this.layoutVertexArray,Yt.x,Yt.y,Nn,Xn,0,0,Yr),Ey(this.layoutVertexArray,Yt.x,Yt.y,Nn,Xn,0,1,Yr),this.wallMode){const he=ce(wt-1,pt),me=le.joinNormals[wt-1];Cy(this.wallVertexArray,me,he),Cy(this.wallVertexArray,me,he)}if(Pn+=Vn,Yr=_M(Pn,Ir,!Ot),Ze=Ir,Ey(this.layoutVertexArray,Jt.x,Jt.y,Nn,Xn,0,0,Yr),Ey(this.layoutVertexArray,Jt.x,Jt.y,Nn,Xn,0,1,Yr),this.wallMode){const he=ce(wt,pt),me=le.joinNormals[wt];Cy(this.wallVertexArray,me,he),Cy(this.wallVertexArray,me,he)}if(at.vertexLength+=4,this.indexArray.emplaceBack(Yn+0,Yn+1,Yn+2),this.indexArray.emplaceBack(Yn+1,Yn+3,Yn+2),at.primitiveLength+=2,pe){const he=Ke+(wt===1?pt.length-2:wt-2),me=wt===1?Ke:he+1;if(this.indexArray.emplaceBack(Yn+1,he,Yn+3),this.indexArray.emplaceBack(he,me,Yn+3),at.primitiveLength+=2,Et===void 0&&(Et=Yn),!NS(xn,pt[wt],Ne)){const nt=wt===pt.length-1?Et:at.vertexLength;this.indexArray.emplaceBack(Yn+2,Yn+3,nt),this.indexArray.emplaceBack(Yn+3,nt+1,nt),this.indexArray.emplaceBack(Yn+3,me,nt+1),at.primitiveLength+=3}Ot=!Ot}if(M){const he=this.layoutVertexExtArray,me=P.projectTilePoint(Yt.x,Yt.y,u),nt=P.projectTilePoint(Jt.x,Jt.y,u),Rt=P.upVector(u,Yt.x,Yt.y),Ft=P.upVector(u,Jt.x,Jt.y);Ay(he,me,Rt),Ay(he,me,Rt),Ay(he,nt,Ft),Ay(he,nt,Ft)}}L&&(Ke+=pt.length-1),Z&&pe&&this.zoom>=17&&(St.length!==0&&Te(St,St[0])&&St.pop(),this.groundEffect.addData(St,Ne,T,pe>0))}this.footprintSegments.push(xt),_t.triangleCount=this.indexArray.length-_t.triangleArrayOffset,this.polygonSegments.push(_t),++G.footprintSegLen,++G.polygonSegLen}if(G.vertexCount=this.layoutVertexArray.length-G.vertexArrayOffset,G.groundVertexCount=this.groundEffect.vertexArray.length-G.groundVertexArrayOffset,G.vertexCount!==0){if(G.centroidXY=O.borders?aM:this.encodeCentroid(O,G),this.centroidData.push(G),O.borders){this.featuresOnBorder.push(O);const Ie=this.featuresOnBorder.length-1;for(let Ne=0;Ne<O.borders.length;Ne++)O.borders[Ne][0]!==Number.MAX_VALUE&&this.borderFeatureIndices[Ne].push(Ie)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,c,p,m,u,S,void 0,this.worldview),this.groundEffect.addPaintPropertiesData(e,c,p,m,u,S,this.worldview),this.maxHeight=Math.max(this.maxHeight,Q)}}sortBorders(){for(let e=0;e<this.borderFeatureIndices.length;e++)this.borderFeatureIndices[e].sort((i,c)=>this.featuresOnBorder[i].borders[e][0]-this.featuresOnBorder[c].borders[e][0])}splitToSubtiles(){const e=[];for(let v=0;v<this.centroidData.length;v++){const S=this.centroidData[v],T=+(S.min.y+S.max.y>Lt),I=2*T+(+(S.min.x+S.max.x>Lt)^T);for(let P=0;P<S.polygonSegLen;P++){const M=S.polygonSegIdx+P;e.push({centroidIdx:v,subtile:I,polygonSegmentIdx:M,triangleSegmentIdx:this.polygonSegments[M].triangleSegIdx})}}const i=new bs;e.sort((v,S)=>v.triangleSegmentIdx===S.triangleSegmentIdx?v.subtile-S.subtile:v.triangleSegmentIdx-S.triangleSegmentIdx);let c=0,u=0,p=0;for(const v of e){if(v.triangleSegmentIdx!==c)break;p++}const m=e.length;for(;u!==e.length;){c=e[u].triangleSegmentIdx;let v=0,S=u,T=u;for(let I=S;I<p&&e[I].subtile===v;I++)T++;for(;S!==p;){const I=e[S];v=I.subtile;const P=this.centroidData[I.centroidIdx].min.clone(),M=this.centroidData[I.centroidIdx].max.clone(),L={vertexOffset:this.segments.segments[c].vertexOffset,primitiveOffset:i.length,vertexLength:this.segments.segments[c].vertexLength,primitiveLength:0,sortKey:void 0,vaos:{}};for(let O=S;O<T;O++){const G=e[O],Z=this.polygonSegments[G.polygonSegmentIdx],Q=this.centroidData[G.centroidIdx].min,le=this.centroidData[G.centroidIdx].max,ce=this.indexArray.uint16;for(let q=Z.triangleArrayOffset;q<Z.triangleArrayOffset+Z.triangleCount;q++)i.emplaceBack(ce[3*q],ce[3*q+1],ce[3*q+2]);L.primitiveLength+=Z.triangleCount,P.x=Math.min(P.x,Q.x),P.y=Math.min(P.y,Q.y),M.x=Math.max(M.x,le.x),M.y=Math.max(M.y,le.y)}L.primitiveLength>0&&this.triangleSubSegments.push({segment:L,min:P,max:M}),S=T;for(let O=S;O<p&&e[O].subtile===e[S].subtile;O++)T++}u=p;for(let I=u;I<m&&e[I].triangleSegmentIdx===e[u].triangleSegmentIdx;I++)p++}i._trim(),this.indexArray=i}getVisibleSegments(e,i,c){const u=new Ai;if(this.wallMode){for(const G of this.triangleSubSegments)u.segments.push(G.segment);return u}let p=0,m=0;const v=1<<e.canonical.z;if(i){const G=i.getMinMaxForTile(e);G&&(p=G.min,m=G.max)}m+=this.maxHeight;const S=e.toUnwrapped();let T;const I=[S.canonical.x/v+S.wrap,S.canonical.y/v],P=[(S.canonical.x+1)/v+S.wrap,(S.canonical.y+1)/v],M=(G,Z,Q)=>[G[0]*(1-Q[0])+Z[0]*Q[0],G[1]*(1-Q[1])+Z[1]*Q[1]],L=[],O=[];for(const G of this.triangleSubSegments){L[0]=G.min.x/Lt,L[1]=G.min.y/Lt,O[0]=G.max.x/Lt,O[1]=G.max.y/Lt;const Z=M(I,P,L),Q=M(I,P,O);if(new gr([Z[0],Z[1],p],[Q[0],Q[1],m]).intersectsPrecise(c)===0){T&&(u.segments.push(T),T=void 0);continue}const le=G.segment;T&&T.vertexOffset!==le.vertexOffset&&(u.segments.push(T),T=void 0),T?(T.vertexLength+=le.vertexLength,T.primitiveLength+=le.primitiveLength):T={vertexOffset:le.vertexOffset,primitiveLength:le.primitiveLength,vertexLength:le.vertexLength,primitiveOffset:le.primitiveOffset,sortKey:void 0,vaos:{}}}return T&&u.segments.push(T),u}encodeCentroid(e,i){const c=e.centroid(),u=i.span(),p=Math.min(7,Math.round(u.x*this.tileToMeter/10)),m=Math.min(7,Math.round(u.y*this.tileToMeter/10));return new Dt(xe(c.x,1,Lt-1)<<3|p,xe(c.y,1,Lt-1)<<3|m)}encodeBorderCentroid(e){if(!e.borders)return new Dt(0,0);const i=e.borders,c=Number.MAX_VALUE;if(i[0][0]!==c||i[1][0]!==c){const u=i[0][0]!==c?0:1;return new Dt(6|(i[0][0]!==c?0:65528),(i[u][0]+i[u][1])/2<<3|6)}{const u=i[2][0]!==c?2:3;return new Dt((i[u][0]+i[u][1])/2<<3|6,6|(i[2][0]!==c?0:65528))}}showCentroid(e){const i=this.centroidData[e.centroidDataIndex];i.flags&=gd,i.centroidXY.x=0,i.centroidXY.y=0,this.writeCentroidToBuffer(i)}writeCentroidToBuffer(e){this.groundEffect.updateHiddenByLandmark(e);const i=e.vertexArrayOffset,c=e.vertexCount+e.vertexArrayOffset,u=e.flags&gd?aM:e.centroidXY,p=this.centroidVertexArray.geta_centroid_pos0(i);if(this.centroidVertexArray.geta_centroid_pos1(i)!==u.y||p!==u.x){for(let m=i;m<c;++m)this.centroidVertexArray.emplace(m,u.x,u.y);this.needsCentroidUpdate=!0}}createCentroidsBuffer(){this.centroidVertexArray.resize(this.layoutVertexArray.length),this.groundEffect.hiddenByLandmarkVertexArray.resize(this.groundEffect.vertexArray.length);for(const e of this.centroidData)this.writeCentroidToBuffer(e)}updateReplacement(e,i,c){if(i.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=i.updateTime;const u=i.getReplacementRegionsForTile(e.toUnwrapped());if(kS(this.activeReplacements,u))return;if(this.activeReplacements=u,this.centroidVertexArray.length===0)this.createCentroidsBuffer();else for(const m of this.centroidData)m.flags&=2147483647;const p=[];for(const m of this.activeReplacements){if(m.order<c)continue;const v=Math.max(1,Math.pow(2,m.footprintTileId.canonical.z-e.canonical.z));for(const S of this.centroidData)if(!(S.flags&gd||m.min.x>S.max.x||S.min.x>m.max.x||m.min.y>S.max.y||S.min.y>m.max.y))for(let T=0;T<S.footprintSegLen;T++){const I=this.footprintSegments[S.footprintSegIdx+T];if(p.length=0,o6(this.footprintVertices,I.vertexOffset,I.vertexCount,m.footprintTileId.canonical,e.canonical,p),nM(m.footprint,p,this.footprintIndices.uint16,I.indexOffset,I.indexCount,-I.vertexOffset,-v)){S.flags|=gd;break}}}for(const m of this.centroidData)this.writeCentroidToBuffer(m);this.borderDoneWithNeighborZ=[-1,-1,-1,-1]}footprintContainsPoint(e,i,c){let u=!1;for(let p=0;p<c.footprintSegLen;p++){const m=this.footprintSegments[c.footprintSegIdx+p];let v=0;for(const S of m.ringIndices){for(let T=v,I=S+v-1;T<S+v;I=T++){const P=this.footprintVertices.int16[2*(T+m.vertexOffset)+0],M=this.footprintVertices.int16[2*(T+m.vertexOffset)+1],L=this.footprintVertices.int16[2*(I+m.vertexOffset)+1];M>i!=L>i&&e<(this.footprintVertices.int16[2*(I+m.vertexOffset)+0]-P)*(i-M)/(L-M)+P&&(u=!u)}v=S}}return u}getHeightAtTileCoord(e,i){let c=Number.NEGATIVE_INFINITY,u=!0;const p=4*(e+Lt)*Lt+(i+Lt);if(this.partLookup.hasOwnProperty(p)){const m=this.partLookup[p];return m?{height:m.height,hidden:!!(m.flags&gd)}:void 0}for(const m of this.centroidData)e>m.max.x||m.min.x>e||i>m.max.y||m.min.y>i||this.footprintContainsPoint(e,i,m)&&m&&m.height>c&&(c=m.height,this.partLookup[p]=m,u=!!(m.flags&gd));if(c!==Number.NEGATIVE_INFINITY)return{height:c,hidden:u};this.partLookup[p]=void 0}}function fM(o,e){const i=o.add(e)._unit();return o.x*i.x+o.y*i.y}function s6(o,e,i,c){const u=e.sub(o)._perp()._unit(),p=i.sub(e)._perp()._unit();return pM(o,e,i,fM(u,p),c)}function pM(o,e,i,c,u){const p=Math.sqrt(1-c*c);return Math.min(o.dist(e)/3,e.dist(i)/3,u*p/c)}function NS(o,e,i){return o.x<i[0].x&&e.x<i[0].x||o.x>i[1].x&&e.x>i[1].x||o.y<i[0].y&&e.y<i[0].y||o.y>i[1].y&&e.y>i[1].y}function mM(o,e){return o.x<e[0].x||o.x>e[1].x||o.y<e[0].y||o.y>e[1].y}function gM(o,e,i){if(o.x<0||o.x>=Lt||e.x<0||e.x>=Lt||i.x<0||i.x>=Lt)return!1;const c=i.sub(e),u=c.perp(),p=o.sub(e);return(c.x*p.x+c.y*p.y)/Math.sqrt((c.x*c.x+c.y*c.y)*(p.x*p.x+p.y*p.y))>-.866&&u.x*p.x+u.y*p.y<0}function _M(o,e,i){const c=e?2|o:-3&o;return i?1|c:-2&c}function yM(){const o=Math.PI/32,e=Math.tan(o),i=K;return i*Math.sqrt(1+2*e*e)-i}function vM(o,e,i){const c=1<<i.z,u=Ee(i.x/c),p=Ee((i.x+1)/c),m=Fe(i.y/c),v=Fe((i.y+1)/c);return function(S,T,I,P,M=0,L){const O=[];if(!S.length||!I||!P)return O;const G=(ue,pe)=>{for(const Ae of ue)O.push({polygon:Ae,bounds:pe})},Z=Math.ceil(Math.log2(I)),Q=Math.ceil(Math.log2(P)),le=Z-Q,ce=[];for(let ue=0;ue<Math.abs(le);ue++)ce.push(le>0?0:1);for(let ue=0;ue<Math.min(Z,Q);ue++)ce.push(0),ce.push(1);let q=S;if(q=J0(q,T[0].y-M,T[1].y+M,1),q=J0(q,T[0].x-M,T[1].x+M,0),!q.length)return O;const re=[];for(ce.length?re.push({polygons:q,bounds:T,depth:0}):G(q,T);re.length;){const ue=re.pop(),pe=ue.depth,Ae=ce[pe],Te=ue.bounds[0],Ie=ue.bounds[1],Ne=Ae===0?Te.x:Te.y,Ke=Ae===0?Ie.x:Ie.y,yt=L?L(Ae,Ne,Ke):.5*(Ne+Ke),at=J0(ue.polygons,Ne-M,yt+M,Ae),_t=J0(ue.polygons,yt-M,Ke+M,Ae);if(at.length){const xt=[Te,new Dt(Ae===0?yt:Ie.x,Ae===1?yt:Ie.y)];ce.length>pe+1?re.push({polygons:at,bounds:xt,depth:pe+1}):G(at,xt)}if(_t.length){const xt=[new Dt(Ae===0?yt:Te.x,Ae===1?yt:Te.y),Ie];ce.length>pe+1?re.push({polygons:_t,bounds:xt,depth:pe+1}):G(_t,xt)}}return O}(o,e,Math.ceil((p-u)/11.25),Math.ceil((m-v)/11.25),1,(S,T,I)=>{if(S===0)return .5*(T+I);{const P=Fe((i.y+T/Lt)/c);return(ye(.5*(Fe((i.y+I/Lt)/c)+P))*c-i.y)*Lt}})}function o6(o,e,i,c,u,p){const m=Math.pow(2,c.z-u.z);for(let v=0;v<i;v++){let S=o.int16[2*(v+e)+0],T=o.int16[2*(v+e)+1];S=(S+u.x*Lt)*m-c.x*Lt,T=(T+u.y*Lt)*m-c.y*Lt,p.push(new Dt(S,T))}}let xM,bM;Ht(r1,"FillExtrusionBucket",{omit:["layers","features"]}),Ht(cM,"PartData"),Ht(lM,"FootprintSegment"),Ht(uM,"BorderCentroidData"),Ht(hM,"GroundEffect");class Ef extends Dt{constructor(e,i,c){super(e,i),this.z=c}}class wM extends Ef{constructor(e,i,c,u){super(e,i,c),this.w=u}}function SM(o,e,i,c){const u=i==="x"?"y":"x",p=(c-o[i])/(e[i]-o[i]);o[u]=Math.round(o[u]+(e[u]-o[u])*p),o[i]=c,o.hasOwnProperty("z")&&(o.z=vn(o.z,e.z,p)),o.hasOwnProperty("w")&&(o.w=vn(o.w,e.w,p))}function TM(o,e,i,c){const u=i,p=c;for(const m of["x","y"]){let v=o,S=e;v[m]>=S[m]&&(v=e,S=o),v[m]<u&&S[m]>u&&SM(v,S,m,u),v[m]<p&&S[m]>p&&SM(S,v,m,p)}}function i1(o,e,i,c,u,p){const m=[];for(let v=0;v<o.length;v++){const S=o[v];let T;const I=m.length;let P=0;for(let M=0;M<S.length-1;M++){let L=S[M],O=S[M+1],G=0;const Z=P;let Q,le;p&&(G=Math.hypot(O.x-L.x,O.y-L.y),P+=G,Q=L,le=O),L.x<e&&O.x<e||(L.x<e?L=new Dt(e,L.y+(e-L.x)/(O.x-L.x)*(O.y-L.y))._round():O.x<e&&(O=new Dt(e,L.y+(e-L.x)/(O.x-L.x)*(O.y-L.y))._round()),L.y<i&&O.y<i||(L.y<i?L=new Dt(L.x+(i-L.y)/(O.y-L.y)*(O.x-L.x),i)._round():O.y<i&&(O=new Dt(L.x+(i-L.y)/(O.y-L.y)*(O.x-L.x),i)._round()),L.x>=c&&O.x>=c||(L.x>=c?L=new Dt(c,L.y+(c-L.x)/(O.x-L.x)*(O.y-L.y))._round():O.x>=c&&(O=new Dt(c,L.y+(c-L.x)/(O.x-L.x)*(O.y-L.y))._round()),L.y>=u&&O.y>=u||(L.y>=u?L=new Dt(L.x+(u-L.y)/(O.y-L.y)*(O.x-L.x),u)._round():O.y>=u&&(O=new Dt(L.x+(u-L.y)/(O.y-L.y)*(O.x-L.x),u)._round()),T&&L.equals(T[T.length-1])||(T=[L],m.push(T),p&&p.push({progress:{min:Z+EM(Q,le,L)*G,max:1},parentIndex:v,prevPoint:Q,nextPoint:le})),T.push(O),p&&(p[p.length-1].progress.max=Z+EM(Q,le,O)*G,p[p.length-1].nextPoint=le)))))}if(p&&P>0)for(let M=I;M<m.length;M++)p[M].progress.min/=P,p[M].progress.max/=P}return m}function a6(o,e,i,c,u){if(o.length<2)return void c.push(o);const p=[];for(;e.valid();){const[T,I]=e.get();for(let P=0;P<o.length-1;P++){const M=o[P],L=o[P+1],O=_y(M,L,T,I);if(O){const[G]=O,Z=new Dt(vn(M.x,L.x,G),vn(M.y,L.y,G));p.push({t:P+G,distance:0,point:Z})}}e.next()}if(p.length===0)return void c.push(o);p.sort((T,I)=>T.t-I.t);let m=0,v=0,S=[];for(c.push(S);m!==o.length;){if(v===p.length){for(;m!==o.length;)S.length!==0&&S[S.length-1].equals(o[m])||S.push(o[m]),m++;break}p[v].t<=m?(S.length!==0&&S[S.length-1].equals(p[v].point)||S.push(p[v].point),Math.trunc(p[v].t),v++):(S.length!==0&&S[S.length-1].equals(o[m])||S.push(o[m]),m++)}}function EM(o,e,i){return o.x!==e.x?(i.x-o.x)/(e.x-o.x):o.y!==e.y?(i.y-o.y)/(e.y-o.y):0}function Iy(o,e){return o.x*e.x+o.y*e.y}function CM(o,e){if(o.length===1){let i=0;const c=e[i++];let u;for(;!u||c.equals(u);)if(u=e[i++],!u)return 1/0;for(;i<e.length;i++){const p=e[i],m=o[0],v=u.sub(c),S=p.sub(c),T=m.sub(c),I=Iy(v,v),P=Iy(v,S),M=Iy(S,S),L=Iy(T,v),O=Iy(T,S),G=I*M-P*P,Z=(M*L-P*O)/G,Q=(I*O-P*L)/G,le=c.z*(1-Z-Q)+u.z*Z+p.z*Q;if(isFinite(le))return le}return 1/0}{let i=1/0;for(const c of e)i=Math.min(i,c.z);return i}}function AM(o,e,i,c,u,p,m,v){const S=m*u.getElevationAt(o,e,!0,!0),T=p[0]!==0,I=T?p[1]===0?m*(p[0]/7-450):m*function(P,M,L){const O=Math.floor(M[0]/8),G=Math.floor(M[1]/8),Z=10*(M[0]-8*O),Q=10*(M[1]-8*G),le=P.getElevationAt(O,G,!0,!0),ce=P.getMeterToDEM(L),q=Math.floor(.5*(Z*ce-1)),re=Math.floor(.5*(Q*ce-1)),ue=P.tileCoordToPixel(O,G),pe=2*q+1,Ae=2*re+1,Te=function(_t,xt,et,pt,Ze){return[_t.getElevationAtPixel(xt,et,!0),_t.getElevationAtPixel(xt+Ze,et,!0),_t.getElevationAtPixel(xt,et+Ze,!0),_t.getElevationAtPixel(xt+pt,et+Ze,!0)]}(P,ue.x-q,ue.y-re,pe,Ae),Ie=Math.abs(Te[0]-Te[1]),Ne=Math.abs(Te[2]-Te[3]),Ke=Math.abs(Te[0]-Te[2])+Math.abs(Te[1]-Te[3]),yt=Math.min(.25,.5*ce*(Ie+Ne)/pe),at=Math.min(.25,.5*ce*Ke/Ae);return le+Math.max(yt*Z,at*Q)}(u,p,v):S;return{base:S+(i===0?-1:i),top:T?Math.max(I+c,S+i+2):S+c}}class l6{constructor(e){this._callback=e,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._callback()},0))}remove(){this._channel=void 0,this._callback=()=>{}}}class c6{constructor(){this.tasks={},this.taskQueue=[],Qt(["process"],this),this.invoker=new l6(this.process),this.nextId=0}add(e,i){const c=this.nextId++,u=function({type:p,isSymbolTile:m,zoom:v}){return v=v||0,p==="message"?0:p!=="maybePrepare"||m?p!=="parseTile"||m?p==="parseTile"&&m?300-v:p==="maybePrepare"&&m?400-v:500:200-v:100-v}(i);if(u===0){try{e()}finally{}return null}return this.tasks[c]={fn:e,metadata:i,priority:u,id:c},this.taskQueue.push(c),this.invoker.trigger(),{cancel:()=>{delete this.tasks[c]}}}process(){try{if(this.taskQueue=this.taskQueue.filter(c=>!!this.tasks[c]),!this.taskQueue.length)return;const e=this.pick();if(e===null)return;const i=this.tasks[e];if(delete this.tasks[e],this.taskQueue.length&&this.invoker.trigger(),!i)return;i.fn()}finally{}}pick(){let e=null,i=1/0;for(let u=0;u<this.taskQueue.length;u++){const p=this.tasks[this.taskQueue[u]];p.priority<i&&(i=p.priority,e=u)}if(e===null)return null;const c=this.taskQueue[e];return this.taskQueue.splice(e,1),c}remove(){this.invoker.remove()}}class IM{constructor(e,i,c){this.target=e,this.parent=i,this.mapId=c,this.callbacks={},this.cancelCallbacks={},Qt(["receive"],this),this.target.addEventListener("message",this.receive,!1),this.scheduler=new c6}send(e,i,c,u,p=!1,m){const v=Math.round(1e18*Math.random()).toString(36).substring(0,10);c&&(c.metadata=m,this.callbacks[v]=c);const S=new Set;return this.target.postMessage({id:v,type:e,hasCallback:!!c,targetMapId:u,mustQueue:p,sourceMapId:this.mapId,data:rc(i,S)},S),{cancel:()=>{c&&delete this.callbacks[v],this.target.postMessage({id:v,type:"<cancel>",targetMapId:u,sourceMapId:this.mapId})}}}receive(e){const i=e.data;if(!i)return;const c=i.id;if(c&&(!i.targetMapId||this.mapId===i.targetMapId))if(i.type==="<cancel>"){const u=this.cancelCallbacks[c];delete this.cancelCallbacks[c],u&&u.cancel()}else if(i.mustQueue||Rr(self)){const u=this.callbacks[c],p=this.scheduler.add(()=>this.processTask(c,i),u&&u.metadata||{type:"message"});p&&(this.cancelCallbacks[c]=p)}else this.processTask(c,i)}processTask(e,i){if(delete this.cancelCallbacks[e],i.type==="<response>"){const c=this.callbacks[e];delete this.callbacks[e],c&&(i.error?c(ic(i.error)):c(null,ic(i.data)))}else{const c=new Set,u=i.hasCallback?(m,v)=>{this.target.postMessage({id:e,type:"<response>",sourceMapId:this.mapId,error:m?rc(m):null,data:rc(v,c)},c)}:()=>{},p=ic(i.data);if(this.parent[i.type])this.parent[i.type](i.sourceMapId,p,u);else if(this.parent.getWorkerSource){const m=i.type.split("."),{source:v,scope:S}=p;this.parent.getWorkerSource(i.sourceMapId,m[0],v,S)[m[1]](p,u)}else u(new Error(`Could not find function ${i.type}`))}}remove(){this.scheduler.remove(),this.target.removeEventListener("message",this.receive,!1)}}var Py={workerUrl:"",workerClass:null,workerParams:void 0};const zS="mapboxgl_preloaded_worker_pool";class Cf{constructor(){this.active={}}acquire(e,i=Cf.workerCount){if(!this.workers)for(this.workers=[];this.workers.length<i;)this.workers.push(Py.workerClass!=null?new Py.workerClass:new self.Worker(Py.workerUrl,Py.workerParams));return this.active[e]=!0,this.workers.slice()}release(e){delete this.active[e],this.workers&&this.numActive()===0&&(this.workers.forEach(i=>{i.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[zS]}numActive(){return Object.keys(this.active).length}}Cf.workerCount=2;class Am{constructor(e,i,c="Worker",u=Cf.workerCount){this.workerPool=e,this.actors=[],this.currentActor=0,this.id=qe();const p=this.workerPool.acquire(this.id,u);for(let m=0;m<p.length;m++){const v=new Am.Actor(p[m],i,this.id);v.name=`${c} ${m}`,this.actors.push(v)}this.ready=!1,this.broadcast("checkIfReady",null,()=>{this.ready=!0})}broadcast(e,i,c){De(this.actors,(u,p)=>{u.send(e,i,p)},c=c||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(){this.actors.forEach(e=>{e.remove()}),this.actors=[],this.workerPool.release(this.id)}}let My,OS;function s1(){return My||(My=new Cf),My}Am.Actor=IM;class u6{constructor(e){this.module=e}createIntArray(e){const i=new Int32Array(e),c=this.module.malloc(i.length*i.BYTES_PER_ELEMENT);return this.module.heap32.set(i,c/i.BYTES_PER_ELEMENT),c}createFloatArray(e){const i=new Float32Array(e),c=this.module.malloc(i.length*i.BYTES_PER_ELEMENT);return this.module.heapF32.set(i,c/i.BYTES_PER_ELEMENT),c}createStringBuffer(e){const i=this.module.malloc(e.length+1);for(let c=0;c<e.length;++c)this.module.heapU8[i+c]=e.charCodeAt(c);return this.module.heapU8[i+e.length]=0,i}readStringBuffer(e){let i="";for(;this.module.heapU8[e]!==0;)i+=String.fromCharCode(this.module.heapU8[e]),++e;return i}setStyle(e){const i=e.entranceColorRgb,c=e.facadeGlazingColorRgb,u=e.roofColorRgb,p=e.wallColorRgb,m=e.normalScale;this.module.setStyle(i[0],i[1],i[2],c[0],c[1],c[2],u[0],u[1],u[2],p[0],p[1],p[2],m[0],m[1],m[2],e.tileToMeters)}setAOOptions(e,i){this.module.setAOOptions(e?1:0,i)}setMetricOptions(e,i){this.module.setMetricOptions(e?1:0,i)}setFacadeOptions(e,i,c){this.module.setFacadeOptions(e,i,c)}generateMesh(e,i){for(const v of e){const S=this.createStringBuffer(v.roofType),T=[0],I=[];for(const L of v.coordinates)if(Array.isArray(L)){for(const O of L)I.push(O.x),I.push(O.y);T.push(I.length)}const P=this.createIntArray(T),M=this.createFloatArray(I);this.module.addFeature(v.id,v.sourceId,v.minHeight,v.height,S,v.roofType.length,M,P,T.length-1),this.module.free(S),this.module.free(P),this.module.free(M)}for(const v of i){let S;S=v.entrances?JSON.parse(v.entrances):[];const T=this.createFloatArray(S),I=[];for(const M of v.coordinates)I.push(M.x),I.push(M.y);const P=this.createFloatArray(I);this.module.addFacade(v.sourceId,v.crossPerc,v.distanceToRoad,T,S.length,P,I.length),this.module.free(T),this.module.free(P)}if(!this.module.generateMesh()){const v=this.module.getLastError();return this.readStringBuffer(v)}const c=this.module.getMeshCount(),u=new Array(c);for(let v=0;v<c;v++){const S=this.module.getPositionsPtr(v),T=this.module.getPositionsLength(v),I=new Float32Array(this.module.heapF32.buffer,S,T),P=this.module.getNormalsPtr(v),M=this.module.getNormalsLength(v),L=new Float32Array(this.module.heapF32.buffer,P,M),O=this.module.getColorsPtr(v),G=this.module.getColorsLength(v),Z=new Uint8Array(this.module.heapU8.buffer,O,G),Q=this.module.getAOPtr(v),le=this.module.getAOLength(v),ce=new Float32Array(this.module.heapF32.buffer,Q,le),q=this.module.getIndicesPtr(v),re=this.module.getIndicesLength(v),ue=new Int32Array(this.module.heap32.buffer,q,re),pe=this.module.getBuildingPart(v),Ae=this.readStringBuffer(pe);u[v]={positions:I,normals:L,colors:Z,ao:ce,indices:ue,buildingPart:Ae}}const p=this.module.getRingCount(),m=[];for(let v=0;v<p;v++){const S=this.module.getRingPtr(v),T=this.module.getRingLength(v),I=new Float32Array(this.module.heapF32.buffer,S,T);m.push(I)}return{meshes:u,modifiedPolygonRings:m}}}let Ry,FS,yl,Im,jS,Pm=null,Mm=null,PM=null,BS=null;function MM(){return Rr(self)&&self.worker.dracoUrl?self.worker.dracoUrl:FS||vs.DRACO_URL}function RM(){if(Rr(self)&&self.worker.meshoptUrl)return self.worker.meshoptUrl;if(Im)return Im;const o=new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,3,2,0,0,5,3,1,0,1,12,1,0,10,22,2,12,0,65,0,65,0,65,0,252,10,0,0,11,7,0,65,0,253,15,26,11]);if(typeof WebAssembly!="object")throw new Error("WebAssembly not supported, cannot instantiate meshoptimizer");return Im=WebAssembly.validate(o)?vs.MESHOPT_SIMD_URL:vs.MESHOPT_URL,Im}const o1={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},d6={5120:"DT_INT8",5121:"DT_UINT8",5122:"DT_INT16",5123:"DT_UINT16",5125:"DT_UINT32",5126:"DT_FLOAT32"},ky={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16};function kM(o,e,i){const c=i.json.bufferViews.length,u=i.buffers.length;e.bufferView=c,i.json.bufferViews[c]={buffer:u,byteLength:o.byteLength},i.buffers[u]=o}const VS="KHR_draco_mesh_compression";function h6(o,e){const i=o.extensions&&o.extensions[VS];if(!i)return;const c=new yl.Decoder,u=zM(e,i.bufferView),p=new yl.Mesh;if(!c.DecodeArrayToMesh(u,u.byteLength,p))throw new Error("Failed to decode Draco mesh");const m=e.json.accessors[o.indices],v=o1[m.componentType],S=m.count*v.BYTES_PER_ELEMENT,T=yl._malloc(S);v===Uint16Array?c.GetTrianglesUInt16Array(p,S,T):c.GetTrianglesUInt32Array(p,S,T),kM(yl.memory.buffer.slice(T,T+S),m,e),yl._free(T);for(const I of Object.keys(i.attributes)){const P=c.GetAttributeByUniqueId(p,i.attributes[I]),M=e.json.accessors[o.attributes[I]],L=d6[M.componentType],O=M.count*ky[M.type]*o1[M.componentType].BYTES_PER_ELEMENT,G=yl._malloc(O);c.GetAttributeDataArrayForAllPoints(p,P,yl[L],O,G),kM(yl.memory.buffer.slice(G,G+O),M,e),yl._free(G)}c.destroy(),p.destroy(),delete o.extensions[VS]}const a1="EXT_meshopt_compression";function f6(o,e){if(!o.extensions||!o.extensions[a1])return;const i=o.extensions[a1],c=new Uint8Array(e.buffers[i.buffer],i.byteOffset||0,i.byteLength||0),u=new Uint8Array(i.count*i.byteStride);jS.decodeGltfBuffer(u,i.count,i.byteStride,c,i.mode,i.filter),o.buffer=e.buffers.length,o.byteOffset=0,e.buffers[o.buffer]=u.buffer,delete o.extensions[a1]}const DM=1179937895,LM=new TextDecoder("utf8");function NM(o,e){return new URL(o,e).href}function p6(o,e,i,c){return fetch(NM(o.uri,c)).then(u=>u.arrayBuffer()).then(u=>{e.buffers[i]=u})}function zM(o,e){const i=o.json.bufferViews[e];return new Uint8Array(o.buffers[i.buffer],i.byteOffset||0,i.byteLength)}function m6(o,e,i,c){if(o.uri){const u=NM(o.uri,c);return fetch(u).then(p=>p.blob()).then(p=>createImageBitmap(p)).then(p=>{e.images[i]=p})}if(o.bufferView!==void 0){const u=zM(e,o.bufferView),p=new Blob([u],{type:o.mimeType});return createImageBitmap(p).then(m=>{e.images[i]=m})}}function OM(o,e=0,i){const c={json:null,images:[],buffers:[]};if(new Uint32Array(o,e,1)[0]===DM){const I=new Uint32Array(o,e);let P=2;const M=(I[P++]>>2)-3,L=I[P++]>>2;if(P++,c.json=JSON.parse(LM.decode(I.subarray(P,P+L))),P+=L,P<M){const O=I[P++];P++;const G=e+(P<<2);c.buffers[0]=o.slice(G,G+O)}}else c.json=JSON.parse(LM.decode(new Uint8Array(o,e)));const{buffers:u,images:p,meshes:m,extensionsUsed:v,bufferViews:S}=c.json;let T=Promise.resolve();if(u){const I=[];for(let P=0;P<u.length;P++){const M=u[P];M.uri?I.push(p6(M,c,P,i)):c.buffers[P]||(c.buffers[P]=null)}T=Promise.all(I)}return T.then(()=>{const I=[],P=v&&v.includes(VS),M=v&&v.includes(a1);if(P&&I.push(function(){if(!yl)return Ry??(Ry=function(L){let O,G=null;function Z(){O=new Uint8Array(G.buffer)}function Q(){throw new Error("Unexpected Draco error.")}const le={a:{a:Q,d:function(ce,q,re){return O.copyWithin(ce,q,q+re)},c:function(ce){const q=O.length,re=Math.max(ce>>>0,Math.ceil(1.2*q)),ue=Math.ceil((re-q)/65536);try{return G.grow(ue),Z(),!0}catch{return!1}},b:Q}};return(WebAssembly.instantiateStreaming?WebAssembly.instantiateStreaming(L,le):L.then(ce=>ce.arrayBuffer()).then(ce=>WebAssembly.instantiate(ce,le))).then(ce=>{const{Rb:q,Qb:re,P:ue,T:pe,X:Ae,Ja:Te,La:Ie,Qa:Ne,Va:Ke,Wa:yt,eb:at,jb:_t,f:xt,e:et,yb:pt,zb:Ze,Ab:Qe,Bb:St,Db:Et,Gb:ln}=ce.instance.exports;G=et;const Kt=(()=>{let Ot=0,wt=0,Pn=0,Yt=0;return Jt=>{Pn&&(q(Yt),q(Ot),wt+=Pn,Pn=Ot=0),Ot||(wt+=128,Ot=re(wt));const xn=Jt.length+7&-8;let zn=Ot;xn>=wt&&(Pn=xn,zn=Yt=re(xn));for(let Nn=0;Nn<Jt.length;Nn++)O[zn+Nn]=Jt[Nn];return zn}})();return Z(),xt(),{memory:et,_free:q,_malloc:re,Mesh:class{constructor(){this.ptr=ue()}destroy(){pe(this.ptr)}},Decoder:class{constructor(){this.ptr=Te()}destroy(){_t(this.ptr)}DecodeArrayToMesh(Ot,wt,Pn){const Yt=Kt(Ot),Jt=Ie(this.ptr,Yt,wt,Pn.ptr);return!!Ae(Jt)}GetAttributeByUniqueId(Ot,wt){return{ptr:Ne(this.ptr,Ot.ptr,wt)}}GetTrianglesUInt16Array(Ot,wt,Pn){Ke(this.ptr,Ot.ptr,wt,Pn)}GetTrianglesUInt32Array(Ot,wt,Pn){yt(this.ptr,Ot.ptr,wt,Pn)}GetAttributeDataArrayForAllPoints(Ot,wt,Pn,Yt,Jt){at(this.ptr,Ot.ptr,wt.ptr,Pn,Yt,Jt)}},DT_INT8:pt(),DT_UINT8:Ze(),DT_INT16:Qe(),DT_UINT16:St(),DT_UINT32:Et(),DT_FLOAT32:ln()}})}(fetch(MM())),Ry.then(L=>{yl=L,Ry=void 0}))}()),M&&I.push(function(){if(jS)return;const L=function(O){let G;const Z=WebAssembly.instantiateStreaming(O,{}).then(ce=>{G=ce.instance,G.exports.__wasm_call_ctors()}),Q={NONE:"",OCTAHEDRAL:"meshopt_decodeFilterOct",QUATERNION:"meshopt_decodeFilterQuat",EXPONENTIAL:"meshopt_decodeFilterExp"},le={ATTRIBUTES:"meshopt_decodeVertexBuffer",TRIANGLES:"meshopt_decodeIndexBuffer",INDICES:"meshopt_decodeIndexSequence"};return{ready:Z,supported:!0,decodeGltfBuffer(ce,q,re,ue,pe,Ae){(function(Te,Ie,Ne,Ke,yt,at,_t){const xt=Te.exports.sbrk,et=Ke+3&-4,pt=xt(et*yt),Ze=xt(at.length),Qe=new Uint8Array(Te.exports.memory.buffer);Qe.set(at,Ze);const St=Ie(pt,Ke,yt,Ze,at.length);if(St===0&&_t&&_t(pt,et,yt),Ne.set(Qe.subarray(pt,pt+Ke*yt)),xt(pt-xt(0)),St!==0)throw new Error(`Malformed buffer data: ${St}`)})(G,G.exports[le[pe]],ce,q,re,ue,G.exports[Q[Ae]])}}}(fetch(RM()));return L.ready.then(()=>{jS=L})}()),p)for(let L=0;L<p.length;L++)I.push(m6(p[L],c,L,i));return(I.length?Promise.all(I):Promise.resolve()).then(()=>{if(P&&m)for(const{primitives:L}of m)for(const O of L)h6(O,c);if(M&&m&&S)for(const L of S)f6(L,c);return c})})}class FM{constructor(e){this.layers=e.layers,this.layerIds=this.layers.map(i=>i.fqid),this.hasPattern=!1,this.worldview=e.worldview}updateFootprints(e,i){}prepare(){return function(){if(BS!=null||PM!=null)return null;if(Mm!=null)return Mm;const e=fetch(vs.BUILDING_GEN_URL);return Mm=function(i){let c,u,p,m;function v(){c=new Uint8Array(m.buffer),u=new Int32Array(m.buffer),p=new Float32Array(m.buffer)}function S(){throw new Error("Unexpected BuildingGen error.")}const T=()=>{},I={a:{a:S,f:function(P){const M=c.length,L=Math.max(P>>>0,Math.ceil(1.2*M)),O=Math.ceil((L-M)/65536);try{return m.grow(O),v(),!0}catch{return!1}},g:S,b:T,c:T,d:T,e:T}};return(WebAssembly.instantiateStreaming?WebAssembly.instantiateStreaming(i,I):i.then(P=>P.arrayBuffer()).then(P=>WebAssembly.instantiate(P,I))).then(P=>{const M=P.instance.exports;return(0,M.g)(),m=M.f,v(),new u6({setStyle:M.h,setAOOptions:M.i,setMetricOptions:M.j,setFacadeOptions:M.k,addFeature:M.l,addFacade:M.m,generateMesh:M.n,getLastError:M.o,getMeshCount:M.p,getPositionsPtr:M.q,getPositionsLength:M.r,getNormalsPtr:M.s,getNormalsLength:M.t,getColorsPtr:M.u,getColorsLength:M.v,getAOPtr:M.w,getAOLength:M.x,getIndicesPtr:M.y,getIndicesLength:M.z,getBuildingPart:M.A,getRingCount:M.B,getRingPtr:M.C,getRingLength:M.D,free:M.E,malloc:M.F,heapU8:c,heap32:u,heapF32:p})})}(e).then(i=>(Mm=null,BS=i,BS)).catch(i=>{On("Could not load building-gen"),Mm=null,PM=i}),Mm}()}populate(e,i,c,u){}update(e,i,c,u,p,m,v){}isEmpty(){return!1}uploadPending(){return!1}upload(e){}destroy(){}getHeightAtTileCoord(e,i){return{height:Number.NEGATIVE_INFINITY,hidden:!0}}}let jM,BM;Ht(FM,"BuildingBucket",{omit:["layers"]});const g6=hr([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"},{name:"a_linesofar",components:1,type:"Float32"}],4),_6=hr([{name:"a_z_offset_width",components:3,type:"Float32"}],4),{members:y6}=g6,v6=hr([{name:"a_packed",components:3,type:"Float32"}]),{members:x6}=v6,b6=hr([{name:"a_pattern_data",components:3,type:"Float32"}]),{members:w6}=b6;class VM{constructor(e,i){this.width=e,this.height=i,this.nextRow=0,this.image=new md({width:e,height:i}),this.positions={},this.uploaded=!1}getDash(e,i){const c=this.getKey(e,i);return this.positions[c]}trim(){const e=this.width,i=this.height=kt(this.nextRow);this.image.resize({width:e,height:i})}getKey(e,i){return e.join(",")+i}getDashRanges(e,i,c){const u=[];let p=e.length%2==1?-e[e.length-1]*c:0,m=e[0]*c,v=!0;u.push({left:p,right:m,isDash:v,zeroLength:e[0]===0});let S=e[0];for(let T=1;T<e.length;T++){v=!v;const I=e[T];p=S*c,S+=I,m=S*c,u.push({left:p,right:m,isDash:v,zeroLength:I===0})}return u}addRoundDash(e,i,c){const u=i/2;for(let p=-c;p<=c;p++){const m=this.width*(this.nextRow+c+p);let v=0,S=e[v];for(let T=0;T<this.width;T++){T/S.right>1&&(S=e[++v]);const I=Math.abs(T-S.left),P=Math.abs(T-S.right),M=Math.min(I,P);let L;const O=p/c*(u+1);if(S.isDash){const G=u-Math.abs(O);L=Math.sqrt(M*M+G*G)}else L=u-Math.sqrt(M*M+O*O);this.image.data[m+T]=Math.max(0,Math.min(255,L+128))}}}addRegularDash(e,i){for(let S=e.length-1;S>=0;--S){const T=e[S],I=e[S+1];T.zeroLength?e.splice(S,1):I&&I.isDash===T.isDash&&(I.left=T.left,e.splice(S,1))}const c=e[0],u=e[e.length-1];c.isDash===u.isDash&&(c.left=u.left-this.width,u.right=c.right+this.width);const p=this.width*this.nextRow;let m=0,v=e[m];for(let S=0;S<this.width;S++){S/v.right>1&&(v=e[++m]);const T=Math.abs(S-v.left),I=Math.abs(S-v.right),P=Math.min(T,I);this.image.data[p+S]=Math.max(0,Math.min(255,(v.isDash?P:-P)+i+128))}}addDash(e,i){const c=this.getKey(e,i);if(this.positions[c])return this.positions[c];const u=i==="round",p=u?7:0,m=2*p+1;if(this.nextRow+m>this.height)return On("LineAtlas out of space"),null;e.length===0&&e.push(1);let v=0;for(let I=0;I<e.length;I++)e[I]<0&&(On("Negative value is found in line dasharray, replacing values with 0"),e[I]=0),v+=e[I];if(v!==0){const I=this.width/v,P=this.getDashRanges(e,this.width,I);u?this.addRoundDash(P,I,p):this.addRegularDash(P,i==="square"?.5*I:0)}const S=this.nextRow+p;this.nextRow+=m;const T={tl:[S,p],br:[v,0]};return this.positions[c]=T,T}}Ht(VM,"LineAtlas");const S6=Gn.VectorTileFeature.types,T6=Math.cos(Math.PI/180*37.5),E6=Math.cos(Math.PI/180*5);class US{constructor(e){this.evaluationGlobals={zoom:0,lineProgress:void 0},this.elevationType="none",this.zoom=e.zoom,this.evaluationGlobals.zoom=this.zoom,this.overscaling=e.overscaling,this.pixelRatio=e.pixelRatio,this.layers=e.layers,this.layerIds=this.layers.map(i=>i.fqid),this.index=e.index,this.projection=e.projection,this.hasPattern=!1,this.hasCrossSlope=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(i=>{this.gradients[i.id]={}}),this.layoutVertexArray=new ry,this.layoutVertexArray2=new ja,this.patternVertexArray=new ja,this.indexArray=new bs,this.programConfigurations=new h(e.layers,{zoom:e.zoom,lut:e.lut}),this.segments=new Ai,this.maxLineLength=0,this.zOffsetVertexArray=new ja,this.stateDependentLayerIds=this.layers.filter(i=>i.isStateDependent()).map(i=>i.id),this.tessellationStep=e.tessellationStep?e.tessellationStep:Lt/64,this.worldview=e.worldview}updateFootprints(e,i){}populate(e,i,c,u){this.hasPattern=ES("line",this.layers,this.pixelRatio,i);const p=this.layers[0].layout.get("line-sort-key");this.tileToMeter=Xe(c);const m=this.layers[0].layout.get("line-elevation-reference");if(m==="hd-road-markup")this.elevationType="road";else{const M=this.layers[0].layout.get("line-z-offset"),L=M.isConstant()&&!M.constantOr(0);this.elevationType=m!=="sea"&&m!=="ground"&&L?"none":"offset",this.elevationType==="offset"&&m==="none"&&On(`line-elevation-reference: ground is used for the layer ${this.layerIds[0]} because non-zero line-z-offset value was found.`)}const v=this.layers[0].layout.get("line-cross-slope");this.hasCrossSlope=this.elevationType==="offset"&&v!==void 0;const S=[];for(const{feature:M,id:L,index:O,sourceLayerIndex:G}of e){const Z=this.layers[0]._featureFilter.needGeometry,Q=Vt(M,Z);if(!this.layers[0]._featureFilter.filter(new Fr(this.zoom,{worldview:this.worldview}),Q,c))continue;const le=p?p.evaluate(Q,{},c):void 0,ce={id:L,properties:M.properties,type:M.type,sourceLayerIndex:G,index:O,geometry:Z?Q.geometry:Wt(M,c,u),patterns:{},sortKey:le};S.push(ce)}p&&S.sort((M,L)=>M.sortKey-L.sortKey);const{lineAtlas:T,featureIndex:I}=i,P=this.addConstantDashes(T);for(const M of S){const{geometry:L,index:O,sourceLayerIndex:G}=M;if(P&&this.addFeatureDashes(M,T),this.hasPattern){const Z=CS("line",this.layers,M,this.zoom,this.pixelRatio,i);this.patternFeatures.push(Z)}else this.addFeature(M,L,O,c,T.positions,i.availableImages,i.brightness,i.elevationFeatures);I.insert(e[O].feature,L,O,G,this.index)}}addConstantDashes(e){let i=!1;for(const c of this.layers){const u=c.paint.get("line-dasharray").value,p=c.layout.get("line-cap").value;if(u.kind!=="constant"||p.kind!=="constant")i=!0;else{const m=p.value,v=u.value;if(!v)continue;e.addDash(v,m)}}return i}addFeatureDashes(e,i){const c=this.zoom;for(const u of this.layers){const p=u.paint.get("line-dasharray").value,m=u.layout.get("line-cap").value;if(p.kind==="constant"&&m.kind==="constant")continue;let v,S;if(p.kind==="constant"){if(v=p.value,!v)continue}else v=p.evaluate({zoom:c},e);S=m.kind==="constant"?m.value:m.evaluate({zoom:c},e),i.addDash(v,S),e.patterns[u.id]=[i.getKey(v,S)]}}update(e,i,c,u,p,m,v,S){this.programConfigurations.updatePaintArrays(e,i,p,c,u,m,v,S)}addFeatures(e,i,c,u,p,m){for(const v of this.patternFeatures)this.addFeature(v,v.geometry,v.index,i,c,u,m)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=e.createVertexBuffer(this.layoutVertexArray2,x6)),this.patternVertexArray.length!==0&&(this.patternVertexBuffer=e.createVertexBuffer(this.patternVertexArray,w6)),!this.zOffsetVertexBuffer&&this.zOffsetVertexArray.length>0&&(this.zOffsetVertexBuffer=e.createVertexBuffer(this.zOffsetVertexArray,_6.members,!0)),this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,y6),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.zOffsetVertexBuffer&&this.zOffsetVertexBuffer.destroy(),this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(e){if(e.properties&&e.properties.hasOwnProperty("mapbox_clip_start")&&e.properties.hasOwnProperty("mapbox_clip_end"))return{start:+e.properties.mapbox_clip_start,end:+e.properties.mapbox_clip_end}}addFeature(e,i,c,u,p,m,v,S){const T=this.layers[0].layout,I=T.get("line-join").evaluate(e,{}),P=T.get("line-cap").evaluate(e,{}),M=T.get("line-miter-limit"),L=T.get("line-round-limit");this.lineClips=this.lineFeatureClips(e),this.lineFeature=e,this.zOffsetValue=T.get("line-z-offset").value;const O=this.layers[0].paint.get("line-width").value;if(O.kind!=="constant"&&O.isLineProgressConstant===!1&&(this.variableWidthValue=O),this.elevationType==="road"){const G=this.layoutVertexArray.length;if(!this.addElevatedRoadFeature(e,i,u,S,I,P,M,L)){const[Z,Q]=this.clipRuntimeLinesToTile(i,1);for(let le=0;le<Z.length;le++){const ce=Z[le],q=Q[le],re={progress:{min:q.progress.min,max:q.progress.max},nextDir:this.computeSegNextDir(q,ce),prevDir:this.computeSegPrevDir(q,ce)};this.addLine(ce,e,u,I,P,M,L,re)}this.fillNonElevatedRoadSegment(G)}}else for(const G of i)this.addLine(G,e,u,I,P,M,L);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,c,p,m,u,v,void 0,this.worldview)}computeSegNextDir(e,i){return e.nextPoint.sub(i.at(-2)).unit()}computeSegPrevDir(e,i){return i[1].sub(e.prevPoint).unit()}clipLinesToTile(e,i){return i1(e,-i,-i,Lt+i,Lt+i)}clipRuntimeLinesToTile(e,i){const c=[];return[i1(e,-i,-i,Lt+i,Lt+i,c),c]}addElevatedRoadFeature(e,i,c,u,p,m,v,S){const T=[],I=Fo.getElevationFeature(e,u);if(I){const P=this.clipLinesToTile(i,1),M=this.prepareElevatedLines(P,I,c);for(const L of M)T.push({geometry:L,elevation:I,elevationTileID:c,segment:{progress:{min:0,max:1},nextDir:void 0,prevDir:void 0}})}if(T.length===0)return!1;for(const P of T){const M=this.layoutVertexArray.length;this.addLine(P.geometry,e,c,p,m,v,S);const L=new xa(c,P.elevationTileID);if(P.elevation)for(let O=M;O<this.layoutVertexArray.length;O++){const G=new Dt(this.layoutVertexArray.int16[6*O]>>1,this.layoutVertexArray.int16[6*O+1]>>1),Z=L.pointElevation(G,P.elevation,.05);this.updateHeightRange(Z),this.zOffsetVertexArray.emplaceBack(Z,0,0)}else this.fillNonElevatedRoadSegment(M)}return!0}prepareElevatedLines(e,i,c){if(i.constantHeight!=null)return e;const u=[],p=1/Xe(c);for(const m of e)a6(m,new wo(i,p),0,u);return u}fillNonElevatedRoadSegment(e){for(let i=e;i<this.layoutVertexArray.length;i++)this.zOffsetVertexArray.emplaceBack(0,0,0)}updateHeightRange(e){this.heightRange?(this.heightRange.min=Math.min(this.heightRange.min,e),this.heightRange.max=Math.max(this.heightRange.max,e)):this.heightRange={min:e,max:e}}addLine(e,i,c,u,p,m,v,S){this.distance=0,this.prevDistance=0,this.scaledDistance=0,this.totalDistance=0,this.totalFeatureLength=0,this.lineSoFar=0,this.currentVertex=void 0;const T=u==="none";this.patternJoinNone=this.hasPattern&&T,this.segmentStart=0,this.segmentStartf32=0,this.segmentPoints=[];const I=S&&S.progress.min>0,P=S&&S.progress.max<1;if(this.lineClips){let Ae={min:this.lineClips.start,max:this.lineClips.end},Te=1;if(S){const Ke=this.lineClips.end-this.lineClips.start;Ae=function(yt,at,_t){return{min:Ch(yt.min,at,_t),max:Ch(yt.max,at,_t)}}(S.progress,{min:0,max:1},Ae),Ke>0&&(Te=(Ae.max-Ae.min)/Ke)}const Ie=+i.properties.mapbox_clip_feature_len,Ne=+i.properties.mapbox_clip_seg_len;if(Number.isNaN(Ie)||Number.isNaN(Ne)){for(let yt=0;yt<e.length-1;yt++)this.totalDistance+=e[yt].dist(e[yt+1]);const Ke=this.totalDistance/(Ae.max-Ae.min);this.totalFeatureLength=Number.isFinite(Ke)?Ke:0,this.lineClips.start=Ae.min,this.lineClips.end=Ae.max,this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}else this.totalFeatureLength=Ie,this.distance=Ne*Te,this.lineClips.start=Ae.min,this.lineClips.end=Ae.max,this.maxLineLength=Math.max(this.maxLineLength,this.distance);this.lineClipsArray.push(this.lineClips),this.updateScaledDistance()}const M=S6[i.type]==="Polygon";let L=e.length;for(;L>=2&&e[L-1].equals(e[L-2]);)L--;let O=0;for(;O<L-1&&e[O].equals(e[O+1]);)O++;if(L<(M?3:2))return;u==="bevel"&&(m=1.05);const G=this.segments.prepareSegment(10*L,this.layoutVertexArray,this.indexArray);let Z,Q,le,ce,q,re,ue,pe;S&&S.prevDir&&(re=S.prevDir.perp()),S&&S.nextDir&&(ue=S.nextDir.perp()),this.e1=this.e2=-1,M&&(Z=e[L-2],q=e[O].sub(Z)._unit()._perp());for(let Ae=O;Ae<L;Ae++){if(le=Ae===L-1?M?e[O+1]:void 0:e[Ae+1],le&&e[Ae].equals(le))continue;q&&(ce=q),Z&&(Q=Z),Z=e[Ae],pe=this.evaluateLineProgressFeatures(Q?Q.dist(Z):0),q=le?le.sub(Z)._unit()._perp():ce,ce=ce||q;const Te=Q&&le;let Ie=Te?u:M||T?"butt":p;const Ne=ce.x*q.x+ce.y*q.y;if(T){const Ze=function(Qe){if(Qe.patternJoinNone){const St=Qe.segmentPoints.length/2,Et=Qe.lineSoFar-Qe.segmentStart;for(let ln=0;ln<St;++ln){const Kt=Qe.segmentPoints[2*ln+1],Ot=Math.round(Qe.segmentPoints[2*ln])+.5+.25*Kt;Qe.patternVertexArray.emplaceBack(Ot,Et,Qe.segmentStart),Qe.patternVertexArray.emplaceBack(Ot,Et,Qe.segmentStart)}Qe.segmentPoints.length=0}Qe.e1=Qe.e2=-1};if(Te&&Ne<E6){this.updateDistance(Q,Z),this.addCurrentVertex(Z,ce,1,1,G,pe),Ze(this),this.addCurrentVertex(Z,q,-1,-1,G,pe);continue}if(Q){if(!le){this.updateDistance(Q,Z),this.addCurrentVertex(Z,ce,1,1,G,pe),Ze(this);continue}Ie="miter"}}let Ke=ce.add(q);Ke.x===0&&Ke.y===0||Ke._unit();const yt=Ke.x*q.x+Ke.y*q.y,at=yt!==0?1/yt:1/0,_t=2*Math.sqrt(2-2*yt),xt=yt<T6&&Q&&le,et=ce.x*q.y-ce.y*q.x>0,pt=this.overscaling<=16?15*Lt/(512*this.overscaling):0;if(Te&&Ie==="round"){if(at<v)Ie="miter";else if(at<=2){const Ze=$S(Z,-10,Lt+10);Ie=this.elevationType==="offset"&&(Ze||this.hasCrossSlope)?"miter":"fakeround"}}if(Ie==="miter"&&at>m&&(Ie="bevel"),Ie==="bevel"&&(at>2&&(Ie="flipbevel"),at<m&&(Ie="miter")),Q&&!(Ie==="miter"&&xt)&&this.updateDistance(Q,Z),Ie==="miter")if(xt){const Ze=Z.dist(Q);if(Ze>2*pt){const St=Z.sub(Z.sub(Q)._mult(pt/Ze)._round());this.updateDistance(Q,St),this.addCurrentVertex(St,ce,0,0,G,pe),Q=St}this.updateDistance(Q,Z),Ke._mult(at),this.addCurrentVertex(Z,Ke,0,0,G,pe);const Qe=Z.dist(le);if(Qe>2*pt){const St=Z.add(le.sub(Z)._mult(pt/Qe)._round());this.updateDistance(Z,St),this.addCurrentVertex(St,q,0,0,G,pe),Z=St}}else Ke._mult(at),this.addCurrentVertex(Z,Ke,0,0,G,pe);else if(Ie==="flipbevel"){if(at>100)Ke=q.mult(-1);else{const Ze=at*ce.add(q).mag()/ce.sub(q).mag();Ke._perp()._mult(Ze*(et?-1:1))}this.addCurrentVertex(Z,Ke,0,0,G,pe),this.addCurrentVertex(Z,Ke.mult(-1),0,0,G,pe)}else if(Ie==="bevel"||Ie==="fakeround"){pe!=null&&Q&&this.addCurrentVertex(Z,ue||ce,-1,-1,G,pe);const Ze=Z.dist(Q)<=2*pt&&Ie!=="bevel",Qe=Ke.mult(et?1:-1);Qe._mult(at);const St=q.mult(et?-1:1),Et=ce.mult(et?-1:1),ln=this.evaluateLineProgressFeatures(this.distance);if(pe==null&&(this.addHalfVertex(Z,Qe.x,Qe.y,!1,!et,0,G,ln),Ze||this.addHalfVertex(Z,Qe.x+2*Et.x,Qe.y+2*Et.y,!1,et,0,G,ln)),Ie==="fakeround"){const Kt=Math.round(180*_t/Math.PI/20);this.addHalfVertex(Z,Et.x,Et.y,!1,et,0,G,ln);for(let Ot=0;Ot<Kt;Ot++){let wt=Ot/Kt;if(wt!==.5){const Yt=wt-.5;wt+=wt*Yt*(wt-1)*((1.0904+Ne*(Ne*(3.55645-1.43519*Ne)-3.2452))*Yt*Yt+(.848013+Ne*(.215638*Ne-1.06021)))}const Pn=St.sub(Et)._mult(wt)._add(Et)._unit();this.addHalfVertex(Z,Pn.x,Pn.y,!1,et,0,G,ln)}this.addHalfVertex(Z,St.x,St.y,!1,et,0,G,ln)}Ze||pe!=null||this.addHalfVertex(Z,Qe.x+2*St.x,Qe.y+2*St.y,!1,et,0,G,ln),pe!=null&&le&&this.addCurrentVertex(Z,re||q,1,1,G,pe)}else if(Ie==="butt")this.addCurrentVertex(Z,Ke,0,0,G,pe);else if(Ie==="square"){if(!Q){const Ze=I?0:-1;this.addCurrentVertex(Z,Ke,Ze,Ze,G,pe)}if(this.addCurrentVertex(Z,Ke,0,0,G,pe),Q){const Ze=P?0:1;this.addCurrentVertex(Z,Ke,Ze,Ze,G,pe)}}else if(Ie==="round"){if(Q){const Ze=!Te&&ue?ue:ce;this.addCurrentVertex(Z,Ze,0,0,G,pe),!Te&&P||this.addCurrentVertex(Z,Ze,1,1,G,pe,!0)}if(le){const Ze=!Te&&re?re:q;!Te&&I||this.addCurrentVertex(Z,Ze,-1,-1,G,pe,!0),this.addCurrentVertex(Z,Ze,0,0,G,pe)}}}}addVerticesTo(e,i,c,u,p,m,v,S,T,I){const P=(i.w-e.w)/this.tessellationStep|0;let M=0;const L=this.scaledDistance;if(P>1){this.lineSoFar=e.w;const G=(i.x-e.x)/P,Z=(i.y-e.y)/P,Q=(i.z-e.z)/P,le=(i.w-e.w)/P;for(let ce=1;ce<P;++ce){e.x+=G,e.y+=Z,e.z+=Q,this.lineSoFar+=le,M+=le;const q=this.evaluateLineProgressFeatures(this.prevDistance+M);this.scaledDistance=(this.prevDistance+M)/this.totalDistance,this.addHalfVertex(e,c,u,I,!1,v,T,q),this.addHalfVertex(e,p,m,I,!0,-S,T,q)}}this.lineSoFar=i.w,this.scaledDistance=L;const O=this.evaluateLineProgressFeatures(this.distance);this.addHalfVertex(i,c,u,I,!1,v,T,O),this.addHalfVertex(i,p,m,I,!0,-S,T,O)}evaluateLineProgressFeatures(e){if(!this.variableWidthValue&&this.elevationType!=="offset")return null;this.evaluationGlobals.lineProgress=0,this.lineClips?this.evaluationGlobals.lineProgress=Math.min(1,(this.totalFeatureLength*this.lineClips.start+e)/this.totalFeatureLength):On(`line-progress evaluation for ${this.layerIds[0]} requires enabling 'lineMetrics' for the source.`);let i=0;return this.variableWidthValue&&this.variableWidthValue.kind!=="constant"&&(i=this.variableWidthValue.evaluate(this.evaluationGlobals,this.lineFeature)||0),this.elevationType!=="offset"?{zOffset:0,variableWidth:i}:this.zOffsetValue.kind==="constant"?{zOffset:this.zOffsetValue.value,variableWidth:i}:{zOffset:this.zOffsetValue.evaluate(this.evaluationGlobals,this.lineFeature)||0,variableWidth:i}}addCurrentVertex(e,i,c,u,p,m,v=!1){const S=i.x+i.y*c,T=i.y-i.x*c,I=i.y*u-i.x,P=-i.y-i.x*u;if(m!=null){const M=this.elevationType==="offset",L=-10,O=Lt+10,G=m.zOffset,Z=new wM(e.x,e.y,G,this.lineSoFar),Q=!!M&&$S(e,L,O),le=this.lineSoFar,ce=this.distance;if(this.currentVertex)if(Q){const q=this.currentVertexIsOutside,re=this.currentVertex,ue=new wM(e.x,e.y,G,this.lineSoFar);if(TM(re,ue,L,O),!$S(ue,L,O)){if(q){this.e1=this.e2=-1,this.distance-=re.dist(Z),this.lineSoFar=re.w;const pe=this.evaluateLineProgressFeatures(re.w-this.totalFeatureLength*(this.lineClips?this.lineClips.start:0));this.addHalfVertex(re,S,T,v,!1,c,p,pe),this.addHalfVertex(re,I,P,v,!0,-u,p,pe),this.prevDistance=this.distance}this.distance=this.prevDistance+re.dist(ue),this.scaledDistance=this.distance/this.totalDistance,this.addVerticesTo(re,ue,S,T,I,P,c,u,p,v),this.distance=ce,this.scaledDistance=this.distance/this.totalDistance}}else{const q=this.currentVertex;if(this.currentVertexIsOutside){TM(q,Z,L,O),this.e1=this.e2=-1,this.distance-=q.dist(Z),this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=q.w;const re=this.evaluateLineProgressFeatures(q.w-this.totalFeatureLength*(this.lineClips?this.lineClips.start:0));this.addHalfVertex(q,S,T,v,!1,c,p,re),this.addHalfVertex(q,I,P,v,!0,-u,p,re),this.prevDistance=this.distance,this.distance=ce,this.scaledDistance=this.distance/this.totalDistance}this.addVerticesTo(q,Z,S,T,I,P,c,u,p,v)}else Q||(this.addHalfVertex(e,S,T,v,!1,c,p,m),this.addHalfVertex(e,I,P,v,!0,-u,p,m));this.currentVertex=Z,this.currentVertexIsOutside=Q,this.lineSoFar=le}else this.addHalfVertex(e,S,T,v,!1,c,p,m),this.addHalfVertex(e,I,P,v,!0,-u,p,m)}addHalfVertex({x:e,y:i},c,u,p,m,v,S,T){if(this.patternJoinNone&&(this.segmentPoints.length===0&&(this.segmentStart=this.lineSoFar,this.segmentStartf32=Math.fround(this.lineSoFar)),m||this.segmentPoints.push(this.lineSoFar-this.segmentStart,v)),this.layoutVertexArray.emplaceBack((e<<1)+(p?1:0),(i<<1)+(m?1:0),Math.round(63*c)+128,Math.round(63*u)+128,1+(v===0?0:v<0?-1:1),0,this.lineSoFar-this.segmentStartf32),this.lineClips){const P=vn(this.lineClips.start,this.lineClips.end,this.scaledDistance);this.layoutVertexArray2.emplaceBack(this.scaledDistance,this.lineClipsArray.length,P)}const I=S.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,I),S.primitiveLength++),m?this.e2=I:this.e1=I,T!=null&&this.zOffsetVertexArray.emplaceBack(T.zOffset,T.variableWidth,T.variableWidth)}updateScaledDistance(){this.lineClips?(this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=this.totalFeatureLength*this.lineClips.start+this.distance):this.lineSoFar=this.distance}updateDistance(e,i){this.prevDistance=this.distance,this.distance+=e.dist(i),this.updateScaledDistance()}}function $S(o,e,i){return o.x<e||o.x>i||o.y<e||o.y>i}let UM,$M;function GM(o,e,i){return e*(Lt/(o.tileSize*Math.pow(2,i-o.tileID.overscaledZ)))}Ht(US,"LineBucket",{omit:["layers","patternFeatures","currentVertex","currentVertexIsOutside"]});const HM=(o,e,i)=>(1-i)*o+i*e;function qM(o,e){return 1/GM(o,1,e.tileZoom)}function WM(o,e,i,c){return o.translatePosMatrix(c||e.tileID.projMatrix,e,i.paint.get("line-translate"),i.paint.get("line-translate-anchor"))}const ZM=o=>{const e=[];XM(o)&&e.push("RENDER_LINE_DASH"),o.paint.get("line-gradient")&&e.push("RENDER_LINE_GRADIENT");const i=o.paint.get("line-trim-offset");i[0]===0&&i[1]===0||e.push("RENDER_LINE_TRIM_OFFSET"),o.paint.get("line-border-width").constantOr(1)!==0&&e.push("RENDER_LINE_BORDER");const c=o.layout.get("line-join").constantOr("miter")==="none",u=!!o.paint.get("line-pattern").constantOr(1);return c&&u&&e.push("LINE_JOIN_NONE"),e};function XM(o){const e=o.paint.get("line-dasharray").value;return e.value||e.kind!=="constant"}let GS;const YM=()=>GS||(GS={layout:UM||(UM=new Ti({"line-cap":new Bt(Oe.layout_line["line-cap"]),"line-join":new Bt(Oe.layout_line["line-join"]),"line-miter-limit":new bt(Oe.layout_line["line-miter-limit"]),"line-round-limit":new bt(Oe.layout_line["line-round-limit"]),"line-sort-key":new Bt(Oe.layout_line["line-sort-key"]),"line-z-offset":new Bt(Oe.layout_line["line-z-offset"]),"line-elevation-reference":new bt(Oe.layout_line["line-elevation-reference"]),"line-cross-slope":new bt(Oe.layout_line["line-cross-slope"]),visibility:new bt(Oe.layout_line.visibility),"line-width-unit":new bt(Oe.layout_line["line-width-unit"])})),paint:$M||($M=new Ti({"line-opacity":new Bt(Oe.paint_line["line-opacity"]),"line-color":new Bt(Oe.paint_line["line-color"]),"line-translate":new bt(Oe.paint_line["line-translate"]),"line-translate-anchor":new bt(Oe.paint_line["line-translate-anchor"]),"line-width":new Bt(Oe.paint_line["line-width"]),"line-gap-width":new Bt(Oe.paint_line["line-gap-width"]),"line-offset":new Bt(Oe.paint_line["line-offset"]),"line-blur":new Bt(Oe.paint_line["line-blur"]),"line-dasharray":new Bt(Oe.paint_line["line-dasharray"]),"line-pattern":new Bt(Oe.paint_line["line-pattern"]),"line-pattern-cross-fade":new bt(Oe.paint_line["line-pattern-cross-fade"]),"line-gradient":new iu(Oe.paint_line["line-gradient"]),"line-trim-offset":new bt(Oe.paint_line["line-trim-offset"]),"line-trim-fade-range":new bt(Oe.paint_line["line-trim-fade-range"]),"line-trim-color":new bt(Oe.paint_line["line-trim-color"]),"line-emissive-strength":new bt(Oe.paint_line["line-emissive-strength"]),"line-border-width":new Bt(Oe.paint_line["line-border-width"]),"line-border-color":new Bt(Oe.paint_line["line-border-color"]),"line-occlusion-opacity":new bt(Oe.paint_line["line-occlusion-opacity"]),"line-color-use-theme":new Bt({type:"string",default:"default","property-type":"data-driven"}),"line-gradient-use-theme":new Bt({type:"string",default:"default","property-type":"data-driven"}),"line-trim-color-use-theme":new Bt({type:"string",default:"default","property-type":"data-driven"}),"line-border-color-use-theme":new Bt({type:"string",default:"default","property-type":"data-driven"})}))},GS);class C6 extends Bt{possiblyEvaluate(e,i){return i=new Fr(Math.floor(i.zoom),{now:i.now,fadeDuration:i.fadeDuration,transition:i.transition,worldview:i.worldview}),super.possiblyEvaluate(e,i)}evaluate(e,i,c,u){return i=$e({},i,{zoom:Math.floor(i.zoom)}),super.evaluate(e,i,c,u)}}let Dy;function KM(o,e){return e>0?e+2*o:o}const A6=hr([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_tex_size",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),I6=hr([{name:"a_globe_anchor",components:3,type:"Int16"},{name:"a_globe_normal",components:3,type:"Float32"}],4),P6=hr([{name:"a_projected_pos",components:4,type:"Float32"}],4);hr([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const M6=hr([{name:"a_auto_z_offset",components:1,type:"Float32"}],4),R6=hr([{name:"a_x_axis",components:3,type:"Float32"},{name:"a_y_axis",components:3,type:"Float32"}]),k6=hr([{name:"a_texb",components:2,type:"Uint16"}]),D6=hr([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"},{name:"a_elevation_from_sea",components:2,type:"Float32"}]),L6=hr([{name:"a_size_scale",components:1,type:"Float32"},{name:"a_padding",components:2,type:"Float32"},{name:"a_auto_z_offset",components:1,type:"Float32"}]);hr([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"tileAnchorX"},{type:"Int16",name:"tileAnchorY"},{type:"Float32",name:"x1"},{type:"Float32",name:"y1"},{type:"Float32",name:"x2"},{type:"Float32",name:"y2"},{type:"Int16",name:"padding"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const QM=hr([{name:"a_pos",components:3,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),N6=hr([{name:"a_pos_2f",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);hr([{name:"triangle",components:3,type:"Uint16"}]),hr([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"},{type:"Uint8",name:"flipState"}]),hr([{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Float32",name:"zOffset"},{type:"Uint8",name:"hasIconTextFit"},{type:"Uint16",name:"elevationFeatureIndex"}]),hr([{type:"Float32",name:"offsetX"}]),hr([{type:"Int16",name:"x"},{type:"Int16",name:"y"}]);var ms=24;function z6(o,e,i){return o.sections.forEach(c=>{c.text=function(u,p,m){const v=p.layout.get("text-transform").evaluate(m,{});return v==="uppercase"?u=u.toLocaleUpperCase():v==="lowercase"&&(u=u.toLocaleLowerCase()),pl.applyArabicShaping&&(u=pl.applyArabicShaping(u)),u}(c.text,e,i)}),o}const Ly={"!":"︕","#":"＃",$:"＄","%":"％","&":"＆","(":"︵",")":"︶","*":"＊","+":"＋",",":"︐","-":"︲",".":"・","/":"／",":":"︓",";":"︔","<":"︿","=":"＝",">":"﹀","?":"︖","@":"＠","[":"﹇","\\":"＼","]":"﹈","^":"＾",_:"︳","`":"｀","{":"︷","|":"―","}":"︸","~":"～","¢":"￠","£":"￡","¥":"￥","¦":"￤","¬":"￢","¯":"￣","–":"︲","—":"︱","‘":"﹃","’":"﹄","“":"﹁","”":"﹂","…":"︙","‧":"・","₩":"￦","、":"︑","。":"︒","〈":"︿","〉":"﹀","《":"︽","》":"︾","「":"﹁","」":"﹂","『":"﹃","』":"﹄","【":"︻","】":"︼","〔":"︹","〕":"︺","〖":"︗","〗":"︘","！":"︕","（":"︵","）":"︶","，":"︐","－":"︲","．":"・","：":"︓","；":"︔","＜":"︿","＞":"﹀","？":"︖","［":"﹇","］":"﹈","＿":"︳","｛":"︷","｜":"―","｝":"︸","｟":"︵","｠":"︶","｡":"︒","｢":"﹁","｣":"﹂","←":"↑","→":"↓"};function O6(o){return o==="︶"||o==="﹈"||o==="︸"||o==="﹄"||o==="﹂"||o==="︾"||o==="︼"||o==="︺"||o==="︘"||o==="﹀"||o==="︐"||o==="︓"||o==="︔"||o==="｀"||o==="￣"||o==="︑"||o==="︒"}function F6(o){return o==="︵"||o==="﹇"||o==="︷"||o==="﹃"||o==="﹁"||o==="︽"||o==="︻"||o==="︹"||o==="︗"||o==="︿"}var JM,HS,eR,qS={};/*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> */function j6(){return JM||(JM=1,qS.read=function(o,e,i,c,u){var p,m,v=8*u-c-1,S=(1<<v)-1,T=S>>1,I=-7,P=i?u-1:0,M=i?-1:1,L=o[e+P];for(P+=M,p=L&(1<<-I)-1,L>>=-I,I+=v;I>0;p=256*p+o[e+P],P+=M,I-=8);for(m=p&(1<<-I)-1,p>>=-I,I+=c;I>0;m=256*m+o[e+P],P+=M,I-=8);if(p===0)p=1-T;else{if(p===S)return m?NaN:1/0*(L?-1:1);m+=Math.pow(2,c),p-=T}return(L?-1:1)*m*Math.pow(2,p-c)},qS.write=function(o,e,i,c,u,p){var m,v,S,T=8*p-u-1,I=(1<<T)-1,P=I>>1,M=u===23?Math.pow(2,-24)-Math.pow(2,-77):0,L=c?0:p-1,O=c?1:-1,G=e<0||e===0&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(v=isNaN(e)?1:0,m=I):(m=Math.floor(Math.log(e)/Math.LN2),e*(S=Math.pow(2,-m))<1&&(m--,S*=2),(e+=m+P>=1?M/S:M*Math.pow(2,1-P))*S>=2&&(m++,S/=2),m+P>=I?(v=0,m=I):m+P>=1?(v=(e*S-1)*Math.pow(2,u),m+=P):(v=e*Math.pow(2,P-1)*Math.pow(2,u),m=0));u>=8;o[i+L]=255&v,L+=O,v/=256,u-=8);for(m=m<<u|v,T+=u;T>0;o[i+L]=255&m,L+=O,m/=256,T-=8);o[i+L-O]|=128*G}),qS}function tR(){if(eR)return HS;eR=1,HS=e;var o=j6();function e(q){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(q)?q:new Uint8Array(q||0),this.pos=0,this.type=0,this.length=this.buf.length}e.Varint=0,e.Fixed64=1,e.Bytes=2,e.Fixed32=5;var i=4294967296,c=1/i,u=typeof TextDecoder>"u"?null:new TextDecoder("utf8");function p(q){return q.type===e.Bytes?q.readVarint()+q.pos:q.pos+1}function m(q,re,ue){return ue?4294967296*re+(q>>>0):4294967296*(re>>>0)+(q>>>0)}function v(q,re,ue){var pe=re<=16383?1:re<=2097151?2:re<=268435455?3:Math.floor(Math.log(re)/(7*Math.LN2));ue.realloc(pe);for(var Ae=ue.pos-1;Ae>=q;Ae--)ue.buf[Ae+pe]=ue.buf[Ae]}function S(q,re){for(var ue=0;ue<q.length;ue++)re.writeVarint(q[ue])}function T(q,re){for(var ue=0;ue<q.length;ue++)re.writeSVarint(q[ue])}function I(q,re){for(var ue=0;ue<q.length;ue++)re.writeFloat(q[ue])}function P(q,re){for(var ue=0;ue<q.length;ue++)re.writeDouble(q[ue])}function M(q,re){for(var ue=0;ue<q.length;ue++)re.writeBoolean(q[ue])}function L(q,re){for(var ue=0;ue<q.length;ue++)re.writeFixed32(q[ue])}function O(q,re){for(var ue=0;ue<q.length;ue++)re.writeSFixed32(q[ue])}function G(q,re){for(var ue=0;ue<q.length;ue++)re.writeFixed64(q[ue])}function Z(q,re){for(var ue=0;ue<q.length;ue++)re.writeSFixed64(q[ue])}function Q(q,re){return(q[re]|q[re+1]<<8|q[re+2]<<16)+16777216*q[re+3]}function le(q,re,ue){q[ue]=re,q[ue+1]=re>>>8,q[ue+2]=re>>>16,q[ue+3]=re>>>24}function ce(q,re){return(q[re]|q[re+1]<<8|q[re+2]<<16)+(q[re+3]<<24)}return e.prototype={destroy:function(){this.buf=null},readFields:function(q,re,ue){for(ue=ue||this.length;this.pos<ue;){var pe=this.readVarint(),Ae=pe>>3,Te=this.pos;this.type=7&pe,q(Ae,re,this),this.pos===Te&&this.skip(pe)}return re},readMessage:function(q,re){return this.readFields(q,re,this.readVarint()+this.pos)},readFixed32:function(){var q=Q(this.buf,this.pos);return this.pos+=4,q},readSFixed32:function(){var q=ce(this.buf,this.pos);return this.pos+=4,q},readFixed64:function(){var q=Q(this.buf,this.pos)+Q(this.buf,this.pos+4)*i;return this.pos+=8,q},readSFixed64:function(){var q=Q(this.buf,this.pos)+ce(this.buf,this.pos+4)*i;return this.pos+=8,q},readFloat:function(){var q=o.read(this.buf,this.pos,!0,23,4);return this.pos+=4,q},readDouble:function(){var q=o.read(this.buf,this.pos,!0,52,8);return this.pos+=8,q},readVarint:function(q){var re,ue,pe=this.buf;return re=127&(ue=pe[this.pos++]),ue<128?re:(re|=(127&(ue=pe[this.pos++]))<<7,ue<128?re:(re|=(127&(ue=pe[this.pos++]))<<14,ue<128?re:(re|=(127&(ue=pe[this.pos++]))<<21,ue<128?re:function(Ae,Te,Ie){var Ne,Ke,yt=Ie.buf;if(Ne=(112&(Ke=yt[Ie.pos++]))>>4,Ke<128||(Ne|=(127&(Ke=yt[Ie.pos++]))<<3,Ke<128)||(Ne|=(127&(Ke=yt[Ie.pos++]))<<10,Ke<128)||(Ne|=(127&(Ke=yt[Ie.pos++]))<<17,Ke<128)||(Ne|=(127&(Ke=yt[Ie.pos++]))<<24,Ke<128)||(Ne|=(1&(Ke=yt[Ie.pos++]))<<31,Ke<128))return m(Ae,Ne,Te);throw new Error("Expected varint not more than 10 bytes")}(re|=(15&(ue=pe[this.pos]))<<28,q,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var q=this.readVarint();return q%2==1?(q+1)/-2:q/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var q=this.readVarint()+this.pos,re=this.pos;return this.pos=q,q-re>=12&&u?function(ue,pe,Ae){return u.decode(ue.subarray(pe,Ae))}(this.buf,re,q):function(ue,pe,Ae){for(var Te="",Ie=pe;Ie<Ae;){var Ne,Ke,yt,at=ue[Ie],_t=null,xt=at>239?4:at>223?3:at>191?2:1;if(Ie+xt>Ae)break;xt===1?at<128&&(_t=at):xt===2?(192&(Ne=ue[Ie+1]))==128&&(_t=(31&at)<<6|63&Ne)<=127&&(_t=null):xt===3?(Ke=ue[Ie+2],(192&(Ne=ue[Ie+1]))==128&&(192&Ke)==128&&((_t=(15&at)<<12|(63&Ne)<<6|63&Ke)<=2047||_t>=55296&&_t<=57343)&&(_t=null)):xt===4&&(Ke=ue[Ie+2],yt=ue[Ie+3],(192&(Ne=ue[Ie+1]))==128&&(192&Ke)==128&&(192&yt)==128&&((_t=(15&at)<<18|(63&Ne)<<12|(63&Ke)<<6|63&yt)<=65535||_t>=1114112)&&(_t=null)),_t===null?(_t=65533,xt=1):_t>65535&&(_t-=65536,Te+=String.fromCharCode(_t>>>10&1023|55296),_t=56320|1023&_t),Te+=String.fromCharCode(_t),Ie+=xt}return Te}(this.buf,re,q)},readBytes:function(){var q=this.readVarint()+this.pos,re=this.buf.subarray(this.pos,q);return this.pos=q,re},readPackedVarint:function(q,re){if(this.type!==e.Bytes)return q.push(this.readVarint(re));var ue=p(this);for(q=q||[];this.pos<ue;)q.push(this.readVarint(re));return q},readPackedSVarint:function(q){if(this.type!==e.Bytes)return q.push(this.readSVarint());var re=p(this);for(q=q||[];this.pos<re;)q.push(this.readSVarint());return q},readPackedBoolean:function(q){if(this.type!==e.Bytes)return q.push(this.readBoolean());var re=p(this);for(q=q||[];this.pos<re;)q.push(this.readBoolean());return q},readPackedFloat:function(q){if(this.type!==e.Bytes)return q.push(this.readFloat());var re=p(this);for(q=q||[];this.pos<re;)q.push(this.readFloat());return q},readPackedDouble:function(q){if(this.type!==e.Bytes)return q.push(this.readDouble());var re=p(this);for(q=q||[];this.pos<re;)q.push(this.readDouble());return q},readPackedFixed32:function(q){if(this.type!==e.Bytes)return q.push(this.readFixed32());var re=p(this);for(q=q||[];this.pos<re;)q.push(this.readFixed32());return q},readPackedSFixed32:function(q){if(this.type!==e.Bytes)return q.push(this.readSFixed32());var re=p(this);for(q=q||[];this.pos<re;)q.push(this.readSFixed32());return q},readPackedFixed64:function(q){if(this.type!==e.Bytes)return q.push(this.readFixed64());var re=p(this);for(q=q||[];this.pos<re;)q.push(this.readFixed64());return q},readPackedSFixed64:function(q){if(this.type!==e.Bytes)return q.push(this.readSFixed64());var re=p(this);for(q=q||[];this.pos<re;)q.push(this.readSFixed64());return q},skip:function(q){var re=7&q;if(re===e.Varint)for(;this.buf[this.pos++]>127;);else if(re===e.Bytes)this.pos=this.readVarint()+this.pos;else if(re===e.Fixed32)this.pos+=4;else{if(re!==e.Fixed64)throw new Error("Unimplemented type: "+re);this.pos+=8}},writeTag:function(q,re){this.writeVarint(q<<3|re)},realloc:function(q){for(var re=this.length||16;re<this.pos+q;)re*=2;if(re!==this.length){var ue=new Uint8Array(re);ue.set(this.buf),this.buf=ue,this.length=re}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(q){this.realloc(4),le(this.buf,q,this.pos),this.pos+=4},writeSFixed32:function(q){this.realloc(4),le(this.buf,q,this.pos),this.pos+=4},writeFixed64:function(q){this.realloc(8),le(this.buf,-1&q,this.pos),le(this.buf,Math.floor(q*c),this.pos+4),this.pos+=8},writeSFixed64:function(q){this.realloc(8),le(this.buf,-1&q,this.pos),le(this.buf,Math.floor(q*c),this.pos+4),this.pos+=8},writeVarint:function(q){(q=+q||0)>268435455||q<0?function(re,ue){var pe,Ae;if(re>=0?(pe=re%4294967296|0,Ae=re/4294967296|0):(Ae=~(-re/4294967296),4294967295^(pe=~(-re%4294967296))?pe=pe+1|0:(pe=0,Ae=Ae+1|0)),re>=18446744073709552e3||re<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");ue.realloc(10),function(Te,Ie,Ne){Ne.buf[Ne.pos++]=127&Te|128,Te>>>=7,Ne.buf[Ne.pos++]=127&Te|128,Te>>>=7,Ne.buf[Ne.pos++]=127&Te|128,Te>>>=7,Ne.buf[Ne.pos++]=127&Te|128,Ne.buf[Ne.pos]=127&(Te>>>=7)}(pe,0,ue),function(Te,Ie){var Ne=(7&Te)<<4;Ie.buf[Ie.pos++]|=Ne|((Te>>>=3)?128:0),Te&&(Ie.buf[Ie.pos++]=127&Te|((Te>>>=7)?128:0),Te&&(Ie.buf[Ie.pos++]=127&Te|((Te>>>=7)?128:0),Te&&(Ie.buf[Ie.pos++]=127&Te|((Te>>>=7)?128:0),Te&&(Ie.buf[Ie.pos++]=127&Te|((Te>>>=7)?128:0),Te&&(Ie.buf[Ie.pos++]=127&Te)))))}(Ae,ue)}(q,this):(this.realloc(4),this.buf[this.pos++]=127&q|(q>127?128:0),q<=127||(this.buf[this.pos++]=127&(q>>>=7)|(q>127?128:0),q<=127||(this.buf[this.pos++]=127&(q>>>=7)|(q>127?128:0),q<=127||(this.buf[this.pos++]=q>>>7&127))))},writeSVarint:function(q){this.writeVarint(q<0?2*-q-1:2*q)},writeBoolean:function(q){this.writeVarint(!!q)},writeString:function(q){q=String(q),this.realloc(4*q.length),this.pos++;var re=this.pos;this.pos=function(pe,Ae,Te){for(var Ie,Ne,Ke=0;Ke<Ae.length;Ke++){if((Ie=Ae.charCodeAt(Ke))>55295&&Ie<57344){if(!Ne){Ie>56319||Ke+1===Ae.length?(pe[Te++]=239,pe[Te++]=191,pe[Te++]=189):Ne=Ie;continue}if(Ie<56320){pe[Te++]=239,pe[Te++]=191,pe[Te++]=189,Ne=Ie;continue}Ie=Ne-55296<<10|Ie-56320|65536,Ne=null}else Ne&&(pe[Te++]=239,pe[Te++]=191,pe[Te++]=189,Ne=null);Ie<128?pe[Te++]=Ie:(Ie<2048?pe[Te++]=Ie>>6|192:(Ie<65536?pe[Te++]=Ie>>12|224:(pe[Te++]=Ie>>18|240,pe[Te++]=Ie>>12&63|128),pe[Te++]=Ie>>6&63|128),pe[Te++]=63&Ie|128)}return Te}(this.buf,q,this.pos);var ue=this.pos-re;ue>=128&&v(re,ue,this),this.pos=re-1,this.writeVarint(ue),this.pos+=ue},writeFloat:function(q){this.realloc(4),o.write(this.buf,q,this.pos,!0,23,4),this.pos+=4},writeDouble:function(q){this.realloc(8),o.write(this.buf,q,this.pos,!0,52,8),this.pos+=8},writeBytes:function(q){var re=q.length;this.writeVarint(re),this.realloc(re);for(var ue=0;ue<re;ue++)this.buf[this.pos++]=q[ue]},writeRawMessage:function(q,re){this.pos++;var ue=this.pos;q(re,this);var pe=this.pos-ue;pe>=128&&v(ue,pe,this),this.pos=ue-1,this.writeVarint(pe),this.pos+=pe},writeMessage:function(q,re,ue){this.writeTag(q,e.Bytes),this.writeRawMessage(re,ue)},writePackedVarint:function(q,re){re.length&&this.writeMessage(q,S,re)},writePackedSVarint:function(q,re){re.length&&this.writeMessage(q,T,re)},writePackedBoolean:function(q,re){re.length&&this.writeMessage(q,M,re)},writePackedFloat:function(q,re){re.length&&this.writeMessage(q,I,re)},writePackedDouble:function(q,re){re.length&&this.writeMessage(q,P,re)},writePackedFixed32:function(q,re){re.length&&this.writeMessage(q,L,re)},writePackedSFixed32:function(q,re){re.length&&this.writeMessage(q,O,re)},writePackedFixed64:function(q,re){re.length&&this.writeMessage(q,G,re)},writePackedSFixed64:function(q,re){re.length&&this.writeMessage(q,Z,re)},writeBytesField:function(q,re){this.writeTag(q,e.Bytes),this.writeBytes(re)},writeFixed32Field:function(q,re){this.writeTag(q,e.Fixed32),this.writeFixed32(re)},writeSFixed32Field:function(q,re){this.writeTag(q,e.Fixed32),this.writeSFixed32(re)},writeFixed64Field:function(q,re){this.writeTag(q,e.Fixed64),this.writeFixed64(re)},writeSFixed64Field:function(q,re){this.writeTag(q,e.Fixed64),this.writeSFixed64(re)},writeVarintField:function(q,re){this.writeTag(q,e.Varint),this.writeVarint(re)},writeSVarintField:function(q,re){this.writeTag(q,e.Varint),this.writeSVarint(re)},writeStringField:function(q,re){this.writeTag(q,e.Bytes),this.writeString(re)},writeFloatField:function(q,re){this.writeTag(q,e.Fixed32),this.writeFloat(re)},writeDoubleField:function(q,re){this.writeTag(q,e.Fixed64),this.writeDouble(re)},writeBooleanField:function(q,re){this.writeVarintField(q,!!re)}},HS}var l1=mi(tR());const WS=3;function B6(o,e,i){e.glyphs=[],o===1&&i.readMessage(V6,e)}function V6(o,e,i){if(o===3){const{id:c,bitmap:u,width:p,height:m,left:v,top:S,advance:T}=i.readMessage(U6,{});e.glyphs.push({id:c,bitmap:new md({width:p+2*WS,height:m+2*WS},u),metrics:{width:p,height:m,left:v,top:S,advance:T}})}else o===4?e.ascender=i.readSVarint():o===5&&(e.descender=i.readSVarint())}function U6(o,e,i){o===1?e.id=i.readVarint():o===2?e.bitmap=i.readBytes():o===3?e.width=i.readVarint():o===4?e.height=i.readVarint():o===5?e.left=i.readSVarint():o===6?e.top=i.readSVarint():o===7&&(e.advance=i.readVarint())}const $6=WS,jo={horizontal:1,vertical:2,horizontalOnly:3};class Ny{constructor(){this.scale=1,this.fontStack="",this.image=null}static forText(e,i){const c=new Ny;return c.scale=e||1,c.fontStack=i,c}static forImage(e){const i=new Ny;return i.image=e,i}}class Rm{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(e,i,c){const u=new Rm;for(let p=0;p<e.sections.length;p++){const m=e.sections[p];m.image?u.addImageSection(m,c):u.addTextSection(m,i)}return u}length(){return this.text.length}getSection(e){return this.sections[this.sectionIndex[e]]}getSections(){return this.sections}getSectionIndex(e){return this.sectionIndex[e]}getCodePoint(e){return this.text.codePointAt(e)}verticalizePunctuation(e){this.text=function(i,c){let u="";for(let p=0;p<i.length;p++){const m=i.charCodeAt(p+1)||null,v=i.charCodeAt(p-1)||null;u+=!c&&(m&&x0(m)&&!Ly[i[p+1]]||v&&x0(v)&&!Ly[i[p-1]])||!Ly[i[p]]?i[p]:Ly[i[p]]}return u}(this.text,e)}trim(){let e=0;for(let c=0;c<this.text.length&&c1[this.text.charCodeAt(c)];c++)e++;let i=this.text.length;for(let c=this.text.length-1;c>=0&&c>=e&&c1[this.text.charCodeAt(c)];c--)i--;this.text=this.text.substring(e,i),this.sectionIndex=this.sectionIndex.slice(e,i)}substring(e,i){const c=new Rm;return c.text=this.text.substring(e,i),c.sectionIndex=this.sectionIndex.slice(e,i),c.sections=this.sections,c}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((e,i)=>Math.max(e,this.sections[i].scale),0)}addTextSection(e,i){this.text+=e.text,this.sections.push(Ny.forText(e.scale,e.fontStack||i));const c=this.sections.length-1;for(let u=0;u<e.text.length;++u)this.sectionIndex.push(c)}addImageSection(e,i){const c=e.image?e.image.getPrimary():null;if(!c)return void On("Can't add FormattedSection with an empty image.");c.scaleSelf(i);const u=this.getNextImageSectionCharCode();u?(this.text+=String.fromCodePoint(u),this.sections.push(Ny.forImage(c)),this.sectionIndex.push(this.sections.length-1)):On("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function ZS(o,e,i,c,u,p,m,v,S,T,I,P,M,L,O,G=1){const Z=Rm.fromFeature(o,u,G);P===jo.vertical&&Z.verticalizePunctuation(M);let Q=[];const le=function(pe,Ae,Te,Ie,Ne,Ke){if(!pe)return[];const yt=[],at=function(pt,Ze,Qe,St,Et,ln){let Kt=0;for(let Ot=0;Ot<pt.length();Ot++){const wt=pt.getSection(Ot);Kt+=nR(pt.getCodePoint(Ot),wt,St,Et,Ze,ln)}return Kt/Math.max(1,Math.ceil(Kt/Qe))}(pe,Ae,Te,Ie,Ne,Ke),_t=pe.text.indexOf("​")>=0;let xt=0;for(let pt=0;pt<pe.length();pt++){const Ze=pe.getSection(pt),Qe=pe.getCodePoint(pt);if(c1[Qe]||(xt+=nR(Qe,Ze,Ie,Ne,Ae,Ke)),pt<pe.length()-1){const St=!((et=Qe)<11904||!(hn["Bopomofo Extended"](et)||hn.Bopomofo(et)||hn["CJK Compatibility Forms"](et)||hn["CJK Compatibility Ideographs"](et)||hn["CJK Compatibility"](et)||hn["CJK Radicals Supplement"](et)||hn["CJK Strokes"](et)||hn["CJK Symbols and Punctuation"](et)||hn["CJK Unified Ideographs Extension A"](et)||hn["CJK Unified Ideographs"](et)||hn["Enclosed CJK Letters and Months"](et)||hn["Halfwidth and Fullwidth Forms"](et)||hn.Hiragana(et)||hn["Ideographic Description Characters"](et)||hn["Kangxi Radicals"](et)||hn["Katakana Phonetic Extensions"](et)||hn.Katakana(et)||hn["Vertical Forms"](et)||hn["Yi Radicals"](et)||hn["Yi Syllables"](et)));(G6[Qe]||St||Ze.image)&&yt.push(iR(pt+1,xt,at,yt,H6(Qe,pe.getCodePoint(pt+1),St&&_t),!1))}}var et;return sR(iR(pe.length(),xt,at,yt,0,!0))}(Z,T,p,e,c,L),{processBidirectionalText:ce,processStyledBidirectionalText:q}=pl;if(ce&&Z.sections.length===1){const pe=ce(Z.toString(),le);for(const Ae of pe){const Te=new Rm;Te.text=Ae,Te.sections=Z.sections;for(let Ie=0;Ie<Ae.length;Ie++)Te.sectionIndex.push(0);Q.push(Te)}}else if(q){const pe=q(Z.text,Z.sectionIndex,le);for(const Ae of pe){const Te=new Rm;Te.text=Ae[0],Te.sectionIndex=Ae[1],Te.sections=Z.sections,Q.push(Te)}}else Q=function(pe,Ae){const Te=[],Ie=pe.text;let Ne=0;for(const Ke of Ae)Te.push(pe.substring(Ne,Ke)),Ne=Ke;return Ne<Ie.length&&Te.push(pe.substring(Ne,Ie.length)),Te}(Z,le);const re=[],ue={positionedLines:re,text:Z.toString(),top:I[1],bottom:I[1],left:I[0],right:I[0],writingMode:P,iconsInText:!1,verticalizable:!1,hasBaseline:!1};if(function(pe,Ae,Te,Ie,Ne,Ke,yt,at,_t,xt,et,pt){let Ze=0,Qe=0,St=0;const Et=at==="right"?1:at==="left"?0:.5;let ln=!1;for(const Jt of Ne){const xn=Jt.getSections();for(const zn of xn){if(zn.image)continue;const Nn=Ae[zn.fontStack];if(Nn&&(ln=Nn.ascender!==void 0&&Nn.descender!==void 0,!ln))break}if(!ln)break}let Kt=0;for(const Jt of Ne){Jt.trim();const xn=Jt.getMaxScale(),zn=(xn-1)*ms,Nn={positionedGlyphs:[],lineOffset:0};pe.positionedLines[Kt]=Nn;const Xn=Nn.positionedGlyphs;let Vn=0;if(!Jt.length()){Qe+=Ke,++Kt;continue}let Yn=0,Ir=0;for(let he=0;he<Jt.length();he++){const me=Jt.getSection(he),nt=Jt.getSectionIndex(he),Rt=Jt.getCodePoint(he);let Ft=me.scale,zt=null,Xt=null,yn=null,er=ms,tr=0;_t===jo.vertical&&((Ot=Rt)===12312||Ot===12313||Ot===12316||Ot===12540||Ot===12448)&&(_t=jo.horizontal);const Un=!(_t===jo.horizontal||!et&&!X_(Rt)||et&&(c1[Rt]||oS(Rt)));if(me.image){const Dr=Ie.get(me.image.toString());if(!Dr)continue;yn=me.image,pe.iconsInText=pe.iconsInText||!0,Xt=Dr.paddedRect;const Hr=Dr.displaySize;Ft=Ft*ms/pt,zt={width:Hr[0],height:Hr[1],left:0,top:-3,advance:Un?Hr[1]:Hr[0],localGlyph:!1},tr=ln?-zt.height*Ft:xn*ms-17-Hr[1]*Ft,er=zt.advance;const nr=(Un?Hr[0]:Hr[1])*Ft-ms*xn;nr>0&&nr>Vn&&(Vn=nr)}else{const Dr=Te[me.fontStack];if(!Dr)continue;Dr[Rt]&&(Xt=Dr[Rt]);const Hr=Ae[me.fontStack];if(!Hr)continue;const nr=Hr.glyphs[Rt];if(!nr)continue;if(zt=nr.metrics,er=Rt!==8203?ms:0,ln){const vi=Hr.ascender!==void 0?Math.abs(Hr.ascender):0,Kr=Hr.descender!==void 0?Math.abs(Hr.descender):0,Pr=(vi+Kr)*Ft;Yn<Pr&&(Yn=Pr,Ir=(vi-Kr)/2*Ft),tr=-vi*Ft}else tr=(xn-Ft)*ms-17}Un?(pe.verticalizable=!0,Xn.push({glyph:Rt,image:yn,x:Ze,y:Qe+tr,vertical:Un,scale:Ft,localGlyph:zt.localGlyph,fontStack:me.fontStack,sectionIndex:nt,metrics:zt,rect:Xt}),Ze+=er*Ft+xt):(Xn.push({glyph:Rt,image:yn,x:Ze,y:Qe+tr,vertical:Un,scale:Ft,localGlyph:zt.localGlyph,fontStack:me.fontStack,sectionIndex:nt,metrics:zt,rect:Xt}),Ze+=zt.advance*Ft+xt)}Xn.length!==0&&(St=Math.max(Ze-xt,St),ln?oR(Xn,Et,Vn,Ir,Ke*xn/2):oR(Xn,Et,Vn,0,Ke/2)),Ze=0;const Yr=Ke*xn+Vn;Nn.lineOffset=Math.max(Vn,zn),Qe+=Yr,++Kt}var Ot;const wt=Qe,{horizontalAlign:Pn,verticalAlign:Yt}=XS(yt);(function(Jt,xn,zn,Nn,Xn,Vn){const Yn=(xn-zn)*Xn,Ir=-Vn*Nn;for(const Yr of Jt)for(const he of Yr.positionedGlyphs)he.x+=Yn,he.y+=Ir})(pe.positionedLines,Et,Pn,Yt,St,wt),pe.top+=-Yt*wt,pe.bottom=pe.top+wt,pe.left+=-Pn*St,pe.right=pe.left+St,pe.hasBaseline=ln}(ue,e,i,c,Q,m,v,S,P,T,M,O),!function(pe){for(const Ae of pe)if(Ae.positionedGlyphs.length!==0)return!1;return!0}(re))return ue}const c1={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},G6={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function nR(o,e,i,c,u,p){if(e.image){const m=c.get(e.image.toString());return m?m.displaySize[0]*e.scale*ms/p+u:0}{const m=i[e.fontStack],v=m&&m.glyphs[o];return v?v.metrics.advance*e.scale+u:0}}function rR(o,e,i,c){const u=Math.pow(o-e,2);return c?o<e?u/2:2*u:u+Math.abs(i)*i}function H6(o,e,i){let c=0;return o===10&&(c-=1e4),i&&(c+=150),o!==40&&o!==65288||(c+=50),e!==41&&e!==65289||(c+=50),c}function iR(o,e,i,c,u,p){let m=null,v=rR(e,i,u,p);for(const S of c){const T=rR(e-S.x,i,u,p)+S.badness;T<=v&&(m=S,v=T)}return{index:o,x:e,priorBreak:m,badness:v}}function sR(o){return o?sR(o.priorBreak).concat(o.index):[]}function XS(o){let e=.5,i=.5;switch(o){case"right":case"top-right":case"bottom-right":e=1;break;case"left":case"top-left":case"bottom-left":e=0}switch(o){case"bottom":case"bottom-right":case"bottom-left":i=1;break;case"top":case"top-right":case"top-left":i=0}return{horizontalAlign:e,verticalAlign:i}}function oR(o,e,i,c,u){if(!(e||i||c||u))return;const p=o.length-1,m=o[p],v=(m.x+m.metrics.advance*m.scale)*e;for(let S=0;S<=p;S++)o[S].x-=v,o[S].y+=i+c+u}function aR(o){return o.imagePrimary!==void 0&&o.top!==void 0&&o.bottom!==void 0&&o.left!==void 0&&o.right!==void 0}function q6(o,e,i,c){const{horizontalAlign:u,verticalAlign:p}=XS(c),m=i[0]-o.displaySize[0]*u,v=i[1]-o.displaySize[1]*p;return{imagePrimary:o,imageSecondary:e,top:v,bottom:v+o.displaySize[1],left:m,right:m+o.displaySize[0]}}function lR(o,e,i,c,u,p){const m=o.imagePrimary;let v;if(m.content){const Z=m.content,Q=m.pixelRatio||1;v=[Z[0]/Q,Z[1]/Q,m.displaySize[0]-Z[2]/Q,m.displaySize[1]-Z[3]/Q]}const S=e.left*p,T=e.right*p;let I,P,M,L;i==="width"||i==="both"?(L=u[0]+S-c[3],P=u[0]+T+c[1]):(L=u[0]+(S+T-m.displaySize[0])/2,P=L+m.displaySize[0]);const O=e.top*p,G=e.bottom*p;return i==="height"||i==="both"?(I=u[1]+O-c[0],M=u[1]+G+c[2]):(I=u[1]+(O+G-m.displaySize[1])/2,M=I+m.displaySize[1]),{imagePrimary:m,imageSecondary:void 0,top:I,right:P,bottom:M,left:L,collisionPadding:v}}function cR(o){return!o.imagePrimary.stretchX}function uR(o){return!o.imagePrimary.stretchY}function dR(o){return{width:o.right-o.left,height:o.bottom-o.top}}const gc=128;function hR(o,e,i){const{expression:c}=e;if(c.kind==="constant")return{kind:"constant",layoutSize:c.evaluate(new Fr(o+1,{worldview:i}))};if(c.kind==="source")return{kind:"source"};{const{zoomStops:u,interpolationType:p}=c;let m=0;for(;m<u.length&&u[m]<=o;)m++;m=Math.max(0,m-1);let v=m;for(;v<u.length&&u[v]<o+1;)v++;v=Math.min(u.length-1,v);const S=u[m],T=u[v];return c.kind==="composite"?{kind:"composite",minZoom:S,maxZoom:T,interpolationType:p}:{kind:"camera",minZoom:S,maxZoom:T,minSize:c.evaluate(new Fr(S,{worldview:i})),maxSize:c.evaluate(new Fr(T,{worldview:i})),interpolationType:p}}}function YS(o,{uSize:e,uSizeT:i},{lowerSize:c,upperSize:u}){return o.kind==="source"?c/gc:o.kind==="composite"?vn(c/gc,u/gc,i):e}function zy(o,e,i=1){let c=0,u=0;if(o.kind==="constant")u=o.layoutSize*i;else if(o.kind!=="source"){const{interpolationType:p,minZoom:m,maxZoom:v}=o,S=p?xe(Oo.interpolationFactor(p,e,m,v),0,1):0;o.kind==="camera"?u=vn(o.minSize,o.maxSize,S)*i:c=S*i}return{uSizeT:c,uSize:u}}class cu extends Dt{constructor(e,i,c,u,p){super(e,i),this.angle=u,this.z=c,p!==void 0&&(this.segment=p)}clone(){return new cu(this.x,this.y,this.z,this.angle,this.segment)}}function fR(o,e,i,c,u){if(e.segment===void 0)return!0;let p=e,m=e.segment+1,v=0;for(;v>-i/2;){if(m--,m<0)return!1;v-=o[m].dist(p),p=o[m]}v+=o[m].dist(o[m+1]),m++;const S=[];let T=0;for(;v<i/2;){const I=o[m],P=o[m+1];if(!P)return!1;let M=o[m-1].angleTo(I)-I.angleTo(P);for(M=Math.abs((M+3*Math.PI)%(2*Math.PI)-Math.PI),S.push({distance:v,angleDelta:M}),T+=M;v-S[0].distance>c;)T-=S.shift().angleDelta;if(T>u)return!1;m++,v+=I.dist(P)}return!0}function pR(o){let e=0;for(let i=0;i<o.length-1;i++)e+=o[i].dist(o[i+1]);return e}function mR(o,e,i){return o?.6*e*i:0}function gR(o,e){return Math.max(o?o.right-o.left:0,e?e.right-e.left:0)}function W6(o,e,i,c,u,p){const m=mR(i,u,p),v=gR(i,c)*p;let S=0;const T=pR(o)/2;for(let I=0;I<o.length-1;I++){const P=o[I],M=o[I+1],L=P.dist(M);if(S+L>T){const O=(T-S)/L,G=vn(P.x,M.x,O),Z=vn(P.y,M.y,O),Q=new cu(G,Z,0,M.angleTo(P),I);return!m||fR(o,Q,v,m,e)?Q:void 0}S+=L}}function Z6(o,e,i,c,u,p,m,v,S){const T=mR(c,p,m),I=gR(c,u),P=I*m,M=o[0].x===0||o[0].x===S||o[0].y===0||o[0].y===S;return e-P<e/4&&(e=P+e/4),_R(o,M?e/2*v%e:(I/2+2*p)*m*v%e,e,T,i,P,M,!1,S)}function _R(o,e,i,c,u,p,m,v,S){const T=p/2,I=pR(o);let P=0,M=e-i,L=[];for(let O=0;O<o.length-1;O++){const G=o[O],Z=o[O+1],Q=G.dist(Z),le=Z.angleTo(G);for(;M+i<P+Q;){M+=i;const ce=(M-P)/Q,q=vn(G.x,Z.x,ce),re=vn(G.y,Z.y,ce);if(q>=0&&q<S&&re>=0&&re<S&&M-T>=0&&M+T<=I){const ue=new cu(q,re,0,le,O);c&&!fR(o,ue,p,c,u)||L.push(ue)}}P+=Q}return v||L.length||m||(L=_R(o,P/2,i,c,u,p,m,!0,S)),L}function yR(o){let e=0,i=0;for(const m of o)e+=m.w*m.h,i=Math.max(i,m.w);o.sort((m,v)=>v.h-m.h);const c=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(e/.95)),i),h:1/0}];let u=0,p=0;for(const m of o)for(let v=c.length-1;v>=0;v--){const S=c[v];if(!(m.w>S.w||m.h>S.h)){if(m.x=S.x,m.y=S.y,p=Math.max(p,m.y+m.h),u=Math.max(u,m.x+m.w),m.w===S.w&&m.h===S.h){const T=c.pop();v<c.length&&(c[v]=T)}else m.h===S.h?(S.x+=m.w,S.w-=m.w):m.w===S.w?(S.y+=m.h,S.h-=m.h):(c.push({x:S.x+m.w,y:S.y,w:S.w-m.w,h:m.h}),S.y+=m.h,S.h-=m.h);break}}return{w:u,h:p,fill:e/(u*p)||0}}Ht(cu,"Anchor");const Af=1;class Oy{static getImagePositionScale(e,i,c){if(i&&e&&e.options&&e.options.transform){const u=e.options.transform;return{x:u.a,y:u.d}}return{x:c,y:c}}constructor(e,i,c,u){this.paddedRect=e;const{pixelRatio:p,version:m,stretchX:v,stretchY:S,content:T,sdf:I,usvg:P}=i;this.pixelRatio=p,this.stretchX=v,this.stretchY=S,this.content=T,this.version=m,this.padding=c,this.sdf=I,this.usvg=P,this.scale=Oy.getImagePositionScale(u,P,p)}get tl(){return[this.paddedRect.x+this.padding,this.paddedRect.y+this.padding]}get br(){return[this.paddedRect.x+this.paddedRect.w-this.padding,this.paddedRect.y+this.paddedRect.h-this.padding]}get displaySize(){return[(this.paddedRect.w-2*this.padding)/this.scale.x,(this.paddedRect.h-2*this.padding)/this.scale.y]}}function KS(o,e,i){const c=ll.parse(o),u=function(p,m,v=[1,1]){return{x:0,y:0,w:(p.data?p.data.width:p.width*v[0])+2*m,h:(p.data?p.data.height:p.height*v[1])+2*m}}(e,i,[c.options.transform.a,c.options.transform.d]);return{bin:u,imagePosition:new Oy(u,e,i,c),imageVariant:c}}class vR{constructor(e,i,c){const u=new Map,p=new Map;this.haveRenderCallbacks=[];const m=[];this.addImages(e,u,Af,m),this.addImages(i,p,2,m);const{w:v,h:S}=yR(m),T=new Is({width:v||1,height:S||1});for(const[I,P]of e.entries()){const M=u.get(I).paddedRect;Is.copy(P.data,T,{x:0,y:0},{x:M.x+Af,y:M.y+Af},P.data,c,P.sdf)}for(const[I,P]of i.entries()){const M=p.get(I),L=M.paddedRect;let O=M.padding;const G=L.x+O,Z=L.y+O,Q=P.data.width,le=P.data.height;O=O>1?O-1:O,Is.copy(P.data,T,{x:0,y:0},{x:G,y:Z},P.data,c),Is.copy(P.data,T,{x:0,y:le-O},{x:G,y:Z-O},{width:Q,height:O},c),Is.copy(P.data,T,{x:0,y:0},{x:G,y:Z+le},{width:Q,height:O},c),Is.copy(P.data,T,{x:Q-O,y:0},{x:G-O,y:Z},{width:O,height:le},c),Is.copy(P.data,T,{x:0,y:0},{x:G+Q,y:Z},{width:O,height:le},c),Is.copy(P.data,T,{x:Q-O,y:le-O},{x:G-O,y:Z-O},{width:O,height:O},c),Is.copy(P.data,T,{x:0,y:le-O},{x:G+Q,y:Z-O},{width:O,height:O},c),Is.copy(P.data,T,{x:0,y:0},{x:G+Q,y:Z+le},{width:O,height:O},c),Is.copy(P.data,T,{x:Q-O,y:0},{x:G-O,y:Z+le},{width:O,height:O},c)}this.lut=c,this.image=T,this.iconPositions=u,this.patternPositions=p}addImages(e,i,c,u){for(const[p,m]of e.entries()){const{bin:v,imagePosition:S,imageVariant:T}=KS(p,m,c);i.set(p,S),u.push(v),m.hasRenderCallback&&this.haveRenderCallbacks.push(T.id)}}patchUpdatedImages(e,i,c){this.haveRenderCallbacks=this.haveRenderCallbacks.filter(u=>e.hasImage(u,c)),e.dispatchRenderCallbacks(this.haveRenderCallbacks,c);for(const u of e.getUpdatedImages(c)){for(const p of this.iconPositions.keys()){const m=ll.parse(p);if(vo.isEqual(m.id,u)){const v=e.getImage(u,c);this.patchUpdatedImage(this.iconPositions.get(p),v,i)}}for(const p of this.patternPositions.keys()){const m=ll.parse(p);if(vo.isEqual(m.id,u)){const v=e.getImage(u,c);this.patchUpdatedImage(this.patternPositions.get(p),v,i)}}}}patchUpdatedImage(e,i,c){if(!e||!i||e.version===i.version)return;e.version=i.version;const[u,p]=e.tl,m=e.sdf;if(this.lut||m){const v={width:i.data.width,height:i.data.height},S=new Is(v);Is.copy(i.data,S,{x:0,y:0},{x:0,y:0},v,this.lut,m),c.update(S,{position:{x:u,y:p}})}else c.update(i.data,{position:{x:u,y:p}})}}Ht(Oy,"ImagePosition"),Ht(vR,"ImageAtlas");const u1=1e20;function xR(o,e,i,c,u,p,m,v,S){for(let T=e;T<e+c;T++)bR(o,i*p+T,p,u,m,v,S);for(let T=i;T<i+u;T++)bR(o,T*p+e,1,c,m,v,S)}function bR(o,e,i,c,u,p,m){p[0]=0,m[0]=-1e20,m[1]=u1,u[0]=o[e];for(let v=1,S=0,T=0;v<c;v++){u[v]=o[e+v*i];const I=v*v;do{const P=p[S];T=(u[v]-u[P]+I-P*P)/(v-P)/2}while(T<=m[S]&&--S>-1);S++,p[S]=v,m[S]=T,m[S+1]=u1}for(let v=0,S=0;v<c;v++){for(;m[S+1]<v;)S++;const T=p[S],I=v-T;o[e+v*i]=u[T]+I*I}}const vl=2,QS={none:0,ideographs:1,all:2};class km{constructor(e,i,c){this.requestManager=e,this.localGlyphMode=i,this.localFontFamily=c,this.urls={},this.entries={},this.localGlyphs={200:{},400:{},500:{},900:{}}}setURL(e,i){this.urls[i]=e}getGlyphs(e,i,c){const u=[],p=this.urls[i]||vs.GLYPHS_URL;for(const m in e)for(const v of e[m])u.push({stack:m,id:v});De(u,({stack:m,id:v},S)=>{let T=this.entries[m];T||(T=this.entries[m]={glyphs:{},requests:{},ranges:{},ascender:void 0,descender:void 0});let I=T.glyphs[v];if(I!==void 0)return void S(null,{stack:m,id:v,glyph:I});if(I=this._tinySDF(T,m,v),I)return T.glyphs[v]=I,void S(null,{stack:m,id:v,glyph:I});const P=Math.floor(v/256);if(256*P>65535)return On("glyphs > 65535 not supported"),void S(null,{stack:m,id:v,glyph:I});if(T.ranges[P])return void S(null,{stack:m,id:v,glyph:I});let M=T.requests[P];M||(M=T.requests[P]=[],km.loadGlyphRange(m,P,p,this.requestManager,(L,O)=>{if(O){T.ascender=O.ascender,T.descender=O.descender;for(const G in O.glyphs)this._doesCharSupportLocalGlyph(+G)||(T.glyphs[+G]=O.glyphs[+G]);T.ranges[P]=!0}for(const G of M)G(L,O);delete T.requests[P]})),M.push((L,O)=>{L?S(L):O&&S(null,{stack:m,id:v,glyph:O.glyphs[v]||null})})},(m,v)=>{if(m)c(m);else if(v){const S={};for(const{stack:T,id:I,glyph:P}of v)S[T]===void 0&&(S[T]={}),S[T].glyphs===void 0&&(S[T].glyphs={}),S[T].glyphs[I]=P&&{id:P.id,bitmap:P.bitmap.clone(),metrics:P.metrics},S[T].ascender=this.entries[T].ascender,S[T].descender=this.entries[T].descender;c(null,S)}})}_doesCharSupportLocalGlyph(e){return this.localGlyphMode!==QS.none&&(this.localGlyphMode===QS.all?!!this.localFontFamily:!!this.localFontFamily&&(hn["CJK Unified Ideographs"](e)||hn["Hangul Syllables"](e)||hn.Hiragana(e)||hn.Katakana(e)||hn["CJK Symbols and Punctuation"](e)||hn["CJK Unified Ideographs Extension A"](e)||hn["CJK Unified Ideographs Extension B"](e)||hn.Osage(e)))}_tinySDF(e,i,c){const u=this.localFontFamily;if(!u||!this._doesCharSupportLocalGlyph(c))return;let p=e.tinySDF;if(!p){let G="400";/bold/i.test(i)?G="900":/medium/i.test(i)?G="500":/light/i.test(i)&&(G="200"),p=e.tinySDF=new km.TinySDF({fontFamily:u,fontWeight:G,fontSize:24*vl,buffer:3*vl,radius:8*vl}),p.fontWeight=G}if(this.localGlyphs[p.fontWeight][c])return this.localGlyphs[p.fontWeight][c];const m=String.fromCodePoint(c),{data:v,width:S,height:T,glyphWidth:I,glyphHeight:P,glyphLeft:M,glyphTop:L,glyphAdvance:O}=p.draw(m);return this.localGlyphs[p.fontWeight][c]={id:c,bitmap:new md({width:S,height:T},v),metrics:{width:I/vl,height:P/vl,left:M/vl,top:L/vl-27,advance:O/vl,localGlyph:!0}}}}km.loadGlyphRange=function(o,e,i,c,u){const p=256*e,m=p+255,v=c.transformRequest(c.normalizeGlyphsURL(i).replace("{fontstack}",o).replace("{range}",`${p}-${m}`),Dh.Glyphs);Lh(v,(S,T)=>{if(S)u(S);else if(T){const I={},P=function(M){return new l1(M).readFields(B6,{})}(T);for(const M of P.glyphs)I[M.id]=M;u(null,{glyphs:I,ascender:P.ascender,descender:P.descender})}})},km.TinySDF=class{constructor({fontSize:o=24,buffer:e=3,radius:i=8,cutoff:c=.25,fontFamily:u="sans-serif",fontWeight:p="normal",fontStyle:m="normal"}={}){this.buffer=e,this.cutoff=c,this.radius=i;const v=this.size=o+4*e,S=this._createCanvas(v),T=this.ctx=S.getContext("2d",{willReadFrequently:!0});T.font=`${m} ${p} ${o}px ${u}`,T.textBaseline="alphabetic",T.textAlign="left",T.fillStyle="black",this.gridOuter=new Float64Array(v*v),this.gridInner=new Float64Array(v*v),this.f=new Float64Array(v),this.z=new Float64Array(v+1),this.v=new Uint16Array(v)}_createCanvas(o){const e=document.createElement("canvas");return e.width=e.height=o,e}draw(o){const{width:e,actualBoundingBoxAscent:i,actualBoundingBoxDescent:c,actualBoundingBoxLeft:u,actualBoundingBoxRight:p}=this.ctx.measureText(o),m=Math.ceil(i),v=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(p-u))),S=Math.min(this.size-this.buffer,m+Math.ceil(c)),T=v+2*this.buffer,I=S+2*this.buffer,P=Math.max(T*I,0),M=new Uint8ClampedArray(P),L={data:M,width:T,height:I,glyphWidth:v,glyphHeight:S,glyphTop:m,glyphLeft:0,glyphAdvance:e};if(v===0||S===0)return L;const{ctx:O,buffer:G,gridInner:Z,gridOuter:Q}=this;O.clearRect(G,G,v,S),O.fillText(o,G,G+m);const le=O.getImageData(G,G,v,S);Q.fill(u1,0,P),Z.fill(0,0,P);for(let ce=0;ce<S;ce++)for(let q=0;q<v;q++){const re=le.data[4*(ce*v+q)+3]/255;if(re===0)continue;const ue=(ce+G)*T+q+G;if(re===1)Q[ue]=0,Z[ue]=u1;else{const pe=.5-re;Q[ue]=pe>0?pe*pe:0,Z[ue]=pe<0?pe*pe:0}}xR(Q,0,0,T,I,T,this.f,this.v,this.z),xR(Z,G,G,v,S,T,this.f,this.v,this.z);for(let ce=0;ce<P;ce++){const q=Math.sqrt(Q[ce])-Math.sqrt(Z[ce]);M[ce]=Math.round(255-255*(q/this.radius+this.cutoff))}return L}};const If=Af;function wR(o,e){return o+e[1]-e[0]}function SR(o,e,i,c,u=1){const p=[],m=o.imagePrimary,v=m.pixelRatio,S=m.paddedRect.w-2*If,T=m.paddedRect.h-2*If,I=(o.right-o.left)*u,P=(o.bottom-o.top)*u,M=m.stretchX||[[0,S]],L=m.stretchY||[[0,T]],O=M.reduce(wR,0),G=L.reduce(wR,0),Z=S-O,Q=T-G;let le=0,ce=O,q=0,re=G,ue=0,pe=Z,Ae=0,Te=Q;if(m.content&&c){const Ne=m.content;le=d1(M,0,Ne[0]),q=d1(L,0,Ne[1]),ce=d1(M,Ne[0],Ne[2]),re=d1(L,Ne[1],Ne[3]),ue=Ne[0]-le,Ae=Ne[1]-q,pe=Ne[2]-Ne[0]-ce,Te=Ne[3]-Ne[1]-re}const Ie=(Ne,Ke,yt,at)=>{const _t=h1(Ne.stretch-le,ce,I,o.left*u),xt=f1(Ne.fixed-ue,pe,Ne.stretch,O),et=h1(Ke.stretch-q,re,P,o.top*u),pt=f1(Ke.fixed-Ae,Te,Ke.stretch,G),Ze=h1(yt.stretch-le,ce,I,o.left*u),Qe=f1(yt.fixed-ue,pe,yt.stretch,O),St=h1(at.stretch-q,re,P,o.top*u),Et=f1(at.fixed-Ae,Te,at.stretch,G),ln=new Dt(_t,et),Kt=new Dt(Ze,et),Ot=new Dt(Ze,St),wt=new Dt(_t,St),Pn=new Dt(xt/v,pt/v),Yt=new Dt(Qe/v,Et/v),Jt=e*Math.PI/180;if(Jt){const Yn=Math.sin(Jt),Ir=Math.cos(Jt),Yr=[Ir,-Yn,Yn,Ir];ln._matMult(Yr),Kt._matMult(Yr),wt._matMult(Yr),Ot._matMult(Yr)}const xn=Ne.stretch+Ne.fixed,zn=yt.stretch+yt.fixed,Nn=Ke.stretch+Ke.fixed,Xn=at.stretch+at.fixed,Vn=o.imageSecondary;return{tl:ln,tr:Kt,bl:wt,br:Ot,texPrimary:{x:m.paddedRect.x+If+xn,y:m.paddedRect.y+If+Nn,w:zn-xn,h:Xn-Nn},texSecondary:Vn?{x:Vn.paddedRect.x+If+xn,y:Vn.paddedRect.y+If+Nn,w:zn-xn,h:Xn-Nn}:void 0,writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:Pn,pixelOffsetBR:Yt,minFontScaleX:pe/v/I,minFontScaleY:Te/v/P,isSDF:i}};if(c&&(m.stretchX||m.stretchY)){const Ne=TR(M,Z,O),Ke=TR(L,Q,G);for(let yt=0;yt<Ne.length-1;yt++){const at=Ne[yt],_t=Ne[yt+1];for(let xt=0;xt<Ke.length-1;xt++)p.push(Ie(at,Ke[xt],_t,Ke[xt+1]))}}else p.push(Ie({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:S+1},{fixed:0,stretch:T+1}));return p}function d1(o,e,i){let c=0;for(const u of o)c+=Math.max(e,Math.min(i,u[1]))-Math.max(e,Math.min(i,u[0]));return c}function TR(o,e,i){const c=[{fixed:-1,stretch:0}];for(const[u,p]of o){const m=c[c.length-1];c.push({fixed:u-m.stretch,stretch:m.stretch}),c.push({fixed:u-m.stretch,stretch:m.stretch+(p-u)})}return c.push({fixed:e+If,stretch:i}),c}function h1(o,e,i,c){return o/e*i+c}function f1(o,e,i,c){return o-e*i/c}function X6(o,e,i,c){const u=e+o.positionedLines[c].lineOffset;return c===0?i+u/2:i+(u+(e+o.positionedLines[c-1].lineOffset))/2}function Y6(o,e=1,i=!1){let c=1/0,u=1/0,p=-1/0,m=-1/0;const v=o[0];for(let L=0;L<v.length;L++){const O=v[L];(!L||O.x<c)&&(c=O.x),(!L||O.y<u)&&(u=O.y),(!L||O.x>p)&&(p=O.x),(!L||O.y>m)&&(m=O.y)}const S=Math.min(p-c,m-u);let T=S/2;const I=new jp([],K6);if(S===0)return new Dt(c,u);for(let L=c;L<p;L+=S)for(let O=u;O<m;O+=S)I.push(new Dm(L+T,O+T,T,o));let P=function(L){let O=0,G=0,Z=0;const Q=L[0];for(let le=0,ce=Q.length,q=ce-1;le<ce;q=le++){const re=Q[le],ue=Q[q],pe=re.x*ue.y-ue.x*re.y;G+=(re.x+ue.x)*pe,Z+=(re.y+ue.y)*pe,O+=3*pe}return new Dm(G/O,Z/O,0,L)}(o),M=I.length;for(;I.length;){const L=I.pop();(L.d>P.d||!P.d)&&(P=L,i&&console.log("found best %d after %d probes",Math.round(1e4*L.d)/1e4,M)),L.max-P.d<=e||(T=L.h/2,I.push(new Dm(L.p.x-T,L.p.y-T,T,o)),I.push(new Dm(L.p.x+T,L.p.y-T,T,o)),I.push(new Dm(L.p.x-T,L.p.y+T,T,o)),I.push(new Dm(L.p.x+T,L.p.y+T,T,o)),M+=4)}return i&&(console.log(`num probes: ${M}`),console.log(`best distance: ${P.d}`)),P.p}function K6(o,e){return e.max-o.max}class Dm{constructor(e,i,c,u){this.p=new Dt(e,i),this.h=c,this.d=function(p,m){let v=!1,S=1/0;for(let T=0;T<m.length;T++){const I=m[T];for(let P=0,M=I.length,L=M-1;P<M;L=P++){const O=I[P],G=I[L];O.y>p.y!=G.y>p.y&&p.x<(G.x-O.x)*(p.y-O.y)/(G.y-O.y)+O.x&&(v=!v),S=Math.min(S,wm(p,O,G))}}return(v?1:-1)*Math.sqrt(S)}(this.p,u),this.max=this.d+this.h*Math.SQRT2}}const Q6=Object.keys,JS=Number.POSITIVE_INFINITY,J6=Math.sqrt(2);function ER(o,[e,i]){let c=0,u=0;if(i===JS){e<0&&(e=0);const p=e/J6;switch(o){case"top-right":case"top-left":u=p-7;break;case"bottom-right":case"bottom-left":u=7-p;break;case"bottom":u=7-e;break;case"top":u=e-7}switch(o){case"top-right":case"bottom-right":c=-p;break;case"top-left":case"bottom-left":c=p;break;case"left":c=e;break;case"right":c=-e}}else{switch(e=Math.abs(e),i=Math.abs(i),o){case"top-right":case"top-left":case"top":u=i-7;break;case"bottom-right":case"bottom-left":case"bottom":u=7-i}switch(o){case"top-right":case"bottom-right":case"right":c=-e;break;case"top-left":case"bottom-left":case"left":c=e}}return[c,u]}function p1(o,e,i,c,u,p,m,v,S){if(!e||!e.usvg)return;const T=dR(c),I=dR(u),P=p!=="both"&&p!=="width"||!cR(c)?1:I.width/T.width,M=p!=="both"&&p!=="height"||!uR(c)?1:I.height/T.height;i.scaleSelf(P,M);const L=i.toString();m.set(L,i),v.set(L,e);const{imagePosition:O}=KS(L,e,Af);S.set(L,O)}function CR(o,e,i,c,u,p,m,v,S){if(!o)return;const T=function(I,P,M,L,O,G){if(I.kind==="camera")return I.maxSize;if(I.kind==="composite"){const Z=P.possiblyEvaluate(new Fr(I.maxZoom,{worldview:G}),M).evaluate(O,{},M),Q=P.possiblyEvaluate(new Fr(I.minZoom,{worldview:G}),M).evaluate(O,{},M);return Math.max(Z,Q)}return P.possiblyEvaluate(new Fr(L,{worldview:G})).evaluate(O,{},M)}(e,i,c,u,p,S);return o.scaleSelf(T*v*m)}function AR(o,e,i,c,u,p,m,v,S){return{iconPrimary:CR(o.getPrimary(),e,i,c,u,p,m,v,S),iconSecondary:CR(o.getSecondary(),e,i,c,u,p,m,v,S)}}function eU(o,e,i){if(!e)return;const c=i.get(o.toString()),u=i.get(e.toString());u&&(c.paddedRect.w===u.paddedRect.w&&c.paddedRect.h===u.paddedRect.h||On(`Mismatch in icon variant sizes: ${o.toString()} and ${e.toString()}`),c.usvg!==u.usvg&&On(`Mismatch in icon variant image types: ${o.id} and ${e.id}`))}function IR(o,e,i,c){if(!o)return;const u=e.get(i.toString());if(o.imagePrimary=u,c){const p=e.get(c.toString());o.imageSecondary=p}}function tU(o,e){for(const i in o.horizontal)PR(o.horizontal[i],e);PR(o.vertical,e)}function PR(o,e){if(o){for(const i of o.positionedLines)for(const c of i.positionedGlyphs)if(c.image!==null){const u=c.image.toString();c.rect=e.get(u).paddedRect}}}function eT(o){switch(o){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function nU(o,e,i,c,u,p,m,v,S){const T=tT(p.horizontal)||p.vertical,I=i.get("icon-text-fit-padding").evaluate(c,{},u);let P,M=e;return e&&S!=="none"&&(o.allowVerticalPlacement&&p.vertical&&(P=lR(e,p.vertical,S,I,v,m)),T&&(M=lR(e,T,S,I,v,m))),{defaultShapedIcon:M,verticallyShapedIcon:P}}function rU(o,e,i,c,u,p,m,v,S,T,I,P,M,L,O,G,Z,Q,le,ce){let q=m.textMaxSize.evaluate(e,{},M);q===void 0?q=v*m.textScaleFactor:q*=m.textScaleFactor;const re=o.layers[0].layout,ue=tT(i.horizontal)||i.vertical,pe=L.name==="globe",Ae=ms,Te=o.tilePixelRatio*q/Ae,Ie=(xt=o.overscaling,o.zoom>18&&xt>2&&(xt>>=1),Math.max(Lt/(512*xt),1)*re.get("symbol-spacing")),Ne=re.get("text-padding")*o.tilePixelRatio,Ke=re.get("icon-padding")*o.tilePixelRatio,yt=mr(re.get("text-max-angle")),at=re.get("icon-rotation-alignment")==="map"&&ce!=="point",_t=Ie/2;var xt;o.hasAnyIconTextFit===!1&&Z!=="none"&&(o.hasAnyIconTextFit=!0);const et=e.properties?+e.properties[Jn]:null,pt=et&&o.elevationFeatureIdToIndex?o.elevationFeatureIdToIndex.get(et):65535,Ze=(Qe,St,Et)=>{if(St.x<0||St.x>=Lt||St.y<0||St.y>=Lt)return;let ln=null;if(pe){const{x:Kt,y:Ot,z:wt}=L.projectTilePoint(St.x,St.y,Et);ln={anchor:new cu(Kt,Ot,wt,0,void 0),up:L.upVector(Et,St.x,St.y)}}(function(Kt,Ot,wt,Pn,Yt,Jt,xn,zn,Nn,Xn,Vn,Yn,Ir,Yr,he,me,nt,Rt,Ft,zt,Xt,yn,er,tr,Un,Dr,Hr,nr,vi){const Kr=Kt.addToLineVertexArray(Ot,Pn);let Pr,Li,oi,qr,Qr,Or,qn,jr=0,xi=0,gn=0,cr=0,ai=-1,Pi=-1;const hi={};let Wi=zh("");const Br=wt?wt.anchor:Ot,Hi=nr!=="none";let So=0,Ps=0;if(Nn._unevaluatedLayout.getValue("text-radial-offset")===void 0){const Zi=Nn.layout.get("text-offset").evaluate(Xt,{},Un);So=Zi[0]*ms,Ps=Zi[1]*ms}else So=Nn.layout.get("text-radial-offset").evaluate(Xt,{},Un)*ms,Ps=JS;if(Kt.allowVerticalPlacement&&Yt.vertical){const Zi=Yt.vertical;if(he)Or=nT(Zi),zn&&(qn=nT(zn));else{const is=Nn.layout.get("text-rotate").evaluate(Xt,{},Un)+90;oi=m1(Xn,Br,Ot,Vn,Yn,Ir,Zi,Yr,is,me),zn&&(qr=m1(Xn,Br,Ot,Vn,Yn,Ir,zn,Rt,is))}}if(Jt){const Zi=Kt.iconSizeData,is=Nn.layout.get("icon-rotate").evaluate(Xt,{},Un),Ms=SR(Jt,is,er,Hi,yn.iconScaleFactor),eo=zn?SR(zn,is,er,Hi,yn.iconScaleFactor):void 0;Li=m1(Xn,Br,Ot,Vn,Yn,Ir,Jt,Rt,is,null),jr=4*Ms.length;let Vs=null;Zi.kind==="source"?(Vs=[gc*Nn.layout.get("icon-size").evaluate(Xt,{},Un)*yn.iconScaleFactor],Vs[0]>_d&&On(`${Kt.layerIds[0]}: Value for "icon-size" is >= ${Fy}. Reduce your "icon-size".`)):Zi.kind==="composite"&&(Vs=[gc*yn.compositeIconSizes[0].evaluate(Xt,{},Un)*yn.iconScaleFactor,gc*yn.compositeIconSizes[1].evaluate(Xt,{},Un)*yn.iconScaleFactor],(Vs[0]>_d||Vs[1]>_d)&&On(`${Kt.layerIds[0]}: Value for "icon-size" is >= ${Fy}. Reduce your "icon-size".`)),Kt.addSymbols(Kt.icon,Ms,Vs,zt,Ft,Xt,void 0,wt,Ot,Kr.lineStartIndex,Kr.lineLength,-1,tr,Un,Dr,Hr),ai=Kt.icon.placedSymbolArray.length-1,eo&&(xi=4*eo.length,Kt.addSymbols(Kt.icon,eo,Vs,zt,Ft,Xt,jo.vertical,wt,Ot,Kr.lineStartIndex,Kr.lineLength,-1,tr,Un,Dr,Hr),Pi=Kt.icon.placedSymbolArray.length-1)}for(const Zi in Yt.horizontal){const is=Zi,Ms=Yt.horizontal[is];Pr||(Wi=zh(Ms.text),he?Qr=nT(Ms):Pr=m1(Xn,Br,Ot,Vn,Yn,Ir,Ms,Yr,Nn.layout.get("text-rotate").evaluate(Xt,{},Un),me));const eo=Ms.positionedLines.length===1;if(gn+=MR(Kt,wt,Ot,Ms,xn,Nn,he,Xt,me,Kr,Yt.vertical?jo.horizontal:jo.horizontalOnly,eo?Q6(Yt.horizontal):[is],hi,ai,yn,tr,Un,Dr),eo)break}Yt.vertical&&(cr+=MR(Kt,wt,Ot,Yt.vertical,xn,Nn,he,Xt,me,Kr,jo.vertical,["vertical"],hi,Pi,yn,tr,Un,Dr));let Ss=-1;const To=(Zi,is)=>Zi?Math.max(Zi,is):is;Ss=To(Qr,Ss),Ss=To(Or,Ss),Ss=To(qn,Ss);const _c=Ss>-1?1:0;Kt.glyphOffsetArray.length>=65535&&On("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),Xt.sortKey!==void 0&&Kt.addToSortKeyRanges(Kt.symbolInstances.length,Xt.sortKey),Kt.symbolInstances.emplaceBack(Ot.x,Ot.y,Br.x,Br.y,Br.z,hi.right>=0?hi.right:-1,hi.center>=0?hi.center:-1,hi.left>=0?hi.left:-1,hi.vertical>=0?hi.vertical:-1,ai,Pi,Wi,Pr!==void 0?Pr:Kt.collisionBoxArray.length,Pr!==void 0?Pr+1:Kt.collisionBoxArray.length,oi!==void 0?oi:Kt.collisionBoxArray.length,oi!==void 0?oi+1:Kt.collisionBoxArray.length,Li!==void 0?Li:Kt.collisionBoxArray.length,Li!==void 0?Li+1:Kt.collisionBoxArray.length,qr||Kt.collisionBoxArray.length,qr?qr+1:Kt.collisionBoxArray.length,Vn,gn,cr,jr,xi,_c,0,So,Ps,Ss,0,Hi?1:0,vi)})(o,St,ln,Qe,i,c,p,u,o.layers[0],o.collisionBoxArray,e.index,e.sourceLayerIndex,o.index,Ne,le,T,0,Ke,at,Q,e,m,I,P,M,O,G,Z,pt)};if(ce==="line")for(const Qe of i1(e.geometry,0,0,Lt,Lt)){const St=Z6(Qe,Ie,yt,i.vertical||ue,c,Ae,Te,o.overscaling,Lt);for(const Et of St)ue&&iU(o,ue.text,_t,Et)||Ze(Qe,Et,M)}else if(ce==="line-center"){for(const Qe of e.geometry)if(Qe.length>1){const St=W6(Qe,yt,i.vertical||ue,c,Ae,Te);St&&Ze(Qe,St,M)}}else if(e.type==="Polygon")for(const Qe of Q0(e.geometry,0)){const St=Y6(Qe,16);Ze(Qe[0],new cu(St.x,St.y,0,0,void 0),M)}else if(e.type==="LineString")for(const Qe of e.geometry)Ze(Qe,new cu(Qe[0].x,Qe[0].y,0,0,void 0),M);else if(e.type==="Point")for(const Qe of e.geometry)for(const St of Qe)Ze([St],new cu(St.x,St.y,0,0,void 0),M)}const Fy=255,_d=Fy*gc;function MR(o,e,i,c,u,p,m,v,S,T,I,P,M,L,O,G,Z,Q){const le=function(re,ue,pe,Ae,Te,Ie,Ne,Ke){const yt=[];if(ue.positionedLines.length===0)return yt;const at=Ae.layout.get("text-rotate").evaluate(Ie,{})*Math.PI/180,_t=function(Qe){const St=Qe[0],Et=Qe[1],ln=St*Et;return ln>0?[St,-Et]:ln<0?[-St,Et]:St===0?[Et,St]:[Et,-St]}(pe);let xt=Math.abs(ue.top-ue.bottom);for(const Qe of ue.positionedLines)xt-=Qe.lineOffset;const et=ue.positionedLines.length,pt=xt/et;let Ze=ue.top-pe[1];for(let Qe=0;Qe<et;++Qe){const St=ue.positionedLines[Qe];Ze=X6(ue,pt,Ze,Qe);for(const Et of St.positionedGlyphs){if(!Et.rect)continue;const ln=Et.rect||{};let Kt=$6+1,Ot=!0,wt=1,Pn=0;if(Et.image){const Xt=Ne.get(Et.image.toString());if(!Xt)continue;if(Xt.sdf){On("SDF images are not supported in formatted text and will be ignored.");continue}Ot=!1,wt=Xt.pixelRatio,Kt=Af/wt}const Yt=(Te||Ke)&&Et.vertical,Jt=Et.metrics.advance*Et.scale/2,xn=Et.metrics,zn=Et.rect;if(zn===null)continue;Ke&&ue.verticalizable&&(Pn=Et.image?Jt-Et.metrics.width*Et.scale/2:0);const Nn=Te?[Et.x+Jt,Et.y]:[0,0];let Xn=[0,0],Vn=[0,0],Yn=!1;Te||(Yt?(Vn=[Et.x+Jt+_t[0],Et.y+_t[1]-Pn],Yn=!0):Xn=[Et.x+Jt+pe[0],Et.y+pe[1]-Pn]);const Ir=zn.w*Et.scale/(wt*(Et.localGlyph?vl:1)),Yr=zn.h*Et.scale/(wt*(Et.localGlyph?vl:1));let he,me,nt,Rt;if(Yt){const Xt=Et.y-Ze,yn=new Dt(-Jt,Jt-Xt),er=-Math.PI/2,tr=new Dt(...Vn);he=new Dt(-Jt+Xn[0],Xn[1]),he._rotateAround(er,yn)._add(tr),he.x+=-Xt+Jt,he.y-=(xn.left-Kt)*Et.scale;const Un=Et.image?xn.advance*Et.scale:ms*Et.scale,Dr=String.fromCodePoint(Et.glyph);O6(Dr)?he.x+=(1-Kt)*Et.scale:F6(Dr)?he.x+=Un-xn.height*Et.scale+(-Kt-1)*Et.scale:he.x+=Et.image||xn.width+2*Kt===zn.w&&xn.height+2*Kt===zn.h?(Un-Yr)/2:(Un-(xn.height+2*Kt)*Et.scale)/2,me=new Dt(he.x,he.y-Ir),nt=new Dt(he.x+Yr,he.y),Rt=new Dt(he.x+Yr,he.y-Ir)}else{const Xt=(xn.left-Kt)*Et.scale-Jt+Xn[0],yn=(-xn.top-Kt)*Et.scale+Xn[1],er=Xt+Ir,tr=yn+Yr;he=new Dt(Xt,yn),me=new Dt(er,yn),nt=new Dt(Xt,tr),Rt=new Dt(er,tr)}if(at){let Xt;Xt=Te?new Dt(0,0):Yn?new Dt(_t[0],_t[1]):new Dt(pe[0],pe[1]),he._rotateAround(at,Xt),me._rotateAround(at,Xt),nt._rotateAround(at,Xt),Rt._rotateAround(at,Xt)}const Ft=new Dt(0,0),zt=new Dt(0,0);yt.push({tl:he,tr:me,bl:nt,br:Rt,texPrimary:ln,texSecondary:void 0,writingMode:ue.writingMode,glyphOffset:Nn,sectionIndex:Et.sectionIndex,isSDF:Ot,pixelOffsetTL:Ft,pixelOffsetBR:zt,minFontScaleX:0,minFontScaleY:0})}}return yt}(0,c,S,p,m,v,u,o.allowVerticalPlacement),ce=o.textSizeData;let q=null;ce.kind==="source"?(q=[gc*p.layout.get("text-size").evaluate(v,{},Z)*O.textScaleFactor],q[0]>_d&&On(`${o.layerIds[0]}: Value for "text-size" is >= ${Fy}. Reduce your "text-size".`)):ce.kind==="composite"&&(q=[gc*O.compositeTextSizes[0].evaluate(v,{},Z)*O.textScaleFactor,gc*O.compositeTextSizes[1].evaluate(v,{},Z)*O.textScaleFactor],(q[0]>_d||q[1]>_d)&&On(`${o.layerIds[0]}: Value for "text-size" is >= ${Fy}. Reduce your "text-size".`)),o.addSymbols(o.text,le,q,S,m,v,I,e,i,T.lineStartIndex,T.lineLength,L,G,Z,Q,!1);for(const re of P)M[re]=o.text.placedSymbolArray.length-1;return 4*le.length}function tT(o){for(const e in o)return o[e];return null}function m1(o,e,i,c,u,p,m,v,S,T){let I=m.top,P=m.bottom,M=m.left,L=m.right;if(aR(m)&&m.collisionPadding){const O=m.collisionPadding;M-=O[0],I-=O[1],L+=O[2],P+=O[3]}if(S){const O=new Dt(M,I),G=new Dt(L,I),Z=new Dt(M,P),Q=new Dt(L,P),le=mr(S);let ce=new Dt(0,0);T&&(ce=new Dt(T[0],T[1])),O._rotateAround(le,ce),G._rotateAround(le,ce),Z._rotateAround(le,ce),Q._rotateAround(le,ce),M=Math.min(O.x,G.x,Z.x,Q.x),L=Math.max(O.x,G.x,Z.x,Q.x),I=Math.min(O.y,G.y,Z.y,Q.y),P=Math.max(O.y,G.y,Z.y,Q.y)}return o.emplaceBack(e.x,e.y,e.z,i.x,i.y,M,I,L,P,v,c,u,p),o.length-1}function nT(o){aR(o)&&o.collisionPadding&&(o.top-=o.collisionPadding[1],o.bottom+=o.collisionPadding[3]);const e=o.bottom-o.top;return e>0?Math.max(10,e):null}function iU(o,e,i,c){const u=o.compareText;if(e in u){const p=u[e];for(let m=p.length-1;m>=0;m--)if(c.dist(p[m])<i)return!0}else u[e]=[];return u[e].push(c),!1}function RR(o,e){const i=o.fovAboveCenter,c=o.elevation?o.elevation.getMinElevationBelowMSL()*e:0,u=(o._camera.position[2]*o.worldSize-c)/Math.cos(o._pitch),p=Math.sin(i)*u/Math.sin(Math.max(Math.PI/2-o._pitch-i,.01));let m=Math.sin(o._pitch)*p+u;const v=u*(1/o._horizonShift);if(!o.elevation||o.elevation.exaggeration()===0){let S=Math.max(o.zoom-17,0);o.isOrthographic&&(S/=10),m*=1+S}return Math.min(1.01*m,v)}function jy(o,e){if(!e.isReprojectedInTileSpace)return{scale:1<<o.z,x:o.x,y:o.y,x2:o.x+1,y2:o.y+1,projection:e};const i=Math.pow(2,-o.z),c=o.x*i,u=(o.x+1)*i,p=o.y*i,m=(o.y+1)*i,v=Ee(c),S=Ee(u),T=Fe(p),I=Fe(m),P=e.project(v,T),M=e.project(S,T),L=e.project(S,I),O=e.project(v,I);let G=Math.min(P.x,M.x,L.x,O.x),Z=Math.min(P.y,M.y,L.y,O.y),Q=Math.max(P.x,M.x,L.x,O.x),le=Math.max(P.y,M.y,L.y,O.y);const ce=i/16;function q(ue,pe,Ae,Te,Ie,Ne){const Ke=(Ae+Ie)/2,yt=(Te+Ne)/2,at=e.project(Ee(Ke),Fe(yt)),_t=Math.max(0,G-at.x,Z-at.y,at.x-Q,at.y-le);G=Math.min(G,at.x),Q=Math.max(Q,at.x),Z=Math.min(Z,at.y),le=Math.max(le,at.y),_t>ce&&(q(ue,at,Ae,Te,Ke,yt),q(at,pe,Ke,yt,Ie,Ne))}q(P,M,c,p,u,p),q(M,L,u,p,u,m),q(L,O,u,m,c,m),q(O,P,c,m,c,p),G-=ce,Z-=ce,Q+=ce,le+=ce;const re=1/Math.max(Q-G,le-Z);return{scale:re,x:G*re,y:Z*re,x2:Q*re,y2:le*re,projection:e}}function kR(o,{x:e,y:i},c=0){return new Dt(((e-c)*o.scale-o.x)*Lt,(i*o.scale-o.y)*Lt)}const sU=H(new Float32Array(16));class yd{constructor(e){this.spec=e,this.name=e.name,this.wrap=!1,this.requiresDraping=!1,this.supportsWorldCopies=!1,this.supportsTerrain=!1,this.supportsFog=!1,this.supportsFreeCamera=!1,this.zAxisUnit="meters",this.isReprojectedInTileSpace=!0,this.unsupportedLayers=["custom"],this.center=[0,0],this.range=[3.5,7]}project(e,i){return{x:0,y:0,z:0}}unproject(e,i){return new ie(0,0)}projectTilePoint(e,i,c){return{x:e,y:i,z:0}}locationPoint(e,i,c,u=!0){return e._coordinatePoint(e.locationCoordinate(i,c),u)}pixelsPerMeter(e,i){return Se(1,e)*i}pixelSpaceConversion(e,i,c){return 1}farthestPixelDistance(e){return RR(e,e.pixelsPerMeter)}pointCoordinate(e,i,c,u){const p=e.horizonLineFromTop(!1),m=new Dt(i,Math.max(p,c));return e.rayIntersectionCoordinate(e.pointRayIntersection(m,u))}pointCoordinate3D(e,i,c){const u=new Dt(i,c);if(e.elevation)return e.elevation.pointCoordinate(u);{const p=this.pointCoordinate(e,u.x,u.y,0);return[p.x,p.y,p.z]}}isPointAboveHorizon(e,i){if(e.elevation&&e.elevation.visibleDemTiles.length)return!this.pointCoordinate3D(e,i.x,i.y);const c=e.horizonLineFromTop();return i.y<c}createInversionMatrix(e,i){return sU}createTileMatrix(e,i,c){let u,p,m;const v=c.canonical,S=H(new Float64Array(16));if(this.isReprojectedInTileSpace){const T=jy(v,this);u=1,p=T.x+c.wrap*T.scale,m=T.y,de(S,S,[u/T.scale,u/T.scale,e.pixelsPerMeter/i])}else u=i/e.zoomScale(v.z),p=(v.x+Math.pow(2,v.z)*c.wrap)*u,m=v.y*u;return te(S,S,[p,m,0]),de(S,S,[u/Lt,u/Lt,1]),S}upVector(e,i,c){return[0,0,1]}upVectorScale(e,i,c){return{metersToTile:1}}}class oU extends yd{constructor(e){super(e),this.range=[4,7],this.center=e.center||[-96,37.5];const[i,c]=this.parallels=e.parallels||[29.5,45.5],u=Math.sin(mr(i));this.n=(u+Math.sin(mr(c)))/2,this.c=1+u*(2*this.n-u),this.r0=Math.sqrt(this.c)/this.n}project(e,i){const{n:c,c:u,r0:p}=this,m=mr(e-this.center[0]),v=mr(i),S=Math.sqrt(u-2*c*Math.sin(v))/c;return{x:S*Math.sin(m*c),y:S*Math.cos(m*c)-p,z:0}}unproject(e,i){const{n:c,c:u,r0:p}=this,m=p+i;let v=Math.atan2(e,Math.abs(m))*Math.sign(m);m*c<0&&(v-=Math.PI*Math.sign(e)*Math.sign(m));const S=mr(this.center[0])*c;v=Ue(v,-Math.PI-S,Math.PI-S);const T=xe(He(v/c)+this.center[0],-180,180),I=Math.asin(xe((u-(e*e+m*m)*c*c)/(2*c),-1,1)),P=xe(He(I),-85.051129,rt);return new ie(T,P)}}const By=1.340264,Vy=-.081106,Uy=893e-6,$y=.003796,g1=Math.sqrt(3)/2;class aU extends yd{project(e,i){i=i/180*Math.PI,e=e/180*Math.PI;const c=Math.asin(g1*Math.sin(i)),u=c*c,p=u*u*u;return{x:.5*(e*Math.cos(c)/(g1*(By+3*Vy*u+p*(7*Uy+9*$y*u)))/Math.PI+.5),y:1-.5*(c*(By+Vy*u+p*(Uy+$y*u))/Math.PI+1),z:0}}unproject(e,i){e=(2*e-.5)*Math.PI;let c=i=(2*(1-i)-1)*Math.PI,u=c*c,p=u*u*u;for(let I,P,M,L=0;L<12&&(P=c*(By+Vy*u+p*(Uy+$y*u))-i,M=By+3*Vy*u+p*(7*Uy+9*$y*u),I=P/M,c=xe(c-I,-Math.PI/3,Math.PI/3),u=c*c,p=u*u*u,!(Math.abs(I)<1e-12));++L);const m=g1*e*(By+3*Vy*u+p*(7*Uy+9*$y*u))/Math.cos(c),v=Math.asin(Math.sin(c)/g1),S=xe(180*m/Math.PI,-180,180),T=xe(180*v/Math.PI,-85.051129,rt);return new ie(S,T)}}class lU extends yd{constructor(e){super(e),this.wrap=!0,this.supportsWorldCopies=!0}project(e,i){return{x:.5+e/360,y:.5-i/360,z:0}}unproject(e,i){const c=360*(e-.5),u=xe(360*(.5-i),-85.051129,rt);return new ie(c,u)}}const Lm=Math.PI/2;function _1(o){return Math.tan((Lm+o)/2)}class cU extends yd{constructor(e){super(e),this.center=e.center||[0,30];const[i,c]=this.parallels=e.parallels||[30,30];let u=mr(i),p=mr(c);this.southernCenter=u+p<0,this.southernCenter&&(u=-u,p=-p);const m=Math.cos(u),v=_1(u);this.n=u===p?Math.sin(u):Math.log(m/Math.cos(p))/Math.log(_1(p)/v),this.f=m*Math.pow(_1(u),this.n)/this.n}project(e,i){i=mr(i),this.southernCenter&&(i=-i),e=mr(e-this.center[0]);const c=1e-6,{n:u,f:p}=this;p>0?i<-Lm+c&&(i=-Lm+c):i>Lm-c&&(i=Lm-c);const m=p/Math.pow(_1(i),u);let v=m*Math.sin(u*e),S=p-m*Math.cos(u*e);return v=.5*(v/Math.PI+.5),S=.5*(S/Math.PI+.5),{x:v,y:this.southernCenter?S:1-S,z:0}}unproject(e,i){e=(2*e-.5)*Math.PI,this.southernCenter&&(i=1-i),i=(2*(1-i)-.5)*Math.PI;const{n:c,f:u}=this,p=u-i,m=Math.sign(p),v=Math.sign(c)*Math.sqrt(e*e+p*p);let S=Math.atan2(e,Math.abs(p))*m;p*c<0&&(S-=Math.PI*Math.sign(e)*m);const T=xe(He(S/c)+this.center[0],-180,180),I=xe(He(2*Math.atan(Math.pow(u/v,1/c))-Lm),-85.051129,rt);return new ie(T,this.southernCenter?-I:I)}}class DR extends yd{constructor(e){super(e),this.wrap=!0,this.supportsWorldCopies=!0,this.supportsTerrain=!0,this.supportsFog=!0,this.supportsFreeCamera=!0,this.isReprojectedInTileSpace=!1,this.unsupportedLayers=[],this.range=null}project(e,i){return{x:ve(e),y:ye(i),z:0}}unproject(e,i){const c=Ee(e),u=Fe(i);return new ie(c,u)}}const LR=mr(rt);class uU extends yd{project(e,i){const c=(i=mr(i))*i,u=c*c;return{x:.5*((e=mr(e))*(.8707-.131979*c+u*(u*(.003971*c-.001529*u)-.013791))/Math.PI+.5),y:1-.5*(i*(1.007226+c*(.015085+u*(.028874*c-.044475-.005916*u)))/Math.PI+1),z:0}}unproject(e,i){e=(2*e-.5)*Math.PI;let c=i=(2*(1-i)-1)*Math.PI,u=25,p=0,m=c*c;do{m=c*c;const T=m*m;p=(c*(1.007226+m*(.015085+T*(.028874*m-.044475-.005916*T)))-i)/(1.007226+m*(.045255+T*(.259866*m-.311325-.005916*11*T))),c=xe(c-p,-LR,LR)}while(Math.abs(p)>1e-6&&--u>0);m=c*c;const v=xe(He(e/(.8707+m*(m*(m*m*m*(.003971-.001529*m)-.013791)-.131979))),-180,180),S=He(c);return new ie(v,S)}}const NR=mr(rt);class dU extends yd{project(e,i){i=mr(i),e=mr(e);const c=Math.cos(i),u=2/Math.PI,p=Math.acos(c*Math.cos(e/2)),m=Math.sin(p)/p,v=.5*(e*u+2*c*Math.sin(e/2)/m)||0,S=.5*(i+Math.sin(i)/m)||0;return{x:.5*(v/Math.PI+.5),y:1-.5*(S/Math.PI+1),z:0}}unproject(e,i){let c=e=(2*e-.5)*Math.PI,u=i=(2*(1-i)-1)*Math.PI,p=25;const m=1e-6;let v=0,S=0;do{const T=Math.cos(u),I=Math.sin(u),P=2*I*T,M=I*I,L=T*T,O=Math.cos(c/2),G=Math.sin(c/2),Z=2*O*G,Q=G*G,le=1-L*O*O,ce=le?1/le:0,q=le?Math.acos(T*O)*Math.sqrt(1/le):0,re=.5*(2*q*T*G+2*c/Math.PI)-e,ue=.5*(q*I+u)-i,pe=.5*ce*(L*Q+q*T*O*M)+1/Math.PI,Ae=ce*(Z*P/4-q*I*G),Te=.125*ce*(P*G-q*I*L*Z),Ie=.5*ce*(M*O+q*Q*T)+.5,Ne=Ae*Te-Ie*pe;v=(ue*Ae-re*Ie)/Ne,S=(re*Te-ue*pe)/Ne,c=xe(c-v,-Math.PI,Math.PI),u=xe(u-S,-NR,NR)}while((Math.abs(v)>m||Math.abs(S)>m)&&--p>0);return new ie(He(c),He(u))}}class zR extends yd{constructor(e){super(e),this.center=e.center||[0,0],this.parallels=e.parallels||[0,0],this.cosPhi=Math.max(.01,Math.cos(mr(this.parallels[0]))),this.scale=1/(2*Math.max(Math.PI*this.cosPhi,1/this.cosPhi)),this.wrap=!0,this.supportsWorldCopies=!0}project(e,i){const{scale:c,cosPhi:u}=this;return{x:mr(e)*u*c+.5,y:-Math.sin(mr(i))/u*c+.5,z:0}}unproject(e,i){const{scale:c,cosPhi:u}=this,p=-(i-.5)/c,m=xe(He((e-.5)/c)/u,-180,180),v=Math.asin(xe(p*u,-1,1)),S=xe(He(v),-85.051129,rt);return new ie(m,S)}}class hU extends DR{constructor(e){super(e),this.requiresDraping=!0,this.supportsWorldCopies=!1,this.supportsFog=!0,this.zAxisUnit="pixels",this.unsupportedLayers=["debug"],this.range=[3,5]}projectTilePoint(e,i,c){const u=yy(e,i,c);return Mn(u,u,X0(pc(c))),{x:u[0],y:u[1],z:u[2]}}locationPoint(e,i,c){const u=W(i.lat,i.lng),p=Hn([],u),m=c?e._centerAltitude+c:e.elevation?e.elevation.getAtPointOrZero(e.locationCoordinate(i),e._centerAltitude):e._centerAltitude;Zt(u,u,p,Se(1,0)*Lt*m);const v=H(new Float64Array(16));return Y(v,e.pixelMatrix,e.globeMatrix),Mn(u,u,v),new Dt(u[0],u[1])}pixelsPerMeter(e,i){return Se(1,0)*i}pixelSpaceConversion(e,i,c){const u=Se(1,e)*i,p=vn(Se(1,45)*i,u,c);return this.pixelsPerMeter(e,i)/p}createTileMatrix(e,i,c){const u=vS(pc(c.canonical));return Y(new Float64Array(16),e.globeMatrix,u)}createInversionMatrix(e,i){const{center:c}=e,u=X0(pc(i));return Le(u,u,mr(c.lng)),Me(u,u,mr(c.lat)),de(u,u,[e._pixelsPerMercatorPixel,e._pixelsPerMercatorPixel,1]),Float32Array.from(u)}pointCoordinate(e,i,c,u){return yP(e,i,c,!0)||new Re(0,0)}pointCoordinate3D(e,i,c){const u=this.pointCoordinate(e,i,c,0);return[u.x,u.y,u.z]}isPointAboveHorizon(e,i){return!yP(e,i.x,i.y,!1)}farthestPixelDistance(e){const i=function(u,p){const m=u.cameraToCenterDistance,v=u._centerAltitude*p,S=u._camera,T=u._camera.forward(),I=jt([],Ct([],T,-m),[0,0,v]),P=u.worldSize/(2*Math.PI),M=[0,0,-P],L=u.width/u.height,O=Math.tan(u.fovAboveCenter),G=Ct([],S.up(),O),Z=Ct([],S.right(),O*L),Q=Hn([],jt([],jt([],T,G),Z)),le=[];let ce;if(new ii(I,Q).closestPointOnSphere(M,P,le)){const q=jt([],le,M),re=Tr([],q,I);ce=Math.cos(u.fovAboveCenter)*$t(re)}else{const q=Tr([],I,M),re=Tr([],M,I);Hn(re,re);const ue=$t(q)-P;ce=Math.sqrt(ue*(ue+2*P));const pe=Math.acos(ce/(P+ue))-Math.acos(rn(T,re));ce*=Math.cos(pe)}return 1.01*ce}(e,this.pixelsPerMeter(e.center.lat,e.worldSize)),c=pd(e.zoom);if(c>0){const u=RR(e,Se(1,e.center.lat)*e.worldSize),p=e.worldSize/(2*Math.PI),m=Math.max(e.width,e.height)/e.worldSize*Math.PI;return vn(i,u+p*(1-Math.cos(m)),Math.pow(c,10))}return i}upVector(e,i,c){return yy(i,c,e,1)}upVectorScale(e){return{metersToTile:q0(Z0(pc(e)))}}}function OR(o){const e=o.parallels,i=!!e&&Math.abs(e[0]+e[1])<.01;switch(o.name){case"mercator":return new DR(o);case"equirectangular":return new lU(o);case"naturalEarth":return new uU(o);case"equalEarth":return new aU(o);case"winkelTripel":return new dU(o);case"albers":return i?new zR(o):new oU(o);case"lambertConformalConic":return i?new zR(o):new cU(o);case"globe":return new hU(o)}throw new Error(`Invalid projection name: ${o.name}`)}const fU=Gn.VectorTileFeature.types,pU=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function y1(o,e,i,c,u,p,m,v,S,T,I,P,M){const L=v?Math.min(_d,Math.round(v[0])):0,O=v?Math.min(_d,Math.round(v[1])):0;o.emplaceBack(e,i,Math.round(32*c),Math.round(32*u),p,m,(L<<1)+(S?1:0),O,16*T,16*I,256*P,256*M)}function v1(o,e,i){o.emplaceBack(e,i)}function x1(o,e,i,c,u,p,m){o.emplaceBack(e,i,c,u,p,m)}const b1=(o,e,i,c)=>{for(let u=0;u<e;u++)o.emplaceBack(i[0],i[1],i[2],c[0],c[1],c[2])};function w1(o,e,i,c,u){o.emplaceBack(e,i,c,u),o.emplaceBack(e,i,c,u),o.emplaceBack(e,i,c,u),o.emplaceBack(e,i,c,u)}function mU(o){for(const e of o.sections)if(lS(e.text))return!0;return!1}class rT{constructor(e){this.layoutVertexArray=new sd,this.indexArray=new bs,this.programConfigurations=e,this.segments=new Ai,this.dynamicLayoutVertexArray=new xs,this.opacityVertexArray=new ad,this.placedSymbolArray=new k0,this.iconTransitioningVertexArray=new cc,this.globeExtVertexArray=new od,this.zOffsetVertexArray=new ac,this.orientationVertexArray=new ay}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0&&this.iconTransitioningVertexArray.length===0}upload(e,i,c,u,p){this.isEmpty()||(c&&(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,A6.members),this.indexBuffer=e.createIndexBuffer(this.indexArray,i),this.dynamicLayoutVertexBuffer=e.createVertexBuffer(this.dynamicLayoutVertexArray,P6.members,!0),this.opacityVertexBuffer=e.createVertexBuffer(this.opacityVertexArray,pU,!0),this.iconTransitioningVertexArray.length>0&&(this.iconTransitioningVertexBuffer=e.createVertexBuffer(this.iconTransitioningVertexArray,k6.members,!0)),this.globeExtVertexArray.length>0&&(this.globeExtVertexBuffer=e.createVertexBuffer(this.globeExtVertexArray,I6.members,!0)),!this.zOffsetVertexBuffer&&(this.zOffsetVertexArray.length>0||p)&&(this.zOffsetVertexBuffer=e.createVertexBuffer(this.zOffsetVertexArray,M6.members,!0)),!this.orientationVertexBuffer&&this.orientationVertexArray&&this.orientationVertexArray.length>0&&(this.orientationVertexBuffer=e.createVertexBuffer(this.orientationVertexArray,R6.members,!0)),this.opacityVertexBuffer.itemSize=1),(c||u)&&this.programConfigurations.upload(e))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy(),this.iconTransitioningVertexBuffer&&this.iconTransitioningVertexBuffer.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy(),this.zOffsetVertexBuffer&&this.zOffsetVertexBuffer.destroy(),this.orientationVertexBuffer&&this.orientationVertexBuffer.destroy())}}Ht(rT,"SymbolBuffers");class iT{constructor(e,i,c){this.layoutVertexArray=new e,this.layoutAttributes=i,this.indexArray=new c,this.segments=new Ai,this.collisionVertexArray=new uf,this.collisionVertexArrayExt=new xs}upload(e){this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=e.createVertexBuffer(this.collisionVertexArray,D6.members,!0),this.collisionVertexBufferExt=e.createVertexBuffer(this.collisionVertexArrayExt,L6.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy(),this.collisionVertexBufferExt.destroy())}}Ht(iT,"CollisionBuffers");class S1{constructor(e){this.collisionBoxArray=e.collisionBoxArray,this.zoom=e.zoom,this.lut=e.lut,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(m=>m.fqid),this.index=e.index,this.pixelRatio=e.pixelRatio,this.sourceLayerIndex=e.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.fullyClipped=!1,this.hasAnyIconTextFit=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=H([]),this.placementViewportMatrix=H([]);const i=this.layers[0]._unevaluatedLayout._values;this.worldview=e.worldview,this.textSizeData=hR(this.zoom,i["text-size"],this.worldview),this.iconSizeData=hR(this.zoom,i["icon-size"],this.worldview);const c=this.layers[0].layout,u=c.get("symbol-sort-key"),p=c.get("symbol-z-order");this.canOverlap=c.get("text-allow-overlap")||c.get("icon-allow-overlap")||c.get("text-ignore-placement")||c.get("icon-ignore-placement"),this.sortFeaturesByKey=p!=="viewport-y"&&u.constantOr(1)!==void 0,this.sortFeaturesByY=(p==="viewport-y"||p==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,this.writingModes=c.get("text-writing-mode").map(m=>jo[m]),this.stateDependentLayerIds=this.layers.filter(m=>m.isStateDependent()).map(m=>m.id),this.sourceID=e.sourceID,this.projection=e.projection,this.hasAnyZOffset=!1,this.zOffsetSortDirty=!1,this.zOffsetBuffersNeedUpload=!1,this.elevationType="none",this.elevationStateComplete=!1,this.activeReplacements=[],this.replacementUpdateTime=0}createArrays(){this.text=new rT(new h(this.layers,{zoom:this.zoom,lut:this.lut},e=>e.startsWith("text")||e.startsWith("symbol"))),this.icon=new rT(new h(this.layers,{zoom:this.zoom,lut:this.lut},e=>e.startsWith("icon")||e.startsWith("symbol"))),this.glyphOffsetArray=new dy,this.lineVertexArray=new N0,this.symbolInstances=new L0}calculateGlyphDependencies(e,i,c,u,p){for(const m of e){const v=m.codePointAt(0);if(v===void 0)break;if(i[v]=!0,u&&p&&v<=65535){const S=Ly[m];S&&(i[S.charCodeAt(0)]=!0)}}}updateFootprints(e,i){}updateReplacement(e,i){if(i.updateTime===this.replacementUpdateTime)return!1;this.replacementUpdateTime=i.updateTime;const c=i.getReplacementRegionsForTile(e.toUnwrapped(),!0);return!kS(this.activeReplacements,c)&&(this.activeReplacements=c,!0)}populate(e,i,c,u){const p=this.layers[0],m=p.layout,v=this.projection.name==="globe",S=m.get("text-font"),T=m.get("text-field"),I=m.get("icon-image"),[P,M]=m.get("icon-size-scale-range"),L=xe(i.scaleFactor||1,P,M),O=(T.value.kind!=="constant"||T.value.value instanceof Ys&&!T.value.value.isEmpty()||T.value.value.toString().length>0)&&(S.value.kind!=="constant"||S.value.value.length>0),G=I.value.kind!=="constant"||!!I.value.value||Object.keys(I.parameters).length>0,Z=m.get("symbol-sort-key");if(this.features=[],!O&&!G)return;const Q=i.iconDependencies,le=i.glyphDependencies,ce=i.availableImages,q=new Fr(this.zoom,{worldview:this.worldview});for(const{feature:re,id:ue,index:pe,sourceLayerIndex:Ae}of e){const Te=p._featureFilter.needGeometry,Ie=Vt(re,Te);if(!p._featureFilter.filter(q,Ie,c))continue;if(Te||(Ie.geometry=Wt(re,c,u)),v&&re.type!==1&&c.z<=5){const _t=Ie.geometry,xt=.98078528056,et=(pt,Ze)=>rn(yy(pt.x,pt.y,c,1),yy(Ze.x,Ze.y,c,1))<xt;for(let pt=0;pt<_t.length;pt++)_t[pt]=At(_t[pt],et)}let Ne,Ke;if(O){const _t=p.getValueAndResolveTokens("text-field",Ie,c,ce),xt=Ys.factory(_t);mU(xt)&&(this.hasRTLText=!0),(!this.hasRTLText||ed()==="unavailable"||this.hasRTLText&&pl.isParsed())&&(Ne=z6(xt,p,Ie))}if(G){const _t=p.getValueAndResolveTokens("icon-image",Ie,c,ce);Ke=typeof _t=="string"?ao.build(_t):_t}if(!Ne&&!Ke)continue;const yt=this.sortFeaturesByKey?Z.evaluate(Ie,{},c):void 0,at={id:ue,text:Ne,icon:Ke,index:pe,sourceLayerIndex:Ae,geometry:Ie.geometry,properties:re.properties,type:fU[re.type],sortKey:yt};if(this.features.push(at),Ke){const _t=this.layers[0]._unevaluatedLayout._values,{iconPrimary:xt,iconSecondary:et}=AR(Ke,this.iconSizeData,_t["icon-size"],c,this.zoom,at,this.pixelRatio,L,this.worldview),pt=xt.id.toString();if(Q.has(pt)?Q.get(pt).push(xt):Q.set(pt,[xt]),et){const Ze=et.id.toString();Q.has(Ze)?Q.get(Ze).push(et):Q.set(Ze,[et])}}if(Ne){const _t=S.evaluate(Ie,{},c).join(","),xt=m.get("text-rotation-alignment")==="map"&&m.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(jo.vertical)>=0;for(const et of Ne.sections)if(et.image){const pt=et.image.getPrimary().scaleSelf(this.pixelRatio),Ze=pt.id.toString(),Qe=Q.get(Ze)||[];Qe.push(pt),Q.set(Ze,Qe)}else{const pt=rf(Ne.toString()),Ze=et.fontStack||_t,Qe=le[Ze]=le[Ze]||{};this.calculateGlyphDependencies(et.text,Qe,xt,this.allowVerticalPlacement,pt)}}}if(m.get("symbol-placement")==="line"&&(this.features=function(re){const ue={},pe={},Ae=[];let Te=0;function Ie(at){Ae.push(re[at]),Te++}function Ne(at,_t,xt){const et=pe[at];return delete pe[at],pe[_t]=et,Ae[et].geometry[0].pop(),Ae[et].geometry[0]=Ae[et].geometry[0].concat(xt[0]),et}function Ke(at,_t,xt){const et=ue[_t];return delete ue[_t],ue[at]=et,Ae[et].geometry[0].shift(),Ae[et].geometry[0]=xt[0].concat(Ae[et].geometry[0]),et}function yt(at,_t,xt){const et=xt?_t[0][_t[0].length-1]:_t[0][0];return`${at}:${et.x}:${et.y}`}for(let at=0;at<re.length;at++){const _t=re[at],xt=_t.geometry,et=_t.text?_t.text.toString():null;if(!et){Ie(at);continue}const pt=yt(et,xt),Ze=yt(et,xt,!0);if(pt in pe&&Ze in ue&&pe[pt]!==ue[Ze]){const Qe=Ke(pt,Ze,xt),St=Ne(pt,Ze,Ae[Qe].geometry);delete ue[pt],delete pe[Ze],pe[yt(et,Ae[St].geometry,!0)]=St,Ae[Qe].geometry=null}else pt in pe?Ne(pt,Ze,xt):Ze in ue?Ke(pt,Ze,xt):(Ie(at),ue[pt]=Te-1,pe[Ze]=Te-1)}return Ae.filter(at=>at.geometry)}(this.features)),m.get("symbol-elevation-reference")==="hd-road-markup"){if(this.elevationType="road",i.elevationFeatures){!this.elevationFeatures&&i.elevationFeatures.length>0&&(this.elevationFeatures=[],this.elevationFeatureIdToIndex=new Map);for(const re of i.elevationFeatures)this.elevationFeatureIdToIndex.set(re.id,this.elevationFeatures.length),this.elevationFeatures.push(re)}}else m.get("symbol-z-elevate")&&(this.elevationType="offset");this.elevationType!=="none"&&(this.zOffsetBuffersNeedUpload=!0),this.sortFeaturesByKey&&this.features.sort((re,ue)=>re.sortKey-ue.sortKey)}update(e,i,c,u,p,m,v){this.text.programConfigurations.updatePaintArrays(e,i,p,c,u,m,v,this.worldview),this.icon.programConfigurations.updatePaintArrays(e,i,p,c,u,m,v,this.worldview)}updateRoadElevation(e){if(this.elevationType!=="road"||!this.elevationFeatures||this.elevationStateComplete)return;this.elevationStateComplete=!0,this.hasAnyZOffset=!1;let i=!1;const c=Xe(e),u=1/c;let p=!1,m=!1;for(let v=0;v<this.symbolInstances.length;v++){const S=this.symbolInstances.get(v),T=Ve(1,0,0),I=Ve(0,1,0),{numHorizontalGlyphVertices:P,numVerticalGlyphVertices:M,numIconVertices:L,numVerticalIconVertices:O}=S,G=P>0||M>0,Z=L>0,Q=this.elevationFeatures[S.elevationFeatureIndex];if(Q){const le=new Dt(S.tileAnchorX,S.tileAnchorY),ce=.075+Q.pointElevation(le);S.zOffset!==ce&&(i=!0,S.zOffset=ce);const q=Q.computeSlopeNormal(le,u),re=ko(Mt(),Ve(0,0,1),q);Lr(T,T,re),Lr(I,I,re),T[2]*=c,I[2]*=c,T[0]===1&&T[1]===0&&T[2]===0&&I[0]===0&&I[1]===1&&I[2]===0||(p=p||G,m=m||Z)}if(G&&(b1(this.text.orientationVertexArray,P,T,I),b1(this.text.orientationVertexArray,M,T,I)),Z){const{placedIconSymbolIndex:le,verticalPlacedIconSymbolIndex:ce}=S;le>=0&&b1(this.icon.orientationVertexArray,L,T,I),ce>=0&&b1(this.icon.orientationVertexArray,O,T,I)}}p||(this.text.orientationVertexArray=void 0),m||(this.icon.orientationVertexArray=void 0),i&&(this.zOffsetBuffersNeedUpload=!0,this.zOffsetSortDirty=!0)}updateZOffset(){const e=(p,m,v)=>{c+=m,c>p.length&&p.resize(c);for(let S=-m;S<0;S++)p.emplace(S+c,v)},i=(p,m,v)=>{u+=m,u>p.length&&p.resize(u);for(let S=-m;S<0;S++)p.emplace(S+u,v)};if(!this.zOffsetBuffersNeedUpload)return;this.zOffsetBuffersNeedUpload=!1;let c=0,u=0;for(let p=0;p<this.symbolInstances.length;p++){const m=this.symbolInstances.get(p),{numHorizontalGlyphVertices:v,numVerticalGlyphVertices:S,numIconVertices:T}=m,I=m.zOffset,P=T>0;if((v>0||S>0)&&(e(this.text.zOffsetVertexArray,v,I),e(this.text.zOffsetVertexArray,S,I)),P){const{placedIconSymbolIndex:M,verticalPlacedIconSymbolIndex:L}=m;M>=0&&i(this.icon.zOffsetVertexArray,T,I),L>=0&&i(this.icon.zOffsetVertexArray,m.numVerticalIconVertices,I)}}this.text.zOffsetVertexBuffer&&this.text.zOffsetVertexBuffer.updateData(this.text.zOffsetVertexArray),this.icon.zOffsetVertexBuffer&&this.icon.zOffsetVertexBuffer.updateData(this.icon.zOffsetVertexArray)}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(e){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(e),this.iconCollisionBox.upload(e)),this.text.upload(e,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload,this.zOffsetBuffersNeedUpload),this.icon.upload(e,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload,this.zOffsetBuffersNeedUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}getProjection(){return this.projectionInstance||(this.projectionInstance=OR(this.projection)),this.projectionInstance}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(e,i){const c=this.lineVertexArray.length;if(e.segment!==void 0)for(const{x:u,y:p}of i)this.lineVertexArray.emplaceBack(u,p);return{lineStartIndex:c,lineLength:this.lineVertexArray.length-c}}addSymbols(e,i,c,u,p,m,v,S,T,I,P,M,L,O,G,Z){const Q=e.indexArray,le=e.layoutVertexArray,ce=e.globeExtVertexArray,q=e.segments.prepareSegment(4*i.length,le,Q,this.canOverlap?m.sortKey:void 0),re=this.glyphOffsetArray.length,ue=q.vertexLength,pe=this.allowVerticalPlacement&&v===jo.vertical?Math.PI/2:0,Ae=m.text&&m.text.sections;for(let Ie=0;Ie<i.length;Ie++){const{tl:Ne,tr:Ke,bl:yt,br:at,texPrimary:_t,texSecondary:xt,pixelOffsetTL:et,pixelOffsetBR:pt,minFontScaleX:Ze,minFontScaleY:Qe,glyphOffset:St,isSDF:Et,sectionIndex:ln}=i[Ie],Kt=q.vertexLength,Ot=St[1];if(y1(le,T.x,T.y,Ne.x,Ot+Ne.y,_t.x,_t.y,c,Et,et.x,et.y,Ze,Qe),y1(le,T.x,T.y,Ke.x,Ot+Ke.y,_t.x+_t.w,_t.y,c,Et,pt.x,et.y,Ze,Qe),y1(le,T.x,T.y,yt.x,Ot+yt.y,_t.x,_t.y+_t.h,c,Et,et.x,pt.y,Ze,Qe),y1(le,T.x,T.y,at.x,Ot+at.y,_t.x+_t.w,_t.y+_t.h,c,Et,pt.x,pt.y,Ze,Qe),S){const{x:wt,y:Pn,z:Yt}=S.anchor,[Jt,xn,zn]=S.up;x1(ce,wt,Pn,Yt,Jt,xn,zn),x1(ce,wt,Pn,Yt,Jt,xn,zn),x1(ce,wt,Pn,Yt,Jt,xn,zn),x1(ce,wt,Pn,Yt,Jt,xn,zn),w1(e.dynamicLayoutVertexArray,wt,Pn,Yt,pe)}else w1(e.dynamicLayoutVertexArray,T.x,T.y,T.z,pe);if(Z){const wt=xt||_t;v1(e.iconTransitioningVertexArray,wt.x,wt.y),v1(e.iconTransitioningVertexArray,wt.x+wt.w,wt.y),v1(e.iconTransitioningVertexArray,wt.x,wt.y+wt.h),v1(e.iconTransitioningVertexArray,wt.x+wt.w,wt.y+wt.h)}Q.emplaceBack(Kt,Kt+1,Kt+2),Q.emplaceBack(Kt+1,Kt+2,Kt+3),q.vertexLength+=4,q.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(St[0]),Ie!==i.length-1&&ln===i[Ie+1].sectionIndex||e.programConfigurations.populatePaintArrays(le.length,m,m.index,{},L,O,G,Ae&&Ae[ln],this.worldview)}const Te=S?S.anchor:T;e.placedSymbolArray.emplaceBack(Te.x,Te.y,Te.z,T.x,T.y,re,this.glyphOffsetArray.length-re,ue,I,P,T.segment,c?c[0]:0,c?c[1]:0,u[0],u[1],v,0,0,0,M,0)}_commitLayoutVertex(e,i,c,u,p,m,v){e.emplaceBack(i,c,u,p,m,Math.round(v.x),Math.round(v.y))}_addCollisionDebugVertices(e,i,c,u,p,m,v){const S=c.segments.prepareSegment(4,c.layoutVertexArray,c.indexArray),T=S.vertexLength,I=v.tileAnchorX,P=v.tileAnchorY;for(let L=0;L<4;L++)c.collisionVertexArray.emplaceBack(0,0,0,0,0,0);this._commitDebugCollisionVertexUpdate(c.collisionVertexArrayExt,i,e.padding,v.zOffset),this._commitLayoutVertex(c.layoutVertexArray,u,p,m,I,P,new Dt(e.x1,e.y1)),this._commitLayoutVertex(c.layoutVertexArray,u,p,m,I,P,new Dt(e.x2,e.y1)),this._commitLayoutVertex(c.layoutVertexArray,u,p,m,I,P,new Dt(e.x2,e.y2)),this._commitLayoutVertex(c.layoutVertexArray,u,p,m,I,P,new Dt(e.x1,e.y2)),S.vertexLength+=4;const M=c.indexArray;M.emplaceBack(T,T+1),M.emplaceBack(T+1,T+2),M.emplaceBack(T+2,T+3),M.emplaceBack(T+3,T),S.primitiveLength+=4}_addTextDebugCollisionBoxes(e,i,c,u,p,m){for(let v=u;v<p;v++){const S=c.get(v),T=this.getSymbolInstanceTextSize(e,m,i,v);this._addCollisionDebugVertices(S,T,this.textCollisionBox,S.projectedAnchorX,S.projectedAnchorY,S.projectedAnchorZ,m)}}_addIconDebugCollisionBoxes(e,i,c,u,p,m){for(let v=u;v<p;v++){const S=c.get(v),T=this.getSymbolInstanceIconSize(e,i,m.placedIconSymbolIndex);this._addCollisionDebugVertices(S,T,this.iconCollisionBox,S.projectedAnchorX,S.projectedAnchorY,S.projectedAnchorZ,m)}}generateCollisionDebugBuffers(e,i,c){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new iT(fm,QM.members,cc),this.iconCollisionBox=new iT(fm,QM.members,cc);const u=zy(this.iconSizeData,e),p=zy(this.textSizeData,e,c);for(let m=0;m<this.symbolInstances.length;m++){const v=this.symbolInstances.get(m);this._addTextDebugCollisionBoxes(p,e,i,v.textBoxStartIndex,v.textBoxEndIndex,v),this._addTextDebugCollisionBoxes(p,e,i,v.verticalTextBoxStartIndex,v.verticalTextBoxEndIndex,v),this._addIconDebugCollisionBoxes(u,e,i,v.iconBoxStartIndex,v.iconBoxEndIndex,v),this._addIconDebugCollisionBoxes(u,e,i,v.verticalIconBoxStartIndex,v.verticalIconBoxEndIndex,v)}}getSymbolInstanceTextSize(e,i,c,u){const p=this.text.placedSymbolArray.get(i.rightJustifiedTextSymbolIndex>=0?i.rightJustifiedTextSymbolIndex:i.centerJustifiedTextSymbolIndex>=0?i.centerJustifiedTextSymbolIndex:i.leftJustifiedTextSymbolIndex>=0?i.leftJustifiedTextSymbolIndex:i.verticalPlacedTextSymbolIndex>=0?i.verticalPlacedTextSymbolIndex:u),m=YS(this.textSizeData,e,p)/ms;return this.tilePixelRatio*m}getSymbolInstanceIconSize(e,i,c){const u=this.icon.placedSymbolArray.get(c),p=YS(this.iconSizeData,e,u);return this.tilePixelRatio*p}_commitDebugCollisionVertexUpdate(e,i,c,u){e.emplaceBack(i,-c,-c,u),e.emplaceBack(i,c,-c,u),e.emplaceBack(i,c,c,u),e.emplaceBack(i,-c,c,u)}_updateTextDebugCollisionBoxes(e,i,c,u,p,m,v){for(let S=u;S<p;S++){const T=c.get(S),I=this.getSymbolInstanceTextSize(e,m,i,S);this._commitDebugCollisionVertexUpdate(this.textCollisionBox.collisionVertexArrayExt,I,T.padding,m.zOffset)}}_updateIconDebugCollisionBoxes(e,i,c,u,p,m,v){for(let S=u;S<p;S++){const T=c.get(S),I=this.getSymbolInstanceIconSize(e,i,m.placedIconSymbolIndex);this._commitDebugCollisionVertexUpdate(this.iconCollisionBox.collisionVertexArrayExt,I,T.padding,m.zOffset)}}updateCollisionDebugBuffers(e,i,c,u){if(!this.hasDebugData())return;this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexArrayExt.clear(),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexArrayExt.clear();const p=zy(this.iconSizeData,e,u),m=zy(this.textSizeData,e,c);for(let v=0;v<this.symbolInstances.length;v++){const S=this.symbolInstances.get(v);this._updateTextDebugCollisionBoxes(m,e,i,S.textBoxStartIndex,S.textBoxEndIndex,S,c),this._updateTextDebugCollisionBoxes(m,e,i,S.verticalTextBoxStartIndex,S.verticalTextBoxEndIndex,S,c),this._updateIconDebugCollisionBoxes(p,e,i,S.iconBoxStartIndex,S.iconBoxEndIndex,S,u),this._updateIconDebugCollisionBoxes(p,e,i,S.verticalIconBoxStartIndex,S.verticalIconBoxEndIndex,S,u)}this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexBufferExt&&this.textCollisionBox.collisionVertexBufferExt.updateData(this.textCollisionBox.collisionVertexArrayExt),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexBufferExt&&this.iconCollisionBox.collisionVertexBufferExt.updateData(this.iconCollisionBox.collisionVertexArrayExt)}_deserializeCollisionBoxesForSymbol(e,i,c,u,p,m,v,S,T){const I={};if(i<c){const{x1:P,y1:M,x2:L,y2:O,padding:G,projectedAnchorX:Z,projectedAnchorY:Q,projectedAnchorZ:le,tileAnchorX:ce,tileAnchorY:q,featureIndex:re}=e.get(i);I.textBox={x1:P,y1:M,x2:L,y2:O,padding:G,projectedAnchorX:Z,projectedAnchorY:Q,projectedAnchorZ:le,tileAnchorX:ce,tileAnchorY:q},I.textFeatureIndex=re}if(u<p){const{x1:P,y1:M,x2:L,y2:O,padding:G,projectedAnchorX:Z,projectedAnchorY:Q,projectedAnchorZ:le,tileAnchorX:ce,tileAnchorY:q,featureIndex:re}=e.get(u);I.verticalTextBox={x1:P,y1:M,x2:L,y2:O,padding:G,projectedAnchorX:Z,projectedAnchorY:Q,projectedAnchorZ:le,tileAnchorX:ce,tileAnchorY:q},I.verticalTextFeatureIndex=re}if(m<v){const{x1:P,y1:M,x2:L,y2:O,padding:G,projectedAnchorX:Z,projectedAnchorY:Q,projectedAnchorZ:le,tileAnchorX:ce,tileAnchorY:q,featureIndex:re}=e.get(m);I.iconBox={x1:P,y1:M,x2:L,y2:O,padding:G,projectedAnchorX:Z,projectedAnchorY:Q,projectedAnchorZ:le,tileAnchorX:ce,tileAnchorY:q},I.iconFeatureIndex=re}if(S<T){const{x1:P,y1:M,x2:L,y2:O,padding:G,projectedAnchorX:Z,projectedAnchorY:Q,projectedAnchorZ:le,tileAnchorX:ce,tileAnchorY:q,featureIndex:re}=e.get(S);I.verticalIconBox={x1:P,y1:M,x2:L,y2:O,padding:G,projectedAnchorX:Z,projectedAnchorY:Q,projectedAnchorZ:le,tileAnchorX:ce,tileAnchorY:q},I.verticalIconFeatureIndex=re}return I}deserializeCollisionBoxes(e){this.collisionArrays=[];for(let i=0;i<this.symbolInstances.length;i++){const c=this.symbolInstances.get(i);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(e,c.textBoxStartIndex,c.textBoxEndIndex,c.verticalTextBoxStartIndex,c.verticalTextBoxEndIndex,c.iconBoxStartIndex,c.iconBoxEndIndex,c.verticalIconBoxStartIndex,c.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}hasIconTextFit(){return this.hasAnyIconTextFit}addIndicesForPlacedSymbol(e,i){const c=e.placedSymbolArray.get(i),u=c.vertexStartIndex+4*c.numGlyphs;for(let p=c.vertexStartIndex;p<u;p+=4)e.indexArray.emplaceBack(p,p+1,p+2),e.indexArray.emplaceBack(p+1,p+2,p+3)}getSortedSymbolIndexes(e){if(this.sortedAngle===e&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const i=Math.sin(e),c=Math.cos(e),u=[],p=[],m=[];for(let v=0;v<this.symbolInstances.length;++v){m.push(v);const S=this.symbolInstances.get(v);u.push(0|Math.round(i*S.tileAnchorX+c*S.tileAnchorY)),p.push(S.featureIndex)}return m.sort((v,S)=>u[v]-u[S]||p[S]-p[v]),m}getSortedIndexesByZOffset(){if(!this.zOffsetSortDirty)return this.symbolInstanceIndexesSortedZOffset;if(!this.symbolInstanceIndexesSortedZOffset){this.symbolInstanceIndexesSortedZOffset=[];for(let e=0;e<this.symbolInstances.length;++e)this.symbolInstanceIndexesSortedZOffset.push(e)}return this.zOffsetSortDirty=!1,this.symbolInstanceIndexesSortedZOffset.sort((e,i)=>this.symbolInstances.get(i).zOffset-this.symbolInstances.get(e).zOffset)}addToSortKeyRanges(e,i){const c=this.sortKeyRanges[this.sortKeyRanges.length-1];c&&c.sortKey===i?c.symbolInstanceEnd=e+1:this.sortKeyRanges.push({sortKey:i,symbolInstanceStart:e,symbolInstanceEnd:e+1})}sortFeatures(e){if(this.sortFeaturesByY&&this.sortedAngle!==e&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(e),this.sortedAngle=e,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const i of this.symbolInstanceIndexes){const c=this.symbolInstances.get(i);this.featureSortOrder.push(c.featureIndex);const{rightJustifiedTextSymbolIndex:u,centerJustifiedTextSymbolIndex:p,leftJustifiedTextSymbolIndex:m,verticalPlacedTextSymbolIndex:v,placedIconSymbolIndex:S,verticalPlacedIconSymbolIndex:T}=c;u>=0&&this.addIndicesForPlacedSymbol(this.text,u),p>=0&&p!==u&&this.addIndicesForPlacedSymbol(this.text,p),m>=0&&m!==p&&m!==u&&this.addIndicesForPlacedSymbol(this.text,m),v>=0&&this.addIndicesForPlacedSymbol(this.text,v),S>=0&&this.addIndicesForPlacedSymbol(this.icon,S),T>=0&&this.addIndicesForPlacedSymbol(this.icon,T)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}let FR,jR,sT;Ht(S1,"SymbolBucket",{omit:["layers","collisionBoxArray","features","compareText"]}),S1.addDynamicAttributes=w1;class BR{constructor(e){this.type=e.property.overrides?e.property.overrides.runtimeType:zu,this.defaultValue=e}evaluate(e){if(e.formattedSection){const i=this.defaultValue.property.overrides;if(i&&i.hasOverride(e.formattedSection))return i.getOverride(e.formattedSection)}return e.feature&&e.featureState?this.defaultValue.evaluate(e.feature,e.featureState):this.defaultValue.property.specification.default}eachChild(e){this.defaultValue.isConstant()||e(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}Ht(BR,"FormatSectionOverride",{omit:["defaultValue"]});const oT=()=>sT||(sT={layout:FR||(FR=new Ti({"symbol-placement":new bt(Oe.layout_symbol["symbol-placement"]),"symbol-spacing":new bt(Oe.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new bt(Oe.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new Bt(Oe.layout_symbol["symbol-sort-key"]),"symbol-z-order":new bt(Oe.layout_symbol["symbol-z-order"]),"symbol-z-elevate":new bt(Oe.layout_symbol["symbol-z-elevate"]),"symbol-elevation-reference":new bt(Oe.layout_symbol["symbol-elevation-reference"]),"icon-allow-overlap":new bt(Oe.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new bt(Oe.layout_symbol["icon-ignore-placement"]),"icon-optional":new bt(Oe.layout_symbol["icon-optional"]),"icon-rotation-alignment":new bt(Oe.layout_symbol["icon-rotation-alignment"]),"icon-size":new Bt(Oe.layout_symbol["icon-size"]),"icon-size-scale-range":new bt(Oe.layout_symbol["icon-size-scale-range"]),"icon-text-fit":new Bt(Oe.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new Bt(Oe.layout_symbol["icon-text-fit-padding"]),"icon-image":new Bt(Oe.layout_symbol["icon-image"]),"icon-rotate":new Bt(Oe.layout_symbol["icon-rotate"]),"icon-padding":new bt(Oe.layout_symbol["icon-padding"]),"icon-keep-upright":new bt(Oe.layout_symbol["icon-keep-upright"]),"icon-offset":new Bt(Oe.layout_symbol["icon-offset"]),"icon-anchor":new Bt(Oe.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new bt(Oe.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new bt(Oe.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new bt(Oe.layout_symbol["text-rotation-alignment"]),"text-field":new Bt(Oe.layout_symbol["text-field"]),"text-font":new Bt(Oe.layout_symbol["text-font"]),"text-size":new Bt(Oe.layout_symbol["text-size"]),"text-size-scale-range":new bt(Oe.layout_symbol["text-size-scale-range"]),"text-max-width":new Bt(Oe.layout_symbol["text-max-width"]),"text-line-height":new Bt(Oe.layout_symbol["text-line-height"]),"text-letter-spacing":new Bt(Oe.layout_symbol["text-letter-spacing"]),"text-justify":new Bt(Oe.layout_symbol["text-justify"]),"text-radial-offset":new Bt(Oe.layout_symbol["text-radial-offset"]),"text-variable-anchor":new bt(Oe.layout_symbol["text-variable-anchor"]),"text-anchor":new Bt(Oe.layout_symbol["text-anchor"]),"text-max-angle":new bt(Oe.layout_symbol["text-max-angle"]),"text-writing-mode":new bt(Oe.layout_symbol["text-writing-mode"]),"text-rotate":new Bt(Oe.layout_symbol["text-rotate"]),"text-padding":new bt(Oe.layout_symbol["text-padding"]),"text-keep-upright":new bt(Oe.layout_symbol["text-keep-upright"]),"text-transform":new Bt(Oe.layout_symbol["text-transform"]),"text-offset":new Bt(Oe.layout_symbol["text-offset"]),"text-allow-overlap":new bt(Oe.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new bt(Oe.layout_symbol["text-ignore-placement"]),"text-optional":new bt(Oe.layout_symbol["text-optional"]),visibility:new bt(Oe.layout_symbol.visibility)})),paint:jR||(jR=new Ti({"icon-opacity":new Bt(Oe.paint_symbol["icon-opacity"]),"icon-occlusion-opacity":new Bt(Oe.paint_symbol["icon-occlusion-opacity"]),"icon-emissive-strength":new Bt(Oe.paint_symbol["icon-emissive-strength"]),"text-emissive-strength":new Bt(Oe.paint_symbol["text-emissive-strength"]),"icon-color":new Bt(Oe.paint_symbol["icon-color"]),"icon-halo-color":new Bt(Oe.paint_symbol["icon-halo-color"]),"icon-halo-width":new Bt(Oe.paint_symbol["icon-halo-width"]),"icon-halo-blur":new Bt(Oe.paint_symbol["icon-halo-blur"]),"icon-translate":new bt(Oe.paint_symbol["icon-translate"]),"icon-translate-anchor":new bt(Oe.paint_symbol["icon-translate-anchor"]),"icon-image-cross-fade":new bt(Oe.paint_symbol["icon-image-cross-fade"]),"text-opacity":new Bt(Oe.paint_symbol["text-opacity"]),"text-occlusion-opacity":new Bt(Oe.paint_symbol["text-occlusion-opacity"]),"text-color":new Bt(Oe.paint_symbol["text-color"],{runtimeType:xo,getOverride:o=>o.textColor,hasOverride:o=>!!o.textColor}),"text-halo-color":new Bt(Oe.paint_symbol["text-halo-color"]),"text-halo-width":new Bt(Oe.paint_symbol["text-halo-width"]),"text-halo-blur":new Bt(Oe.paint_symbol["text-halo-blur"]),"text-translate":new bt(Oe.paint_symbol["text-translate"]),"text-translate-anchor":new bt(Oe.paint_symbol["text-translate-anchor"]),"icon-color-saturation":new bt(Oe.paint_symbol["icon-color-saturation"]),"icon-color-contrast":new bt(Oe.paint_symbol["icon-color-contrast"]),"icon-color-brightness-min":new bt(Oe.paint_symbol["icon-color-brightness-min"]),"icon-color-brightness-max":new bt(Oe.paint_symbol["icon-color-brightness-max"]),"symbol-z-offset":new Bt(Oe.paint_symbol["symbol-z-offset"]),"icon-color-use-theme":new Bt({type:"string",default:"default","property-type":"data-driven"}),"icon-halo-color-use-theme":new Bt({type:"string",default:"default","property-type":"data-driven"}),"text-color-use-theme":new Bt({type:"string",default:"default","property-type":"data-driven"}),"text-halo-color-use-theme":new Bt({type:"string",default:"default","property-type":"data-driven"})}))},sT);class T1 extends Bs{constructor(e,i,c,u){super(e,oT(),i,c,u),this._colorAdjustmentMatrix=H([]),this.hasInitialOcclusionOpacityProperties=e.paint!==void 0&&("icon-occlusion-opacity"in e.paint||"text-occlusion-opacity"in e.paint)}recalculate(e,i){super.recalculate(e,i),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment"));const c=this.layout.get("text-writing-mode");if(c){const u=[];for(const p of c)u.indexOf(p)<0&&u.push(p);this.layout._values["text-writing-mode"]=u}else this.layout._values["text-writing-mode"]=this.layout.get("symbol-placement")==="point"?["horizontal"]:["horizontal","vertical"];this._setPaintOverrides()}getColorAdjustmentMatrix(e,i,c,u){return this._saturation===e&&this._contrast===i&&this._brightnessMin===c&&this._brightnessMax===u||(this._colorAdjustmentMatrix=function(p,m,v,S){p=Os(p),m=so(m);const T=ae(),I=p/3,P=1-2*I,M=[P,I,I,0,I,P,I,0,I,I,P,0,0,0,0,1],L=.5-.5*m,O=S-v;return Y(T,[O,0,0,0,0,O,0,0,0,0,O,0,v,v,v,1],[m,0,0,0,0,m,0,0,0,0,m,0,L,L,L,1]),Y(T,T,M),T}(e,i,c,u),this._saturation=e,this._contrast=i,this._brightnessMin=c,this._brightnessMax=u),this._colorAdjustmentMatrix}getValueAndResolveTokens(e,i,c,u){const p=this.layout.get(e).evaluate(i,{},c,u),m=this._unevaluatedLayout._values[e];return m.isDataDriven()||rm(m.value)||!p?p:function(v,S){return S.replace(/{([^{}]+)}/g,(T,I)=>I in v?String(v[I]):"")}(i.properties,p)}createBucket(e){return new S1(e)}queryRadius(){return 0}queryIntersectsFeature(){return!1}_setPaintOverrides(){for(const e of oT().paint.overridableProperties){if(!T1.hasPaintOverride(this.layout,e))continue;const i=this.paint.get(e),c=new BR(i),u=new Ku(c,i.property.specification,this.scope,this.options);let p=null;p=i.value.kind==="constant"||i.value.kind==="source"?new tf("source",u):new nf("composite",u,i.value.zoomStops,i.value.interpolationType),this.paint._values[e]=new td(i.property,p,i.parameters)}}_handleOverridablePaintPropertyUpdate(e,i,c){return!(!this.layout||i.isDataDriven()||c.isDataDriven())&&T1.hasPaintOverride(this.layout,e)}static hasPaintOverride(e,i){const c=e.get("text-field"),u=oT().paint.properties[i];let p=!1;const m=v=>{for(const S of v)if(u.overrides&&u.overrides.hasOverride(S))return void(p=!0)};if(c.value.kind==="constant"&&c.value.value instanceof Ys)m(c.value.value.sections);else if(c.value.kind==="source"){const v=T=>{p||(T instanceof En&&Gt(T.value)===Fh?m(T.value.sections):T instanceof Fu?m(T.sections):T.eachChild(v))},S=c.value;S._styleExpression&&v(S._styleExpression.expression)}return p}getProgramIds(){return["symbol"]}getDefaultProgramParams(e,i,c){return{config:new dd(this,{zoom:i,lut:c}),overrideFog:!1}}hasElevation(){return this.layout&&this.layout.get("symbol-elevation-reference")==="hd-road-markup"}}let VR,UR,$R,GR;var aT=hr([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);function lT(o){switch(o){case WebGL2RenderingContext.RGBA8:return WebGL2RenderingContext.RGBA;case WebGL2RenderingContext.DEPTH_COMPONENT16:return WebGL2RenderingContext.DEPTH_COMPONENT;case WebGL2RenderingContext.DEPTH24_STENCIL8:return WebGL2RenderingContext.DEPTH_STENCIL;case WebGL2RenderingContext.R8:case WebGL2RenderingContext.R32F:return WebGL2RenderingContext.RED}}function cT(o){switch(o){case WebGL2RenderingContext.RGBA8:return WebGL2RenderingContext.UNSIGNED_BYTE;case WebGL2RenderingContext.DEPTH_COMPONENT16:return WebGL2RenderingContext.UNSIGNED_SHORT;case WebGL2RenderingContext.DEPTH24_STENCIL8:return WebGL2RenderingContext.UNSIGNED_INT_24_8;case WebGL2RenderingContext.R8:return WebGL2RenderingContext.UNSIGNED_BYTE;case WebGL2RenderingContext.R32F:return WebGL2RenderingContext.FLOAT}}class uT{constructor(e,i,c,u){this.context=e,this.format=c,this.useMipmap=u&&u.useMipmap,this.texture=e.gl.createTexture(),this.update(i,{premultiply:u&&u.premultiply})}update(e,i){const c=e&&e instanceof HTMLVideoElement&&e.width===0?e.videoWidth:e.width,u=e&&e instanceof HTMLVideoElement&&e.height===0?e.videoHeight:e.height,{context:p}=this,{gl:m}=p,{x:v,y:S}=i&&i.position?i.position:{x:0,y:0},T=v+c,I=S+u;!this.size||this.size[0]===T&&this.size[1]===I||(m.bindTexture(m.TEXTURE_2D,null),m.deleteTexture(this.texture),this.texture=m.createTexture(),this.size=null),m.bindTexture(m.TEXTURE_2D,this.texture),p.pixelStoreUnpackFlipY.set(!1),p.pixelStoreUnpack.set(1),p.pixelStoreUnpackPremultiplyAlpha.set(this.format===m.RGBA8&&(!i||i.premultiply!==!1));const P=e instanceof HTMLImageElement||e instanceof HTMLCanvasElement||e instanceof HTMLVideoElement||e instanceof ImageData||ImageBitmap&&e instanceof ImageBitmap;if(!this.size&&T>0&&I>0){const M=this.useMipmap?Math.floor(Math.log2(Math.max(T,I)))+1:1;m.texStorage2D(m.TEXTURE_2D,M,this.format,T,I),this.size=[T,I]}if(this.size)if(P)m.texSubImage2D(m.TEXTURE_2D,0,v,S,lT(this.format),cT(this.format),e);else{const M=e.data;M&&m.texSubImage2D(m.TEXTURE_2D,0,v,S,c,u,lT(this.format),cT(this.format),M)}this.useMipmap&&m.generateMipmap(m.TEXTURE_2D)}bind(e,i,c=!1){const{context:u}=this,{gl:p}=u;p.bindTexture(p.TEXTURE_2D,this.texture),e!==this.minFilter&&(p.texParameteri(p.TEXTURE_2D,p.TEXTURE_MAG_FILTER,e),p.texParameteri(p.TEXTURE_2D,p.TEXTURE_MIN_FILTER,this.useMipmap&&!c?e===p.NEAREST?p.NEAREST_MIPMAP_NEAREST:p.LINEAR_MIPMAP_LINEAR:e),this.minFilter=e),i!==this.wrapS&&(p.texParameteri(p.TEXTURE_2D,p.TEXTURE_WRAP_S,i),p.texParameteri(p.TEXTURE_2D,p.TEXTURE_WRAP_T,i),this.wrapS=i)}bindExtraParam(e,i,c,u,p){const{context:m}=this,{gl:v}=m;v.bindTexture(v.TEXTURE_2D,this.texture),i!==this.magFilter&&(v.texParameteri(v.TEXTURE_2D,v.TEXTURE_MAG_FILTER,i),this.magFilter=i),e!==this.minFilter&&(v.texParameteri(v.TEXTURE_2D,v.TEXTURE_MIN_FILTER,this.useMipmap?e===v.NEAREST?v.NEAREST_MIPMAP_NEAREST:v.LINEAR_MIPMAP_LINEAR:e),this.minFilter=e),c!==this.wrapS&&(v.texParameteri(v.TEXTURE_2D,v.TEXTURE_WRAP_S,c),this.wrapS=c),u!==this.wrapT&&(v.texParameteri(v.TEXTURE_2D,v.TEXTURE_WRAP_T,u),this.wrapT=u),p!==this.compareMode&&(p?(v.texParameteri(v.TEXTURE_2D,v.TEXTURE_COMPARE_MODE,v.COMPARE_REF_TO_TEXTURE),v.texParameteri(v.TEXTURE_2D,v.TEXTURE_COMPARE_FUNC,p)):v.texParameteri(v.TEXTURE_2D,v.TEXTURE_COMPARE_MODE,v.NONE),this.compareMode=p)}destroy(){const{gl:e}=this.context;e.deleteTexture(this.texture),this.texture=null}}class E1{constructor(e,i){this.context=e,this.texture=i}bind(e,i){const{context:c}=this,{gl:u}=c;u.bindTexture(u.TEXTURE_2D,this.texture),e!==this.minFilter&&(u.texParameteri(u.TEXTURE_2D,u.TEXTURE_MAG_FILTER,e),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_MIN_FILTER,e),this.minFilter=e),i!==this.wrapS&&(u.texParameteri(u.TEXTURE_2D,u.TEXTURE_WRAP_S,i),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_WRAP_T,i),this.wrapS=i)}}function C1(o,e,i,c,u,p,m,v){const S=[o,e,1,i,c,1,u,p,1],T=[m,v,1],I=$([],S),[P,M,L]=Mr(T,T,I);return se(S,S,[P,0,0,0,M,0,0,0,L])}function HR(o,e,i,c,u,p,m,v){const S=function(T,I,P,M,L,O,G,Z){const Q=C1(0,0,1,0,1,1,0,1),le=C1(T,I,P,M,L,O,G,Z);return se(le,le,$([],Q))}(o,e,i,c,u,p,m,v);return[S[2]/S[8]/Lt,S[5]/S[8]/Lt]}function A1(o){return[o[0],Math.min(Math.max(o[1],-85.051129),rt)]}class qR extends Gc{constructor(e,i,c,u){super(),this.id=e,this.dispatcher=c,this.coordinates=i.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.onNorthPole=!1,this.onSouthPole=!1,this.setEventedParent(u),this.options=i,this._dirty=!1}load(e,i){if(this._loaded=i||!1,this.fire(new $c("dataloading",{dataType:"source"})),this.url=this.options.url,!this.url)return e&&(this.coordinates=e),this._loaded=!0,void this._finishLoading();this._imageRequest=m_(this.map._requestManager.transformRequest(this.url,Dh.Image),(c,u)=>{this._imageRequest=null,this._loaded=!0,c?this.fire(new Mp(c)):u&&(this.image=u instanceof HTMLImageElement?pa.getImageData(u):u,this._dirty=!0,this.width=this.image.width,this.height=this.image.height,e&&(this.coordinates=e),this._finishLoading())})}loaded(){return this._loaded}updateImage(e){return e.url?(this._imageRequest&&e.url!==this.options.url&&(this._imageRequest.cancel(),this._imageRequest=null),this.options.url=e.url,this.load(e.coordinates,this._loaded),this):this}setTexture(e){if(!(e.handle instanceof WebGLTexture))throw new Error("The provided handle is not a WebGLTexture instance");return this.texture=new E1(this.map.painter.context,e.handle),this.width=e.dimensions[0],this.height=e.dimensions[1],this._dirty=!1,this._loaded=!0,this._finishLoading(),this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new $c("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(e){this.map=e,this.load()}onRemove(e){this._imageRequest&&(this._imageRequest.cancel(),this._imageRequest=null),!this.texture||this.texture instanceof E1||this.texture.destroy(),this.boundsBuffer&&(this.boundsBuffer.destroy(),this.elevatedGlobeVertexBuffer&&this.elevatedGlobeVertexBuffer.destroy(),this.elevatedGlobeIndexBuffer&&this.elevatedGlobeIndexBuffer.destroy())}setCoordinates(e){if(this.coordinates=e,this._boundsArray=void 0,this._unsupportedCoords=!1,!e.length)return this;this.onNorthPole=!1,this.onSouthPole=!1;let i=e[0][1],c=e[0][1];for(const p of e)p[1]>c&&(c=p[1]),p[1]<i&&(i=p[1]);const u=(c+i)/2;if(u>rt?this.onNorthPole=!0:u<-85.051129&&(this.onSouthPole=!0),!this.onNorthPole&&!this.onSouthPole){const p=e.map(Re.fromLngLat);this.tileID=function(m){let v=1/0,S=1/0,T=-1/0,I=-1/0;for(const G of m)v=Math.min(v,G.x),S=Math.min(S,G.y),T=Math.max(T,G.x),I=Math.max(I,G.y);const P=Math.max(T-v,I-S),M=Math.max(0,Math.floor(-Math.log(P)/Math.LN2)),L=Math.pow(2,M);let O=Math.floor((v+T)/2*L);return O>1&&(O-=1),new wf(M,O,Math.floor((S+I)/2*L))}(p),this.minzoom=this.maxzoom=this.tileID.z}return this.fire(new $c("data",{dataType:"source",sourceDataType:"content"})),this}_clear(){this._boundsArray=void 0,this._unsupportedCoords=!1}_prepareData(e){for(const Q in this.tiles){const le=this.tiles[Q];le.state!=="loaded"&&(le.state="loaded",le.texture=this.texture)}if(this._boundsArray||this.onNorthPole||this.onSouthPole||this._unsupportedCoords)return;const i=jy(new wf(0,0,0),this.map.transform.projection),c=[i.projection.project(this.coordinates[0][0],this.coordinates[0][1]),i.projection.project(this.coordinates[1][0],this.coordinates[1][1]),i.projection.project(this.coordinates[2][0],this.coordinates[2][1]),i.projection.project(this.coordinates[3][0],this.coordinates[3][1])];if(!function(Q){const le=Q[1].x-Q[0].x,ce=Q[1].y-Q[0].y,q=Q[2].x-Q[1].x,re=Q[2].y-Q[1].y,ue=Q[3].x-Q[2].x,pe=Q[3].y-Q[2].y,Ae=Q[0].x-Q[3].x,Te=Q[0].y-Q[3].y,Ie=le*re-q*ce,Ne=q*pe-ue*re,Ke=ue*Te-Ae*pe,yt=Ae*ce-le*Te;return Ie>0&&Ne>0&&Ke>0&&yt>0||Ie<0&&Ne<0&&Ke<0&&yt<0}(c))return console.warn("Image source coordinates are defining non-convex area in the Mercator projection"),void(this._unsupportedCoords=!0);const u=jy(this.tileID,this.map.transform.projection),[p,m,v,S]=this.coordinates.map(Q=>{const le=u.projection.project(Q[0],Q[1]);return kR(u,le)._round()});this.perspectiveTransform=HR(p.x,p.y,m.x,m.y,v.x,v.y,S.x,S.y);const T=this._boundsArray=new rd;T.emplaceBack(p.x,p.y,0,0),T.emplaceBack(m.x,m.y,Lt,0),T.emplaceBack(S.x,S.y,0,Lt),T.emplaceBack(v.x,v.y,Lt,Lt),this.boundsBuffer&&(this.boundsBuffer.destroy(),this.elevatedGlobeVertexBuffer&&this.elevatedGlobeVertexBuffer.destroy(),this.elevatedGlobeIndexBuffer&&this.elevatedGlobeIndexBuffer.destroy()),this.boundsBuffer=e.createVertexBuffer(T,aT.members),this.boundsSegments=Ai.simpleSegment(0,0,4,2);const I=[],P=[A1((M=this.coordinates)[0]),A1(M[1]),A1(M[2]),A1(M[3])];var M;const[L,O,G,Z]=function(Q){let le=Q[0][0],ce=le,q=Q[0][1],re=q;for(let ue=1;ue<Q.length;ue++)Q[ue][0]<le?le=Q[ue][0]:Q[ue][0]>ce&&(ce=Q[ue][0]),Q[ue][1]<q?q=Q[ue][1]:Q[ue][1]>re&&(re=Q[ue][1]);return[le,q,ce-le,re-q]}(P);{const Q=new rd,[le,ce,q,re]=function(et){let pt=et[0].x,Ze=pt,Qe=et[0].y,St=Qe;for(let Et=1;Et<et.length;Et++)et[Et].x<pt?pt=et[Et].x:et[Et].x>Ze&&(Ze=et[Et].x),et[Et].y<Qe?Qe=et[Et].y:et[Et].y>St&&(St=et[Et].y);return[pt,Qe,Ze-pt,St-Qe]}(c),ue=et=>[(et.x-le)/q,(et.y-ce)/re],[pe,Ae,Te,Ie]=c.map(ue),Ne=function(et,pt,Ze,Qe,St,Et,ln,Kt){const Ot=C1(0,0,1,0,1,1,0,1);return se(Ot,Ot,$([],C1(et,pt,Ze,Qe,St,Et,ln,Kt)))}(pe[0],pe[1],Ae[0],Ae[1],Te[0],Te[1],Ie[0],Ie[1]);this.elevatedGlobePerspectiveTransform=HR(pe[0],pe[1],Ae[0],Ae[1],Te[0],Te[1],Ie[0],Ie[1]);const Ke=(et,pt)=>{I.push(et.lng);const Ze=Math.round((et.lng-L)/G*Lt),Qe=Math.round((et.lat-O)/Z*Lt),St=ue(pt),Et=Mr([],[St[0],St[1],1],Ne),ln=Math.round(Et[0]/Et[2]*Lt),Kt=Math.round(Et[1]/Et[2]*Lt);Q.emplaceBack(Ze,Qe,ln,Kt)},yt=c[3].x-c[0].x,at=c[3].y-c[0].y,_t=c[2].x-c[1].x,xt=c[2].y-c[1].y;for(let et=0;et<65;et++){const pt=et/64,Ze=[c[0].x+pt*yt,c[0].y+pt*at],Qe=[c[1].x+pt*_t,c[1].y+pt*xt],St=Qe[0]-Ze[0],Et=Qe[1]-Ze[1];for(let ln=0;ln<65;ln++){const Kt=ln/64,Ot={x:Ze[0]+St*Kt,y:Ze[1]+Et*Kt};Ke(i.projection.unproject(Ot.x,Ot.y),Ot)}}this.elevatedGlobeVertexBuffer=e.createVertexBuffer(Q,aT.members)}{this.maxLongitudeTriangleSize=0;let Q=[],le=new bs;const ce=(q,re,ue)=>{le.emplaceBack(q,re,ue);const pe=I[q],Ae=I[re],Te=I[ue],Ie=Math.min(Math.min(pe,Ae),Te),Ne=Math.max(Math.max(pe,Ae),Te)-Ie;Ne>this.maxLongitudeTriangleSize&&(this.maxLongitudeTriangleSize=Ne),Q.push(Ie+Ne/2)};for(let q=0;q<64;q++)for(let re=0;re<64;re++){const ue=65*q+re,pe=ue+1,Ae=ue+65,Te=Ae+1;ce(ue,Ae,pe),ce(pe,Ae,Te)}[Q,le]=function(q,re){const ue=Array.from({length:q.length},(Te,Ie)=>Ie);ue.sort((Te,Ie)=>q[Te]-q[Ie]);const pe=[],Ae=new bs;for(let Te=0;Te<ue.length;Te++){const Ie=ue[Te];pe.push(q[Ie]);const Ne=3*Ie,Ke=Ne+1;Ae.emplaceBack(re.uint16[Ne],re.uint16[Ke],re.uint16[Ke+1])}return[pe,Ae]}(Q,le),this.elevatedGlobeTrianglesCenterLongitudes=Q,this.elevatedGlobeIndexBuffer=e.createIndexBuffer(le)}this.elevatedGlobeSegments=Ai.simpleSegment(0,0,4225,8192),this.elevatedGlobeGridMatrix=new Float32Array([0,G/Lt,0,Z/Lt,0,0,O,L,0])}prepare(){const e=Object.keys(this.tiles).length!==0;if(this.tileID&&!e)return;const i=this.map.painter.context,c=i.gl;!this._dirty||this.texture instanceof E1||(this.texture?this.texture.update(this.image):(this.texture=new uT(i,this.image,c.RGBA8),this.texture.bind(c.LINEAR,c.CLAMP_TO_EDGE)),this._dirty=!1),e&&this._prepareData(i)}loadTile(e,i){this.tileID&&this.tileID.equals(e.tileID.canonical)?(this.tiles[String(e.tileID.wrap)]=e,e.buckets={},i(null)):(e.state="errored",i(null))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}getSegmentsForLongitude(e){const i=this.elevatedGlobeSegments;if(!this.elevatedGlobeTrianglesCenterLongitudes||!i)return null;const c=this.elevatedGlobeTrianglesCenterLongitudes;let u=(p=e+180)+360*Math.round((c[0]-p)/360);var p;const m=new Ai,v=(P,M)=>{m.segments.push({vertexOffset:0,primitiveOffset:P,vertexLength:i.segments[0].vertexLength,primitiveLength:M,sortKey:void 0,vaos:{}})},S=.51*this.maxLongitudeTriangleSize;if(Math.abs(c[0]-u)<=S){const P=fs(c,0,c.length,u+S);return P===c.length||v(P,_i(c,P+1,c.length,u+360-S)-P),m}u<c[0]&&(u+=360);const T=_i(c,0,c.length,u-S);if(T===c.length)return v(0,c.length),m;v(0,T-0);const I=fs(c,T+1,c.length,u+S);return I!==c.length&&v(I,c.length-I),m}}const gU=(Math.pow(256,2)-1)/16907520;class WR extends Bs{constructor(e,i,c,u){super(e,{layout:$R||($R=new Ti({visibility:new bt(Oe.layout_raster.visibility)})),paint:GR||(GR=new Ti({"raster-opacity":new bt(Oe.paint_raster["raster-opacity"]),"raster-color":new iu(Oe.paint_raster["raster-color"]),"raster-color-mix":new bt(Oe.paint_raster["raster-color-mix"]),"raster-color-range":new bt(Oe.paint_raster["raster-color-range"]),"raster-hue-rotate":new bt(Oe.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new bt(Oe.paint_raster["raster-brightness-min"]),"raster-brightness-max":new bt(Oe.paint_raster["raster-brightness-max"]),"raster-saturation":new bt(Oe.paint_raster["raster-saturation"]),"raster-contrast":new bt(Oe.paint_raster["raster-contrast"]),"raster-resampling":new bt(Oe.paint_raster["raster-resampling"]),"raster-fade-duration":new bt(Oe.paint_raster["raster-fade-duration"]),"raster-emissive-strength":new bt(Oe.paint_raster["raster-emissive-strength"]),"raster-array-band":new bt(Oe.paint_raster["raster-array-band"]),"raster-elevation":new bt(Oe.paint_raster["raster-elevation"]),"raster-color-use-theme":new Bt({type:"string",default:"default","property-type":"data-driven"})}))},i,c,u),this.updateColorRamp(),this._curRampRange=[NaN,NaN]}getProgramIds(){return["raster"]}hasColorMap(){return!!this._transitionablePaint._values["raster-color"].value.value}tileCoverLift(){return this.paint.get("raster-elevation")}isDraped(e){return!(e&&e._source instanceof qR&&(e._source.onNorthPole||e._source.onSouthPole))&&this.paint.get("raster-elevation")===0}_handleSpecialPaintPropertyUpdate(e){e!=="raster-color"&&e!=="raster-color-range"||(this._curRampRange=[NaN,NaN],this.updateColorRamp())}updateColorRamp(e){if(!this.hasColorMap()||!this._curRampRange)return;const i=this._transitionablePaint._values["raster-color"].value.expression,[c,u]=e||this._transitionablePaint._values["raster-color-range"].value.expression.evaluate({zoom:0})||[NaN,NaN];isNaN(c)&&isNaN(u)||c===this._curRampRange[0]&&u===this._curRampRange[1]||(this.colorRamp=vy({expression:i,evaluationKey:"rasterValue",image:this.colorRamp,clips:[{start:c,end:u}],resolution:256}),this.colorRampTexture=null,this._curRampRange=[c,u])}}let ZR,XR,YR,KR,QR;class JR extends Bs{constructor(e,i,c,u){super(e,{layout:ZR||(ZR=new Ti({visibility:new bt(Oe["layout_raster-particle"].visibility)})),paint:XR||(XR=new Ti({"raster-particle-array-band":new bt(Oe["paint_raster-particle"]["raster-particle-array-band"]),"raster-particle-count":new bt(Oe["paint_raster-particle"]["raster-particle-count"]),"raster-particle-color":new iu(Oe["paint_raster-particle"]["raster-particle-color"]),"raster-particle-max-speed":new bt(Oe["paint_raster-particle"]["raster-particle-max-speed"]),"raster-particle-speed-factor":new bt(Oe["paint_raster-particle"]["raster-particle-speed-factor"]),"raster-particle-fade-opacity-factor":new bt(Oe["paint_raster-particle"]["raster-particle-fade-opacity-factor"]),"raster-particle-reset-rate-factor":new bt(Oe["paint_raster-particle"]["raster-particle-reset-rate-factor"]),"raster-particle-elevation":new bt(Oe["paint_raster-particle"]["raster-particle-elevation"]),"raster-particle-color-use-theme":new Bt({type:"string",default:"default","property-type":"data-driven"})}))},i,c,u),this._updateColorRamp(),this.lastInvalidatedAt=pa.now()}onRemove(e){this.colorRampTexture&&this.colorRampTexture.destroy(),this.tileFramebuffer&&this.tileFramebuffer.destroy(),this.particleFramebuffer&&this.particleFramebuffer.destroy()}hasColorMap(){return!!this._transitionablePaint._values["raster-particle-color"].value.value}getProgramIds(){return["rasterParticle"]}hasOffscreenPass(){return this.visibility!=="none"}isDraped(e){return!1}_handleSpecialPaintPropertyUpdate(e){e!=="raster-particle-color"&&e!=="raster-particle-max-speed"||(this._updateColorRamp(),this._invalidateAnimationState()),e==="raster-particle-count"&&this._invalidateAnimationState()}_updateColorRamp(){if(!this.hasColorMap())return;const e=this._transitionablePaint._values["raster-particle-color"].value.expression,i=this._transitionablePaint._values["raster-particle-max-speed"].value.expression.evaluate({zoom:0});this.colorRamp=vy({expression:e,evaluationKey:"rasterParticleSpeed",image:this.colorRamp,clips:[{start:0,end:i}],resolution:256}),this.colorRampTexture=null}_invalidateAnimationState(){this.lastInvalidatedAt=pa.now()}tileCoverLift(){return this.paint.get("raster-particle-elevation")}}class _U extends Bs{constructor(e,i){super(e,{},i,null),this.implementation=e,e.slot&&(this.slot=e.slot)}is3D(e){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}isDraped(e){return this.implementation.renderToTile!==void 0}shouldRedrape(){return!!this.implementation.shouldRerenderTiles&&this.implementation.shouldRerenderTiles()}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){}onAdd(e){this.implementation.onAdd&&this.implementation.onAdd(e,e.painter.context.gl)}onRemove(e){this.implementation.onRemove&&this.implementation.onRemove(e,e.painter.context.gl)}}function dT(o,e,i){const c=[0,0,1],u=bn([]);return sn(u,u,i?-mr(o)+Math.PI:mr(o)),pn(u,u,-mr(e)),Lr(c,c,u),Hn(c,c)}function ek(o,e){const i=I1(o.projection,o.zoom,o.width,o.height),c=function(p,m,v,S,T){const I=new ie(v.lng-180*vd,v.lat),P=new ie(v.lng+180*vd,v.lat),M=p.project(I.lng,I.lat),L=p.project(P.lng,P.lat),O=-Math.atan2(L.y-M.y,L.x-M.x),G=Re.fromLngLat(v);G.y=xe(G.y,-1+vd,1-vd);const Z=G.toLngLat(),Q=p.project(Z.lng,Z.lat),le=Re.fromLngLat(Z);le.x+=vd;const ce=le.toLngLat(),q=p.project(ce.lng,ce.lat),re=nk(q.x-Q.x,q.y-Q.y,O),ue=Re.fromLngLat(Z);ue.y+=vd;const pe=ue.toLngLat(),Ae=p.project(pe.lng,pe.lat),Te=nk(Ae.x-Q.x,Ae.y-Q.y,O),Ie=Math.abs(re.x)/Math.abs(Te.y),Ne=H([]);lt(Ne,Ne,-O*(1-(T?0:S)));const Ke=H([]);return de(Ke,Ke,[1,1-(1-Ie)*S,1]),Ke[4]=-Te.x/Te.y*S,lt(Ke,Ke,O),Y(Ke,Ne,Ke),Ke}(o.projection,0,o.center,i,e),u=tk(o);return de(c,c,[u,u,1]),c}function tk(o){const e=o.projection,i=I1(o.projection,o.zoom,o.width,o.height),c=hT(e,o.center),u=hT(e,ie.convert(e.center));return Math.pow(2,c*i+(1-i)*u)}function I1(o,e,i,c,u=1/0){const p=o.range;if(!p)return 0;const m=Math.min(u,Math.max(i,c)),v=Math.log(m/1024)/Math.LN2;return ke(p[0]+v,p[1]+v,e)}const vd=1/4e4;function hT(o,e){const i=xe(e.lat,-85.051129,rt),c=new ie(e.lng-180*vd,i),u=new ie(e.lng+180*vd,i),p=o.project(c.lng,i),m=o.project(u.lng,i),v=Re.fromLngLat(c),S=Re.fromLngLat(u),T=m.x-p.x,I=m.y-p.y,P=S.x-v.x,M=S.y-v.y,L=Math.sqrt((P*P+M*M)/(T*T+I*I));return Math.log(L)/Math.LN2}function nk(o,e,i){const c=Math.cos(i),u=Math.sin(i);return{x:o*c-e*u,y:o*u+e*c}}function rk(o,e,i){H(o),lt(o,o,mr(e[2])),Me(o,o,mr(e[0])),Le(o,o,mr(e[1])),de(o,o,i),Y(o,o,[1,0,0,0,0,0,1,0,0,1,0,0,0,0,0,1])}function P1(o,e,i,c,u,p,m,v){const S=[i[0]-e[0],i[1]-e[1],0],T=[c[0]-e[0],c[1]-e[1],0];if($t(S)<1e-12||$t(T)<1e-12)return bn(o);const I=an([],S,T);Hn(I,I),Je(T,c,e),S[2]=(p-u)*v,T[2]=(m-u)*v;const P=S;return an(P,S,T),Hn(P,P),ko(o,I,P)}function fT(o,e,i=!1){const c=pd(e.zoom),u=function(p,m,v){const S=m.worldSize,T=[p[12],p[13],p[14]],I=Fe(T[1]/S),P=Ee(T[0]/S),M=H([]),L=Se(1,I)*S,O=Se(1,0)*S*gt(I,m.zoom),G=1/xS(S);let Z=O*G;if(v){const q=I1(m.projection,m.zoom,m.width,m.height,1024);Z=G*m.projection.pixelSpaceConversion(m.center.lat,S,q)}const Q=W(I,P);jt(Q,Q,Ct([],Hn([],Q),L*Z*T[2]));const le=function(q){const re=[q[0],q[1],q[2]];let ue=[0,1,0];const pe=an([],ue,re);return an(ue,re,pe),Qn(ue)===0&&(ue=[0,1,0],an(pe,re,ue)),Hn(pe,pe),Hn(ue,ue),Hn(re,re),[pe[0],pe[1],pe[2],0,ue[0],ue[1],ue[2],0,re[0],re[1],re[2],0,q[0],q[1],q[2],1]}(Q);de(M,M,[Z,Z,Z*L]),te(M,M,[-T[0],-T[1],-T[2]]);const ce=Y([],m.globeMatrix,le);return Y(ce,ce,M),Y(ce,ce,p),ce}(o,e,i);if(c>0){const p=function(m,v){const S=v.worldSize,T=Se(1,0)*S*gt(v.center.lat,v.zoom)/xS(S),I=Se(1,v.center.lat)*S,P=H([]);return Le(P,P,mr(v.center.lng)),Me(P,P,mr(v.center.lat)),te(P,P,[0,0,b]),de(P,P,[T,T,T*I]),te(P,P,[v.point.x-.5*S,v.point.y-.5*S,0]),Y(P,P,m),Y(P,v.globeMatrix,P)}(o,e);return function(m,v,S){const T=(O,G,Z)=>{const Q=$t(O),le=$t(G),ce=lu(O,G,Z);return Ct(ce,ce,1/$t(ce)*vn(Q,le,Z))},I=T([m[0],m[1],m[2]],[v[0],v[1],v[2]],S),P=T([m[4],m[5],m[6]],[v[4],v[5],v[6]],S),M=T([m[8],m[9],m[10]],[v[8],v[9],v[10]],S),L=lu([m[12],m[13],m[14]],[v[12],v[13],v[14]],S);return[I[0],I[1],I[2],0,P[0],P[1],P[2],0,M[0],M[1],M[2],0,L[0],L[1],L[2],1]}(u,p,c)}return u}function ik(o,e,i,c){const u=gr.projectAabbCorners(c,i);let p=Number.MAX_VALUE,m=-1;for(let T=0;T<u.length;++T){const I=u[T];I[0]=(.5*I[0]+.5)*e.width,I[1]=(.5-.5*I[1])*e.height,I[2]<p&&(m=T,p=I[2])}const v=T=>new Dt(u[T][0],u[T][1]);let S;switch(m){case 0:case 6:S=[v(1),v(5),v(4),v(7),v(3),v(2),v(1)];break;case 1:case 7:S=[v(0),v(4),v(5),v(6),v(2),v(3),v(0)];break;case 3:case 5:S=[v(1),v(0),v(4),v(7),v(6),v(2),v(1)];break;default:S=[v(1),v(5),v(6),v(7),v(3),v(0),v(1)]}if(co(o,S))return p}const yU=hr([{name:"a_pos_3f",components:3,type:"Float32"}]),vU=hr([{name:"a_color_3f",components:3,type:"Float32"}]),xU=hr([{name:"a_color_4f",components:4,type:"Float32"}]),bU=hr([{name:"a_uv_2f",components:2,type:"Float32"}]),wU=hr([{name:"a_normal_3f",components:3,type:"Float32"}]),SU=hr([{name:"a_normal_matrix0",components:4,type:"Float32"},{name:"a_normal_matrix1",components:4,type:"Float32"},{name:"a_normal_matrix2",components:4,type:"Float32"},{name:"a_normal_matrix3",components:4,type:"Float32"}]),TU=hr([{name:"a_pbr",components:4,type:"Uint16"},{name:"a_heightBasedEmissiveStrength",components:3,type:"Float32"}]),sk={None:0,Model:1,Symbol:2,FillExtrusion:4};class M1{constructor(e,i,c,u){this.message=(e?`${e}: `:"")+c,u&&(this.identifier=u),i!=null&&i.__line__&&(this.line=i.__line__)}}function pT(o,e){const i=o.indexOf("://")===-1;try{return new URL(o,i&&e?"http://example.com":void 0),!0}catch{return!1}}class ok{constructor(e,i){this.feature=e,this.instancedDataOffset=i,this.instancedDataCount=0,this.rotation=[0,0,0],this.scale=[1,1,1],this.translation=[0,0,0]}}class ak{constructor(){this.instancedDataArray=new ld,this.instancesEvaluatedElevation=[],this.features=[],this.idToFeaturesIndex={}}}class mT{constructor(e){this.zoom=e.zoom,this.canonical=e.canonical,this.layers=e.layers,this.layerIds=this.layers.map(i=>i.fqid),this.projection=e.projection,this.index=e.index,this.worldview=e.worldview,this.hasZoomDependentProperties=this.layers[0].isZoomDependent(),this.stateDependentLayerIds=this.layers.filter(i=>i.isStateDependent()).map(i=>i.id),this.hasPattern=!1,this.instancesPerModel={},this.validForExaggeration=0,this.maxVerticalOffset=0,this.maxScale=0,this.maxHeight=0,this.lookupDim=this.zoom>this.canonical.z?256:this.zoom>15?75:100,this.instanceCount=0,this.terrainElevationMin=0,this.terrainElevationMax=0,this.validForDEMTile={id:null,timestamp:0},this.modelUris=[],this.modelsRequested=!1,this.activeReplacements=[],this.replacementUpdateTime=0,this.styleDefinedModelURLs=e.styleDefinedModelURLs}updateFootprints(e,i){}populate(e,i,c,u){this.tileToMeter=Xe(c);const p=this.layers[0]._featureFilter.needGeometry;this.lookup=new Uint8Array(this.lookupDim*this.lookupDim);for(const{feature:m,id:v,index:S,sourceLayerIndex:T}of e){const I=v??(m.properties&&m.properties.hasOwnProperty("id")?m.properties.id:void 0),P=Vt(m,p);if(!this.layers[0]._featureFilter.filter(new Fr(this.zoom,{worldview:this.worldview}),P,c))continue;const M={id:I,sourceLayerIndex:T,index:S,geometry:p?P.geometry:Wt(m,c,u),properties:m.properties,type:m.type,patterns:{}},L=this.addFeature(M,M.geometry,P);L&&i.featureIndex.insert(m,M.geometry,S,T,this.index,this.instancesPerModel[L].instancedDataArray.length,Lt/32)}this.lookup=null}update(e,i,c,u){for(const p in this.instancesPerModel){const m=this.instancesPerModel[p];for(const v in e)m.idToFeaturesIndex.hasOwnProperty(v)&&(this.evaluate(m.features[m.idToFeaturesIndex[v]],e[v],m,!0),this.uploaded=!1)}this.maxHeight=0}updateZoomBasedPaintProperties(){if(!this.hasZoomDependentProperties)return!1;let e=!1;for(const i in this.instancesPerModel){const c=this.instancesPerModel[i];for(const u of c.features){const p=this.layers[0],m=u.feature,v=this.canonical,S=p.paint.get("model-rotation").evaluate(m,{},v),T=p.paint.get("model-scale").evaluate(m,{},v),I=p.paint.get("model-translation").evaluate(m,{},v);xr(u.rotation,S)&&xr(u.scale,T)&&xr(u.translation,I)||(this.evaluate(u,u.featureStates,c,!0),e=!0)}}return e}updateReplacement(e,i,c,u){if(i.updateTime===this.replacementUpdateTime)return!1;this.replacementUpdateTime=i.updateTime;const p=i.getReplacementRegionsForTile(e.toUnwrapped(),!0);if(kS(this.activeReplacements,p))return!1;this.activeReplacements=p;let m=!1;for(const v in this.instancesPerModel){const S=this.instancesPerModel[v],T=S.instancedDataArray;for(const I of S.features){const P=I.instancedDataOffset,M=I.instancedDataCount;for(let L=0;L<M;L++){const O=16*(L+P);let G=T.float32[O+0];const Z=G>Lt;G=Z?G-Lt:G;const Q=Math.floor(G),le=T.float32[O+1];let ce=!1;for(const q of this.activeReplacements)if(!JP(q,c,sk.Model,u)&&!(q.min.x>Q||Q>q.max.x||q.min.y>le||le>q.max.y)&&(ce=sM(iM(Q,le,e.canonical,q.footprintTileId.canonical),q.footprint),ce))break;T.float32[O]=ce?G+Lt:G,m=m||ce!==Z}}}return m}isEmpty(){for(const e in this.instancesPerModel)if(this.instancesPerModel[e].instancedDataArray.length!==0)return!1;return!0}uploadPending(){return!this.uploaded}upload(e){if(!this.uploaded)for(const i in this.instancesPerModel){const c=this.instancesPerModel[i];c.instancedDataArray.length<0||c.instancedDataArray.length===0||(c.instancedDataBuffer?c.instancedDataBuffer.updateData(c.instancedDataArray):c.instancedDataBuffer=e.createVertexBuffer(c.instancedDataArray,SU.members,!0,void 0,this.instanceCount))}this.uploaded=!0}destroy(){for(const i in this.instancesPerModel){const c=this.instancesPerModel[i];c.instancedDataArray.length!==0&&c.instancedDataBuffer&&c.instancedDataBuffer.destroy()}const e=this.layers[0].modelManager;if(e&&this.modelUris&&this.modelsRequested)for(const i of this.modelUris)e.removeModel(i,"",!0)}addFeature(e,i,c){const u=this.layers[0],p=u.layout.get("model-id").evaluate(c,{},this.canonical);if(!p)return On(`modelId is not evaluated for layer ${u.id} and it is not going to get rendered.`),p;(pT(p,!1)||this.styleDefinedModelURLs[p]!==void 0)&&(this.modelUris.includes(p)||this.modelUris.push(p)),this.instancesPerModel[p]||(this.instancesPerModel[p]=new ak);const m=this.instancesPerModel[p],v=m.instancedDataArray,S=new ok(c,v.length);for(const T of i)for(const I of T){if(I.x<0||I.x>=Lt||I.y<0||I.y>=Lt)continue;const P=(this.lookupDim-1)/Lt,M=this.lookupDim*(I.y*P|0)+I.x*P|0;if(this.lookup){if(this.lookup[M]!==0)continue;this.lookup[M]=1}this.instanceCount++;const L=v.length;v.resize(L+1),m.instancesEvaluatedElevation.push(0),v.float32[16*L]=I.x,v.float32[16*L+1]=I.y}return S.instancedDataCount=m.instancedDataArray.length-S.instancedDataOffset,S.instancedDataCount>0&&(e.id&&(m.idToFeaturesIndex[e.id]=m.features.length),m.features.push(S),this.evaluate(S,{},m,!1)),p}getModelUris(){return this.modelUris}evaluate(e,i,c,u){const p=this.layers[0],m=e.feature,v=this.canonical,S=e.rotation=p.paint.get("model-rotation").evaluate(m,i,v),T=e.scale=p.paint.get("model-scale").evaluate(m,i,v),I=e.translation=p.paint.get("model-translation").evaluate(m,i,v),P=p.paint.get("model-color").evaluate(m,i,v);P.a=p.paint.get("model-color-mix-intensity").evaluate(m,i,v);const M=[];this.maxVerticalOffset<I[2]&&(this.maxVerticalOffset=I[2]),this.maxScale=Math.max(Math.max(this.maxScale,T[0]),Math.max(T[1],T[2])),rk(M,S,T);const L=Math.round(100*P.a)+P.b/1.05;for(let O=0;O<e.instancedDataCount;++O){const G=e.instancedDataOffset+O,Z=16*G,Q=c.instancedDataArray.float32;let le=0;u&&(le=Q[Z+6]-c.instancesEvaluatedElevation[G]);const ce=0|Q[Z+1];Q[Z]=(0|Q[Z])+P.r/1.05,Q[Z+1]=ce+P.g/1.05,Q[Z+2]=L,Q[Z+3]=1/(v.z>10?this.tileToMeter:Xe(v,ce)),Q[Z+4]=I[0],Q[Z+5]=I[1],Q[Z+6]=I[2]+le,Q[Z+7]=M[0],Q[Z+8]=M[1],Q[Z+9]=M[2],Q[Z+10]=M[4],Q[Z+11]=M[5],Q[Z+12]=M[6],Q[Z+13]=M[8],Q[Z+14]=M[9],Q[Z+15]=M[10],c.instancesEvaluatedElevation[G]=I[2]}}}let lk,ck;Ht(mT,"ModelBucket",{omit:["layers"]}),Ht(ak,"PerModelAttributes"),Ht(ok,"ModelFeature");const Pf=64,Nm={CoordinateSpaceTile:1,HasMapboxMeshFeatures:4,HasMeshoptCompression:8};function uk(o,e,i,c,u,p,m,v,S,T=!1){const I=i.zoom,P=i.project(c),M=gt(c.lat,I),L=1/M;H(o),te(o,o,[P.x+m[0]*L,P.y+m[1]*L,m[2]]);let O=1,G=1;const Z=i.worldSize;if(T){if(i.projection.name==="mercator"){let q=0;i.elevation&&(q=i.elevation.getAtPointOrZero(new Re(P.x/Z,P.y/Z),0));const re=ut([],[P.x,P.y,q,1],i.projMatrix)[3]/i.cameraToCenterDistance;O=re,G=re*gt(i.center.lat,I)}else if(i.projection.name==="globe"){const q=fT(o,i),re=[0,0,0,1];ut(re,re,Y([],i.projMatrix,q));const ue=re[3]/i.cameraToCenterDistance,pe=pd(I),Ae=i.projection.pixelsPerMeter(c.lat,Z)*gt(c.lat,I),Te=i.projection.pixelsPerMeter(i.center.lat,Z)*gt(i.center.lat,I);O=ue/vn(Ae,it(i.center.lat),pe),G=ue*M/Ae,O*=Te,G*=Te}}else O=L;de(o,o,[O,O,G]);const Q=[...o],le=e.orientation,ce=[];if(rk(ce,[le[0]+u[0],le[1]+u[1],le[2]+u[2]],p),Y(o,Q,ce),v&&i.elevation){let q=0;const re=[];if(S&&i.elevation){q=function(pe,Ae,Te,Ie,Ne){const Ke=Ae.elevation;if(!Ke)return 0;const yt=gr.projectAabbCorners(Te,Ie),at=Se(1,Ne.lat)*Ae.worldSize,_t=function(wt,Pn){const Yt=[0,0,1],Jt=[{corners:[0,1,3,2],dotProductWithUp:0},{corners:[1,5,2,6],dotProductWithUp:0},{corners:[0,4,1,5],dotProductWithUp:0},{corners:[2,6,3,7],dotProductWithUp:0},{corners:[4,7,5,6],dotProductWithUp:0},{corners:[0,3,4,7],dotProductWithUp:0}];for(const xn of Jt){const zn=wt[xn.corners[0]],Nn=wt[xn.corners[1]],Xn=wt[xn.corners[2]],Vn=[Nn[0]-zn[0],Nn[1]-zn[1],Pn*(Nn[2]-zn[2])],Yn=an(Vn,Vn,[Xn[0]-zn[0],Xn[1]-zn[1],Pn*(Xn[2]-zn[2])]);Hn(Yn,Yn),xn.dotProductWithUp=rn(Yn,Yt)}return Jt.sort((xn,zn)=>xn.dotProductWithUp-zn.dotProductWithUp),Jt[0].corners}(yt,at),xt=yt[_t[0]],et=yt[_t[1]],pt=yt[_t[2]],Ze=yt[_t[3]],Qe=Ke.getAtPointOrZero(new Re(xt[0]/Ae.worldSize,xt[1]/Ae.worldSize),0),St=Ke.getAtPointOrZero(new Re(et[0]/Ae.worldSize,et[1]/Ae.worldSize),0),Et=Ke.getAtPointOrZero(new Re(pt[0]/Ae.worldSize,pt[1]/Ae.worldSize),0),ln=Ke.getAtPointOrZero(new Re(Ze[0]/Ae.worldSize,Ze[1]/Ae.worldSize),0),Kt=(Qe+ln)/2,Ot=(St+Et)/2;return Kt>Ot?St<Et?P1(pe,et,Ze,xt,St,ln,Qe,at):P1(pe,pt,xt,Ze,Et,Qe,ln,at):Qe<ln?P1(pe,xt,et,pt,Qe,St,Et,at):P1(pe,Ze,pt,et,ln,Et,St,at),Math.max(Kt,Ot)}(re,i,e.aabb,o,c);const ue=Y([],vt([],re),ce);Y(o,Q,ue)}else q=i.elevation.getAtPointOrZero(new Re(P.x/Z,P.y/Z),0);q!==0&&(o[14]+=q)}}function Gy(o,e,i=!1){o.uploaded||(o.gfxTexture=new uT(e,o.image,i?e.gl.R8:e.gl.RGBA8,{useMipmap:o.sampler.minFilter>=e.gl.NEAREST_MIPMAP_NEAREST}),o.uploaded=!0,o.image=null)}function EU(o,e,i){o.indexBuffer=e.createIndexBuffer(o.indexArray,!1,!0),o.vertexBuffer=e.createVertexBuffer(o.vertexArray,yU.members,!1,!0),o.normalArray&&(o.normalBuffer=e.createVertexBuffer(o.normalArray,wU.members,!1,!0)),o.texcoordArray&&(o.texcoordBuffer=e.createVertexBuffer(o.texcoordArray,bU.members,!1,!0)),o.colorArray&&(o.colorBuffer=e.createVertexBuffer(o.colorArray,(o.colorArray.bytesPerElement===12?vU:xU).members,!1,!0)),o.featureArray&&(o.pbrBuffer=e.createVertexBuffer(o.featureArray,TU.members,!0)),o.segments=Ai.simpleSegment(0,0,o.vertexArray.length,o.indexArray.length);const c=o.material;c.pbrMetallicRoughness.baseColorTexture&&Gy(c.pbrMetallicRoughness.baseColorTexture,e),c.pbrMetallicRoughness.metallicRoughnessTexture&&Gy(c.pbrMetallicRoughness.metallicRoughnessTexture,e),c.normalTexture&&Gy(c.normalTexture,e),c.occlusionTexture&&Gy(c.occlusionTexture,e,i),c.emissionTexture&&Gy(c.emissionTexture,e)}function gT(o,e,i){if(o.meshes)for(const c of o.meshes)EU(c,e,i);if(o.children)for(const c of o.children)gT(c,e,i)}function R1(o){if(o.meshes)for(const e of o.meshes)e.indexArray.destroy(),e.vertexArray.destroy(),e.colorArray&&e.colorArray.destroy(),e.normalArray&&e.normalArray.destroy(),e.texcoordArray&&e.texcoordArray.destroy(),e.featureArray&&e.featureArray.destroy();if(o.children)for(const e of o.children)R1(e)}function _T(o){if(o.meshes)for(const i of o.meshes)i.vertexBuffer&&(i.vertexBuffer.destroy(),i.indexBuffer.destroy(),i.normalBuffer&&i.normalBuffer.destroy(),i.texcoordBuffer&&i.texcoordBuffer.destroy(),i.colorBuffer&&i.colorBuffer.destroy(),i.pbrBuffer&&i.pbrBuffer.destroy(),i.segments.destroy(),i.material&&((e=i.material).pbrMetallicRoughness.baseColorTexture&&e.pbrMetallicRoughness.baseColorTexture.gfxTexture&&e.pbrMetallicRoughness.baseColorTexture.gfxTexture.destroy(),e.pbrMetallicRoughness.metallicRoughnessTexture&&e.pbrMetallicRoughness.metallicRoughnessTexture.gfxTexture&&e.pbrMetallicRoughness.metallicRoughnessTexture.gfxTexture.destroy(),e.normalTexture&&e.normalTexture.gfxTexture&&e.normalTexture.gfxTexture.destroy(),e.emissionTexture&&e.emissionTexture.gfxTexture&&e.emissionTexture.gfxTexture.destroy(),e.occlusionTexture&&e.occlusionTexture.gfxTexture&&e.occlusionTexture.gfxTexture.destroy()));var e;if(o.children)for(const i of o.children)_T(i)}class zm{constructor(e,i,c){this._demTile=e,this._dem=this._demTile.dem,this._scale=i,this._offset=c}static create(e,i,c){const u=c||e.findDEMTileFor(i);if(!u||!u.dem)return;const p=u.dem,m=u.tileID,v=1<<i.canonical.z-m.canonical.z;return new zm(u,p.dim/Lt/v,[(i.canonical.x/v-m.canonical.x)*p.dim,(i.canonical.y/v-m.canonical.y)*p.dim])}tileCoordToPixel(e,i){const c=i*this._scale+this._offset[1],u=Math.floor(e*this._scale+this._offset[0]),p=Math.floor(c);return new Dt(u,p)}getElevationAt(e,i,c,u){const p=e*this._scale+this._offset[0],m=i*this._scale+this._offset[1],v=Math.floor(p),S=Math.floor(m),T=this._dem;return u=!!u,c?vn(vn(T.get(v,S,u),T.get(v,S+1,u),m-S),vn(T.get(v+1,S,u),T.get(v+1,S+1,u),m-S),p-v):T.get(v,S,u)}getElevationAtPixel(e,i,c){return this._dem.get(e,i,!!c)}getMeterToDEM(e){return(1<<this._demTile.tileID.canonical.z)*Se(1,e)*this._dem.stride}}const yT=new Float32Array(262144),Mf=new Uint8Array(262144);function dk(o){let e=0;if(o.meshes)for(const i of o.meshes)e=Math.max(e,i.aabb.max[2]);if(o.children)for(const i of o.children)e=Math.max(e,dk(i));return e}function hk(o,e,i){if(o.meshes)for(const c of o.meshes){if(c.aabb.min[0]===1/0)continue;const u=gr.applyTransform(c.aabb,o.matrix);i.insert(e,u.min[0],u.min[1],u.max[0],u.max[1])}if(o.children)for(const c of o.children)hk(c,e,i)}const fk=["","wall","door","roof","window","lamp","logo"];class pk{constructor(e){this.node=e,this.evaluatedRMEA=[[1,0,0,1],[1,0,0,1],[1,0,0,1],[1,0,0,1],[.4,1,0,1],[1,0,0,1],[1,0,0,1]],this.hiddenByReplacement=!1,this.evaluatedTranslation=[0,0,0],this.evaluatedScale=[1,1,1],this.evaluatedColor=[],this.emissionHeightBasedParams=[],this.cameraCollisionOpacity=1,this.feature={type:"Point",id:e.id,geometry:[],properties:{height:dk(e)}},this.aabb=this._getLocalBounds(),this.state=null}_getLocalBounds(){if(!this.node.meshes)return new gr([1/0,1/0,1/0],[-1/0,-1/0,-1/0]);if(!this.aabb){let e=0;const i=new gr([1/0,1/0,1/0],[-1/0,-1/0,-1/0]);for(const c of this.node.meshes)this.node.lightMeshIndex!==e&&(c.transformedAabb=gr.applyTransformFast(c.aabb,this.node.matrix),i.encapsulate(c.transformedAabb)),e++;this.aabb=i}return this.aabb}}class k1{constructor(e,i,c,u,p,m,v,S){this.id=c,this.layers=e,this.layerIds=this.layers.map(T=>T.fqid),this.stateDependentLayerIds=this.layers.filter(T=>T.isStateDependent()).map(T=>T.id),this.modelTraits|=Nm.CoordinateSpaceTile,this.uploaded=!1,this.hasPattern=!1,u&&(this.modelTraits|=Nm.HasMapboxMeshFeatures),p&&(this.modelTraits|=Nm.HasMeshoptCompression),this.zoom=-1,this.terrainExaggeration=1,this.projection={name:"mercator"},this.replacementUpdateTime=0,this.elevationReadFromZ=255,this.brightness=m,this.worldview=S,this.dirty=!0,this.needsUpload=!1,this.filter=null,this.nodesInfo=[];for(const T of i)this.nodesInfo.push(new pk(T)),hk(T,v.featureIndexArray.length,v.grid),v.featureIndexArray.emplaceBack(this.nodesInfo.length-1,0,v.bucketLayerIDs.length-1,0);this.states={}}updateFootprints(e,i){for(const c of this.getNodesInfo()){const u=c.node;u.footprint&&i.push({footprint:u.footprint,id:e})}}update(e){const i=Object.keys(e).length!==0;if(i&&!this.stateDependentLayers.length)return;const c=i?this.stateDependentLayers:this.layers;if(!rl(e,this.states))for(const u of c)this.evaluate(u,e);this.states=structuredClone(e)}populate(){console.log("populate 3D model bucket")}uploadPending(){return!this.uploaded||this.needsUpload}upload(e){if(!this.needsUpload)return;const i=this.getNodesInfo();for(const c of i){const u=c.node;this.uploaded?this.updatePbrBuffer(u):gT(u,e,!0)}for(const c of i)R1(c.node);this.uploaded=!0,this.needsUpload=!1}updatePbrBuffer(e){let i=!1;if(!e.meshes)return i;for(const c of e.meshes)c.pbrBuffer&&(c.pbrBuffer.updateData(c.featureArray),i=!0);return i}needsReEvaluation(e,i,c){const u=e.transform.projectionOptions,p=e.style.getBrightness(),m=this.brightness!==p;if(!this.uploaded||this.dirty||u.name!==this.projection.name||Hy(c.paint.get("model-color").value,m)||Hy(c.paint.get("model-color-mix-intensity").value,m)||Hy(c.paint.get("model-roughness").value,m)||Hy(c.paint.get("model-emissive-strength").value,m)||Hy(c.paint.get("model-height-based-emissive-strength-multiplier").value,m)){this.projection=u,this.brightness=p;const v=this.getNodesInfo();for(const S of v)S.state=null;return!0}return!1}evaluateTransform(e,i){if(e.transform.zoom===this.zoom)return;this.zoom=e.transform.zoom;const c=this.getNodesInfo(),u=this.id.canonical;for(const p of c){const m=p.feature;p.evaluatedTranslation=i.paint.get("model-translation").evaluate(m,{},u),p.evaluatedScale=i.paint.get("model-scale").evaluate(m,{},u)}}evaluate(e,i){const c=this.getNodesInfo();for(const u of c){if(!u.node.meshes)continue;const p=u.feature,m=i&&i[p.id];if(rl(m,u.state))continue;u.state=structuredClone(m);const v=u.node.meshes&&u.node.meshes[0].featureData,S=u.evaluatedColor[2],T=u.evaluatedRMEA[2],I=this.id.canonical;if(u.hasTranslucentParts=!1,v){for(let P=0;P<fk.length;P++){const M=fk[P];M.length&&(p.properties.part=M);const L=e.paint.get("model-color").evaluate(p,m,I).toPremultipliedRenderColor(null),O=e.paint.get("model-color-mix-intensity").evaluate(p,m,I);u.evaluatedColor[P]=[L.r,L.g,L.b,O],u.evaluatedRMEA[P][0]=e.paint.get("model-roughness").evaluate(p,m,I),u.evaluatedRMEA[P][2]=e.paint.get("model-emissive-strength").evaluate(p,m,I),u.evaluatedRMEA[P][3]=L.a,u.emissionHeightBasedParams[P]=e.paint.get("model-height-based-emissive-strength-multiplier").evaluate(p,m,I),!u.hasTranslucentParts&&L.a<1&&(u.hasTranslucentParts=!0)}delete p.properties.part,AU(u,S!==u.evaluatedColor[2]||T!==u.evaluatedRMEA[2],this.modelTraits)}else u.evaluatedRMEA[0][2]=e.paint.get("model-emissive-strength").evaluate(p,m,I);u.evaluatedTranslation=e.paint.get("model-translation").evaluate(p,m,I),u.evaluatedScale=e.paint.get("model-scale").evaluate(p,m,I),this.updatePbrBuffer(u.node)||(this.needsUpload=!0)}this.dirty=!1}elevationUpdate(e,i,c,u){const p=e.findDEMTileFor(c);if(p&&(p.tileID.canonical!==this.terrainTile||i!==this.terrainExaggeration)){if(p.dem&&p.tileID.overscaledZ!==this.elevationReadFromZ){this.elevationReadFromZ=p.tileID.overscaledZ;const m=zm.create(e,c,p);if(!m)return;this.modelTraits&Nm.HasMapboxMeshFeatures&&this.updateDEM(e,m,c,u);for(const v of this.getNodesInfo()){const S=v.node;if(!S.footprint||!S.footprint.vertices||!S.footprint.vertices.length)continue;const T=S.footprint.vertices;let I=m.getElevationAt(T[0].x,T[0].y,!0,!0);for(let P=1;P<T.length;P++)I=Math.min(I,m.getElevationAt(T[P].x,T[P].y,!0,!0));S.elevation=I}}this.terrainTile=p.tileID.canonical,this.terrainExaggeration=i}}updateDEM(e,i,c,u){let p=i._dem._modifiedForSources[u];if(p===void 0&&(i._dem._modifiedForSources[u]=[],p=i._dem._modifiedForSources[u]),p.includes(c.canonical))return;const m=i._dem.dim;p.push(c.canonical);let v=!1;for(const S of this.getNodesInfo()){const T=S.node;if(!T.footprint||!T.footprint.grid)continue;const I=T.footprint.grid,P=i.tileCoordToPixel(I.min.x,I.min.y),M=i.tileCoordToPixel(I.max.x,I.max.y),L=Math.min(Math.min(m-M.y,P.x),Math.min(P.y,m-M.x));if(L<0)continue;const O=xe(L,2,5);let G=Math.max(0,P.x-O),Z=Math.max(0,P.y-O),Q=Math.min(M.x+O,m-1),le=Math.min(M.y+O,m-1);for(let ue=Z;ue<=le;++ue)for(let pe=G;pe<=Q;++pe)Mf[ue*m+pe]=255;let ce=0,q=0;for(let ue=0;ue<I.cellsY;++ue)for(let pe=0;pe<I.cellsX;++pe){if(!I.cells[ue*I.cellsX+pe])continue;const Ae=i.tileCoordToPixel(I.min.x+pe/I.xScale,I.min.y+ue/I.yScale),Te=i.tileCoordToPixel(I.min.x+(pe+1)/I.xScale,I.min.y+(ue+1)/I.yScale);for(let Ie=Ae.y;Ie<=Math.min(Te.y+1,m-1);++Ie)for(let Ne=Ae.x;Ne<=Math.min(Te.x+1,m-1);++Ne)Mf[Ie*m+Ne]===255&&(Mf[Ie*m+Ne]=0,ce+=i.getElevationAtPixel(Ne,Ie),q++)}const re=ce/q;G=Math.max(1,P.x-O),Z=Math.max(1,P.y-O),Q=Math.min(M.x+O,m-2),le=Math.min(M.y+O,m-2),v=!0;for(let ue=Z;ue<=le;++ue)for(let pe=G;pe<=Q;++pe)Mf[ue*m+pe]===0&&(yT[ue*m+pe]=i._dem.set(pe,ue,re));for(let ue=1;ue<O;++ue){G=Math.max(1,P.x-ue),Z=Math.max(1,P.y-ue),Q=Math.min(M.x+ue,m-2),le=Math.min(M.y+ue,m-2);for(let pe=Z;pe<=le;++pe)for(let Ae=G;Ae<=Q;++Ae){const Te=pe*m+Ae;if(Mf[Te]===255){let Ie=0,Ne=0,Ke=-1,yt=-1;for(let at=-1;at<=1;++at)for(let _t=-1;_t<=1;++_t){const xt=(pe+at)*m+Ae+_t;if(Mf[xt]>=ue)continue;const et=yT[xt],pt=Math.abs(et);pt>Ne&&(Ie=et,Ne=pt,Ke=_t,yt=at)}if(Ne>.1){const at=1-(ue+.5*Math.abs(Ke*yt))/O;let _t=i._dem.get(Ae,pe)+Ie*at;const xt=i._dem.get(Ae+Ke,pe+yt),et=i._dem.get(Ae-Ke,pe-yt,!0);(_t-xt)*(_t-et)>0&&(_t=(xt+et)/2),yT[Te]=i._dem.set(Ae,pe,_t),Mf[Te]=ue}}}}}v&&(i._demTile.needsDEMTextureUpload=!0,i._dem._timestamp=pa.now())}setFilter(e){this.filter=e?K_(e):null}getNodesInfo(){return this.filter?this.nodesInfo.filter(e=>this.filter.filter(new Fr(this.id.overscaledZ,{worldview:this.worldview}),e.feature,this.id.canonical)):this.nodesInfo}destroy(){const e=this.getNodesInfo();for(const i of e)R1(i.node),_T(i.node)}isEmpty(){return!this.nodesInfo.length}updateReplacement(e,i){if(i.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=i.updateTime;const c=i.getReplacementRegionsForTile(e.toUnwrapped());for(const u of this.getNodesInfo()){const p=u.node.footprint;u.hiddenByReplacement=!!p&&!c.find(m=>m.footprint===p)}}getHeightAtTileCoord(e,i){const c=[],u=[0,0,0],p=H([]);for(const m of this.getNodesInfo()){const v=m.node.meshes[0],S=v.transformedAabb;if(e<S.min[0]||i<S.min[1]||e>S.max[0]||i>S.max[1])continue;if(m.node.hidden===!0)return{height:1/0,maxHeight:m.feature.properties.height,hidden:!1,verticalScale:m.evaluatedScale[2]};ne(p,m.node.matrix),u[0]=e,u[1]=i,Mn(u,u,p);const T=(u[0]-v.aabb.min[0])/(v.aabb.max[0]-v.aabb.min[0])*Pf|0,I=Math.min(63,(u[1]-v.aabb.min[1])/(v.aabb.max[1]-v.aabb.min[1])*Pf|0)*Pf+Math.min(63,T),P=v.heightmap[I];if(!(P<0&&m.node.footprint))return m.hiddenByReplacement?void 0:{height:P,maxHeight:m.feature.properties.height,hidden:!1,verticalScale:m.evaluatedScale[2]};if(m.node.footprint.grid.query(new Dt(e,i),new Dt(e,i),c),c.length>0)return{height:void 0,maxHeight:m.feature.properties.height,hidden:m.hiddenByReplacement,verticalScale:m.evaluatedScale[2]}}}}function Hy(o,e){return o instanceof tf&&!o.isLightConstant&&e}function CU(o,e,i,c,u,p,m,v){let S=(61440&e|(61440&e)>>4)>>8,T=(3840&e|(3840&e)>>4)>>4,I=240&e|(240&e)>>4;i[3]>0&&(S=vn(S,255*i[0],i[3]),T=vn(T,255*i[1],i[3]),I=vn(I,255*i[2],i[3]));const P=S<<8|T,M=I<<8|Math.floor(255*c[3]),L=function(ue){const pe=xe(ue,0,2);return Math.min(Math.round(.5*pe*255),255)}(c[2])<<8|15*c[0]<<4|15*c[1],O=xe(u[0],0,1),G=xe(u[1],0,1),Z=xe(u[2],0,1),Q=xe(u[3],0,1);let le,ce,q,re;if(O!==G&&m!==p&&G!==O){const ue=m-p;ce=1/(ue*(G-O)),q=-(p+ue*O)/(ue*(G-O));const pe=xe(u[4],-1,1);re=Math.pow(10,pe),le=255*Z<<8|255*Q}else le=65535,ce=0,q=1,re=1;if(o.emplaceBack(P,M,L,le,ce,q,re),v){const ue=v.length;v.clear();for(let pe=0;pe<ue;pe++)v.emplaceBack(P,M,L,le,ce,q,re)}}function AU(o,e,i){const c=o.node;let u=0;const p=i&Nm.HasMeshoptCompression;for(const m of c.meshes){if(c.lights&&c.lightMeshIndex===u||!m.featureData)continue;m.featureArray=new pf,m.featureArray.reserve(m.featureData.length);let v=e;for(const S of m.featureData){const T=p?65535&S:S>>16&65535,I=p?S>>16&65535:65535&S,P=(15&I)<8?15&I:0,M=o.evaluatedRMEA[P],L=o.evaluatedColor[P],O=o.emissionHeightBasedParams[P];let G;if(v&&P===2&&c.lights&&(G=new pf,G.resize(10*c.lights.length)),CU(m.featureArray,T,L,M,O,m.aabb.min[2],m.aabb.max[2],G),G&&v){v=!1;const Z=c.meshes[c.lightMeshIndex];Z.featureArray=G,Z.featureArray._trim()}}m.featureArray._trim(),u++}}function mk(o,e,i,c){const u=1<<o.z;e.lat=Fe((c/Lt+o.y)/u),e.lng=Ee((i/Lt+o.x)/u)}function IU(o,e,i,c){const u=o.getNodesInfo()[e];if(!u||u.hiddenByReplacement||!u.node.meshes)return;let p=Number.MAX_VALUE;const m=u.node,v=i.tile,S=c.calculatePosMatrix(v.tileID.toUnwrapped(),c.worldSize),T=u.evaluatedScale;let I=0;c.elevation&&m.elevation&&(I=m.elevation*c.elevation.exaggeration()),te(S,S,[(m.anchor?m.anchor[0]:0)*(T[0]-1),(m.anchor?m.anchor[1]:0)*(T[1]-1),I]),de(S,S,T);const P=i.queryGeometry,M=P.isPointQuery()?P.screenBounds:P.screenGeometry,L=function(G){const Z=Y([],S,G.matrix);Y(Z,c.expandedFarZProjMatrix,Z);for(let Q=0;Q<G.meshes.length;++Q){const le=G.meshes[Q];if(Q===G.lightMeshIndex)continue;const ce=ik(M,c,Z,le.aabb);ce!=null&&(p=Math.min(ce,p))}if(G.children)for(const Q of G.children)L(Q)};if(L(m),p===Number.MAX_VALUE)return;const O=new ie(0,0);return mk(v.tileID.canonical,O,u.node.anchor[0],u.node.anchor[1]),{intersectionZ:p,position:O,feature:u.feature}}Ht(k1,"Tiled3dModelBucket",{omit:["layers"]}),Ht(pk,"Tiled3dModelFeature");const PU={circle:class extends Bs{constructor(o,e,i,c){super(o,{layout:fP||(fP=new Ti({"circle-sort-key":new Bt(Oe.layout_circle["circle-sort-key"]),"circle-elevation-reference":new bt(Oe.layout_circle["circle-elevation-reference"]),visibility:new bt(Oe.layout_circle.visibility)})),paint:pP||(pP=new Ti({"circle-radius":new Bt(Oe.paint_circle["circle-radius"]),"circle-color":new Bt(Oe.paint_circle["circle-color"]),"circle-blur":new Bt(Oe.paint_circle["circle-blur"]),"circle-opacity":new Bt(Oe.paint_circle["circle-opacity"]),"circle-translate":new bt(Oe.paint_circle["circle-translate"]),"circle-translate-anchor":new bt(Oe.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new bt(Oe.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new bt(Oe.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new Bt(Oe.paint_circle["circle-stroke-width"]),"circle-stroke-color":new Bt(Oe.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new Bt(Oe.paint_circle["circle-stroke-opacity"]),"circle-emissive-strength":new bt(Oe.paint_circle["circle-emissive-strength"]),"circle-color-use-theme":new Bt({type:"string",default:"default","property-type":"data-driven"}),"circle-stroke-color-use-theme":new Bt({type:"string",default:"default","property-type":"data-driven"})}))},e,i,c)}createBucket(o){return new ra(o)}queryRadius(o){const e=o;return Tm("circle-radius",this,e)+Tm("circle-stroke-width",this,e)+G0(this.paint.get("circle-translate"))}queryIntersectsFeature(o,e,i,c,u,p,m,v){const S=hP(this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),p.angle,o.pixelToTileUnitsFactor),T=this.paint.get("circle-radius").evaluate(e,i)+this.paint.get("circle-stroke-width").evaluate(e,i);return AP(o,c,p,m,v,this.paint.get("circle-pitch-alignment")==="map",this.paint.get("circle-pitch-scale")==="map",S,T)}getProgramIds(){return["circle"]}getDefaultProgramParams(o,e,i){const c=CP(this);return{config:new dd(this,{zoom:e,lut:i}),defines:c,overrideFog:!1}}is3D(o){return!o&&!!this.layout&&this.layout.get("circle-elevation-reference")!=="none"}hasElevation(){return this.layout&&this.layout.get("circle-elevation-reference")!=="none"}},heatmap:class extends Bs{createBucket(o){return new PP(o)}constructor(o,e,i,c){super(o,{layout:MP||(MP=new Ti({visibility:new bt(Oe.layout_heatmap.visibility)})),paint:RP||(RP=new Ti({"heatmap-radius":new Bt(Oe.paint_heatmap["heatmap-radius"]),"heatmap-weight":new Bt(Oe.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new bt(Oe.paint_heatmap["heatmap-intensity"]),"heatmap-color":new iu(Oe.paint_heatmap["heatmap-color"]),"heatmap-opacity":new bt(Oe.paint_heatmap["heatmap-opacity"]),"heatmap-color-use-theme":new Bt({type:"string",default:"default","property-type":"data-driven"})}))},e,i,c),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(o){o==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=vy({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(o){return Tm("heatmap-radius",this,o)}queryIntersectsFeature(o,e,i,c,u,p,m,v){const S=this.paint.get("heatmap-radius").evaluate(e,i);return AP(o,c,p,m,v,!0,!0,new Dt(0,0),S)}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}getProgramIds(){return["heatmap","heatmapTexture"]}getDefaultProgramParams(o,e,i){return o==="heatmap"?{config:new dd(this,{zoom:e,lut:i}),overrideFog:!1}:{}}},hillshade:class extends Bs{constructor(o,e,i,c){super(o,{layout:kP||(kP=new Ti({visibility:new bt(Oe.layout_hillshade.visibility)})),paint:DP||(DP=new Ti({"hillshade-illumination-direction":new bt(Oe.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new bt(Oe.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new bt(Oe.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new bt(Oe.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new bt(Oe.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new bt(Oe.paint_hillshade["hillshade-accent-color"]),"hillshade-emissive-strength":new bt(Oe.paint_hillshade["hillshade-emissive-strength"]),"hillshade-shadow-color-use-theme":new Bt({type:"string",default:"default","property-type":"data-driven"}),"hillshade-highlight-color-use-theme":new Bt({type:"string",default:"default","property-type":"data-driven"}),"hillshade-accent-color-use-theme":new Bt({type:"string",default:"default","property-type":"data-driven"})}))},e,i,c)}shouldRedrape(){return this.hasOffscreenPass()&&this.paint.get("hillshade-illumination-anchor")==="viewport"}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}getProgramIds(){return["hillshade","hillshadePrepare"]}getDefaultProgramParams(o,e,i){return{overrideFog:!1}}},fill:class extends Bs{constructor(o,e,i,c){super(o,{layout:ZP||(ZP=new Ti({"fill-sort-key":new Bt(Oe.layout_fill["fill-sort-key"]),visibility:new bt(Oe.layout_fill.visibility),"fill-elevation-reference":new bt(Oe.layout_fill["fill-elevation-reference"]),"fill-construct-bridge-guard-rail":new Bt(Oe.layout_fill["fill-construct-bridge-guard-rail"])})),paint:XP||(XP=new Ti({"fill-antialias":new bt(Oe.paint_fill["fill-antialias"]),"fill-opacity":new Bt(Oe.paint_fill["fill-opacity"]),"fill-color":new Bt(Oe.paint_fill["fill-color"]),"fill-outline-color":new Bt(Oe.paint_fill["fill-outline-color"]),"fill-translate":new bt(Oe.paint_fill["fill-translate"]),"fill-translate-anchor":new bt(Oe.paint_fill["fill-translate-anchor"]),"fill-pattern":new Bt(Oe.paint_fill["fill-pattern"]),"fill-pattern-cross-fade":new bt(Oe.paint_fill["fill-pattern-cross-fade"]),"fill-emissive-strength":new bt(Oe.paint_fill["fill-emissive-strength"]),"fill-z-offset":new Bt(Oe.paint_fill["fill-z-offset"]),"fill-bridge-guard-rail-color":new Bt(Oe.paint_fill["fill-bridge-guard-rail-color"]),"fill-tunnel-structure-color":new Bt(Oe.paint_fill["fill-tunnel-structure-color"]),"fill-color-use-theme":new Bt({type:"string",default:"default","property-type":"data-driven"}),"fill-outline-color-use-theme":new Bt({type:"string",default:"default","property-type":"data-driven"}),"fill-bridge-guard-rail-color-use-theme":new Bt({type:"string",default:"default","property-type":"data-driven"}),"fill-tunnel-structure-color-use-theme":new Bt({type:"string",default:"default","property-type":"data-driven"})}))},e,i,c)}getProgramIds(){const o=this.paint.get("fill-pattern"),e=o&&o.constantOr(1),i=[e?"fillPattern":"fill"];return this.paint.get("fill-antialias")&&i.push(e&&!this.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline"),i}getDefaultProgramParams(o,e,i){return{config:new dd(this,{zoom:e,lut:i}),overrideFog:!1}}recalculate(o,e){super.recalculate(o,e);const i=this.paint._values["fill-outline-color"];i.value.kind==="constant"&&i.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(o){return new PS(o)}queryRadius(){return G0(this.paint.get("fill-translate"))}queryIntersectsFeature(o,e,i,c,u,p){return!o.queryGeometry.isAboveHorizon&&ba(dP(o.tilespaceGeometry,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),p.angle,o.pixelToTileUnitsFactor),c)}isTileClipped(){return this.paint.get("fill-z-offset").constantOr(1)===0}is3D(o){if(this.paint.get("fill-z-offset").constantOr(1)!==0)return!0;const e=this.layout&&this.layout.get("fill-elevation-reference")!=="none";return o!=null?e&&!o:e}hasElevation(){return this.layout&&this.layout.get("fill-elevation-reference")!=="none"}hasShadowPass(){return this.layout&&this.layout.get("fill-elevation-reference")!=="none"}},"fill-extrusion":class extends Bs{constructor(o,e,i,c){super(o,{layout:xM||(xM=new Ti({visibility:new bt(Oe["layout_fill-extrusion"].visibility),"fill-extrusion-edge-radius":new bt(Oe["layout_fill-extrusion"]["fill-extrusion-edge-radius"])})),paint:bM||(bM=new Ti({"fill-extrusion-opacity":new bt(Oe["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new Bt(Oe["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new bt(Oe["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new bt(Oe["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new Bt(Oe["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-pattern-cross-fade":new bt(Oe["paint_fill-extrusion"]["fill-extrusion-pattern-cross-fade"]),"fill-extrusion-height":new Bt(Oe["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new Bt(Oe["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-height-alignment":new bt(Oe["paint_fill-extrusion"]["fill-extrusion-height-alignment"]),"fill-extrusion-base-alignment":new bt(Oe["paint_fill-extrusion"]["fill-extrusion-base-alignment"]),"fill-extrusion-vertical-gradient":new bt(Oe["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"]),"fill-extrusion-ambient-occlusion-intensity":new bt(Oe["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-intensity"]),"fill-extrusion-ambient-occlusion-radius":new bt(Oe["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-radius"]),"fill-extrusion-ambient-occlusion-wall-radius":new bt(Oe["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-wall-radius"]),"fill-extrusion-ambient-occlusion-ground-radius":new bt(Oe["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-ground-radius"]),"fill-extrusion-ambient-occlusion-ground-attenuation":new bt(Oe["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-ground-attenuation"]),"fill-extrusion-flood-light-color":new bt(Oe["paint_fill-extrusion"]["fill-extrusion-flood-light-color"]),"fill-extrusion-flood-light-intensity":new bt(Oe["paint_fill-extrusion"]["fill-extrusion-flood-light-intensity"]),"fill-extrusion-flood-light-wall-radius":new Bt(Oe["paint_fill-extrusion"]["fill-extrusion-flood-light-wall-radius"]),"fill-extrusion-flood-light-ground-radius":new Bt(Oe["paint_fill-extrusion"]["fill-extrusion-flood-light-ground-radius"]),"fill-extrusion-flood-light-ground-attenuation":new bt(Oe["paint_fill-extrusion"]["fill-extrusion-flood-light-ground-attenuation"]),"fill-extrusion-vertical-scale":new bt(Oe["paint_fill-extrusion"]["fill-extrusion-vertical-scale"]),"fill-extrusion-rounded-roof":new bt(Oe["paint_fill-extrusion"]["fill-extrusion-rounded-roof"]),"fill-extrusion-cutoff-fade-range":new bt(Oe["paint_fill-extrusion"]["fill-extrusion-cutoff-fade-range"]),"fill-extrusion-emissive-strength":new Bt(Oe["paint_fill-extrusion"]["fill-extrusion-emissive-strength"]),"fill-extrusion-line-width":new Bt(Oe["paint_fill-extrusion"]["fill-extrusion-line-width"]),"fill-extrusion-cast-shadows":new bt(Oe["paint_fill-extrusion"]["fill-extrusion-cast-shadows"]),"fill-extrusion-color-use-theme":new Bt({type:"string",default:"default","property-type":"data-driven"}),"fill-extrusion-flood-light-color-use-theme":new Bt({type:"string",default:"default","property-type":"data-driven"})}))},e,i,c),this._stats={numRenderedVerticesInShadowPass:0,numRenderedVerticesInTransparentPass:0}}createBucket(o){return new r1(o)}queryRadius(){return G0(this.paint.get("fill-extrusion-translate"))}is3D(o){return!0}hasShadowPass(){return this.paint.get("fill-extrusion-cast-shadows")}cutoffRange(){return this.paint.get("fill-extrusion-cutoff-fade-range")}canCastShadows(){return!0}getProgramIds(){return[this.paint.get("fill-extrusion-pattern").constantOr(1)?"fillExtrusionPattern":"fillExtrusion"]}queryIntersectsFeature(o,e,i,c,u,p,m,v,S){const T=hP(this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),p.angle,o.pixelToTileUnitsFactor),I=this.paint.get("fill-extrusion-height").evaluate(e,i),P=this.paint.get("fill-extrusion-base").evaluate(e,i),M=[0,0],L=v&&p.elevation,O=p.elevation?p.elevation.exaggeration():1,G=o.tile.getBucket(this);if(L&&G instanceof r1){const q=G.centroidVertexArray,re=S+1;re<q.length&&(M[0]=q.geta_centroid_pos0(re),M[1]=q.geta_centroid_pos1(re))}if(M[0]===0&&M[1]===1)return!1;p.projection.name==="globe"&&(c=vM([c],[new Dt(0,0),new Dt(Lt,Lt)],o.tileID.canonical).map(q=>q.polygon).flat());const Z=L?v:null,[Q,le]=function(q,re,ue,pe,Ae,Te,Ie,Ne,Ke,yt,at){return q.projection.name==="globe"?function(_t,xt,et,pt,Ze,Qe,St,Et,ln,Kt,Ot){const wt=[],Pn=[],Yt=_t.projection.upVectorScale(Ot,_t.center.lat,_t.worldSize).metersToTile,Jt=[0,0,0,1],xn=[0,0,0,1],zn=(Xn,Vn,Yn,Ir)=>{Xn[0]=Vn,Xn[1]=Yn,Xn[2]=Ir,Xn[3]=1},Nn=yM();et>0&&(et+=Nn),pt+=Nn;for(const Xn of xt){const Vn=[],Yn=[];for(const Ir of Xn){const Yr=Ir.x+Ze.x,he=Ir.y+Ze.y,me=_t.projection.projectTilePoint(Yr,he,Ot),nt=_t.projection.upVector(Ot,Ir.x,Ir.y);let Rt=et,Ft=pt;if(St){const zt=AM(Yr,he,et,pt,St,Et,ln,Kt);Rt+=zt.base,Ft+=zt.top}et!==0?zn(Jt,me.x+nt[0]*Yt*Rt,me.y+nt[1]*Yt*Rt,me.z+nt[2]*Yt*Rt):zn(Jt,me.x,me.y,me.z),zn(xn,me.x+nt[0]*Yt*Ft,me.y+nt[1]*Yt*Ft,me.z+nt[2]*Yt*Ft),Mn(Jt,Jt,Qe),Mn(xn,xn,Qe),Vn.push(new Ef(Jt[0],Jt[1],Jt[2])),Yn.push(new Ef(xn[0],xn[1],xn[2]))}wt.push(Vn),Pn.push(Yn)}return[wt,Pn]}(q,re,ue,pe,Ae,Te,Ie,Ne,Ke,yt,at):Ie?function(_t,xt,et,pt,Ze,Qe,St,Et,ln){const Kt=[],Ot=[],wt=[0,0,0,1];for(const Pn of _t){const Yt=[],Jt=[];for(const xn of Pn){const zn=xn.x+pt.x,Nn=xn.y+pt.y,Xn=AM(zn,Nn,xt,et,Qe,St,Et,ln);wt[0]=zn,wt[1]=Nn,wt[2]=Xn.base,wt[3]=1,ut(wt,wt,Ze),wt[3]=Math.max(wt[3],1e-5);const Vn=new Ef(wt[0]/wt[3],wt[1]/wt[3],wt[2]/wt[3]);wt[0]=zn,wt[1]=Nn,wt[2]=Xn.top,wt[3]=1,ut(wt,wt,Ze),wt[3]=Math.max(wt[3],1e-5);const Yn=new Ef(wt[0]/wt[3],wt[1]/wt[3],wt[2]/wt[3]);Yt.push(Vn),Jt.push(Yn)}Kt.push(Yt),Ot.push(Jt)}return[Kt,Ot]}(re,ue,pe,Ae,Te,Ie,Ne,Ke,yt):function(_t,xt,et,pt,Ze){const Qe=[],St=[],Et=Ze[8]*xt,ln=Ze[9]*xt,Kt=Ze[10]*xt,Ot=Ze[11]*xt,wt=Ze[8]*et,Pn=Ze[9]*et,Yt=Ze[10]*et,Jt=Ze[11]*et;for(const xn of _t){const zn=[],Nn=[];for(const Xn of xn){const Vn=Xn.x+pt.x,Yn=Xn.y+pt.y,Ir=Ze[0]*Vn+Ze[4]*Yn+Ze[12],Yr=Ze[1]*Vn+Ze[5]*Yn+Ze[13],he=Ze[2]*Vn+Ze[6]*Yn+Ze[14],me=Ze[3]*Vn+Ze[7]*Yn+Ze[15],nt=Ir+Et,Rt=Yr+ln,Ft=he+Kt,zt=Math.max(me+Ot,1e-5),Xt=Ir+wt,yn=Yr+Pn,er=he+Yt,tr=Math.max(me+Jt,1e-5);zn.push(new Ef(nt/zt,Rt/zt,Ft/zt)),Nn.push(new Ef(Xt/tr,yn/tr,er/tr))}Qe.push(zn),St.push(Nn)}return[Qe,St]}(re,ue,pe,Ae,Te)}(p,c,P,I,T,m,Z,M,O,p.center.lat,o.tileID.canonical),ce=o.queryGeometry;return function(q,re,ue){let pe=1/0;ba(ue,re)&&(pe=CM(ue,re[0]));for(let Ae=0;Ae<re.length;Ae++){const Te=re[Ae],Ie=q[Ae];for(let Ne=0;Ne<Te.length-1;Ne++){const Ke=Te[Ne],yt=[Ke,Te[Ne+1],Ie[Ne+1],Ie[Ne],Ke];co(ue,yt)&&(pe=Math.min(pe,CM(ue,yt)))}}return pe!==1/0&&pe}(Q,le,ce.isPointQuery()?ce.screenBounds:ce.screenGeometry)}},building:class extends Bs{constructor(o,e,i,c){super(o,{layout:jM||(jM=new Ti({visibility:new bt(Oe.layout_building.visibility),"building-roof-shape":new Bt(Oe.layout_building["building-roof-shape"]),"building-height":new Bt(Oe.layout_building["building-height"]),"building-base":new Bt(Oe.layout_building["building-base"])})),paint:BM||(BM=new Ti({"building-opacity":new bt(Oe.paint_building["building-opacity"]),"building-ambient-occlusion-wall-intensity":new bt(Oe.paint_building["building-ambient-occlusion-wall-intensity"]),"building-ambient-occlusion-ground-intensity":new bt(Oe.paint_building["building-ambient-occlusion-ground-intensity"]),"building-ambient-occlusion-ground-radius":new bt(Oe.paint_building["building-ambient-occlusion-ground-radius"]),"building-ambient-occlusion-ground-attenuation":new bt(Oe.paint_building["building-ambient-occlusion-ground-attenuation"]),"building-vertical-scale":new bt(Oe.paint_building["building-vertical-scale"]),"building-cast-shadows":new bt(Oe.paint_building["building-cast-shadows"]),"building-color":new Bt(Oe.paint_building["building-color"]),"building-emissive-strength":new Bt(Oe.paint_building["building-emissive-strength"]),"building-color-use-theme":new Bt({type:"string",default:"default","property-type":"data-driven"})}))},e,i,c),this._stats={numRenderedVerticesInShadowPass:0,numRenderedVerticesInTransparentPass:0}}createBucket(o){return new FM(o)}},line:class extends Bs{constructor(o,e,i,c){const u=YM();super(o,u,e,i,c),u.layout&&(this.layout=new ru(u.layout)),this.gradientVersion=0,this.hasElevatedBuckets=!1,this.hasNonElevatedBuckets=!1}_handleSpecialPaintPropertyUpdate(o){if(o==="line-gradient"){const e=this._transitionablePaint._values["line-gradient"].value.expression;this.stepInterpolant=e._styleExpression&&e._styleExpression.expression instanceof Zh,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}widthExpression(){return this._transitionablePaint._values["line-width"].value.expression}recalculate(o,e){super.recalculate(o,e),this.paint._values["line-floorwidth"]=(()=>{if(Dy)return Dy;const i=YM();return Dy=new C6(i.paint.properties["line-width"].specification),Dy.useIntegerZoom=!0,Dy})().possiblyEvaluate(this._transitioningPaint._values["line-width"].value,o)}createBucket(o){return new US(o)}getProgramIds(){return[this.paint.get("line-pattern").constantOr(1)?"linePattern":"line"]}getDefaultProgramParams(o,e,i){const c=ZM(this);return{config:new dd(this,{zoom:e,lut:i}),defines:c,overrideFog:!1}}queryRadius(o){const e=o,i=KM(Tm("line-width",this,e),Tm("line-gap-width",this,e)),c=Tm("line-offset",this,e);return i/2+Math.abs(c)+G0(this.paint.get("line-translate"))}queryIntersectsFeature(o,e,i,c,u,p){if(o.queryGeometry.isAboveHorizon)return!1;const m=dP(o.tilespaceGeometry,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),p.angle,o.pixelToTileUnitsFactor),v=o.pixelToTileUnitsFactor/2*KM(this.paint.get("line-width").evaluate(e,i),this.paint.get("line-gap-width").evaluate(e,i)),S=this.paint.get("line-offset").evaluate(e,i);return S&&(c=function(T,I){const P=[],M=new Dt(0,0);for(let L=0;L<T.length;L++){const O=T[L],G=[];for(let Z=0;Z<O.length;Z++){const Q=O[Z],le=O[Z+1],ce=Z===0?M:Q.sub(O[Z-1])._unit()._perp(),q=Z===O.length-1?M:le.sub(Q)._unit()._perp(),re=ce._add(q)._unit();re._mult(1/(re.x*q.x+re.y*q.y)),G.push(re._mult(I)._add(Q))}P.push(G)}return P}(c,S*o.pixelToTileUnitsFactor)),function(T,I,P){for(let M=0;M<I.length;M++){const L=I[M];if(T.length>=3){for(let O=0;O<L.length;O++)if(Ua(T,L[O]))return!0}if(hc(T,L,P))return!0}return!1}(m,c,v)}isTileClipped(){return this.hasNonElevatedBuckets}isDraped(o){return!this.hasElevatedBuckets}hasElevation(){return this.layout&&this.layout.get("line-elevation-reference")!=="none"}},symbol:T1,background:class extends Bs{constructor(o,e,i,c){super(o,{layout:VR||(VR=new Ti({visibility:new bt(Oe.layout_background.visibility)})),paint:UR||(UR=new Ti({"background-pitch-alignment":new bt(Oe.paint_background["background-pitch-alignment"]),"background-color":new bt(Oe.paint_background["background-color"]),"background-pattern":new bt(Oe.paint_background["background-pattern"]),"background-opacity":new bt(Oe.paint_background["background-opacity"]),"background-emissive-strength":new bt(Oe.paint_background["background-emissive-strength"]),"background-color-use-theme":new Bt({type:"string",default:"default","property-type":"data-driven"})}))},e,i,c)}getProgramIds(){return[this.paint.get("background-pattern")?"backgroundPattern":"background"]}getDefaultProgramParams(o,e,i){return{overrideFog:!1}}is3D(o){return this.paint.get("background-pitch-alignment")==="viewport"}},raster:WR,"raster-particle":JR,sky:class extends Bs{constructor(o,e,i,c){super(o,{layout:YR||(YR=new Ti({visibility:new bt(Oe.layout_sky.visibility)})),paint:KR||(KR=new Ti({"sky-type":new bt(Oe.paint_sky["sky-type"]),"sky-atmosphere-sun":new bt(Oe.paint_sky["sky-atmosphere-sun"]),"sky-atmosphere-sun-intensity":new bt(Oe.paint_sky["sky-atmosphere-sun-intensity"]),"sky-gradient-center":new bt(Oe.paint_sky["sky-gradient-center"]),"sky-gradient-radius":new bt(Oe.paint_sky["sky-gradient-radius"]),"sky-gradient":new iu(Oe.paint_sky["sky-gradient"]),"sky-atmosphere-halo-color":new bt(Oe.paint_sky["sky-atmosphere-halo-color"]),"sky-atmosphere-color":new bt(Oe.paint_sky["sky-atmosphere-color"]),"sky-opacity":new bt(Oe.paint_sky["sky-opacity"]),"sky-gradient-use-theme":new Bt({type:"string",default:"default","property-type":"data-driven"}),"sky-atmosphere-halo-color-use-theme":new Bt({type:"string",default:"default","property-type":"data-driven"}),"sky-atmosphere-color-use-theme":new Bt({type:"string",default:"default","property-type":"data-driven"})}))},e,i,c),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(o){o==="sky-gradient"?this._updateColorRamp():o!=="sky-atmosphere-sun"&&o!=="sky-atmosphere-halo-color"&&o!=="sky-atmosphere-color"&&o!=="sky-atmosphere-sun-intensity"||(this._skyboxInvalidated=!0)}_updateColorRamp(){this.colorRamp=vy({expression:this._transitionablePaint._values["sky-gradient"].value.expression,evaluationKey:"skyRadialProgress"}),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}needsSkyboxCapture(o){if(this._skyboxInvalidated||!this.skyboxTexture||!this.skyboxGeometry)return!0;if(!this.paint.get("sky-atmosphere-sun")){const e=o.style.light.properties.get("position");return this._lightPosition.azimuthal!==e.azimuthal||this._lightPosition.polar!==e.polar}return!1}getCenter(o,e){if(this.paint.get("sky-type")==="atmosphere"){const c=this.paint.get("sky-atmosphere-sun"),u=!c,p=o.style.light,m=p.properties.get("position");return u&&p.properties.get("anchor")==="viewport"&&On("The sun direction is attached to a light with viewport anchor, lighting may behave unexpectedly."),u?dT(m.azimuthal,90-m.polar,e):dT(c[0],90-c[1],e)}const i=this.paint.get("sky-gradient-center");return dT(i[0],90-i[1],e)}isSky(){return!0}markSkyboxValid(o){this._skyboxInvalidated=!1,this._lightPosition=o.style.light.properties.get("position")}hasOffscreenPass(){return!0}getProgramIds(){const o=this.paint.get("sky-type");return o==="atmosphere"?["skyboxCapture","skybox"]:o==="gradient"?["skyboxGradient"]:null}},slot:class extends Bs{constructor(o,e,i,c){super(o,{paint:QR||(QR=new Ti({}))},e,null)}},model:class extends Bs{constructor(o,e,i,c){super(o,{layout:lk||(lk=new Ti({visibility:new bt(Oe.layout_model.visibility),"model-id":new Bt(Oe.layout_model["model-id"])})),paint:ck||(ck=new Ti({"model-opacity":new Bt(Oe.paint_model["model-opacity"]),"model-rotation":new Bt(Oe.paint_model["model-rotation"]),"model-scale":new Bt(Oe.paint_model["model-scale"]),"model-translation":new Bt(Oe.paint_model["model-translation"]),"model-color":new Bt(Oe.paint_model["model-color"]),"model-color-mix-intensity":new Bt(Oe.paint_model["model-color-mix-intensity"]),"model-type":new bt(Oe.paint_model["model-type"]),"model-cast-shadows":new bt(Oe.paint_model["model-cast-shadows"]),"model-receive-shadows":new bt(Oe.paint_model["model-receive-shadows"]),"model-ambient-occlusion-intensity":new bt(Oe.paint_model["model-ambient-occlusion-intensity"]),"model-emissive-strength":new Bt(Oe.paint_model["model-emissive-strength"]),"model-roughness":new Bt(Oe.paint_model["model-roughness"]),"model-height-based-emissive-strength-multiplier":new Bt(Oe.paint_model["model-height-based-emissive-strength-multiplier"]),"model-cutoff-fade-range":new bt(Oe.paint_model["model-cutoff-fade-range"]),"model-front-cutoff":new bt(Oe.paint_model["model-front-cutoff"]),"model-color-use-theme":new Bt({type:"string",default:"default","property-type":"data-driven"})}))},e,i,c),this._stats={numRenderedVerticesInShadowPass:0,numRenderedVerticesInTransparentPass:0}}createBucket(o){return new mT(o)}getProgramIds(){return["model"]}is3D(o){return!0}hasShadowPass(){return!0}canCastShadows(){return!0}hasLightBeamPass(){return!0}cutoffRange(){return this.paint.get("model-cutoff-fade-range")}queryRadius(o){return o instanceof k1?Lt-1:0}queryIntersectsFeature(o,e,i,c,u,p){if(!this.modelManager)return!1;const m=this.modelManager,v=o.tile.getBucket(this);if(!(v&&v instanceof mT))return!1;for(const S in v.instancesPerModel){const T=v.instancesPerModel[S],I=e.id!==void 0?e.id:e.properties&&e.properties.hasOwnProperty("id")?e.properties.id:void 0;if(T.idToFeaturesIndex.hasOwnProperty(I)){const P=T.features[T.idToFeaturesIndex[I]],M=m.getModel(S,this.scope);if(!M)return!1;let L=ae();const O=new ie(0,0),G=v.canonical;let Z=Number.MAX_VALUE;for(let Q=0;Q<P.instancedDataCount;++Q){const le=16*(P.instancedDataOffset+Q),ce=T.instancedDataArray.float32,q=[ce[le+4],ce[le+5],ce[le+6]];mk(G,O,ce[le],0|ce[le+1]),uk(L,M,p,O,P.rotation,P.scale,q,!1,!1,!1),p.projection.name==="globe"&&(L=fT(L,p));const re=Y([],p.projMatrix,L),ue=o.queryGeometry,pe=ik(ue.isPointQuery()?ue.screenBounds:ue.screenGeometry,p,re,M.aabb);pe!=null&&(Z=Math.min(pe,Z))}return Z!==Number.MAX_VALUE&&Z}}return!1}_handleOverridablePaintPropertyUpdate(o,e,i){return!(!this.layout||e.isDataDriven()||i.isDataDriven()||o!=="model-color"&&o!=="model-color-mix-intensity"&&o!=="model-rotation"&&o!=="model-scale"&&o!=="model-translation"&&o!=="model-emissive-strength")}_isPropertyZoomDependent(o){const e=this._transitionablePaint._values[o];return e!=null&&e.value!=null&&e.value.expression!=null&&e.value.expression instanceof nf}isZoomDependent(){return this._isPropertyZoomDependent("model-scale")||this._isPropertyZoomDependent("model-rotation")||this._isPropertyZoomDependent("model-translation")}},clip:class extends Bs{constructor(o,e,i,c){super(o,{layout:YP||(YP=new Ti({"clip-layer-types":new bt(Oe.layout_clip["clip-layer-types"]),"clip-layer-scope":new bt(Oe.layout_clip["clip-layer-scope"])})),paint:KP||(KP=new Ti({}))},e,i,c)}recalculate(o,e){super.recalculate(o,e)}createBucket(o){return new QP(o)}is3D(o){return!0}}},vT=new Er(0,0,0),xT={PATH_RULE_NON_ZERO:1,PATH_RULE_EVEN_ODD:2},bT={LINE_CAP_BUTT:1,LINE_CAP_ROUND:2,LINE_CAP_SQUARE:3},D1={LINE_JOIN_MITER:1,LINE_JOIN_MITER_CLIP:2,LINE_JOIN_ROUND:3,LINE_JOIN_BEVEL:4},MU={PAINT_ORDER_FILL_AND_STROKE:1},qy={PATH_COMMAND_MOVE:1,PATH_COMMAND_LINE:2,PATH_COMMAND_QUAD:3,PATH_COMMAND_CUBIC:4,PATH_COMMAND_CLOSE:5},gk={MASK_TYPE_LUMINANCE:1};function RU(o,e,i){o===1&&e.icons.push(function(c,u){return function(p){if(p.usvg_tree.height||(p.usvg_tree.height=p.usvg_tree.width),!p.metadata)return p;const{metadata:m}=p;if(m.content_area){const{content_area:v}=m;v.top==null&&(v.top=v.left),v.width==null&&(v.width=p.usvg_tree.width),v.height==null&&(v.height=v.width)}return m.stretch_x&&m.stretch_x.length&&_k(m,"x"),m.stretch_y&&m.stretch_y.length&&_k(m,"y"),p}(c.readFields(kU,{name:void 0},u))}(i,i.readVarint()+i.pos))}function _k(o,e){const i=[],c=o[`stretch_${e}`];let u=null;for(let p=0;p<c.length;p++)u===null?u=i.length===0?c[0]:i[i.length-1][1]+c[p]:(i.push([u,u+c[p]]),u=null);o[`stretch_${e}_areas`]=i}function kU(o,e,i){o===1?e.name=i.readString():o===2?e.metadata=function(c,u){return c.readFields(DU,{stretch_x:null,stretch_y:null,stretch_x_areas:null,stretch_y_areas:null,variables:[]},u)}(i,i.readVarint()+i.pos):o===3&&(e.usvg_tree=function(c,u){return c.readFields(zU,{width:20,children:[],linear_gradients:[],radial_gradients:[],clip_paths:[],masks:[]},u)}(i,i.readVarint()+i.pos),e.data="usvg_tree")}function DU(o,e,i){o===1?e.stretch_x=i.readPackedVarint():o===2?e.stretch_y=i.readPackedVarint():o===3?e.content_area=function(c,u){return c.readFields(LU,{left:0},u)}(i,i.readVarint()+i.pos):o===4&&e.variables.push(function(c,u){return c.readFields(NU,{name:void 0},u)}(i,i.readVarint()+i.pos))}function LU(o,e,i){o===1?e.left=i.readVarint():o===2?e.width=i.readVarint():o===3?e.top=i.readVarint():o===4&&(e.height=i.readVarint())}function NU(o,e,i){o===1?e.name=i.readString():o===2&&(e.rgb_color=z1(i.readVarint()),e.value="rgb_color")}function zU(o,e,i){o===1?e.width=e.height=i.readVarint():o===2?e.height=i.readVarint():o===3?e.children.push(L1(i,i.readVarint()+i.pos)):o===4?e.linear_gradients.push(function(c,u){return c.readFields($U,{spread_method:1,stops:[],x1:0,y1:0,x2:1,y2:0},u)}(i,i.readVarint()+i.pos)):o===5?e.radial_gradients.push(function(c,u){return c.readFields(HU,{spread_method:1,stops:[],cx:.5,cy:.5,r:.5,fx:.5,fy:.5,fr:0},u)}(i,i.readVarint()+i.pos)):o===7?e.clip_paths.push(function(c,u){return c.readFields(qU,{children:[]},u)}(i,i.readVarint()+i.pos)):o===8&&e.masks.push(function(c,u){const p=c.readFields(WU,{left:0,width:20,mask_type:gk.MASK_TYPE_LUMINANCE,children:[]},u);return p.height==null&&(p.height=p.width),p.top==null&&(p.top=p.left),p}(i,i.readVarint()+i.pos))}function L1(o,e){return o.readFields(OU,{},e)}function OU(o,e,i){o===1?(e.group=function(c,u){return c.readFields(FU,{opacity:255,children:[]},u)}(i,i.readVarint()+i.pos),e.node="group"):o===2&&(e.path=function(c,u){return c.readFields(BU,{paint_order:1,commands:[],step:1,diffs:[],rule:xT.PATH_RULE_NON_ZERO},u)}(i,i.readVarint()+i.pos),e.node="path")}function FU(o,e,i){o===1?e.transform=N1(i,i.readVarint()+i.pos):o===2?e.opacity=i.readVarint():o===5?e.clip_path_idx=i.readVarint():o===6?e.mask_idx=i.readVarint():o===7&&e.children.push(L1(i,i.readVarint()+i.pos))}function N1(o,e){return o.readFields(jU,{sx:1,ky:0,kx:0,sy:1,tx:0,ty:0},e)}function jU(o,e,i){o===1?e.sx=i.readFloat():o===2?e.ky=i.readFloat():o===3?e.kx=i.readFloat():o===4?e.sy=i.readFloat():o===5?e.tx=i.readFloat():o===6&&(e.ty=i.readFloat())}function BU(o,e,i){o===1?e.fill=function(c,u){return c.readFields(VU,{rgb_color:vT,paint:"rgb_color",opacity:255},u)}(i,i.readVarint()+i.pos):o===2?e.stroke=function(c,u){return c.readFields(UU,{rgb_color:vT,paint:"rgb_color",dasharray:[],dashoffset:0,miterlimit:4,opacity:255,width:1,linecap:1,linejoin:1},u)}(i,i.readVarint()+i.pos):o===3?e.paint_order=i.readVarint():o===5?i.readPackedVarint(e.commands):o===6?e.step=i.readFloat():o===7?i.readPackedSVarint(e.diffs):o===8&&(e.rule=i.readVarint())}function VU(o,e,i){o===1?(e.rgb_color=z1(i.readVarint()),e.paint="rgb_color"):o===2?(e.linear_gradient_idx=i.readVarint(),e.paint="linear_gradient_idx"):o===3?(e.radial_gradient_idx=i.readVarint(),e.paint="radial_gradient_idx"):o===5&&(e.opacity=i.readVarint())}function z1(o){return new Er((o>>16&255)/255,(o>>8&255)/255,(255&o)/255,1)}function UU(o,e,i){o===1?(e.rgb_color=z1(i.readVarint()),e.paint="rgb_color"):o===2?(e.linear_gradient_idx=i.readVarint(),e.paint="linear_gradient_idx"):o===3?(e.radial_gradient_idx=i.readVarint(),e.paint="radial_gradient_idx"):o===5?i.readPackedFloat(e.dasharray):o===6?e.dashoffset=i.readFloat():o===7?e.miterlimit=i.readFloat():o===8?e.opacity=i.readVarint():o===9?e.width=i.readFloat():o===10?e.linecap=i.readVarint():o===11&&(e.linejoin=i.readVarint())}function $U(o,e,i){o===1?e.transform=N1(i,i.readVarint()+i.pos):o===2?e.spread_method=i.readVarint():o===3?e.stops.push(yk(i,i.readVarint()+i.pos)):o===4?e.x1=i.readFloat():o===5?e.y1=i.readFloat():o===6?e.x2=i.readFloat():o===7&&(e.y2=i.readFloat())}function yk(o,e){return o.readFields(GU,{offset:0,opacity:255,rgb_color:vT},e)}function GU(o,e,i){o===1?e.offset=i.readFloat():o===2?e.opacity=i.readVarint():o===3&&(e.rgb_color=z1(i.readVarint()))}function HU(o,e,i){o===1?e.transform=N1(i,i.readVarint()+i.pos):o===2?e.spread_method=i.readVarint():o===3?e.stops.push(yk(i,i.readVarint()+i.pos)):o===4?e.cx=i.readFloat():o===5?e.cy=i.readFloat():o===6?e.r=i.readFloat():o===7?e.fx=i.readFloat():o===8?e.fy=i.readFloat():o===9&&(e.fr=i.readFloat())}function qU(o,e,i){o===1?e.transform=N1(i,i.readVarint()+i.pos):o===2?e.clip_path_idx=i.readVarint():o===3&&e.children.push(L1(i,i.readVarint()+i.pos))}function WU(o,e,i){o===1?e.left=e.top=i.readFloat():o===2?e.width=e.height=i.readFloat():o===3?e.top=i.readFloat():o===4?e.height=i.readFloat():o===5?e.mask_type=i.readVarint():o===6?e.mask_idx=i.readVarint():o===7&&e.children.push(L1(i,i.readVarint()+i.pos))}class ZU{static calculate(e={},i=[]){const c=new Map,u=new Map;if(Object.keys(e).length===0)return c;i.forEach(p=>{u.set(p.name,p.rgb_color||new Er(0,0,0))});for(const[p,m]of Object.entries(e))u.has(p)?c.set(u.get(p).toString(),m):console.warn(`Ignoring unknown image variable "${p}"`);return c}}function Om(o,e=255,i){const c=e/255,u=o.toString(),p=i.has(u)?i.get(u).clone():o.clone();return p.a*=c,p.toString()}function Wy(o,e){if(!Cp()){const i=document.createElement("canvas");return i.width=o,i.height=e,i}return new OffscreenCanvas(o,e)}function XU(o,e){const i=ZU.calculate(e.params,o.metadata?o.metadata.variables:[]),c=o.usvg_tree,u=c.width,p=c.height,m=e.transform?e.transform:new DOMMatrix,v=Math.max(1,Math.round(u*m.a)),S=Math.max(1,Math.round(p*m.d)),T=new DOMMatrix([v/u,0,0,S/p,0,0]),I=Wy(v,S).getContext("2d");return wT(I,T,c,c,i),I.getImageData(0,0,v,S)}function wT(o,e,i,c,u){for(const p of c.children)vk(o,e,i,p,u)}function vk(o,e,i,c,u){c.group?(o.save(),function(p,m,v,S,T){const I=S.mask_idx!=null?v.masks[S.mask_idx]:null,P=S.clip_path_idx!=null?v.clip_paths[S.clip_path_idx]:null;if(S.transform&&(m=Fm(S.transform).preMultiplySelf(m)),!function(O,G,Z){return O.opacity!==255||G||Z}(S,P!=null,I!=null))return void wT(p,m,v,S,T);const M=Wy(p.canvas.width,p.canvas.height),L=M.getContext("2d");wT(L,m,v,S,T),P&&Ck(L,m,v,P),I&&Ak(L,m,v,I,T),p.globalAlpha=S.opacity/255,p.drawImage(M,0,0)}(o,e,i,c.group,u),o.restore()):c.path&&(o.save(),function(p,m,v,S,T){p.setTransform(m),S.paint_order===MU.PAINT_ORDER_FILL_AND_STROKE?(xk(p,v,S,T),wk(p,v,S,T)):(wk(p,v,S,T),xk(p,v,S,T))}(o,e,i,c.path,u),o.restore())}function xk(o,e,i,c){const u=i.fill;if(!u)return;const p=u.opacity/255;switch(o.save(),o.beginPath(),Ik(i,o),u.paint){case"rgb_color":o.fillStyle=Om(u.rgb_color,u.opacity,c);break;case"linear_gradient_idx":{const m=e.linear_gradients[u.linear_gradient_idx];m.transform&&o.setTransform(Fm(m.transform).preMultiplySelf(o.getTransform())),o.fillStyle=Sk(o,m,p,c);break}case"radial_gradient_idx":{const m=e.radial_gradients[u.radial_gradient_idx];m.transform&&o.setTransform(Fm(m.transform).preMultiplySelf(o.getTransform())),o.fillStyle=Tk(o,m,p,c)}}o.fill(bk(i)),o.restore()}function bk(o){return o.rule===xT.PATH_RULE_NON_ZERO?"nonzero":o.rule===xT.PATH_RULE_EVEN_ODD?"evenodd":void 0}function wk(o,e,i,c){const u=i.stroke;if(!u)return;const p=Pk(i);o.lineWidth=u.width,o.miterLimit=u.miterlimit,o.setLineDash(u.dasharray),o.lineDashOffset=u.dashoffset;const m=u.opacity/255;switch(u.paint){case"rgb_color":o.strokeStyle=Om(u.rgb_color,u.opacity,c);break;case"linear_gradient_idx":o.strokeStyle=Sk(o,e.linear_gradients[u.linear_gradient_idx],m,c,!0);break;case"radial_gradient_idx":o.strokeStyle=Tk(o,e.radial_gradients[u.radial_gradient_idx],m,c,!0)}switch(u.linejoin){case D1.LINE_JOIN_MITER_CLIP:case D1.LINE_JOIN_MITER:o.lineJoin="miter";break;case D1.LINE_JOIN_ROUND:o.lineJoin="round";break;case D1.LINE_JOIN_BEVEL:o.lineJoin="bevel"}switch(u.linecap){case bT.LINE_CAP_BUTT:o.lineCap="butt";break;case bT.LINE_CAP_ROUND:o.lineCap="round";break;case bT.LINE_CAP_SQUARE:o.lineCap="square"}o.stroke(p)}function Sk(o,e,i,c,u=!1){if(e.stops.length===1){const M=e.stops[0];return Om(M.rgb_color,M.opacity*i,c)}const{x1:p,y1:m,x2:v,y2:S}=e;let T=new DOMPoint(p,m),I=new DOMPoint(v,S);if(u){const M=Fm(e.transform);T=M.transformPoint(T),I=M.transformPoint(I)}const P=o.createLinearGradient(T.x,T.y,I.x,I.y);for(const M of e.stops)P.addColorStop(M.offset,Om(M.rgb_color,M.opacity*i,c));return P}function Tk(o,e,i,c,u=!1){if(e.stops.length===1){const Q=e.stops[0];return Om(Q.rgb_color,Q.opacity*i,c)}const p=Fm(e.transform),{fx:m,fy:v,fr:S,cx:T,cy:I,r:P}=e;let M=new DOMPoint(m,v),L=new DOMPoint(T,I),O=S,G=P;if(u){M=p.transformPoint(M),L=p.transformPoint(L);const Q=(p.a+p.d)/2;O=S*Q,G=e.r*Q}const Z=o.createRadialGradient(M.x,M.y,O,L.x,L.y,G);for(const Q of e.stops)Z.addColorStop(Q.offset,Om(Q.rgb_color,Q.opacity*i,c));return Z}function Ek(o,e,i,c){const u=c.transform?Fm(c.transform).preMultiplySelf(e):e,p=Wy(o.canvas.width,o.canvas.height),m=p.getContext("2d");for(const S of c.children)if(S.group)Ek(m,u,i,S.group);else if(S.path){const T=S.path,I=new Path2D;I.addPath(Pk(T),u),m.fill(I,bk(T))}const v=c.clip_path_idx!=null?i.clip_paths[c.clip_path_idx]:null;v&&Ck(m,u,i,v),o.globalCompositeOperation="source-over",o.drawImage(p,0,0)}function Ck(o,e,i,c){const u=Wy(o.canvas.width,o.canvas.height);Ek(u.getContext("2d"),e,i,c),o.globalCompositeOperation="destination-in",o.drawImage(u,0,0)}function Ak(o,e,i,c,u){if(c.children.length===0)return;const p=c.mask_idx!=null?i.masks[c.mask_idx]:null;p&&Ak(o,e,i,p,u);const m=o.canvas.width,v=o.canvas.height,S=Wy(m,v),T=S.getContext("2d"),I=c.width,P=c.height,M=c.left,L=c.top,O=new Path2D,G=new Path2D;G.rect(M,L,I,P),O.addPath(G,e),T.clip(O);for(const le of c.children)vk(T,e,i,le,u);const Z=T.getImageData(0,0,m,v),Q=Z.data;if(c.mask_type===gk.MASK_TYPE_LUMINANCE)for(let le=0;le<Q.length;le+=4)Q[le+3]=Q[le+3]/255*(.2126*Q[le]+.7152*Q[le+1]+.0722*Q[le+2]);T.putImageData(Z,0,0),o.globalCompositeOperation="destination-in",o.drawImage(S,0,0)}function Fm(o){return o?new DOMMatrix([o.sx,o.ky,o.kx,o.sy,o.tx,o.ty]):new DOMMatrix}function Ik(o,e){const i=o.step;let c=o.diffs[0]*i,u=o.diffs[1]*i;e.moveTo(c,u);for(let p=0,m=2;p<o.commands.length;p++)switch(o.commands[p]){case qy.PATH_COMMAND_MOVE:c+=o.diffs[m++]*i,u+=o.diffs[m++]*i,e.moveTo(c,u);break;case qy.PATH_COMMAND_LINE:c+=o.diffs[m++]*i,u+=o.diffs[m++]*i,e.lineTo(c,u);break;case qy.PATH_COMMAND_QUAD:{const v=c+o.diffs[m++]*i,S=u+o.diffs[m++]*i;c=v+o.diffs[m++]*i,u=S+o.diffs[m++]*i,e.quadraticCurveTo(v,S,c,u);break}case qy.PATH_COMMAND_CUBIC:{const v=c+o.diffs[m++]*i,S=u+o.diffs[m++]*i,T=v+o.diffs[m++]*i,I=S+o.diffs[m++]*i;c=T+o.diffs[m++]*i,u=I+o.diffs[m++]*i,e.bezierCurveTo(v,S,T,I,c,u);break}case qy.PATH_COMMAND_CLOSE:e.closePath()}return e}function Pk(o){return Ik(o,new Path2D)}class O1{constructor(e){this.capacity=e,this.cache=new Map}get(e){if(!this.cache.has(e))return;const i=this.cache.get(e);return this.cache.delete(e),this.cache.set(e,i),i}put(e,i){this.cache.has(e)?this.cache.delete(e):this.cache.size===this.capacity&&this.cache.delete(this.cache.keys().next().value),this.cache.set(e,i)}delete(e){this.cache.delete(e)}}Ht(O1,"LRUCache");class ST{constructor(){this.cacheMap=new Map,this.cacheDependenciesMap=new Map}static _getImage(e){return new Is(e,e.data)}getFromCache(e,i,c){return this.cacheMap.has(c)||this.cacheMap.set(c,new O1(150)),this.cacheMap.get(c).get(su(e.toString(),i))}setInCache(e,i,c,u){this.cacheDependenciesMap.has(u)||this.cacheDependenciesMap.set(u,new Map),this.cacheMap.has(u)||this.cacheMap.set(u,new O1(150));const p=this.cacheDependenciesMap.get(u),m=su(e.id.toString(),c);p.get(m)||p.set(m,new Set);const v=this.cacheMap.get(u),S=e.toString();p.get(m).add(S),v.put(su(e.toString(),c),i)}removeImagesFromCacheByIds(e,i,c=0){if(!this.cacheMap.has(c)||!this.cacheDependenciesMap.has(c))return;const u=this.cacheMap.get(c),p=this.cacheDependenciesMap.get(c);for(const m of e){const v=su(m.toString(),i);if(p.has(v)){for(const S of p.get(v))u.delete(S);p.delete(v)}}}rasterize(e,i,c,u,p=XU){const m=this.getFromCache(e,c,u);if(m)return m.clone();const v=p(i.icon,e.options),S=ST._getImage(v);return this.setInCache(e,S,c,u),S.clone()}}class Mk{constructor(e){this.size=e,this.minimums=[],this.maximums=[],this.leaves=[]}getElevation(e,i){const c=this.toIdx(e,i);return{min:this.minimums[c],max:this.maximums[c]}}isLeaf(e,i){return this.leaves[this.toIdx(e,i)]}toIdx(e,i){return i*this.size+e}}function Rk(o,e,i,c){let u=0,p=Number.MAX_VALUE;for(let m=0;m<3;m++)if(Math.abs(c[m])<1e-15){if(i[m]<o[m]||i[m]>e[m])return null}else{const v=1/c[m];let S=(o[m]-i[m])*v,T=(e[m]-i[m])*v;if(S>T){const I=S;S=T,T=I}if(S>u&&(u=S),T<p&&(p=T),u>p)return null}return u}function kk(o,e,i,c,u,p,m,v,S,T,I){const P=c-o,M=u-e,L=p-i,O=m-o,G=v-e,Z=S-i,Q=I[1]*Z-I[2]*G,le=I[2]*O-I[0]*Z,ce=I[0]*G-I[1]*O,q=P*Q+M*le+L*ce;if(Math.abs(q)<1e-15)return null;const re=1/q,ue=T[0]-o,pe=T[1]-e,Ae=T[2]-i,Te=(ue*Q+pe*le+Ae*ce)*re;if(Te<0||Te>1)return null;const Ie=pe*L-Ae*M,Ne=Ae*P-ue*L,Ke=ue*M-pe*P,yt=(I[0]*Ie+I[1]*Ne+I[2]*Ke)*re;return yt<0||Te+yt>1?null:(O*Ie+G*Ne+Z*Ke)*re}function Dk(o,e,i){return(o-e)/(i-e)}function Lk(o,e,i,c,u,p,m,v,S){const T=1<<i,I=p-c,P=m-u,M=(o+1)/T*I+c,L=(e+0)/T*P+u,O=(e+1)/T*P+u;v[0]=(o+0)/T*I+c,v[1]=L,S[0]=M,S[1]=O}class Nk{constructor(e){if(this.maximums=[],this.minimums=[],this.leaves=[],this.childOffsets=[],this.nodeCount=0,this.dem=e,this._siblingOffset=[[0,0],[1,0],[0,1],[1,1]],!this.dem)return;const i=function(p){const m=Math.ceil(Math.log2(p.dim/8)),v=[];let S=Math.ceil(Math.pow(2,m));const T=1/S,I=(L,O,G,Z,Q)=>{const le=Z?1:0,ce=(L+1)*G-le,q=O*G,re=(O+1)*G-le;Q[0]=L*G,Q[1]=q,Q[2]=ce,Q[3]=re};let P=new Mk(S);const M=[];for(let L=0;L<S*S;L++){I(L%S,Math.floor(L/S),T,!1,M);const O=xd(M[0],M[1],p),G=xd(M[2],M[1],p),Z=xd(M[2],M[3],p),Q=xd(M[0],M[3],p);P.minimums.push(Math.min(O,G,Z,Q)),P.maximums.push(Math.max(O,G,Z,Q)),P.leaves.push(1)}for(v.push(P),S/=2;S>=1;S/=2){const L=v[v.length-1];P=new Mk(S);for(let O=0;O<S*S;O++){I(O%S,Math.floor(O/S),2,!0,M);const G=L.getElevation(M[0],M[1]),Z=L.getElevation(M[2],M[1]),Q=L.getElevation(M[2],M[3]),le=L.getElevation(M[0],M[3]),ce=L.isLeaf(M[0],M[1]),q=L.isLeaf(M[2],M[1]),re=L.isLeaf(M[2],M[3]),ue=L.isLeaf(M[0],M[3]),pe=Math.min(G.min,Z.min,Q.min,le.min),Ae=Math.max(G.max,Z.max,Q.max,le.max),Te=ce&&q&&re&&ue;P.maximums.push(Ae),P.minimums.push(pe),P.leaves.push(Ae-pe<=5&&Te?1:0)}v.push(P)}return v}(this.dem),c=i.length-1,u=i[c];this._addNode(u.minimums[0],u.maximums[0],u.leaves[0]),this._construct(i,0,0,c,0)}raycastRoot(e,i,c,u,p,m,v=1){return Rk([e,i,-100],[c,u,this.maximums[0]*v],p,m)}raycast(e,i,c,u,p,m,v=1){if(!this.nodeCount)return null;const S=this.raycastRoot(e,i,c,u,p,m,v);if(S==null)return null;const T=[],I=[],P=[],M=[],L=[{idx:0,t:S,nodex:0,nodey:0,depth:0}];for(;L.length>0;){const{idx:O,t:G,nodex:Z,nodey:Q,depth:le}=L.pop();if(this.leaves[O]){Lk(Z,Q,le,e,i,c,u,P,M);const q=1<<le,re=(Z+0)/q,ue=(Z+1)/q,pe=(Q+0)/q,Ae=(Q+1)/q,Te=xd(re,pe,this.dem)*v,Ie=xd(ue,pe,this.dem)*v,Ne=xd(ue,Ae,this.dem)*v,Ke=xd(re,Ae,this.dem)*v,yt=kk(P[0],P[1],Te,M[0],P[1],Ie,M[0],M[1],Ne,p,m),at=kk(M[0],M[1],Ne,P[0],M[1],Ke,P[0],P[1],Te,p,m),_t=Math.min(yt!==null?yt:Number.MAX_VALUE,at!==null?at:Number.MAX_VALUE);if(_t!==Number.MAX_VALUE)return _t;{const xt=Zt([],p,m,G);if(zk(Te,Ie,Ke,Ne,Dk(xt[0],P[0],M[0]),Dk(xt[1],P[1],M[1]))>=xt[2])return G}continue}let ce=0;for(let q=0;q<this._siblingOffset.length;q++){Lk((Z<<1)+this._siblingOffset[q][0],(Q<<1)+this._siblingOffset[q][1],le+1,e,i,c,u,P,M),P[2]=-100,M[2]=this.maximums[this.childOffsets[O]+q]*v;const re=Rk(P,M,p,m);if(re!=null){const ue=re;T[q]=ue;let pe=!1;for(let Ae=0;Ae<ce&&!pe;Ae++)ue>=T[I[Ae]]&&(I.splice(Ae,0,q),pe=!0);pe||(I[ce]=q),ce++}}for(let q=0;q<ce;q++){const re=I[q];L.push({idx:this.childOffsets[O]+re,t:T[re],nodex:(Z<<1)+this._siblingOffset[re][0],nodey:(Q<<1)+this._siblingOffset[re][1],depth:le+1})}}return null}_addNode(e,i,c){return this.minimums.push(e),this.maximums.push(i),this.leaves.push(c),this.childOffsets.push(0),this.nodeCount++}_construct(e,i,c,u,p){if(e[u].isLeaf(i,c)===1)return;this.childOffsets[p]||(this.childOffsets[p]=this.nodeCount);const m=u-1,v=e[m];let S=0,T=0;for(let I=0;I<this._siblingOffset.length;I++){const P=2*i+this._siblingOffset[I][0],M=2*c+this._siblingOffset[I][1],L=v.getElevation(P,M),O=v.isLeaf(P,M),G=this._addNode(L.min,L.max,O);O&&(S|=1<<I),T||(T=G)}for(let I=0;I<this._siblingOffset.length;I++)S&1<<I||this._construct(e,2*i+this._siblingOffset[I][0],2*c+this._siblingOffset[I][1],m,T+I)}}function zk(o,e,i,c,u,p){return vn(vn(o,i,p),vn(e,c,p),u)}function xd(o,e,i){const c=i.dim,u=xe(o*c-.5,0,c-1),p=xe(e*c-.5,0,c-1),m=Math.floor(u),v=Math.floor(p),S=Math.min(m+1,c-1),T=Math.min(v+1,c-1);return zk(i.get(m,v),i.get(S,v),i.get(m,T),i.get(S,T),u-m,p-v)}const YU={mapbox:[6553.6,25.6,.1,1e4],terrarium:[256,1,1/256,32768]};function KU(o,e,i){return(256*o*256+256*e+i)/10-1e4}function QU(o,e,i){return 256*o+e+i/256-32768}class F1{get tree(){return this._tree||this._buildQuadTree(),this._tree}constructor(e,i,c,u=!1){if(this.uid=e,i.height!==i.width)throw new RangeError("DEM tiles must be square");if(c&&c!=="mapbox"&&c!=="terrarium")return void On(`"${c}" is not a valid encoding type. Valid types include "mapbox" and "terrarium".`);this.stride=i.height;const p=this.dim=i.height-2,m=new Uint32Array(i.data.buffer);if(this.pixels=new Uint8Array(i.data.buffer),this.floatView=new Float32Array(i.data.buffer),this.borderReady=u,this._modifiedForSources={},!u){for(let S=0;S<p;S++)m[this._idx(-1,S)]=m[this._idx(0,S)],m[this._idx(p,S)]=m[this._idx(p-1,S)],m[this._idx(S,-1)]=m[this._idx(S,0)],m[this._idx(S,p)]=m[this._idx(S,p-1)];m[this._idx(-1,-1)]=m[this._idx(0,0)],m[this._idx(p,-1)]=m[this._idx(p-1,0)],m[this._idx(-1,p)]=m[this._idx(0,p-1)],m[this._idx(p,p)]=m[this._idx(p-1,p-1)]}const v=c==="terrarium"?QU:KU;for(let S=0;S<m.length;++S){const T=4*S;this.floatView[S]=v(this.pixels[T],this.pixels[T+1],this.pixels[T+2])}this._timestamp=pa.now()}_buildQuadTree(){this._tree=new Nk(this)}get(e,i,c=!1){c&&(e=xe(e,-1,this.dim),i=xe(i,-1,this.dim));const u=this._idx(e,i);return this.floatView[u]}set(e,i,c){const u=this._idx(e,i),p=this.floatView[u];return this.floatView[u]=c,c-p}static getUnpackVector(e){return YU[e]}_idx(e,i){if(e<-1||e>=this.dim+1||i<-1||i>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(i+1)*this.stride+(e+1)}static pack(e,i){const c=[0,0,0,0],u=F1.getUnpackVector(i);let p=Math.floor((e+u[3])/u[2]);return c[2]=p%256,p=Math.floor(p/256),c[1]=p%256,p=Math.floor(p/256),c[0]=p,c}getPixels(){return new zP({width:this.stride,height:this.stride},this.pixels)}backfillBorder(e,i,c){if(this.dim!==e.dim)throw new Error("dem dimension mismatch");let u=i*this.dim,p=i*this.dim+this.dim,m=c*this.dim,v=c*this.dim+this.dim;switch(i){case-1:u=p-1;break;case 1:p=u+1}switch(c){case-1:m=v-1;break;case 1:v=m+1}const S=-i*this.dim,T=-c*this.dim;for(let I=m;I<v;I++)for(let P=u;P<p;P++){const M=4*this._idx(P,I),L=4*this._idx(P+S,I+T);this.pixels[M+0]=e.pixels[L+0],this.pixels[M+1]=e.pixels[L+1],this.pixels[M+2]=e.pixels[L+2],this.pixels[M+3]=e.pixels[L+3]}}onDeserialize(){this._tree&&(this._tree.dem=this)}}function JU(o,e,i){o===1?e.headerLength=i.readFixed32():o===2?e.x=i.readVarint():o===3?e.y=i.readVarint():o===4?e.z=i.readVarint():o===5&&e.layers.push(function(c,u){return c.readFields(i8,{version:0,name:"",units:"",tileSize:0,buffer:0,pixelFormat:0,dataIndex:[]},u)}(i,i.readVarint()+i.pos))}function e8(o,e,i){o===1?(e.delta_filter=function(c,u){return c.readFields(t8,{blockSize:0},u)}(i,i.readVarint()+i.pos),e.filter="delta_filter"):o===2?(i.readVarint(),e.filter="zigzag_filter"):o===3?(i.readVarint(),e.filter="bitshuffle_filter"):o===4&&(i.readVarint(),e.filter="byteshuffle_filter")}function t8(o,e,i){o===1&&(e.blockSize=i.readVarint())}function n8(o,e,i){o===1?(i.readVarint(),e.codec="gzip_data"):o===2?(i.readVarint(),e.codec="jpeg_image"):o===3?(i.readVarint(),e.codec="webp_image"):o===4&&(i.readVarint(),e.codec="png_image")}function r8(o,e,i){let c=0,u=0;o===1?e.firstByte=i.readFixed64():o===2?e.lastByte=i.readFixed64():o===3?e.filters.push(function(p,m){return p.readFields(e8,{},m)}(i,i.readVarint()+i.pos)):o===4?e.codec=function(p,m){return p.readFields(n8,{},m)}(i,i.readVarint()+i.pos):o===5?u=i.readFloat():o===6?c=i.readFloat():o===7?e.bands.push(i.readString()):o===8?e.offset=i.readDouble():o===9&&(e.scale=i.readDouble()),e.offset===0&&(e.offset=u),e.scale===0&&(e.scale=c)}function i8(o,e,i){o===1?e.version=i.readVarint():o===2?e.name=i.readString():o===3?e.units=i.readString():o===4?e.tileSize=i.readVarint():o===5?e.buffer=i.readVarint():o===6?e.pixelFormat=i.readVarint():o===7&&e.dataIndex.push(function(c,u){return c.readFields(r8,{firstByte:0,lastByte:0,filters:[],codec:null,offset:0,scale:0,bands:[]},u)}(i,i.readVarint()+i.pos))}function s8(o,e,i){if(o===2)(function(c,u,p){c.readFields(o8,p,u)})(i,i.readVarint()+i.pos,e);else if(o===3)throw new Error("Not implemented")}function o8(o,e,i){if(o===1){let c=0;const u=i.readVarint()+i.pos;for(;i.pos<u;)e[c++]=i.readVarint()}}function a8(o,e){if(e.length!==4)throw new Error(`Expected data of dimension 4 but got ${e.length}.`);let i=e[3];for(let c=2;c>=1;c--){const u=c===1?1:0,p=c===2?1:0;for(let m=0;m<e[0];m++){const v=e[1]*m;for(let S=u;S<e[1];S++){const T=e[2]*(S+v);for(let I=p;I<e[2];I++){const P=e[3]*(I+T);for(let M=0;M<e[3];M++){const L=P+M;o[L]+=o[L-i]}}}}i*=e[c]}return o}function l8(o){for(let e=0,i=o.length;e<i;e++)o[e]=o[e]>>>1^-(1&o[e]);return o}function c8(o,e){switch(e){case"uint32":return o;case"uint16":for(let i=0;i<o.length;i+=2){const c=o[i],u=o[i+1];o[i]=(240&c)>>4|(61440&c)>>8|(240&u)<<4|61440&u,o[i+1]=15&c|(3840&c)>>4|(15&u)<<8|(3840&u)<<4}return o;case"uint8":for(let i=0;i<o.length;i+=4){const c=o[i],u=o[i+1],p=o[i+2],m=o[i+3];o[i+0]=(192&c)>>6|(192&u)>>4|(192&p)>>2|192&m,o[i+1]=(48&c)>>4|(48&u)>>2|48&p|(48&m)<<2,o[i+2]=(12&c)>>2|12&u|(12&p)<<2|(12&m)<<4,o[i+3]=3&c|(3&u)<<2|(3&p)<<4|(3&m)<<6}return o;default:throw new Error(`Invalid pixel format, "${e}"`)}}Ht(F1,"DEMData"),Ht(Nk,"DemMinMaxQuadTree",{omit:["dem"]});var wa=Uint8Array,Zy=Uint16Array,u8=Int32Array,Ok=new wa([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),Fk=new wa([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),d8=new wa([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),jk=function(o,e){for(var i=new Zy(31),c=0;c<31;++c)i[c]=e+=1<<o[c-1];var u=new u8(i[30]);for(c=1;c<30;++c)for(var p=i[c];p<i[c+1];++p)u[p]=p-i[c]<<5|c;return{b:i,r:u}},Bk=jk(Ok,2),Vk=Bk.b,h8=Bk.r;Vk[28]=258,h8[258]=28;for(var f8=jk(Fk,0).b,Uk=new Zy(32768),Ji=0;Ji<32768;++Ji){var jm=(43690&Ji)>>1|(21845&Ji)<<1;Uk[Ji]=((65280&(jm=(61680&(jm=(52428&jm)>>2|(13107&jm)<<2))>>4|(3855&jm)<<4))>>8|(255&jm)<<8)>>1}var Xy=function(o,e,i){for(var c=o.length,u=0,p=new Zy(e);u<c;++u)o[u]&&++p[o[u]-1];var m,v=new Zy(e);for(u=1;u<e;++u)v[u]=v[u-1]+p[u-1]<<1;m=new Zy(1<<e);var S=15-e;for(u=0;u<c;++u)if(o[u])for(var T=u<<4|o[u],I=e-o[u],P=v[o[u]-1]++<<I,M=P|(1<<I)-1;P<=M;++P)m[Uk[P]>>S]=T;return m},Yy=new wa(288);for(Ji=0;Ji<144;++Ji)Yy[Ji]=8;for(Ji=144;Ji<256;++Ji)Yy[Ji]=9;for(Ji=256;Ji<280;++Ji)Yy[Ji]=7;for(Ji=280;Ji<288;++Ji)Yy[Ji]=8;var $k=new wa(32);for(Ji=0;Ji<32;++Ji)$k[Ji]=5;var p8=Xy(Yy,9),m8=Xy($k,5),TT=function(o){for(var e=o[0],i=1;i<o.length;++i)o[i]>e&&(e=o[i]);return e},xl=function(o,e,i){var c=e/8|0;return(o[c]|o[c+1]<<8)>>(7&e)&i},ET=function(o,e){var i=e/8|0;return(o[i]|o[i+1]<<8|o[i+2]<<16)>>(7&e)},g8=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],bl=function(o,e,i){var c=new Error(e||g8[o]);if(c.code=o,Error.captureStackTrace&&Error.captureStackTrace(c,bl),!i)throw c;return c},_8=new wa(0),y8=typeof TextDecoder<"u"&&new TextDecoder;try{y8.decode(_8,{stream:!0})}catch{}const v8={gzip_data:"gzip"};class $a extends Error{constructor(e){super(e),this.name="MRTError"}}const x8={0:"uint32",1:"uint32",2:"uint16",3:"uint8"},Gk={uint32:1,uint16:2,uint8:4},b8={uint32:Uint32Array,uint16:Uint16Array,uint8:Uint8Array};let CT;class j1{constructor(e=5){this.x=NaN,this.y=NaN,this.z=NaN,this.layers={},this._cacheSize=e}getLayer(e){const i=this.layers[e];if(!i)throw new $a(`Layer '${e}' not found`);return i}getHeaderLength(e){const i=new Uint8Array(e),c=new DataView(e);if(i[0]!==13)throw new $a("File is not a valid MRT.");return c.getUint32(1,!0)}parseHeader(e){const i=new Uint8Array(e),c=this.getHeaderLength(e);if(i.length<c)throw new $a(`Expected header with length >= ${c} but got buffer of length ${i.length}`);const u=function(p,m){return p.readFields(JU,{headerLength:0,x:0,y:0,z:0,layers:[]},void 0)}(new CT(i.subarray(0,c)));if(!isNaN(this.x)&&(this.x!==u.x||this.y!==u.y||this.z!==u.z))throw new $a(`Invalid attempt to parse header ${u.z}/${u.x}/${u.y} for tile ${this.z}/${this.x}/${this.y}`);this.x=u.x,this.y=u.y,this.z=u.z;for(const p of u.layers)this.layers[p.name]=new Hk(p,{cacheSize:this._cacheSize});return this}createDecodingTask(e){const i=[],c=this.getLayer(e.layerName);for(let u of e.blockIndices){const p=c.dataIndex[u],m=p.firstByte-e.firstByte,v=p.lastByte-e.firstByte;if(c._blocksInProgress.has(u))continue;const S={layerName:c.name,firstByte:m,lastByte:v,pixelFormat:c.pixelFormat,blockIndex:u,blockShape:[p.bands.length].concat(c.bandShape),buffer:c.buffer,codec:p.codec.codec,filters:p.filters.map(T=>T.filter)};c._blocksInProgress.add(u),i.push(S)}return new qk(i,()=>{i.forEach(u=>c._blocksInProgress.delete(u.blockIndex))},(u,p)=>{if(i.forEach(m=>c._blocksInProgress.delete(m.blockIndex)),u)throw u;p.forEach(m=>{this.getLayer(m.layerName).processDecodedData(m)})})}}class Hk{constructor({version:e,name:i,units:c,tileSize:u,pixelFormat:p,buffer:m,dataIndex:v},S){if(this.version=e,this.version!==1)throw new $a(`Cannot parse raster layer encoded with MRT version ${e}`);this.name=i,this.units=c,this.tileSize=u,this.buffer=m,this.pixelFormat=x8[p],this.dataIndex=v,this.bandShape=[u+2*m,u+2*m,Gk[this.pixelFormat]],this._decodedBlocks=new O1(S?S.cacheSize:5),this._blocksInProgress=new Set}get dimension(){return Gk[this.pixelFormat]}get cacheSize(){return this._decodedBlocks.capacity}getBandList(){return this.dataIndex.map(({bands:e})=>e).flat()}processDecodedData(e){const i=e.blockIndex.toString();this._decodedBlocks.get(i)||this._decodedBlocks.put(i,e.data)}getBlockForBand(e){let i=0;switch(typeof e){case"string":for(const[c,u]of this.dataIndex.entries()){for(const[p,m]of u.bands.entries())if(m===e)return{bandIndex:i+p,blockIndex:c,blockBandIndex:p};i+=u.bands.length}break;case"number":for(const[c,u]of this.dataIndex.entries()){if(e>=i&&e<i+u.bands.length)return{bandIndex:e,blockIndex:c,blockBandIndex:e-i};i+=u.bands.length}break;default:throw new $a(`Invalid band \`${JSON.stringify(e)}\`. Expected string or integer.`)}return{blockIndex:-1,blockBandIndex:-1}}getDataRange(e){let i=1/0,c=-1/0;const u=[],p=new Set;for(const m of e){const{blockIndex:v}=this.getBlockForBand(m);if(v<0)throw new $a(`Invalid band: ${JSON.stringify(m)}`);const S=this.dataIndex[v];u.includes(v)||u.push(v),p.add(v),i=Math.min(i,S.firstByte),c=Math.max(c,S.lastByte)}if(p.size>this.cacheSize)throw new $a(`Number of blocks to decode (${p.size}) exceeds cache size (${this.cacheSize}).`);return{layerName:this.name,firstByte:i,lastByte:c,blockIndices:u}}hasBand(e){const{blockIndex:i}=this.getBlockForBand(e);return i>=0}hasDataForBand(e){const{blockIndex:i}=this.getBlockForBand(e);return i>=0&&!!this._decodedBlocks.get(i.toString())}getBandView(e){const{blockIndex:i,blockBandIndex:c}=this.getBlockForBand(e);if(i<0)throw new $a(`Band not found: ${JSON.stringify(e)}`);const u=this._decodedBlocks.get(i.toString());if(!u)throw new $a(`Data for band ${JSON.stringify(e)} of layer "${this.name}" not decoded.`);const p=this.dataIndex[i],m=this.bandShape.reduce((T,I)=>T*I,1),v=c*m,S=u.subarray(v,v+m);return{data:S,bytes:new Uint8Array(S.buffer).subarray(S.byteOffset,S.byteOffset+S.byteLength),tileSize:this.tileSize,buffer:this.buffer,pixelFormat:this.pixelFormat,dimension:this.dimension,offset:p.offset,scale:p.scale}}}j1.setPbf=function(o){CT=o};class qk{constructor(e,i,c){this.tasks=e,this._onCancel=i,this._onComplete=c,this._finalized=!1}cancel(){this._finalized||(this._onCancel(),this._finalized=!0)}complete(e,i){this._finalized||(this._onComplete(e,i),this._finalized=!0)}}function Rf(o,e){const i=o.json.bufferViews[e.bufferView],c=o1[e.componentType];return new c(o.buffers[i.buffer],(e.byteOffset||0)+(i.byteOffset||0),e.count*(i.byteStride&&i.byteStride!==ky[e.type]*c.BYTES_PER_ELEMENT?i.byteStride/c.BYTES_PER_ELEMENT:ky[e.type]))}function AT(o,e,i,c){const u=o1[e.componentType],p=function(I){switch(I){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:return 1}}(u),m=o.json.bufferViews[e.bufferView],v=m.byteStride?m.byteStride/u.BYTES_PER_ELEMENT:ky[e.type],S=i.float32,T=S.length/i.capacity;for(let I=0,P=0;I<e.count*v;I+=v,P+=T)for(let M=0;M<T;M++)S[P+M]=c[I+M]*p;i._trim()}function w8(o,e,i){const c=o.indices,u=o.attributes,p={};p.indexArray=new bs;const m=e.json.accessors[c],v=m.count/3;p.indexArray.reserve(v);const S=Rf(e,m);for(let M=0;M<v;M++)p.indexArray.emplaceBack(S[3*M],S[3*M+1],S[3*M+2]);p.indexArray._trim(),p.vertexArray=new ja;const T=e.json.accessors[u.POSITION];p.vertexArray.reserve(T.count);const I=Rf(e,T);for(let M=0;M<T.count;M++)p.vertexArray.emplaceBack(I[3*M],I[3*M+1],I[3*M+2]);if(p.vertexArray._trim(),p.aabb=new gr(T.min,T.max),p.centroid=function(M,L){const O=[0,0,0],G=M.length;if(G>0){for(let Z=0;Z<G;Z++){const Q=3*M[Z];O[0]+=L[Q],O[1]+=L[Q+1],O[2]+=L[Q+2]}O[0]/=G,O[1]/=G,O[2]/=G}return O}(S,I),u.COLOR_0!==void 0){const M=e.json.accessors[u.COLOR_0],L=ky[M.type],O=Rf(e,M);p.colorArray=L===3?new ja:new xs,p.colorArray.resize(M.count),AT(e,M,p.colorArray,O)}if(u.NORMAL!==void 0){p.normalArray=new ja;const M=e.json.accessors[u.NORMAL];p.normalArray.resize(M.count);const L=Rf(e,M);AT(e,M,p.normalArray,L)}if(u.TEXCOORD_0!==void 0&&i.length>0){p.texcoordArray=new ou;const M=e.json.accessors[u.TEXCOORD_0];p.texcoordArray.resize(M.count);const L=Rf(e,M);AT(e,M,p.texcoordArray,L)}if(u._FEATURE_ID_RGBA4444!==void 0){const M=e.json.accessors[u._FEATURE_ID_RGBA4444];e.json.extensionsUsed&&e.json.extensionsUsed.includes("EXT_meshopt_compression")&&(p.featureData=Rf(e,M))}u._FEATURE_RGBA4444!==void 0&&(p.featureData=new Uint32Array(Rf(e,e.json.accessors[u._FEATURE_RGBA4444]).buffer));const P=o.material;return p.material=function(M,L){const{emissiveFactor:O=[0,0,0],alphaMode:G="OPAQUE",alphaCutoff:Z=.5,normalTexture:Q,occlusionTexture:le,emissiveTexture:ce,doubleSided:q}=M,{baseColorFactor:re=[1,1,1,1],metallicFactor:ue=1,roughnessFactor:pe=1,baseColorTexture:Ae,metallicRoughnessTexture:Te}=M.pbrMetallicRoughness||{},Ie=le?L[le.index]:void 0;if(le&&le.extensions&&le.extensions.KHR_texture_transform&&Ie){const Ne=le.extensions.KHR_texture_transform;Ie.offsetScale=[Ne.offset[0],Ne.offset[1],Ne.scale[0],Ne.scale[1]]}return{pbrMetallicRoughness:{baseColorFactor:new Er(...re),metallicFactor:ue,roughnessFactor:pe,baseColorTexture:Ae?L[Ae.index]:void 0,metallicRoughnessTexture:Te?L[Te.index]:void 0},doubleSided:q,emissiveFactor:new Er(...O),alphaMode:G,alphaCutoff:Z,normalTexture:Q?L[Q.index]:void 0,occlusionTexture:Ie,emissionTexture:ce?L[ce.index]:void 0,defined:M.defined===void 0}}(P!==void 0?e.json.materials[P]:{defined:!1},i),p}function Wk(o,e,i){const{matrix:c,rotation:u,translation:p,scale:m,mesh:v,extras:S,children:T}=o,I={};if(I.matrix=c||function(P,M,L,O){var G=M[0],Z=M[1],Q=M[2],le=M[3],ce=G+G,q=Z+Z,re=Q+Q,ue=G*ce,pe=G*q,Ae=G*re,Te=Z*q,Ie=Z*re,Ne=Q*re,Ke=le*ce,yt=le*q,at=le*re,_t=O[0],xt=O[1],et=O[2];return P[0]=(1-(Te+Ne))*_t,P[1]=(pe+at)*_t,P[2]=(Ae-yt)*_t,P[3]=0,P[4]=(pe-at)*xt,P[5]=(1-(ue+Ne))*xt,P[6]=(Ie+Ke)*xt,P[7]=0,P[8]=(Ae+yt)*et,P[9]=(Ie-Ke)*et,P[10]=(1-(ue+Te))*et,P[11]=0,P[12]=L[0],P[13]=L[1],P[14]=L[2],P[15]=1,P}([],u||[0,0,0,1],p||[0,0,0],m||[1,1,1]),v!==void 0){I.meshes=i[v];const P=I.anchor=[0,0];for(const M of I.meshes){const{min:L,max:O}=M.aabb;P[0]+=L[0]+O[0],P[1]+=L[1]+O[1]}P[0]=Math.floor(P[0]/I.meshes.length/2),P[1]=Math.floor(P[1]/I.meshes.length/2)}if(S&&(S.id&&(I.id=S.id),S.lights&&(I.lights=function(P){if(!P.length)return[];const M=function(Q){const le=atob(Q),ce=new Uint8Array(le.length);for(let q=0;q<le.length;q++)ce[q]=le.codePointAt(q);return ce}(P),L=[],O=M.length/24,G=new Uint16Array(M.buffer),Z=new Float32Array(M.buffer);for(let Q=0;Q<O;Q++){const le=G[2*Q*6]/30,ce=G[2*Q*6+1]/30,q=G[2*Q*6+10]/100,re=Z[6*Q+1],ue=Z[6*Q+2],pe=Z[6*Q+3],Ae=Z[6*Q+4],Te=pe-re,Ie=Ae-ue,Ne=Math.hypot(Te,Ie);L.push({pos:[re+.5*Te,ue+.5*Ie,ce],normal:[Ie/Ne,-Te/Ne,0],width:Ne,height:le,depth:q,points:[re,ue,pe,Ae]})}return L}(S.lights))),T){const P=[];for(const M of T)P.push(Wk(e.json.nodes[M],e,i));I.children=P}return I}function S8(o){if(o.vertices.length===0||o.indices.length===0)return null;const e=new MS(o.vertices,o.indices,8,256),[i,c]=[e.min.clone(),e.max.clone()];return{vertices:o.vertices,indices:o.indices,grid:e,min:i,max:c}}function T8(o){if(!o.extras||!o.extras.ground)return null;const e=o.extras.ground;if(!e||!Array.isArray(e)||e.length===0)return null;const i=e[0];if(!i||!Array.isArray(i)||i.length===0)return null;const c=[];for(const m of i){if(!Array.isArray(m)||m.length!==2)continue;const v=m[0],S=m[1];typeof v=="number"&&typeof S=="number"&&c.push(new Dt(v,S))}if(c.length<3)return null;c.length>1&&c[c.length-1].equals(c[0])&&c.pop();let u=0;for(let m=0;m<c.length;m++){const v=c[m],S=c[(m+1)%c.length],T=c[(m+2)%c.length];u+=(v.x-S.x)*(T.y-S.y)-(T.x-S.x)*(v.y-S.y)}u>0&&c.reverse();const p=xy(c.flatMap(m=>[m.x,m.y]),[]);return p.length===0?null:{vertices:c,indices:p}}function E8(o,e){const i=[],c=[];let u=0;const p=[];for(const m of o){u=i.length;const v=m.vertexArray.float32,S=m.indexArray.uint16;for(let T=0;T<m.vertexArray.length;T++)p[0]=v[3*T+0],p[1]=v[3*T+1],p[2]=v[3*T+2],Mn(p,p,e),i.push(new Dt(p[0],p[1]));for(let T=0;T<3*m.indexArray.length;T++)c.push(S[T]+u)}if(c.length%3!=0)return null;for(let m=0;m<c.length;m+=3){const v=i[c[m+0]],S=i[c[m+1]],T=i[c[m+2]];(v.x-S.x)*(T.y-S.y)-(T.x-S.x)*(v.y-S.y)>0&&([c[m+1],c[m+2]]=[c[m+2],c[m+1]])}return{vertices:i,indices:c}}function Zk(o){const e=function(S,T){const I=[],P=WebGL2RenderingContext;if(S.json.textures)for(const M of S.json.textures){const L={magFilter:P.LINEAR,minFilter:P.NEAREST,wrapS:P.REPEAT,wrapT:P.REPEAT};M.sampler!==void 0&&Object.assign(L,S.json.samplers[M.sampler]),I.push({image:T[M.source],sampler:L,uploaded:!1})}return I}(o,o.images),i=function(S,T){const I=[];for(const P of S.json.meshes){const M=[];for(const L of P.primitives)M.push(w8(L,S,T));I.push(M)}return I}(o,e),{scenes:c,scene:u,nodes:p}=o.json,m=c?c[u||0].nodes:p,v=[];for(const S of m)v.push(Wk(p[S],o,i));return function(S,T,I){const P={},M=new Set;for(let L=0;L<S.length;L++){const O=I[T[L]];if(!O.extras)continue;const G=O.extras["mapbox:footprint:version"],Z=O.extras["mapbox:footprint:id"];(G||Z)&&M.add(L),G==="1.0.0"&&Z&&(P[Z]=L)}for(let L=0;L<S.length;L++){if(M.has(L))continue;const O=S[L],G=I[T[L]];if(!G.extras)continue;let Z=null;O.id in P&&(Z=E8(S[P[O.id]].meshes,O.matrix)),Z||(Z=T8(G)),Z&&(O.footprint=S8(Z))}if(M.size>0){const L=Array.from(M.values()).sort((O,G)=>O-G);for(let O=L.length-1;O>=0;O--)S.splice(L[O],1)}}(v,m,o.json.nodes),v}function C8(o){o.heightmap=new Float32Array(4096),o.heightmap.fill(-1);const e=o.vertexArray.float32,i=o.aabb.min[0]-1,c=o.aabb.min[1]-1,u=Pf/(o.aabb.max[0]-i+2),p=Pf/(o.aabb.max[1]-c+2);for(let m=0;m<e.length;m+=3){const v=e[m+2],S=(e[m+0]-i)*u|0,T=(e[m+1]-c)*p|0;v>o.heightmap[T*Pf+S]&&(o.heightmap[T*Pf+S]=v)}}function A8(o,e){const i={};i.indexArray=new bs,i.indexArray.reserve(4*o.length),i.vertexArray=new ja,i.vertexArray.reserve(10*o.length),i.colorArray=new xs,i.vertexArray.reserve(10*o.length);let c=0;for(const m of o){const v=Math.min(10,Math.max(4,1.3*m.height))*e,S=[-m.normal[1],m.normal[0],0],T=Math.min(.29,.1*m.width/m.depth),I=m.width-2*m.depth*e*(T+.01),P=Zt([],m.pos,S,I/2),M=Zt([],m.pos,S,-I/2),L=[P[0],P[1],P[2]+m.height],O=[M[0],M[1],M[2]+m.height],G=Zt([],m.normal,S,T);Ct(G,G,v);const Z=Zt([],m.normal,S,-T);Ct(Z,Z,v),jt(G,P,G),jt(Z,M,Z),P[2]+=.1,M[2]+=.1,i.vertexArray.emplaceBack(G[0],G[1],G[2]),i.vertexArray.emplaceBack(Z[0],Z[1],Z[2]),i.vertexArray.emplaceBack(P[0],P[1],P[2]),i.vertexArray.emplaceBack(M[0],M[1],M[2]),i.vertexArray.emplaceBack(L[0],L[1],L[2]),i.vertexArray.emplaceBack(O[0],O[1],O[2]),i.vertexArray.emplaceBack(P[0],P[1],P[2]),i.vertexArray.emplaceBack(M[0],M[1],M[2]),i.vertexArray.emplaceBack(G[0],G[1],G[2]),i.vertexArray.emplaceBack(Z[0],Z[1],Z[2]);const Q=I/v/2;i.colorArray.emplaceBack(-Q-T,-1,Q,.8),i.colorArray.emplaceBack(Q+T,-1,Q,.8),i.colorArray.emplaceBack(-Q,0,Q,1.3),i.colorArray.emplaceBack(Q,0,Q,1.3),i.colorArray.emplaceBack(Q+T,-.8,Q,.7),i.colorArray.emplaceBack(Q+T,-.8,Q,.7),i.colorArray.emplaceBack(0,0,Q,1.3),i.colorArray.emplaceBack(0,0,Q,1.3),i.colorArray.emplaceBack(Q+T,-1.2,Q,.8),i.colorArray.emplaceBack(Q+T,-1.2,Q,.8),i.indexArray.emplaceBack(6+c,4+c,8+c),i.indexArray.emplaceBack(7+c,9+c,5+c),i.indexArray.emplaceBack(0+c,1+c,2+c),i.indexArray.emplaceBack(1+c,3+c,2+c),c+=10}const u={defined:!0};u.emissiveFactor=Er.black;const p={};return p.baseColorFactor=Er.white,u.pbrMetallicRoughness=p,i.material=u,i.aabb=new gr([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),i}j1.performDecoding=function(o,e){const i=new Uint8Array(o);return Promise.all(e.tasks.map(c=>{const{layerName:u,firstByte:p,lastByte:m,pixelFormat:v,blockShape:S,blockIndex:T,filters:I,codec:P}=c,M=i.subarray(p,m+1),L=new Uint32Array(S[0]*S[1]*S[2]);let O;if(P!=="gzip_data")throw new $a(`Unhandled codec: ${P}`);return O=function(G,Z){if(!globalThis.DecompressionStream&&Z==="gzip_data")return Promise.resolve(((q=function(pe){pe[0]==31&&pe[1]==139&&pe[2]==8||bl(6,"invalid gzip data");var Ae=pe[3],Te=10;4&Ae&&(Te+=2+(pe[10]|pe[11]<<8));for(var Ie=(Ae>>3&1)+(Ae>>4&1);Ie>0;Ie-=!pe[Te++]);return Te+(2&Ae)}(ce=G))+8>ce.length&&bl(6,"invalid gzip data"),function(pe,Ae,Te,Ie){var Ne=pe.length;if(!Ne||Ae.f&&!Ae.l)return Te||new wa(0);var Ke=!Te,yt=Ke||Ae.i!=2,at=Ae.i;Ke&&(Te=new wa(3*Ne));var _t,xt,et=function(Li){var oi=Te.length;if(Li>oi){var qr=new wa(Math.max(2*oi,Li));qr.set(Te),Te=qr}},pt=Ae.f||0,Ze=Ae.p||0,Qe=Ae.b||0,St=Ae.l,Et=Ae.d,ln=Ae.m,Kt=Ae.n,Ot=8*Ne;do{if(!St){pt=xl(pe,Ze,1);var wt=xl(pe,Ze+1,3);if(Ze+=3,!wt){var Pn=pe[(he=4+((Ze+7)/8|0))-4]|pe[he-3]<<8,Yt=he+Pn;if(Yt>Ne){at&&bl(0);break}yt&&et(Qe+Pn),Te.set(pe.subarray(he,Yt),Qe),Ae.b=Qe+=Pn,Ae.p=Ze=8*Yt,Ae.f=pt;continue}if(wt==1)St=p8,Et=m8,ln=9,Kt=5;else if(wt==2){var Jt=xl(pe,Ze,31)+257,xn=xl(pe,Ze+10,15)+4,zn=Jt+xl(pe,Ze+5,31)+1;Ze+=14;for(var Nn=new wa(zn),Xn=new wa(19),Vn=0;Vn<xn;++Vn)Xn[d8[Vn]]=xl(pe,Ze+3*Vn,7);Ze+=3*xn;var Yn=TT(Xn),Ir=(1<<Yn)-1,Yr=Xy(Xn,Yn);for(Vn=0;Vn<zn;){var he,me=Yr[xl(pe,Ze,Ir)];if(Ze+=15&me,(he=me>>4)<16)Nn[Vn++]=he;else{var nt=0,Rt=0;for(he==16?(Rt=3+xl(pe,Ze,3),Ze+=2,nt=Nn[Vn-1]):he==17?(Rt=3+xl(pe,Ze,7),Ze+=3):he==18&&(Rt=11+xl(pe,Ze,127),Ze+=7);Rt--;)Nn[Vn++]=nt}}var Ft=Nn.subarray(0,Jt),zt=Nn.subarray(Jt);ln=TT(Ft),Kt=TT(zt),St=Xy(Ft,ln),Et=Xy(zt,Kt)}else bl(1);if(Ze>Ot){at&&bl(0);break}}yt&&et(Qe+131072);for(var Xt=(1<<ln)-1,yn=(1<<Kt)-1,er=Ze;;er=Ze){var tr=(nt=St[ET(pe,Ze)&Xt])>>4;if((Ze+=15&nt)>Ot){at&&bl(0);break}if(nt||bl(2),tr<256)Te[Qe++]=tr;else{if(tr==256){er=Ze,St=null;break}var Un=tr-254;tr>264&&(Un=xl(pe,Ze,(1<<(nr=Ok[Vn=tr-257]))-1)+Vk[Vn],Ze+=nr);var Dr=Et[ET(pe,Ze)&yn],Hr=Dr>>4;if(Dr||bl(3),Ze+=15&Dr,zt=f8[Hr],Hr>3){var nr=Fk[Hr];zt+=ET(pe,Ze)&(1<<nr)-1,Ze+=nr}if(Ze>Ot){at&&bl(0);break}yt&&et(Qe+131072);var vi=Qe+Un;if(Qe<zt){var Kr=0-zt,Pr=Math.min(zt,vi);for(Kr+Qe<0&&bl(3);Qe<Pr;++Qe)Te[Qe]=(void 0)[Kr+Qe]}for(;Qe<vi;++Qe)Te[Qe]=Te[Qe-zt]}}Ae.l=St,Ae.p=er,Ae.b=Qe,Ae.f=pt,St&&(pt=1,Ae.m=ln,Ae.d=Et,Ae.n=Kt)}while(!pt);return Qe!=Te.length&&Ke?(_t=Te,((xt=Qe)==null||xt>_t.length)&&(xt=_t.length),new wa(_t.subarray(0,xt))):Te.subarray(0,Qe)}(ce.subarray(q,-8),{i:2},new wa(((Q=ce)[(le=Q.length)-4]|Q[le-3]<<8|Q[le-2]<<16|Q[le-1]<<24)>>>0))));var Q,le,ce,q;const re=v8[Z];if(!re)throw new Error(`Unhandled codec: ${Z}`);const ue=new globalThis.DecompressionStream(re);return new Response(new Blob([G]).stream().pipeThrough(ue)).arrayBuffer().then(pe=>new Uint8Array(pe))}(M,P).then(G=>(function(Z,Q){Z.readFields(s8,Q)}(new CT(G),L),new b8[v](L.buffer))),O.then(G=>{for(let Z=I.length-1;Z>=0;Z--)switch(I[Z]){case"delta_filter":a8(G,S);break;case"zigzag_filter":l8(G);break;case"bitshuffle_filter":c8(G,v);break;default:throw new $a(`Unhandled filter "${I[Z]}"`)}return{layerName:u,blockIndex:T,data:G}}).catch(G=>{throw G})}))},Ht(qk,"MRTDecodingBatch",{omit:["_onCancel","_onComplete"]}),Ht(j1,"MapboxRasterTile"),Ht(Hk,"MapboxRasterLayer",{omit:["_blocksInProgress"]});class Xk{constructor(e){this._stringToNumber={},this._numberToString=[];for(let i=0;i<e.length;i++){const c=e[i];this._stringToNumber[c]=i,this._numberToString[i]=c}}encode(e){return this._stringToNumber[e]}decode(e){return this._numberToString[e]}}const I8=["id","tile","layer","source","sourceLayer","state"];class Bm{constructor(e,i,c,u,p){this.type="Feature",this._vectorTileFeature=e,this._z=i,this._x=c,this._y=u,this.properties=e.properties,this.id=p}clone(){const e=new Bm(this._vectorTileFeature,this._z,this._x,this._y,this.id);return this.state&&(e.state=Object.assign({},this.state)),this.layer&&(e.layer=Object.assign({},this.layer)),this.source&&(e.source=this.source),this.sourceLayer&&(e.sourceLayer=this.sourceLayer),e}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._x,this._y,this._z).geometry),this._geometry}set geometry(e){this._geometry=e}toJSON(){const e={type:"Feature",state:void 0,geometry:this.geometry,properties:this.properties};for(const i of I8)this[i]!==void 0&&(e[i]=this[i]);return e}}class Yk{constructor(e,i){this.tileID=e,this.x=e.canonical.x,this.y=e.canonical.y,this.z=e.canonical.z,this.grid=new dl(Lt,16,0),this.featureIndexArray=new O0,this.promoteId=i,this.is3DTile=!1,this.serializedLayersCache=new Map}insert(e,i,c,u,p,m=0,v=0){const S=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(c,u,p,m);const T=this.grid;for(let I=0;I<i.length;I++){const P=i[I],M=[1/0,1/0,-1/0,-1/0];for(let L=0;L<P.length;L++){const O=P[L];M[0]=Math.min(M[0],O.x),M[1]=Math.min(M[1],O.y),M[2]=Math.max(M[2],O.x),M[3]=Math.max(M[3],O.y)}v!==0&&(M[0]-=v,M[1]-=v,M[2]+=v,M[3]+=v),M[0]<Lt&&M[1]<Lt&&M[2]>=0&&M[3]>=0&&T.insert(S,M[0],M[1],M[2],M[3])}}loadVTLayers(){if(!this.vtLayers){this.vtLayers=new Gn.VectorTile(new l1(this.rawTileData)).layers,this.sourceLayerCoder=new Xk(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"]),this.vtFeatures={};for(const e in this.vtLayers)this.vtFeatures[e]=[]}return this.vtLayers}query(e,i){const{tilespaceGeometry:c,transform:u,tileTransform:p,pixelPosMatrix:m,availableImages:v,worldview:S}=i;this.loadVTLayers(),this.serializedLayersCache.clear();const T=c.bufferedTilespaceBounds,I=this.grid.query(T.min.x,T.min.y,T.max.x,T.max.y,(O,G,Z,Q)=>fd(c.bufferedTilespaceGeometry,O,G,Z,Q));I.sort(P8);let P=null;u.elevation&&I.length>0&&(P=zm.create(u.elevation,this.tileID));const M={};let L;for(let O=0;O<I.length;O++){const G=I[O];if(G===L)continue;L=G;const Z=this.featureIndexArray.get(G);let Q=null;this.is3DTile?this.loadMatchingModelFeature(M,Z,e,c,u,S):this.loadMatchingFeature(M,Z,e,v,S,(le,ce,q,re=0)=>(Q||(Q=Wt(le,this.tileID.canonical,p)),ce.queryIntersectsFeature(c,le,q,Q,this.z,u,m,P,re)))}return M}loadMatchingFeature(e,i,c,u,p,m){const{featureIndex:v,bucketIndex:S,sourceLayerIndex:T,layoutVertexArrayOffset:I}=i,P=this.bucketLayerIDs[S],M=c.layers,L=Object.keys(M);if(L.length&&!Rn(L,P))return;const O=c.sourceCache,G=this.sourceLayerCoder.decode(T),Z=this.vtLayers[G].feature(v),Q=this.getId(Z,G);for(let le=0;le<P.length;le++){const ce=P[le];if(!M[ce])continue;const{styleLayer:q,targets:re}=M[ce];let ue={};Q!==void 0&&(ue=O.getFeatureState(q.sourceLayer,Q));const pe=!m||m(Z,q,ue,I);if(!pe)continue;const Ae=new Bm(Z,this.z,this.x,this.y,Q);Ae.tile=this.tileID.canonical,Ae.state=ue;let Te=this.serializedLayersCache.get(ce);Te||(Te=q.serialize(),Te.id=ce,this.serializedLayersCache.set(ce,Te)),Ae.source=Te.source,Ae.sourceLayer=Te["source-layer"],Ae.layer=$e({},Te),Ae.layer.paint=Kk(Te.paint,q.paint,Z,ue,u),Ae.layer.layout=Kk(Te.layout,q.layout,Z,ue,u);let Ie=!1;for(const Ne of re){this.updateFeatureProperties(Ae,Ne);const{filter:Ke}=Ne;if(Ke){if(Z.properties=Ae.properties,Ke.needGeometry){const yt=Vt(Z,!0);if(!Ke.filter(new Fr(this.tileID.overscaledZ,{worldview:p}),yt,this.tileID.canonical))continue}else if(!Ke.filter(new Fr(this.tileID.overscaledZ,{worldview:p}),Z))continue}Ie=!0,Ne.targetId&&this.addFeatureVariant(Ae,Ne)}Ie&&this.appendToResult(e,ce,v,Ae,pe)}}loadMatchingModelFeature(e,i,c,u,p,m){const{featureIndex:v,bucketIndex:S}=i,T=this.bucketLayerIDs[S],I=c.layers,P=Object.keys(I);if(!P.length||Rn(P,T))for(let M=0;M<T.length;M++){const L=T[M],{styleLayer:O,targets:G}=I[L];if(O.type!=="model")continue;const Z=u.tile,Q=Z.getBucket(O);if(!(Q&&Q instanceof k1))continue;const le=IU(Q,v,u,p);if(!le)continue;const{z:ce,x:q,y:re}=Z.tileID.canonical,{feature:ue,intersectionZ:pe,position:Ae}=le;let Te={};ue.id!==void 0&&(Te=c.sourceCache.getFeatureState(O.sourceLayer,ue.id));const Ie=new Bm({},ce,q,re,ue.id);Ie.tile=this.tileID.canonical,Ie.state=Te,Ie.properties=ue.properties,Ie.geometry={type:"Point",coordinates:[Ae.lng,Ae.lat]};let Ne=this.serializedLayersCache.get(L);Ne||(Ne=O.serialize(),Ne.id=L,this.serializedLayersCache.set(L,Ne)),Ie.source=Ne.source,Ie.sourceLayer=Ne["source-layer"],Ie.layer=$e({},Ne);let Ke=!1;for(const yt of G){this.updateFeatureProperties(Ie,yt);const{filter:at}=yt;if(at){if(ue.properties=Ie.properties,at.needGeometry){if(!at.filter(new Fr(this.tileID.overscaledZ,{worldview:m}),ue,this.tileID.canonical))continue}else if(!at.filter(new Fr(this.tileID.overscaledZ,{worldview:m}),ue))continue}Ke=!0,yt.targetId&&this.addFeatureVariant(Ie,yt)}Ke&&this.appendToResult(e,L,v,Ie,pe)}}updateFeatureProperties(e,i,c){if(i.properties){const u={};for(const p in i.properties){const m=i.properties[p].evaluate({zoom:this.z},e._vectorTileFeature,e.state,e.tile,c);m!=null&&(u[p]=m)}e.properties=u}}addFeatureVariant(e,i,c){const u={target:i.target,namespace:i.namespace,uniqueFeatureID:i.uniqueFeatureID};i.properties&&(u.properties=e.properties),e.variants=e.variants||{},e.variants[i.targetId]=e.variants[i.targetId]||[],e.variants[i.targetId].push(u)}appendToResult(e,i,c,u,p){let m=e[i];m===void 0&&(m=e[i]=[]),m.push({featureIndex:c,feature:u,intersectionZ:p})}lookupSymbolFeatures(e,i,c,u,p,m){const v={};this.loadVTLayers();for(const S of e)this.loadMatchingFeature(v,{bucketIndex:i,sourceLayerIndex:c,featureIndex:S,layoutVertexArrayOffset:0},u,p,m);return v}loadFeature(e){const{featureIndex:i,sourceLayerIndex:c}=e;this.loadVTLayers();const u=this.sourceLayerCoder.decode(c),p=this.vtFeatures[u];if(p[i])return p[i];const m=this.vtLayers[u].feature(i);return p[i]=m,m}hasLayer(e){for(const i of this.bucketLayerIDs)for(const c of i)if(e===c)return!0;return!1}getId(e,i){let c=e.id;if(this.promoteId){const u=Array.isArray(this.promoteId)||typeof this.promoteId!="object"?this.promoteId:this.promoteId[i];if(u!=null)if(Array.isArray(u)){if(!this.promoteIdExpression){const p=ul(u);if(p.result!=="success"){const m=p.value.map(v=>`${v.key}: ${v.message}`).join(", ");return void On(`Failed to create expression for promoteId: ${m}`)}this.promoteIdExpression=p.value}this.promoteIdExpression._evaluator||(this.promoteIdExpression._evaluator=new $h),c=this.promoteIdExpression.evaluate({zoom:0},e)}else c=e.properties[u];typeof c=="boolean"&&(c=Number(c))}return c}}function Kk(o,e,i,c,u){return en(o,(p,m)=>{const v=e instanceof ru?e.get(m):null;return v&&v.evaluate?v.evaluate(i,c,void 0,u):v})}function P8(o,e){return e-o}Ht(Yk,"FeatureIndex",{omit:["rawTileData","sourceLayerCoder"]});const Qk=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class IT{static from(e){if(!(e instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[i,c]=new Uint8Array(e,0,2);if(i!==219)throw new Error("Data does not appear to be in a KDBush format.");const u=c>>4;if(u!==1)throw new Error(`Got v${u} data when expected v1.`);const p=Qk[15&c];if(!p)throw new Error("Unrecognized array type.");const[m]=new Uint16Array(e,2,1),[v]=new Uint32Array(e,4,1);return new IT(v,m,p,e)}constructor(e,i=64,c=Float64Array,u){if(isNaN(e)||e<0)throw new Error(`Unpexpected numItems value: ${e}.`);this.numItems=+e,this.nodeSize=Math.min(Math.max(+i,2),65535),this.ArrayType=c,this.IndexArrayType=e<65536?Uint16Array:Uint32Array;const p=Qk.indexOf(this.ArrayType),m=2*e*this.ArrayType.BYTES_PER_ELEMENT,v=e*this.IndexArrayType.BYTES_PER_ELEMENT,S=(8-v%8)%8;if(p<0)throw new Error(`Unexpected typed array class: ${c}.`);u&&u instanceof ArrayBuffer?(this.data=u,this.ids=new this.IndexArrayType(this.data,8,e),this.coords=new this.ArrayType(this.data,8+v+S,2*e),this._pos=2*e,this._finished=!0):(this.data=new ArrayBuffer(8+m+v+S),this.ids=new this.IndexArrayType(this.data,8,e),this.coords=new this.ArrayType(this.data,8+v+S,2*e),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+p]),new Uint16Array(this.data,2,1)[0]=i,new Uint32Array(this.data,4,1)[0]=e)}add(e,i){const c=this._pos>>1;return this.ids[c]=c,this.coords[this._pos++]=e,this.coords[this._pos++]=i,c}finish(){const e=this._pos>>1;if(e!==this.numItems)throw new Error(`Added ${e} items when expected ${this.numItems}.`);return PT(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(e,i,c,u){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:p,coords:m,nodeSize:v}=this,S=[0,p.length-1,0],T=[];for(;S.length;){const I=S.pop()||0,P=S.pop()||0,M=S.pop()||0;if(P-M<=v){for(let Z=M;Z<=P;Z++){const Q=m[2*Z],le=m[2*Z+1];Q>=e&&Q<=c&&le>=i&&le<=u&&T.push(p[Z])}continue}const L=M+P>>1,O=m[2*L],G=m[2*L+1];O>=e&&O<=c&&G>=i&&G<=u&&T.push(p[L]),(I===0?e<=O:i<=G)&&(S.push(M),S.push(L-1),S.push(1-I)),(I===0?c>=O:u>=G)&&(S.push(L+1),S.push(P),S.push(1-I))}return T}within(e,i,c){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:u,coords:p,nodeSize:m}=this,v=[0,u.length-1,0],S=[],T=c*c;for(;v.length;){const I=v.pop()||0,P=v.pop()||0,M=v.pop()||0;if(P-M<=m){for(let Z=M;Z<=P;Z++)eD(p[2*Z],p[2*Z+1],e,i)<=T&&S.push(u[Z]);continue}const L=M+P>>1,O=p[2*L],G=p[2*L+1];eD(O,G,e,i)<=T&&S.push(u[L]),(I===0?e-c<=O:i-c<=G)&&(v.push(M),v.push(L-1),v.push(1-I)),(I===0?e+c>=O:i+c>=G)&&(v.push(L+1),v.push(P),v.push(1-I))}return S}}function PT(o,e,i,c,u,p){if(u-c<=i)return;const m=c+u>>1;Jk(o,e,m,c,u,p),PT(o,e,i,c,m-1,1-p),PT(o,e,i,m+1,u,1-p)}function Jk(o,e,i,c,u,p){for(;u>c;){if(u-c>600){const T=u-c+1,I=i-c+1,P=Math.log(T),M=.5*Math.exp(2*P/3),L=.5*Math.sqrt(P*M*(T-M)/T)*(I-T/2<0?-1:1);Jk(o,e,i,Math.max(c,Math.floor(i-I*M/T+L)),Math.min(u,Math.floor(i+(T-I)*M/T+L)),p)}const m=e[2*i+p];let v=c,S=u;for(Ky(o,e,c,i),e[2*u+p]>m&&Ky(o,e,c,u);v<S;){for(Ky(o,e,v,S),v++,S--;e[2*v+p]<m;)v++;for(;e[2*S+p]>m;)S--}e[2*c+p]===m?Ky(o,e,c,S):(S++,Ky(o,e,S,u)),S<=i&&(c=S+1),i<=S&&(u=S-1)}}function Ky(o,e,i,c){MT(o,i,c),MT(e,2*i,2*c),MT(e,2*i+1,2*c+1)}function MT(o,e,i){const c=o[e];o[e]=o[i],o[i]=c}function eD(o,e,i,c){const u=o-i,p=e-c;return u*u+p*p}s.$=ps,s.A=$c,s.B=ll,s.C=su,s.D=Am,s.E=Gc,s.F=2,s.G=Oy,s.H=yR,s.I=vo,s.J=Kl,s.K=class extends M1{},s.L=qc,s.M=ya,s.N=Jh,s.O=Qh,s.P=Dt,s.Q=H_,s.R=Dh,s.S=rm,s.T=uT,s.U=am,s.V=M1,s.W=_0,s.X=ul,s.Y=Gp,s.Z=Zu,s._=Wu,s.a=function(o){return vs.API_CDN_URL_REGEX.test(o)},s.a$=qe,s.a0=Hc,s.a1=lm,s.a2=ef,s.a3=G_,s.a4=function(o){const e=o.value;let i=[];if(!e)return i;const c=Kl(e);return c!=="string"?(i=i.concat([new M1(o.key,e,`string expected, "${c}" found`)]),i):(pT(e,!0)||(i=i.concat([new M1(o.key,e,`invalid url "${e}"`)])),i)},s.a5=Oe,s.a6=S0,s.a7=Ti,s.a8=bt,s.a9=class{constructor(o){this.specification=o}possiblyEvaluate(o,e){return ci(o.expression.evaluate(e))}interpolate(o,e,i){return{x:vn(o.x,e.x,i),y:vn(o.y,e.y,i),z:vn(o.z,e.z,i),azimuthal:vn(o.azimuthal,e.azimuthal,i),polar:vn(o.polar,e.polar,i)}}},s.aA=ut,s.aB=b,s.aC=Ua,s.aD=ve,s.aE=Ge,s.aF=function(o,e){const i={};for(let c=0;c<e.length;c++){const u=e[c];u in o&&(i[u]=o[u])}return i},s.aG=fe,s.aH=ye,s.aI=class{constructor(o){this.entries={},this.scheduler=o}request(o,e,i,c){const u=this.entries[o]=this.entries[o]||{callbacks:[]};if(u.result){const[p,m]=u.result;return this.scheduler?this.scheduler.add(()=>{c(p,m)},e):c(p,m),()=>{}}return u.callbacks.push(c),u.cancel||(u.cancel=i((p,m)=>{u.result=[p,m];for(const v of u.callbacks)this.scheduler?this.scheduler.add(()=>{v(p,m)},e):v(p,m);setTimeout(()=>delete this.entries[o],3e3)})),()=>{u.result||(u.callbacks=u.callbacks.filter(p=>p!==c),u.callbacks.length||(u.cancel(),delete this.entries[o]))}}},s.aJ=function(o,e,i){const c=JSON.stringify(o.request);return o.data&&(this.deduped.entries[c]={result:[null,o.data]}),this.deduped.request(c,{type:"parseTile",isSymbolTile:o.isSymbolTile,zoom:o.tileZoom},u=>{const p=Lh(o.request,(m,v,S,T)=>{m?u(m):v&&u(null,{vectorTile:i?void 0:new Gn.VectorTile(new l1(v)),rawData:v,cacheControl:S,expires:T})});return()=>{p.cancel(),u()}},e)},s.aK=function(o){f_++,f_>sl&&(o.getActor().send("enforceCacheSizeLimit",ma),f_=0)},s.aL=function(o){return o<=1?1:Math.pow(2,Math.floor(Math.log(o)/Math.LN2))},s.aM=Js,s.aN=WR,s.aO=JR,s.aP=qR,s.aQ=function(o,e){const i=document.createElement("video");i.muted=!0,i.onloadstart=function(){e(null,i)};for(let c=0;c<o.length;c++){const u=document.createElement("source");k2(o[c])||(i.crossOrigin="Anonymous"),u.src=o[c],i.appendChild(u)}return{cancel:()=>{}}},s.aR=E1,s.aS=function(o){return fetch(o).then(e=>e.arrayBuffer()).then(e=>OM(e,0,o))},s.aT=Zk,s.aU=class{constructor(o,e,i,c){this.id=o,this.position=e!=null?new ie(e[0],e[1]):new ie(0,0),this.orientation=i??[0,0,0],this.nodes=c,this.uploaded=!1,this.aabb=new gr([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),this.matrix=[]}_applyTransformations(o,e){if(Y(o.matrix,e,o.matrix),o.meshes)for(const i of o.meshes){const c=gr.applyTransformFast(i.aabb,o.matrix);this.aabb.encapsulate(c)}if(o.children)for(const i of o.children)this._applyTransformations(i,o.matrix)}computeBoundsAndApplyParent(){const o=H([]);for(const e of this.nodes)this._applyTransformations(e,o)}computeModelMatrix(o,e,i,c,u,p,m=!1){uk(this.matrix,this,o.transform,this.position,e,i,c,u,p,m)}upload(o){if(!this.uploaded){for(const e of this.nodes)gT(e,o);for(const e of this.nodes)R1(e);this.uploaded=!0}}destroy(){for(const o of this.nodes)_T(o)}},s.aV=Qt,s.aW=jy,s.aX=Ee,s.aY=Fe,s.aZ=rd,s.a_=bs,s.aa=Fr,s.ab=nf,s.ac=Re,s.ad=Mn,s.ae=$t,s.af=ke,s.ag=ru,s.ah=pd,s.ai=vn,s.aj=Lt,s.ak=kp,s.al=mr,s.am=Er,s.an=class{constructor(o){this.specification=o}possiblyEvaluate(o,e){return function([i,c]){const u=ci([1,i,c]);return{x:u.x,y:u.y,z:u.z}}(o.expression.evaluate(e))}interpolate(o,e,i){return{x:vn(o.x,e.x,i),y:vn(o.y,e.y,i),z:vn(o.z,e.z,i)}}},s.ao=function(o,e,i=0,c=!0){const u=new Dt(i,i),p=o.sub(u),m=e.add(u),v=[p,new Dt(m.x,p.y),m,new Dt(p.x,m.y)];return c&&v.push(p.clone()),v},s.ap=function(o,e){const i=[];for(let c=0;c<o.length;c++){const u=Ue(c-1,-1,o.length-1),p=Ue(c+1,-1,o.length-1),m=o[c],v=o[p],S=o[u].sub(m).unit(),T=v.sub(m).unit(),I=T.angleWithSep(S.x,S.y),P=S.add(T).unit().mult(-1*e/Math.sin(I/2));i.push(m.add(P))}return i},s.aq=kR,s.ar=fd,s.as=function(o,e,i=0){return Ve(((e.x-i)*o.scale-o.x)*Lt,(e.y*o.scale-o.y)*Lt,je(e.z,e.y))},s.at=Tr,s.au=Hn,s.av=ii,s.aw=GM,s.ax=function(o){let e=1/0,i=1/0,c=-1/0,u=-1/0;for(const p of o)e=Math.min(e,p.x),i=Math.min(i,p.y),c=Math.max(c,p.x),u=Math.max(u,p.y);return{min:new Dt(e,i),max:new Dt(c,u)}},s.ay=xe,s.az=Y,s.b=function(o){return vs.API_FONTS_REGEX.test(o)},s.b$=function(o,e,i){i*=.5;var c=e[0],u=e[1],p=e[2],m=e[3],v=Math.sin(i),S=Math.cos(i);return o[0]=c*S+u*v,o[1]=u*S-c*v,o[2]=p*S+m*v,o[3]=m*S-p*v,o},s.b0=gm,s.b1=S1,s.b2=function(){pl.isLoading()||pl.isLoaded()||ed()!=="deferred"||w0()},s.b3=K_,s.b4=Vt,s.b5=Bm,s.b6=_r,s.b7=US,s.b8=PS,s.b9=Wt,s.bA=function(o,e){const{x:i,y:c}=o.point,u=SP(i,c,o.worldSize/o._pixelsPerMercatorPixel,0,0);return Y(u,u,vS(pc(e)))},s.bB=V,s.bC=function(o){return o[0]=0,o[1]=0,o[2]=0,o},s.bD=function(o,e){return Math.hypot(e[0]-o[0],e[1]-o[1],e[2]-o[2])},s.bE=Zt,s.bF=an,s.bG=rn,s.bH=zy,s.bI=jo,s.bJ=YS,s.bK=function(o,e,i,c,u){const p=5*e+2;o.float32[p+0]=i,o.float32[p+1]=c,o.float32[p+2]=u},s.bL=w1,s.bM=i1,s.bN=co,s.bO=ms,s.bP=JP,s.bQ=sk,s.bR=iM,s.bS=sM,s.bT=XS,s.bU=ER,s.bV=eT,s.bW=IT,s.bX=Ue,s.bY=Ct,s.bZ=Cs,s.b_=bn,s.ba=ml,s.bb=ff,s.bc=_P,s.bd=Ai,s.be=xy,s.bf=aT,s.bg=function(o,e){const i=pd(e.zoom);if(i===0)return pc(o);const c=W0(o),u=yS(c),p=ve(c.getWest())*e.worldSize,m=ve(c.getEast())*e.worldSize,v=ye(c.getNorth())*e.worldSize,S=ye(c.getSouth())*e.worldSize,T=[p,v,0],I=[m,v,0],P=[p,S,0],M=[m,S,0],L=ne([],e.globeMatrix);return Mn(T,T,L),Mn(I,I,L),Mn(P,P,L),Mn(M,M,L),u[0]=lu(u[0],P,i),u[1]=lu(u[1],M,i),u[2]=lu(u[2],I,i),u[3]=lu(u[3],T,i),gr.fromPoints(u)},s.bh=X0,s.bi=ne,s.bj=yy,s.bk=lu,s.bl=lf,s.bm=vV,s.bn=Pe,s.bo=te,s.bp=j1,s.bq=l1,s.br=Lh,s.bs=function(o,e){const i=[];for(const c in o)c in e||i.push(c);return i},s.bt=De,s.bu=["type","source","source-layer","minzoom","maxzoom","filter","layout"],s.bv=rl,s.bw=function(o){var e=new z(16);return e[0]=o[0],e[1]=o[1],e[2]=o[2],e[3]=o[3],e[4]=o[4],e[5]=o[5],e[6]=o[6],e[7]=o[7],e[8]=o[8],e[9]=o[9],e[10]=o[10],e[11]=o[11],e[12]=o[12],e[13]=o[13],e[14]=o[14],e[15]=o[15],e},s.bx=H,s.by=lt,s.bz=ae,s.c=Sp,s.c$=s1,s.c0=pn,s.c1=Si,s.c2=function(o,e){return o[0]=-e[0],o[1]=-e[1],o[2]=-e[2],o[3]=e[3],o},s.c3=vt,s.c4=function(o,e,i,c,u){var p,m=1/Math.tan(e/2);return o[0]=m/i,o[1]=0,o[2]=0,o[3]=0,o[4]=0,o[5]=m,o[6]=0,o[7]=0,o[8]=0,o[9]=0,o[11]=-1,o[12]=0,o[13]=0,o[15]=0,u!=null&&u!==1/0?(o[10]=(u+c)*(p=1/(c-u)),o[14]=2*u*c*p):(o[10]=-1,o[14]=-2*c),o},s.c5=function(o,e,i,c,u,p,m){var v=1/(e-i),S=1/(c-u),T=1/(p-m);return o[0]=-2*v,o[1]=0,o[2]=0,o[3]=0,o[4]=0,o[5]=-2*S,o[6]=0,o[7]=0,o[8]=0,o[9]=0,o[10]=2*T,o[11]=0,o[12]=(e+i)*v,o[13]=(u+c)*S,o[14]=(m+p)*T,o[15]=1,o},s.c6=Se,s.c7=function(o,e,i){o[4*e+0]=i[0],o[4*e+1]=i[1],o[4*e+2]=i[2],o[4*e+3]=i[3]},s.c8=xm,s.c9=_f,s.cA=I1,s.cB=It,s.cC=ek,s.cD=function(o){const e=ek(o,!0);return V([],[e[0],e[1],e[4],e[5]])},s.cE=de,s.cF=Gr,s.cG=Me,s.cH=function(o){const{x:e,y:i}=o.point,{lng:c,lat:u}=o._center;return SP(e,i,o.worldSize,c,u)},s.cI=mt,s.cJ=He,s.cK=Em,s.cL=E,s.cM=function(o,e,i){let c=0;for(let u=0;u<2;++u)o[u]>0&&(c+=(o[u]-0)*(o[u]-0)),e[u]<0&&(c+=(0-e[u])*(0-e[u]));return c},s.cN=function(o){return o*o*o*o*o},s.cO=be,s.cP=45,s.cQ=bm,s.cR=function(o,e,i){const c=Math.sqrt(o*o+e*e+i*i),u=c>0?Math.acos(i/c)*Eh:0;let p=o!==0||e!==0?Math.atan2(-e,-o)*Eh+90:0;return p<0&&(p+=360),[c,p,u]},s.cS=Ve,s.cT=ci,s.cU=Xe,s.cV=jt,s.cW=gr,s.cX=Je,s.cY=function(o){return[Math.pow(o[0],1/2.2),Math.pow(o[1],1/2.2),Math.pow(o[2],1/2.2)]},s.cZ=pT,s.c_=function(o,e){return o.readFields(RU,{icons:[]},e)},s.ca=ji,s.cb=Ba,s.cc=cd,s.cd=ie,s.ce=OR,s.cf=function(){var o=new z(4);return z!=Float32Array&&(o[1]=0,o[2]=0),o[0]=1,o[3]=1,o},s.cg=function(o,e,i){var c=e[0],u=e[1],p=e[2],m=e[3],v=Math.sin(i),S=Math.cos(i);return o[0]=c*S+p*v,o[1]=u*S+m*v,o[2]=c*-v+p*S,o[3]=u*-v+m*S,o},s.ch=function(o,e){return o[0]===e[0]&&o[1]===e[1]&&o[2]===e[2]&&o[3]===e[3]},s.ci=xr,s.cj=function(o){return Math.hypot(o[0],o[1],o[2],o[3])},s.ck=As,s.cl=Lr,s.cm=gP,s.cn=di,s.co=tk,s.cp=wf,s.cq=xP,s.cr=function(o,e,i,c,u,p,m,v,S){if(S.name==="globe")return xP(o,e,new wf(i,c,u),!1);const T=jy({z:i,x:c,y:u},S);return new gr([(p+T.x/T.scale)*e,e*(T.y/T.scale),m],[(p+T.x2/T.scale)*e,e*(T.y2/T.scale),v])},s.cs=function(o,e,i){return o[0]=Math.min(e[0],i[0]),o[1]=Math.min(e[1],i[1]),o[2]=Math.min(e[2],i[2]),o[3]=Math.min(e[3],i[3]),o},s.ct=function(o,e,i){return o[0]=Math.max(e[0],i[0]),o[1]=Math.max(e[1],i[1]),o[2]=Math.max(e[2],i[2]),o[3]=Math.max(e[3],i[3]),o},s.cu=function(o){const e=Math.round((o+45+360)%360/90)%4;return J[e]},s.cv=rt,s.cw=Ws,s.cx=A,s.cy=function(o){const e=H(new Float64Array(16));Y(e,o.pixelMatrix,o.globeMatrix);const i=[0,N,0],c=[0,j,0];return Mn(i,i,e),Mn(c,c,e),[i[0]>0&&i[0]<=o.width&&i[1]>0&&i[1]<=o.height&&!bS(o,new ie(o.center.lat,90)),c[0]>0&&c[0]<=o.width&&c[1]>0&&c[1]<=o.height&&!bS(o,new ie(o.center.lat,-90))]},s.cz=function(o,e){const{scale:i}=o.tileTransform,c=i*Lt/(o.tileSize*Math.pow(2,e.zoom-o.tileID.overscaledZ+o.tileID.canonical.z));return function(u,p,m){var v=p[1],S=p[2],T=p[3],I=m[0],P=m[1];return u[0]=p[0]*I,u[1]=v*I,u[2]=S*P,u[3]=T*P,u}(new Float32Array(4),e.inverseAdjustmentMatrix,[c,c])},s.d=function(o){return vs.API_TILEJSON_REGEX.test(o)},s.d$=uy,s.d0=km,s.d1=QS,s.d2=Ap,s.d3=nu,s.d4=Ko,s.d5=zh,s.d6=In,s.d7=function(o){const e=o.indexOf(of);return e>=0?o.slice(0,e):o},s.d8=function(o){return o.indexOf(of)>=0},s.d9=function(o){const e=o.lastIndexOf(of);return e>=0?o.slice(e+1):""},s.dA=wP,s.dB=so,s.dC=Os,s.dD=256,s.dE=function(o,e){const i=[0,0,0];return Mn(i,i,X0(pc(e.canonical))),Mn(i,i,o),i},s.dF=o=>({u_matrix:new cd(o),u_texsize:new Ba(o),u_pixels_to_tile_units:new yf(o),u_device_pixel_ratio:new ji(o),u_width_scale:new ji(o),u_floor_width_scale:new ji(o),u_image:new xm(o),u_units_to_pixels:new Ba(o),u_tile_units_to_pixels:new ji(o),u_alpha_discard_threshold:new ji(o),u_trim_offset:new Ba(o),u_trim_fade_range:new Ba(o),u_trim_color:new bm(o),u_emissive_strength:new ji(o),u_zbias_factor:new ji(o),u_tile_to_meter:new ji(o),u_ground_shadow_factor:new _f(o),u_pattern_transition:new ji(o)}),s.dG=o=>({u_matrix:new cd(o),u_pixels_to_tile_units:new yf(o),u_device_pixel_ratio:new ji(o),u_width_scale:new ji(o),u_floor_width_scale:new ji(o),u_units_to_pixels:new Ba(o),u_dash_image:new xm(o),u_gradient_image:new xm(o),u_image_height:new ji(o),u_texsize:new Ba(o),u_tile_units_to_pixels:new ji(o),u_alpha_discard_threshold:new ji(o),u_trim_offset:new Ba(o),u_trim_fade_range:new Ba(o),u_trim_color:new bm(o),u_emissive_strength:new ji(o),u_zbias_factor:new ji(o),u_tile_to_meter:new ji(o),u_ground_shadow_factor:new _f(o)}),s.dH=o=>({u_camera_to_center_distance:new ji(o),u_extrude_scale:new yf(o),u_device_pixel_ratio:new ji(o),u_matrix:new cd(o),u_inv_rot_matrix:new cd(o),u_merc_center:new Ba(o),u_tile_id:new _f(o),u_zoom_transition:new ji(o),u_up_dir:new _f(o),u_emissive_strength:new ji(o)}),s.dI=sy,s.dJ=N6,s.dK=CP,s.dL=(o,e,i,c,u,p)=>{const m=o.transform,v=m.projection.name==="globe";let S;if(p.paint.get("circle-pitch-alignment")==="map")if(v){const I=wP(m.zoom,e.canonical)*m._pixelsPerMercatorPixel;S=Float32Array.from([I,0,0,I])}else S=m.calculatePixelsToTileUnitsMatrix(i);else S=new Float32Array([m.pixelsToGLUnits[0],0,0,m.pixelsToGLUnits[1]]);const T={u_camera_to_center_distance:o.transform.getCameraToCenterDistance(m.projection),u_matrix:o.translatePosMatrix(e.projMatrix,i,p.paint.get("circle-translate"),p.paint.get("circle-translate-anchor")),u_device_pixel_ratio:pa.devicePixelRatio,u_extrude_scale:S,u_inv_rot_matrix:TV,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0],u_emissive_strength:p.paint.get("circle-emissive-strength")};if(v){T.u_inv_rot_matrix=c,T.u_merc_center=u,T.u_tile_id=[e.canonical.x,e.canonical.y,1<<e.canonical.z],T.u_zoom_transition=pd(m.zoom);const I=u[0]*Lt,P=u[1]*Lt;T.u_up_dir=m.projection.upVector(new wf(0,0,0),I,P)}return T},s.dM=ZM,s.dN=ao,s.dO=(o,e,i,c,u,p,m,v,S,T)=>{const I=o.transform,P=I.pitch<15?HM(.07,.7,xe((14-I.zoom)/5,0,1)):.07,M=i.paint.get("line-trim-color-use-theme").constantOr("default")==="none";return{u_matrix:WM(o,e,i,c),u_texsize:e.imageAtlasTexture?e.imageAtlasTexture.size:[0,0],u_pixels_to_tile_units:I.calculatePixelsToTileUnitsMatrix(e),u_device_pixel_ratio:u,u_width_scale:p,u_floor_width_scale:m,u_image:0,u_tile_units_to_pixels:qM(e,I),u_units_to_pixels:[1/I.pixelsToGLUnits[0],1/I.pixelsToGLUnits[1]],u_alpha_discard_threshold:0,u_trim_offset:v,u_trim_fade_range:i.paint.get("line-trim-fade-range"),u_trim_color:i.paint.get("line-trim-color").toPremultipliedRenderColor(M?null:i.lut).toArray01(),u_emissive_strength:i.paint.get("line-emissive-strength"),u_zbias_factor:P,u_tile_to_meter:Xe(e.tileID.canonical,0),u_ground_shadow_factor:S,u_pattern_transition:T}},s.dP=(o,e,i,c,u,p,m,v,S,T)=>{const I=o.transform,P=I.calculatePixelsToTileUnitsMatrix(e),M=i.paint.get("line-trim-color-use-theme").constantOr("default")==="none",L=I.pitch<15?HM(.07,.7,xe((14-I.zoom)/5,0,1)):.07;return{u_matrix:WM(o,e,i,c),u_pixels_to_tile_units:P,u_device_pixel_ratio:p,u_width_scale:m,u_floor_width_scale:v,u_units_to_pixels:[1/I.pixelsToGLUnits[0],1/I.pixelsToGLUnits[1]],u_dash_image:0,u_gradient_image:1,u_image_height:u,u_texsize:XM(i)&&e.lineAtlasTexture?e.lineAtlasTexture.size:[0,0],u_tile_units_to_pixels:qM(e,o.transform),u_alpha_discard_threshold:0,u_trim_offset:S,u_trim_fade_range:i.paint.get("line-trim-fade-range"),u_trim_color:i.paint.get("line-trim-color").toPremultipliedRenderColor(M?null:i.lut).toArray01(),u_emissive_strength:i.paint.get("line-emissive-strength"),u_zbias_factor:L,u_tile_to_meter:Xe(e.tileID.canonical,0),u_ground_shadow_factor:T}},s.dQ=kt,s.dR=vy,s.dS=je,s.dT=_V,s.dU=r1,s.dV=yM,s.dW=gd,s.dX=450,s.dY=7,s.dZ=gU,s.d_=hr,s.da=function(o){const e=[],i=o.id;return i===void 0&&e.push({message:`layers.${i}: missing required property "id"`}),o.render===void 0&&e.push({message:`layers.${i}: missing required method "render"`}),o.renderingMode&&o.renderingMode!=="2d"&&o.renderingMode!=="3d"&&e.push({message:`layers.${i}: property "renderingMode" must be either "2d" or "3d"`}),e},s.db=function(o,e,i,c){return o.type==="custom"?new _U(o,e):new PU[o.type](o,e,i,c)},s.dc=Tn,s.dd=function(o){const e=o.indexOf(of);return e>=0?o.slice(e+1):""},s.de=class extends Bm{constructor(o,e){super(o._vectorTileFeature,o._z,o._x,o._y,o.id),o.state&&(this.state=Object.assign({},o.state)),this.target=e.target,this.namespace=e.namespace,e.properties&&(this.properties=e.properties),this.target&&("featuresetId"in this.target&&!this.target.importId||"layerId"in this.target)&&(this.source=o.source,this.sourceLayer=o.sourceLayer,this.layer=o.layer)}toJSON(){const o=super.toJSON();return o.target=this.target,o.namespace=this.namespace,o}},s.df=om,s.dg=Lu,s.dh=function(o){return o({pluginStatus:Qs,pluginURL:fl}),om.on("pluginStateChange",o),o},s.di=$0,s.dj=class extends gl{constructor(o){super(o),this.current=py}set(o,e,i){if(this.fetchUniformLocation(o,e)){for(let c=0;c<9;c++)if(i[c]!==this.current[c]){this.current=i,this.gl.uniformMatrix3fv(this.location,!1,i);break}}}},s.dk=oe,s.dl=function(o,e,i){const c=pd(i.zoom),u=o.style.map._antialias,p=o.terrain&&o.terrain.exaggeration()>0;return c===0&&!u&&!p},s.dm=function(o){const e=o.pixelsPerMeter,i=e/Se(1,o.center.lat),c=H(new Float64Array(16));return te(c,c,[o.point.x,o.point.y,0]),de(c,c,[i,i,e]),Float32Array.from(c)},s.dn=W0,s.dp=function(o){const e=rt-5;o=xe(o,-80.051129,e)/e*90;const i=Math.pow(Math.abs(Math.sin(mr(o))),3);return Math.round(i*(F.length-1))},s.dq=function(o,e,i,c){const u=e.getNorth(),p=e.getSouth(),m=e.getWest(),v=e.getEast(),S=1<<o.z,T=v-m,I=u-p,P=T/D,M=-I/F[i],L=[0,P,0,M,0,0,u,m,0];if(o.z>0){const O=180/c;se(L,L,[O/T+1,0,0,0,O/I+1,0,-.5*O/P,.5*O/M,1])}return L[2]=S,L[5]=o.x,L[8]=o.y,L},s.dr=pc,s.ds=function(o,e,i){const c=H(new Float64Array(16)),u=(e/(1<<o)-.5)*Math.PI*2;return Le(c,i.globeMatrix,u),Float32Array.from(c)},s.dt=class{isDataAvailableAtPoint(o){const e=this._source();if(this.isUsingMockSource()||!e||o.y<0||o.y>1)return!1;const i=e.getSource().maxzoom,c=1<<i,u=Math.floor(o.x),p=Math.floor((o.x-u)*c),m=Math.floor(o.y*c),v=this.findDEMTileFor(new Js(i,u,i,p,m));return!(!v||!v.dem)}getAtPointOrZero(o,e=0){return this.getAtPoint(o,e)||0}getAtPoint(o,e,i=!0){if(this.isUsingMockSource())return null;e==null&&(e=null);const c=this._source();if(!c||o.y<0||o.y>1)return e;const u=c.getSource().maxzoom,p=1<<u,m=Math.floor(o.x),v=o.x-m,S=new Js(u,m,u,Math.floor(v*p),Math.floor(o.y*p)),T=this.findDEMTileFor(S);if(!T||!T.dem)return e;const I=T.dem,P=1<<T.tileID.canonical.z,M=(v*P-T.tileID.canonical.x)*I.dim,L=(o.y*P-T.tileID.canonical.y)*I.dim,O=Math.floor(M),G=Math.floor(L);return(i?this.exaggeration():1)*vn(vn(I.get(O,G),I.get(O,G+1),L-G),vn(I.get(O+1,G),I.get(O+1,G+1),L-G),M-O)}getAtTileOffset(o,e,i){const c=1<<o.canonical.z;return this.getAtPointOrZero(new Re(o.wrap+(o.canonical.x+e/Lt)/c,(o.canonical.y+i/Lt)/c))}getAtTileOffsetFunc(o,e,i,c){return u=>{const p=this.getAtTileOffset(o,u.x,u.y),m=c.upVector(o.canonical,u.x,u.y);return Ct(m,m,p*c.upVectorScale(o.canonical,e,i).metersToTile),m}}getForTilePoints(o,e,i,c){if(this.isUsingMockSource())return!1;const u=zm.create(this,o,c);return!!u&&(e.forEach(p=>{p[2]=this.exaggeration()*u.getElevationAt(p[0],p[1],i)}),!0)}getMinMaxForTile(o){if(this.isUsingMockSource())return null;const e=this.findDEMTileFor(o);if(!e||!e.dem)return null;const i=e.dem.tree,c=e.tileID,u=1<<o.canonical.z-c.canonical.z;let p=o.canonical.x/u-c.canonical.x,m=o.canonical.y/u-c.canonical.y,v=0;for(let S=0;S<o.canonical.z-c.canonical.z&&!i.leaves[v];S++){p*=2,m*=2;const T=2*Math.floor(m)+Math.floor(p);v=i.childOffsets[v]+T,p%=1,m%=1}return{min:this.exaggeration()*i.minimums[v],max:this.exaggeration()*i.maximums[v]}}getMinElevationBelowMSL(){throw new Error("Pure virtual method called.")}raycast(o,e,i){throw new Error("Pure virtual method called.")}pointCoordinate(o){throw new Error("Pure virtual method called.")}_source(){throw new Error("Pure virtual method called.")}isUsingMockSource(){throw new Error("Pure virtual method called.")}exaggeration(){throw new Error("Pure virtual method called.")}findDEMTileFor(o){throw new Error("Pure virtual method called.")}get visibleDemTiles(){throw new Error("Getter must be implemented in subclass.")}getMinMaxForVisibleTiles(){const o=this.visibleDemTiles;if(o.length===0)return null;let e=!1,i=Number.MAX_VALUE,c=Number.MIN_VALUE;for(const u of o){const p=this.getMinMaxForTile(u.tileID);p&&(i=Math.min(i,p.min),c=Math.max(c,p.max),e=!0)}return e?{min:i,max:c}:null}},s.du=zP,s.dv=q0,s.dw=function(o,e){return[Math.pow(o[0],2.2)*e,Math.pow(o[1],2.2)*e,Math.pow(o[2],2.2)*e]},s.dx=U,s.dy=function(o,e){var i=Math.sin(e),c=Math.cos(e);return o[0]=c,o[1]=i,o[2]=0,o[3]=-i,o[4]=c,o[5]=0,o[6]=0,o[7]=0,o[8]=1,o},s.dz=Mr,s.e=vs,s.e$=Xk,s.e0=256,s.e1=vS,s.e2=ja,s.e3=Le,s.e4=function(o,e){return o[0]=e[0],o[1]=e[1],o[2]=e[2],o[3]=e[4],o[4]=e[5],o[5]=e[6],o[6]=e[8],o[7]=e[9],o[8]=e[10],o},s.e5=uc,s.e6=hf,s.e7=h0,s.e8=function(o,e,i,c,u){return xe((o-e)/(i-e)*(u-c)+c,c,u)},s.e9=sn,s.eA=function(o,e,i){return o[0]=e[0]/i[0],o[1]=e[1]/i[1],o[2]=e[2]/i[2],o},s.eB=Ki,s.eC=W,s.eD=Qn,s.eE=function(o,e,i,c){return o[0]=e,o[1]=i,o[2]=c,o},s.eF=function([o,e,i]){const c=Math.hypot(o,e,i),u=Math.atan2(o,i),p=.5*Math.PI-Math.acos(-e/c);return new ie(He(u),He(p))},s.eG=We,s.eH=hT,s.eI=function(o){const e=o.navigator?o.navigator.userAgent:null;return!!function(i){if(ki==null){const c=i.navigator?i.navigator.userAgent:null;ki=!!i.safari||!(!c||!(/\b(iPad|iPhone|iPod)\b/.test(c)||c.match("Safari")&&!c.match("Chrome")))}return ki}(o)&&!(!e||!(e.match("Version/15.4")||e.match("Version/15.5")||e.match(/CPU (OS|iPhone OS) (15_4|15_5) like Mac OS X/)))},s.eJ=function(o,e){ma=o,sl=e},s.eK=bS,s.eL=TP,s.eM=function(o){const e=[0,0,0],i=H(new Float64Array(16));return Y(i,o.pixelMatrix,o.globeMatrix),Mn(e,e,i),new Dt(e[0],e[1])},s.eN=function(){const o=My;o&&(o.isPreloaded()&&o.numActive()===1?(o.release(zS),My=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},s.eO=function(){s1().acquire(zS)},s.eP=ed,s.eQ=function(o,e,i=!1){if(Qs===bo.deferred||Qs===bo.loading||Qs===bo.loaded)throw new Error("setRTLTextPlugin cannot be called multiple times.");fl=pa.resolveURL(o),Qs=bo.deferred,Y_=e,sm(),i||w0()},s.eR=function(o){Im=pa.resolveURL(o),Pm||(Pm=new Am(s1(),new Gc)),Pm.broadcast("setMeshoptUrl",Im)},s.eS=RM,s.eT=function(o){FS=pa.resolveURL(o),Pm||(Pm=new Am(s1(),new Gc)),Pm.broadcast("setDracoUrl",FS)},s.eU=MM,s.eV=Py,s.eW=function(o){const e=jc();if(!e)return;const i=e.delete(il);o&&i.then(()=>o()).catch(o)},s.eX=Cf,s.eY=Ht,s.eZ=md,s.e_=vl,s.ea=function(o,e){var i=e[0],c=e[1],u=e[2],p=e[3],m=e[4],v=e[5],S=e[6],T=e[7],I=e[8],P=I*m-v*T,M=-I*p+v*S,L=T*p-m*S,O=i*P+c*M+u*L;return O?(o[0]=P*(O=1/O),o[1]=(-I*c+u*T)*O,o[2]=(v*c-u*m)*O,o[3]=M*O,o[4]=(I*i-u*S)*O,o[5]=(-v*i+u*p)*O,o[6]=L*O,o[7]=(-T*i+c*S)*O,o[8]=(m*i-c*p)*O,o):null},s.eb=$n,s.ec=gt,s.ed=fT,s.ee=function(o,e){if(o===e){var i=e[1],c=e[2],u=e[3],p=e[6],m=e[7],v=e[11];o[1]=e[4],o[2]=e[8],o[3]=e[12],o[4]=i,o[6]=e[9],o[7]=e[13],o[8]=c,o[9]=p,o[11]=e[14],o[12]=u,o[13]=m,o[14]=v}else o[0]=e[0],o[1]=e[4],o[2]=e[8],o[3]=e[12],o[4]=e[1],o[5]=e[5],o[6]=e[9],o[7]=e[13],o[8]=e[2],o[9]=e[6],o[10]=e[10],o[11]=e[14],o[12]=e[3],o[13]=e[7],o[14]=e[11],o[15]=e[15];return o},s.ef=Ut,s.eg=[1,1,1],s.eh=class{constructor(o,e,i,c){this.context=o,this.format=c,this.size=i,this.texture=o.gl.createTexture();const[u,p,m]=this.size,{gl:v}=o;v.bindTexture(v.TEXTURE_3D,this.texture),o.pixelStoreUnpackFlipY.set(!1),o.pixelStoreUnpack.set(1),o.pixelStoreUnpackPremultiplyAlpha.set(!1),v.texImage3D(v.TEXTURE_3D,0,this.format,u,p,m,0,lT(this.format),cT(this.format),e.data)}bind(o,e){const{context:i}=this,{gl:c}=i;c.bindTexture(c.TEXTURE_3D,this.texture),o!==this.minFilter&&(c.texParameteri(c.TEXTURE_3D,c.TEXTURE_MAG_FILTER,o),c.texParameteri(c.TEXTURE_3D,c.TEXTURE_MIN_FILTER,o),this.minFilter=o),e!==this.wrapS&&(c.texParameteri(c.TEXTURE_3D,c.TEXTURE_WRAP_S,e),c.texParameteri(c.TEXTURE_3D,c.TEXTURE_WRAP_T,e),this.wrapS=e)}destroy(){const{gl:o}=this.context;o.deleteTexture(this.texture),this.texture=null}},s.ei=zm,s.ej=function(o,e,i,c){var u=new z(4);return u[0]=o,u[1]=e,u[2]=i,u[3]=c,u},s.ek=Ri,s.el=function(o,e,i,c){var u=e[0],p=e[1],m=e[2],v=e[3];return o[0]=u+c*(i[0]-u),o[1]=p+c*(i[1]-p),o[2]=m+c*(i[2]-m),o[3]=v+c*(i[3]-v),o},s.em=Nm,s.en=cc,s.eo=ou,s.ep=function(o,e,i,c,u,p,m,v,S,T,I,P,M,L,O,G){var Z=new z(16);return Z[0]=o,Z[1]=e,Z[2]=i,Z[3]=c,Z[4]=u,Z[5]=p,Z[6]=m,Z[7]=v,Z[8]=S,Z[9]=T,Z[10]=I,Z[11]=P,Z[12]=M,Z[13]=L,Z[14]=O,Z[15]=G,Z},s.eq=K,s.er=pm,s.es=ly,s.et=class{constructor(){this._updateTime=0,this._sourceIds=[],this._activeRegions=[],this._prevRegions=[],this._globalClipBounds={min:new Dt(1/0,1/0),max:new Dt(-1/0,-1/0)}}clear(){this._activeRegions.length>0&&++this._updateTime,this._activeRegions=[],this._prevRegions=[]}get updateTime(){return this._updateTime}getReplacementRegionsForTile(o,e=!1){const i=tM(new Dt(0,0),new Dt(Lt,Lt),o),c=[];if(e&&!RS(i,this._globalClipBounds))return c;for(const u of this._activeRegions){if(u.hiddenByOverlap||!RS(i,u))continue;const p=QV(u.min,u.max,o);c.push({min:p.min,max:p.max,sourceId:this._sourceIds[u.priority],footprint:u.footprint,footprintTileId:u.tileId,order:u.order,clipMask:u.clipMask,clipScope:u.clipScope})}return c}setSources(o){this._setSources(o.map(e=>({getSourceId:()=>e.cache.id,getFootprints:()=>{const i=[];for(const c of e.cache.getVisibleCoordinates()){const u=e.cache.getTile(c).buckets[e.layer];u&&u.updateFootprints(c.toUnwrapped(),i)}return i},getOrder:()=>e.order,getClipMask:()=>e.clipMask,getClipScope:()=>e.clipScope})))}_addSource(o){const e=o.getFootprints();if(e.length===0)return;const i=o.getOrder(),c=o.getClipMask(),u=o.getClipScope();for(const p of e){if(!p.footprint)continue;const m=tM(p.footprint.min,p.footprint.max,p.id);this._activeRegions.push({min:m.min,max:m.max,hiddenByOverlap:!1,priority:this._sourceIds.length,tileId:p.id,footprint:p.footprint,order:i,clipMask:c,clipScope:u})}this._sourceIds.push(o.getSourceId())}_computeReplacement(){this._activeRegions.sort((e,i)=>e.priority-i.priority||t1(e.min,i.min)||t1(e.max,i.max)||e.order-i.order||e.clipMask-i.clipMask||function(c,u){const p=(m,v)=>m+v;return c.length-u.length||c.reduce(p,"").localeCompare(u.reduce(p,""))}(e.clipScope,i.clipScope));let o=this._activeRegions.length!==this._prevRegions.length;if(!o){let e=0;for(;!o&&e!==this._activeRegions.length;){const i=this._activeRegions[e],c=this._prevRegions[e];o=i.priority!==c.priority||!eM(i,c)||i.order!==c.order||i.clipMask!==c.clipMask||!rl(i.clipScope,c.clipScope),++e}}if(o){++this._updateTime;for(const i of this._activeRegions)i.order!==e1&&(this._globalClipBounds.min.x=Math.min(this._globalClipBounds.min.x,i.min.x),this._globalClipBounds.min.y=Math.min(this._globalClipBounds.min.y,i.min.y),this._globalClipBounds.max.x=Math.max(this._globalClipBounds.max.x,i.max.x),this._globalClipBounds.max.y=Math.max(this._globalClipBounds.max.y,i.max.y));const e=i=>{const c=this._activeRegions;if(i>=c.length)return i;const u=c[i].priority;for(;i<c.length&&c[i].priority===u;)++i;return i};if(this._sourceIds.length>1){let i=0,c=e(i);for(;i!==c;){let u=i;const p=i;for(;u!==c;){const m=this._activeRegions[u];m.hiddenByOverlap=!1;for(let v=0;v<p;v++){const S=this._activeRegions[v];if(!S.hiddenByOverlap&&m.order===e1&&RS(m,S)&&(m.hiddenByOverlap=rM(m.footprint,m.tileId,S.footprint,S.tileId),m.hiddenByOverlap))break}++u}i=c,c=e(i)}}}}_setSources(o){[this._prevRegions,this._activeRegions]=[this._activeRegions,[]],this._sourceIds=[];for(let e=o.length-1;e>=0;e--)this._addSource(o[e]);this._computeReplacement()}},s.eu=e1,s.ev=class{constructor(o){this._createGrid(o),this._createPoles(o)}destroy(){this._poleIndexBuffer.destroy(),this._gridBuffer.destroy(),this._gridIndexBuffer.destroy(),this._poleNorthVertexBuffer.destroy(),this._poleSouthVertexBuffer.destroy();for(const o of this._poleSegments)o.destroy();for(const o of this._gridSegments)o.withSkirts.destroy(),o.withoutSkirts.destroy()}_fillGridMeshWithLods(o,e){const i=new ml,c=new bs,u=[],p=o+1+2,m=e[0]+1,v=e[0]+1+(1+e.length),S=(T,I,P)=>{let M=T===p-1?T-2:T===0?T:T-1;return M+=P?24575:0,[M,I]};for(let T=0;T<p;++T)i.emplaceBack(...S(T,0,!0));for(let T=0;T<m;++T)for(let I=0;I<p;++I)i.emplaceBack(...S(I,T,(I===0||I===p-1)&&!0));for(let T=0;T<e.length;++T){const I=e[T];for(let P=0;P<p;++P)i.emplaceBack(...S(P,I,!0))}for(let T=0;T<e.length;++T){const I=c.length,P=e[T]+1+2,M=new bs;for(let G=0;G<P-1;G++){const Z=G===P-2,Q=Z?p*(v-e.length+T-G):p;for(let le=0;le<p-1;le++){const ce=G*p+le;G===0||Z||le===0||le===p-2?(M.emplaceBack(ce+1,ce,ce+Q),M.emplaceBack(ce+Q,ce+Q+1,ce+1)):(c.emplaceBack(ce+1,ce,ce+Q),c.emplaceBack(ce+Q,ce+Q+1,ce+1))}}const L=Ai.simpleSegment(0,I,i.length,c.length-I);for(let G=0;G<M.uint16.length;G+=3)c.emplaceBack(M.uint16[G],M.uint16[G+1],M.uint16[G+2]);const O=Ai.simpleSegment(0,I,i.length,c.length-I);u.push({withoutSkirts:L,withSkirts:O})}return{vertices:i,indices:c,segments:u}}_createGrid(o){const e=this._fillGridMeshWithLods(D,F);this._gridSegments=e.segments,this._gridBuffer=o.createVertexBuffer(e.vertices,_P.members),this._gridIndexBuffer=o.createIndexBuffer(e.indices,!0)}_createPoles(o){const e=new bs;for(let m=0;m<=D;m++)e.emplaceBack(0,m+1,m+2);this._poleIndexBuffer=o.createIndexBuffer(e,!0);const i=new uc,c=new uc,u=new uc,p=new uc;this._poleSegments=[];for(let m=0,v=0;m<E;m++){const S=360/(1<<m);i.emplaceBack(0,-b,0,.5,0),c.emplaceBack(0,-b,0,.5,1),u.emplaceBack(0,-b,0,.5,.5),p.emplaceBack(0,-b,0,.5,.5);for(let T=0;T<=D;T++){let I=T/D,P=0;const M=vn(0,S,I),[L,O,G]=X(wV,SV,M,b);i.emplaceBack(L,O,G,I,P),c.emplaceBack(L,O,G,I,1-P);const Z=mr(M);I=.5+.5*Math.sin(Z),P=.5+.5*Math.cos(Z),u.emplaceBack(L,O,G,I,P),p.emplaceBack(L,O,G,I,1-P)}this._poleSegments.push(Ai.simpleSegment(v,0,66,64)),v+=66}this._poleNorthVertexBuffer=o.createVertexBuffer(i,H0,!1),this._poleSouthVertexBuffer=o.createVertexBuffer(c,H0,!1),this._texturedPoleNorthVertexBuffer=o.createVertexBuffer(u,H0,!1),this._texturedPoleSouthVertexBuffer=o.createVertexBuffer(p,H0,!1)}getGridBuffers(o,e){return[this._gridBuffer,this._gridIndexBuffer,e?this._gridSegments[o].withSkirts:this._gridSegments[o].withoutSkirts]}getPoleBuffers(o,e){return[e?this._texturedPoleNorthVertexBuffer:this._poleNorthVertexBuffer,e?this._texturedPoleSouthVertexBuffer:this._poleSouthVertexBuffer,this._poleIndexBuffer,this._poleSegments[o]]}},s.ew=ge,s.ex=function(){return!!document.fullscreenElement||!!document.webkitFullscreenElement},s.ey=Ce,s.ez=ze,s.f=function(o){return btoa(encodeURIComponent(o).replace(/%([0-9A-F]{2})/g,(e,i)=>String.fromCharCode(+("0x"+i))))},s.f0=Yk,s.f1=VM,s.f2=Jn,s.f3="hd_road_elevation",s.f4=Fo,s.f5=en,s.f6=Tf,s.f7=KS,s.f8=Af,s.f9=function(o,e,i,c,u,p,m,v=1,S,T,I){o.createArrays(),o.tilePixelRatio=Lt/(512*o.overscaling),o.compareText={},o.iconsNeedLinear=!1;const P=o.layers[0].layout,M=o.layers[0]._unevaluatedLayout._values,L={};L.scaleFactor=v,L.textSizeScaleRange=P.get("text-size-scale-range"),L.iconSizeScaleRange=P.get("icon-size-scale-range");const[O,G]=L.textSizeScaleRange,[Z,Q]=L.iconSizeScaleRange;L.textScaleFactor=xe(L.scaleFactor,O,G),L.iconScaleFactor=xe(L.scaleFactor,Z,Q);const le=M["text-size"],ce=M["icon-size"];if(o.textSizeData.kind==="composite"){const{minZoom:Te,maxZoom:Ie}=o.textSizeData;L.compositeTextSizes=[le.possiblyEvaluate(new Fr(Te,{worldview:I}),p),le.possiblyEvaluate(new Fr(Ie,{worldview:I}),p)]}if(o.iconSizeData.kind==="composite"){const{minZoom:Te,maxZoom:Ie}=o.iconSizeData;L.compositeIconSizes=[ce.possiblyEvaluate(new Fr(Te,{worldview:I}),p),ce.possiblyEvaluate(new Fr(Ie,{worldview:I}),p)]}L.layoutTextSize=le.possiblyEvaluate(new Fr(m+1,{worldview:I}),p),L.layoutIconSize=ce.possiblyEvaluate(new Fr(m+1,{worldview:I}),p),L.textMaxSize=le.possiblyEvaluate(new Fr(18,{worldview:I}),p);const q=P.get("symbol-placement"),re=P.get("text-rotation-alignment")==="map"&&q!=="point",ue=P.get("text-size");let pe=!1;const Ae=[];for(const Te of o.features){const Ie=P.get("text-font").evaluate(Te,{},p).join(","),Ne=ue.evaluate(Te,{},p)*L.textScaleFactor,Ke=L.layoutTextSize.evaluate(Te,{},p)*L.textScaleFactor,yt=L.layoutIconSize.evaluate(Te,{},p)*L.iconScaleFactor,at={horizontal:{},vertical:void 0},_t=Te.text;let xt,et=[0,0];if(_t){const xn=_t.toString(),zn=P.get("text-letter-spacing").evaluate(Te,{},p)*ms,Nn=P.get("text-line-height").evaluate(Te,{},p)*ms,Xn=iS(xn)?zn:0,Vn=P.get("text-anchor").evaluate(Te,{},p),Yn=P.get("text-variable-anchor");if(!Yn){const nt=P.get("text-radial-offset").evaluate(Te,{},p);if(nt)et=ER(Vn,[nt*ms,JS]);else{const Rt=P.get("text-offset").evaluate(Te,{},p);et=[Rt[0]*ms,Rt[1]*ms]}}let Ir=re?"center":P.get("text-justify").evaluate(Te,{},p);const Yr=q==="point",he=Yr?P.get("text-max-width").evaluate(Te,{},p)*ms:1/0,me=nt=>{o.allowVerticalPlacement&&rf(xn)&&(at.vertical=ZS(_t,e,i,u,Ie,he,Nn,Vn,nt,Xn,et,jo.vertical,!0,Ke,Ne,S))};if(!re&&Yn){const nt=Ir==="auto"?Yn.map(Ft=>eT(Ft)):[Ir];let Rt=!1;for(let Ft=0;Ft<nt.length;Ft++){const zt=nt[Ft];if(!at.horizontal[zt])if(Rt)at.horizontal[zt]=at.horizontal[0];else{const Xt=ZS(_t,e,i,u,Ie,he,Nn,"center",zt,Xn,et,jo.horizontal,!1,Ke,Ne,S);Xt&&(at.horizontal[zt]=Xt,Rt=Xt.positionedLines.length===1)}}me("left")}else{if(Ir==="auto"&&(Ir=eT(Vn)),Yr||P.get("text-writing-mode").indexOf("horizontal")>=0||!rf(xn)){const nt=ZS(_t,e,i,u,Ie,he,Nn,Vn,Ir,Xn,et,jo.horizontal,!1,Ke,Ne,S);nt&&(at.horizontal[Ir]=nt)}me(Yr?"left":Ir)}}let pt,Ze,Qe,St,Et,ln,Kt=!1;const Ot=P.get("icon-text-fit").evaluate(Te,{},p);if(Te.icon&&Te.icon.hasPrimary()){const xn=AR(Te.icon,o.iconSizeData,M["icon-size"],p,o.zoom,Te,S,L.iconScaleFactor,I);pt=xn.iconPrimary,Qe=xn.iconSecondary;const zn=pt.toString();if(Ze=c.get(zn),Ze&&(Et=P.get("icon-offset").evaluate(Te,{},p),ln=P.get("icon-anchor").evaluate(Te,{},p),xt=q6(u.get(zn),Qe?u.get(Qe.toString()):void 0,Et,ln),Kt=Ze.sdf,o.sdfIcons===void 0?o.sdfIcons=Ze.sdf:o.sdfIcons!==Ze.sdf&&On("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(Ze.pixelRatio!==o.pixelRatio||P.get("icon-rotate").constantOr(1)!==0)&&(o.iconsNeedLinear=!0)),Qe){const Nn=Qe.toString();St=c.get(Nn)}}pe=pe||!(!Te.icon||!Te.icon.hasSecondary());const wt=tT(at.horizontal)||at.vertical;o.iconsInText||(o.iconsInText=!!wt&&wt.iconsInText);const Pn=Ke*L.textScaleFactor/ms,{defaultShapedIcon:Yt,verticallyShapedIcon:Jt}=nU(o,xt,P,Te,p,at,Pn,Et,Ot);Ot!=="none"&&xt&&(cR(xt)||uR(xt))&&(p1(0,Ze,pt,xt,Yt,Ot,T,c,u),p1(0,St,Qe,xt,Yt,Ot,T,c,u),Jt&&(p1(0,Ze,pt,xt,Jt,Ot,T,c,u),p1(0,St,Qe,xt,Jt,Ot,T,c,u))),xt=Yt,Ae.push({feature:Te,shapedTextOrientations:at,shapedText:wt,shapedIcon:xt,iconPrimary:pt,iconSecondary:Qe,iconOffset:Et,iconAnchor:ln,verticallyShapedIcon:Jt,layoutTextSize:Ke,layoutIconSize:yt,textOffset:et,isSDFIcon:Kt,iconTextFit:Ot})}return{featureData:Ae,sizes:L,hasAnySecondaryIcon:pe,textAlongLine:re,symbolPlacement:q}},s.fa=vR,s.fb=function(o,e,i,c,u,p,m,v,S,T){const{featureData:I,hasAnySecondaryIcon:P,sizes:M,textAlongLine:L,symbolPlacement:O}=e;for(const G of I){const{shapedIcon:Z,verticallyShapedIcon:Q,feature:le,shapedTextOrientations:ce,shapedText:q,layoutTextSize:re,textOffset:ue,isSDFIcon:pe,iconPrimary:Ae,iconSecondary:Te,iconTextFit:Ie,iconOffset:Ne}=G;IR(Z,T.iconPositions,Ae,Te),IR(Q,T.iconPositions,Ae,Te),tU(ce,T.iconPositions),eU(Ae,Te,T.iconPositions),(q||Z)&&rU(o,le,ce,Z,Q,S,M,re,0,ue,pe,c,u,m,v,P,Ie,Ne,L,O)}i&&o.generateCollisionDebugBuffers(p,o.collisionBoxArray,M.textScaleFactor)},s.fc=Gn,s.fd=F1,s.fe=nl,s.ff=Dn,s.fg=tR,s.fh=mi,s.fi=function(o){let e=0;if(new Uint32Array(o,0,1)[0]!==DM){const i=new Uint32Array(o,0,7),[,,c,u,p,m]=i;e=i.byteLength+u+p+m+p,(c!==o.byteLength||e>=o.byteLength)&&On("Invalid b3dm header information.")}return OM(o,e)},s.fj=function(o,e){const i=Zk(o);for(const c of i){for(const u of c.meshes)C8(u);c.lights&&(c.lightMeshIndex=c.meshes.length,c.meshes.push(A8(c.lights,e)))}return i},s.fk=k1,s.fl=Rr,s.fm=IM,s.fn=pl,s.fo=bo,s.fp=function(o){ku(),za!=null&&za.then(e=>{e.keys().then(i=>{for(let c=0;c<i.length-o;c++)e.delete(i[c]).catch(u=>On(u.message))}).catch(i=>On(i.message))}).catch(e=>On(e.message))},s.g=function(o,e){return Lu($e(o,{method:"GET"}),e)},s.h=$e,s.i=function(o){return vs.API_STYLE_REGEX.test(o)&&!Sp(o)},s.j=function(o){return o.indexOf("mapbox:")===0},s.k=Zl,s.l=p_,s.m=function(o){return decodeURIComponent(atob(o).split("").map(e=>"%"+("00"+e.charCodeAt(0).toString(16)).slice(-2)).join(""))},s.n=function(o,e){return Lu($e(o,{type:"json"}),e)},s.o=m_,s.p=function(o,e){return Lu($e(o,{method:"POST"}),e)},s.q=pa,s.r=Is,s.s=function(o){try{const e=self[o];return e.setItem("_mapbox_test_",1),e.removeItem("_mapbox_test_"),!0}catch{return!1}},s.t=Cp,s.u=function(){return function o(e){return e?(e^Math.random()*(16>>e/4)).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,o)}()},s.v=function(o){return!!o&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(o)},s.w=On,s.x=function(){return OS||(OS=new Cf),OS},s.y=ST,s.z=Mp}),x(["./shared"],function(s){function k(He){const J=He?He.url.toString():void 0;return J?performance.getEntriesByName(J):[]}function z(He){if(typeof He=="number"||typeof He=="boolean"||typeof He=="string"||He==null)return JSON.stringify(He);if(Array.isArray(He)){let oe="[";for(const ge of He)oe+=`${z(ge)},`;return`${oe}]`}let J="{";for(const oe of Object.keys(He).sort())J+=`${oe}:${z(He[oe])},`;return`${J}}`}function V(He){let J="";for(const oe of s.bu)J+=`/${z(He[oe])}`;return J}class U{constructor(J){this.keyCache={},this._layers={},this._layerConfigs={},J&&this.replace(J)}replace(J,oe){this._layerConfigs={},this._layers={},this.update(J,[],oe)}update(J,oe,ge){this._options=ge;for(const xe of J)this._layerConfigs[xe.id]=xe,(this._layers[xe.id]=s.db(xe,this.scope,null,this._options)).compileFilter(ge),this.keyCache[xe.id]&&delete this.keyCache[xe.id];for(const xe of oe)delete this.keyCache[xe],delete this._layerConfigs[xe],delete this._layers[xe];this.familiesBySource={};const Ce=function(xe,ke){const Ue={};for(let $e=0;$e<xe.length;$e++){const ct=xe[$e];let qe=ke&&ke[ct.id];qe||(ct.type==="symbol"?qe=ct.id:(qe=V(ct),ct.type==="line"&&ct.paint&&function Qt(en){return typeof en=="string"&&en==="line-progress"||(Array.isArray(en)?en.some(Qt):!(!en||typeof en!="object")&&Object.values(en).some(Qt))}(ct.paint["line-width"])&&(qe+=`/${z(ct.paint["line-width"])}`))),ke&&(ke[ct.id]=qe);let kt=Ue[qe];kt||(kt=Ue[qe]=[]),kt.push(ct)}const De=[];for(const $e in Ue)De.push(Ue[$e]);return De}(Object.values(this._layerConfigs),this.keyCache);for(const xe of Ce){const ke=xe.map(kt=>this._layers[kt.id]),Ue=ke[0];if(Ue.visibility==="none")continue;const De=Ue.source||"";let $e=this.familiesBySource[De];$e||($e=this.familiesBySource[De]={});const ct=Ue.sourceLayer||"_geojsonTileLayer";let qe=$e[ct];qe||(qe=$e[ct]=[]),qe.push(ke)}}}const $=1*s.e_;class se{constructor(J){const oe={},ge=[];for(const Ue in J){const De=J[Ue],$e=oe[Ue]={};for(const ct in De.glyphs){const qe=De.glyphs[+ct];if(!qe||qe.bitmap.width===0||qe.bitmap.height===0)continue;const kt=qe.metrics.localGlyph?$:1,Qt={x:0,y:0,w:qe.bitmap.width+2*kt,h:qe.bitmap.height+2*kt};ge.push(Qt),$e[ct]=Qt}}const{w:Ce,h:xe}=s.H(ge),ke=new s.eZ({width:Ce||1,height:xe||1});for(const Ue in J){const De=J[Ue];for(const $e in De.glyphs){const ct=De.glyphs[+$e];if(!ct||ct.bitmap.width===0||ct.bitmap.height===0)continue;const qe=oe[Ue][$e],kt=ct.metrics.localGlyph?$:1;s.eZ.copy(ct.bitmap,ke,{x:0,y:0},{x:qe.x+kt,y:qe.y+kt},ct.bitmap)}}this.image=ke,this.positions=oe}}s.eY(se,"GlyphAtlas");class ae{constructor(J){this.tileID=new s.aM(J.tileID.overscaledZ,J.tileID.wrap,J.tileID.canonical.z,J.tileID.canonical.x,J.tileID.canonical.y),this.tileZoom=J.tileZoom,this.uid=J.uid,this.zoom=J.zoom,this.lut=J.lut,this.canonical=J.tileID.canonical,this.pixelRatio=J.pixelRatio,this.tileSize=J.tileSize,this.source=J.source,this.scope=J.scope,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=J.showCollisionBoxes,this.collectResourceTiming=!!J.request&&J.request.collectResourceTiming,this.promoteId=J.promoteId,this.isSymbolTile=J.isSymbolTile,this.tileTransform=s.aW(J.tileID.canonical,J.projection),this.projection=J.projection,this.worldview=J.worldview,this.localizableLayerIds=J.localizableLayerIds,this.brightness=J.brightness,this.extraShadowCaster=!!J.extraShadowCaster,this.tessellationStep=J.tessellationStep,this.scaleFactor=J.scaleFactor,this.worldview=J.worldview}parse(J,oe,ge,Ce,xe,ke){this.status="parsing",this.data=J,this.collisionBoxArray=new s.b0;const Ue=new s.e$(Object.keys(J.layers).sort()),De=new s.f0(this.tileID,this.promoteId);De.bucketLayerIDs=[];const $e={},ct=new s.f1(256,256),qe={featureIndex:De,iconDependencies:new Map,patternDependencies:new Map,glyphDependencies:{},lineAtlas:ct,availableImages:ge,brightness:this.brightness,scaleFactor:this.scaleFactor,elevationFeatures:void 0},kt=[],Qt=oe.familiesBySource[this.source];for(const Tn in Qt){const In=J.layers[Tn];if(!In)continue;let Rn=!1,Kn=!1,On=!1;for(const Rr of Qt[Tn])Rr[0].type==="symbol"?Rn=!0:Kn=!0,Rr[0].is3D()&&Rr[0].type!=="model"&&(On=!0);if(this.extraShadowCaster&&!On||this.isSymbolTile===!0&&!Rn||this.isSymbolTile===!1&&!Kn)continue;In.version===1&&s.w(`Vector tile source "${this.source}" layer "${Tn}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const Ur=Ue.encode(Tn),li=[];let ci=!1;for(let Rr=0,_r=0;Rr<In.length;Rr++){const ki=In.feature(Rr),Si=De.getId(ki,Tn);if(this.localizableLayerIds&&this.localizableLayerIds.has(Tn)){const _i=ki.properties?ki.properties.worldview:null;if(this.worldview&&typeof _i=="string")if(_i==="all")ki.properties.$localized=!0;else{if(!_i.split(",").includes(this.worldview))continue;ki.properties.$localized=!0,ki.properties.worldview=this.worldview}}!ci&&ki.properties&&ki.properties.hasOwnProperty(s.f2)&&(ci=!0),li.push({feature:ki,id:Si,index:_r,sourceLayerIndex:Ur}),_r++}ci&&!qe.elevationFeatures&&J.layers.hasOwnProperty(s.f3)&&(qe.elevationFeatures=s.f4.parseFrom(J.layers[s.f3],this.canonical));for(const Rr of Qt[Tn]){const _r=Rr[0];if(this.extraShadowCaster&&(!_r.is3D()||_r.type==="model")||this.isSymbolTile!==void 0&&_r.type==="symbol"!==this.isSymbolTile||_r.minzoom&&this.zoom<Math.floor(_r.minzoom)||_r.maxzoom&&this.zoom>=_r.maxzoom||_r.visibility==="none")continue;H(Rr,this.zoom,qe.brightness,ge,this.worldview);const ki=$e[_r.id]=_r.createBucket({index:De.bucketLayerIDs.length,layers:Rr,zoom:this.zoom,lut:this.lut,canonical:this.canonical,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:Ur,sourceID:this.source,projection:this.projection.spec,tessellationStep:this.tessellationStep,styleDefinedModelURLs:Ce,worldview:this.worldview});De.bucketLayerIDs.push(Rr.map(_i=>s.C(_i.id,_i.scope)));let Si=ki.prepare?ki.prepare():null;Si!=null?(Si=Si.then(()=>ki.populate(li,qe,this.tileID.canonical,this.tileTransform)),kt.push(Si)):ki.populate(li,qe,this.tileID.canonical,this.tileTransform)}}const en=()=>{let Tn,In,Rn,Kn,On,Ur;ct.trim();const li={type:"maybePrepare",isSymbolTile:this.isSymbolTile,zoom:this.zoom},ci=()=>{if(Tn)return this.status="done",ke(Tn);if(this.extraShadowCaster)this.status="done",ke(null,{buckets:Object.values($e).filter(_r=>!_r.isEmpty()),featureIndex:De,collisionBoxArray:null,glyphAtlasImage:null,lineAtlas:null,imageAtlas:null,brightness:qe.brightness,glyphMap:null,iconMap:null,glyphPositions:null});else if(In&&Rn&&Kn){const _r=new se(In),ki=new Map;for(const[fs,so]of Rn.entries()){const{imagePosition:Os}=s.f7(fs,so,s.f8);ki.set(fs,Os)}const Si={};for(const fs in $e){const so=$e[fs];so instanceof s.b1&&(H(so.layers,this.zoom,qe.brightness,ge,this.worldview),Si[fs]=s.f9(so,In,_r.positions,Rn,ki,this.tileID.canonical,this.tileZoom,this.scaleFactor,this.pixelRatio,On,this.worldview))}const _i={iconsPending:!0,patternsPending:!0};this.rasterizeIfNeeded(xe,Rn,On,()=>{_i.iconsPending=!1,Rr(Si,_r,_i)}),this.rasterizeIfNeeded(xe,Kn,Ur,()=>{_i.patternsPending=!1,Rr(Si,_r,_i)})}},Rr=(_r,ki,Si,_i)=>{if(Si.iconsPending||Si.patternsPending)return;const fs=new s.fa(Rn,Kn,this.lut);for(const so in $e){const Os=$e[so];if(so in _r)s.fb(Os,_r[so],this.showCollisionBoxes,ge,this.tileID.canonical,this.tileZoom,this.projection,this.brightness,Rn,fs);else if(Os.hasPattern&&(Os instanceof s.b7||Os instanceof s.b8||Os instanceof s.dU)){H(Os.layers,this.zoom,qe.brightness,ge,this.worldview);const Ch=Object.fromEntries(fs.patternPositions);Os.addFeatures(qe,this.tileID.canonical,Ch,ge,this.tileTransform,this.brightness)}}this.status="done",ke(null,{buckets:Object.values($e).filter(so=>!so.isEmpty()),featureIndex:De,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:ki.image,lineAtlas:ct,imageAtlas:fs,brightness:qe.brightness})};if(!this.extraShadowCaster){const _r=s.f5(qe.glyphDependencies,_i=>Object.keys(_i).map(Number));Object.keys(_r).length?xe.send("getGlyphs",{uid:this.uid,stacks:_r,scope:this.scope},(_i,fs)=>{Tn||(Tn=_i,In=fs,ci())},void 0,!1,li):In={};const ki=Array.from(qe.iconDependencies.keys()).map(_i=>s.I.parse(_i));ki.length?xe.send("getImages",{images:ki,source:this.source,scope:this.scope,tileID:this.tileID,type:"icons"},(_i,fs)=>{Tn||(Tn=_i,Rn=new Map,On=this.updateImageMapAndGetImageTaskQueue(Rn,fs,qe.iconDependencies),ci())},void 0,!1,li):(Rn=new Map,On=new Map);const Si=Array.from(qe.patternDependencies.keys()).map(_i=>s.I.parse(_i));Si.length?xe.send("getImages",{images:Si,source:this.source,scope:this.scope,tileID:this.tileID,type:"patterns"},(_i,fs)=>{Tn||(Tn=_i,Kn=new Map,Ur=this.updateImageMapAndGetImageTaskQueue(Kn,fs,qe.patternDependencies),ci())},void 0,!1,li):(Kn=new Map,Ur=new Map)}if(qe.elevationFeatures&&qe.elevationFeatures.length>0){const _r=[];for(const Si of Object.values($e))if(Si instanceof s.b8){const _i=Si.getUnevaluatedPortalGraph();_i&&_r.push(_i)}const ki=s.f6.evaluate(_r);for(const Si of Object.values($e))if(Si instanceof s.b8){const _i=J.layers[Ue.decode(Si.sourceLayerIndex)];Si.setEvaluatedPortalGraph(ki,_i,this.tileID.canonical,qe.availableImages,qe.brightness)}}ci()};kt.length>0?Promise.allSettled(kt).then(en).catch(ke):en()}rasterizeIfNeeded(J,oe,ge,Ce){Array.from(oe.values()).some(xe=>xe.usvg)?this.rasterize(J,oe,ge,Ce):Ce()}updateImageMapAndGetImageTaskQueue(J,oe,ge){const Ce=new Map;for(const xe of oe.keys()){const ke=ge.get(xe)||[];for(const Ue of ke){const De=Ue.toString(),$e=oe.get(Ue.id.toString());$e.usvg?Ce.has(De)||(Ce.set(De,Ue),J.set(De,Object.assign({},$e))):J.set(De,$e)}}return Ce}rasterize(J,oe,ge,Ce){this.rasterizeTask=J.send("rasterizeImages",{scope:this.scope,tasks:ge},(xe,ke)=>{if(!xe)for(const[Ue,De]of ke.entries()){const $e=Object.assign(oe.get(Ue),{data:De});oe.set(Ue,$e)}Ce()})}cancelRasterize(){this.rasterizeTask&&this.rasterizeTask.cancel()}}function H(He,J,oe,ge,Ce){const xe=new s.aa(J,{brightness:oe,worldview:Ce});for(const ke of He)ke.recalculate(xe,ge)}class ne extends s.E{constructor(J,oe,ge,Ce,xe,ke,Ue){super(),this.actor=J,this.layerIndex=oe,this.availableImages=ge,this.availableModels=Ce,this.loadVectorData=ke||s.aJ,this.loading={},this.loaded={},this.deduped=new s.aI(J.scheduler),this.isSpriteLoaded=xe,this.scheduler=J.scheduler,this.brightness=Ue}loadTile(J,oe){const ge=J.uid,Ce=J&&J.request,xe=Ce&&Ce.collectResourceTiming,ke=this.loading[ge]=new ae(J);ke.abort=this.loadVectorData(J,(Ue,De)=>{const $e=!this.loading[ge];if(delete this.loading[ge],ke.cancelRasterize(),$e||Ue||!De)return ke.status="done",$e||(this.loaded[ge]=ke),oe(Ue);const ct=De.rawData,qe={};De.expires&&(qe.expires=De.expires),De.cacheControl&&(qe.cacheControl=De.cacheControl),ke.vectorTile=De.vectorTile||new s.fc.VectorTile(new s.bq(ct));const kt=()=>{ke.parse(ke.vectorTile,this.layerIndex,this.availableImages,this.availableModels,this.actor,(Qt,en)=>{if(Qt||!en)return oe(Qt);const Tn={};if(xe){const In=k(Ce);In.length>0&&(Tn.resourceTiming=JSON.parse(JSON.stringify(In)))}oe(null,s.h({rawTileData:ct.slice(0)},en,qe,Tn))})};this.isSpriteLoaded?kt():this.once("isSpriteLoaded",()=>{this.scheduler?this.scheduler.add(kt,{type:"parseTile",isSymbolTile:J.isSymbolTile,zoom:J.tileZoom}):kt()}),this.loaded=this.loaded||{},this.loaded[ge]=ke})}reloadTile(J,oe){const ge=this.loaded,Ce=J.uid;if(ge&&ge[Ce]){const xe=ge[Ce];xe.scaleFactor=J.scaleFactor,xe.showCollisionBoxes=J.showCollisionBoxes,xe.projection=J.projection,xe.brightness=J.brightness,xe.tileTransform=s.aW(J.tileID.canonical,J.projection),xe.extraShadowCaster=J.extraShadowCaster,xe.lut=J.lut,xe.worldview=J.worldview;const ke=(Ue,De)=>{const $e=xe.reloadCallback;$e&&(delete xe.reloadCallback,xe.parse(xe.vectorTile,this.layerIndex,this.availableImages,this.availableModels,this.actor,$e)),oe(Ue,De)};xe.status==="parsing"?xe.reloadCallback=ke:xe.status==="done"&&(xe.vectorTile?xe.parse(xe.vectorTile,this.layerIndex,this.availableImages,this.availableModels,this.actor,ke):ke())}else oe(null,void 0)}abortTile(J,oe){const ge=J.uid,Ce=this.loading[ge];Ce&&(Ce.abort&&Ce.abort(),delete this.loading[ge]),oe()}removeTile(J,oe){const ge=this.loaded,Ce=J.uid;ge&&ge[Ce]&&delete ge[Ce],oe()}}class Y{loadTile(J,oe){const{uid:ge,encoding:Ce,rawImageData:xe,padding:ke}=J,Ue=ImageBitmap&&xe instanceof ImageBitmap?this.getImageData(xe,ke):xe;oe(null,new s.fd(ge,Ue,Ce,ke<1))}reloadTile(J,oe){oe(null,null)}abortTile(J,oe){oe()}removeTile(J,oe){oe()}getImageData(J,oe){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(J.width,J.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d",{willReadFrequently:!0})),this.offscreenCanvas.width=J.width,this.offscreenCanvas.height=J.height,this.offscreenCanvasContext.drawImage(J,0,0,J.width,J.height);const ge=this.offscreenCanvasContext.getImageData(-oe,-oe,J.width+2*oe,J.height+2*oe);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),ge}}s.bp.setPbf(s.bq);class te{constructor(J){this._mrt=new s.bp(J.partial?30:1/0),this._isHeaderLoaded=!1,this.uid=J.uid,this.tileID=J.tileID,this.source=J.source}parse(J,oe){const ge=this._mrt;this.status="parsing",this._entireBuffer=J;try{ge.parseHeader(J),this._isHeaderLoaded=!0;const Ce=[];for(const xe in ge.layers){const ke=ge.getLayer(xe),Ue=ke.getDataRange(ke.getBandList()),De=ge.createDecodingTask(Ue),$e=J.slice(Ue.firstByte,Ue.lastByte+1),ct=s.bp.performDecoding($e,De).then(qe=>De.complete(null,qe)).catch(qe=>De.complete(qe,null));Ce.push(ct)}Promise.allSettled(Ce).then(()=>oe(null,ge)).catch(xe=>oe(xe))}catch(Ce){oe(Ce)}}}class de{constructor(J){this.actor=J,this.loading={},this.loaded={}}loadTile(J,oe){const ge=J.uid,Ce=J.request,xe=this.loading[ge]=new te(J),{cancel:ke}=s.br(Ce,(Ue,De,$e,ct)=>{const qe=!this.loading[ge];if(delete this.loading[ge],qe||Ue||!De)return xe.status="done",qe||(this.loaded[ge]=xe),oe(Ue);xe.parse(De,(kt,Qt)=>{if(kt||!Qt)return oe(kt);oe(null,Qt,$e,ct)}),this.loaded[ge]=xe});xe.abort=ke}reloadTile(J,oe){oe(null,void 0)}abortTile(J,oe){const ge=J.uid,Ce=this.loading[ge];Ce&&(Ce.abort&&Ce.abort(),delete this.loading[ge]),oe()}removeTile(J,oe){const ge=J.uid;this.loaded[ge]&&delete this.loaded[ge],oe()}decodeRasterArray(J,oe){s.bp.performDecoding(J.buffer,J.task).then(ge=>oe(null,ge)).catch(ge=>oe(ge))}}const Me=s.fc.VectorTileFeature.prototype.toGeoJSON;class Le{constructor(J){this._feature=J,this.extent=s.aj,this.type=J.type,this.properties=J.tags,"id"in J&&!isNaN(J.id)&&(this.id=parseInt(J.id,10))}loadGeometry(){if(this._feature.type===1){const J=[];for(const oe of this._feature.geometry)J.push([new s.P(oe[0],oe[1])]);return J}{const J=[];for(const oe of this._feature.geometry){const ge=[];for(const Ce of oe)ge.push(new s.P(Ce[0],Ce[1]));J.push(ge)}return J}}toGeoJSON(J,oe,ge){return Me.call(this,J,oe,ge)}}class lt{constructor(J){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=s.aj,this.length=J.length,this._features=J}feature(J){return new Le(this._features[J])}}class Pe{constructor(J,oe){this.name=J,this.extent=s.aj,this.length=oe.length,this._features=oe}feature(J){return new Le(this._features[J])}}class Ye extends lt{constructor(J){super([]),this.layers={};for(const oe in J)this.layers[oe]=new Pe(oe,J[oe])}}const vt=64/4096,It=128;class Ut{constructor(){this.features=new Map}clear(){this.features.clear()}load(J=[],oe){for(const ge of J){const Ce=ge.id;if(Ce==null)continue;let xe=this.features.get(Ce);xe&&this.updateCache(xe,oe),ge.geometry?(xe=$t(ge),this.updateCache(xe,oe),this.features.set(Ce,xe)):this.features.delete(Ce),this.updateCache(xe,oe)}}updateCache(J,oe){for(const{canonical:ge,uid:Ce}of Object.values(oe)){const{z:xe,x:ke,y:Ue}=ge;Pt(J,Math.pow(2,xe),ke,Ue)&&delete oe[Ce]}}getTile(J,oe,ge){const Ce=Math.pow(2,J),xe=[];for(const ke of this.features.values())Pt(ke,Ce,oe,ge)&&xe.push(mt(ke,Ce,oe,ge));return{features:xe}}getFeatures(){return[...this.features.values()]}}function Pt({minX:He,minY:J,maxX:oe,maxY:ge},Ce,xe,ke){return He<(xe+1+vt)/Ce&&J<(ke+1+vt)/Ce&&oe>(xe-vt)/Ce&&ge>(ke-vt)/Ce}function $t(He){const{id:J,geometry:oe,properties:ge}=He;if(!oe)return;if(oe.type==="GeometryCollection")throw new Error("GeometryCollection not supported in dynamic mode.");const{type:Ce,coordinates:xe}=oe,ke={id:J,type:1,geometry:[],tags:ge,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0},Ue=ke.geometry;if(Ce==="Point")Ve(xe,Ue,ke);else if(Ce==="MultiPoint")for(const De of xe)Ve(De,Ue,ke);else if(Ce==="LineString")ke.type=2,jt(xe,Ue,ke);else if(Ce==="MultiLineString")ke.type=2,Je(xe,Ue,ke);else if(Ce==="Polygon")ke.type=3,Je(xe,Ue,ke,!0);else{if(Ce!=="MultiPolygon")throw new Error("Input data is not a valid GeoJSON object.");ke.type=3;for(const De of xe)Je(De,Ue,ke,!0)}return ke}function Ve([He,J],oe,ge){const Ce=s.aD(He);let xe=s.aH(J);xe=xe<0?0:xe>1?1:xe,oe.push(Ce,xe),ge.minX=Math.min(ge.minX,Ce),ge.minY=Math.min(ge.minY,xe),ge.maxX=Math.max(ge.maxX,Ce),ge.maxY=Math.max(ge.maxY,xe)}function jt(He,J,oe,ge=!1,Ce=!1){const xe=[];for(const ke of He)Ve(ke,xe,oe);J.push(xe),ge&&function(ke,Ue){let De=0;for(let $e=0,ct=ke.length,qe=ct-2;$e<ct;qe=$e,$e+=2)De+=(ke[$e]-ke[qe])*(ke[$e+1]+ke[qe+1]);if(De>0===Ue)for(let $e=0,ct=ke.length;$e<ct/2;$e+=2){const qe=ke[$e],kt=ke[$e+1];ke[$e]=ke[ct-2-$e],ke[$e+1]=ke[ct-1-$e],ke[ct-2-$e]=qe,ke[ct-1-$e]=kt}}(xe,Ce)}function Je(He,J,oe,ge=!1){for(let Ce=0;Ce<He.length;Ce++)jt(He[Ce],J,oe,ge,Ce===0)}function mt(He,J,oe,ge){const{id:Ce,type:xe,geometry:ke,tags:Ue}=He,De=[];if(xe===1)(function($e,ct,qe,kt,Qt){for(let en=0;en<$e.length;en+=2){const Tn=Math.round(s.aj*($e[en+0]*ct-qe)),In=Math.round(s.aj*($e[en+1]*ct-kt));Qt.push([Tn,In])}})(ke,J,oe,ge,De);else for(const $e of ke)Be($e,J,oe,ge,De);return{id:Ce,type:xe,geometry:De,tags:Ue}}function Be(He,J,oe,ge,Ce){const ke=s.aj+It;let Ue;for(let De=0;De<He.length-2;De+=2){let $e=Math.round(s.aj*(He[De+0]*J-oe)),ct=Math.round(s.aj*(He[De+1]*J-ge)),qe=Math.round(s.aj*(He[De+2]*J-oe)),kt=Math.round(s.aj*(He[De+3]*J-ge));const Qt=qe-$e,en=kt-ct;$e<-128&&qe<-128||($e<-128?(ct+=Math.round(en*((-128-$e)/Qt)),$e=-128):qe<-128&&(kt=ct+Math.round(en*((-128-$e)/Qt)),qe=-128),ct<-128&&kt<-128||(ct<-128?($e+=Math.round(Qt*((-128-ct)/en)),ct=-128):kt<-128&&(qe=$e+Math.round(Qt*((-128-ct)/en)),kt=-128),$e>=ke&&qe>=ke||($e>=ke?(ct+=Math.round(en*((ke-$e)/Qt)),$e=ke):qe>=ke&&(kt=ct+Math.round(en*((ke-$e)/Qt)),qe=ke),ct>=ke&&kt>=ke||(ct>=ke?($e+=Math.round(Qt*((ke-ct)/en)),ct=ke):kt>=ke&&(qe=$e+Math.round(Qt*((ke-ct)/en)),kt=ke),Ue&&$e===Ue[Ue.length-1][0]&&ct===Ue[Ue.length-1][1]||(Ue=[[$e,ct]],Ce.push(Ue)),Ue.push([qe,kt])))))}}var ft,Ct,Zt,fn={exports:{}},Qn=function(){if(Zt)return fn.exports;Zt=1;var He=s.fg(),J=function(){if(Ct)return ft;Ct=1;var ct=s.fe(),qe=s.ff().VectorTileFeature;function kt(en,Tn){this.options=Tn||{},this.features=en,this.length=en.length}function Qt(en,Tn){this.id=typeof en.id=="number"?en.id:void 0,this.type=en.type,this.rawGeometry=en.type===1?[en.geometry]:en.geometry,this.properties=en.tags,this.extent=Tn||4096}return ft=kt,kt.prototype.feature=function(en){return new Qt(this.features[en],this.options.extent)},Qt.prototype.loadGeometry=function(){var en=this.rawGeometry;this.geometry=[];for(var Tn=0;Tn<en.length;Tn++){for(var In=en[Tn],Rn=[],Kn=0;Kn<In.length;Kn++)Rn.push(new ct(In[Kn][0],In[Kn][1]));this.geometry.push(Rn)}return this.geometry},Qt.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var en=this.geometry,Tn=1/0,In=-1/0,Rn=1/0,Kn=-1/0,On=0;On<en.length;On++)for(var Ur=en[On],li=0;li<Ur.length;li++){var ci=Ur[li];Tn=Math.min(Tn,ci.x),In=Math.max(In,ci.x),Rn=Math.min(Rn,ci.y),Kn=Math.max(Kn,ci.y)}return[Tn,Rn,In,Kn]},Qt.prototype.toGeoJSON=qe.prototype.toGeoJSON,ft}();function oe(ct){var qe=new He;return function(kt,Qt){for(var en in kt.layers)Qt.writeMessage(3,ge,kt.layers[en])}(ct,qe),qe.finish()}function ge(ct,qe){var kt;qe.writeVarintField(15,ct.version||1),qe.writeStringField(1,ct.name||""),qe.writeVarintField(5,ct.extent||4096);var Qt={keys:[],values:[],keycache:{},valuecache:{}};for(kt=0;kt<ct.length;kt++)Qt.feature=ct.feature(kt),qe.writeMessage(2,Ce,Qt);var en=Qt.keys;for(kt=0;kt<en.length;kt++)qe.writeStringField(3,en[kt]);var Tn=Qt.values;for(kt=0;kt<Tn.length;kt++)qe.writeMessage(4,$e,Tn[kt])}function Ce(ct,qe){var kt=ct.feature;kt.id!==void 0&&qe.writeVarintField(1,kt.id),qe.writeMessage(2,xe,ct),qe.writeVarintField(3,kt.type),qe.writeMessage(4,De,kt)}function xe(ct,qe){var kt=ct.feature,Qt=ct.keys,en=ct.values,Tn=ct.keycache,In=ct.valuecache;for(var Rn in kt.properties){var Kn=kt.properties[Rn],On=Tn[Rn];if(Kn!==null){On===void 0&&(Qt.push(Rn),Tn[Rn]=On=Qt.length-1),qe.writeVarint(On);var Ur=typeof Kn;Ur!=="string"&&Ur!=="boolean"&&Ur!=="number"&&(Kn=JSON.stringify(Kn));var li=Ur+":"+Kn,ci=In[li];ci===void 0&&(en.push(Kn),In[li]=ci=en.length-1),qe.writeVarint(ci)}}}function ke(ct,qe){return(qe<<3)+(7&ct)}function Ue(ct){return ct<<1^ct>>31}function De(ct,qe){for(var kt=ct.loadGeometry(),Qt=ct.type,en=0,Tn=0,In=kt.length,Rn=0;Rn<In;Rn++){var Kn=kt[Rn],On=1;Qt===1&&(On=Kn.length),qe.writeVarint(ke(1,On));for(var Ur=Qt===3?Kn.length-1:Kn.length,li=0;li<Ur;li++){li===1&&Qt!==1&&qe.writeVarint(ke(2,Ur-1));var ci=Kn[li].x-en,Rr=Kn[li].y-Tn;qe.writeVarint(Ue(ci)),qe.writeVarint(Ue(Rr)),en+=ci,Tn+=Rr}Qt===3&&qe.writeVarint(ke(7,1))}}function $e(ct,qe){var kt=typeof ct;kt==="string"?qe.writeStringField(1,ct):kt==="boolean"?qe.writeBooleanField(7,ct):kt==="number"&&(ct%1!=0?qe.writeDoubleField(3,ct):ct<0?qe.writeSVarintField(6,ct):qe.writeVarintField(5,ct))}return fn.exports=oe,fn.exports.fromVectorTileJs=oe,fn.exports.fromGeojsonVt=function(ct,qe){qe=qe||{};var kt={};for(var Qt in ct)kt[Qt]=new J(ct[Qt].features,qe),kt[Qt].name=Qt,kt[Qt].version=qe.version,kt[Qt].extent=qe.extent;return oe({layers:kt})},fn.exports.GeoJSONWrapper=J,fn.exports}(),$n=s.fh(Qn);const Hn={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:He=>He},rn=Math.fround||(an=new Float32Array(1),He=>(an[0]=+He,an[0]));var an;const or=3,Mn=5,Mr=6;class Lr{constructor(J){this.options=Object.assign(Object.create(Hn),J),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(J){const{log:oe,minZoom:ge,maxZoom:Ce}=this.options;oe&&console.time("total time");const xe=`prepare ${J.length} points`;oe&&console.time(xe),this.points=J;const ke=[];for(let De=0;De<J.length;De++){const $e=J[De];if(!$e.geometry)continue;const[ct,qe]=$e.geometry.coordinates,kt=rn(Ki(ct)),Qt=rn(Cs(qe));ke.push(kt,Qt,1/0,De,-1,1),this.options.reduce&&ke.push(0)}let Ue=this.trees[Ce+1]=this._createTree(ke);oe&&console.timeEnd(xe);for(let De=Ce;De>=ge;De--){const $e=+Date.now();Ue=this.trees[De]=this._createTree(this._cluster(Ue,De)),oe&&console.log("z%d: %d clusters in %dms",De,Ue.numItems,+Date.now()-$e)}return oe&&console.timeEnd("total time"),this}getClusters(J,oe){let ge=((J[0]+180)%360+360)%360-180;const Ce=Math.max(-90,Math.min(90,J[1]));let xe=J[2]===180?180:((J[2]+180)%360+360)%360-180;const ke=Math.max(-90,Math.min(90,J[3]));if(J[2]-J[0]>=360)ge=-180,xe=180;else if(ge>xe){const qe=this.getClusters([ge,Ce,180,ke],oe),kt=this.getClusters([-180,Ce,xe,ke],oe);return qe.concat(kt)}const Ue=this.trees[this._limitZoom(oe)],De=Ue.range(Ki(ge),Cs(ke),Ki(xe),Cs(Ce)),$e=Ue.data,ct=[];for(const qe of De){const kt=this.stride*qe;ct.push($e[kt+Mn]>1?xr($e,kt,this.clusterProps):this.points[$e[kt+or]])}return ct}getChildren(J){const oe=this._getOriginId(J),ge=this._getOriginZoom(J),Ce="No cluster with the specified id.",xe=this.trees[ge];if(!xe)throw new Error(Ce);const ke=xe.data;if(oe*this.stride>=ke.length)throw new Error(Ce);const Ue=this.options.radius/(this.options.extent*Math.pow(2,ge-1)),De=xe.within(ke[oe*this.stride],ke[oe*this.stride+1],Ue),$e=[];for(const ct of De){const qe=ct*this.stride;ke[qe+4]===J&&$e.push(ke[qe+Mn]>1?xr(ke,qe,this.clusterProps):this.points[ke[qe+or]])}if($e.length===0)throw new Error(Ce);return $e}getLeaves(J,oe,ge){const Ce=[];return this._appendLeaves(Ce,J,oe=oe||10,ge=ge||0,0),Ce}getTile(J,oe,ge){const Ce=this.trees[this._limitZoom(J)],xe=Math.pow(2,J),{extent:ke,radius:Ue}=this.options,De=Ue/ke,$e=(ge-De)/xe,ct=(ge+1+De)/xe,qe={features:[]};return this._addTileFeatures(Ce.range((oe-De)/xe,$e,(oe+1+De)/xe,ct),Ce.data,oe,ge,xe,qe),oe===0&&this._addTileFeatures(Ce.range(1-De/xe,$e,1,ct),Ce.data,xe,ge,xe,qe),oe===xe-1&&this._addTileFeatures(Ce.range(0,$e,De/xe,ct),Ce.data,-1,ge,xe,qe),qe.features.length?qe:null}getClusterExpansionZoom(J){let oe=this._getOriginZoom(J)-1;for(;oe<=this.options.maxZoom;){const ge=this.getChildren(J);if(oe++,ge.length!==1)break;J=ge[0].properties.cluster_id}return oe}_appendLeaves(J,oe,ge,Ce,xe){const ke=this.getChildren(oe);for(const Ue of ke){const De=Ue.properties;if(De&&De.cluster?xe+De.point_count<=Ce?xe+=De.point_count:xe=this._appendLeaves(J,De.cluster_id,ge,Ce,xe):xe<Ce?xe++:J.push(Ue),J.length===ge)break}return xe}_createTree(J){const oe=new s.bW(J.length/this.stride|0,this.options.nodeSize,Float32Array);for(let ge=0;ge<J.length;ge+=this.stride)oe.add(J[ge],J[ge+1]);return oe.finish(),oe.data=J,oe}_addTileFeatures(J,oe,ge,Ce,xe,ke){for(const Ue of J){const De=Ue*this.stride,$e=oe[De+Mn]>1;let ct,qe,kt;if($e)ct=Tr(oe,De,this.clusterProps),qe=oe[De],kt=oe[De+1];else{const Tn=this.points[oe[De+or]];ct=Tn.properties;const[In,Rn]=Tn.geometry.coordinates;qe=Ki(In),kt=Cs(Rn)}const Qt={type:1,geometry:[[Math.round(this.options.extent*(qe*xe-ge)),Math.round(this.options.extent*(kt*xe-Ce))]],tags:ct};let en;en=$e||this.options.generateId?oe[De+or]:this.points[oe[De+or]].id,en!==void 0&&(Qt.id=en),ke.features.push(Qt)}}_limitZoom(J){return Math.max(this.options.minZoom,Math.min(Math.floor(+J),this.options.maxZoom+1))}_cluster(J,oe){const{radius:ge,extent:Ce,reduce:xe,minPoints:ke}=this.options,Ue=ge/(Ce*Math.pow(2,oe)),De=J.data,$e=[],ct=this.stride;for(let qe=0;qe<De.length;qe+=ct){if(De[qe+2]<=oe)continue;De[qe+2]=oe;const kt=De[qe],Qt=De[qe+1],en=J.within(De[qe],De[qe+1],Ue),Tn=De[qe+Mn];let In=Tn;for(const Rn of en){const Kn=Rn*ct;De[Kn+2]>oe&&(In+=De[Kn+Mn])}if(In>Tn&&In>=ke){let Rn,Kn=kt*Tn,On=Qt*Tn,Ur=-1;const li=(qe/ct<<5)+(oe+1)+this.points.length;for(const ci of en){const Rr=ci*ct;if(De[Rr+2]<=oe)continue;De[Rr+2]=oe;const _r=De[Rr+Mn];Kn+=De[Rr]*_r,On+=De[Rr+1]*_r,De[Rr+4]=li,xe&&(Rn||(Rn=this._map(De,qe,!0),Ur=this.clusterProps.length,this.clusterProps.push(Rn)),xe(Rn,this._map(De,Rr)))}De[qe+4]=li,$e.push(Kn/In,On/In,1/0,li,-1,In),xe&&$e.push(Ur)}else{for(let Rn=0;Rn<ct;Rn++)$e.push(De[qe+Rn]);if(In>1)for(const Rn of en){const Kn=Rn*ct;if(!(De[Kn+2]<=oe)){De[Kn+2]=oe;for(let On=0;On<ct;On++)$e.push(De[Kn+On])}}}}return $e}_getOriginId(J){return J-this.points.length>>5}_getOriginZoom(J){return(J-this.points.length)%32}_map(J,oe,ge){if(J[oe+Mn]>1){const ke=this.clusterProps[J[oe+Mr]];return ge?Object.assign({},ke):ke}const Ce=this.points[J[oe+or]].properties,xe=this.options.map(Ce);return ge&&xe===Ce?Object.assign({},xe):xe}}function xr(He,J,oe){return{type:"Feature",id:He[J+or],properties:Tr(He,J,oe),geometry:{type:"Point",coordinates:[(ge=He[J],360*(ge-.5)),Ri(He[J+1])]}};var ge}function Tr(He,J,oe){const ge=He[J+Mn],Ce=ge>=1e4?`${Math.round(ge/1e3)}k`:ge>=1e3?Math.round(ge/100)/10+"k":ge,xe=He[J+Mr],ke=xe===-1?{}:Object.assign({},oe[xe]);return Object.assign(ke,{cluster:!0,cluster_id:He[J+or],point_count:ge,point_count_abbreviated:Ce})}function Ki(He){return He/360+.5}function Cs(He){const J=Math.sin(He*Math.PI/180),oe=.5-.25*Math.log((1+J)/(1-J))/Math.PI;return oe<0?0:oe>1?1:oe}function Ri(He){const J=(180-360*He)*Math.PI/180;return 360*Math.atan(Math.exp(J))/Math.PI-90}function Ws(He,J,oe,ge){let Ce=ge;const xe=J+(oe-J>>1);let ke,Ue=oe-J;const De=He[J],$e=He[J+1],ct=He[oe],qe=He[oe+1];for(let kt=J+3;kt<oe;kt+=3){const Qt=We(He[kt],He[kt+1],De,$e,ct,qe);if(Qt>Ce)ke=kt,Ce=Qt;else if(Qt===Ce){const en=Math.abs(kt-xe);en<Ue&&(ke=kt,Ue=en)}}Ce>ge&&(ke-J>3&&Ws(He,J,ke,ge),He[ke+2]=Ce,oe-ke>3&&Ws(He,ke,oe,ge))}function We(He,J,oe,ge,Ce,xe){let ke=Ce-oe,Ue=xe-ge;if(ke!==0||Ue!==0){const De=((He-oe)*ke+(J-ge)*Ue)/(ke*ke+Ue*Ue);De>1?(oe=Ce,ge=xe):De>0&&(oe+=ke*De,ge+=Ue*De)}return ke=He-oe,Ue=J-ge,ke*ke+Ue*Ue}function ut(He,J,oe,ge){const Ce={id:He??null,type:J,geometry:oe,tags:ge,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};if(J==="Point"||J==="MultiPoint"||J==="LineString")Mt(Ce,oe);else if(J==="Polygon")Mt(Ce,oe[0]);else if(J==="MultiLineString")for(const xe of oe)Mt(Ce,xe);else if(J==="MultiPolygon")for(const xe of oe)Mt(Ce,xe[0]);return Ce}function Mt(He,J){for(let oe=0;oe<J.length;oe+=3)He.minX=Math.min(He.minX,J[oe]),He.minY=Math.min(He.minY,J[oe+1]),He.maxX=Math.max(He.maxX,J[oe]),He.maxY=Math.max(He.maxY,J[oe+1])}function bn(He,J,oe,ge){if(!J.geometry)return;const Ce=J.geometry.coordinates;if(Ce&&Ce.length===0)return;const xe=J.geometry.type,ke=Math.pow(oe.tolerance/((1<<oe.maxZoom)*oe.extent),2);let Ue=[],De=J.id;if(oe.promoteId?De=J.properties[oe.promoteId]:oe.generateId&&(De=ge||0),xe==="Point")pn(Ce,Ue);else if(xe==="MultiPoint")for(const $e of Ce)pn($e,Ue);else if(xe==="LineString")sn(Ce,Ue,ke,!1);else if(xe==="MultiLineString"){if(oe.lineMetrics){for(const $e of Ce)Ue=[],sn($e,Ue,ke,!1),He.push(ut(De,"LineString",Ue,J.properties));return}kn(Ce,Ue,ke,!1)}else if(xe==="Polygon")kn(Ce,Ue,ke,!0);else{if(xe!=="MultiPolygon"){if(xe==="GeometryCollection"){for(const $e of J.geometry.geometries)bn(He,{id:De,geometry:$e,properties:J.properties},oe,ge);return}throw new Error("Input data is not a valid GeoJSON object.")}for(const $e of Ce){const ct=[];kn($e,ct,ke,!0),Ue.push(ct)}}He.push(ut(De,xe,Ue,J.properties))}function pn(He,J){J.push(pr(He[0]),Ni(He[1]),0)}function sn(He,J,oe,ge){let Ce,xe,ke=0;for(let De=0;De<He.length;De++){const $e=pr(He[De][0]),ct=Ni(He[De][1]);J.push($e,ct,0),De>0&&(ke+=ge?(Ce*ct-$e*xe)/2:Math.sqrt(Math.pow($e-Ce,2)+Math.pow(ct-xe,2))),Ce=$e,xe=ct}const Ue=J.length-3;J[2]=1,Ws(J,0,Ue,oe),J[Ue+2]=1,J.size=Math.abs(ke),J.start=0,J.end=J.size}function kn(He,J,oe,ge){for(let Ce=0;Ce<He.length;Ce++){const xe=[];sn(He[Ce],xe,oe,ge),J.push(xe)}}function pr(He){return He/360+.5}function Ni(He){const J=Math.sin(He*Math.PI/180),oe=.5-.25*Math.log((1+J)/(1-J))/Math.PI;return oe<0?0:oe>1?1:oe}function Vr(He,J,oe,ge,Ce,xe,ke,Ue){if(ge/=J,xe>=(oe/=J)&&ke<ge)return He;if(ke<oe||xe>=ge)return null;const De=[];for(const $e of He){const ct=$e.geometry;let qe=$e.type;const kt=Ce===0?$e.minX:$e.minY,Qt=Ce===0?$e.maxX:$e.maxY;if(kt>=oe&&Qt<ge){De.push($e);continue}if(Qt<oe||kt>=ge)continue;let en=[];if(qe==="Point"||qe==="MultiPoint")Zs(ct,en,oe,ge,Ce);else if(qe==="LineString")As(ct,en,oe,ge,Ce,!1,Ue.lineMetrics);else if(qe==="MultiLineString")Qi(ct,en,oe,ge,Ce,!1);else if(qe==="Polygon")Qi(ct,en,oe,ge,Ce,!0);else if(qe==="MultiPolygon")for(const Tn of ct){const In=[];Qi(Tn,In,oe,ge,Ce,!0),In.length&&en.push(In)}if(en.length){if(Ue.lineMetrics&&qe==="LineString"){for(const Tn of en)De.push(ut($e.id,qe,Tn,$e.tags));continue}qe!=="LineString"&&qe!=="MultiLineString"||(en.length===1?(qe="LineString",en=en[0]):qe="MultiLineString"),qe!=="Point"&&qe!=="MultiPoint"||(qe=en.length===3?"Point":"MultiPoint"),De.push(ut($e.id,qe,en,$e.tags))}}return De.length?De:null}function Zs(He,J,oe,ge,Ce){for(let xe=0;xe<He.length;xe+=3){const ke=He[xe+Ce];ke>=oe&&ke<=ge&&Ns(J,He[xe],He[xe+1],He[xe+2])}}function As(He,J,oe,ge,Ce,xe,ke){let Ue=ko(He);const De=Ce===0?Do:Yo;let $e,ct,qe=He.start;for(let In=0;In<He.length-3;In+=3){const Rn=He[In],Kn=He[In+1],On=He[In+2],Ur=He[In+3],li=He[In+4],ci=Ce===0?Rn:Kn,Rr=Ce===0?Ur:li;let _r=!1;ke&&($e=Math.sqrt(Math.pow(Rn-Ur,2)+Math.pow(Kn-li,2))),ci<oe?Rr>oe&&(ct=De(Ue,Rn,Kn,Ur,li,oe),ke&&(Ue.start=qe+$e*ct)):ci>ge?Rr<ge&&(ct=De(Ue,Rn,Kn,Ur,li,ge),ke&&(Ue.start=qe+$e*ct)):Ns(Ue,Rn,Kn,On),Rr<oe&&ci>=oe&&(ct=De(Ue,Rn,Kn,Ur,li,oe),_r=!0),Rr>ge&&ci<=ge&&(ct=De(Ue,Rn,Kn,Ur,li,ge),_r=!0),!xe&&_r&&(ke&&(Ue.end=qe+$e*ct),J.push(Ue),Ue=ko(He)),ke&&(qe+=$e)}let kt=He.length-3;const Qt=He[kt],en=He[kt+1],Tn=Ce===0?Qt:en;Tn>=oe&&Tn<=ge&&Ns(Ue,Qt,en,He[kt+2]),kt=Ue.length-3,xe&&kt>=3&&(Ue[kt]!==Ue[0]||Ue[kt+1]!==Ue[1])&&Ns(Ue,Ue[0],Ue[1],Ue[2]),Ue.length&&J.push(Ue)}function ko(He){const J=[];return J.size=He.size,J.start=He.start,J.end=He.end,J}function Qi(He,J,oe,ge,Ce,xe){for(const ke of He)As(ke,J,oe,ge,Ce,xe,!1)}function Ns(He,J,oe,ge){He.push(J,oe,ge)}function Do(He,J,oe,ge,Ce,xe){const ke=(xe-J)/(ge-J);return Ns(He,xe,oe+(Ce-oe)*ke,1),ke}function Yo(He,J,oe,ge,Ce,xe){const ke=(xe-oe)/(Ce-oe);return Ns(He,J+(ge-J)*ke,xe,1),ke}function _o(He,J){const oe=[];for(let ge=0;ge<He.length;ge++){const Ce=He[ge],xe=Ce.type;let ke;if(xe==="Point"||xe==="MultiPoint"||xe==="LineString")ke=zs(Ce.geometry,J);else if(xe==="MultiLineString"||xe==="Polygon"){ke=[];for(const Ue of Ce.geometry)ke.push(zs(Ue,J))}else if(xe==="MultiPolygon"){ke=[];for(const Ue of Ce.geometry){const De=[];for(const $e of Ue)De.push(zs($e,J));ke.push(De)}}oe.push(ut(Ce.id,xe,ke,Ce.tags))}return oe}function zs(He,J){const oe=[];oe.size=He.size,He.start!==void 0&&(oe.start=He.start,oe.end=He.end);for(let ge=0;ge<He.length;ge+=3)oe.push(He[ge]+J,He[ge+1],He[ge+2]);return oe}function Wl(He,J){if(He.transformed)return He;const oe=1<<He.z,ge=He.x,Ce=He.y;for(const xe of He.features){const ke=xe.geometry,Ue=xe.type;if(xe.geometry=[],Ue===1)for(let De=0;De<ke.length;De+=2)xe.geometry.push(Cn(ke[De],ke[De+1],J,oe,ge,Ce));else for(let De=0;De<ke.length;De++){const $e=[];for(let ct=0;ct<ke[De].length;ct+=2)$e.push(Cn(ke[De][ct],ke[De][ct+1],J,oe,ge,Ce));xe.geometry.push($e)}}return He.transformed=!0,He}function Cn(He,J,oe,ge,Ce,xe){return[Math.round(oe*(He*ge-Ce)),Math.round(oe*(J*ge-xe))]}function mi(He,J,oe,ge,Ce){const xe=J===Ce.maxZoom?0:Ce.tolerance/((1<<J)*Ce.extent),ke={features:[],numPoints:0,numSimplified:0,numFeatures:He.length,source:null,x:oe,y:ge,z:J,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0};for(const Ue of He)gi(ke,Ue,xe,Ce);return ke}function gi(He,J,oe,ge){const Ce=J.geometry,xe=J.type,ke=[];if(He.minX=Math.min(He.minX,J.minX),He.minY=Math.min(He.minY,J.minY),He.maxX=Math.max(He.maxX,J.maxX),He.maxY=Math.max(He.maxY,J.maxY),xe==="Point"||xe==="MultiPoint")for(let Ue=0;Ue<Ce.length;Ue+=3)ke.push(Ce[Ue],Ce[Ue+1]),He.numPoints++,He.numSimplified++;else if(xe==="LineString")Ui(ke,Ce,He,oe,!1,!1);else if(xe==="MultiLineString"||xe==="Polygon")for(let Ue=0;Ue<Ce.length;Ue++)Ui(ke,Ce[Ue],He,oe,xe==="Polygon",Ue===0);else if(xe==="MultiPolygon")for(let Ue=0;Ue<Ce.length;Ue++){const De=Ce[Ue];for(let $e=0;$e<De.length;$e++)Ui(ke,De[$e],He,oe,!0,$e===0)}if(ke.length){let Ue=J.tags||null;if(xe==="LineString"&&ge.lineMetrics){Ue={};for(const $e in J.tags)Ue[$e]=J.tags[$e];Ue.mapbox_clip_start=Ce.start/Ce.size,Ue.mapbox_clip_end=Ce.end/Ce.size}const De={geometry:ke,type:xe==="Polygon"||xe==="MultiPolygon"?3:xe==="LineString"||xe==="MultiLineString"?2:1,tags:Ue};J.id!==null&&(De.id=J.id),He.features.push(De)}}function Ui(He,J,oe,ge,Ce,xe){const ke=ge*ge;if(ge>0&&J.size<(Ce?ke:ge))return void(oe.numPoints+=J.length/3);const Ue=[];for(let De=0;De<J.length;De+=3)(ge===0||J[De+2]>ke)&&(oe.numSimplified++,Ue.push(J[De],J[De+1])),oe.numPoints++;Ce&&function(De,$e){let ct=0;for(let qe=0,kt=De.length,Qt=kt-2;qe<kt;Qt=qe,qe+=2)ct+=(De[qe]-De[Qt])*(De[qe+1]+De[Qt+1]);if(ct>0===$e)for(let qe=0,kt=De.length;qe<kt/2;qe+=2){const Qt=De[qe],en=De[qe+1];De[qe]=De[kt-2-qe],De[qe+1]=De[kt-1-qe],De[kt-2-qe]=Qt,De[kt-1-qe]=en}}(Ue,xe),He.push(Ue)}const yo={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0};class tl{constructor(J,oe){const ge=(oe=this.options=function(xe,ke){for(const Ue in ke)xe[Ue]=ke[Ue];return xe}(Object.create(yo),oe)).debug;if(ge&&console.time("preprocess data"),oe.maxZoom<0||oe.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(oe.promoteId&&oe.generateId)throw new Error("promoteId and generateId cannot be used together.");let Ce=function(xe,ke){const Ue=[];if(xe.type==="FeatureCollection")for(let De=0;De<xe.features.length;De++)bn(Ue,xe.features[De],ke,De);else bn(Ue,xe.type==="Feature"?xe:{geometry:xe},ke);return Ue}(J,oe);this.tiles={},this.tileCoords=[],ge&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",oe.indexMaxZoom,oe.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),Ce=function(xe,ke){const Ue=ke.buffer/ke.extent;let De=xe;const $e=Vr(xe,1,-1-Ue,Ue,0,-1,2,ke),ct=Vr(xe,1,1-Ue,2+Ue,0,-1,2,ke);return($e||ct)&&(De=Vr(xe,1,-Ue,1+Ue,0,-1,2,ke)||[],$e&&(De=_o($e,1).concat(De)),ct&&(De=De.concat(_o(ct,-1)))),De}(Ce,oe),Ce.length&&this.splitTile(Ce,0,0,0),ge&&(Ce.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}splitTile(J,oe,ge,Ce,xe,ke,Ue){const De=[J,oe,ge,Ce],$e=this.options,ct=$e.debug;for(;De.length;){Ce=De.pop(),ge=De.pop(),oe=De.pop(),J=De.pop();const qe=1<<oe,kt=nl(oe,ge,Ce);let Qt=this.tiles[kt];if(!Qt&&(ct>1&&console.time("creation"),Qt=this.tiles[kt]=mi(J,oe,ge,Ce,$e),this.tileCoords.push({z:oe,x:ge,y:Ce}),ct)){ct>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",oe,ge,Ce,Qt.numFeatures,Qt.numPoints,Qt.numSimplified),console.timeEnd("creation"));const _r=`z${oe}`;this.stats[_r]=(this.stats[_r]||0)+1,this.total++}if(Qt.source=J,xe==null){if(oe===$e.indexMaxZoom||Qt.numPoints<=$e.indexMaxPoints)continue}else{if(oe===$e.maxZoom||oe===xe)continue;if(xe!=null){const _r=xe-oe;if(ge!==ke>>_r||Ce!==Ue>>_r)continue}}if(Qt.source=null,J.length===0)continue;ct>1&&console.time("clipping");const en=.5*$e.buffer/$e.extent,Tn=.5-en,In=.5+en,Rn=1+en;let Kn=null,On=null,Ur=null,li=null,ci=Vr(J,qe,ge-en,ge+In,0,Qt.minX,Qt.maxX,$e),Rr=Vr(J,qe,ge+Tn,ge+Rn,0,Qt.minX,Qt.maxX,$e);J=null,ci&&(Kn=Vr(ci,qe,Ce-en,Ce+In,1,Qt.minY,Qt.maxY,$e),On=Vr(ci,qe,Ce+Tn,Ce+Rn,1,Qt.minY,Qt.maxY,$e),ci=null),Rr&&(Ur=Vr(Rr,qe,Ce-en,Ce+In,1,Qt.minY,Qt.maxY,$e),li=Vr(Rr,qe,Ce+Tn,Ce+Rn,1,Qt.minY,Qt.maxY,$e),Rr=null),ct>1&&console.timeEnd("clipping"),De.push(Kn||[],oe+1,2*ge,2*Ce),De.push(On||[],oe+1,2*ge,2*Ce+1),De.push(Ur||[],oe+1,2*ge+1,2*Ce),De.push(li||[],oe+1,2*ge+1,2*Ce+1)}}getTile(J,oe,ge){J=+J,oe=+oe,ge=+ge;const Ce=this.options,{extent:xe,debug:ke}=Ce;if(J<0||J>24)return null;const Ue=1<<J,De=nl(J,oe=oe+Ue&Ue-1,ge);if(this.tiles[De])return Wl(this.tiles[De],xe);ke>1&&console.log("drilling down to z%d-%d-%d",J,oe,ge);let $e,ct=J,qe=oe,kt=ge;for(;!$e&&ct>0;)ct--,qe>>=1,kt>>=1,$e=this.tiles[nl(ct,qe,kt)];return $e&&$e.source?(ke>1&&(console.log("found parent tile z%d-%d-%d",ct,qe,kt),console.time("drilling down")),this.splitTile($e.source,ct,qe,kt,J,oe,ge),ke>1&&console.timeEnd("drilling down"),this.tiles[De]?Wl(this.tiles[De],xe):null):null}}function nl(He,J,oe){return 32*((1<<He)*oe+J)+He}function Dt(He,J){const oe=He.tileID.canonical;if(!this._geoJSONIndex)return void J(null,null);const ge=this._geoJSONIndex.getTile(oe.z,oe.x,oe.y);if(!ge)return void J(null,null);const Ce=De=>De.tags&&"3d_elevation_id"in De.tags&&"source"in De.tags&&De.tags.source==="elevation",xe=ge.features.filter(De=>Ce(De));let ke;if(xe.length>0){const De=ge.features.filter($e=>!Ce($e));ke=new Ye({_geojsonTileLayer:De,hd_road_elevation:xe})}else ke=new lt(ge.features);let Ue=$n(ke);Ue.byteOffset===0&&Ue.byteLength===Ue.buffer.byteLength||(Ue=new Uint8Array(Ue)),J(null,{vectorTile:ke,rawData:Ue.buffer})}class rl extends ne{constructor(J,oe,ge,Ce,xe,ke,Ue){super(J,oe,ge,Ce,xe,Dt,Ue),ke&&(this.loadGeoJSON=ke),this._dynamicIndex=new Ut}loadData(J,oe){const ge=J&&J.request,Ce=ge&&ge.collectResourceTiming;this.loadGeoJSON(J,(xe,ke)=>{if(xe||!ke)return oe(xe);if(typeof ke!="object")return oe(new Error(`Input data given to '${J.source}' is not a valid GeoJSON object.`));{try{if(J.filter){const De=s.X(J.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(De.result==="error")throw new Error(De.value.map($e=>`${$e.key}: ${$e.message}`).join(", "));ke.features=ke.features.filter($e=>De.value.evaluate({zoom:0},$e))}J.dynamic?(ke.type==="Feature"&&(ke={type:"FeatureCollection",features:[ke]}),J.append||(this._dynamicIndex.clear(),this.loaded={}),this._dynamicIndex.load(ke.features,this.loaded),J.cluster&&(ke.features=this._dynamicIndex.getFeatures())):this.loaded={},this._geoJSONIndex=J.cluster?new Lr(function({superclusterOptions:De,clusterProperties:$e}){if(!$e||!De)return De;const ct={},qe={},kt={accumulated:null,zoom:0},Qt={properties:null},en=Object.keys($e);for(const Tn of en){const[In,Rn]=$e[Tn],Kn=s.X(Rn),On=s.X(typeof In=="string"?[In,["accumulated"],["get",Tn]]:In);ct[Tn]=Kn.value,qe[Tn]=On.value}return De.map=Tn=>{Qt.properties=Tn;const In={};for(const Rn of en)In[Rn]=ct[Rn].evaluate(kt,Qt);return In},De.reduce=(Tn,In)=>{Qt.properties=In;for(const Rn of en)kt.accumulated=Tn[Rn],Tn[Rn]=qe[Rn].evaluate(kt,Qt)},De}(J)).load(ke.features):J.dynamic?this._dynamicIndex:function(De,$e){return new tl(De,$e)}(ke,J.geojsonVtOptions)}catch(De){return oe(De)}const Ue={};if(Ce){const De=k(ge);De&&(Ue.resourceTiming={},Ue.resourceTiming[J.source]=JSON.parse(JSON.stringify(De)))}oe(null,Ue)}})}reloadTile(J,oe){const ge=this.loaded;return ge&&ge[J.uid]?J.partial?oe(null,void 0):super.reloadTile(J,oe):this.loadTile(J,oe)}loadGeoJSON(J,oe){if(J.request)s.n(J.request,oe);else{if(typeof J.data!="string")return oe(new Error(`Input data given to '${J.source}' is not a valid GeoJSON object.`));try{return oe(null,JSON.parse(J.data))}catch{return oe(new Error(`Input data given to '${J.source}' is not a valid GeoJSON object.`))}}}getClusterExpansionZoom(J,oe){try{oe(null,this._geoJSONIndex.getClusterExpansionZoom(J.clusterId))}catch(ge){oe(ge)}}getClusterChildren(J,oe){try{oe(null,this._geoJSONIndex.getChildren(J.clusterId))}catch(ge){oe(ge)}}getClusterLeaves(J,oe){try{oe(null,this._geoJSONIndex.getLeaves(J.clusterId,J.limit,J.offset))}catch(ge){oe(ge)}}}class h_{constructor(J,oe,ge){this.tileID=new s.aM(J.tileID.overscaledZ,J.tileID.wrap,J.tileID.canonical.z,J.tileID.canonical.x,J.tileID.canonical.y),this.tileZoom=J.tileZoom,this.uid=J.uid,this.zoom=J.zoom,this.canonical=J.tileID.canonical,this.pixelRatio=J.pixelRatio,this.tileSize=J.tileSize,this.source=J.source,this.overscaling=this.tileID.overscaleFactor(),this.projection=J.projection,this.brightness=oe,this.worldview=ge}parse(J,oe,ge,Ce){this.status="parsing";const xe=new s.aM(ge.tileID.overscaledZ,ge.tileID.wrap,ge.tileID.canonical.z,ge.tileID.canonical.x,ge.tileID.canonical.y),ke=[],Ue=oe.familiesBySource[ge.source],De=new s.f0(xe,ge.promoteId);De.bucketLayerIDs=[],De.is3DTile=!0,s.fi(J).then($e=>{if(!$e)return Ce(new Error("Could not parse tile"));const ct=$e.json.extensionsUsed&&$e.json.extensionsUsed.includes("MAPBOX_mesh_features")||$e.json.asset.extras&&$e.json.asset.extras.MAPBOX_mesh_features,qe=$e.json.extensionsUsed&&$e.json.extensionsUsed.includes("EXT_meshopt_compression"),kt=new s.aa(this.zoom,{brightness:this.brightness,worldview:this.worldview});for(const Qt in Ue)for(const en of Ue[Qt]){const Tn=en[0];De.bucketLayerIDs.push(en.map(Kn=>s.C(Kn.id,Kn.scope))),Tn.recalculate(kt,[]);const In=s.fj($e,1/s.cU(ge.tileID.canonical)),Rn=new s.fk(en,In,xe,ct,qe,this.brightness,De,this.worldview);ct||(Rn.needsUpload=!0),ke.push(Rn),Rn.evaluate(Tn)}this.status="done",Ce(null,{buckets:ke,featureIndex:De,collisionBoxArray:null,glyphAtlasImage:null,lineAtlas:null,imageAtlas:null,brightness:null})}).catch($e=>Ce(new Error($e.message)))}}class Eh{constructor(J,oe,ge,Ce,xe,ke,Ue,De){this.actor=J,this.layerIndex=oe,this.availableImages=ge,this.availableModels=Ce,this.brightness=Ue,this.loading={},this.loaded={},this.worldview=De}loadTile(J,oe){const ge=J.uid,Ce=this.loading[ge]=new h_(J,this.brightness,this.worldview);s.br(J.request,(xe,ke)=>{const Ue=!this.loading[ge];return delete this.loading[ge],Ue||xe?(Ce.status="done",Ue||(this.loaded[ge]=Ce),oe(xe)):ke&&ke.byteLength!==0?void Ce.parse(ke,this.layerIndex,J,(De,$e)=>{Ce.status="done",this.loaded=this.loaded||{},this.loaded[ge]=Ce,De||!$e?oe(De):oe(null,$e)}):(Ce.status="done",this.loaded[ge]=Ce,oe())})}reloadTile(J,oe){const ge=this.loaded,Ce=J.uid;if(ge&&ge[Ce]){const xe=ge[Ce];xe.projection=J.projection,xe.brightness=J.brightness;const ke=(Ue,De)=>{xe.reloadCallback&&(delete xe.reloadCallback,this.loadTile(J,oe)),oe(Ue,De)};xe.status==="parsing"?xe.reloadCallback=ke:xe.status==="done"&&this.loadTile(J,oe)}}abortTile(J,oe){const ge=J.uid;this.loading[ge]&&delete this.loading[ge],oe()}removeTile(J,oe){const ge=this.loaded,Ce=J.uid;ge&&ge[Ce]&&delete ge[Ce],oe()}}class mr{constructor(J){this.self=J,this.actor=new s.fm(J,this),this.layerIndexes={},this.availableImages={},this.availableModels={},this.isSpriteLoaded={},this.imageRasterizer=new s.y,this.rtlPluginParsingListeners=[],this.projections={},this.defaultProjection=s.ce({name:"mercator"}),this.workerSourceTypes={vector:ne,geojson:rl,"raster-dem":Y,"raster-array":de,"batched-model":Eh},this.workerSources={},this.self.registerWorkerSource=(oe,ge)=>{if(this.workerSourceTypes[oe])throw new Error(`Worker source with name "${oe}" already registered.`);this.workerSourceTypes[oe]=ge},this.self.registerRTLTextPlugin=oe=>{if(s.fn.isParsed())throw new Error("RTL text plugin already registered.");s.fn.setState({pluginStatus:s.fo.parsed,pluginURL:s.fn.getPluginURL()}),s.fn.applyArabicShaping=oe.applyArabicShaping,s.fn.processBidirectionalText=oe.processBidirectionalText,s.fn.processStyledBidirectionalText=oe.processStyledBidirectionalText;for(const ge of this.rtlPluginParsingListeners)ge(null,!0);this.rtlPluginParsingListeners=[]}}clearCaches(J,oe,ge){delete this.layerIndexes[J],delete this.availableImages[J],delete this.availableModels[J],delete this.workerSources[J],ge()}checkIfReady(J,oe,ge){ge()}setReferrer(J,oe){this.referrer=oe}spriteLoaded(J,oe){this.isSpriteLoaded[J]||(this.isSpriteLoaded[J]={});const{scope:ge,isLoaded:Ce}=oe;if(this.isSpriteLoaded[J][ge]=Ce,this.workerSources[J]&&this.workerSources[J][ge])for(const xe in this.workerSources[J][ge]){const ke=this.workerSources[J][ge][xe];for(const Ue in ke){const De=ke[Ue];De instanceof ne&&(De.isSpriteLoaded=Ce,De.fire(new s.A("isSpriteLoaded")))}}}setImages(J,oe,ge){this.availableImages[J]||(this.availableImages[J]={});const{scope:Ce,images:xe}=oe;if(this.availableImages[J][Ce]=xe,this.workerSources[J]&&this.workerSources[J][Ce]){for(const ke in this.workerSources[J][Ce]){const Ue=this.workerSources[J][Ce][ke];for(const De in Ue)Ue[De].availableImages=xe}ge()}else ge()}setModels(J,{scope:oe,models:ge},Ce){if(this.availableModels[J]||(this.availableModels[J]={}),this.availableModels[J][oe]=ge,this.workerSources[J]&&this.workerSources[J][oe]){for(const xe in this.workerSources[J][oe]){const ke=this.workerSources[J][oe][xe];for(const Ue in ke)ke[Ue].availableModels=ge}Ce()}else Ce()}setProjection(J,oe){this.projections[J]=s.ce(oe)}setBrightness(J,oe,ge){this.brightness=oe,ge()}setWorldview(J,oe,ge){this.worldview=oe,ge()}setLayers(J,oe,ge){this.getLayerIndex(J,oe.scope).replace(oe.layers,oe.options),ge()}updateLayers(J,oe,ge){this.getLayerIndex(J,oe.scope).update(oe.layers,oe.removedIds,oe.options),ge()}loadTile(J,oe,ge){oe.projection=this.projections[J]||this.defaultProjection,this.getWorkerSource(J,oe.type,oe.source,oe.scope).loadTile(oe,ge)}decodeRasterArray(J,oe,ge){this.getWorkerSource(J,oe.type,oe.source,oe.scope).decodeRasterArray(oe,ge)}reloadTile(J,oe,ge){oe.projection=this.projections[J]||this.defaultProjection,this.getWorkerSource(J,oe.type,oe.source,oe.scope).reloadTile(oe,ge)}abortTile(J,oe,ge){this.getWorkerSource(J,oe.type,oe.source,oe.scope).abortTile(oe,ge)}removeTile(J,oe,ge){this.getWorkerSource(J,oe.type,oe.source,oe.scope).removeTile(oe,ge)}removeSource(J,oe,ge){if(!(this.workerSources[J]&&this.workerSources[J][oe.scope]&&this.workerSources[J][oe.scope][oe.type]&&this.workerSources[J][oe.scope][oe.type][oe.source]))return;const Ce=this.workerSources[J][oe.scope][oe.type][oe.source];delete this.workerSources[J][oe.scope][oe.type][oe.source],Ce.removeSource!==void 0?Ce.removeSource(oe,ge):ge()}loadWorkerSource(J,oe,ge){try{this.self.importScripts(oe.url),ge()}catch(Ce){ge(Ce.toString())}}syncRTLPluginState(J,oe,ge){if(s.fn.isParsed())ge(null,!0);else if(s.fn.isParsing())this.rtlPluginParsingListeners.push(ge);else try{s.fn.setState(oe);const Ce=s.fn.getPluginURL();!s.fn.isLoaded()||s.fn.isParsed()||s.fn.isParsing()||Ce==null||(s.fn.setState({pluginStatus:s.fo.parsing,pluginURL:s.fn.getPluginURL()}),this.self.importScripts(Ce),s.fn.isParsed()?ge(null,!0):this.rtlPluginParsingListeners.push(ge))}catch(Ce){ge(Ce.toString())}}setDracoUrl(J,oe){this.dracoUrl=oe}getAvailableImages(J,oe){this.availableImages[J]||(this.availableImages[J]={});let ge=this.availableImages[J][oe];return ge||(ge=[]),ge}getAvailableModels(J,oe){this.availableModels[J]||(this.availableModels[J]={});let ge=this.availableModels[J][oe];return ge||(ge={}),ge}getLayerIndex(J,oe){this.layerIndexes[J]||(this.layerIndexes[J]={});let ge=this.layerIndexes[J][oe];return ge||(ge=this.layerIndexes[J][oe]=new U,ge.scope=oe),ge}getWorkerSource(J,oe,ge,Ce){const xe=this.workerSources;return xe[J]||(xe[J]={}),xe[J][Ce]||(xe[J][Ce]={}),xe[J][Ce][oe]||(xe[J][Ce][oe]={}),this.isSpriteLoaded[J]||(this.isSpriteLoaded[J]={}),xe[J][Ce][oe][ge]||(xe[J][Ce][oe][ge]=new this.workerSourceTypes[oe]({send:(ke,Ue,De,$e,ct,qe)=>this.actor.send(ke,Ue,De,J,ct,qe),scheduler:this.actor.scheduler},this.getLayerIndex(J,Ce),this.getAvailableImages(J,Ce),this.getAvailableModels(J,Ce),this.isSpriteLoaded[J][Ce],void 0,this.brightness,this.worldview)),xe[J][Ce][oe][ge]}rasterizeImagesWorker(J,oe,ge){const Ce=new Map;for(const[xe,{image:ke,imageVariant:Ue}]of oe.tasks.entries()){const De=this.imageRasterizer.rasterize(Ue,ke,oe.scope,J);Ce.set(xe,De)}ge(void 0,Ce)}removeRasterizedImages(J,oe,ge){this.imageRasterizer.removeImagesFromCacheByIds(oe.imageIds,oe.scope,J),ge()}enforceCacheSizeLimit(J,oe){s.fp(oe)}getWorkerPerformanceMetrics(J,oe,ge){ge(void 0,void 0)}}return s.fl(self)&&(self.worker=new mr(self)),mr}),x(["./shared"],function(s){var k="3.13.0";const z={create:"create",load:"load",fullLoad:"fullLoad"},V={mark(h){performance.mark(h)},measure(h,n,a){performance.measure(h,n,a)}};function U(h){const n=h.name.split("?")[0];return s.a(n)&&n.includes("mapbox-gl.js")?"javascript":s.a(n)&&n.includes("mapbox-gl.css")?"css":s.b(n)?"fontRange":s.c(n)?"sprite":s.i(n)?"style":s.d(n)?"tilejson":"other"}var $,se={},ae=function(){if($)return se;function h(f){return!n(f)}function n(f){return typeof window>"u"||typeof document>"u"?"not a browser":function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var y,b,E=new Blob([""],{type:"text/javascript"}),A=URL.createObjectURL(E);try{b=new Worker(A),y=!0}catch{y=!1}return b&&b.terminate(),URL.revokeObjectURL(A),y}()?function(){var y=document.createElement("canvas");y.width=y.height=1;var b=y.getContext("2d");if(!b)return!1;var E=b.getImageData(0,0,1,1);return E&&E.width===y.width}()?(a[g=f&&f.failIfMajorPerformanceCaveat]===void 0&&(a[g]=function(y){var b,E=function(A){var R=document.createElement("canvas"),D=Object.create(h.webGLContextAttributes);return D.failIfMajorPerformanceCaveat=A,R.getContext("webgl2",D)}(y);if(!E)return!1;try{b=E.createShader(E.VERTEX_SHADER)}catch{return!1}return!(!b||E.isContextLost())&&(E.shaderSource(b,"void main() {}"),E.compileShader(b),E.getShaderParameter(b,E.COMPILE_STATUS)===!0)}(g)),a[g]?document.documentMode?"insufficient ECMAScript 6 support":void 0:"insufficient WebGL2 support"):"insufficient Canvas/getImageData support":"insufficient worker support";var g}$=1,se.supported=h,se.notSupportedReason=n;var a={};return h.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0},se}();function H(h,n,a){const f=document.createElement(h);return n!=null&&(f.className=n),a&&a.appendChild(f),f}function ne(h,n,a){const f=document.createElementNS("http://www.w3.org/2000/svg",h);for(const g of Object.keys(n))f.setAttributeNS(null,g,String(n[g]));return a&&a.appendChild(f),f}const Y=typeof document<"u"?document.documentElement&&document.documentElement.style:null,te=Y&&Y.userSelect!==void 0?"userSelect":"WebkitUserSelect";let de;function Me(){Y&&te&&(de=Y[te],Y[te]="none")}function Le(){Y&&te&&(Y[te]=de)}function lt(h){h.preventDefault(),h.stopPropagation(),window.removeEventListener("click",lt,!0)}function Pe(){window.addEventListener("click",lt,!0),window.setTimeout(()=>{window.removeEventListener("click",lt,!0)},0)}function Ye(h,n){const a=h.getBoundingClientRect();return Ut(h,a,n)}function vt(h,n){const a=h.getBoundingClientRect(),f=[];for(let g=0;g<n.length;g++)f.push(Ut(h,a,n[g]));return f}function It(h){return/firefox/i.test(navigator.userAgent)&&/macintosh/i.test(navigator.userAgent)&&h.button===2&&h.ctrlKey?0:h.button}function Ut(h,n,a){const f=h.offsetWidth===n.width?1:h.offsetWidth/n.width;return new s.P((a.clientX-n.left)*f,(a.clientY-n.top)*f)}const Pt="01",$t="NO_ACCESS_TOKEN";class Ve{constructor(n,a,f){this._transformRequestFn=n,this._customAccessToken=a,this._silenceAuthErrors=!!f,this._createSkuToken()}_createSkuToken(){const n=function(){let a="";for(let f=0;f<10;f++)a+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",Pt,a].join(""),tokenExpiresAt:Date.now()+432e5}}();this._skuToken=n.token,this._skuTokenExpiresAt=n.tokenExpiresAt}_isSkuTokenExpired(){return Date.now()>this._skuTokenExpiresAt}transformRequest(n,a){return this._transformRequestFn&&this._transformRequestFn(n,a)||{url:n}}normalizeStyleURL(n,a){if(!s.j(n))return n;const f=Je(n);return f.params.push(`sdk=js-${k}`),f.path=`/styles/v1${f.path}`,this._makeAPIURL(f,this._customAccessToken||a)}normalizeGlyphsURL(n,a){if(!s.j(n))return n;const f=Je(n);return f.path=`/fonts/v1${f.path}`,this._makeAPIURL(f,this._customAccessToken||a)}normalizeModelURL(n,a){if(!s.j(n))return n;const f=Je(n);return f.path=`/models/v1${f.path}`,this._makeAPIURL(f,this._customAccessToken||a)}normalizeSourceURL(n,a,f,g){if(!s.j(n))return n;const y=Je(n);return y.path=`/v4/${y.authority}.json`,y.params.push("secure"),f&&y.params.push(`language=${f}`),g&&y.params.push(`worldview=${g}`),this._makeAPIURL(y,this._customAccessToken||a)}normalizeIconsetURL(n,a){const f=Je(n);return s.j(n)?(f.path=`/styles/v1${f.path}/iconset.pbf`,this._makeAPIURL(f,this._customAccessToken||a)):mt(f)}normalizeSpriteURL(n,a,f,g){const y=Je(n);return s.j(n)?(y.path=`/styles/v1${y.path}/sprite${a}${f}`,this._makeAPIURL(y,this._customAccessToken||g)):(y.path+=`${a}${f}`,mt(y))}normalizeTileURL(n,a,f){if(this._isSkuTokenExpired()&&this._createSkuToken(),n&&!s.j(n))return n;const g=Je(n);g.path=g.path.replace(/(\.(png|jpg)\d*)(?=$)/,`${a||f&&g.authority!=="raster"&&f===512?"@2x":""}${s.l.supported?".webp":"$1"}`),g.authority==="raster"?g.path=`/${s.e.RASTER_URL_PREFIX}${g.path}`:g.authority==="rasterarrays"?g.path=`/${s.e.RASTERARRAYS_URL_PREFIX}${g.path}`:g.authority==="3dtiles"?g.path=`/${s.e.TILES3D_URL_PREFIX}${g.path}`:(g.path=g.path.replace(/^.+\/v4\//,"/"),g.path=`/${s.e.TILE_URL_VERSION}${g.path}`);const y=this._customAccessToken||function(b){for(const E of b){const A=E.match(/^access_token=(.*)$/);if(A)return A[1]}return null}(g.params)||s.e.ACCESS_TOKEN;return s.e.REQUIRE_ACCESS_TOKEN&&y&&this._skuToken&&g.params.push(`sku=${this._skuToken}`),this._makeAPIURL(g,y)}canonicalizeTileURL(n,a){const f=Je(n);if(!f.path.match(/^(\/v4\/|\/(raster|rasterarrays)\/v1\/)/)||!f.path.match(/\.[\w]+$/))return n;let g="mapbox://";f.path.match(/^\/raster\/v1\//)?g+=`raster/${f.path.replace(`/${s.e.RASTER_URL_PREFIX}/`,"")}`:f.path.match(/^\/rasterarrays\/v1\//)?g+=`rasterarrays/${f.path.replace(`/${s.e.RASTERARRAYS_URL_PREFIX}/`,"")}`:g+=`tiles/${f.path.replace(`/${s.e.TILE_URL_VERSION}/`,"")}`;let y=f.params;return a&&(y=y.filter(b=>!b.match(/^access_token=/))),y.length&&(g+=`?${y.join("&")}`),g}canonicalizeTileset(n,a){const f=!!a&&s.j(a),g=[];for(const y of n.tiles||[])s.k(y)?g.push(this.canonicalizeTileURL(y,f)):g.push(y);return g}_makeAPIURL(n,a){const f="See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes",g=Je(s.e.API_URL);if(n.protocol=g.protocol,n.authority=g.authority,n.protocol==="http"){const y=n.params.indexOf("secure");y>=0&&n.params.splice(y,1)}if(g.path!=="/"&&(n.path=`${g.path}${n.path}`),!s.e.REQUIRE_ACCESS_TOKEN)return mt(n);if(a=a||s.e.ACCESS_TOKEN,!this._silenceAuthErrors){if(!a)throw new Error(`An API access token is required to use Mapbox GL. ${f}`);if(a[0]==="s")throw new Error(`Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). ${f}`)}return n.params=n.params.filter(y=>y.indexOf("access_token")===-1),n.params.push(`access_token=${a||""}`),mt(n)}}const jt=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function Je(h){const n=h.match(jt);if(!n)throw new Error("Unable to parse URL object");return{protocol:n[1],authority:n[2],path:n[3]||"/",params:n[4]?n[4].split("&"):[]}}function mt(h){const n=h.params.length?`?${h.params.join("&")}`:"";return`${h.protocol}://${h.authority}${h.path}${n}`}const Be="mapbox.eventData";function ft(h){if(!h)return null;const n=h.split(".");if(!n||n.length!==3)return null;try{return JSON.parse(s.m(n[1]))}catch{return null}}class Ct{constructor(n){this.type=n,this.anonId=null,this.eventData={},this.queue=[],this.pendingRequest=null}getStorageKey(n){const a=ft(s.e.ACCESS_TOKEN);let f="";return f=a&&a.u?s.f(a.u):s.e.ACCESS_TOKEN||"",n?`${Be}.${n}:${f}`:`${Be}:${f}`}fetchEventData(){const n=s.s("localStorage"),a=this.getStorageKey(),f=this.getStorageKey("uuid");if(n)try{const g=localStorage.getItem(a);g&&(this.eventData=JSON.parse(g));const y=localStorage.getItem(f);y&&(this.anonId=y)}catch{s.w("Unable to read from LocalStorage")}}saveEventData(){const n=s.s("localStorage"),a=this.getStorageKey(),f=this.getStorageKey("uuid"),g=this.anonId;if(n&&g)try{localStorage.setItem(f,g),Object.keys(this.eventData).length>=1&&localStorage.setItem(a,JSON.stringify(this.eventData))}catch{s.w("Unable to write to LocalStorage")}}processRequests(n){}postEvent(n,a,f,g){if(!s.e.EVENTS_URL)return;const y=Je(s.e.EVENTS_URL);y.params.push(`access_token=${g||s.e.ACCESS_TOKEN||""}`);const b={event:this.type,created:new Date(n).toISOString()},E=a?s.h(b,a):b,A={url:mt(y),headers:{"Content-Type":"text/plain"},body:JSON.stringify([E])};this.pendingRequest=s.p(A,R=>{this.pendingRequest=null,f(R),this.saveEventData(),this.processRequests(g)})}queueRequest(n,a){this.queue.push(n),this.processRequests(a)}}const Zt=new class extends Ct{constructor(h){super("appUserTurnstile"),this._customAccessToken=h}postTurnstileEvent(h,n){s.e.EVENTS_URL&&s.e.ACCESS_TOKEN&&Array.isArray(h)&&h.some(a=>s.j(a)||s.k(a))&&this.queueRequest(Date.now(),n)}processRequests(h){if(this.pendingRequest||this.queue.length===0)return;this.anonId&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();const n=ft(s.e.ACCESS_TOKEN),a=n?n.u:s.e.ACCESS_TOKEN;let f=a!==this.eventData.tokenU;s.v(this.anonId)||(this.anonId=s.u(),f=!0);const g=this.queue.shift();if(this.eventData.lastSuccess){const y=new Date(this.eventData.lastSuccess),b=new Date(g),E=(g-this.eventData.lastSuccess)/864e5;f=f||E>=1||E<-1||y.getDate()!==b.getDate()}else f=!0;f?this.postEvent(g,{sdkIdentifier:"mapbox-gl-js",sdkVersion:k,skuId:Pt,"enabled.telemetry":!1,userId:this.anonId},y=>{y||(this.eventData.lastSuccess=g,this.eventData.tokenU=a)},h):this.processRequests()}},fn=Zt.postTurnstileEvent.bind(Zt),Qn=new class extends Ct{constructor(){super("map.load"),this.success={},this.skuToken=""}postMapLoadEvent(h,n,a,f){this.skuToken=n,this.errorCb=f,s.e.EVENTS_URL&&(a||s.e.ACCESS_TOKEN?this.queueRequest({id:h,timestamp:Date.now()},a):this.errorCb(new Error($t)))}processRequests(h){if(this.pendingRequest||this.queue.length===0)return;const{id:n,timestamp:a}=this.queue.shift();n&&this.success[n]||(this.anonId||this.fetchEventData(),s.v(this.anonId)||(this.anonId=s.u()),this.postEvent(a,{sdkIdentifier:"mapbox-gl-js",sdkVersion:k,skuId:Pt,skuToken:this.skuToken,userId:this.anonId},f=>{f?this.errorCb(f):n&&(this.success[n]=!0)},h))}remove(){this.errorCb=null}},$n=Qn.postMapLoadEvent.bind(Qn),Hn=new class extends Ct{constructor(){super("style.load"),this.eventIdPerMapInstanceMap=new Map,this.mapInstanceIdMap=new WeakMap}getMapInstanceId(h){let n=this.mapInstanceIdMap.get(h);return n||(n=s.u(),this.mapInstanceIdMap.set(h,n)),n}getEventId(h){const n=this.eventIdPerMapInstanceMap.get(h)||0;return this.eventIdPerMapInstanceMap.set(h,n+1),n}postStyleLoadEvent(h,n){const{map:a,style:f,importedStyles:g}=n;if(!s.e.EVENTS_URL||!h&&!s.e.ACCESS_TOKEN)return;const y=this.getMapInstanceId(a),b={mapInstanceId:y,eventId:this.getEventId(y),style:f};g.length&&(b.importedStyles=g),this.queueRequest({timestamp:Date.now(),payload:b},h)}processRequests(h){if(this.pendingRequest||this.queue.length===0)return;const{timestamp:n,payload:a}=this.queue.shift();this.postEvent(n,a,()=>{},h)}},rn=Hn.postStyleLoadEvent.bind(Hn),an=new class extends Ct{constructor(){super("gljs.performance")}postPerformanceEvent(h,n){s.e.EVENTS_URL&&(h||s.e.ACCESS_TOKEN)&&this.queueRequest({timestamp:Date.now(),performanceData:n},h)}processRequests(h){if(this.pendingRequest||this.queue.length===0)return;const{timestamp:n,performanceData:a}=this.queue.shift(),f=function(g){const y=performance.getEntriesByType("resource"),b=performance.getEntriesByType("mark"),E=function(j){const X={};if(j){for(const W in j)if(W!=="other")for(const K of j[W]){const ee=`${W}ResolveRangeMin`,ie=`${W}ResolveRangeMax`,fe=`${W}RequestCount`,_e=`${W}RequestCachedCount`;X[ee]=Math.min(X[ee]||1/0,K.startTime),X[ie]=Math.max(X[ie]||-1/0,K.responseEnd);const we=be=>{X[be]===void 0&&(X[be]=0),++X[be]};K.transferSize!==void 0&&K.transferSize===0&&we(_e),we(fe)}}return X}(function(j,X){const W={};if(j)for(const K of j){const ee=X(K);W[ee]===void 0&&(W[ee]=[]),W[ee].push(K)}return W}(y,U)),A=window.devicePixelRatio,R=navigator.connection||navigator.mozConnection||navigator.webkitConnection,D=R?R.effectiveType:void 0,F={counters:[],metadata:[],attributes:[]},N=(j,X,W)=>{W!=null&&j.push({name:X,value:W.toString()})};for(const j in E)N(F.counters,j,E[j]);if(g.interactionRange[0]!==1/0&&g.interactionRange[1]!==-1/0&&(N(F.counters,"interactionRangeMin",g.interactionRange[0]),N(F.counters,"interactionRangeMax",g.interactionRange[1])),b)for(const j of Object.keys(z)){const X=z[j],W=b.find(K=>K.name===X);W&&N(F.counters,X,W.startTime)}return N(F.counters,"visibilityHidden",g.visibilityHidden),N(F.attributes,"style",function(j){if(j)for(const X of j){const W=X.name.split("?")[0];if(s.i(W)){const K=W.split("/").slice(-2);if(K.length===2)return`mapbox://styles/${K[0]}/${K[1]}`}}}(y)),N(F.attributes,"terrainEnabled",g.terrainEnabled?"true":"false"),N(F.attributes,"fogEnabled",g.fogEnabled?"true":"false"),N(F.attributes,"projection",g.projection),N(F.attributes,"zoom",g.zoom),N(F.metadata,"devicePixelRatio",A),N(F.metadata,"connectionEffectiveType",D),N(F.metadata,"navigatorUserAgent",navigator.userAgent),N(F.metadata,"screenWidth",window.screen.width),N(F.metadata,"screenHeight",window.screen.height),N(F.metadata,"windowWidth",window.innerWidth),N(F.metadata,"windowHeight",window.innerHeight),N(F.metadata,"mapWidth",g.width/A),N(F.metadata,"mapHeight",g.height/A),N(F.metadata,"webglRenderer",g.renderer),N(F.metadata,"webglVendor",g.vendor),N(F.metadata,"sdkVersion",k),N(F.metadata,"sdkIdentifier","mapbox-gl-js"),F}(a);for(const g of f.metadata);for(const g of f.counters);for(const g of f.attributes);this.postEvent(n,f,()=>{},h)}},or=an.postPerformanceEvent.bind(an),Mn=new class extends Ct{constructor(){super("map.auth"),this.success={},this.skuToken=""}getSession(h,n,a,f){if(!s.e.API_URL||!s.e.SESSION_PATH)return;const g=Je(s.e.API_URL+s.e.SESSION_PATH);g.params.push(`sku=${n||""}`),g.params.push(`access_token=${f||s.e.ACCESS_TOKEN||""}`);const y={url:mt(g),headers:{"Content-Type":"text/plain"}};this.pendingRequest=s.g(y,b=>{this.pendingRequest=null,a(b),this.saveEventData(),this.processRequests(f)})}getSessionAPI(h,n,a,f){this.skuToken=n,this.errorCb=f,s.e.SESSION_PATH&&s.e.API_URL&&(a||s.e.ACCESS_TOKEN?this.queueRequest({id:h,timestamp:Date.now()},a):this.errorCb(new Error($t)))}processRequests(h){if(this.pendingRequest||this.queue.length===0)return;const{id:n,timestamp:a}=this.queue.shift();n&&this.success[n]||this.getSession(a,this.skuToken,f=>{f?this.errorCb(f):n&&(this.success[n]=!0)},h)}remove(){this.errorCb=null}},Mr=Mn.getSessionAPI.bind(Mn),Lr=new Set;function xr(h,n){n?Lr.add(h):Lr.delete(h)}class Tr{constructor(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSourceCaches={},this._updatedPaintProps=new Set,this._updatedImages={}}isDirty(){return this._changed}setDirty(){this._changed=!0}getUpdatedSourceCaches(){return this._updatedSourceCaches}updateSourceCache(n,a){this._updatedSourceCaches[n]=a,this.setDirty()}discardSourceCacheUpdate(n){delete this._updatedSourceCaches[n]}updateLayer(n){const a=n.scope;this._updatedLayers[a]=this._updatedLayers[a]||new Set,this._updatedLayers[a].add(n.id),this.setDirty()}removeLayer(n){const a=n.scope;this._removedLayers[a]=this._removedLayers[a]||{},this._updatedLayers[a]=this._updatedLayers[a]||new Set,this._removedLayers[a][n.id]=n,this._updatedLayers[a].delete(n.id),this._updatedPaintProps.delete(n.fqid),this.setDirty()}getRemovedLayer(n){return this._removedLayers[n.scope]?this._removedLayers[n.scope][n.id]:null}discardLayerRemoval(n){this._removedLayers[n.scope]&&delete this._removedLayers[n.scope][n.id]}getLayerUpdatesByScope(){const n={};for(const a in this._updatedLayers)n[a]=n[a]||{},n[a].updatedIds=Array.from(this._updatedLayers[a].values());for(const a in this._removedLayers)n[a]=n[a]||{},n[a].removedIds=Object.keys(this._removedLayers[a]);return n}getUpdatedPaintProperties(){return this._updatedPaintProps}updatePaintProperties(n){this._updatedPaintProps.add(n.fqid),this.setDirty()}getUpdatedImages(n){return this._updatedImages[n]?Array.from(this._updatedImages[n].values()):[]}updateImage(n,a){this._updatedImages[a]=this._updatedImages[a]||new Set,this._updatedImages[a].add(s.I.toString(n)),this.setDirty()}resetUpdatedImages(n){this._updatedImages[n]&&this._updatedImages[n].clear()}reset(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSourceCaches={},this._updatedPaintProps.clear(),this._updatedImages={}}}function Ki(h){const{userImage:n}=h;return!!(n&&n.render&&n.render())&&(h.data.replace(new Uint8Array(n.data.buffer)),!0)}class Cs extends s.E{constructor(n){super(),this.imageProviders=new Map,this.images=new Map,this.updatedImages=new Map,this.callbackDispatchedThisFrame=new Map,this.loaded=new Map,this.requestors=[],this.patterns=new Map,this.patternsInFlight=new Set,this.atlasImage=new Map,this.atlasTexture=new Map,this.dirty=!0,this.spriteFormat=n,n!=="raster"&&s.t()&&(this.imageRasterizerDispatcher=new s.D(s.x(),this,"Image Rasterizer Worker",1))}addScope(n){this.loaded.set(n,!1),this.imageProviders.set(n,new Map),this.images.set(n,new Map),this.updatedImages.set(n,new Set),this.callbackDispatchedThisFrame.set(n,new Set),this.patterns.set(n,new Map),this.atlasImage.set(n,new s.r({width:1,height:1}))}removeScope(n){this.loaded.delete(n),this.imageProviders.delete(n),this.images.delete(n),this.updatedImages.delete(n),this.callbackDispatchedThisFrame.delete(n),this.patterns.delete(n),this.atlasImage.delete(n);const a=this.atlasTexture.get(n);a&&(a.destroy(),this.atlasTexture.delete(n))}addImageProvider(n,a){this.imageProviders.has(a)||this.imageProviders.set(a,new Map),this.imageProviders.get(a).set(n.id,n)}removeImageProvider(n,a){this.imageProviders.has(a)&&this.imageProviders.get(a).delete(n)}getPendingImageProviders(){const n=[];for(const a of this.imageProviders.values())for(const f of a.values())f.hasPendingRequests()&&n.push(f);return n}get imageRasterizer(){return this._imageRasterizer||(this._imageRasterizer=new s.y),this._imageRasterizer}isLoaded(){for(const n of this.loaded.keys())if(!this.loaded.get(n))return!1;return!0}setLoaded(n,a){if(this.loaded.get(a)!==n&&(this.loaded.set(a,n),n)){for(const{ids:f,callback:g}of this.requestors)this._notify(f,a,g);this.requestors=[]}}hasImage(n,a){return!!this.getImage(n,a)}getImage(n,a){return this.images.get(a).get(n.toString())}addImage(n,a,f){this._validate(n,f)&&this.images.get(a).set(n.toString(),f)}_validate(n,a){let f=!0;return this._validateStretch(a.stretchX,a.data&&a.data.width)||(this.fire(new s.z(new Error(`Image "${n.name}" has invalid "stretchX" value`))),f=!1),this._validateStretch(a.stretchY,a.data&&a.data.height)||(this.fire(new s.z(new Error(`Image "${n.name}" has invalid "stretchY" value`))),f=!1),this._validateContent(a.content,a)||(this.fire(new s.z(new Error(`Image "${n.name}" has invalid "content" value`))),f=!1),f}_validateStretch(n,a){if(!n)return!0;let f=0;for(const g of n){if(g[0]<f||g[1]<g[0]||a<g[1])return!1;f=g[1]}return!0}_validateContent(n,a){return n?n.length!==4||!a.usvg&&(n[0]<0||a.data.width<n[0]||n[1]<0||a.data.height<n[1]||n[2]<0||a.data.width<n[2]||n[3]<0||a.data.height<n[3])?!1:!(n[2]<n[0]||n[3]<n[1]):!0}updateImage(n,a,f){const g=this.images.get(a).get(n.toString());f.version=g.version+1,this.images.get(a).set(n.toString(),f),this.updatedImages.get(a).add(n),this.removeFromImageRasterizerCache(n,a)}clearUpdatedImages(n){this.updatedImages.get(n).clear()}removeFromImageRasterizerCache(n,a){this.spriteFormat!=="raster"&&(s.t()?this.imageRasterizerDispatcher.getActor().send("removeRasterizedImages",{imageIds:[n],scope:a}):this.imageRasterizer.removeImagesFromCacheByIds([n],a))}removeImage(n,a){const f=this.images.get(a),g=f.get(n.toString());f.delete(n.toString()),this.patterns.get(a).delete(n.toString()),this.removeFromImageRasterizerCache(n,a),g.userImage&&g.userImage.onRemove&&g.userImage.onRemove()}listImages(n){return Array.from(this.images.get(n).keys()).map(a=>s.I.from(a))}getImages(n,a,f){const g=[],y=[],b=this.imageProviders.get(a);for(const D of n){if(!D.iconsetId){g.push(D);continue}const F=b.get(D.iconsetId);F&&(this.getImage(D,a)?y.push(D):F.addPendingRequest(D))}if(g.length===0)return void this._notify(y,a,f);let E=!0;const A=!!this.loaded.get(a),R=this.images.get(a);if(!A)for(const D of g)R.has(D.toString())||(E=!1);A||E?this._notify(g,a,f):this.requestors.push({ids:g,scope:a,callback:f})}rasterizeImages(n,a){const f=new Map,{tasks:g,scope:y}=n;for(const[b,E]of g.entries()){const A=this.getImage(E.id,y);A&&f.set(b,{image:A,imageVariant:E})}this._rasterizeImages(y,f,a)}_rasterizeImages(n,a,f){if(s.t())this.imageRasterizerDispatcher.getActor().send("rasterizeImagesWorker",{tasks:a,scope:n},f);else{const g=new Map;for(const[y,{image:b,imageVariant:E}]of a.entries())g.set(y,this.imageRasterizer.rasterize(E,b,n,0));f(void 0,g)}}getUpdatedImages(n){return this.updatedImages.get(n)||new Set}_notify(n,a,f){const g=this.images.get(a),y=new Map;for(const b of n){if(!g.get(b.toString())){if(b.iconsetId)continue;this.fire(new s.A("styleimagemissing",{id:b.name}))}const E=g.get(b.toString());if(!E){s.w(`Image "${b.name}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`);continue}const A={data:E.usvg?null:E.data.clone(),pixelRatio:E.pixelRatio,sdf:E.sdf,usvg:E.usvg,version:E.version,stretchX:E.stretchX,stretchY:E.stretchY,content:E.content,hasRenderCallback:!!(E.userImage&&E.userImage.render)};E.usvg&&Object.assign(A,{width:E.icon.usvg_tree.width,height:E.icon.usvg_tree.height}),y.set(s.I.toString(b),A)}f(null,y)}getPixelSize(n){const{width:a,height:f}=this.atlasImage.get(n);return{width:a,height:f}}getPattern(n,a,f){const g=n.toString(),y=this.patterns.get(a),b=y.get(g),E=this.getImage(n,a);if(!E)return null;if(b){if(b.position.version===E.version)return b.position;b.position.version=E.version}else{if(E.usvg&&!E.data){const A=this.getPatternInFlightId(g,a);if(this.patternsInFlight.has(A))return null;this.patternsInFlight.add(A);const R=new s.B(n).scaleSelf(s.q.devicePixelRatio),D=new Map([[R.toString(),{image:E,imageVariant:R}]]);return this._rasterizeImages(a,D,(F,N)=>this.storePatternImage(R,a,E,f,N)),null}this.storePattern(n,a,E)}return this._updatePatternAtlas(a,f),y.get(g).position}getPatternInFlightId(n,a){return s.C(n,a)}hasPatternsInFlight(){return this.patternsInFlight.size!==0}storePatternImage(n,a,f,g,y){const b=n.toString(),E=y?y.get(b):void 0;E&&(f.data=E,this.storePattern(n.id,a,f),this._updatePatternAtlas(a,g),this.patternsInFlight.delete(this.getPatternInFlightId(n.id.toString(),a)))}storePattern(n,a,f){const g={w:f.data.width+2*s.F,h:f.data.height+2*s.F,x:0,y:0},y=new s.G(g,f,s.F);this.patterns.get(a).set(n.toString(),{bin:g,position:y})}bind(n,a){const f=n.gl;let g=this.atlasTexture.get(a);g?this.dirty&&(g.update(this.atlasImage.get(a)),this.dirty=!1):(g=new s.T(n,this.atlasImage.get(a),f.RGBA8),this.atlasTexture.set(a,g)),g.bind(f.LINEAR,f.CLAMP_TO_EDGE)}_updatePatternAtlas(n,a){const f=this.patterns.get(n),g=Array.from(f.values()).map(({bin:R})=>R),{w:y,h:b}=s.H(g),E=this.atlasImage.get(n);E.resize({width:y||1,height:b||1});const A=this.images.get(n);for(const[R,{bin:D,position:F}]of f.entries()){let N=F.padding;const j=D.x+N,X=D.y+N,W=A.get(R).data,K=W.width,ee=W.height;N=N>1?N-1:N,s.r.copy(W,E,{x:0,y:0},{x:j,y:X},{width:K,height:ee},a),s.r.copy(W,E,{x:0,y:ee-N},{x:j,y:X-N},{width:K,height:N},a),s.r.copy(W,E,{x:0,y:0},{x:j,y:X+ee},{width:K,height:N},a),s.r.copy(W,E,{x:K-N,y:0},{x:j-N,y:X},{width:N,height:ee},a),s.r.copy(W,E,{x:0,y:0},{x:j+K,y:X},{width:N,height:ee},a),s.r.copy(W,E,{x:K-N,y:ee-N},{x:j-N,y:X-N},{width:N,height:N},a),s.r.copy(W,E,{x:0,y:ee-N},{x:j+K,y:X-N},{width:N,height:N},a),s.r.copy(W,E,{x:0,y:0},{x:j+K,y:X+ee},{width:N,height:N},a),s.r.copy(W,E,{x:K-N,y:0},{x:j-N,y:X+ee},{width:N,height:N},a)}this.dirty=!0}beginFrame(){for(const n of this.images.keys())this.callbackDispatchedThisFrame.set(n,new Set)}dispatchRenderCallbacks(n,a){const f=this.images.get(a);for(const g of n){if(this.callbackDispatchedThisFrame.get(a).has(g.toString()))continue;this.callbackDispatchedThisFrame.get(a).add(g.toString());const y=f.get(g.toString());Ki(y)&&this.updateImage(g,a,y)}}}function Ri(h){const n=h.key,a=h.value,f=h.valueSpec||{},g=h.objectElementValidators||{},y=h.style,b=h.styleSpec;let E=[];const A=s.J(a);if(A!=="object")return[new s.V(n,a,`object expected, ${A} found`)];for(const R in a){const D=R.split(".")[0];let F;g[D]?F=g[D]:f[D]?F=Cn:g["*"]?F=g["*"]:f["*"]&&(F=Cn),F?E=E.concat(F({key:(n&&`${n}.`)+R,value:a[R],valueSpec:f[D]||f["*"],style:y,styleSpec:b,object:a,objectKey:R},a)):E.push(new s.K(n,a[R],`unknown property "${R}"`))}for(const R in f)g[R]||f[R].required&&f[R].default===void 0&&a[R]===void 0&&E.push(new s.V(n,a,`missing required property "${R}"`));return E}function Ws(h){const n=h.value,a=h.valueSpec,f=h.style,g=h.styleSpec,y=h.key,b=h.arrayElementValidator||Cn;if(s.J(n)!=="array")return[new s.V(y,n,`array expected, ${s.J(n)} found`)];if(a.length&&n.length!==a.length)return[new s.V(y,n,`array length ${a.length} expected, length ${n.length} found`)];if(a["min-length"]&&n.length<a["min-length"])return[new s.V(y,n,`array length at least ${a["min-length"]} expected, length ${n.length} found`)];let E={type:a.value,values:a.values,minimum:a.minimum,maximum:a.maximum,function:void 0};g.$version<7&&(E.function=a.function),s.J(a.value)==="object"&&(E=a.value);let A=[];for(let R=0;R<n.length;R++)A=A.concat(b({array:n,arrayIndex:R,value:n[R],valueSpec:E,style:f,styleSpec:g,key:`${y}[${R}]`},!0));return A}function We(h){const n=h.key,a=h.value,f=h.valueSpec;let g=s.J(a);if(g==="number"&&a!=a&&(g="NaN"),g!=="number")return[new s.V(n,a,`number expected, ${g} found`)];if("minimum"in f){let y=f.minimum;if(s.J(f.minimum)==="array"&&(y=f.minimum[h.arrayIndex]),a<y)return[new s.V(n,a,`${a} is less than the minimum value ${y}`)]}if("maximum"in f){let y=f.maximum;if(s.J(f.maximum)==="array"&&(y=f.maximum[h.arrayIndex]),a>y)return[new s.V(n,a,`${a} is greater than the maximum value ${y}`)]}return[]}function ut(h){const n=h.valueSpec,a=s.M(h.value.type);let f,g,y,b={};const E=a!=="categorical"&&h.value.property===void 0,A=!E,R=s.J(h.value.stops)==="array"&&s.J(h.value.stops[0])==="array"&&s.J(h.value.stops[0][0])==="object",D=Ri({key:h.key,value:h.value,valueSpec:h.styleSpec.function,style:h.style,styleSpec:h.styleSpec,objectElementValidators:{stops:function(j){if(a==="identity")return[new s.V(j.key,j.value,'identity function may not have a "stops" property')];let X=[];const W=j.value;return X=X.concat(Ws({key:j.key,value:W,valueSpec:j.valueSpec,style:j.style,styleSpec:j.styleSpec,arrayElementValidator:F})),s.J(W)==="array"&&W.length===0&&X.push(new s.V(j.key,W,"array must have at least one stop")),X},default:function(j){return Cn({key:j.key,value:j.value,valueSpec:n,style:j.style,styleSpec:j.styleSpec})}}});return a==="identity"&&E&&D.push(new s.V(h.key,h.value,'missing required property "property"')),a==="identity"||h.value.stops||D.push(new s.V(h.key,h.value,'missing required property "stops"')),a==="exponential"&&h.valueSpec.expression&&!s.N(h.valueSpec)&&D.push(new s.V(h.key,h.value,"exponential functions not supported")),h.styleSpec.$version>=8&&(A&&!s.O(h.valueSpec)?D.push(new s.V(h.key,h.value,"property functions not supported")):E&&!s.Q(h.valueSpec)&&D.push(new s.V(h.key,h.value,"zoom functions not supported"))),a!=="categorical"&&!R||h.value.property!==void 0||D.push(new s.V(h.key,h.value,'"property" property is required')),D;function F(j){let X=[];const W=j.value,K=j.key;if(s.J(W)!=="array")return[new s.V(K,W,`array expected, ${s.J(W)} found`)];if(W.length!==2)return[new s.V(K,W,`array length 2 expected, length ${W.length} found`)];if(R){if(s.J(W[0])!=="object")return[new s.V(K,W,`object expected, ${s.J(W[0])} found`)];if(W[0].zoom===void 0)return[new s.V(K,W,"object stop key must have zoom")];if(W[0].value===void 0)return[new s.V(K,W,"object stop key must have value")];const ee=s.M(W[0].zoom);if(typeof ee!="number")return[new s.V(K,W[0].zoom,"stop zoom values must be numbers")];if(y&&y>ee)return[new s.V(K,W[0].zoom,"stop zoom values must appear in ascending order")];ee!==y&&(y=ee,g=void 0,b={}),X=X.concat(Ri({key:`${K}[0]`,value:W[0],valueSpec:{zoom:{}},style:j.style,styleSpec:j.styleSpec,objectElementValidators:{zoom:We,value:N}}))}else X=X.concat(N({key:`${K}[0]`,value:W[0],style:j.style,styleSpec:j.styleSpec},W));return s.S(s.U(W[1]))?X.concat([new s.V(`${K}[1]`,W[1],"expressions are not allowed in function stops.")]):X.concat(Cn({key:`${K}[1]`,value:W[1],valueSpec:n,style:j.style,styleSpec:j.styleSpec}))}function N(j,X){const W=s.J(j.value),K=s.M(j.value),ee=j.value!==null?j.value:X;if(f){if(W!==f)return[new s.V(j.key,ee,`${W} stop domain type must match previous stop domain type ${f}`)]}else f=W;if(W!=="number"&&W!=="string"&&W!=="boolean"&&typeof K!="number"&&typeof K!="string"&&typeof K!="boolean")return[new s.V(j.key,ee,"stop domain value must be a number, string, or boolean")];if(W!=="number"&&a!=="categorical"){let ie=`number expected, ${W} found`;return s.O(n)&&a===void 0&&(ie+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new s.V(j.key,ee,ie)]}return a!=="categorical"||W!=="number"||typeof K=="number"&&isFinite(K)&&Math.floor(K)===K?a!=="categorical"&&W==="number"&&typeof K=="number"&&typeof g=="number"&&g!==void 0&&K<g?[new s.V(j.key,ee,"stop domain values must appear in ascending order")]:(g=K,a==="categorical"&&K in b?[new s.V(j.key,ee,"stop domain values must be unique")]:(b[K]=!0,[])):[new s.V(j.key,ee,`integer expected, found ${String(K)}`)]}}function Mt(h){const n=(h.expressionContext==="property"?s.W:s.X)(s.U(h.value),h.valueSpec);if(n.result==="error")return n.value.map(f=>new s.V(`${h.key}${f.key}`,h.value,f.message));const a=n.value.expression||n.value._styleExpression.expression;if(h.expressionContext==="property"&&h.propertyKey==="text-font"&&!a.outputDefined())return[new s.V(h.key,h.value,`Invalid data expression for "${h.propertyKey}". Output values must be contained as literals within the expression.`)];if(h.expressionContext==="property"&&h.propertyType==="layout"&&!s.Y(a))return[new s.V(h.key,h.value,'"feature-state" data expressions are not supported with layout properties.')];if(h.expressionContext==="filter")return bn(a,h);if(h.expressionContext&&h.expressionContext.indexOf("cluster")===0){if(!s.Z(a,["zoom","feature-state"]))return[new s.V(h.key,h.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(h.expressionContext==="cluster-initial"&&!s._(a))return[new s.V(h.key,h.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function bn(h,n){const a=new Set(["zoom","feature-state","pitch","distance-from-center"]);if(n.valueSpec&&n.valueSpec.expression)for(const g of n.valueSpec.expression.parameters)a.delete(g);if(a.size===0)return[];const f=[];return h instanceof s.$&&a.has(h.name)?[new s.V(n.key,n.value,`["${h.name}"] expression is not supported in a filter for a ${n.object.type} layer with id: ${n.object.id}`)]:(h.eachChild(g=>{f.push(...bn(g,n))}),f)}function pn(h){const n=h.key,a=h.value,f=h.valueSpec,g=[];return Array.isArray(f.values)?f.values.indexOf(s.M(a))===-1&&g.push(new s.V(n,a,`expected one of [${f.values.join(", ")}], ${JSON.stringify(a)} found`)):Object.keys(f.values).indexOf(s.M(a))===-1&&g.push(new s.V(n,a,`expected one of [${Object.keys(f.values).join(", ")}], ${JSON.stringify(a)} found`)),g}function sn(h){return s.a1(s.U(h.value))?Mt(s.L({},h,{expressionContext:"filter",valueSpec:h.styleSpec[`filter_${h.layerType||"fill"}`]})):kn(h)}function kn(h){const n=h.value,a=h.key;if(s.J(n)!=="array")return[new s.V(a,n,`array expected, ${s.J(n)} found`)];const f=h.styleSpec;let g,y=[];if(n.length<1)return[new s.V(a,n,"filter array must have at least 1 element")];switch(y=y.concat(pn({key:`${a}[0]`,value:n[0],valueSpec:f.filter_operator,style:h.style,styleSpec:h.styleSpec})),s.M(n[0])){case"<":case"<=":case">":case">=":n.length>=2&&s.M(n[1])==="$type"&&y.push(new s.V(a,n,`"$type" cannot be use with operator "${n[0]}"`));case"==":case"!=":n.length!==3&&y.push(new s.V(a,n,`filter array for operator "${n[0]}" must have 3 elements`));case"in":case"!in":n.length>=2&&(g=s.J(n[1]),g!=="string"&&y.push(new s.V(`${a}[1]`,n[1],`string expected, ${g} found`)));for(let b=2;b<n.length;b++)g=s.J(n[b]),s.M(n[1])==="$type"?y=y.concat(pn({key:`${a}[${b}]`,value:n[b],valueSpec:f.geometry_type,style:h.style,styleSpec:h.styleSpec})):g!=="string"&&g!=="number"&&g!=="boolean"&&y.push(new s.V(`${a}[${b}]`,n[b],`string, number, or boolean expected, ${g} found`));break;case"any":case"all":case"none":for(let b=1;b<n.length;b++)y=y.concat(kn({key:`${a}[${b}]`,value:n[b],style:h.style,styleSpec:h.styleSpec}));break;case"has":case"!has":g=s.J(n[1]),n.length!==2?y.push(new s.V(a,n,`filter array for "${n[0]}" operator must have 2 elements`)):g!=="string"&&y.push(new s.V(`${a}[1]`,n[1],`string expected, ${g} found`))}return y}function pr(h,n){const a=h.key,f=h.style,g=h.layer,y=h.styleSpec,b=h.value,E=h.objectKey,A=y[`${n}_${h.layerType}`];if(!A)return[];const R=E.match(/^(.*)-use-theme$/);if(n==="paint"&&R&&A[R[1]])return s.S(b)?[].concat(Cn({key:h.key,value:b,valueSpec:{type:"string",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},style:f,styleSpec:y,expressionContext:"property",propertyType:n,propertyKey:E})):Cn({key:a,value:b,valueSpec:{type:"string"},style:f,styleSpec:y});const D=E.match(/^(.*)-transition$/);if(n==="paint"&&D&&A[D[1]]&&A[D[1]].transition)return Cn({key:a,value:b,valueSpec:y.transition,style:f,styleSpec:y});const F=h.valueSpec||A[E];if(!F)return[new s.K(a,b,`unknown property "${E}"`)];let N;if(s.J(b)==="string"&&s.O(F)&&!F.tokens&&(N=/^{([^}]+)}$/.exec(b))){const X=`\`{ "type": "identity", "property": ${N?JSON.stringify(N[1]):'"_"'} }\``;return[new s.V(a,b,`"${E}" does not support interpolation syntax
Use an identity property function instead: ${X}.`)]}const j=[];if(h.layerType==="symbol")E!=="text-field"||!f||f.glyphs||f.imports||j.push(new s.V(a,b,'use of "text-field" requires a style "glyphs" property')),E==="text-font"&&s.a2(s.U(b))&&s.M(b.type)==="identity"&&j.push(new s.V(a,b,'"text-font" does not support identity functions'));else if(h.layerType==="model"&&n==="paint"&&g&&g.layout&&g.layout.hasOwnProperty("model-id")&&s.O(F)&&(s.a3(F)||s.Q(F))){const X=s.W(s.U(b),F),W=X.value.expression||X.value._styleExpression.expression;W&&!s.Z(W,["measure-light"])&&(E==="model-emissive-strength"&&s._(W)&&s.Y(W)||j.push(new s.V(a,b,`${E} does not support measure-light expressions when the model layer source is vector tile or GeoJSON.`)))}return j.concat(Cn({key:h.key,value:b,valueSpec:F,style:f,styleSpec:y,expressionContext:"property",propertyType:n,propertyKey:E}))}function Ni(h){return pr(h,"paint")}function Vr(h){return pr(h,"layout")}function Zs(h){let n=[];const a=h.value,f=h.key,g=h.style,y=h.styleSpec;a.type||a.ref||n.push(new s.V(f,a,'either "type" or "ref" is required'));let b=s.M(a.type);const E=s.M(a.ref);if(a.id){const A=s.M(a.id);for(let R=0;R<h.arrayIndex;R++){const D=g.layers[R];s.M(D.id)===A&&n.push(new s.V(f,a.id,`duplicate layer id "${a.id}", previously used at line ${D.id.__line__}`))}}if("ref"in a){let A;["type","source","source-layer","filter","layout"].forEach(R=>{R in a&&n.push(new s.V(f,a[R],`"${R}" is prohibited for ref layers`))}),g.layers.forEach(R=>{s.M(R.id)===E&&(A=R)}),A?A.ref?n.push(new s.V(f,a.ref,"ref cannot reference another ref layer")):b=s.M(A.type):typeof E=="string"&&n.push(new s.V(f,a.ref,`ref layer "${E}" not found`))}else if(b!=="background"&&b!=="sky"&&b!=="slot")if(a.source){const A=g.sources&&g.sources[a.source],R=A&&s.M(A.type);A?R==="vector"&&b==="raster"?n.push(new s.V(f,a.source,`layer "${a.id}" requires a raster source`)):R==="raster"&&b!=="raster"?n.push(new s.V(f,a.source,`layer "${a.id}" requires a vector source`)):R!=="vector"||a["source-layer"]?R==="raster-dem"&&b!=="hillshade"?n.push(new s.V(f,a.source,"raster-dem source can only be used with layer type 'hillshade'.")):R!=="raster-array"||["raster","raster-particle"].includes(b)?b==="line"&&a.paint&&(a.paint["line-gradient"]||a.paint["line-trim-offset"])&&R==="geojson"&&!A.lineMetrics?n.push(new s.V(f,a,`layer "${a.id}" specifies a line-gradient, which requires the GeoJSON source to have \`lineMetrics\` enabled.`)):b==="raster-particle"&&R!=="raster-array"&&n.push(new s.V(f,a.source,`layer "${a.id}" requires a 'raster-array' source.`)):n.push(new s.V(f,a.source,"raster-array source can only be used with layer type 'raster'.")):n.push(new s.V(f,a,`layer "${a.id}" must specify a "source-layer"`)):n.push(new s.V(f,a.source,`source "${a.source}" not found`))}else n.push(new s.V(f,a,'missing required property "source"'));return n=n.concat(Ri({key:f,value:a,valueSpec:y.layer,style:h.style,styleSpec:h.styleSpec,objectElementValidators:{"*":()=>[],type:()=>Cn({key:`${f}.type`,value:a.type,valueSpec:y.layer.type,style:h.style,styleSpec:h.styleSpec,object:a,objectKey:"type"}),filter:A=>sn(s.L({layerType:b},A)),layout:A=>Ri({layer:a,key:A.key,value:A.value,valueSpec:{},style:A.style,styleSpec:A.styleSpec,objectElementValidators:{"*":R=>Vr(s.L({layerType:b},R))}}),paint:A=>Ri({layer:a,key:A.key,value:A.value,valueSpec:{},style:A.style,styleSpec:A.styleSpec,objectElementValidators:{"*":R=>Ni(s.L({layerType:b,layer:a},R))}})}})),n}function As(h){const n=h.value,a=h.key,f=s.J(n);return f!=="string"?[new s.V(a,n,`string expected, ${f} found`)]:[]}const ko={promoteId:function h({key:n,value:a}){if(s.J(a)==="string")return As({key:n,value:a});if(Array.isArray(a)){const f=[],g=s.U(a),y=s.X(g);return y.result==="error"&&y.value.forEach(b=>{f.push(new s.V(`${n}${b.key}`,null,`${b.message}`))}),s.Z(y.value.expression,["zoom","heatmap-density","line-progress","raster-value","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center","measure-light","raster-particle-speed"])||f.push(new s.V(`${n}`,null,"promoteId expression should be only feature dependent")),f}{const f=[];for(const g in a)f.push(...h({key:`${n}.${g}`,value:a[g]}));return f}}};function Qi(h){const n=h.value,a=h.key,f=h.styleSpec,g=h.style;if(!n.type)return[new s.V(a,n,'"type" is required')];const y=s.M(n.type);let b=[];switch(["vector","raster","raster-dem","raster-array"].includes(y)&&(n.url||n.tiles||b.push(new s.K(a,n,'Either "url" or "tiles" is required.'))),y){case"vector":case"raster":case"raster-dem":case"raster-array":return b=b.concat(Ri({key:a,value:n,valueSpec:f[`source_${y.replace("-","_")}`],style:h.style,styleSpec:f,objectElementValidators:ko})),b;case"geojson":if(b=Ri({key:a,value:n,valueSpec:f.source_geojson,style:g,styleSpec:f,objectElementValidators:ko}),n.cluster)for(const E in n.clusterProperties){const[A,R]=n.clusterProperties[E],D=typeof A=="string"?[A,["accumulated"],["get",E]]:A;b.push(...Mt({key:`${a}.${E}.map`,value:R,expressionContext:"cluster-map"})),b.push(...Mt({key:`${a}.${E}.reduce`,value:D,expressionContext:"cluster-reduce"}))}return b;case"video":return Ri({key:a,value:n,valueSpec:f.source_video,style:g,styleSpec:f});case"image":return Ri({key:a,value:n,valueSpec:f.source_image,style:g,styleSpec:f});case"canvas":return[new s.V(a,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return pn({key:`${a}.type`,value:n.type,valueSpec:{values:Ns(f)}})}}function Ns(h){return h.source.reduce((n,a)=>{const f=h[a];return f.type.type==="enum"&&(n=n.concat(Object.keys(f.type.values))),n},[])}function Do(h){const n=h.value,a=h.styleSpec,f=a.light,g=h.style;let y=[];const b=s.J(n);if(n===void 0)return y;if(b!=="object")return y=y.concat([new s.V("light",n,`object expected, ${b} found`)]),y;for(const E in n){const A=E.match(/^(.*)-transition$/),R=E.match(/^(.*)-use-theme$/);y=y.concat(R&&f[R[1]]?Cn({key:E,value:n[E],valueSpec:{type:"string"},style:g,styleSpec:a}):A&&f[A[1]]&&f[A[1]].transition?Cn({key:E,value:n[E],valueSpec:a.transition,style:g,styleSpec:a}):f[E]?Cn({key:E,value:n[E],valueSpec:f[E],style:g,styleSpec:a}):[new s.V(E,n[E],`unknown property "${E}"`)])}return y}function Yo(h){const n=h.value;let a=[];if(!n)return a;const f=s.J(n);if(f!=="object")return a=a.concat([new s.V("light-3d",n,`object expected, ${f} found`)]),a;const g=h.styleSpec,y=g["light-3d"],b=h.key,E=h.style,A=h.style.lights;for(const F of["type","id"])if(!(F in n))return a=a.concat([new s.V("light-3d",n,`missing property ${F} on light`)]),a;if(n.type&&A)for(let F=0;F<h.arrayIndex;F++){const N=s.M(n.type),j=A[F];s.M(j.type)===N&&a.push(new s.V(b,n.id,`duplicate light type "${n.type}", previously defined at line ${j.id.__line__}`))}const R=`properties_light_${n.type}`;if(!(R in g))return a=a.concat([new s.V("light-3d",n,`Invalid light type ${n.type}`)]),a;const D=g[R];for(const F in n)if(F==="properties"){const N=n[F],j=s.J(N);if(j!=="object")return a=a.concat([new s.V("properties",N,`object expected, ${j} found`)]),a;for(const X in N){const W=X.match(/^(.*)-transition$/),K=X.match(/^(.*)-use-theme$/);a=a.concat(K&&D[K[1]]?Cn({key:F,value:N[X],valueSpec:{type:"string"},style:E,styleSpec:g}):W&&D[W[1]]&&D[W[1]].transition?Cn({key:F,value:n[F],valueSpec:g.transition,style:E,styleSpec:g}):D[X]?Cn({key:X,value:N[X],valueSpec:D[X],style:E,styleSpec:g}):[new s.K(h.key,N[X],`unknown property "${X}"`)])}}else a=a.concat(y[F]?Cn({key:F,value:n[F],valueSpec:y[F],style:E,styleSpec:g}):[new s.K(F,n[F],`unknown property "${F}"`)]);return a}function _o(h){const n=h.value,a=h.key,f=h.style,g=h.styleSpec,y=g.terrain;let b=[];const E=s.J(n);if(n===void 0||E==="null")return b;if(E!=="object")return b=b.concat([new s.V("terrain",n,`object expected, ${E} found`)]),b;for(const A in n){const R=A.match(/^(.*)-transition$/),D=A.match(/^(.*)-use-theme$/);b=b.concat(D&&y[D[1]]?Cn({key:A,value:n[A],valueSpec:{type:"string"},style:f,styleSpec:g}):R&&y[R[1]]&&y[R[1]].transition?Cn({key:A,value:n[A],valueSpec:g.transition,style:f,styleSpec:g}):y[A]?Cn({key:A,value:n[A],valueSpec:y[A],style:f,styleSpec:g}):[new s.K(A,n[A],`unknown property "${A}"`)])}if(n.source){const A=f.sources&&f.sources[n.source],R=A&&s.M(A.type);A?R!=="raster-dem"&&b.push(new s.V(a,n.source,`terrain cannot be used with a source of type ${String(R)}, it only be used with a "raster-dem" source type`)):b.push(new s.V(a,n.source,`source "${n.source}" not found`))}else b.push(new s.V(a,n,'terrain is missing required property "source"'));return b}function zs(h){const n=h.value,a=h.style,f=h.styleSpec,g=f.fog;let y=[];const b=s.J(n);if(n===void 0)return y;if(b!=="object")return y=y.concat([new s.V("fog",n,`object expected, ${b} found`)]),y;for(const E in n){const A=E.match(/^(.*)-transition$/),R=E.match(/^(.*)-use-theme$/);y=y.concat(R&&g[R[1]]?Cn({key:E,value:n[E],valueSpec:{type:"string"},style:a,styleSpec:f}):A&&g[A[1]]&&g[A[1]].transition?Cn({key:E,value:n[E],valueSpec:f.transition,style:a,styleSpec:f}):g[E]?Cn({key:E,value:n[E],valueSpec:g[E],style:a,styleSpec:f}):[new s.K(E,n[E],`unknown property "${E}"`)])}return y}const Wl={"*":()=>[],array:Ws,boolean:function(h){const n=h.value,a=h.key,f=s.J(n);return f!=="boolean"?[new s.V(a,n,`boolean expected, ${f} found`)]:[]},number:We,color:function(h){const n=h.key,a=h.value,f=s.J(a);return f!=="string"?[new s.V(n,a,`color expected, ${f} found`)]:s.a0.parseCSSColor(a)===null?[new s.V(n,a,`color expected, "${a}" found`)]:[]},enum:pn,filter:sn,function:ut,layer:Zs,object:Ri,source:Qi,model:s.a4,light:Do,"light-3d":Yo,terrain:_o,fog:zs,string:As,formatted:function(h){return As(h).length===0?[]:Mt(h)},resolvedImage:function(h){return As(h).length===0?[]:Mt(h)},projection:function(h){const n=h.value,a=h.styleSpec,f=a.projection,g=h.style;let y=[];const b=s.J(n);if(b==="object")for(const E in n)y=y.concat(Cn({key:E,value:n[E],valueSpec:f[E],style:g,styleSpec:a}));else b!=="string"&&(y=y.concat([new s.V("projection",n,`object or string expected, ${b} found`)]));return y},import:function(h){const{value:n,styleSpec:a}=h,{data:f,...g}=n;Object.defineProperty(g,"__line__",{value:n.__line__,enumerable:!1});let y=Ri(s.L({},h,{value:g,valueSpec:a.import}));return s.M(g.id)===""&&y.push(new s.V(`${h.key}.id`,g,"import id can't be an empty string")),f&&(y=y.concat(gi(f,a,{key:`${h.key}.data`}))),y},iconset:function(h){const n=h.value,a=h.key,f=h.styleSpec,g=h.style;if(!n.type)return[new s.V(a,n,'"type" is required')];const y=s.M(n.type);let b=[];if(b=b.concat(Ri({key:a,value:n,valueSpec:f[`iconset_${y}`],style:g,styleSpec:f})),y==="source"&&n.source){const E=g.sources&&g.sources[n.source],A=E&&s.M(E.type);E?A!=="raster-array"&&b.push(new s.V(a,n.source,`iconset cannot be used with a source of type ${String(A)}, it only be used with a "raster-array" source type`)):b.push(new s.V(a,n.source,`source "${n.source}" not found`))}return b}};function Cn(h,n=!1){const a=h.value,f=h.valueSpec,g=h.styleSpec;if(f.expression&&s.a2(s.M(a)))return ut(h);if(f.expression&&s.S(s.U(a)))return Mt(h);if(f.type&&Wl[f.type]){const y=Wl[f.type](h);return n===!0&&y.length>0&&s.J(h.value)==="array"?Mt(h):y}return Ri(s.L({},h,{valueSpec:f.type?g[f.type]:f}))}function mi(h){const n=h.value,a=h.key,f=As(h);return f.length||(n.indexOf("{fontstack}")===-1&&f.push(new s.V(a,n,'"glyphs" url must include a "{fontstack}" token')),n.indexOf("{range}")===-1&&f.push(new s.V(a,n,'"glyphs" url must include a "{range}" token'))),f}function gi(h,n=s.a5,a={}){return Cn({key:a.key||"",value:h,valueSpec:n.$root,styleSpec:n,style:h,objectElementValidators:{glyphs:mi,"*":()=>[]}})}function Ui(h,n=s.a5){return Ce(gi(h,n))}const yo=h=>Ce(Qi(h)),tl=h=>Ce(Do(h)),nl=h=>Ce(Yo(h)),Dt=h=>Ce(_o(h)),rl=h=>Ce(zs(h)),h_=h=>Ce(function(n){const a=n.value,f=n.style,g=n.styleSpec,y=g.snow;let b=[];const E=s.J(a);if(a===void 0)return b;if(E!=="object")return b=b.concat([new s.V("snow",a,`object expected, ${E} found`)]),b;for(const A in a){const R=A.match(/^(.*)-transition$/);b=b.concat(R&&y[R[1]]&&y[R[1]].transition?Cn({key:A,value:a[A],valueSpec:g.transition,style:f,styleSpec:g}):y[A]?Cn({key:A,value:a[A],valueSpec:y[A],style:f,styleSpec:g}):[new s.K(A,a[A],`unknown property "${A}"`)])}return b}(h)),Eh=h=>Ce(function(n){const a=n.value,f=n.style,g=n.styleSpec,y=g.rain;let b=[];const E=s.J(a);if(a===void 0)return b;if(E!=="object")return b=b.concat([new s.V("rain",a,`object expected, ${E} found`)]),b;for(const A in a){const R=A.match(/^(.*)-transition$/);b=b.concat(R&&y[R[1]]&&y[R[1]].transition?Cn({key:A,value:a[A],valueSpec:g.transition,style:f,styleSpec:g}):y[A]?Cn({key:A,value:a[A],valueSpec:y[A],style:f,styleSpec:g}):[new s.K(A,a[A],`unknown property "${A}"`)])}return b}(h)),mr=h=>Ce(Zs(h)),He=h=>Ce(sn(h)),J=h=>Ce(Ni(h)),oe=h=>Ce(Vr(h)),ge=h=>Ce(s.a4(h));function Ce(h){return h.slice().sort((n,a)=>n.line&&a.line?n.line-a.line:0)}function xe(h,n){let a=!1;if(n&&n.length)for(const f of n)f instanceof s.K?s.w(f.message):(h.fire(new s.z(new Error(f.message))),a=!0);return a}let ke;class Ue extends s.E{constructor(n,a="flat"){super(),this._transitionable=new s.a6(ke||(ke=new s.a7({anchor:new s.a8(s.a5.light.anchor),position:new s.a9(s.a5.light.position),color:new s.a8(s.a5.light.color),intensity:new s.a8(s.a5.light.intensity)}))),this.setLight(n,a),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(n,a,f={}){this._validate(tl,n,f)||(this._transitionable.setTransitionOrValue(n),this.id=a)}updateTransitions(n){this._transitioning=this._transitionable.transitioned(n,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(n){this.properties=this._transitioning.possiblyEvaluate(n)}_validate(n,a,f){return(!f||f.validate!==!1)&&xe(this,n.call(Ui,s.h({value:a,style:{glyphs:!0,sprite:!0},styleSpec:s.a5})))}}let De=class extends s.E{constructor(h,n,a,f,g){super(),this.scope=a,this._transitionable=new s.a6(new s.a7({source:new s.a8(s.a5.terrain.source),exaggeration:new s.a8(s.a5.terrain.exaggeration)}),a,f),this._transitionable.setTransitionOrValue(h,f),this._transitioning=this._transitionable.untransitioned(),this.drapeRenderMode=n,this.worldview=g}get(){return this._transitionable.serialize()}set(h,n){this._transitionable.setTransitionOrValue(h,n)}updateTransitions(h){this._transitioning=this._transitionable.transitioned(h,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(h){this.properties=this._transitioning.possiblyEvaluate(h)}getExaggeration(h){return this._transitioning.possiblyEvaluate(new s.aa(h,{worldview:this.worldview})).get("exaggeration")}getAttenuationRange(){if(!this.isZoomDependent())return null;const h=this._transitionable._values.exaggeration;if(!h)return null;const n=h.value.expression;if(!n)return null;let a=-1,f=-1,g=1;for(const y of n.zoomStops)g=n.evaluate(new s.aa(y,{worldview:this.worldview})),g>.01?(a=y,f=-1):f=y;return g<.01&&a>0&&f>a?[a,f]:null}isZoomDependent(){const h=this._transitionable._values.exaggeration;return h!=null&&h.value!=null&&h.value.expression!=null&&h.value.expression instanceof s.ab}};const $e=45,ct=65,qe=.05;function kt(h,n,a,f){const g=s.af($e,ct,a),[y,b]=Qt(h,f);let E=1-Math.min(1,Math.exp((n-y)/(b-y)*-6));return E*=E*E,E=Math.min(1,1.00747*E),E*g*h.alpha}function Qt(h,n){const a=.5/Math.tan(.5*n);return[h.range[0]+a,h.range[1]+a]}function en(h,n,a,f,g){const y=s.ad([],[n,a,f],g.mercatorFogMatrix);return kt(h,s.ae(y),g.pitch,g._fov)}function Tn(h,n,a,f,g,y,b){const E=[[a,f,0],[g,f,0],[g,y,0],[a,y,0]];let A=Number.MAX_VALUE,R=-Number.MAX_VALUE;for(const D of E){const F=s.ad([],D,n),N=s.ae(F);A=Math.min(A,N),R=Math.max(R,N)}return[kt(h,A,b.pitch,b._fov),kt(h,R,b.pitch,b._fov)]}class In extends s.E{constructor(n,a,f,g){super();const y=new s.a7({range:new s.a8(s.a5.fog.range),color:new s.a8(s.a5.fog.color),"color-use-theme":new s.a8({type:"string","property-type":"data-constant",default:"default"}),"high-color":new s.a8(s.a5.fog["high-color"]),"high-color-use-theme":new s.a8({type:"string","property-type":"data-constant",default:"default"}),"space-color":new s.a8(s.a5.fog["space-color"]),"space-color-use-theme":new s.a8({type:"string","property-type":"data-constant",default:"default"}),"horizon-blend":new s.a8(s.a5.fog["horizon-blend"]),"star-intensity":new s.a8(s.a5.fog["star-intensity"]),"vertical-range":new s.a8(s.a5.fog["vertical-range"])});this._transitionable=new s.a6(y,f,new Map(g)),this.set(n,g),this._transitioning=this._transitionable.untransitioned(),this._transform=a,this.properties=new s.ag(y),this.scope=f}get state(){const n=this._transform,a=n.projection.name==="globe",f=s.ah(n.zoom),g=this.properties.get("range"),y=[.5,3];return{range:a?[s.ai(y[0],g[0],f),s.ai(y[1],g[1],f)]:g,horizonBlend:this.properties.get("horizon-blend"),alpha:this.properties.get("color").a}}get(){return this._transitionable.serialize()}set(n,a,f={}){if(this._validate(rl,n,f))return;const g=s.h({},n);for(const y of Object.keys(s.a5.fog))g[y]===void 0&&(g[y]=s.a5.fog[y].default);this._options=g,this._transitionable.setTransitionOrValue(this._options,a)}getOpacity(n){if(!this._transform.projection.supportsFog)return 0;const a=this.properties&&this.properties.get("color")||1;return(this._transform.projection.name==="globe"?1:s.af($e,ct,n))*a.a}getOpacityAtLatLng(n,a){return this._transform.projection.supportsFog?function(f,g,y){const b=s.ac.fromLngLat(g),E=y.elevation?y.elevation.getAtPointOrZero(b):0;return en(f,b.x,b.y,E,y)}(this.state,n,a):0}getOpacityForTile(n){if(!this._transform.projection.supportsFog)return[1,1];const a=this._transform.calculateFogTileMatrix(n.toUnwrapped());return Tn(this.state,a,0,0,s.aj,s.aj,this._transform)}getOpacityForBounds(n,a,f,g,y){return this._transform.projection.supportsFog?Tn(this.state,n,a,f,g,y,this._transform):[1,1]}getFovAdjustedRange(n){return this._transform.projection.supportsFog?Qt(this.state,n):[0,1]}isVisibleOnFrustum(n){if(!this._transform.projection.supportsFog)return!1;const a=[4,5,6,7];for(const f of a){const g=n.points[f];let y;if(g[2]>=0)y=g;else{const b=n.points[f-4];y=s.ak(b,g,b[2]/(b[2]-g[2]))}if(en(this.state,y[0],y[1],0,this._transform)>=qe)return!0}return!1}updateConfig(n){this._transitionable.setTransitionOrValue(this._options,new Map(n))}updateTransitions(n){this._transitioning=this._transitionable.transitioned(n,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(n){this.properties=this._transitioning.possiblyEvaluate(n)}_validate(n,a,f){return(!f||f.validate!==!1)&&xe(this,n.call(Ui,s.h({value:a,style:{glyphs:!0,sprite:!0},styleSpec:s.a5})))}}let Rn,Kn,On,Ur,li=class extends s.E{constructor(h,n,a,f){super();const g=Rn||(Rn=new s.a7({density:new s.a8(s.a5.snow.density),intensity:new s.a8(s.a5.snow.intensity),color:new s.a8(s.a5.snow.color),opacity:new s.a8(s.a5.snow.opacity),vignette:new s.a8(s.a5.snow.vignette),"vignette-color":new s.a8(s.a5.snow["vignette-color"]),"center-thinning":new s.a8(s.a5.snow["center-thinning"]),direction:new s.a8(s.a5.snow.direction),"flake-size":new s.a8(s.a5.snow["flake-size"])}));this._transitionable=new s.a6(g,a,new Map(f)),this.set(h,f),this._transitioning=this._transitionable.untransitioned(),this.properties=new s.ag(g),this.scope=a}get state(){const h=this.properties.get("opacity"),n=this.properties.get("color"),a=this.properties.get("direction"),f=s.al(a[0]),g=-Math.max(s.al(a[1]),.01),y=[Math.cos(f)*Math.cos(g),Math.sin(f)*Math.cos(g),Math.sin(g)],b=this.properties.get("vignette"),E=this.properties.get("vignette-color");return E.a=b,{density:this.properties.get("density"),intensity:this.properties.get("intensity"),color:new s.am(n.r,n.g,n.b,n.a*h),direction:y,centerThinning:this.properties.get("center-thinning"),flakeSize:this.properties.get("flake-size"),vignetteColor:E}}get(){return this._transitionable.serialize()}set(h,n,a={}){if(this._validate(h_,h,a))return;const f=s.h({},h);for(const g of Object.keys(s.a5.snow))f[g]===void 0&&(f[g]=s.a5.snow[g].default);this._options=f,this._transitionable.setTransitionOrValue(this._options,n)}updateConfig(h){this._transitionable.setTransitionOrValue(this._options,new Map(h))}updateTransitions(h){this._transitioning=this._transitionable.transitioned(h,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(h){this.properties=this._transitioning.possiblyEvaluate(h)}_validate(h,n,a){return(!a||a.validate!==!1)&&xe(this,h.call(Ui,s.h({value:n,style:{glyphs:!0,sprite:!0},styleSpec:s.a5})))}},ci=class extends s.E{constructor(h,n,a,f){super();const g=Kn||(Kn=new s.a7({density:new s.a8(s.a5.rain.density),intensity:new s.a8(s.a5.rain.intensity),color:new s.a8(s.a5.rain.color),opacity:new s.a8(s.a5.rain.opacity),vignette:new s.a8(s.a5.rain.vignette),"vignette-color":new s.a8(s.a5.rain["vignette-color"]),"center-thinning":new s.a8(s.a5.rain["center-thinning"]),direction:new s.a8(s.a5.rain.direction),"droplet-size":new s.a8(s.a5.rain["droplet-size"]),"distortion-strength":new s.a8(s.a5.rain["distortion-strength"])}));this._transitionable=new s.a6(g,a,new Map(f)),this.set(h,f),this._transitioning=this._transitionable.untransitioned(),this.properties=new s.ag(g),this.scope=a}get state(){const h=this.properties.get("opacity"),n=this.properties.get("color"),a=this.properties.get("direction"),f=s.al(a[0]),g=-Math.max(s.al(a[1]),.01),y=[Math.cos(f)*Math.cos(g),Math.sin(f)*Math.cos(g),Math.sin(g)],b=this.properties.get("vignette-color");return b.a=this.properties.get("vignette"),{density:this.properties.get("density"),intensity:this.properties.get("intensity"),color:new s.am(n.r,n.g,n.b,n.a*h),direction:y,centerThinning:this.properties.get("center-thinning"),dropletSize:this.properties.get("droplet-size"),distortionStrength:this.properties.get("distortion-strength"),vignetteColor:b}}get(){return this._transitionable.serialize()}set(h,n,a={}){if(this._validate(Eh,h,a))return;const f=s.h({},h);for(const g of Object.keys(s.a5.rain))f[g]===void 0&&(f[g]=s.a5.rain[g].default);this._options=f,this._transitionable.setTransitionOrValue(this._options,n)}updateConfig(h){this._transitionable.setTransitionOrValue(this._options,new Map(h))}updateTransitions(h){this._transitioning=this._transitionable.transitioned(h,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(h){this.properties=this._transitioning.possiblyEvaluate(h)}_validate(h,n,a){return(!a||a.validate!==!1)&&xe(this,h.call(Ui,s.h({value:n,style:{glyphs:!0,sprite:!0},styleSpec:s.a5})))}};class Rr extends s.E{constructor(n,a,f,g){super(),this.scope=f,this._options=n,this.properties=new s.ag(a),this._transitionable=new s.a6(a,f,new Map(g)),this._transitionable.setTransitionOrValue(n.properties),this._transitioning=this._transitionable.untransitioned()}updateConfig(n){this._transitionable.setTransitionOrValue(this._options.properties,new Map(n))}updateTransitions(n){this._transitioning=this._transitionable.transitioned(n,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(n){this.properties=this._transitioning.possiblyEvaluate(n)}get(){return this._options.properties=this._transitionable.serialize(),this._options}set(n,a){this._options=n,this._transitionable.setTransitionOrValue(n.properties,a)}shadowsEnabled(){return!!this.properties&&this.properties.get("cast-shadows")===!0}}class _r{constructor(n,a,f,g){this.screenBounds=n,this.cameraPoint=a,this._screenRaycastCache={},this._cameraRaycastCache={},this.isAboveHorizon=f,this.screenGeometry=this.bufferedScreenGeometry(0),this.screenGeometryMercator=this._bufferedScreenMercator(0,g)}static createFromScreenPoints(n,a){let f,g;if(n instanceof s.P||typeof n[0]=="number"){const y=s.P.convert(n);f=[y],g=a.isPointAboveHorizon(y)}else{const y=s.P.convert(n[0]),b=s.P.convert(n[1]),E=y.add(b)._div(2);f=[y,b],g=s.ao(y,b).every(A=>a.isPointAboveHorizon(A))&&a.isPointAboveHorizon(E)}return new _r(f,a.getCameraPoint(),g,a)}isPointQuery(){return this.screenBounds.length===1}bufferedScreenGeometry(n){return s.ao(this.screenBounds[0],this.screenBounds.length===1?this.screenBounds[0]:this.screenBounds[1],n)}bufferedCameraGeometry(n){const a=this.screenBounds[0],f=this.screenBounds.length===1?this.screenBounds[0].add(new s.P(1,1)):this.screenBounds[1],g=s.ao(a,f,0,!1);return this.cameraPoint.y>f.y&&(this.cameraPoint.x>a.x&&this.cameraPoint.x<f.x?g.splice(3,0,this.cameraPoint):this.cameraPoint.x>=f.x?g[2]=this.cameraPoint:this.cameraPoint.x<=a.x&&(g[3]=this.cameraPoint)),s.ap(g,n)}bufferedCameraGeometryGlobe(n){const a=this.screenBounds[0],f=this.screenBounds.length===1?this.screenBounds[0].add(new s.P(1,1)):this.screenBounds[1],g=s.ao(a,f,n),y=this.cameraPoint.clone();switch(3*((y.y>a.y)+(y.y>f.y))+((y.x>a.x)+(y.x>f.x))){case 0:g[0]=y,g[4]=y.clone();break;case 1:g.splice(1,0,y);break;case 2:g[1]=y;break;case 3:g.splice(4,0,y);break;case 5:g.splice(2,0,y);break;case 6:g[3]=y;break;case 7:g.splice(3,0,y);break;case 8:g[2]=y}return g}containsTile(n,a,f,g=0){const y=n.queryPadding/a._pixelsPerMercatorPixel+1,b=f?this._bufferedCameraMercator(y,a):this._bufferedScreenMercator(y,a);let E=n.tileID.wrap+(b.unwrapped?g:0);const A=b.polygon.map(K=>s.aq(n.tileTransform,K,E));if(!s.ar(A,0,0,s.aj,s.aj))return;E=n.tileID.wrap+(this.screenGeometryMercator.unwrapped?g:0);const R=this.screenGeometryMercator.polygon.map(K=>s.as(n.tileTransform,K,E)),D=R.map(K=>new s.P(K[0],K[1])),F=a.getFreeCameraOptions().position||new s.ac(0,0,0),N=s.as(n.tileTransform,F,E),j=R.map(K=>{const ee=s.at(K,K,N);return s.au(ee,ee),new s.av(N,ee)}),X=s.aw(n,1,a.zoom)*a._pixelsPerMercatorPixel;return{queryGeometry:this,tilespaceGeometry:D,tilespaceRays:j,bufferedTilespaceGeometry:A,bufferedTilespaceBounds:(W=s.ax(A),W.min.x=s.ay(W.min.x,0,s.aj),W.min.y=s.ay(W.min.y,0,s.aj),W.max.x=s.ay(W.max.x,0,s.aj),W.max.y=s.ay(W.max.y,0,s.aj),W),tile:n,tileID:n.tileID,pixelToTileUnitsFactor:X};var W}_bufferedScreenMercator(n,a){const f=_i(n);if(this._screenRaycastCache[f])return this._screenRaycastCache[f];{let g;return g=a.projection.name==="globe"?this._projectAndResample(this.bufferedScreenGeometry(n),a):{polygon:this.bufferedScreenGeometry(n).map(y=>a.pointCoordinate3D(y)),unwrapped:!0},this._screenRaycastCache[f]=g,g}}_bufferedCameraMercator(n,a){const f=_i(n);if(this._cameraRaycastCache[f])return this._cameraRaycastCache[f];{let g;return g=a.projection.name==="globe"?this._projectAndResample(this.bufferedCameraGeometryGlobe(n),a):{polygon:this.bufferedCameraGeometry(n).map(y=>a.pointCoordinate3D(y)),unwrapped:!0},this._cameraRaycastCache[f]=g,g}}_projectAndResample(n,a){const f=function(y,b){const E=s.az([],b.pixelMatrix,b.globeMatrix),A=[0,-s.aB,0,1],R=[0,s.aB,0,1],D=[0,0,0,1];s.aA(A,A,E),s.aA(R,R,E),s.aA(D,D,E);const F=new s.P(A[0]/A[3],A[1]/A[3]),N=new s.P(R[0]/R[3],R[1]/R[3]),j=s.aC(y,F)&&A[3]<D[3],X=s.aC(y,N)&&R[3]<D[3];if(!j&&!X)return null;const W=function(ve,ye,Se){for(let Ee=1;Ee<ve.length;Ee++){const Fe=Si(ye.pointCoordinate3D(ve[Ee-1]).x),je=Si(ye.pointCoordinate3D(ve[Ee]).x);if(Se<0){if(Fe<je)return{idx:Ee,t:-Fe/(je-1-Fe)}}else if(je<Fe)return{idx:Ee,t:(1-Fe)/(je+1-Fe)}}return null}(y,b,j?-1:1);if(!W)return null;const{idx:K,t:ee}=W;let ie=K>1?ki(y.slice(0,K),b):[],fe=K<y.length?ki(y.slice(K),b):[];ie=ie.map(ve=>new s.P(Si(ve.x),ve.y)),fe=fe.map(ve=>new s.P(Si(ve.x),ve.y));const _e=[...ie];_e.length===0&&_e.push(fe[fe.length-1]);const we=s.ai(_e[_e.length-1].y,(fe.length===0?ie[0]:fe[0]).y,ee);let be;return be=j?[new s.P(0,we),new s.P(0,0),new s.P(1,0),new s.P(1,we)]:[new s.P(1,we),new s.P(1,1),new s.P(0,1),new s.P(0,we)],_e.push(...be),fe.length===0?_e.push(ie[0]):_e.push(...fe),{polygon:_e.map(ve=>new s.ac(ve.x,ve.y)),unwrapped:!1}}(n,a);if(f)return f;const g=function(y,b){let E=!1,A=-1/0,R=0;for(let F=0;F<y.length-1;F++)y[F].x>A&&(A=y[F].x,R=F);for(let F=0;F<y.length-1;F++){const N=(R+F)%(y.length-1),j=y[N],X=y[N+1];Math.abs(j.x-X.x)>.5&&(j.x<X.x?(j.x+=1,N===0&&(y[y.length-1].x+=1)):(X.x+=1,N+1===y.length-1&&(y[0].x+=1)),E=!0)}const D=s.aD(b.center.lng);return E&&D<Math.abs(D-1)&&y.forEach(F=>{F.x-=1}),{polygon:y,unwrapped:E}}(ki(n,a).map(y=>new s.P(Si(y.x),y.y)),a);return{polygon:g.polygon.map(y=>new s.ac(y.x,y.y)),unwrapped:g.unwrapped}}}function ki(h,n){return s.aE(h,a=>{const f=n.pointCoordinate3D(a);a.x=f.x,a.y=f.y},1/256)}function Si(h){return h<0?1+h%1:h%1}function _i(h){return 100*h|0}function fs(h,n,a,f,g){const y=function(E,A){if(E)return g(E);if(A){if(h.url&&A.tiles&&h.tiles&&delete h.tiles,A.variants){if(!Array.isArray(A.variants))return g(new Error("variants must be an array"));for(const D of A.variants){if(D==null||typeof D!="object"||D.constructor!==Object)return g(new Error("variant must be an object"));if(!Array.isArray(D.capabilities))return g(new Error("capabilities must be an array"));if(D.capabilities.length===1&&D.capabilities[0]==="meshopt"){A=s.h(A,D);break}}}const R=s.aF(s.h({},A,h),["tilejson","tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","extra_bounds","scheme","tileSize","encoding","vector_layers","raster_layers","worldview_options","worldview_default","worldview"]);R.tiles=n.canonicalizeTileset(R,h.url),g(null,R)}},b=function(E,A,R){if(!E)return null;if(!A&&!R)return E;R=R||E.worldview_default;const D=Object.values(E.language||{});if(D.length===0)return null;const F=Object.values(E.worldview||{});if(F.length===0)return null;const N=D.every(X=>X===A),j=F.every(X=>X===R);return N&&j?E:A in(E.language_options||{})||R in(E.worldview_options||{})?null:E.language_options&&E.worldview_options?E:null}(h.data,a,f);return b?s.q.frame(()=>y(null,b)):h.url?s.n(n.transformRequest(n.normalizeSourceURL(h.url,null,a,f),s.R.Source),y):s.q.frame(()=>{const{data:E,...A}=h;y(null,A)})}function so(h,n){const a=Math.pow(2,n.z),f=Math.floor(s.aD(h.getWest())*a),g=Math.floor(s.aH(h.getNorth())*a),y=Math.ceil(s.aD(h.getEast())*a),b=Math.ceil(s.aH(h.getSouth())*a);return n.x>=f&&n.x<y&&n.y>=g&&n.y<b}class Os{constructor(n,a,f){this.bounds=n?s.aG.convert(this.validateBounds(n)):null,this.minzoom=a||0,this.maxzoom=f||24}validateBounds(n){return Array.isArray(n)&&n.length===4?[Math.max(-180,n[0]),Math.max(-90,n[1]),Math.min(180,n[2]),Math.min(90,n[3])]:[-180,-90,180,90]}addExtraBounds(n){if(n){this.extraBounds||(this.extraBounds=[]);for(const a of n)this.extraBounds.push(s.aG.convert(this.validateBounds(a)))}}contains(n){if(n.z>this.maxzoom||n.z<this.minzoom||this.bounds&&!so(this.bounds,n))return!1;if(!this.extraBounds)return!0;for(const a of this.extraBounds)if(so(a,n))return!0;return!1}static fromTileJSON(n){if(!n.bounds&&!n.extra_bounds)return null;const a=new Os(n.bounds,n.minzoom,n.maxzoom);return a.addExtraBounds(n.extra_bounds),a}}class Ch extends s.E{constructor(n,a,f,g){if(super(),this.id=n,this.dispatcher=f,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,s.h(this,s.aF(a,["url","scheme","tileSize","promoteId"])),this._options=s.h({type:"vector"},a),this._collectResourceTiming=!!a.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(g),this._tileWorkers={},this._deduped=new s.aI}load(n){this._loaded=!1,this.fire(new s.A("dataloading",{dataType:"source"}));const a=Array.isArray(this.map._language)?this.map._language.join():this.map._language,f=this.map.getWorldview();this._tileJSONRequest=fs(this._options,this.map._requestManager,a,f,(g,y)=>{if(this._tileJSONRequest=null,this._loaded=!0,g)a&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${a}`),f&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${f}`),this.fire(new s.z(g));else if(y){if(s.h(this,y),this.hasWorldviews=!!y.worldview_options,y.worldview_default&&(this.worldviewDefault=y.worldview_default),y.vector_layers){this.vectorLayers=y.vector_layers,this.vectorLayerIds=[],this.localizableLayerIds=new Set;for(const b of y.vector_layers)this.vectorLayerIds.push(b.id),y.worldview&&y.worldview[b.source]&&this.localizableLayerIds.add(b.id)}this.tileBounds=Os.fromTileJSON(y),fn(y.tiles,this.map._requestManager._customAccessToken),this.fire(new s.A("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new s.A("data",{dataType:"source",sourceDataType:"content"}))}n&&n(g)})}loaded(){return this._loaded}hasTile(n){return!this.tileBounds||this.tileBounds.contains(n.canonical)}onAdd(n){this.map=n,this.load()}reload(){this.cancelTileJSONRequest();const n=s.C(this.id,this.scope);this.load(()=>this.map.style.clearSource(n))}setTiles(n){return this._options.tiles=n,this.reload(),this}setUrl(n){return this.url=n,this._options.url=n,this.reload(),this}onRemove(n){this.cancelTileJSONRequest()}serialize(){return s.h({},this._options)}loadTile(n,a){const f=n.tileID.canonical.url(this.tiles,this.scheme),g=this.map._requestManager.normalizeTileURL(f),y=this.map._requestManager.transformRequest(g,s.R.Tile),b=this.map.style?this.map.style.getLut(this.scope):null,E=b?{image:b.image.clone()}:null,A={request:y,data:void 0,uid:n.uid,tileID:n.tileID,tileZoom:n.tileZoom,zoom:n.tileID.overscaledZ,maxZoom:this.maxzoom,lut:E,tileSize:this.tileSize*n.tileID.overscaleFactor(),type:this.type,source:this.id,scope:this.scope,pixelRatio:s.q.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,isSymbolTile:n.isSymbolTile,brightness:this.map.style&&this.map.style.getBrightness()||0,extraShadowCaster:n.isExtraShadowCaster,tessellationStep:this.map._tessellationStep,scaleFactor:this.map.getScaleFactor(),worldview:this.map.getWorldview()||this.worldviewDefault};if(this.hasWorldviews&&s.j(f)&&(A.localizableLayerIds=this.localizableLayerIds),A.request.collectResourceTiming=this._collectResourceTiming,n.actor&&n.state!=="expired")n.state==="loading"?n.reloadCallback=a:n.request=n.actor.send("reloadTile",A,R.bind(this));else if(n.actor=this._tileWorkers[g]=this._tileWorkers[g]||this.dispatcher.getActor(),this.dispatcher.ready)n.request=n.actor.send("loadTile",A,R.bind(this),void 0,!0);else{const D=s.aJ.call({deduped:this._deduped},A,(F,N)=>{F||!N?R.call(this,F):(A.data={cacheControl:N.cacheControl,expires:N.expires,rawData:N.rawData.slice(0)},n.actor&&n.actor.send("loadTile",A,R.bind(this),void 0,!0))},!0);n.request={cancel:D}}function R(D,F){return delete n.request,n.aborted?a(null):D&&D.status!==404?a(D):(F&&F.resourceTiming&&(n.resourceTiming=F.resourceTiming),this.map._refreshExpiredTiles&&F&&n.setExpiryData(F),n.loadVectorData(F,this.map.painter),s.aK(this.dispatcher),a(null),void(n.reloadCallback&&(this.loadTile(n,n.reloadCallback),n.reloadCallback=null)))}}abortTile(n){n.request&&(n.request.cancel(),delete n.request),n.actor&&n.actor.send("abortTile",{uid:n.uid,type:this.type,source:this.id,scope:this.scope})}unloadTile(n,a){n.actor&&n.actor.send("removeTile",{uid:n.uid,type:this.type,source:this.id,scope:this.scope}),n.destroy()}hasTransition(){return!1}afterUpdate(){this._tileWorkers={}}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}class vs extends s.E{constructor(n,a,f,g){super(),this.id=n,this.dispatcher=f,this.setEventedParent(g),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=s.h({type:"raster"},a),s.h(this,s.aF(a,["url","scheme","tileSize"]))}load(n){this._loaded=!1,this.fire(new s.A("dataloading",{dataType:"source"}));const a=this.map.getWorldview();this._tileJSONRequest=fs(this._options,this.map._requestManager,null,a,(f,g)=>{this._tileJSONRequest=null,this._loaded=!0,f?this.fire(new s.z(f)):g&&(s.h(this,g),g.raster_layers&&(this.rasterLayers=g.raster_layers,this.rasterLayerIds=this.rasterLayers.map(y=>y.id)),this.tileBounds=Os.fromTileJSON(g),fn(g.tiles),this.fire(new s.A("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new s.A("data",{dataType:"source",sourceDataType:"content"}))),n&&n(f)})}loaded(){return this._loaded}onAdd(n){this.map=n,this.load()}reload(){this.cancelTileJSONRequest();const n=s.C(this.id,this.scope);this.load(()=>this.map.style.clearSource(n))}setTiles(n){return this._options.tiles=n,this.reload(),this}setUrl(n){return this.url=n,this._options.url=n,this.reload(),this}onRemove(n){this.cancelTileJSONRequest()}serialize(){return s.h({},this._options)}hasTile(n){return!this.tileBounds||this.tileBounds.contains(n.canonical)}loadTile(n,a){const f=s.q.devicePixelRatio>=2,g=this.map._requestManager.normalizeTileURL(n.tileID.canonical.url(this.tiles,this.scheme),f,this.tileSize);n.request=s.o(this.map._requestManager.transformRequest(g,s.R.Tile),(y,b,E,A)=>(delete n.request,n.aborted?(n.state="unloaded",a(null)):y?(n.state="errored",a(y)):b?(this.map._refreshExpiredTiles&&n.setExpiryData({cacheControl:E,expires:A}),n.setTexture(b,this.map.painter),n.state="loaded",s.aK(this.dispatcher),void a(null)):a(null)))}abortTile(n,a){n.request&&(n.request.cancel(),delete n.request),a&&a()}unloadTile(n,a){n.texture&&n.texture instanceof s.T?(n.destroy(!0),n.texture&&n.texture instanceof s.T&&this.map.painter.saveTileTexture(n.texture)):n.destroy(),a&&a()}hasTransition(){return!1}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}class Zl extends vs{constructor(n,a,f,g){super(n,a,f,g),this.type="raster-array",this.maxzoom=22,this.partial=!0,this._options=s.h({type:"raster-array"},a)}triggerRepaint(n){const a=this.map.painter._terrain,f=this.map.style.getSourceCache(this.id);a&&a.enabled&&f&&a._clearRenderCacheForTile(f.id,n.tileID),this.map.triggerRepaint()}loadTile(n,a){const f=this.map._requestManager.normalizeTileURL(n.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize),g=this.map._requestManager.transformRequest(f,s.R.Tile),y={request:g,uid:n.uid,tileID:n.tileID,type:this.type,source:this.id,scope:this.scope,partial:this.partial};n.source=this.id,n.scope=this.scope,n.requestParams=g,n.actor||(n.actor=this.dispatcher.getActor());const b=(E,A,R,D)=>{if(delete n.request,n.aborted)return n.state="unloaded",a(null);if(E)return E.name==="AbortError"?void 0:(n.state="errored",a(E));if(this.map._refreshExpiredTiles&&A&&n.setExpiryData({cacheControl:R,expires:D}),this.partial)n.state="empty";else{if(!A)return a(null);n.state="loaded",n._isHeaderLoaded=!0,n._mrt=A}a(null)};n.request=this.partial?n.fetchHeader(void 0,b.bind(this)):n.actor.send("loadTile",y,b.bind(this),void 0,!0)}abortTile(n){n.request&&(n.request.cancel(),delete n.request),n.actor&&n.actor.send("abortTile",{uid:n.uid,type:this.type,source:this.id,scope:this.scope})}unloadTile(n,a){const f=n.texture;f&&f instanceof s.T?(n.destroy(!0),this.map.painter.saveTileTexture(f)):(n.destroy(),n.flushQueues(),n._isHeaderLoaded=!1,delete n._mrt,delete n.textureDescriptor),n.fbo&&(n.fbo.destroy(),delete n.fbo),delete n.request,delete n.requestParams,delete n.neighboringTiles,n.state="unloaded"}prepareTile(n,a,f){n._isHeaderLoaded&&(n.state!=="empty"&&(n.state="reloading"),n.fetchBand(a,f,(g,y)=>{if(g)return n.state="errored",this.fire(new s.z(g)),void this.triggerRepaint(n);y&&(n._isHeaderLoaded=!0,n.setTexture(y,this.map.painter),n.state="loaded",this.triggerRepaint(n))}))}getInitialBand(n){if(!this.rasterLayers)return 0;const a=this.rasterLayers.find(({id:y})=>y===n),f=a&&a.fields,g=f&&f.bands&&f.bands;return g?g[0]:0}getTextureDescriptor(n,a,f){if(!n)return;const g=a.sourceLayer||this.rasterLayerIds&&this.rasterLayerIds[0];if(!g)return;let y=null;a instanceof s.aN?y=a.paint.get("raster-array-band"):a instanceof s.aO&&(y=a.paint.get("raster-particle-array-band"));const b=y||this.getInitialBand(g);if(b!=null)if(n.textureDescriptor){if(!n.updateNeeded(g,b)||f)return Object.assign({},n.textureDescriptor,{texture:n.texture})}else this.prepareTile(n,g,b)}getImages(n,a){const f=new Map;for(const g of n)for(const y of a){const[b,E]=y.split("/"),A=g.getLayer(b);if(!A||!A.hasBand(E)||!A.hasDataForBand(E))continue;const{bytes:R,tileSize:D,buffer:F}=A.getBandView(E),N=D+2*F,j={data:new s.r({width:N,height:N},R),pixelRatio:2,sdf:!1,usvg:!1,version:0};f.set(y,j)}return f}}const Sp={vector:Ch,raster:vs,"raster-dem":class extends vs{constructor(h,n,a,f){super(h,n,a,f),this.type="raster-dem",this.maxzoom=22,this._options=s.h({type:"raster-dem"},n),this.encoding=n.encoding||"mapbox"}loadTile(h,n){const a=this.map._requestManager.normalizeTileURL(h.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize);function f(g,y){g&&(h.state="errored",n(g)),y&&(h.dem=y,h.dem.onDeserialize(),h.needsHillshadePrepare=!0,h.needsDEMTextureUpload=!0,h.state="loaded",n(null))}h.request=s.o(this.map._requestManager.transformRequest(a,s.R.Tile),(function(g,y,b,E){if(delete h.request,h.aborted)h.state="unloaded",n(null);else if(g)h.state="errored",n(g);else if(y){this.map._refreshExpiredTiles&&h.setExpiryData({cacheControl:b,expires:E});const A=ImageBitmap&&y instanceof ImageBitmap&&s.t(),R=1-(y.width-s.aL(y.width))/2;R<1||h.neighboringTiles||(h.neighboringTiles=this._getNeighboringTiles(h.tileID));const D=A?y:s.q.getImageData(y,R),F={uid:h.uid,tileID:h.tileID,source:this.id,type:this.type,scope:this.scope,rawImageData:D,encoding:this.encoding,padding:R};h.actor&&h.state!=="expired"||(h.actor=this.dispatcher.getActor(),h.actor.send("loadTile",F,f.bind(this),void 0,!0))}}).bind(this))}_getNeighboringTiles(h){const n=h.canonical,a=Math.pow(2,n.z),f=(n.x-1+a)%a,g=n.x===0?h.wrap-1:h.wrap,y=(n.x+1+a)%a,b=n.x+1===a?h.wrap+1:h.wrap,E={};return E[new s.aM(h.overscaledZ,g,n.z,f,n.y).key]={backfilled:!1},E[new s.aM(h.overscaledZ,b,n.z,y,n.y).key]={backfilled:!1},n.y>0&&(E[new s.aM(h.overscaledZ,g,n.z,f,n.y-1).key]={backfilled:!1},E[new s.aM(h.overscaledZ,h.wrap,n.z,n.x,n.y-1).key]={backfilled:!1},E[new s.aM(h.overscaledZ,b,n.z,y,n.y-1).key]={backfilled:!1}),n.y+1<a&&(E[new s.aM(h.overscaledZ,g,n.z,f,n.y+1).key]={backfilled:!1},E[new s.aM(h.overscaledZ,h.wrap,n.z,n.x,n.y+1).key]={backfilled:!1},E[new s.aM(h.overscaledZ,b,n.z,y,n.y+1).key]={backfilled:!1}),E}},"raster-array":Zl,geojson:class extends s.E{constructor(h,n,a,f){super(),this.id=h,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._loaded=!1,this.actor=a.getActor(),this.setEventedParent(f),this._data=n.data,this._options=s.h({},n),this._collectResourceTiming=n.collectResourceTiming,n.maxzoom!==void 0&&(this.maxzoom=n.maxzoom),n.minzoom!==void 0&&(this.minzoom=n.minzoom),n.type&&(this.type=n.type),n.attribution&&(this.attribution=n.attribution),this.promoteId=n.promoteId;const g=s.aj/this.tileSize;this.workerOptions=s.h({source:this.id,scope:this.scope,cluster:n.cluster||!1,geojsonVtOptions:{buffer:(n.buffer!==void 0?n.buffer:128)*g,tolerance:(n.tolerance!==void 0?n.tolerance:.375)*g,extent:s.aj,maxZoom:this.maxzoom,lineMetrics:n.lineMetrics||!1,generateId:n.generateId||!1},superclusterOptions:{maxZoom:n.clusterMaxZoom!==void 0?n.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,n.clusterMinPoints||2),extent:s.aj,radius:(n.clusterRadius!==void 0?n.clusterRadius:50)*g,log:!1,generateId:n.generateId||!1},clusterProperties:n.clusterProperties,filter:n.filter,dynamic:n.dynamic},n.workerOptions)}onAdd(h){this.map=h,this.setData(this._data)}setData(h){return this._data=h,this._updateWorkerData(),this}updateData(h){if(!this._options.dynamic)return this.fire(new s.z(new Error("Can't call updateData on a GeoJSON source with dynamic set to false.")));if(typeof h!="string"&&(h.type==="Feature"&&(h={type:"FeatureCollection",features:[h]}),h.type!=="FeatureCollection"))return this.fire(new s.z(new Error("Data to update should be a feature or a feature collection.")));if(this._coalesce&&typeof h!="string"&&typeof this._data!="string"&&this._data.type==="FeatureCollection"){const n=new Map;for(const a of this._data.features)n.set(a.id,a);for(const a of h.features)n.set(a.id,a);this._data.features=[...n.values()]}else this._data=h;return this._updateWorkerData(!0),this}getClusterExpansionZoom(h,n){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:h,source:this.id,scope:this.scope},n),this}getClusterChildren(h,n){return this.actor.send("geojson.getClusterChildren",{clusterId:h,source:this.id,scope:this.scope},n),this}getClusterLeaves(h,n,a,f){return this.actor.send("geojson.getClusterLeaves",{source:this.id,scope:this.scope,clusterId:h,limit:n,offset:a},f),this}_updateWorkerData(h=!1){if(this._pendingLoad)return void(this._coalesce=!0);this.fire(new s.A("dataloading",{dataType:"source"})),this._loaded=!1;const n=s.h({append:h},this.workerOptions);n.scope=this.scope;const a=this._data;typeof a=="string"?(n.request=this.map._requestManager.transformRequest(s.q.resolveURL(a),s.R.Source),n.request.collectResourceTiming=this._collectResourceTiming):n.data=JSON.stringify(a),this._pendingLoad=this.actor.send(`${this.type}.loadData`,n,(f,g)=>{if(this._loaded=!0,this._pendingLoad=null,f)this.fire(new s.z(f));else{const y={dataType:"source",sourceDataType:this._metadataFired?"content":"metadata"};this._collectResourceTiming&&g&&g.resourceTiming&&g.resourceTiming[this.id]&&(y.resourceTiming=g.resourceTiming[this.id]),h&&(this._partialReload=!0),this.fire(new s.A("data",y)),this._partialReload=!1,this._metadataFired=!0}this._coalesce&&(this._updateWorkerData(h),this._coalesce=!1)})}loaded(){return this._loaded}reload(){const h=s.C(this.id,this.scope);this.map.style.clearSource(h),this._updateWorkerData()}loadTile(h,n){const a=h.actor?"reloadTile":"loadTile";h.actor=this.actor;const f=this.map.style?this.map.style.getLut(this.scope):null,g=f?{image:f.image.clone()}:null,y=this._partialReload,b={type:this.type,uid:h.uid,tileID:h.tileID,tileZoom:h.tileZoom,zoom:h.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,lut:g,scope:this.scope,pixelRatio:s.q.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,brightness:this.map.style&&this.map.style.getBrightness()||0,extraShadowCaster:h.isExtraShadowCaster,scaleFactor:this.map.getScaleFactor(),partial:y,worldview:this.map.getWorldview()};h.request=this.actor.send(a,b,(E,A)=>y&&!A?(h.state="loaded",n(null)):(delete h.request,h.destroy(),h.aborted?n(null):E?n(E):(h.loadVectorData(A,this.map.painter,a==="reloadTile"),n(null))),void 0,a==="loadTile")}abortTile(h){h.request&&(h.request.cancel(),delete h.request),h.aborted=!0}unloadTile(h,n){this.actor.send("removeTile",{uid:h.uid,type:this.type,source:this.id,scope:this.scope}),h.destroy()}onRemove(h){this._pendingLoad&&this._pendingLoad.cancel()}serialize(){return s.h({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}},video:class extends s.aP{constructor(h,n,a,f){super(h,n,a,f),this.roundZoom=!0,this.type="video",this.options=n}load(){this._loaded=!1;const h=this.options;this.urls=[];for(const n of h.urls)this.urls.push(this.map._requestManager.transformRequest(n,s.R.Source).url);s.aQ(this.urls,(n,a)=>{this._loaded=!0,n?this.fire(new s.z(n)):a&&(this.video=a,this.video.loop=!0,this.video.setAttribute("playsinline",""),this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading())})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(h){if(this.video){const n=this.video.seekable;h<n.start(0)||h>n.end(0)?this.fire(new s.z(new s.V(`sources.${this.id}`,null,`Playback for this video can be set only between the ${n.start(0)} and ${n.end(0)}-second mark.`))):this.video.currentTime=h}}getVideo(){return this.video}onAdd(h){this.map||(this.map=h,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const h=this.map.painter.context,n=h.gl;this.texture?this.video.paused||(this.texture.bind(n.LINEAR,n.CLAMP_TO_EDGE),n.texSubImage2D(n.TEXTURE_2D,0,0,0,n.RGBA,n.UNSIGNED_BYTE,this.video)):(this.texture=new s.T(h,this.video,n.RGBA8),this.texture.bind(n.LINEAR,n.CLAMP_TO_EDGE),this.width=this.video.videoWidth,this.height=this.video.videoHeight),this._prepareData(h)}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}},image:s.aP,model:class extends s.E{constructor(h,n,a,f){super(),this.id=h,this.type="model",this.models=[],this._loaded=!1,this._options=n}load(){const h=[];for(const n in this._options.models){const a=this._options.models[n],f=s.aS(this.map._requestManager.transformRequest(a.uri,s.R.Model).url).then(g=>{if(!g)return;const y=s.aT(g),b=new s.aU(n,a.position,a.orientation,y);b.computeBoundsAndApplyParent(),this.models.push(b)}).catch(g=>{this.fire(new s.z(new Error(`Could not load model ${n} from ${a.uri}: ${g.message}`)))});h.push(f)}Promise.allSettled(h).then(()=>{this._loaded=!0,this.fire(new s.A("data",{dataType:"source",sourceDataType:"metadata"}))}).catch(n=>{this._loaded=!0,this.fire(new s.z(new Error(`Could not load models: ${n.message}`)))})}onAdd(h){this.map=h,this.load()}hasTransition(){return!1}loaded(){return this._loaded}getModels(){return this.models}loadTile(h,n){}serialize(){return this._options}},"batched-model":class extends s.E{constructor(h,n,a,f){super(),this.type="batched-model",this.id=h,this.tileSize=512,this._options=n,this.tiles=this._options.tiles,this.maxzoom=n.maxzoom||19,this.minzoom=n.minzoom||0,this.roundZoom=!0,this.usedInConflation=!0,this.dispatcher=a,this.reparseOverscaled=!1,this.scheme="xyz",this._loaded=!1,this.setEventedParent(f)}onAdd(h){this.map=h,this.load()}reload(){this.cancelTileJSONRequest();const h=s.C(this.id,this.scope);this.load(()=>this.map.style.clearSource(h))}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}load(h){this._loaded=!1,this.fire(new s.A("dataloading",{dataType:"source"}));const n=Array.isArray(this.map._language)?this.map._language.join():this.map._language,a=this.map.getWorldview();this._tileJSONRequest=fs(this._options,this.map._requestManager,n,a,(f,g)=>{this._tileJSONRequest=null,this._loaded=!0,f?(n&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${n}`),a&&a.length!==2&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${a}`),this.fire(new s.z(f))):g&&(s.h(this,g),g.bounds&&(this.tileBounds=new Os(g.bounds,this.minzoom,this.maxzoom)),fn(g.tiles,this.map._requestManager._customAccessToken),this.fire(new s.A("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new s.A("data",{dataType:"source",sourceDataType:"content"}))),h&&h(f)})}hasTransition(){return!1}hasTile(h){return!this.tileBounds||this.tileBounds.contains(h.canonical)}loaded(){return this._loaded}loadTile(h,n){const a=this.map._requestManager.normalizeTileURL(h.tileID.canonical.url(this.tiles,this.scheme)),f={request:this.map._requestManager.transformRequest(a,s.R.Tile),data:void 0,uid:h.uid,tileID:h.tileID,tileZoom:h.tileZoom,zoom:h.tileID.overscaledZ,tileSize:this.tileSize*h.tileID.overscaleFactor(),type:this.type,source:this.id,scope:this.scope,showCollisionBoxes:this.map.showCollisionBoxes,isSymbolTile:h.isSymbolTile,brightness:this.map.style&&this.map.style.getBrightness()||0,pixelRatio:s.q.devicePixelRatio,promoteId:this.promoteId};if(h.actor&&h.state!=="expired")if(h.state==="loading")h.reloadCallback=n;else{if(h.buckets){const y=Object.values(h.buckets);for(const b of y)b.dirty=!0;return void(h.state="loaded")}h.request=h.actor.send("reloadTile",f,g.bind(this))}else h.actor=this.dispatcher.getActor(),h.request=h.actor.send("loadTile",f,g.bind(this),void 0,!0);function g(y,b){return h.aborted?n(null):y&&y.status!==404?n(y):(this.map._refreshExpiredTiles&&b&&h.setExpiryData(b),h.loadModelData(b,this.map.painter),h.state="loaded",void n(null))}}serialize(){return s.h({},this._options)}},canvas:class extends s.aP{constructor(h,n,a,f){super(h,n,a,f),n.coordinates?Array.isArray(n.coordinates)&&n.coordinates.length===4&&!n.coordinates.some(g=>!Array.isArray(g)||g.length!==2||g.some(y=>typeof y!="number"))||this.fire(new s.z(new s.V(`sources.${h}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new s.z(new s.V(`sources.${h}`,null,'missing required property "coordinates"'))),n.animate&&typeof n.animate!="boolean"&&this.fire(new s.z(new s.V(`sources.${h}`,null,'optional "animate" property must be a boolean value'))),n.canvas?typeof n.canvas=="string"||n.canvas instanceof HTMLCanvasElement||this.fire(new s.z(new s.V(`sources.${h}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new s.z(new s.V(`sources.${h}`,null,'missing required property "canvas"'))),this.options=n,this.animate=n.animate===void 0||n.animate}load(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new s.z(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}getCanvas(){return this.canvas}onAdd(h){this.map=h,this.load(),this.canvas&&this.animate&&this.play()}onRemove(h){this.pause()}prepare(){let h=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,h=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,h=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const n=this.map.painter.context;this.texture?!h&&!this._playing||this.texture instanceof s.aR||this.texture.update(this.canvas,{premultiply:!0}):this.texture=new s.T(n,this.canvas,n.gl.RGBA8,{premultiply:!0}),this._prepareData(n)}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const h of[this.canvas.width,this.canvas.height])if(isNaN(h)||h<=0)return!0;return!1}},custom:class extends s.E{constructor(h,n,a,f){super(),this.id=h,this.type="custom",this._dataType="raster",this._dispatcher=a,this._implementation=n,this.setEventedParent(f),this.scheme="xyz",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this._loaded=!1,this.roundZoom=!0,this._implementation||this.fire(new s.z(new Error(`Missing implementation for ${this.id} custom source`))),this._implementation.loadTile||this.fire(new s.z(new Error(`Missing loadTile implementation for ${this.id} custom source`))),this._implementation.bounds&&(this.tileBounds=new Os(this._implementation.bounds,this.minzoom,this.maxzoom)),n.update=this._update.bind(this),n.clearTiles=this._clearTiles.bind(this),n.coveringTiles=this._coveringTiles.bind(this),s.h(this,s.aF(n,["dataType","scheme","minzoom","maxzoom","tileSize","attribution","minTileCacheSize","maxTileCacheSize"]))}serialize(){return s.aF(this,["type","scheme","minzoom","maxzoom","tileSize","attribution"])}load(){this._loaded=!0,this.fire(new s.A("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new s.A("data",{dataType:"source",sourceDataType:"content"}))}loaded(){return this._loaded}onAdd(h){this.map=h,this._loaded=!1,this.fire(new s.A("dataloading",{dataType:"source"})),this._implementation.onAdd&&this._implementation.onAdd(h),this.load()}onRemove(h){this._implementation.onRemove&&this._implementation.onRemove(h)}hasTile(h){if(this._implementation.hasTile){const{x:n,y:a,z:f}=h.canonical;return this._implementation.hasTile({x:n,y:a,z:f})}return!this.tileBounds||this.tileBounds.contains(h.canonical)}loadTile(h,n){const{x:a,y:f,z:g}=h.tileID.canonical,y=new AbortController;h.request=Promise.resolve(this._implementation.loadTile({x:a,y:f,z:g},{signal:y.signal})).then((function(b){return delete h.request,h.aborted?(h.state="unloaded",n(null)):b===void 0?(h.state="errored",n(null)):b===null?(this.loadTileData(h,{width:this.tileSize,height:this.tileSize,data:null}),h.state="loaded",n(null)):function(E){return E instanceof ImageData||E instanceof HTMLCanvasElement||E instanceof ImageBitmap||E instanceof HTMLImageElement}(b)?(this.loadTileData(h,b),h.state="loaded",void n(null)):(h.state="errored",n(new Error(`Can't infer data type for ${this.id}, only raster data supported at the moment`)))}).bind(this)).catch(b=>{b.name!=="AbortError"&&(h.state="errored",n(b))}),h.request.cancel=()=>y.abort()}loadTileData(h,n){h.setTexture(n,this.map.painter)}unloadTile(h,n){if(h.texture&&h.texture instanceof s.T?(h.destroy(!0),h.texture&&h.texture instanceof s.T&&this.map.painter.saveTileTexture(h.texture)):h.destroy(),this._implementation.unloadTile){const{x:a,y:f,z:g}=h.tileID.canonical;this._implementation.unloadTile({x:a,y:f,z:g})}n&&n()}abortTile(h,n){h.request&&h.request.cancel&&(h.request.cancel(),delete h.request),n&&n()}hasTransition(){return!1}_coveringTiles(){return this.map.transform.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,roundZoom:this.roundZoom}).map(h=>({x:h.canonical.x,y:h.canonical.y,z:h.canonical.z}))}_clearTiles(){const h=s.C(this.id,this.scope);this.map.style.clearSource(h)}_update(){this.fire(new s.A("data",{dataType:"source",sourceDataType:"content"}))}}},Ah=function(h,n,a,f){const g=new Sp[n.type](h,n,a,f);if(g.id!==h)throw new Error(`Expected Source id to be ${h} instead of ${g.id}`);return s.aV(["load","abort","unload","serialize","prepare"],g),g};function Ih(h,n,a=""){return`${a}:${n.id||""}:${n.layer.id}:${function(f){if("layerId"in f)return`layer:${f.layerId}`;{const{featuresetId:g,importId:y}=f;return`featureset:${g}${y?`:import:${y}`:""}`}}(h.target)}`}function Tp(h,n,a,f=""){if(h.uniqueFeatureID){const g=Ih(h,n,f);if(a.has(g))return!0;a.add(g)}return!1}function Ep(h,n,a,f,g=!1){const y=n.sourceCache.transform,b=n.sourceCache.tilesIn(h,n.has3DLayers,g);b.sort(Cp);const E=[];for(const A of b){const R=A.tile.queryRenderedFeatures(n,A,a,f,y,g);Object.keys(R).length&&E.push({wrappedTileID:A.tile.tileID.wrapped().key,queryResults:R})}return E.length===0?{}:function(A){const R={},D={};for(const F of A){const N=F.queryResults,j=F.wrappedTileID,X=D[j]=D[j]||{};for(const W in N){const K=N[W],ee=X[W]=X[W]||{},ie=R[W]=R[W]||[];for(const fe of K)ee[fe.featureIndex]||(ee[fe.featureIndex]=!0,ie.push(fe))}}return R}(E)}function Fc(h,n,a,f,g,y){const b={},E=f.queryRenderedSymbols(h),A=[];for(const R of Object.keys(E).map(Number))A.push(g[R]);A.sort(Cp);for(const R of A){const D=R.featureIndex.lookupSymbolFeatures(E[R.bucketInstanceId],R.bucketIndex,R.sourceLayerIndex,n,a,y);for(const F in D){const N=b[F]=b[F]||[],j=D[F];j.sort((X,W)=>{const K=R.featureSortOrder;if(K){const ee=K.indexOf(X.featureIndex);return K.indexOf(W.featureIndex)-ee}return W.featureIndex-X.featureIndex});for(const X of j)N.push(X)}}return b}function Ph(h,n){const a=h.getRenderableIds().map(y=>h.getTileByID(y)),f=[],g={};for(let y=0;y<a.length;y++){const b=a[y],E=b.tileID.canonical.key;g[E]||(g[E]=!0,b.querySourceFeatures(f,n))}return f}function Cp(h,n){const a=h.tileID,f=n.tileID;return a.overscaledZ-f.overscaledZ||a.canonical.y-f.canonical.y||a.wrap-f.wrap||a.canonical.x-f.canonical.x}function pa(h,n){const a={};if(!n)return a;for(const f of h){const g=f.layerIds.map(y=>n.getLayer(y)).filter(Boolean);if(g.length!==0){f.layers=g,f.stateDependentLayerIds&&(f.stateDependentLayers=f.stateDependentLayerIds.map(y=>g.filter(b=>b.id===y)[0]));for(const y of g)a[y.fqid]=f}}return a}const Lo=32,Ko=33,il=new Uint16Array(8184);for(let h=0;h<2046;h++){let n=h+2,a=0,f=0,g=0,y=0,b=0,E=0;for(1&n?g=y=b=Lo:a=f=E=Lo;(n>>=1)>1;){const R=a+g>>1,D=f+y>>1;1&n?(g=a,y=f,a=b,f=E):(a=g,f=y,g=b,y=E),b=R,E=D}const A=4*h;il[A+0]=a,il[A+1]=f,il[A+2]=g,il[A+3]=y}const ma=new Uint16Array(2178),sl=new Uint8Array(1089),Mh=new Uint16Array(1089);function za(h){return h===0?-.03125:h===32?.03125:0}const Rh={type:2,extent:s.aj,loadGeometry:()=>[[new s.P(0,0),new s.P(s.aj+1,0),new s.P(s.aj+1,s.aj+1),new s.P(0,s.aj+1),new s.P(0,0)]]};class jc{constructor(n,a,f,g,y,b){this.tileID=n,this.uid=s.a$(),this.uses=0,this.tileSize=a,this.tileZoom=f,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.isRaster=y,g&&g.style&&(this._lastUpdatedBrightness=g.style.getBrightness()),this.expiredRequestCount=0,this.state="loading",g&&g.transform&&(this.projection=g.transform.projection),this.worldview=b}registerFadeDuration(n){const a=n+this.timeAdded;a<s.q.now()||this.fadeEndTime&&a<this.fadeEndTime||(this.fadeEndTime=a)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}get tileTransform(){return this._tileTransform||(this._tileTransform=s.aW(this.tileID.canonical,this.projection)),this._tileTransform}loadVectorData(n,a,f){if(this.unloadVectorData(),this.state="loaded",n){n.featureIndex&&(this.latestFeatureIndex=n.featureIndex,n.rawTileData?(this.latestRawTileData=n.rawTileData,this.latestFeatureIndex.rawTileData=n.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=n.collisionBoxArray,this.buckets=pa(n.buckets,a.style),this.hasSymbolBuckets=!1;for(const g in this.buckets){const y=this.buckets[g];if(y instanceof s.b1){if(this.hasSymbolBuckets=!0,!f)break;y.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const g in this.buckets){const y=this.buckets[g];if(y instanceof s.b1&&y.hasRTLText){this.hasRTLText=!0,s.b2();break}}this.queryPadding=0;for(const g in this.buckets){const y=this.buckets[g],b=a.style.getOwnLayer(g);if(!b)continue;const E=b.queryRadius(y);this.queryPadding=Math.max(this.queryPadding,E)}n.imageAtlas&&(this.imageAtlas=n.imageAtlas),n.glyphAtlasImage&&(this.glyphAtlasImage=n.glyphAtlasImage),n.lineAtlas&&(this.lineAtlas=n.lineAtlas),this._lastUpdatedBrightness=n.brightness}else this.collisionBoxArray=new s.b0}unloadVectorData(){if(this.hasData()){for(const n in this.buckets)this.buckets[n].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.lineAtlasTexture&&this.lineAtlasTexture.destroy(),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),this.latestFeatureIndex=null,this.state="unloaded"}}loadModelData(n,a,f){n&&(n.resourceTiming&&(this.resourceTiming=n.resourceTiming),this.buckets=Object.assign({},this.buckets,pa(n.buckets,a.style)),n.featureIndex&&(this.latestFeatureIndex=n.featureIndex))}getBucket(n){return this.buckets[n.fqid]}upload(n){for(const g in this.buckets){const y=this.buckets[g];y.uploadPending()&&y.upload(n)}const a=n.gl,f=this.imageAtlas;f&&!f.uploaded&&(this.imageAtlasTexture=new s.T(n,f.image,a.RGBA8,{useMipmap:!!f.patternPositions.size}),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new s.T(n,this.glyphAtlasImage,a.R8),this.glyphAtlasImage=null),this.lineAtlas&&!this.lineAtlas.uploaded&&(this.lineAtlasTexture=new s.T(n,this.lineAtlas.image,a.R8),this.lineAtlas.uploaded=!0)}prepare(n,a,f){if(this.imageAtlas&&this.imageAtlasTexture&&this.imageAtlas.patchUpdatedImages(n,this.imageAtlasTexture,f),!a||!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData)return;const g=a.style.getBrightness();(this._lastUpdatedBrightness||g)&&(this._lastUpdatedBrightness&&g&&Math.abs(this._lastUpdatedBrightness-g)<.001||(this.updateBuckets(a,this._lastUpdatedBrightness!==g),this._lastUpdatedBrightness=g))}queryRenderedFeatures(n,a,f,g,y,b){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData&&!this.latestFeatureIndex.is3DTile)return{};const E=function(A,R){const D=s.bn([],[.5*A.width,.5*-A.height,1]);return s.bo(D,D,[1,-1,0]),s.az(D,D,A.calculateProjMatrix(R.toUnwrapped())),Float32Array.from(D)}(y,this.tileID);return this.latestFeatureIndex.query(n,{tilespaceGeometry:a,pixelPosMatrix:E,transform:g,availableImages:f,tileTransform:this.tileTransform,worldview:this.worldview})}querySourceFeatures(n,a){const f=this.latestFeatureIndex;if(!f||!f.rawTileData)return;const g=f.loadVTLayers(),y=a?a.sourceLayer:"",b=g._geojsonTileLayer||g[y];if(!b)return;const E=s.b3(a&&a.filter),{z:A,x:R,y:D}=this.tileID.canonical,F={z:A,x:R,y:D};for(let N=0;N<b.length;N++){const j=b.feature(N);if(E.needGeometry){const K=s.b4(j,!0);if(!E.filter(new s.aa(this.tileID.overscaledZ,{worldview:this.worldview}),K,this.tileID.canonical))continue}else if(!E.filter(new s.aa(this.tileID.overscaledZ,{worldview:this.worldview}),j))continue;const X=f.getId(j,y),W=new s.b5(j,A,R,D,X);W.tile=F,n.push(W)}}loaded(){return this.state==="loaded"||this.state==="errored"}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return!!this.imageAtlas&&!!this.imageAtlas.patternPositions.size}setExpiryData(n){const a=this.expirationTime;if(n.cacheControl){const f=s.b6(n.cacheControl);f["max-age"]&&(this.expirationTime=Date.now()+1e3*f["max-age"])}else n.expires&&(this.expirationTime=new Date(n.expires).getTime());if(this.expirationTime){const f=Date.now();let g=!1;if(this.expirationTime>f)g=!1;else if(a)if(this.expirationTime<a)g=!0;else{const y=this.expirationTime-a;y?this.expirationTime=f+Math.max(y,3e4):g=!0}else g=!0;g?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}refreshFeatureState(n){this.latestFeatureIndex&&(this.latestFeatureIndex.rawTileData||this.latestFeatureIndex.is3DTile)&&n&&this.updateBuckets(n)}updateBuckets(n,a){if(!this.latestFeatureIndex||!n.style)return;const f=this.latestFeatureIndex.loadVTLayers(),g=n.style.listImages(),y=n.style.getBrightness();for(const b in this.buckets){if(!n.style.hasLayer(b))continue;const E=this.buckets[b],A=E.layers[0],R=A.sourceLayer||"_geojsonTileLayer",D=f[R],F=n.style.getLayerSourceCache(A);let N={};F&&(N=F._state.getState(R,void 0));const j=this.imageAtlas?Object.fromEntries(this.imageAtlas.patternPositions):{},X=Object.keys(N).length>0&&!a;X&&!E.stateDependentLayers.length&&!a||E.update(N,D,g,j,X?E.stateDependentLayers:E.layers,a,y),(E instanceof s.b7||E instanceof s.b8)&&n._terrain&&n._terrain.enabled&&F&&E.uploadPending()&&n._terrain._clearRenderCacheForTile(F.id,this.tileID);const W=n&&n.style&&n.style.getOwnLayer(b);W&&(this.queryPadding=Math.max(this.queryPadding,W.queryRadius(E)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<s.q.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(n){this.symbolFadeHoldUntil=s.q.now()+n}setTexture(n,a){const f=a.context,g=f.gl;this.texture=this.texture||a.getTileTexture(n.width),this.texture&&this.texture instanceof s.T?this.texture.update(n):(this.texture=new s.T(f,n,g.RGBA8,{useMipmap:!0}),this.texture.bind(g.LINEAR,g.CLAMP_TO_EDGE))}setDependencies(n,a){const f={};for(const g of a)f[g]=!0;this.dependencies[n]=f}hasDependency(n,a){for(const f of n){const g=this.dependencies[f];if(g){for(const y of a)if(g[y])return!0}}return!1}clearQueryDebugViz(){}_makeDebugTileBoundsBuffers(n,a){if(!a||a.name==="mercator"||this._tileDebugBuffer)return;const f=s.b9(Rh,this.tileID.canonical,this.tileTransform)[0],g=new s.ba,y=new s.bb;for(let b=0;b<f.length;b++){const{x:E,y:A}=f[b];g.emplaceBack(E,A),y.emplaceBack(b)}y.emplaceBack(0),this._tileDebugIndexBuffer=n.createIndexBuffer(y),this._tileDebugBuffer=n.createVertexBuffer(g,s.bc.members),this._tileDebugSegments=s.bd.simpleSegment(0,0,g.length,y.length)}_makeTileBoundsBuffers(n,a){if(this._tileBoundsBuffer||!a||a.name==="mercator")return;const f=s.b9(Rh,this.tileID.canonical,this.tileTransform)[0];let g,y;if(this.isRaster){const b=function(E,A){const R=s.aW(E,A),D=Math.pow(2,E.z);for(let K=0;K<Ko;K++)for(let ee=0;ee<Ko;ee++){const ie=s.aX((E.x+(ee+za(ee))/Lo)/D),fe=s.aY((E.y+(K+za(K))/Lo)/D),_e=A.project(ie,fe),we=K*Ko+ee;ma[2*we+0]=Math.round((_e.x*R.scale-R.x)*s.aj),ma[2*we+1]=Math.round((_e.y*R.scale-R.y)*s.aj)}sl.fill(0),Mh.fill(0);for(let K=2045;K>=0;K--){const ee=4*K,ie=il[ee+0],fe=il[ee+1],_e=il[ee+2],we=il[ee+3],be=ie+_e>>1,ve=fe+we>>1,ye=be+ve-fe,Se=ve+ie-be,Ee=fe*Ko+ie,Fe=we*Ko+_e,je=ve*Ko+be,rt=Math.hypot((ma[2*Ee+0]+ma[2*Fe+0])/2-ma[2*je+0],(ma[2*Ee+1]+ma[2*Fe+1])/2-ma[2*je+1])>=16;sl[je]=sl[je]||(rt?1:0),K<1022&&(sl[je]=sl[je]||sl[(fe+Se>>1)*Ko+(ie+ye>>1)]||sl[(we+Se>>1)*Ko+(_e+ye>>1)])}const F=new s.aZ,N=new s.a_;let j=0;function X(K,ee){const ie=ee*Ko+K;return Mh[ie]===0&&(F.emplaceBack(ma[2*ie+0],ma[2*ie+1],K*s.aj/Lo,ee*s.aj/Lo),Mh[ie]=++j),Mh[ie]-1}function W(K,ee,ie,fe,_e,we){const be=K+ie>>1,ve=ee+fe>>1;if(Math.abs(K-_e)+Math.abs(ee-we)>1&&sl[ve*Ko+be])W(_e,we,K,ee,be,ve),W(ie,fe,_e,we,be,ve);else{const ye=X(K,ee),Se=X(ie,fe),Ee=X(_e,we);N.emplaceBack(ye,Se,Ee)}}return W(0,0,Lo,Lo,Lo,0),W(Lo,Lo,0,0,0,Lo),{vertices:F,indices:N}}(this.tileID.canonical,a);g=b.vertices,y=b.indices}else{g=new s.aZ,y=new s.a_;for(const{x:E,y:A}of f)g.emplaceBack(E,A,0,0);const b=s.be(g.int16.subarray(0,4*g.length),void 0,4);for(let E=0;E<b.length;E+=3)y.emplaceBack(b[E],b[E+1],b[E+2])}this._tileBoundsBuffer=n.createVertexBuffer(g,s.bf.members),this._tileBoundsIndexBuffer=n.createIndexBuffer(y),this._tileBoundsSegments=s.bd.simpleSegment(0,0,g.length,y.length)}_makeGlobeTileDebugBuffers(n,a){const f=a.projection;if(!f||f.name!=="globe"||a.freezeTileCoverage)return;const g=this.tileID.canonical,y=s.bg(g,a),b=s.bh(y),E=s.ah(a.zoom);let A;E>0&&(A=s.bi(new Float64Array(16),a.globeMatrix)),this._makeGlobeTileDebugBorderBuffer(n,g,a,b,A,E),this._makeGlobeTileDebugTextBuffer(n,g,a,b,A,E)}_globePoint(n,a,f,g,y,b,E){let A=s.bj(n,a,f);if(b){const R=1<<f.z,D=s.aD(g.center.lng),F=s.aH(g.center.lat),N=(f.x+.5)/R-D;let j=0;N>.5?j=-1:N<-.5&&(j=1);let X=(n/s.aj+f.x)/R+j,W=(a/s.aj+f.y)/R;X=(X-D)*g._pixelsPerMercatorPixel+D,W=(W-F)*g._pixelsPerMercatorPixel+F;const K=[X*g.worldSize,W*g.worldSize,0];s.ad(K,K,b),A=s.bk(A,K,E)}return s.ad(A,A,y)}_makeGlobeTileDebugBorderBuffer(n,a,f,g,y,b){const E=new s.ba,A=new s.bb,R=new s.bl,D=(N,j,X,W,K)=>{const ee=(X-N)/(K-1),ie=(W-j)/(K-1),fe=E.length;for(let _e=0;_e<K;_e++){const we=N+_e*ee,be=j+_e*ie;E.emplaceBack(we,be);const ve=this._globePoint(we,be,a,f,g,y,b);R.emplaceBack(ve[0],ve[1],ve[2]),A.emplaceBack(fe+_e)}},F=s.aj;D(0,0,F,0,16),D(F,0,F,F,16),D(F,F,0,F,16),D(0,F,0,0,16),this._tileDebugIndexBuffer=n.createIndexBuffer(A),this._tileDebugBuffer=n.createVertexBuffer(E,s.bc.members),this._globeTileDebugBorderBuffer=n.createVertexBuffer(R,s.bm.members),this._tileDebugSegments=s.bd.simpleSegment(0,0,E.length,A.length)}_makeGlobeTileDebugTextBuffer(n,a,f,g,y,b){const E=s.aj/4,A=new s.ba,R=new s.a_,D=new s.bl,F=25;R.reserve(32),A.reserve(F),D.reserve(F);const N=(j,X)=>F*j+X;for(let j=0;j<F;j++){const X=j*E;for(let W=0;W<F;W++){const K=W*E;A.emplaceBack(K,X);const ee=this._globePoint(K,X,a,f,g,y,b);D.emplaceBack(ee[0],ee[1],ee[2])}}for(let j=0;j<4;j++)for(let X=0;X<4;X++){const W=N(j,X),K=N(j,X+1),ee=N(j+1,X),ie=N(j+1,X+1);R.emplaceBack(W,K,ee),R.emplaceBack(ee,K,ie)}this._tileDebugTextIndexBuffer=n.createIndexBuffer(R),this._tileDebugTextBuffer=n.createVertexBuffer(A,s.bc.members),this._globeTileDebugTextBuffer=n.createVertexBuffer(D,s.bm.members),this._tileDebugTextSegments=s.bd.simpleSegment(0,0,F,32)}destroy(n=!1){for(const a in this.buckets)this.buckets[a].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&(this.imageAtlasTexture.destroy(),delete this.imageAtlasTexture),this.glyphAtlasTexture&&(this.glyphAtlasTexture.destroy(),delete this.glyphAtlasTexture),this.lineAtlasTexture&&(this.lineAtlasTexture.destroy(),delete this.lineAtlasTexture),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),!n&&this.texture&&this.texture instanceof s.T&&(this.texture.destroy(),delete this.texture),this.hillshadeFBO&&(this.hillshadeFBO.destroy(),delete this.hillshadeFBO),this.dem&&delete this.dem,this.neighboringTiles&&delete this.neighboringTiles,this.demTexture&&(this.demTexture.destroy(),delete this.demTexture),this.rasterParticleState&&(this.rasterParticleState.destroy(),delete this.rasterParticleState),this.latestFeatureIndex=null,this.state="unloaded"}}s.bp.setPbf(s.bq);class ku extends jc{constructor(n,a,f,g,y){super(n,a,f,g,y),this._workQueue=[],this._fetchQueue=[],this._isHeaderLoaded=!1}getLayers(){return this._mrt?Object.values(this._mrt.layers):[]}getLayer(n){return this._mrt&&this._mrt.getLayer(n)}setTexture(n,a){const f=a.context,g=f.gl;this.texture=this.texture||a.getTileTexture(n.width),this.texture&&this.texture instanceof s.T?this.texture.update(n,{premultiply:!1}):this.texture=new s.T(f,n,g.RGBA8,{premultiply:!1})}flushQueues(){for(;this._workQueue.length;)this._workQueue.pop()();for(;this._fetchQueue.length;)this._fetchQueue.pop()()}fetchHeader(n=16384,a){const f=this._mrt=new s.bp(30),g=Object.assign({},this.requestParams,{headers:{Range:"bytes=0-"+(n-1)}});return this.entireBuffer=null,this.request=s.br(g,(y,b,E,A)=>{if(y)a(y);else try{const R=f.getHeaderLength(b);if(R>n)return void(this.request=this.fetchHeader(R,a));f.parseHeader(b),this._isHeaderLoaded=!0;let D=0;for(const F of Object.values(f.layers))D=Math.max(D,F.dataIndex[F.dataIndex.length-1].lastByte);b.byteLength>=D&&(this.entireBuffer=b),a(null,this.entireBuffer||b,E,A)}catch(R){a(R)}}),this.request}fetchBand(n,a,f){const g=this._mrt;if(!this._isHeaderLoaded||!g)return void f(new Error("Tile header is not ready"));const y=this.actor;if(!y)return void f(new Error("Can't fetch tile band without an actor"));let b;const E=(F,N)=>{b.complete(F,N),F?f(F):(this.updateTextureDescriptor(n,a),f(null,this.textureDescriptor&&this.textureDescriptor.img))},A=(F,N)=>{if(F)return f(F);const j=y.send("decodeRasterArray",{type:"raster-array",source:this.source,scope:this.scope,tileID:this.tileID,uid:this.uid,buffer:N,task:b},E,void 0,!0);this._workQueue.push(()=>{j&&j.cancel(),b.cancel()})},R=g.getLayer(n);if(!R)return void f(new Error(`Unknown sourceLayer "${n}"`));if(R.hasDataForBand(a))return this.updateTextureDescriptor(n,a),void f(null,this.textureDescriptor?this.textureDescriptor.img:null);const D=R.getDataRange([a]);if(b=g.createDecodingTask(D),!b||b.tasks.length)if(this.flushQueues(),this.entireBuffer)A(null,this.entireBuffer.slice(D.firstByte,D.lastByte+1));else{const F=Object.assign({},this.requestParams,{headers:{Range:`bytes=${D.firstByte}-${D.lastByte}`}}),N=s.br(F,A);this._fetchQueue.push(()=>{N.cancel(),b.cancel()})}else f(null)}updateNeeded(n,a){return(!this.textureDescriptor||this.textureDescriptor.band!==a||this.textureDescriptor.layer!==n)&&this.state!=="errored"}updateTextureDescriptor(n,a){if(!this._mrt)return;const f=this._mrt.getLayer(n);if(!f||!f.hasBand(a)||!f.hasDataForBand(a))return;const{bytes:g,tileSize:y,buffer:b,offset:E,scale:A}=f.getBandView(a),R=y+2*b,D=new s.r({width:R,height:R},g),F=this.texture;F&&F instanceof s.T&&F.update(D,{premultiply:!1}),this.textureDescriptor={layer:n,band:a,img:D,buffer:b,offset:E,tileSize:y,format:f.pixelFormat,mix:[A,256*A,65536*A,16777216*A]}}}class f_{constructor(n,a){this.max=n,this.onRemove=a,this.reset()}reset(){for(const n in this.data)for(const a of this.data[n])a.timeout&&clearTimeout(a.timeout),this.onRemove(a.value);return this.data={},this.order=[],this}add(n,a,f){const g=n.wrapped().key;this.data[g]===void 0&&(this.data[g]=[]);const y={value:a,timeout:void 0};if(f!==void 0&&(y.timeout=setTimeout(()=>{this.remove(n,y)},f)),this.data[g].push(y),this.order.push(g),this.order.length>this.max){const b=this._getAndRemoveByKey(this.order[0]);b&&this.onRemove(b)}return this}has(n){return n.wrapped().key in this.data}getAndRemove(n){return this.has(n)?this._getAndRemoveByKey(n.wrapped().key):null}_getAndRemoveByKey(n){const a=this.data[n].shift();return a.timeout&&clearTimeout(a.timeout),this.data[n].length===0&&delete this.data[n],this.order.splice(this.order.indexOf(n),1),a.value}getByKey(n){const a=this.data[n];return a?a[0].value:null}get(n){return this.has(n)?this.data[n.wrapped().key][0].value:null}remove(n,a){if(!this.has(n))return this;const f=n.wrapped().key,g=a===void 0?0:this.data[f].indexOf(a),y=this.data[f][g];return this.data[f].splice(g,1),y.timeout&&clearTimeout(y.timeout),this.data[f].length===0&&delete this.data[f],this.onRemove(y.value),this.order.splice(this.order.indexOf(f),1),this}setMaxSize(n){for(this.max=n;this.order.length>this.max;){const a=this._getAndRemoveByKey(this.order[0]);a&&this.onRemove(a)}return this}filter(n){const a=[];for(const f in this.data)for(const g of this.data[f])n(g.value)||a.push(g);for(const f of a)this.remove(f.value.tileID,f)}}class p_{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(n,a,f){const g=String(a);if(this.stateChanges[n]=this.stateChanges[n]||{},this.stateChanges[n][g]=this.stateChanges[n][g]||{},s.h(this.stateChanges[n][g],f),this.deletedStates[n]===null){this.deletedStates[n]={};for(const y in this.state[n])y!==g&&(this.deletedStates[n][y]=null)}else if(this.deletedStates[n]&&this.deletedStates[n][g]===null){this.deletedStates[n][g]={};for(const y in this.state[n][g])f[y]||(this.deletedStates[n][g][y]=null)}else for(const y in f)this.deletedStates[n]&&this.deletedStates[n][g]&&this.deletedStates[n][g][y]===null&&delete this.deletedStates[n][g][y]}removeFeatureState(n,a,f){if(this.deletedStates[n]===null)return;const g=String(a);if(this.deletedStates[n]=this.deletedStates[n]||{},f&&a!==void 0)this.deletedStates[n][g]!==null&&(this.deletedStates[n][g]=this.deletedStates[n][g]||{},this.deletedStates[n][g][f]=null);else if(a!==void 0)if(this.stateChanges[n]&&this.stateChanges[n][g])for(f in this.deletedStates[n][g]={},this.stateChanges[n][g])this.deletedStates[n][g][f]=null;else this.deletedStates[n][g]=null;else this.deletedStates[n]=null}getState(n,a){const f=this.state[n]||{},g=this.stateChanges[n]||{},y=this.deletedStates[n];if(y===null)return{};if(a!==void 0){const E=String(a),A=s.h({},f[E],g[E]);if(y){const R=y[a];if(R===null)return{};for(const D in R)delete A[D]}return A}const b=s.h({},f,g);if(y)for(const E in y)delete b[E];return b}initializeTileState(n,a){n.refreshFeatureState(a)}coalesceChanges(n,a){const f={};for(const g in this.stateChanges){this.state[g]=this.state[g]||{};const y={};for(const b in this.stateChanges[g])this.state[g][b]||(this.state[g][b]={}),s.h(this.state[g][b],this.stateChanges[g][b]),y[b]=this.state[g][b];f[g]=y}for(const g in this.deletedStates){this.state[g]=this.state[g]||{};const y={};if(this.deletedStates[g]===null)for(const b in this.state[g])y[b]={},this.state[g][b]={};else for(const b in this.deletedStates[g]){if(this.deletedStates[g][b]===null)this.state[g][b]={};else if(this.state[g][b])for(const E of Object.keys(this.deletedStates[g][b]))delete this.state[g][b][E];y[b]=this.state[g][b]}f[g]=f[g]||{},s.h(f[g],y)}if(this.stateChanges={},this.deletedStates={},Object.keys(f).length!==0)for(const g in n)n[g].refreshFeatureState(a)}}class oo extends s.E{constructor(n,a,f){super(),this.id=n,this._onlySymbols=f,a.on("data",g=>{g.dataType==="source"&&g.sourceDataType==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&g.dataType==="source"&&g.sourceDataType==="content"&&(this.reload(),this.transform&&this.update(this.transform))}),a.on("error",()=>{this._sourceErrored=!0}),this._source=a,this._tiles={},this._cache=new f_(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._minTileCacheSize=a.minTileCacheSize,this._maxTileCacheSize=a.maxTileCacheSize,this._loadedParentTiles={},this.castsShadows=!1,this.tileCoverLift=0,this._coveredTiles={},this._shadowCasterTiles={},this._state=new p_,this._isRaster=this._source.type==="raster"||this._source.type==="raster-dem"||this._source.type==="raster-array"||this._source.type==="custom"&&this._source._dataType==="raster"}onAdd(n){this.map=n,this._minTileCacheSize=this._minTileCacheSize===void 0&&n?n._minTileCacheSize:this._minTileCacheSize,this._maxTileCacheSize=this._maxTileCacheSize===void 0&&n?n._maxTileCacheSize:this._maxTileCacheSize}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(const n in this._tiles)if(!this._tiles[n].loaded())return!1;return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const n=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,n&&this.reload(),this.transform&&this.update(this.transform)}_loadTile(n,a){return n.isSymbolTile=this._onlySymbols,n.isExtraShadowCaster=this._shadowCasterTiles[n.tileID.key],this._source.loadTile(n,a)}_unloadTile(n){if(this._source.unloadTile)return this._source.unloadTile(n)}_abortTile(n){if(this._source.abortTile)return this._source.abortTile(n)}serialize(){return this._source.serialize()}prepare(n){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const a in this._tiles){const f=this._tiles[a];f.upload(n),f.prepare(this.map.style.imageManager,this.map?this.map.painter:null,this._source.scope)}}getIds(){return Object.values(this._tiles).map(n=>n.tileID).sort(Bc).map(n=>n.key)}getRenderableIds(n,a){const f=[];for(const g in this._tiles)this._isIdRenderable(+g,n,a)&&f.push(this._tiles[g]);return n?f.sort((g,y)=>{const b=g.tileID,E=y.tileID,A=new s.P(b.canonical.x,b.canonical.y)._rotate(this.transform.angle),R=new s.P(E.canonical.x,E.canonical.y)._rotate(this.transform.angle);return b.overscaledZ-E.overscaledZ||R.y-A.y||R.x-A.x}).map(g=>g.tileID.key):f.map(g=>g.tileID).sort(Bc).map(g=>g.key)}hasRenderableParent(n){const a=this.findLoadedParent(n,0);return!!a&&this._isIdRenderable(a.tileID.key)}_isIdRenderable(n,a,f){return this._tiles[n]&&this._tiles[n].hasData()&&!this._coveredTiles[n]&&(a||!this._tiles[n].holdingForFade())&&(f||!this._shadowCasterTiles[n])}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const n in this._tiles)this._tiles[n].state!=="errored"&&this._reloadTile(+n,"reloading")}}_reloadTile(n,a){const f=this._tiles[n];f&&(f.state!=="loading"&&(f.state=a),this._loadTile(f,this._tileLoaded.bind(this,f,n,a)))}_tileLoaded(n,a,f,g){if(g)if(n.state="errored",g.status!==404)this._source.fire(new s.z(g,{tile:n}));else{if(this._source.fire(new s.A("data",{dataType:"source",sourceDataType:"error",sourceId:this._source.id,tile:n})),!(n.tileID.key in this._loadedParentTiles))return;if(this._source.type==="raster-dem"&&this.usedForTerrain&&this.map.painter.terrain){const y=this.map.painter.terrain;this.update(this.transform,y.getScaledDemTileSize(),!0),y.resetTileLookupCache(this.id)}else this.update(this.transform)}else n.timeAdded=s.q.now(),f==="expired"&&(n.refreshedUponExpiration=!0),this._setTileReloadTimer(a,n),this._source.type==="raster-dem"&&n.dem&&this._backfillDEM(n),this._state.initializeTileState(n,this.map?this.map.painter:null),this._source.fire(new s.A("data",{dataType:"source",tile:n,coord:n.tileID,sourceCacheId:this.id}))}_backfillDEM(n){const a=this.getRenderableIds();for(let g=0;g<a.length;g++){const y=a[g];if(n.neighboringTiles&&n.neighboringTiles[y]){const b=this.getTileByID(y);f(n,b),f(b,n)}}function f(g,y){if(!g.dem||g.dem.borderReady)return;g.needsHillshadePrepare=!0,g.needsDEMTextureUpload=!0;let b=y.tileID.canonical.x-g.tileID.canonical.x;const E=y.tileID.canonical.y-g.tileID.canonical.y,A=Math.pow(2,g.tileID.canonical.z),R=y.tileID.key;b===0&&E===0||Math.abs(E)>1||(Math.abs(b)>1&&(Math.abs(b+A)===1?b+=A:Math.abs(b-A)===1&&(b-=A)),y.dem&&g.dem&&(g.dem.backfillBorder(y.dem,b,E),g.neighboringTiles&&g.neighboringTiles[R]&&(g.neighboringTiles[R].backfilled=!0)))}}getTile(n){return this.getTileByID(n.key)}getTileByID(n){return this._tiles[n]}_retainLoadedChildren(n,a,f,g){for(const y in this._tiles){let b=this._tiles[y];if(g[y]||!b.hasData()||b.tileID.overscaledZ<=a||b.tileID.overscaledZ>f)continue;let E=b.tileID;for(;b&&b.tileID.overscaledZ>a+1;){const R=b.tileID.scaledTo(b.tileID.overscaledZ-1);b=this._tiles[R.key],b&&b.hasData()&&(E=R)}let A=E;for(;A.overscaledZ>a;)if(A=A.scaledTo(A.overscaledZ-1),n[A.key]){g[E.key]=E;break}}}findLoadedParent(n,a){if(n.key in this._loadedParentTiles){const f=this._loadedParentTiles[n.key];return f&&f.tileID.overscaledZ>=a?f:null}for(let f=n.overscaledZ-1;f>=a;f--){const g=n.scaledTo(f),y=this._getLoadedTile(g);if(y)return y}}_getLoadedTile(n){const a=this._tiles[n.key];return a&&a.hasData()?a:this._cache.getByKey(this._source.reparseOverscaled?n.wrapped().key:n.canonical.key)}updateCacheSize(n,a){a=a||this._source.tileSize;const f=Math.ceil(n.width/a)+1,g=Math.ceil(n.height/a)+1,y=Math.floor(f*g*5),b=typeof this._minTileCacheSize=="number"?Math.max(this._minTileCacheSize,y):y,E=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,b):b;this._cache.setMaxSize(E)}handleWrapJump(n){const a=Math.round((n-(this._prevLng===void 0?n:this._prevLng))/360);if(this._prevLng=n,a){const f={};for(const g in this._tiles){const y=this._tiles[g];y.tileID=y.tileID.unwrapTo(y.tileID.wrap+a),f[y.tileID.key]=y}this._tiles=f;for(const g in this._timers)clearTimeout(this._timers[g]),delete this._timers[g];for(const g in this._tiles)this._setTileReloadTimer(+g,this._tiles[g])}}update(n,a,f,g,y){if(this.transform=n,!this._sourceLoaded||this._paused||this.transform.freezeTileCoverage||this.usedForTerrain&&!f)return;this.updateCacheSize(n,a),this.transform.projection.name!=="globe"&&this.handleWrapJump(this.transform.center.lng),this._shadowCasterTiles={},this._coveredTiles={};const b=this._source.type==="batched-model";let E,A=this._source.maxzoom;const R=this.map&&this.map.painter?this.map.painter._terrain:null;if(R&&R.sourceCache===this&&R.attenuationRange()){const N=R.attenuationRange()[0],j=Math.floor(N)-Math.log2(R.getDemUpscale());A>j&&(A=j)}if(this.used||this.usedForTerrain){if(this._source.tileID)E=n.getVisibleUnwrappedCoordinates(this._source.tileID).map(N=>new s.aM(N.canonical.z,N.wrap,N.canonical.z,N.canonical.x,N.canonical.y));else if(this.tileCoverLift!==0){const N=n.clone();N.tileCoverLift=this.tileCoverLift,E=N.coveringTiles({tileSize:a||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:A,roundZoom:this._source.roundZoom&&!f,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain,calculateQuadrantVisibility:b}),this._source.minzoom<=1&&n.projection.name==="globe"&&(E.push(new s.aM(1,0,1,0,0)),E.push(new s.aM(1,0,1,1,0)),E.push(new s.aM(1,0,1,0,1)),E.push(new s.aM(1,0,1,1,1)))}else if(E=n.coveringTiles({tileSize:a||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:A,roundZoom:this._source.roundZoom&&!f,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain,calculateQuadrantVisibility:b}),this._source.hasTile){const N=this._source.hasTile.bind(this._source);E=E.filter(j=>N(j))}}else E=[];if(E.length>0&&this.transform.projection.name!=="globe"&&!this.usedForTerrain&&!kh(this._source.type)){const N=n.coveringZoomLevel({tileSize:a||this._source.tileSize,roundZoom:this._source.roundZoom&&!f}),j=Math.min(N,this._source.maxzoom);if(b){const X=n.extendTileCover(E,j);for(const W of X)E.push(W)}else if(y){const X=n.extendTileCover(E,j,this.transform._camera.forward());for(const W of X)E.push(W)}else if(this.castsShadows&&g){const X=n.extendTileCover(E,j,g);for(const W of X)this._shadowCasterTiles[W.key]=!0,E.push(W)}}const D=this._updateRetainedTiles(E);if(kh(this._source.type)&&E.length!==0){const N={},j={},X=Object.keys(D);for(const K of X){const ee=D[K],ie=this._tiles[K];if(!ie||ie.fadeEndTime&&ie.fadeEndTime<=s.q.now())continue;const fe=this.findLoadedParent(ee,Math.max(ee.overscaledZ-oo.maxOverzooming,this._source.minzoom));fe&&(this._addTile(fe.tileID),N[fe.tileID.key]=fe.tileID),j[K]=ee}const W=E[E.length-1].overscaledZ;for(const K in this._tiles){const ee=this._tiles[K];if(D[K]||!ee.hasData())continue;let ie=ee.tileID;for(;ie.overscaledZ>W;){ie=ie.scaledTo(ie.overscaledZ-1);const fe=this._tiles[ie.key];if(fe&&fe.hasData()&&j[ie.key]){D[K]=ee.tileID;break}}}for(const K in N)D[K]||(this._coveredTiles[K]=!0,D[K]=N[K])}for(const N in D)this._tiles[N].clearFadeHold();const F=s.bs(this._tiles,D);for(const N of F){const j=this._tiles[N];j.hasSymbolBuckets&&!j.holdingForFade()?j.setHoldDuration(this.map._fadeDuration):j.hasSymbolBuckets&&!j.symbolFadeFinished()||this._removeTile(+N)}this._updateLoadedParentTileCache(),this._onlySymbols&&this._source.afterUpdate&&this._source.afterUpdate()}releaseSymbolFadeTiles(){for(const n in this._tiles)this._tiles[n].holdingForFade()&&this._removeTile(+n)}_updateRetainedTiles(n){const a={};if(n.length===0)return a;const f={},g=n.reduce((R,D)=>Math.min(R,D.overscaledZ),1/0),y=n[0].overscaledZ,b=Math.max(y-oo.maxOverzooming,this._source.minzoom),E=Math.max(y+oo.maxUnderzooming,this._source.minzoom),A={};for(const R of n){const D=this._addTile(R);a[R.key]=R,D.hasData()||g<this._source.maxzoom&&(A[R.key]=R)}this._retainLoadedChildren(A,g,E,a);for(const R of n){let D=this._tiles[R.key];if(D.hasData())continue;if(R.canonical.z>=this._source.maxzoom){const N=R.children(this._source.maxzoom)[0],j=this.getTile(N);if(j&&j.hasData()){a[N.key]=N;continue}}else{const N=R.children(this._source.maxzoom);if(a[N[0].key]&&a[N[1].key]&&a[N[2].key]&&a[N[3].key])continue}let F=D.wasRequested();for(let N=R.overscaledZ-1;N>=b;--N){const j=R.scaledTo(N);if(f[j.key]||(f[j.key]=!0,D=this.getTile(j),!D&&F&&(D=this._addTile(j)),D&&(a[j.key]=j,F=D.wasRequested(),D.hasData())))break}}return a}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const n in this._tiles){const a=[];let f,g=this._tiles[n].tileID;for(;g.overscaledZ>0;){if(g.key in this._loadedParentTiles){f=this._loadedParentTiles[g.key];break}a.push(g.key);const y=g.scaledTo(g.overscaledZ-1);if(f=this._getLoadedTile(y),f)break;g=y}for(const y of a)this._loadedParentTiles[y]=f}}_addTile(n){let a=this._tiles[n.key];if(a)return a.isExtraShadowCaster!==!0||this._shadowCasterTiles[n.key]||this._reloadTile(n.key,"reloading"),a;a=this._cache.getAndRemove(n),a&&(this._setTileReloadTimer(n.key,a),a.tileID=n,this._state.initializeTileState(a,this.map?this.map.painter:null),this._cacheTimers[n.key]&&(clearTimeout(this._cacheTimers[n.key]),delete this._cacheTimers[n.key],this._setTileReloadTimer(n.key,a)));const f=!!a;if(!f){const g=this.map?this.map.painter:null,y=this._source.tileSize*n.overscaleFactor();a=this._source.type==="raster-array"?new ku(n,y,this.transform.tileZoom,g,this._isRaster):new jc(n,y,this.transform.tileZoom,g,this._isRaster,this._source.worldview),this._loadTile(a,this._tileLoaded.bind(this,a,n.key,a.state))}return a.uses++,this._tiles[n.key]=a,f||this._source.fire(new s.A("dataloading",{tile:a,coord:a.tileID,dataType:"source"})),a}_setTileReloadTimer(n,a){n in this._timers&&(clearTimeout(this._timers[n]),delete this._timers[n]);const f=a.getExpiryTimeout();f&&(this._timers[n]=setTimeout(()=>{this._reloadTile(n,"expired"),delete this._timers[n]},f))}_removeTile(n){const a=this._tiles[n];a&&(a.uses--,delete this._tiles[n],this._timers[n]&&(clearTimeout(this._timers[n]),delete this._timers[n]),a.uses>0||(a.hasData()&&a.state!=="reloading"||a.state==="empty"?this._cache.add(a.tileID,a,a.getExpiryTimeout()):(a.aborted=!0,this._abortTile(a),this._unloadTile(a))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const n in this._tiles)this._removeTile(+n);this._source._clear&&this._source._clear(),this._cache.reset(),this.map&&this.usedForTerrain&&this.map.painter.terrain&&this.map.painter.terrain.resetTileLookupCache(this.id)}tilesIn(n,a,f){const g=[],y=this.transform;if(!y)return g;const b=y.projection.name==="globe",E=s.aD(y.center.lng);for(const A in this._tiles){const R=this._tiles[A];if(f&&R.clearQueryDebugViz(),R.holdingForFade())continue;let D;if(b){const F=R.tileID.canonical;if(F.z===0){const N=[Math.abs(s.ay(E,...Du(F,-1))-E),Math.abs(s.ay(E,...Du(F,1))-E)];D=[0,2*N.indexOf(Math.min(...N))-1]}else{const N=[Math.abs(s.ay(E,...Du(F,-1))-E),Math.abs(s.ay(E,...Du(F,0))-E),Math.abs(s.ay(E,...Du(F,1))-E)];D=[N.indexOf(Math.min(...N))-1]}}else D=[0];for(const F of D){const N=n.containsTile(R,y,a,F);N&&g.push(N)}}return g}getShadowCasterCoordinates(){return this._getRenderableCoordinates(!1,!0)}getVisibleCoordinates(n){return this._getRenderableCoordinates(n)}_getRenderableCoordinates(n,a){const f=this.getRenderableIds(n,a).map(y=>this._tiles[y].tileID),g=this.transform.projection.name==="globe";for(const y of f)y.projMatrix=this.transform.calculateProjMatrix(y.toUnwrapped()),y.expandedProjMatrix=g?this.transform.calculateProjMatrix(y.toUnwrapped(),!1,!0):y.projMatrix;return f}sortCoordinatesByDistance(n){const a=n.slice(),f=this.transform._camera.position,g=this.transform._camera.forward(),y={};for(const b of a){const E=1/(1<<b.canonical.z);y[b.key]=((b.canonical.x+.5)*E+b.wrap-f[0])*g[0]+((b.canonical.y+.5)*E-f[1])*g[1]-f[2]*g[2]}return a.sort((b,E)=>y[b.key]-y[E.key]),a}hasTransition(){if(this._source.hasTransition())return!0;if(kh(this._source.type))for(const n in this._tiles){const a=this._tiles[n];if(a.fadeEndTime!==void 0&&a.fadeEndTime>=s.q.now())return!0}return!1}setFeatureState(n,a,f){this._state.updateState(n=n||"_geojsonTileLayer",a,f)}removeFeatureState(n,a,f){this._state.removeFeatureState(n=n||"_geojsonTileLayer",a,f)}getFeatureState(n,a){return this._state.getState(n=n||"_geojsonTileLayer",a)}setDependencies(n,a,f){const g=this._tiles[n];g&&g.setDependencies(a,f)}reloadTilesForDependencies(n,a){for(const f in this._tiles)this._tiles[f].hasDependency(n,a)&&this._reloadTile(+f,"reloading");this._cache.filter(f=>!f.hasDependency(n,a))}_preloadTiles(n,a){if(!this._sourceLoaded){const A=()=>{this._sourceLoaded&&(this._source.off("data",A),this._preloadTiles(n,a))};return void this._source.on("data",A)}const f=new Map,g=Array.isArray(n)?n:[n],y=this.map.painter.terrain,b=this.usedForTerrain&&y?y.getScaledDemTileSize():this._source.tileSize;for(const A of g){const R=A.coveringTiles({tileSize:b,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!this.usedForTerrain,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain});for(const D of R)f.set(D.key,D);this.usedForTerrain&&A.updateElevation(!1)}const E=Array.from(f.values());s.bt(E,(A,R)=>{const D=new jc(A,this._source.tileSize*A.overscaleFactor(),this.transform.tileZoom,this.map.painter,this._isRaster,this._source.worldview);this._loadTile(D,F=>{this._source.type==="raster-dem"&&D.dem&&this._backfillDEM(D),R(F,D)})},a)}}function Bc(h,n){const a=Math.abs(2*h.wrap)-+(h.wrap<0),f=Math.abs(2*n.wrap)-+(n.wrap<0);return h.overscaledZ-n.overscaledZ||f-a||n.canonical.y-h.canonical.y||n.canonical.x-h.canonical.x}function kh(h){return h==="raster"||h==="image"||h==="video"||h==="custom"}function Du(h,n){const a=1<<h.z;return[h.x/a+n,(h.x+1)/a+n]}oo.maxOverzooming=10,oo.maxUnderzooming=3;class Gx{constructor(n){this.style=n,this.layersGotHidden=!1,this.layers=[]}processLayersChanged(){this.layers=[];const n=!1,a=!1;for(const f in this.style._mergedLayers){const g=this.style._mergedLayers[f];if(g.type==="fill-extrusion"||g.type==="building")this.layers.push({layer:g,visible:n,visibilityChanged:a});else if(g.type==="model"){const y=this.style.getLayerSource(g);y&&y.type==="batched-model"&&this.layers.push({layer:g,visible:n,visibilityChanged:a})}}}onNewFrame(n){this.layersGotHidden=!1;for(const a of this.layers){const f=a.layer;let g=!1;f.type==="fill-extrusion"?g=!f.isHidden(n)&&f.paint.get("fill-extrusion-opacity")>0:f.type==="building"?g=!f.isHidden(n)&&f.paint.get("building-opacity")>0:f.type==="model"&&(g=!f.isHidden(n)&&f.paint.get("model-opacity").constantOr(1)>0),this.layersGotHidden=this.layersGotHidden||!g&&a.visible,a.visible=g}}updateZOffset(n,a){this.currentBuildingBuckets=[];for(const g of this.layers){const y=g.layer,b=this.style.getLayerSourceCache(y);let E=1;y.type==="fill-extrusion"?E=g.visible?y.paint.get("fill-extrusion-vertical-scale"):0:y.type==="building"&&(E=g.visible?y.paint.get("building-vertical-scale"):0);let A=b?b.getTile(a):null;if(!A&&b&&a.canonical.z>b.getSource().minzoom){let R=a.scaledTo(Math.min(b.getSource().maxzoom,a.overscaledZ-1));for(;R.overscaledZ>=b.getSource().minzoom&&(A=b.getTile(R),!A&&R.overscaledZ!==0);)R=R.scaledTo(R.overscaledZ-1)}this.currentBuildingBuckets.push({bucket:A?A.getBucket(y):null,tileID:A?A.tileID:a,verticalScale:E})}n.hasAnyZOffset=!1;let f=!1;for(let g=0;g<n.symbolInstances.length;g++){const y=n.symbolInstances.get(g),b=y.zOffset,E=this._getHeightAtTileOffset(a,y.tileAnchorX,y.tileAnchorY);y.zOffset=E!==Number.NEGATIVE_INFINITY?E:b,f||b===y.zOffset||(f=!0),n.hasAnyZOffset||y.zOffset===0||(n.hasAnyZOffset=!0)}f&&(n.zOffsetBuffersNeedUpload=!0,n.zOffsetSortDirty=!0)}_mapCoordToOverlappingTile(n,a,f,g){let y=a,b=f;if(n.canonical.z!==g.canonical.z){const E=g.canonical,A=1/(1<<n.canonical.z-E.z);y=(a+n.canonical.x*s.aj)*A-E.x*s.aj|0,b=(f+n.canonical.y*s.aj)*A-E.y*s.aj|0}return{tileX:y,tileY:b}}_getHeightAtTileOffset(n,a,f){let g,y;for(let b=0;b<this.layers.length;++b){const E=this.layers[b].layer;if(E.type!=="fill-extrusion"&&E.type!=="building")continue;const{bucket:A,tileID:R,verticalScale:D}=this.currentBuildingBuckets[b];if(!A)continue;const{tileX:F,tileY:N}=this._mapCoordToOverlappingTile(n,a,f,R),j=A.getHeightAtTileCoord(F,N);j&&j.height!==void 0&&(j.hidden?g=j.height:y=Math.max(j.height*D,y||0))}if(y!==void 0)return y;for(let b=0;b<this.layers.length;++b){const E=this.layers[b];if(E.layer.type!=="model"||!E.visible)continue;const{bucket:A,tileID:R}=this.currentBuildingBuckets[b];if(!A)continue;const{tileX:D,tileY:F}=this._mapCoordToOverlappingTile(n,a,f,R),N=A.getHeightAtTileCoord(D,F);if(N&&!N.hidden)return N.height===void 0&&g!==void 0?Math.min(N.maxHeight,g)*N.verticalScale:N.height?N.height*N.verticalScale:Number.NEGATIVE_INFINITY}return this.layersGotHidden?0:Number.NEGATIVE_INFINITY}}function Hx(h,n){const a={};for(const f in h)f!=="ref"&&(a[f]=h[f]);return s.bu.forEach(f=>{f in n&&(a[f]=n[f])}),a}function Dh(h){h=h.slice();const n=Object.create(null);for(let a=0;a<h.length;a++)n[h[a].id]=h[a];for(let a=0;a<h.length;a++)"ref"in h[a]&&(h[a]=Hx(h[a],n[h[a].ref]));return h}const ur={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setSlot:"setSlot",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight",setTerrain:"setTerrain",setFog:"setFog",setSnow:"setSnow",setRain:"setRain",setCamera:"setCamera",setLights:"setLights",setProjection:"setProjection",addImport:"addImport",removeImport:"removeImport",updateImport:"updateImport",addIconset:"addIconset",removeIconset:"removeIconset"};function Ap(h,n,a){a.push({command:ur.addSource,args:[h,n[h]]})}function Lu(h,n,a){n.push({command:ur.removeSource,args:[h]}),a[h]=!0}function Lh(h,n,a,f){Lu(h,a,f),Ap(h,n,a)}function k2(h,n,a){let f;for(f in h[a])if(h[a].hasOwnProperty(f)&&f!=="data"&&!s.bv(h[a][f],n[a][f]))return!1;for(f in n[a])if(n[a].hasOwnProperty(f)&&f!=="data"&&!s.bv(h[a][f],n[a][f]))return!1;return!0}function Nh(h,n,a,f,g,y){let b;for(b in n=n||{},h=h||{})h.hasOwnProperty(b)&&(s.bv(h[b],n[b])||a.push({command:y,args:[f,b,n[b],g]}));for(b in n)n.hasOwnProperty(b)&&!h.hasOwnProperty(b)&&(s.bv(h[b],n[b])||a.push({command:y,args:[f,b,n[b],g]}))}function Vc(h){return h.id}function Xl(h,n){return h[n.id]=n,h}class m_{constructor(n,a){this.reset(n,a)}reset(n,a){this.points=n||[],this._distances=[0];for(let f=1;f<this.points.length;f++)this._distances[f]=this._distances[f-1]+this.points[f].dist(this.points[f-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(a||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(n){if(this.points.length===1)return this.points[0];n=s.ay(n,0,1);let a=1,f=this._distances[a];const g=n*this.paddedLength+this.padding;for(;f<g&&a<this._distances.length;)f=this._distances[++a];const y=a-1,b=this._distances[y],E=f-b,A=E>0?(g-b)/E:0;return this.points[y].mult(1-A).add(this.points[a].mult(A))}}class g_{constructor(n,a,f){const g=this.boxCells=[],y=this.circleCells=[];this.xCellCount=Math.ceil(n/f),this.yCellCount=Math.ceil(a/f);for(let b=0;b<this.xCellCount*this.yCellCount;b++)g.push([]),y.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=n,this.height=a,this.xScale=this.xCellCount/n,this.yScale=this.yCellCount/a,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(n,a,f,g,y){this._forEachCell(a,f,g,y,this._insertBoxCell,this.boxUid++),this.boxKeys.push(n),this.bboxes.push(a),this.bboxes.push(f),this.bboxes.push(g),this.bboxes.push(y)}insertCircle(n,a,f,g){this._forEachCell(a-g,f-g,a+g,f+g,this._insertCircleCell,this.circleUid++),this.circleKeys.push(n),this.circles.push(a),this.circles.push(f),this.circles.push(g)}_insertBoxCell(n,a,f,g,y,b){this.boxCells[y].push(b)}_insertCircleCell(n,a,f,g,y,b){this.circleCells[y].push(b)}_query(n,a,f,g,y,b){if(f<0||n>this.width||g<0||a>this.height)return!y&&[];const E=[];if(n<=0&&a<=0&&this.width<=f&&this.height<=g){if(y)return!0;for(let A=0;A<this.boxKeys.length;A++)E.push({key:this.boxKeys[A],x1:this.bboxes[4*A],y1:this.bboxes[4*A+1],x2:this.bboxes[4*A+2],y2:this.bboxes[4*A+3]});for(let A=0;A<this.circleKeys.length;A++){const R=this.circles[3*A],D=this.circles[3*A+1],F=this.circles[3*A+2];E.push({key:this.circleKeys[A],x1:R-F,y1:D-F,x2:R+F,y2:D+F})}return b?E.filter(b):E}return this._forEachCell(n,a,f,g,this._queryCell,E,{hitTest:y,seenUids:{box:{},circle:{}}},b),y?E.length>0:E}_queryCircle(n,a,f,g,y){const b=n-f,E=n+f,A=a-f,R=a+f;if(E<0||b>this.width||R<0||A>this.height)return!g&&[];const D=[];return this._forEachCell(b,A,E,R,this._queryCellCircle,D,{hitTest:g,circle:{x:n,y:a,radius:f},seenUids:{box:{},circle:{}}},y),g?D.length>0:D}query(n,a,f,g,y){return this._query(n,a,f,g,!1,y)}hitTest(n,a,f,g,y){return this._query(n,a,f,g,!0,y)}hitTestCircle(n,a,f,g){return this._queryCircle(n,a,f,!0,g)}_queryCell(n,a,f,g,y,b,E,A){const R=E.seenUids,D=this.boxCells[y];if(D!==null){const N=this.bboxes;for(const j of D)if(!R.box[j]){R.box[j]=!0;const X=4*j;if(n<=N[X+2]&&a<=N[X+3]&&f>=N[X+0]&&g>=N[X+1]&&(!A||A(this.boxKeys[j]))){if(E.hitTest)return b.push(!0),!0;b.push({key:this.boxKeys[j],x1:N[X],y1:N[X+1],x2:N[X+2],y2:N[X+3]})}}}const F=this.circleCells[y];if(F!==null){const N=this.circles;for(const j of F)if(!R.circle[j]){R.circle[j]=!0;const X=3*j;if(this._circleAndRectCollide(N[X],N[X+1],N[X+2],n,a,f,g)&&(!A||A(this.circleKeys[j]))){if(E.hitTest)return b.push(!0),!0;{const W=N[X],K=N[X+1],ee=N[X+2];b.push({key:this.circleKeys[j],x1:W-ee,y1:K-ee,x2:W+ee,y2:K+ee})}}}}}_queryCellCircle(n,a,f,g,y,b,E,A){const R=E.circle,D=E.seenUids,F=this.boxCells[y];if(F!==null){const j=this.bboxes;for(const X of F)if(!D.box[X]){D.box[X]=!0;const W=4*X;if(this._circleAndRectCollide(R.x,R.y,R.radius,j[W+0],j[W+1],j[W+2],j[W+3])&&(!A||A(this.boxKeys[X])))return b.push(!0),!0}}const N=this.circleCells[y];if(N!==null){const j=this.circles;for(const X of N)if(!D.circle[X]){D.circle[X]=!0;const W=3*X;if(this._circlesCollide(j[W],j[W+1],j[W+2],R.x,R.y,R.radius)&&(!A||A(this.circleKeys[X])))return b.push(!0),!0}}}_forEachCell(n,a,f,g,y,b,E,A){const R=this._convertToXCellCoord(n),D=this._convertToYCellCoord(a),F=this._convertToXCellCoord(f),N=this._convertToYCellCoord(g);for(let j=R;j<=F;j++)for(let X=D;X<=N;X++)if(y.call(this,n,a,f,g,this.xCellCount*X+j,b,E,A))return}_convertToXCellCoord(n){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(n*this.xScale)))}_convertToYCellCoord(n){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(n*this.yScale)))}_circlesCollide(n,a,f,g,y,b){const E=g-n,A=y-a,R=f+b;return R*R>E*E+A*A}_circleAndRectCollide(n,a,f,g,y,b,E){const A=(b-g)/2,R=Math.abs(n-(g+A));if(R>A+f)return!1;const D=(E-y)/2,F=Math.abs(a-(y+D));if(F>D+f)return!1;if(R<=A||F<=D)return!0;const N=R-A,j=F-D;return N*N+j*j<=f*f}}const Uc={unknown:0,flipRequired:1,flipNotRequired:2},qx=Math.tan(85*Math.PI/180);function ol(h,n,a,f,g,y,b){const E=s.bz();if(a)if(y.name==="globe"){const A=s.bA(g,n);s.az(E,E,A)}else{const A=s.bB([],b);E[0]=A[0],E[1]=A[1],E[4]=A[2],E[5]=A[3],f||s.by(E,E,g.angle)}else s.az(E,g.labelPlaneMatrix,h);return E}function Ip(h,n,a,f,g,y,b){const E=ol(h,n,a,f,g,y,b);return y.name==="globe"&&a||(E[2]=E[6]=E[10]=E[14]=0),E}function Pp(h,n,a,f,g,y,b){if(a){if(y.name==="globe"){const E=ol(h,n,a,f,g,y,b);return s.bi(E,E),s.az(E,h,E),E}{const E=s.bw(h),A=s.bx([]);return A[0]=b[0],A[1]=b[1],A[4]=b[2],A[5]=b[3],s.az(E,E,A),f||s.by(E,E,-g.angle),E}}return g.glCoordMatrix}function ga(h,n,a,f){const g=[h,n,a,1];a?s.aA(g,g,f):Er(g,g,f);const y=g[3];return g[0]/=y,g[1]/=y,g[2]/=y,g}function zh(h,n){return Math.min(.5+h/n*.5,1.5)}function $c(h,n){const a=h[0]/h[3],f=h[1]/h[3];return a>=-n[0]&&a<=n[0]&&f>=-n[1]&&f<=n[1]}function Mp(h,n,a,f,g,y,b,E,A,R){const D=a.transform,F=f?h.textSizeData:h.iconSizeData,N=s.bH(F,a.transform.zoom),j=D.projection.name==="globe",X=[256/a.width*2+1,256/a.height*2+1],W=f?h.text.dynamicLayoutVertexArray:h.icon.dynamicLayoutVertexArray;W.clear();let K=null;j&&(K=f?h.text.globeExtVertexArray:h.icon.globeExtVertexArray);const ee=h.lineVertexArray,ie=f?h.text.placedSymbolArray:h.icon.placedSymbolArray,fe=a.transform.width/a.transform.height;let _e,we=!1;for(let be=0;be<ie.length;be++){const ve=ie.get(be),{numGlyphs:ye,writingMode:Se}=ve;if(Se!==s.bI.vertical||we||_e===s.bI.horizontal||(we=!0),_e=Se,(ve.hidden||Se===s.bI.vertical)&&!we){Hc(ye,W);continue}we=!1;const Ee=new s.P(ve.tileAnchorX,ve.tileAnchorY);let{x:Fe,y:je,z:rt}=D.projection.projectTilePoint(Ee.x,Ee.y,R.canonical);if(A){const[qt,Wt,Vt]=A(Ee);Fe+=qt,je+=Wt,rt+=Vt}const it=[Fe,je,rt,1];if(s.aA(it,it,n),!$c(it,X)){Hc(ye,W);continue}const gt=it[3],ze=zh(a.transform.getCameraToCenterDistance(D.projection),gt),Xe=s.bJ(F,N,ve),Re=b?Xe/ze:Xe*ze,ot=ga(Fe,je,rt,g);if(ot[3]<=0){Hc(ye,W);continue}let Ge={};const dt=s.al(h.layers[0].layout.get("text-max-angle")),At=Math.cos(dt),st=b?null:A,Tt=Gc(ve,Re,!1,E,n,g,y,h.glyphOffsetArray,ee,W,K,ot,Ee,Ge,fe,st,D.projection,R,b,At);we=Tt.useVertical,st&&Tt.needsFlipping&&(Ge={}),(Tt.notEnoughRoom||we||Tt.needsFlipping&&Gc(ve,Re,!0,E,n,g,y,h.glyphOffsetArray,ee,W,K,ot,Ee,Ge,fe,st,D.projection,R,b,At).notEnoughRoom)&&Hc(ye,W)}f?(h.text.dynamicLayoutVertexBuffer.updateData(W),K&&h.text.globeExtVertexBuffer&&h.text.globeExtVertexBuffer.updateData(K)):(h.icon.dynamicLayoutVertexBuffer.updateData(W),K&&h.icon.globeExtVertexBuffer&&h.icon.globeExtVertexBuffer.updateData(K))}function __(h,n,a,f,g,y,b,E,A,R,D,F,N,j,X,W,K){const{lineStartIndex:ee,glyphStartIndex:ie,segment:fe}=E,_e=ie+E.numGlyphs,we=ee+E.lineLength,be=n.getoffsetX(ie),ve=n.getoffsetX(_e-1),ye=Nu(h*be,a,f,g,y,b,fe,ee,we,A,R,D,F,N,!0,j,X,W,K);if(!ye)return null;const Se=Nu(h*ve,a,f,g,y,b,fe,ee,we,A,R,D,F,N,!0,j,X,W,K);return Se?{first:ye,last:Se}:null}function Rp(h,n,a,f){return h===s.bI.horizontal&&Math.abs(f)>Math.abs(a)?{useVertical:!0}:h===s.bI.vertical?f>0?{needsFlipping:!0}:null:n!==Uc.unknown&&function(g,y){return g===0||Math.abs(y/g)>qx}(a,f)?n===Uc.flipRequired?{needsFlipping:!0}:null:a<0?{needsFlipping:!0}:null}function Gc(h,n,a,f,g,y,b,E,A,R,D,F,N,j,X,W,K,ee,ie,fe){const _e=n/24,we=h.lineOffsetX*_e,be=h.lineOffsetY*_e,{lineStartIndex:ve,glyphStartIndex:ye,numGlyphs:Se,segment:Ee,writingMode:Fe,flipState:je}=h,rt=ve+h.lineLength,it=gt=>{if(D){const[ot,Ge,dt]=gt.up,At=R.length;s.bK(D,At+0,ot,Ge,dt),s.bK(D,At+1,ot,Ge,dt),s.bK(D,At+2,ot,Ge,dt),s.bK(D,At+3,ot,Ge,dt)}const[ze,Xe,Re]=gt.point;s.bL(R,ze,Xe,Re,gt.angle)};if(Se>1){const gt=__(_e,E,we,be,a,F,N,h,A,y,j,W,!1,K,ee,ie,fe);if(!gt)return{notEnoughRoom:!0};if(f&&!a){let[ze,Xe,Re]=gt.first.point,[ot,Ge,dt]=gt.last.point;[ze,Xe]=ga(ze,Xe,Re,b),[ot,Ge]=ga(ot,Ge,dt,b);const At=Rp(Fe,je,(ot-ze)*X,Ge-Xe);if(h.flipState=At&&At.needsFlipping?Uc.flipRequired:Uc.flipNotRequired,At)return At}it(gt.first);for(let ze=ye+1;ze<ye+Se-1;ze++){const Xe=Nu(_e*E.getoffsetX(ze),we,be,a,F,N,Ee,ve,rt,A,y,j,W,!1,!1,K,ee,ie,fe);if(!Xe)return R.length-=4*(ze-ye),{notEnoughRoom:!0};it(Xe)}it(gt.last)}else{if(f&&!a){const ze=ga(N.x,N.y,0,g),Xe=ve+Ee+1,Re=new s.P(A.getx(Xe),A.gety(Xe)),ot=ga(Re.x,Re.y,0,g),Ge=ot[3]>0?ot:y_(N,Re,ze,1,g,void 0,K,ee.canonical),dt=Rp(Fe,je,(Ge[0]-ze[0])*X,Ge[1]-ze[1]);if(h.flipState=dt&&dt.needsFlipping?Uc.flipRequired:Uc.flipNotRequired,dt)return dt}const gt=Nu(_e*E.getoffsetX(ye),we,be,a,F,N,Ee,ve,rt,A,y,j,W,!1,!1,K,ee,ie,fe);if(!gt)return{notEnoughRoom:!0};it(gt)}return{}}function vo(h,n,a,f,g){const{x:y,y:b,z:E}=f.projectTilePoint(h.x,h.y,n);if(!g)return ga(y,b,E,a);const[A,R,D]=g(h);return ga(y+A,b+R,E+D,a)}function y_(h,n,a,f,g,y,b,E){const A=vo(h.sub(n)._unit()._add(h),E,g,b,y);return s.at(A,a,A),s.au(A,A),s.bE(A,a,A,f)}function Nu(h,n,a,f,g,y,b,E,A,R,D,F,N,j,X,W,K,ee,ie){const fe=f?h-n:h+n;let _e=fe>0?1:-1,we=0;f&&(_e*=-1,we=Math.PI),_e<0&&(we+=Math.PI);let be=E+b+(_e>0?0:1)|0,ve=g,ye=g,Se=0,Ee=0;const Fe=Math.abs(fe),je=[],rt=[];let it=y,gt=it,ze=s.bC([]);const Xe=()=>y_(gt,it,ye,Fe-Se+1,D,N,W,K.canonical);for(;Se+Ee<=Fe;){if(be+=_e,be<E||be>=A)return null;if(ye=ve,gt=it,je.push(ye),j&&rt.push(gt),it=new s.P(R.getx(be),R.gety(be)),ve=F[be],!ve){const Vt=vo(it,K.canonical,D,W,N);ve=Vt[3]>0?F[be]=Vt:Xe()}Se+=Ee;const qt=s.at([],ve,ye),Wt=s.bD(ye,ve);if(a&&Wt>0&&Ee>0&&s.bG(ze,qt)/(Ee*Wt)<ie)return null;Ee=Wt,ze=qt}X&&N&&(F[be]&&(ve=Xe(),Ee=s.bD(ye,ve),ze=s.at([],ve,ye)),F[be]=ve);const Re=(Fe-Se)/Ee,ot=it.sub(gt)._mult(Re)._add(gt),Ge=s.bE([],ye,ze,Re);let dt=[0,0,1],At=ze[0],st=ze[1];if(ee&&(dt=W.upVector(K.canonical,ot.x,ot.y),dt[0]!==0||dt[1]!==0||dt[2]!==1)){const qt=[dt[2],0,-dt[0]],Wt=s.bF([],dt,qt);s.au(qt,qt),s.au(Wt,Wt),At=s.bG(ze,qt),st=s.bG(ze,Wt)}if(a){const qt=s.bF([],dt,ze);s.au(qt,qt),s.bE(Ge,Ge,qt,a*_e)}const Tt=we+Math.atan2(st,At);return je.push(Ge),j&&rt.push(ot),{point:Ge,angle:Tt,path:je,tilePath:rt,up:dt}}function Hc(h,n){const a=n.length,f=a+4*h;n.resize(f),n.float32.fill(-1/0,4*a,4*f)}function Er(h,n,a){const f=n[0],g=n[1];return h[0]=a[0]*f+a[4]*g+a[12],h[1]=a[1]*f+a[5]*g+a[13],h[3]=a[3]*f+a[7]*g+a[15],h}const _a=100;class D2{constructor(n,a,f=new g_(n.width+200,n.height+200,25),g=new g_(n.width+200,n.height+200,25)){this.transform=n,this.grid=f,this.ignoredGrid=g,this.pitchfactor=Math.cos(n._pitch)*n.cameraToCenterDistance,this.screenRightBoundary=n.width+_a,this.screenBottomBoundary=n.height+_a,this.gridRightBoundary=n.width+200,this.gridBottomBoundary=n.height+200,this.fogState=a}placeCollisionBox(n,a,f,g,y,b,E,A){let R=f.projectedAnchorX,D=f.projectedAnchorY,F=f.projectedAnchorZ;const N=f.elevation,j=f.tileID,X=n.getProjection();if(N&&j){const[be,ve,ye]=X.upVector(j.canonical,f.tileAnchorX,f.tileAnchorY),Se=X.upVectorScale(j.canonical,this.transform.center.lat,this.transform.worldSize).metersToTile;R+=be*N*Se,D+=ve*N*Se,F+=ye*N*Se}const W=this.projectAndGetPerspectiveRatio(E,R,D,F,f.tileID,X.name==="globe"||!!N||this.transform.pitch>0,X),K=b*W.perspectiveRatio,ee=(f.x1*a+g.x-f.padding)*K+W.point.x,ie=(f.y1*a+g.y-f.padding)*K+W.point.y,fe=(f.x2*a+g.x+f.padding)*K+W.point.x,_e=(f.y2*a+g.y+f.padding)*K+W.point.y,we=W.perspectiveRatio<=.55||W.occluded;return!this.isInsideGrid(ee,ie,fe,_e)||!y&&this.grid.hitTest(ee,ie,fe,_e,A)||we?{box:[],offscreen:!1,occluded:W.occluded}:{box:[ee,ie,fe,_e],offscreen:this.isOffscreen(ee,ie,fe,_e),occluded:!1}}placeCollisionCircles(n,a,f,g,y,b,E,A,R,D,F,N,j,X,W){const K=[],ee=this.transform.elevation,ie=n.getProjection(),fe=ee?ee.getAtTileOffsetFunc(W,this.transform.center.lat,this.transform.worldSize,ie):null,_e=new s.P(f.tileAnchorX,f.tileAnchorY);let{x:we,y:be,z:ve}=ie.projectTilePoint(_e.x,_e.y,W.canonical);if(fe){const[dt,At,st]=fe(_e);we+=dt,be+=At,ve+=st}const ye=ie.name==="globe",Se=this.projectAndGetPerspectiveRatio(E,we,be,ve,W,ye||!!ee||this.transform.pitch>0,ie),{perspectiveRatio:Ee}=Se,Fe=(F?b/Ee:b*Ee)/s.bO,je=ga(we,be,ve,A),rt=f.lineOffsetX*Fe,it=f.lineOffsetY*Fe,gt=s.al(n.layers[0].layout.get("text-max-angle")),ze=Math.cos(gt),Xe=Se.signedDistanceFromCamera>0?__(Fe,y,rt,it,!1,je,_e,f,g,A,{},ee&&!F?fe:null,F&&!!ee,ie,W,F,ze):null;let Re=!1,ot=!1,Ge=!0;if(Xe&&!Se.occluded){const dt=.5*j*Ee+X,At=new s.P(-100,-100),st=new s.P(this.screenRightBoundary,this.screenBottomBoundary),Tt=new m_,{first:qt,last:Wt}=Xe,Vt=qt.path.length;let tn=[];for(let wn=Vt-1;wn>=1;wn--)tn.push(qt.path[wn]);for(let wn=1;wn<Wt.path.length;wn++)tn.push(Wt.path[wn]);const on=2.5*dt;R&&(tn=tn.map(([wn,Bn,Ar],Zr)=>(fe&&!ye&&(Ar=fe(Zr<Vt-1?qt.tilePath[Vt-1-Zr]:Wt.tilePath[Zr-Vt+2])[2]),ga(wn,Bn,Ar,R))),tn.some(wn=>wn[3]<=0)&&(tn=[]));let cn=[];if(tn.length>0){let wn=1/0,Bn=-1/0,Ar=1/0,Zr=-1/0;for(const kr of tn)wn=Math.min(wn,kr[0]),Ar=Math.min(Ar,kr[1]),Bn=Math.max(Bn,kr[0]),Zr=Math.max(Zr,kr[1]);Bn>=At.x&&wn<=st.x&&Zr>=At.y&&Ar<=st.y&&(cn=[tn.map(kr=>new s.P(kr[0],kr[1]))],(wn<At.x||Bn>st.x||Ar<At.y||Zr>st.y)&&(cn=s.bM(cn,At.x,At.y,st.x,st.y)))}for(const wn of cn){Tt.reset(wn,.25*dt);let Bn=0;Bn=Tt.length<=.5*dt?1:Math.ceil(Tt.paddedLength/on)+1;for(let Ar=0;Ar<Bn;Ar++){const Zr=Ar/Math.max(Bn-1,1),kr=Tt.lerp(Zr),zr=kr.x+_a,Di=kr.y+_a;K.push(zr,Di,dt,0);const Dn=zr-dt,Gn=Di-dt,Jn=zr+dt,ri=Di+dt;if(Ge=Ge&&this.isOffscreen(Dn,Gn,Jn,ri),ot=ot||this.isInsideGrid(Dn,Gn,Jn,ri),!a&&this.grid.hitTestCircle(zr,Di,dt,N)&&(Re=!0,!D))return{circles:[],offscreen:!1,collisionDetected:Re,occluded:!1}}}}return{circles:!D&&Re||!ot?[]:K,offscreen:Ge,collisionDetected:Re,occluded:Se.occluded}}queryRenderedSymbols(n){if(n.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const a=[];let f=1/0,g=1/0,y=-1/0,b=-1/0;for(const D of n){const F=new s.P(D.x+_a,D.y+_a);f=Math.min(f,F.x),g=Math.min(g,F.y),y=Math.max(y,F.x),b=Math.max(b,F.y),a.push(F)}const E=this.grid.query(f,g,y,b).concat(this.ignoredGrid.query(f,g,y,b)),A={},R={};for(const D of E){const F=D.key;if(A[F.bucketInstanceId]===void 0&&(A[F.bucketInstanceId]={}),A[F.bucketInstanceId][F.featureIndex])continue;const N=[new s.P(D.x1,D.y1),new s.P(D.x2,D.y1),new s.P(D.x2,D.y2),new s.P(D.x1,D.y2)];s.bN(a,N)&&(A[F.bucketInstanceId][F.featureIndex]=!0,R[F.bucketInstanceId]===void 0&&(R[F.bucketInstanceId]=[]),R[F.bucketInstanceId].push(F.featureIndex))}return R}insertCollisionBox(n,a,f,g,y){(a?this.ignoredGrid:this.grid).insert({bucketInstanceId:f,featureIndex:g,collisionGroupID:y},n[0],n[1],n[2],n[3])}insertCollisionCircles(n,a,f,g,y){const b=a?this.ignoredGrid:this.grid,E={bucketInstanceId:f,featureIndex:g,collisionGroupID:y};for(let A=0;A<n.length;A+=4)b.insertCircle(E,n[A],n[A+1],n[A+2])}projectAndGetPerspectiveRatio(n,a,f,g,y,b,E){const A=[a,f,g,1];let R=!1;g||this.transform.pitch>0?(s.aA(A,A,n),this.fogState&&y&&E.name!=="globe"&&(R=function(N,j,X,W,K,ee){const ie=ee.calculateFogTileMatrix(K),fe=[j,X,W];return s.ad(fe,fe,ie),kt(N,s.ae(fe),ee.pitch,ee._fov)}(this.fogState,a,f,g,y.toUnwrapped(),this.transform)>.9)):Er(A,A,n);const D=A[3];return{point:new s.P((A[0]/D+1)/2*this.transform.width+_a,(-A[1]/D+1)/2*this.transform.height+_a),perspectiveRatio:Math.min(.5+this.transform.getCameraToCenterDistance(E)/D*.5,1.5),signedDistanceFromCamera:D,occluded:b&&A[2]>D||R}}isOffscreen(n,a,f,g){return f<_a||n>=this.screenRightBoundary||g<_a||a>this.screenBottomBoundary}isInsideGrid(n,a,f,g){return f>=0&&n<this.gridRightBoundary&&g>=0&&a<this.gridBottomBoundary}getViewportMatrix(){const n=s.bx([]);return s.bo(n,n,[-100,-100,0]),n}}function v_(h,n,a){const f=n.createTileMatrix(h,h.worldSize,a.toUnwrapped());return s.az(new Float32Array(16),h.projMatrix,f)}function vn(h,n,a){if(n.projection.name===a.projection.name)return h.projMatrix;const f=a.clone();return f.setProjection(n.projection),v_(f,n.getProjection(),h)}function kp(h,n,a){return n.name===a.projection.name?h.projMatrix:v_(a,n,h)}class Oh{constructor(n,a,f,g){this.opacity=n?Math.max(0,Math.min(1,n.opacity+(n.placed?a:-a))):g&&f?1:0,this.placed=f}isHidden(){return this.opacity===0&&!this.placed}}class qc{constructor(n,a,f,g,y,b=!1){this.text=new Oh(n?n.text:null,a,f,y),this.icon=new Oh(n?n.icon:null,a,g,y),this.clipped=b}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class No{constructor(n,a,f,g=!1){this.text=n,this.icon=a,this.skipFade=f,this.clipped=g}}class x_{constructor(){this.invProjMatrix=s.bz(),this.viewportMatrix=s.bz(),this.circles=[]}}class zu{constructor(n,a,f,g,y){this.bucketInstanceId=n,this.featureIndex=a,this.sourceLayerIndex=f,this.bucketIndex=g,this.tileID=y}}class nn{constructor(n){this.crossSourceCollisions=n,this.maxGroupID=0,this.collisionGroups={}}get(n){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[n]){const a=++this.maxGroupID;this.collisionGroups[n]={ID:a,predicate:f=>f.collisionGroupID===a}}return this.collisionGroups[n]}}function Nr(h,n,a,f,g){const{horizontalAlign:y,verticalAlign:b}=s.bT(h),E=-(y-.5)*n,A=-(b-.5)*a,R=s.bU(h,f);return new s.P(E+R[0]*g,A+R[1]*g)}function br(h,n,a,f,g){const y=new s.P(h,n);return a&&y._rotate(f?g:-g),y}class xo{constructor(n,a,f,g,y,b){this.transform=n.clone(),this.projection=n.projection.name,this.collisionIndex=new D2(this.transform,y),this.buildingIndex=b,this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=a,this.retainedQueryData={},this.collisionGroups=new nn(f),this.collisionCircleArrays={},this.prevPlacement=g,g&&(g.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(n,a,f,g,y=1){const b=f.getBucket(a),E=f.latestFeatureIndex;if(!b||!E||a.fqid!==b.layerIds[0])return;const A=b.layers[0].layout,R=b.layers[0].paint,D=f.collisionBoxArray,F=Math.pow(2,this.transform.zoom-f.tileID.overscaledZ),N=f.tileSize/s.aj,j=f.tileID.toUnwrapped();this.transform.setProjection(b.projection);const X=(W=f.tileID,K=b.getProjection(),ee=this.transform,K.name===this.projection?ee.calculateProjMatrix(W.toUnwrapped()):v_(ee,K,W));var W,K,ee;const ie=A.get("text-pitch-alignment")==="map",fe=A.get("text-rotation-alignment")==="map";a.compileFilter(a.options);const _e=a.dynamicFilter(),we=a.dynamicFilterNeedsFeature(),be=this.transform.calculatePixelsToTileUnitsMatrix(f),ve=Ip(X,f.tileID.canonical,ie,fe,this.transform,b.getProjection(),be);let ye=null;if(ie){const Xe=Pp(X,f.tileID.canonical,ie,fe,this.transform,b.getProjection(),be);ye=s.az([],this.transform.labelPlaneMatrix,Xe)}let Se=null;_e&&f.latestFeatureIndex&&(Se={unwrappedTileID:j,dynamicFilter:_e,dynamicFilterNeedsFeature:we}),this.retainedQueryData[b.bucketInstanceId]=new zu(b.bucketInstanceId,E,b.sourceLayerIndex,b.index,f.tileID);const[Ee,Fe]=b.layers[0].layout.get("text-size-scale-range"),je=s.ay(y,Ee,Fe),[rt,it]=A.get("icon-size-scale-range"),gt=s.ay(y,rt,it),ze={bucket:b,layout:A,paint:R,posMatrix:X,textLabelPlaneMatrix:ve,labelToScreenMatrix:ye,clippingData:Se,scale:F,textPixelRatio:N,holdingForFade:f.holdingForFade(),collisionBoxArray:D,partiallyEvaluatedTextSize:s.bH(b.textSizeData,this.transform.zoom,je),partiallyEvaluatedIconSize:s.bH(b.iconSizeData,this.transform.zoom,gt),collisionGroup:this.collisionGroups.get(b.sourceID),latestFeatureIndex:f.latestFeatureIndex};if(g)for(const Xe of b.sortKeyRanges){const{sortKey:Re,symbolInstanceStart:ot,symbolInstanceEnd:Ge}=Xe;n.push({sortKey:Re,symbolInstanceStart:ot,symbolInstanceEnd:Ge,parameters:ze})}else n.push({symbolInstanceStart:0,symbolInstanceEnd:b.symbolInstances.length,parameters:ze})}attemptAnchorPlacement(n,a,f,g,y,b,E,A,R,D,F,N,j,X,W,K,ee,ie){const{textOffset0:fe,textOffset1:_e,crossTileID:we}=N,be=[fe,_e],ve=Nr(n,f,g,be,y),ye=this.collisionIndex.placeCollisionBox(X,y,a,br(ve.x,ve.y,b,E,this.transform.angle),F,A,R,D.predicate);if(K){const Se=X.getSymbolInstanceIconSize(ie,this.transform.zoom,N.placedIconSymbolIndex);if(this.collisionIndex.placeCollisionBox(X,Se,K,br(ve.x,ve.y,b,E,this.transform.angle),F,A,R,D.predicate).box.length===0)return}if(ye.box.length>0){let Se;return this.prevPlacement&&this.prevPlacement.variableOffsets[we]&&this.prevPlacement.placements[we]&&this.prevPlacement.placements[we].text&&(Se=this.prevPlacement.variableOffsets[we].anchor),this.variableOffsets[we]={textOffset:be,width:f,height:g,anchor:n,textScale:y,prevAnchor:Se},this.markUsedJustification(X,n,N,W),X.allowVerticalPlacement&&(this.markUsedOrientation(X,W,N),this.placedOrientations[we]=W),{shift:ve,placedGlyphBoxes:ye}}}placeLayerBucketPart(n,a,f,g,y=1){const{bucket:b,layout:E,paint:A,posMatrix:R,textLabelPlaneMatrix:D,labelToScreenMatrix:F,clippingData:N,textPixelRatio:j,holdingForFade:X,collisionBoxArray:W,partiallyEvaluatedTextSize:K,partiallyEvaluatedIconSize:ee,collisionGroup:ie,latestFeatureIndex:fe}=n.parameters,_e=E.get("text-optional"),we=E.get("icon-optional"),be=E.get("text-allow-overlap"),ve=E.get("icon-allow-overlap"),ye=E.get("text-rotation-alignment")==="map",Se=E.get("text-pitch-alignment")==="map",Ee=A.get("symbol-z-offset"),Fe=E.get("symbol-elevation-reference")==="sea",[je,rt]=E.get("text-size-scale-range"),[it,gt]=E.get("icon-size-scale-range"),ze=s.ay(y,je,rt),Xe=s.ay(y,it,gt);this.transform.setProjection(b.projection);let Re=be&&(ve||!b.hasIconData()||we),ot=ve&&(be||!b.hasTextData()||_e);const Ge=!Ee.isConstant();!b.collisionArrays&&W&&b.deserializeCollisionBoxes(W),f&&g&&b.updateCollisionDebugBuffers(this.transform.zoom,W,ze,Xe);const dt=(st,Tt,qt)=>{const{crossTileID:Wt,numVerticalGlyphVertices:Vt}=st;let tn=null;if(N&&N.dynamicFilterNeedsFeature||Ge){const Gr=this.retainedQueryData[b.bucketInstanceId];tn=fe.loadFeature({featureIndex:st.featureIndex,bucketIndex:Gr.bucketIndex,sourceLayerIndex:Gr.sourceLayerIndex,layoutVertexArrayOffset:0})}if(N&&!(0,N.dynamicFilter)({zoom:this.transform.zoom,pitch:this.transform.pitch},tn,this.retainedQueryData[b.bucketInstanceId].tileID.canonical,new s.P(st.tileAnchorX,st.tileAnchorY),this.transform.calculateDistanceTileData(N.unwrappedTileID)))return this.placements[Wt]=new No(!1,!1,!1,!0),void a.add(Wt);const on=Ee.evaluate(tn,{});if(a.has(Wt))return;if(X)return void(this.placements[Wt]=new No(!1,!1,!1));let cn=!1,wn=!1,Bn=!0,Ar=!1,Zr=!1,kr=null,zr={box:null,offscreen:null,occluded:null},Di={box:null},Dn=null,Gn=null,Jn=null,ri=0,Gi=0,Xr=0;qt.textFeatureIndex?ri=qt.textFeatureIndex:st.useRuntimeCollisionCircles&&(ri=st.featureIndex),qt.verticalTextFeatureIndex&&(Gi=qt.verticalTextFeatureIndex);const yr=Gr=>{Gr.tileID=this.retainedQueryData[b.bucketInstanceId].tileID;const si=this.transform.elevation;Gr.elevation=Fe?on:on+(si?si.getAtTileOffset(Gr.tileID,Gr.tileAnchorX,Gr.tileAnchorY):0),Gr.elevation+=st.zOffset},Ei=qt.textBox;if(Ei){yr(Ei);const Gr=wr=>{let Ii=s.bI.horizontal;if(b.allowVerticalPlacement&&!wr&&this.prevPlacement){const ws=this.prevPlacement.placedOrientations[Wt];ws&&(this.placedOrientations[Wt]=ws,Ii=ws,this.markUsedOrientation(b,Ii,st))}return Ii},si=(wr,Ii)=>{if(b.allowVerticalPlacement&&Vt>0&&qt.verticalTextBox){for(const ws of b.writingModes)if(ws===s.bI.vertical?(zr=Ii(),Di=zr):zr=wr(),zr&&zr.box&&zr.box.length)break}else zr=wr()};if(E.get("text-variable-anchor")){let wr=E.get("text-variable-anchor");if(this.prevPlacement&&this.prevPlacement.variableOffsets[Wt]){const di=this.prevPlacement.variableOffsets[Wt];wr.indexOf(di.anchor)>0&&(wr=wr.filter(gr=>gr!==di.anchor),wr.unshift(di.anchor))}const Ii=(di,gr,wo)=>{const lo=b.getSymbolInstanceTextSize(K,st,this.transform.zoom,Tt),Fo=(di.x2-di.x1)*lo+2*di.padding,xa=(di.y2-di.y1)*lo+2*di.padding,ra=st.hasIconTextFit&&!ve?gr:null;ra&&yr(ra);let co={box:[],offscreen:!1,occluded:!1};const dc=be?2*wr.length:wr.length;for(let ba=0;ba<dc;++ba){const hc=this.attemptAnchorPlacement(wr[ba%wr.length],di,Fo,xa,lo,ye,Se,j,R,ie,ba>=wr.length,st,Tt,b,wo,ra,K,ee);if(hc&&(co=hc.placedGlyphBoxes,co&&co.box&&co.box.length)){cn=!0,kr=hc.shift;break}}return co};si(()=>Ii(Ei,qt.iconBox,s.bI.horizontal),()=>{const di=qt.verticalTextBox;return di&&yr(di),b.allowVerticalPlacement&&!(zr&&zr.box&&zr.box.length)&&Vt>0&&di?Ii(di,qt.verticalIconBox,s.bI.vertical):{box:null,offscreen:null,occluded:null}}),zr&&(cn=zr.box,Bn=zr.offscreen,Ar=zr.occluded);const ws=Gr(!(!zr||!zr.box));if(!cn&&this.prevPlacement){const di=this.prevPlacement.variableOffsets[Wt];di&&(this.variableOffsets[Wt]=di,this.markUsedJustification(b,di.anchor,st,ws))}}else{const wr=(Ii,ws)=>{const di=b.getSymbolInstanceTextSize(K,st,this.transform.zoom,Tt,y),gr=this.collisionIndex.placeCollisionBox(b,di,Ii,new s.P(0,0),be,j,R,ie.predicate);return gr&&gr.box&&gr.box.length&&(this.markUsedOrientation(b,ws,st),this.placedOrientations[Wt]=ws),gr};si(()=>wr(Ei,s.bI.horizontal),()=>{const Ii=qt.verticalTextBox;return b.allowVerticalPlacement&&Vt>0&&Ii?(yr(Ii),wr(Ii,s.bI.vertical)):{box:null,offscreen:null,occluded:null}}),Gr(!!(zr&&zr.box&&zr.box.length))}}if(Dn=zr,cn=Dn&&Dn.box&&Dn.box.length>0,Bn=Dn&&Dn.offscreen,Ar=Dn&&Dn.occluded,st.useRuntimeCollisionCircles){const Gr=b.text.placedSymbolArray.get(st.centerJustifiedTextSymbolIndex>=0?st.centerJustifiedTextSymbolIndex:st.verticalPlacedTextSymbolIndex),si=s.bJ(b.textSizeData,K,Gr),wr=E.get("text-padding");Gn=this.collisionIndex.placeCollisionCircles(b,be,Gr,b.lineVertexArray,b.glyphOffsetArray,si,R,D,F,f,Se,ie.predicate,st.collisionCircleDiameter*si/s.bO,wr,this.retainedQueryData[b.bucketInstanceId].tileID),cn=be||Gn.circles.length>0&&!Gn.collisionDetected,Bn=Bn&&Gn.offscreen,Ar=Gn.occluded}if(qt.iconFeatureIndex&&(Xr=qt.iconFeatureIndex),qt.iconBox){const Gr=si=>{yr(si);const wr=st.hasIconTextFit&&kr?br(kr.x,kr.y,ye,Se,this.transform.angle):new s.P(0,0),Ii=b.getSymbolInstanceIconSize(ee,this.transform.zoom,st.placedIconSymbolIndex);return this.collisionIndex.placeCollisionBox(b,Ii,si,wr,ve,j,R,ie.predicate)};Di&&Di.box&&Di.box.length&&qt.verticalIconBox?(Jn=Gr(qt.verticalIconBox),wn=Jn.box.length>0):(Jn=Gr(qt.iconBox),wn=Jn.box.length>0),Bn=Bn&&Jn.offscreen,Zr=Jn.occluded}const lr=_e||st.numHorizontalGlyphVertices===0&&Vt===0,Bi=we||st.numIconVertices===0;if(lr||Bi?Bi?lr||(wn=wn&&cn):cn=wn&&cn:wn=cn=wn&&cn,cn&&Dn&&Dn.box&&this.collisionIndex.insertCollisionBox(Dn.box,E.get("text-ignore-placement"),b.bucketInstanceId,Di&&Di.box&&Gi?Gi:ri,ie.ID),wn&&Jn&&this.collisionIndex.insertCollisionBox(Jn.box,E.get("icon-ignore-placement"),b.bucketInstanceId,Xr,ie.ID),Gn&&(cn&&this.collisionIndex.insertCollisionCircles(Gn.circles,E.get("text-ignore-placement"),b.bucketInstanceId,ri,ie.ID),f)){const Gr=b.bucketInstanceId;let si=this.collisionCircleArrays[Gr];si===void 0&&(si=this.collisionCircleArrays[Gr]=new x_);for(let wr=0;wr<Gn.circles.length;wr+=4)si.circles.push(Gn.circles[wr+0]),si.circles.push(Gn.circles[wr+1]),si.circles.push(Gn.circles[wr+2]),si.circles.push(Gn.collisionDetected?1:0)}const ii=b.projection.name!=="globe";Re=Re&&(ii||!Ar),ot=ot&&(ii||!Zr),this.placements[Wt]=new No(cn||Re,wn||ot,Bn||b.justReloaded),a.add(Wt)},At=this.retainedQueryData[b.bucketInstanceId].tileID;if(b.elevationType==="offset"&&this.buildingIndex&&this.buildingIndex.updateZOffset(b,At),b.elevationType==="road"&&b.updateRoadElevation(At.canonical),b.updateZOffset(),b.sortFeaturesByY){const st=b.getSortedSymbolIndexes(this.transform.angle);for(let Tt=st.length-1;Tt>=0;--Tt){const qt=st[Tt];dt(b.symbolInstances.get(qt),qt,b.collisionArrays[qt])}b.hasAnyZOffset&&s.w(`${b.layerIds[0]} layer symbol-z-elevate: symbols are not sorted by elevation if symbol-z-order is evaluated to viewport-y`)}else if(b.hasAnyZOffset){const st=b.getSortedIndexesByZOffset();for(let Tt=0;Tt<st.length;++Tt){const qt=st[Tt];dt(b.symbolInstances.get(qt),qt,b.collisionArrays[qt])}}else for(let st=n.symbolInstanceStart;st<n.symbolInstanceEnd;st++)dt(b.symbolInstances.get(st),st,b.collisionArrays[st]);if(f&&b.bucketInstanceId in this.collisionCircleArrays){const st=this.collisionCircleArrays[b.bucketInstanceId];s.bi(st.invProjMatrix,R),st.viewportMatrix=this.collisionIndex.getViewportMatrix()}b.justReloaded=!1}markUsedJustification(n,a,f,g){const{leftJustifiedTextSymbolIndex:y,centerJustifiedTextSymbolIndex:b,rightJustifiedTextSymbolIndex:E,verticalPlacedTextSymbolIndex:A,crossTileID:R}=f,D=s.bV(a),F=g===s.bI.vertical?A:D==="left"?y:D==="center"?b:D==="right"?E:-1;y>=0&&(n.text.placedSymbolArray.get(y).crossTileID=F>=0&&y!==F?0:R),b>=0&&(n.text.placedSymbolArray.get(b).crossTileID=F>=0&&b!==F?0:R),E>=0&&(n.text.placedSymbolArray.get(E).crossTileID=F>=0&&E!==F?0:R),A>=0&&(n.text.placedSymbolArray.get(A).crossTileID=F>=0&&A!==F?0:R)}markUsedOrientation(n,a,f){const g=a===s.bI.horizontal||a===s.bI.horizontalOnly?a:0,y=a===s.bI.vertical?a:0,{leftJustifiedTextSymbolIndex:b,centerJustifiedTextSymbolIndex:E,rightJustifiedTextSymbolIndex:A,verticalPlacedTextSymbolIndex:R}=f,D=n.text.placedSymbolArray;b>=0&&(D.get(b).placedOrientation=g),E>=0&&(D.get(E).placedOrientation=g),A>=0&&(D.get(A).placedOrientation=g),R>=0&&(D.get(R).placedOrientation=y)}commit(n){this.commitTime=n,this.zoomAtLastRecencyCheck=this.transform.zoom;const a=this.prevPlacement;let f=!1;this.prevZoomAdjustment=a?a.zoomAdjustment(this.transform.zoom):0;const g=a?a.symbolFadeChange(n):1,y=a?a.opacities:{},b=a?a.variableOffsets:{},E=a?a.placedOrientations:{};for(const A in this.placements){const R=this.placements[A],D=y[A];D?(this.opacities[A]=new qc(D,g,R.text,R.icon,null,R.clipped),f=f||R.text!==D.text.placed||R.icon!==D.icon.placed):(this.opacities[A]=new qc(null,g,R.text,R.icon,R.skipFade,R.clipped),f=f||R.text||R.icon)}for(const A in y){const R=y[A];if(!this.opacities[A]){const D=new qc(R,g,!1,!1);D.isHidden()||(this.opacities[A]=D,f=f||R.text.placed||R.icon.placed)}}for(const A in b)this.variableOffsets[A]||!this.opacities[A]||this.opacities[A].isHidden()||(this.variableOffsets[A]=b[A]);for(const A in E)this.placedOrientations[A]||!this.opacities[A]||this.opacities[A].isHidden()||(this.placedOrientations[A]=E[A]);f?this.lastPlacementChangeTime=n:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=a?a.lastPlacementChangeTime:n)}updateLayerOpacities(n,a,f,g){const y=new Set;for(const b of a){const E=b.getBucket(n);E&&b.latestFeatureIndex&&n.fqid===E.layerIds[0]&&(this.updateBucketOpacities(E,y,b,b.collisionBoxArray,f,g,b.tileID,n.scope),E.elevationType==="offset"&&this.buildingIndex&&this.buildingIndex.updateZOffset(E,b.tileID),E.elevationType==="road"&&E.updateRoadElevation(b.tileID.canonical),E.updateZOffset())}}updateBucketOpacities(n,a,f,g,y,b,E,A){n.hasTextData()&&n.text.opacityVertexArray.clear(),n.hasIconData()&&n.icon.opacityVertexArray.clear(),n.hasIconCollisionBoxData()&&n.iconCollisionBox.collisionVertexArray.clear(),n.hasTextCollisionBoxData()&&n.textCollisionBox.collisionVertexArray.clear();const R=n.layers[0].layout,D=n.layers[0].paint,F=!!n.layers[0].dynamicFilter(),N=new qc(null,0,!1,!1,!0),j=R.get("text-allow-overlap"),X=R.get("icon-allow-overlap"),W=R.get("text-variable-anchor"),K=R.get("text-rotation-alignment")==="map",ee=R.get("text-pitch-alignment")==="map",ie=D.get("symbol-z-offset"),fe=R.get("symbol-elevation-reference")==="sea",_e=!ie.isConstant(),we=new qc(null,0,j&&(X||!n.hasIconData()||R.get("icon-optional")),X&&(j||!n.hasTextData()||R.get("text-optional")),!0);!n.collisionArrays&&g&&(n.hasIconCollisionBoxData()||n.hasTextCollisionBoxData())&&n.deserializeCollisionBoxes(g);const be=(ye,Se,Ee)=>{for(let Fe=0;Fe<Se/4;Fe++)ye.opacityVertexArray.emplaceBack(Ee)};let ve=0;b&&n.updateReplacement(E,b);for(let ye=0;ye<n.symbolInstances.length;ye++){const Se=n.symbolInstances.get(ye),{numHorizontalGlyphVertices:Ee,numVerticalGlyphVertices:Fe,crossTileID:je,numIconVertices:rt,tileAnchorX:it,tileAnchorY:gt}=Se;let ze=null;const Xe=this.retainedQueryData[n.bucketInstanceId];_e&&Se&&Xe&&(ze=f.latestFeatureIndex.loadFeature({featureIndex:Se.featureIndex,bucketIndex:Xe.bucketIndex,sourceLayerIndex:Xe.sourceLayerIndex,layoutVertexArrayOffset:0}));const Re=ie.evaluate(ze,{}),ot=a.has(je);let Ge=this.opacities[je];ot?Ge=N:Ge||(Ge=we,this.opacities[je]=Ge),a.add(je);const dt=Ee>0||Fe>0,At=rt>0,st=this.placedOrientations[je],Tt=st===s.bI.vertical,qt=st===s.bI.horizontal||st===s.bI.horizontalOnly;!dt&&!At||Ge.isHidden()||ve++;let Wt=!1;if((dt||At)&&b)for(const Vt of n.activeReplacements){if(s.bP(Vt,y,s.bQ.Symbol,A)||Vt.min.x>it||it>Vt.max.x||Vt.min.y>gt||gt>Vt.max.y)continue;const tn=s.bR(it,gt,E.canonical,Vt.footprintTileId.canonical);if(Wt=s.bS(tn,Vt.footprint),Wt)break}if(dt){const Vt=Wt?Yl:Ou(Ge.text);be(n.text,Ee,Tt?Yl:Vt),be(n.text,Fe,qt?Yl:Vt);const tn=Ge.text.isHidden(),{leftJustifiedTextSymbolIndex:on,centerJustifiedTextSymbolIndex:cn,rightJustifiedTextSymbolIndex:wn,verticalPlacedTextSymbolIndex:Bn}=Se,Ar=n.text.placedSymbolArray,Zr=tn||Tt?1:0;on>=0&&(Ar.get(on).hidden=Zr),cn>=0&&(Ar.get(cn).hidden=Zr),wn>=0&&(Ar.get(wn).hidden=Zr),Bn>=0&&(Ar.get(Bn).hidden=tn||qt?1:0);const kr=this.variableOffsets[je];kr&&this.markUsedJustification(n,kr.anchor,Se,st);const zr=this.placedOrientations[je];zr&&(this.markUsedJustification(n,"left",Se,zr),this.markUsedOrientation(n,zr,Se))}if(At){const Vt=Wt?Yl:Ou(Ge.icon),{placedIconSymbolIndex:tn,verticalPlacedIconSymbolIndex:on}=Se,cn=n.icon.placedSymbolArray,wn=Ge.icon.isHidden()?1:0;tn>=0&&(be(n.icon,rt,Tt?Yl:Vt),cn.get(tn).hidden=wn),on>=0&&(be(n.icon,Se.numVerticalIconVertices,qt?Yl:Vt),cn.get(on).hidden=wn)}if(n.hasIconCollisionBoxData()||n.hasTextCollisionBoxData()){const Vt=n.collisionArrays[ye];if(Vt){let tn=new s.P(0,0),on=!0;if(Vt.textBox||Vt.verticalTextBox){if(W){const wn=this.variableOffsets[je];wn?(tn=Nr(wn.anchor,wn.width,wn.height,wn.textOffset,wn.textScale),K&&tn._rotate(ee?this.transform.angle:-this.transform.angle)):on=!1}F&&(on=!Ge.clipped),Vt.textBox&&al(n.textCollisionBox.collisionVertexArray,Ge.text.placed,!on||Tt,Re,fe,tn.x,tn.y),Vt.verticalTextBox&&al(n.textCollisionBox.collisionVertexArray,Ge.text.placed,!on||qt,Re,fe,tn.x,tn.y)}const cn=on&&!!(!qt&&Vt.verticalIconBox);Vt.iconBox&&al(n.iconCollisionBox.collisionVertexArray,Ge.icon.placed,cn,Re,fe,Se.hasIconTextFit?tn.x:0,Se.hasIconTextFit?tn.y:0),Vt.verticalIconBox&&al(n.iconCollisionBox.collisionVertexArray,Ge.icon.placed,!cn,Re,fe,Se.hasIconTextFit?tn.x:0,Se.hasIconTextFit?tn.y:0)}}}if(n.fullyClipped=ve===0,n.sortFeatures(this.transform.angle),this.retainedQueryData[n.bucketInstanceId]&&(this.retainedQueryData[n.bucketInstanceId].featureSortOrder=n.featureSortOrder),n.hasTextData()&&n.text.opacityVertexBuffer&&n.text.opacityVertexBuffer.updateData(n.text.opacityVertexArray),n.hasIconData()&&n.icon.opacityVertexBuffer&&n.icon.opacityVertexBuffer.updateData(n.icon.opacityVertexArray),n.hasIconCollisionBoxData()&&n.iconCollisionBox.collisionVertexBuffer&&n.iconCollisionBox.collisionVertexBuffer.updateData(n.iconCollisionBox.collisionVertexArray),n.hasTextCollisionBoxData()&&n.textCollisionBox.collisionVertexBuffer&&n.textCollisionBox.collisionVertexBuffer.updateData(n.textCollisionBox.collisionVertexArray),n.bucketInstanceId in this.collisionCircleArrays){const ye=this.collisionCircleArrays[n.bucketInstanceId];n.placementInvProjMatrix=ye.invProjMatrix,n.placementViewportMatrix=ye.viewportMatrix,n.collisionCircleArray=ye.circles,delete this.collisionCircleArrays[n.bucketInstanceId]}}symbolFadeChange(n){return this.fadeDuration===0?1:(n-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(n){return Math.max(0,(this.transform.zoom-n)/1.5)}hasTransitions(n){return this.stale||n-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(n,a){const f=this.zoomAtLastRecencyCheck===a?1-this.zoomAdjustment(a):1;return this.zoomAtLastRecencyCheck=a,this.commitTime+this.fadeDuration*f>n}setStale(){this.stale=!0}}function al(h,n,a,f,g,y,b){h.emplaceBack(n?1:0,a?1:0,y||0,b||0,f,g?1:0),h.emplaceBack(n?1:0,a?1:0,y||0,b||0,f,g?1:0),h.emplaceBack(n?1:0,a?1:0,y||0,b||0,f,g?1:0),h.emplaceBack(n?1:0,a?1:0,y||0,b||0,f,g?1:0)}const Cr=Math.pow(2,25),Dp=Math.pow(2,24),Fh=Math.pow(2,17),jh=Math.pow(2,16),Xs=Math.pow(2,9),qi=Math.pow(2,8),L2=Math.pow(2,1);function Ou(h){if(h.opacity===0&&!h.placed)return 0;if(h.opacity===1&&h.placed)return 4294967295;const n=h.placed?1:0,a=Math.floor(127*h.opacity);return a*Cr+n*Dp+a*Fh+n*jh+a*Xs+n*qi+a*L2+n}const Yl=0;class Bh{constructor(n){this._sortAcrossTiles=n.layout.get("symbol-z-order")!=="viewport-y"&&n.layout.get("symbol-sort-key").constantOr(1)!==void 0,this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs=new Set,this._bucketParts=[]}continuePlacement(n,a,f,g,y,b){const E=this._bucketParts;for(;this._currentTileIndex<n.length;)if(a.getBucketParts(E,g,n[this._currentTileIndex],this._sortAcrossTiles,b),this._currentTileIndex++,y())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,E.sort((A,R)=>A.sortKey-R.sortKey));this._currentPartIndex<E.length;){const A=E[this._currentPartIndex];if(a.placeLayerBucketPart(A,this._seenCrossTileIDs,f,A.symbolInstanceStart===0,b),this._currentPartIndex++,y())return!0}return!1}}class Lp{constructor(n,a,f,g,y,b,E,A,R){this.placement=new xo(n,y,b,E,A,R),this._currentPlacementIndex=a.length-1,this._forceFullPlacement=f,this._showCollisionBoxes=g,this._done=!1}isDone(){return this._done}continuePlacement(n,a,f,g,y){const b=s.q.now(),E=()=>{const A=s.q.now()-b;return!this._forceFullPlacement&&A>2};for(;this._currentPlacementIndex>=0;){const A=a[n[this._currentPlacementIndex]],R=this.placement.collisionIndex.transform.zoom;if(A.type==="symbol"&&(!A.minzoom||A.minzoom<=R)&&(!A.maxzoom||A.maxzoom>R)){const D=A,F=D.layout.get("symbol-z-elevate"),N=D.layout.get("symbol-sort-key").constantOr(1)!==void 0,j=D.layout.get("symbol-z-order"),X=j==="viewport-y"||j==="auto"&&!(j!=="viewport-y"&&N),W=D.layout.get("text-allow-overlap")||D.layout.get("icon-allow-overlap")||D.layout.get("text-ignore-placement")||D.layout.get("icon-ignore-placement"),K=X&&W,ee=this._inProgressLayer=this._inProgressLayer||new Bh(D),ie=s.C(A.source,A.scope);if(ee.continuePlacement(F||K?g[ie]:f[ie],this.placement,this._showCollisionBoxes,A,E,y))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(n){return this.placement.commit(n),this.placement}}const Vh=512/s.aj/2;class Np{constructor(n,a,f){this.tileID=n,this.bucketInstanceId=f,this.index=new s.bW(a.length,16,Int32Array),this.keys=[],this.crossTileIDs=[];const g=n.canonical.x*s.aj,y=n.canonical.y*s.aj;for(let b=0;b<a.length;b++){const{key:E,crossTileID:A,tileAnchorX:R,tileAnchorY:D}=a.get(b),F=Math.floor((g+R)*Vh),N=Math.floor((y+D)*Vh);this.index.add(F,N),this.keys.push(E),this.crossTileIDs.push(A)}this.index.finish()}findMatches(n,a,f){const g=this.tileID.canonical.z<a.canonical.z?1:Math.pow(2,this.tileID.canonical.z-a.canonical.z),y=Vh/Math.pow(2,a.canonical.z-this.tileID.canonical.z),b=a.canonical.x*s.aj,E=a.canonical.y*s.aj;for(let A=0;A<n.length;A++){const R=n.get(A);if(R.crossTileID)continue;const{key:D,tileAnchorX:F,tileAnchorY:N}=R,j=Math.floor((b+F)*y),X=Math.floor((E+N)*y),W=this.index.range(j-g,X-g,j+g,X+g).sort((K,ee)=>K-ee);for(const K of W){const ee=this.crossTileIDs[K];if(this.keys[K]===D&&!f.has(ee)){f.add(ee),R.crossTileID=ee;break}}}}}class Ys{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class ll{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(n){const a=Math.round((n-this.lng)/360);if(a!==0)for(const f in this.indexes){const g=this.indexes[f],y={};for(const b in g){const E=g[b];E.tileID=E.tileID.unwrapTo(E.tileID.wrap+a),y[E.tileID.key]=E}this.indexes[f]=y}this.lng=n}addBucket(n,a,f){if(this.indexes[n.overscaledZ]&&this.indexes[n.overscaledZ][n.key]){if(this.indexes[n.overscaledZ][n.key].bucketInstanceId===a.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(n.overscaledZ,this.indexes[n.overscaledZ][n.key])}for(let y=0;y<a.symbolInstances.length;y++)a.symbolInstances.get(y).crossTileID=0;this.usedCrossTileIDs[n.overscaledZ]||(this.usedCrossTileIDs[n.overscaledZ]=new Set);const g=this.usedCrossTileIDs[n.overscaledZ];for(const y in this.indexes){const b=this.indexes[y];if(Number(y)>n.overscaledZ)for(const E in b){const A=b[E];A.tileID.isChildOf(n)&&A.findMatches(a.symbolInstances,n,g)}else{const E=b[n.scaledTo(Number(y)).key];E&&E.findMatches(a.symbolInstances,n,g)}}for(let y=0;y<a.symbolInstances.length;y++){const b=a.symbolInstances.get(y);b.crossTileID||(b.crossTileID=f.generate(),g.add(b.crossTileID))}return this.indexes[n.overscaledZ]===void 0&&(this.indexes[n.overscaledZ]={}),this.indexes[n.overscaledZ][n.key]=new Np(n,a.symbolInstances,a.bucketInstanceId),!0}removeBucketCrossTileIDs(n,a){for(const f of a.crossTileIDs)this.usedCrossTileIDs[n].delete(f)}removeStaleBuckets(n){let a=!1;for(const f in this.indexes){const g=this.indexes[f];for(const y in g)n[g[y].bucketInstanceId]||(this.removeBucketCrossTileIDs(f,g[y]),delete g[y],a=!0)}return a}}class ao{constructor(){this.layerIndexes={},this.crossTileIDs=new Ys,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(n,a,f,g){let y=this.layerIndexes[n.fqid];y===void 0&&(y=this.layerIndexes[n.fqid]=new ll);let b=!1;const E={};g.name!=="globe"&&y.handleWrapJump(f);for(const A of a){const R=A.getBucket(n);R&&n.fqid===R.layerIds[0]&&(R.bucketInstanceId||(R.bucketInstanceId=++this.maxBucketInstanceId),y.addBucket(A.tileID,R,this.crossTileIDs)&&(b=!0),E[R.bucketInstanceId]=!0)}return y.removeStaleBuckets(E)&&(b=!0),b}pruneUnusedLayers(n){const a={};n.forEach(f=>{a[f]=!0});for(const f in this.layerIndexes)a[f]||delete this.layerIndexes[f]}}const Wc=771;class Zn{constructor(n,a,f,g){this.blendFunction=n,this.blendColor=a.toNonPremultipliedRenderColor(null),this.mask=f,this.blendEquation=g}}Zn.Replace=[1,0,1,0],Zn.disabled=new Zn(Zn.Replace,s.am.transparent,[!1,!1,!1,!1]),Zn.unblended=new Zn(Zn.Replace,s.am.transparent,[!0,!0,!0,!0]),Zn.alphaBlended=new Zn([1,Wc,1,Wc],s.am.transparent,[!0,!0,!0,!0]),Zn.alphaBlendedNonPremultiplied=new Zn([770,Wc,770,Wc],s.am.transparent,[!0,!0,!0,!0]),Zn.multiply=new Zn([774,0,774,0],s.am.transparent,[!0,!0,!0,!0]);class Gt{constructor(n,a,f){this.func=n,this.mask=a,this.range=f}}Gt.ReadOnly=!1,Gt.ReadWrite=!0,Gt.disabled=new Gt(519,Gt.ReadOnly,[0,1]);const Qo=7680;class En{constructor(n,a,f,g,y,b){this.test=n,this.ref=a,this.mask=f,this.fail=g,this.depthFail=y,this.pass=b}}En.disabled=new En({func:519,mask:0},0,0,Qo,Qo,Qo);const $i=1029,Uh=2305;class _n{constructor(n,a,f){this.enable=n,this.mode=a,this.frontFace=f}}function Fu(h,n){const a=s.c1(h,3);s.c3(h,n),s.c7(h,3,a)}function ju(h,n){const a=s.b_([]);return s.b$(a,a,-n),s.c0(a,a,-h),a}function Kl(h,n){const a=[h[0],h[1],0],f=[n[0],n[1],0];if(s.ae(a)>=1e-15){const b=s.au([],a);s.bY(f,b,s.bG(f,b)),n[0]=f[0],n[1]=f[1]}const g=s.bF([],n,h);if(s.bZ(g)<1e-15)return null;const y=Math.atan2(-g[1],g[0]);return ju(Math.atan2(Math.sqrt(h[0]*h[0]+h[1]*h[1]),-h[2]),y)}_n.disabled=new _n(!1,$i,Uh),_n.backCCW=new _n(!0,$i,Uh),_n.backCW=new _n(!0,$i,2304),_n.frontCW=new _n(!0,1028,2304),_n.frontCCW=new _n(!0,1028,Uh);class Wx{constructor(n,a){this.position=n,this.orientation=a}get position(){return this._position}set position(n){if(n){const a=n instanceof s.ac?n:new s.ac(n[0],n[1],n[2]);this._renderWorldCopies&&(a.x=s.bX(a.x,0,1)),this._position=a}else this._position=null}lookAtPoint(n,a){if(this.orientation=null,!this.position)return;const f=this.position,g=this._elevation?this._elevation.getAtPointOrZero(s.ac.fromLngLat(n)):0,y=s.ac.fromLngLat(n,g),b=[y.x-f.x,y.y-f.y,y.z-f.z];a||(a=[0,0,1]),a[2]=Math.abs(a[2]),this.orientation=Kl(b,a)}setPitchBearing(n,a){this.orientation=ju(s.al(n),s.al(-a))}}class Jo{constructor(n,a){this._transform=s.bx([]),this.orientation=a,this.position=n}get mercatorPosition(){const n=this.position;return new s.ac(n[0],n[1],n[2])}get position(){const n=s.c1(this._transform,3);return[n[0],n[1],n[2]]}set position(n){var a;n&&s.c7(this._transform,3,[(a=n)[0],a[1],a[2],1])}get orientation(){return this._orientation}set orientation(n){this._orientation=n||s.b_([]),n&&Fu(this._transform,this._orientation)}getPitchBearing(){const n=this.forward(),a=this.right();return{bearing:Math.atan2(-a[1],a[0]),pitch:Math.atan2(Math.sqrt(n[0]*n[0]+n[1]*n[1]),-n[2])}}setPitchBearing(n,a){this._orientation=ju(n,a),Fu(this._transform,this._orientation)}forward(){const n=s.c1(this._transform,2);return[-n[0],-n[1],-n[2]]}up(){const n=s.c1(this._transform,1);return[-n[0],-n[1],-n[2]]}right(){const n=s.c1(this._transform,0);return[n[0],n[1],n[2]]}getCameraToWorld(n,a){const f=new Float64Array(16);return s.bi(f,this.getWorldToCamera(n,a)),f}getCameraToWorldMercator(){return this._transform}getWorldToCameraPosition(n,a,f){const g=this.position;s.bY(g,g,-n);const y=new Float64Array(16);return s.bn(y,[f,f,f]),s.bo(y,y,g),y[10]*=a,y}getWorldToCamera(n,a){const f=new Float64Array(16),g=new Float64Array(4),y=this.position;return s.c2(g,this._orientation),s.bY(y,y,-n),s.c3(f,g),s.bo(f,f,y),f[1]*=-1,f[5]*=-1,f[9]*=-1,f[13]*=-1,f[8]*=a,f[9]*=a,f[10]*=a,f[11]*=a,f}getCameraToClipPerspective(n,a,f,g){const y=new Float64Array(16);return s.c4(y,n,a,f,g),y}getCameraToClipOrthographic(n,a,f,g,y,b){const E=new Float64Array(16);return s.c5(E,n,a,f,g,y,b),E}getDistanceToElevation(n,a=!1){const f=n===0?0:s.c6(n,a?s.aY(this.position[1]):this.position[1]),g=this.forward();return(f-this.position[2])/g[2]}clone(){return new Jo([...this.position],[...this.orientation])}}const Ks={BaseColor:5,MetallicRoughness:6,Normal:7,Occlusion:8,Emission:9,LUT:10,ShadowMap0:11};class $h{constructor(n=0,a=0,f=0,g=0){if(isNaN(n)||n<0||isNaN(a)||a<0||isNaN(f)||f<0||isNaN(g)||g<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=n,this.bottom=a,this.left=f,this.right=g}interpolate(n,a,f){return a.top!=null&&n.top!=null&&(this.top=s.ai(n.top,a.top,f)),a.bottom!=null&&n.bottom!=null&&(this.bottom=s.ai(n.bottom,a.bottom,f)),a.left!=null&&n.left!=null&&(this.left=s.ai(n.left,a.left,f)),a.right!=null&&n.right!=null&&(this.right=s.ai(n.right,a.right,f)),this}getCenter(n,a){const f=s.ay((this.left+n-this.right)/2,0,n),g=s.ay((this.top+a-this.bottom)/2,0,a);return new s.P(f,g)}equals(n){return this.top===n.top&&this.bottom===n.bottom&&this.left===n.left&&this.right===n.right}clone(){return new $h(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}const ps=15;class b_{constructor(n,a,f,g,y,b,E){this.tileSize=512,this._renderWorldCopies=y===void 0||y,this._minZoom=n||0,this._maxZoom=a||22,this._minPitch=f??0,this._maxPitch=g??60,this.setProjection(b),this.setMaxBounds(E),this.width=0,this.height=0,this._center=new s.cd(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._nearZ=0,this._farZ=0,this._unmodified=!0,this._edgeInsets=new $h,this._projMatrixCache={},this._alignedProjMatrixCache={},this._fogTileMatrixCache={},this._expandedProjMatrixCache={},this._distanceTileDataCache={},this._camera=new Jo,this._centerAltitude=0,this._averageElevation=0,this.cameraElevationReference="ground",this._pixelsPerMercatorPixel=1,this.globeRadius=0,this.globeCenterInViewSpace=[0,0,0],this._tileCoverLift=0,this.freezeTileCoverage=!1,this._horizonShift=.1,this._orthographicProjectionAtLowPitch=!1,this._allowWorldUnderZoom=!1}clone(){const n=new b_(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies,this.getProjection(),this.maxBounds);return n._elevation=this._elevation,n._centerAltitude=this._centerAltitude,n._centerAltitudeValidForExaggeration=this._centerAltitudeValidForExaggeration,n.tileSize=this.tileSize,n.mercatorFromTransition=this.mercatorFromTransition,n.width=this.width,n.height=this.height,n.cameraElevationReference=this.cameraElevationReference,n._center=this._center,n._setZoom(this.zoom),n._seaLevelZoom=this._seaLevelZoom,n.angle=this.angle,n._fov=this._fov,n._pitch=this._pitch,n._nearZ=this._nearZ,n._farZ=this._farZ,n._averageElevation=this._averageElevation,n._orthographicProjectionAtLowPitch=this._orthographicProjectionAtLowPitch,n._unmodified=this._unmodified,n._edgeInsets=this._edgeInsets.clone(),n._camera=this._camera.clone(),n._calcMatrices(),n.freezeTileCoverage=this.freezeTileCoverage,n.frustumCorners=this.frustumCorners,n._allowWorldUnderZoom=this._allowWorldUnderZoom,n}get isOrthographic(){return this.projection.name!=="globe"&&this._orthographicProjectionAtLowPitch&&this.pitch<ps}get elevation(){return this._elevation}set elevation(n){this._elevation!==n&&(this._elevation=n,this._updateCameraOnTerrain(),this._calcMatrices())}get depthOcclusionForSymbolsAndCircles(){return this.projection.name!=="globe"&&!this.isOrthographic}updateElevation(n,a=!1){const f=this._elevation&&this._elevation.exaggeration()!==this._centerAltitudeValidForExaggeration;(this._seaLevelZoom==null||f)&&this._updateCameraOnTerrain(),(n||f)&&this._constrainCamera(a),this._calcMatrices()}getProjection(){return s.aF(this.projection,["name","center","parallels"])}setProjection(n){this.projectionOptions=n||{name:"mercator"};const a=this.projection?this.getProjection():void 0;this.projection=s.ce(this.projectionOptions);const f=this.getProjection(),g=!s.bv(a,f);return g&&this._calcMatrices(),this.mercatorFromTransition=!1,g}setOrthographicProjectionAtLowPitch(n){return this._orthographicProjectionAtLowPitch!==n&&(this._orthographicProjectionAtLowPitch=n,this._calcMatrices(),!0)}setMercatorFromTransition(){const n=this.projection.name;this.mercatorFromTransition=!0,this.projectionOptions={name:"mercator"},this.projection=s.ce({name:"mercator"});const a=n!==this.projection.name;return a&&this._calcMatrices(),a}get minZoom(){return this._minZoom}set minZoom(n){this._minZoom!==n&&(this._minZoom=n,this.zoom=Math.max(this.zoom,n))}get maxZoom(){return this._maxZoom}set maxZoom(n){this._maxZoom!==n&&(this._maxZoom=n,this.zoom=Math.min(this.zoom,n))}get minPitch(){return this._minPitch}set minPitch(n){this._minPitch!==n&&(this._minPitch=n,this.pitch=Math.max(this.pitch,n))}get maxPitch(){return this._maxPitch}set maxPitch(n){this._maxPitch!==n&&(this._maxPitch=n,this.pitch=Math.min(this.pitch,n))}get renderWorldCopies(){return this._renderWorldCopies&&this.projection.supportsWorldCopies===!0}set renderWorldCopies(n){n===void 0?n=!0:n===null&&(n=!1),this._renderWorldCopies=n}get worldSize(){return this.tileSize*this.scale}get cameraWorldSizeForFog(){const n=Math.max(this._camera.getDistanceToElevation(this._averageElevation),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(n))}get cameraWorldSize(){const n=Math.max(this._camera.getDistanceToElevation(this._averageElevation,!0),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(n))}get pixelsPerMeter(){return this.projection.pixelsPerMeter(this.center.lat,this.worldSize)}get cameraPixelsPerMeter(){return s.c6(1,this.center.lat)*this.cameraWorldSizeForFog}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new s.P(this.width,this.height)}get bearing(){return s.bX(this.rotation,-180,180)}set bearing(n){this.rotation=n}get rotation(){return-this.angle/Math.PI*180}set rotation(n){const a=-n*Math.PI/180;this.angle!==a&&(this._unmodified=!1,this.angle=a,this._calcMatrices(),this.rotationMatrix=s.cf(),s.cg(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(n){const a=s.ay(n,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==a&&(this._unmodified=!1,this._pitch=a,this._calcMatrices())}get aspect(){return this.width/this.height}get fov(){return this._fov/Math.PI*180}set fov(n){n=Math.max(.01,Math.min(60,n)),this._fov!==n&&(this._unmodified=!1,this._fov=s.al(n),this._calcMatrices())}get fovX(){return this._fov}get fovY(){const n=1/Math.tan(.5*this.fovX);return 2*Math.atan(1/this.aspect/n)}get averageElevation(){return this._averageElevation}set averageElevation(n){this._averageElevation=n,this._calcFogMatrices(),this._distanceTileDataCache={}}get zoom(){return this._zoom}set zoom(n){const a=Math.min(Math.max(n,this.minZoom),this.maxZoom);this._zoom!==a&&(this._unmodified=!1,this._setZoom(a),this._updateSeaLevelZoom(),this._constrain(),this._calcMatrices())}_setZoom(n){this._zoom=n,this.scale=this.zoomScale(n),this.tileZoom=Math.floor(n),this.zoomFraction=n-this.tileZoom}get tileCoverLift(){return this._tileCoverLift}set tileCoverLift(n){this._tileCoverLift!==n&&(this._tileCoverLift=n)}_updateCameraOnTerrain(){const n=this.elevation?this.elevation.getAtPoint(this.locationCoordinate(this.center),Number.NEGATIVE_INFINITY):Number.NEGATIVE_INFINITY,a=this.elevation&&n===Number.NEGATIVE_INFINITY&&this.elevation.visibleDemTiles.length>0&&this.elevation.exaggeration()>0&&this._centerAltitudeValidForExaggeration;if(!this._elevation||n===Number.NEGATIVE_INFINITY&&(!a||!this._centerAltitude))return this._centerAltitude=0,this._seaLevelZoom=null,void(this._centerAltitudeValidForExaggeration=void 0);const f=this._elevation;a||this._centerAltitude&&this._centerAltitudeValidForExaggeration&&f.exaggeration()&&this._centerAltitudeValidForExaggeration!==f.exaggeration()?(this._centerAltitude=this._centerAltitude/this._centerAltitudeValidForExaggeration*f.exaggeration(),this._centerAltitudeValidForExaggeration=f.exaggeration()):(this._centerAltitude=n||0,this._centerAltitudeValidForExaggeration=f.exaggeration()),this._updateSeaLevelZoom()}_updateSeaLevelZoom(){if(this._centerAltitudeValidForExaggeration===void 0)return;const n=Math.max(0,(this.pixelsPerMeter*this._centerAltitude+this.cameraToCenterDistance)/this.worldSize);this._seaLevelZoom=this._zoomFromMercatorZ(n)}sampleAverageElevation(){if(!this._elevation)return 0;const n=this._elevation,a=[[.5,.2],[.3,.5],[.5,.5],[.7,.5],[.5,.8]],f=this.horizonLineFromTop();let g=0,y=0;for(let b=0;b<a.length;b++){const E=new s.P(a[b][0]*this.width,f+a[b][1]*(this.height-f)),A=n.pointCoordinate(E);if(!A)continue;const R=1/Math.hypot(A[0]-this._camera.position[0],A[1]-this._camera.position[1]);g+=A[3]*R,y+=R}return y===0?NaN:g/y}get center(){return this._center}set center(n){n.lat===this._center.lat&&n.lng===this._center.lng||(this._unmodified=!1,this._center=n,this._terrainEnabled()&&(this.cameraElevationReference==="ground"?this._updateCameraOnTerrain():this._updateZoomFromElevation()),this._constrain(),this._calcMatrices())}_updateZoomFromElevation(){if(this._seaLevelZoom==null||!this._elevation)return;const n=this._seaLevelZoom,a=this._elevation.getAtPointOrZero(this.locationCoordinate(this.center)),f=this.pixelsPerMeter/this.worldSize*a,g=this._mercatorZfromZoom(n),y=this._mercatorZfromZoom(this._maxZoom),b=Math.max(g-f,y);this._setZoom(this._zoomFromMercatorZ(b))}get padding(){return this._edgeInsets.toJSON()}set padding(n){this._edgeInsets.equals(n)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,n,1),this._calcMatrices())}computeZoomRelativeTo(n){const a=this.rayIntersectionCoordinate(this.pointRayIntersection(this.centerPoint,n.toAltitude()));let f;f=n.z<this._camera.position[2]?[a.x,a.y,a.z]:[n.x,n.y,n.z];const g=s.ae(s.at([],this._camera.position,f));return s.ay(this._zoomFromMercatorZ(g),this._minZoom,this._maxZoom)}setFreeCameraOptions(n){if(!this.height||!n.position&&!n.orientation)return;this._updateCameraState();let a=!1;if(n.orientation&&!s.ch(n.orientation,this._camera.orientation)&&(a=this._setCameraOrientation(n.orientation)),n.position){const f=[n.position.x,n.position.y,n.position.z];s.ci(f,this._camera.position)||(this._setCameraPosition(f),a=!0)}a&&(this._updateStateFromCamera(),this.recenterOnTerrain())}getFreeCameraOptions(){this._updateCameraState();const n=this._camera.position,a=new Wx;return a.position=new s.ac(n[0],n[1],n[2]),a.orientation=this._camera.orientation,a._elevation=this.elevation,a._renderWorldCopies=this.renderWorldCopies,a}_setCameraOrientation(n){if(!s.cj(n))return!1;s.ck(n,n);const a=s.cl([],[0,0,-1],n),f=s.cl([],[0,-1,0],n);if(f[2]<0)return!1;const g=Kl(a,f);return!!g&&(this._camera.orientation=g,!0)}_setCameraPosition(n){const a=this.zoomScale(this.minZoom)*this.tileSize,f=this.zoomScale(this.maxZoom)*this.tileSize,g=this.cameraToCenterDistance;n[2]=s.ay(n[2],g/f,g/a),this._camera.position=n}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}get fovAboveCenter(){return this._fov*(.5+this.centerOffset.y/this.height)}isPaddingEqual(n){return this._edgeInsets.equals(n)}interpolatePadding(n,a,f){this._unmodified=!1,this._edgeInsets.interpolate(n,a,f),this._constrain(),this._calcMatrices()}coveringZoomLevel(n){const a=(n.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/n.tileSize));return Math.max(0,a)}getVisibleUnwrappedCoordinates(n){const a=[new s.cm(0,n)];if(this.renderWorldCopies){const f=this.pointCoordinate(new s.P(0,0)),g=this.pointCoordinate(new s.P(this.width,0)),y=this.pointCoordinate(new s.P(this.width,this.height)),b=this.pointCoordinate(new s.P(0,this.height)),E=Math.floor(Math.min(f.x,g.x,y.x,b.x)),A=Math.floor(Math.max(f.x,g.x,y.x,b.x)),R=1;for(let D=E-R;D<=A+R;D++)D!==0&&a.push(new s.cm(D,n))}return a}isLODDisabled(n){return(!n||this.pitch<=60)&&this._edgeInsets.top<=this._edgeInsets.bottom&&!this._elevation&&!this.projection.isReprojectedInTileSpace}extendTileCover(n,a,f){let g=[];const y=f!=null,b=!y;if(b&&this.zoom<a||y&&f[0]===0&&f[1]===0)return g;const E=new Set,A=(D,F,N,j,X)=>{const W=s.cK(F,D,N,j,X);E.has(W)||(g.push(new s.aM(D,F,N,j,X)),E.add(W))};for(let D=0;D<n.length;D++){const F=n[D];if(b&&F.canonical.z!==a)continue;const N=F.canonical,j=F.overscaledZ,X=F.wrap,W=1<<N.z,K=N.x+1<W,ee=N.x>0,ie=N.y+1<W,fe=N.y>0,_e=F.wrap-(ee?0:1),we=F.wrap+(K?0:1),be=ee?N.x-1:W-1,ve=K?N.x+1:0;if(y)f[0]<0?(A(j,we,N.z,ve,N.y),f[1]<0&&ie&&(A(j,X,N.z,N.x,N.y+1),A(j,we,N.z,ve,N.y+1)),f[1]>0&&fe&&(A(j,X,N.z,N.x,N.y-1),A(j,we,N.z,ve,N.y-1))):f[0]>0?(A(j,_e,N.z,be,N.y),f[1]<0&&ie&&(A(j,X,N.z,N.x,N.y+1),A(j,_e,N.z,be,N.y+1)),f[1]>0&&fe&&(A(j,X,N.z,N.x,N.y-1),A(j,_e,N.z,be,N.y-1))):f[1]<0&&ie?A(j,X,N.z,N.x,N.y+1):fe&&A(j,X,N.z,N.x,N.y-1);else{const ye=F.visibleQuadrants;1&ye&&(A(j,_e,N.z,be,N.y),fe&&(A(j,X,N.z,N.x,N.y-1),A(j,_e,N.z,be,N.y-1))),2&ye&&(A(j,we,N.z,ve,N.y),fe&&(A(j,X,N.z,N.x,N.y-1),A(j,we,N.z,ve,N.y-1))),4&ye&&(A(j,_e,N.z,be,N.y),ie&&(A(j,X,N.z,N.x,N.y+1),A(j,_e,N.z,be,N.y+1))),8&ye&&(A(j,we,N.z,ve,N.y),ie&&(A(j,X,N.z,N.x,N.y+1),A(j,we,N.z,ve,N.y+1)))}}const R=[];for(const D of g)g.some(F=>D.isChildOf(F))||R.push(D);if(g=R.filter(D=>!n.some(F=>!!(D.overscaledZ<a&&F.isChildOf(D))||D.equals(F)||D.isChildOf(F))),b){const D=1<<a,F=this.projection.name==="globe"?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),N=[D*F.x,D*F.y],j=4,X=j*j;g=g.filter(W=>{const K=W.canonical.x+.5-N[0],ee=W.canonical.y+.5-N[1];return K*K+ee*ee<X})}return g}coveringTiles(n){let a=this.coveringZoomLevel(n);const f=a,g=this.elevation&&this.elevation.exaggeration(),y=g&&!n.isTerrainDEM,b=this.projection.name==="mercator";if(n.minzoom!==void 0&&a<n.minzoom)return[];n.maxzoom!==void 0&&a>n.maxzoom&&(a=n.maxzoom);const E=this.locationCoordinate(this.center),A=this.center.lat,R=1<<a,D=[R*E.x,R*E.y,0],F=this.projection.name==="globe",N=!F,j=s.cn.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,a,N),X=F?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),W=R*s.c6(1,this.center.lat),K=this._camera.position[2]/s.c6(1,this.center.lat),ee=[R*X.x,R*X.y,K*(N?1:W)],ie=F||g,fe=this.cameraToCenterDistance/n.tileSize*(n.roundZoom?1:.502),_e=this.isLODDisabled(!0)?a:0;let we;if(this._elevation&&n.isTerrainDEM)we=1e4*this._elevation.exaggeration();else if(this._elevation){const Re=this._elevation.getMinMaxForVisibleTiles();we=Re?Re.max:this._centerAltitude}else we=this._centerAltitude;const be=n.isTerrainDEM?-we:this._elevation?this._elevation.getMinElevationBelowMSL():0,ve=this.projection.isReprojectedInTileSpace?s.co(this):1,ye=Re=>{const Ge=new s.ac(Re.x+25e-6,Re.y,Re.z),dt=new s.ac(Re.x,Re.y+25e-6,Re.z),At=Re.toLngLat(),st=Ge.toLngLat(),Tt=dt.toLngLat(),qt=this.locationCoordinate(At),Wt=this.locationCoordinate(st),Vt=this.locationCoordinate(Tt),tn=Math.hypot(Wt.x-qt.x,Wt.y-qt.y),on=Math.hypot(Vt.x-qt.x,Vt.y-qt.y);return Math.sqrt(tn*on)*ve/25e-6},Se=Re=>{const ot=we,Ge=be;return{aabb:s.cr(this,R,0,0,0,Re,Ge,ot,this.projection),zoom:0,x:0,y:0,minZ:Ge,maxZ:ot,wrap:Re,fullyVisible:!1}},Ee=[];let Fe=[];const je=a,rt=n.reparseOverscaled?f:a,it=(K-this._centerAltitude)*W,gt=Re=>{if(!this._elevation||!Re.tileID||!b)return;const ot=this._elevation.getMinMaxForTile(Re.tileID),Ge=Re.aabb;ot?(Ge.min[2]=ot.min,Ge.max[2]=ot.max,Ge.center[2]=(Ge.min[2]+Ge.max[2])/2):(Re.shouldSplit=Xe(Re),Re.shouldSplit||(Ge.min[2]=Ge.max[2]=Ge.center[2]=this._centerAltitude))},ze=(Re,ot)=>{if(.707*ot<Re)return 1;const Ge=ot/Re;return Ge/(1.4144271570014144+(Math.pow(1.1,Ge-1.4144271570014144+1)-1)/(1.1-1)-1)},Xe=Re=>{if(Re.zoom<_e)return!0;if(Re.zoom===je)return!1;if(Re.shouldSplit!=null)return Re.shouldSplit;const ot=Re.aabb.distanceX(ee),Ge=Re.aabb.distanceY(ee);let dt=it,At=1;if(F){dt=Re.aabb.distanceZ(ee);const on=Math.pow(2,Re.zoom),cn=s.aY((Re.y+1)/on),wn=s.aY(Re.y/on),Bn=Math.min(Math.max(A,cn),wn),Ar=s.cO(Bn)/s.cO(A);if(At=Bn===A?1/Math.max(1,this._mercatorScaleRatio-.3):Math.min(1,Ar/this._mercatorScaleRatio),this.zoom<=s.cL&&Re.zoom===je-1&&Ar>=.9)return!0}else if(y&&(dt=Re.aabb.distanceZ(ee)*W),this.projection.isReprojectedInTileSpace&&f<=5){const on=Math.pow(2,Re.zoom),cn=ye(new s.ac((Re.x+.5)/on,(Re.y+.5)/on));At=cn>.85?1:cn}if(!b){const on=Math.sqrt(ot*ot+Ge*Ge+dt*dt);let cn=(1<<je-Re.zoom)*fe*At;return cn*=ze(Math.max(dt,it),on),on<cn}let st=Number.MAX_VALUE,Tt=0;const qt=Re.aabb.getCorners(),Wt=[];for(const on of qt){s.at(Wt,on,ee),F||(y?Wt[2]*=W:Wt[2]=it);const cn=s.bG(Wt,this._camera.forward());cn<st&&(st=cn,Tt=Math.abs(Wt[2]))}let Vt=(1<<je-Re.zoom)*fe*At;if(Vt*=ze(Math.max(Tt,it),st),st<Vt)return!0;const tn=Re.aabb.closestPoint(D);return tn[0]===D[0]&&tn[1]===D[1]};if(this.renderWorldCopies)for(let Re=1;Re<=3;Re++)Ee.push(Se(-Re)),Ee.push(Se(Re));for(Ee.push(Se(0));Ee.length>0;){const Re=Ee.pop(),ot=Re.x,Ge=Re.y;let dt=Re.fullyVisible;const At=()=>this.projection.name==="globe"&&(Re.y===0||Re.y===(1<<Re.zoom)-1);if(!dt){let st=ie?Re.aabb.intersects(j):Re.aabb.intersectsFlat(j);if(st===0&&At()){const Tt=new s.cp(Re.zoom,ot,Ge);st=s.cq(this,R,Tt,!0).intersects(j)}if(st===0)continue;dt=st===2}if(Re.zoom!==je&&Xe(Re))for(let st=0;st<4;st++){const Tt=(ot<<1)+st%2,qt=(Ge<<1)+(st>>1),Wt={aabb:b?Re.aabb.quadrant(st):s.cr(this,R,Re.zoom+1,Tt,qt,Re.wrap,Re.minZ,Re.maxZ,this.projection),zoom:Re.zoom+1,x:Tt,y:qt,wrap:Re.wrap,fullyVisible:dt,tileID:void 0,shouldSplit:void 0,minZ:Re.minZ,maxZ:Re.maxZ};y&&!F&&(Wt.tileID=new s.aM(Re.zoom+1===je?rt:Re.zoom+1,Re.wrap,Re.zoom+1,Tt,qt),gt(Wt)),Ee.push(Wt)}else{const st=Re.zoom===je?rt:Re.zoom;if(n.minzoom&&n.minzoom>st)continue;let Tt=0;if(!dt){let tn=ie?Re.aabb.intersectsPrecise(j):Re.aabb.intersectsPreciseFlat(j);if(tn===0&&At()){const on=new s.cp(Re.zoom,ot,Ge);tn=s.cq(this,R,on,!0).intersectsPrecise(j)}if(tn===0)continue;if(n.calculateQuadrantVisibility)if(j.containsPoint(Re.aabb.center))Tt=15;else for(let on=0;on<4;on++)Re.aabb.quadrant(on).intersects(j)!==0&&(Tt|=1<<on)}const qt=D[0]-(.5+ot+(Re.wrap<<Re.zoom))*(1<<a-Re.zoom),Wt=D[1]-.5-Ge,Vt=Re.tileID?Re.tileID:new s.aM(st,Re.wrap,Re.zoom,ot,Ge);n.calculateQuadrantVisibility&&(Vt.visibleQuadrants=Tt),Fe.push({tileID:Vt,distanceSq:qt*qt+Wt*Wt})}}if(this.fogCullDistSq){const Re=this.fogCullDistSq,ot=this.horizonLineFromTop();Fe=Fe.filter(Ge=>{const dt=[0,0,0,1],At=[s.aj,s.aj,0,1],st=this.calculateFogTileMatrix(Ge.tileID.toUnwrapped());s.aA(dt,dt,st),s.aA(At,At,st);const Tt=s.cs([],dt,At),qt=s.ct([],dt,At),Wt=s.cM(Tt,qt);if(Wt===0)return!0;let Vt=!1;const tn=this._elevation;if(tn&&Wt>Re&&ot!==0){const on=this.calculateProjMatrix(Ge.tileID.toUnwrapped());let cn;n.isTerrainDEM||(cn=tn.getMinMaxForTile(Ge.tileID)),cn||(cn={min:be,max:we});const wn=s.cu(this.rotation),Bn=[wn[0]*s.aj,wn[1]*s.aj,cn.max];s.ad(Bn,Bn,on),Vt=(1-Bn[1])*this.height*.5<ot}return Wt<Re||Vt})}return Fe.sort((Re,ot)=>Re.distanceSq-ot.distanceSq).map(Re=>Re.tileID)}resize(n,a){this.width=n,this.height=a,this.pixelsToGLUnits=[2/n,-2/a],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(n){return Math.pow(2,n)}scaleZoom(n){return Math.log(n)/Math.LN2}project(n){const a=s.ay(n.lat,-85.051129,s.cv),f=this.projection.project(n.lng,a);return new s.P(f.x*this.worldSize,f.y*this.worldSize)}unproject(n){return this.projection.unproject(n.x/this.worldSize,n.y/this.worldSize)}get point(){return this.project(this.center)}get pointMerc(){return this.point._div(this.worldSize)}get pixelsPerMeterRatio(){return this.pixelsPerMeter/s.c6(1,this.center.lat)/this.worldSize}setLocationAtPoint(n,a){let f,g;const y=this.centerPoint;if(this.projection.name==="globe"){const E=this.worldSize;f=(a.x-y.x)/E,g=(a.y-y.y)/E}else{const E=this.pointCoordinate(a),A=this.pointCoordinate(y);f=E.x-A.x,g=E.y-A.y}const b=this.locationCoordinate(n);this.setLocation(new s.ac(b.x-f,b.y-g))}setLocation(n){this.center=this.coordinateLocation(n),this.projection.wrap&&(this.center=this.center.wrap())}locationPoint(n,a){return this.projection.locationPoint(this,n,a)}locationPoint3D(n,a){return this.projection.locationPoint(this,n,a,!0)}pointLocation(n){return this.coordinateLocation(this.pointCoordinate(n))}pointLocation3D(n,a){return this.coordinateLocation(this.pointCoordinate3D(n,a))}locationCoordinate(n,a){const f=a?s.c6(a,n.lat):void 0,g=this.projection.project(n.lng,n.lat);return new s.ac(g.x,g.y,f)}coordinateLocation(n){return this.projection.unproject(n.x,n.y)}pointRayIntersection(n,a){const f=a??this._centerAltitude,g=[n.x,n.y,0,1],y=[n.x,n.y,1,1];s.aA(g,g,this.pixelMatrixInverse),s.aA(y,y,this.pixelMatrixInverse);const b=y[3];s.cw(g,g,1/g[3]),s.cw(y,y,1/b);const E=g[2],A=y[2];return{p0:g,p1:y,t:E===A?0:(f-E)/(A-E)}}screenPointToMercatorRay(n){const a=[n.x,n.y,0,1],f=[n.x,n.y,1,1];return s.aA(a,a,this.pixelMatrixInverse),s.aA(f,f,this.pixelMatrixInverse),s.cw(a,a,1/a[3]),s.cw(f,f,1/f[3]),a[2]=s.c6(a[2],this._center.lat)*this.worldSize,f[2]=s.c6(f[2],this._center.lat)*this.worldSize,s.cw(a,a,1/this.worldSize),s.cw(f,f,1/this.worldSize),new s.av([a[0],a[1],a[2]],s.au([],s.at([],f,a)))}rayIntersectionCoordinate(n){const{p0:a,p1:f,t:g}=n,y=s.c6(a[2],this._center.lat),b=s.c6(f[2],this._center.lat);return new s.ac(s.ai(a[0],f[0],g)/this.worldSize,s.ai(a[1],f[1],g)/this.worldSize,s.ai(y,b,g))}pointCoordinate(n,a=this._centerAltitude){return this.projection.pointCoordinate(this,n.x,n.y,a)}pointCoordinate3D(n,a){if(!this.elevation)return this.pointCoordinate(n,a);let f=this.projection.pointCoordinate3D(this,n.x,n.y);if(f)return new s.ac(f[0],f[1],f[2]);let g=0,y=this.horizonLineFromTop();if(n.y>y)return this.pointCoordinate(n,a);const b=.02*y,E=n.clone();for(let A=0;A<10&&y-g>b;A++){E.y=s.ai(g,y,.66);const R=this.projection.pointCoordinate3D(this,E.x,E.y);R?(y=E.y,f=R):g=E.y}return f?new s.ac(f[0],f[1],f[2]):this.pointCoordinate(n)}isPointAboveHorizon(n){return this.projection.isPointAboveHorizon(this,n)}isPointOnSurface(n){if(n.y<0||n.y>this.height||n.x<0||n.x>this.width)return!1;if(this.elevation||this.zoom>=s.cx)return!this.isPointAboveHorizon(n);const a=this.pointCoordinate(n);return a.y>=0&&a.y<=1}_coordinatePoint(n,a){const f=a&&this.elevation?this.elevation.getAtPointOrZero(n,this._centerAltitude):this._centerAltitude,g=[n.x*this.worldSize,n.y*this.worldSize,f+n.toAltitude(),1];return s.aA(g,g,this.pixelMatrix),g[3]>0?new s.P(g[0]/g[3],g[1]/g[3]):new s.P(Number.MAX_VALUE,Number.MAX_VALUE)}_getBoundsNonRectangular(){const{top:n,left:a}=this._edgeInsets,f=this.height-this._edgeInsets.bottom,g=this.width-this._edgeInsets.right,y=this.pointLocation3D(new s.P(a,n)),b=this.pointLocation3D(new s.P(g,n)),E=this.pointLocation3D(new s.P(g,f)),A=this.pointLocation3D(new s.P(a,f));let R=Math.min(y.lng,b.lng,E.lng,A.lng),D=Math.max(y.lng,b.lng,E.lng,A.lng),F=Math.min(y.lat,b.lat,E.lat,A.lat),N=Math.max(y.lat,b.lat,E.lat,A.lat);const j=Math.pow(2,-this.zoom)/16*270,X=this.projection.name==="globe"?1:4,W=(K,ee,ie,fe,_e)=>{const we=(K+ie)/2,be=(ee+fe)/2,ve=new s.P(we,be),{lng:ye,lat:Se}=this.pointLocation3D(ve),Ee=Math.max(0,R-ye,F-Se,ye-D,Se-N);R=Math.min(R,ye),D=Math.max(D,ye),F=Math.min(F,Se),N=Math.max(N,Se),(_e<X||Ee>j)&&(W(K,ee,we,be,_e+1),W(we,be,ie,fe,_e+1))};if(W(a,n,g,n,1),W(g,n,g,f,1),W(g,f,a,f,1),W(a,f,a,n,1),this.projection.name==="globe"){const[K,ee]=s.cy(this);K?(N=90,D=180,R=-180):ee&&(F=-90,D=180,R=-180)}return new s.aG(new s.cd(R,F),new s.cd(D,N))}_getBoundsRectangular(n,a){const{top:f,left:g}=this._edgeInsets,y=this.height-this._edgeInsets.bottom,b=this.width-this._edgeInsets.right,E=new s.P(g,f),A=new s.P(b,f),R=new s.P(b,y),D=new s.P(g,y);let F=this.pointCoordinate(E,n),N=this.pointCoordinate(A,n);const j=this.pointCoordinate(R,a),X=this.pointCoordinate(D,a),W=(K,ee)=>(ee.y-K.y)/(ee.x-K.x);return F.y>1&&N.y>=0?F=new s.ac((1-X.y)/W(X,F)+X.x,1):F.y<0&&N.y<=1&&(F=new s.ac(-X.y/W(X,F)+X.x,0)),N.y>1&&F.y>=0?N=new s.ac((1-j.y)/W(j,N)+j.x,1):N.y<0&&F.y<=1&&(N=new s.ac(-j.y/W(j,N)+j.x,0)),new s.aG().extend(this.coordinateLocation(F)).extend(this.coordinateLocation(N)).extend(this.coordinateLocation(X)).extend(this.coordinateLocation(j))}_getBoundsRectangularTerrain(){const n=this.elevation;if(!n.visibleDemTiles.length||n.isUsingMockSource())return this._getBoundsRectangular(0,0);const a=n.visibleDemTiles.reduce((f,g)=>{if(g.dem){const y=g.dem.tree;f.min=Math.min(f.min,y.minimums[0]),f.max=Math.max(f.max,y.maximums[0])}return f},{min:Number.MAX_VALUE,max:0});return this._getBoundsRectangular(a.min*n.exaggeration(),a.max*n.exaggeration())}getBounds(){return this.projection.name==="mercator"||this.projection.name==="equirectangular"?this._terrainEnabled()?this._getBoundsRectangularTerrain():this._getBoundsRectangular(0,0):this._getBoundsNonRectangular()}horizonLineFromTop(n=!0){const a=this.height/2/Math.tan(this._fov/2)/Math.tan(Math.max(this._pitch,.1))-this.centerOffset.y,f=this.height/2-a*(1-this._horizonShift);return n?Math.max(0,f):f}getMaxBounds(){return this.maxBounds}setMaxBounds(n){this.maxBounds=n,this.minLat=-85.051129,this.maxLat=s.cv,this.minLng=-180,this.maxLng=180,n&&(this.minLat=n.getSouth(),this.maxLat=n.getNorth(),this.minLng=n.getWest(),this.maxLng=n.getEast(),this.maxLng<this.minLng&&(this.maxLng+=360)),this.worldMinX=s.aD(this.minLng)*this.tileSize,this.worldMaxX=s.aD(this.maxLng)*this.tileSize,this.worldMinY=s.aH(this.maxLat)*this.tileSize,this.worldMaxY=s.aH(this.minLat)*this.tileSize,this._constrain()}calculatePosMatrix(n,a){return this.projection.createTileMatrix(this,a,n)}calculateDistanceTileData(n){const a=n.key,f=this._distanceTileDataCache;if(f[a])return f[a];const g=n.canonical,y=1/this.height,b=this.cameraWorldSize,E=b/this.zoomScale(g.z),A=(g.x+Math.pow(2,g.z)*n.wrap)*E,R=g.y*E,D=this.point;D.x*=b/this.worldSize,D.y*=b/this.worldSize;const F=this.angle,N=Math.sin(-F),j=-Math.cos(-F);return f[a]={bearing:[N,j],center:[(D.x-A)*y,(D.y-R)*y],scale:E/s.aj*y},f[a]}calculateFogTileMatrix(n){const a=n.key,f=this._fogTileMatrixCache;if(f[a])return f[a];const g=this.projection.createTileMatrix(this,this.cameraWorldSizeForFog,n);return s.az(g,this.worldToFogMatrix,g),f[a]=new Float32Array(g),f[a]}calculateProjMatrix(n,a=!1,f=!1){const g=n.key;let y;if(y=f?this._expandedProjMatrixCache:a?this._alignedProjMatrixCache:this._projMatrixCache,y[g])return y[g];const b=this.calculatePosMatrix(n,this.worldSize);let E;return E=this.projection.isReprojectedInTileSpace?this.mercatorMatrix:f?this.expandedFarZProjMatrix:a?this.alignedProjMatrix:this.projMatrix,s.az(b,E,b),y[g]=new Float32Array(b),y[g]}calculatePixelsToTileUnitsMatrix(n){const a=n.tileID.key,f=this._pixelsToTileUnitsCache;if(f[a])return f[a];const g=s.cz(n,this);return f[a]=g,f[a]}customLayerMatrix(){return this.mercatorMatrix.slice()}globeToMercatorMatrix(){if(this.projection.name==="globe"){const n=1/this.worldSize,a=s.bn([],[n,n,n]);return s.az(a,a,this.globeMatrix),a}}recenterOnTerrain(){if(!this._elevation||this.projection.name==="globe")return;const n=this._elevation;this._updateCameraState();const a=s.c6(1,this._center.lat)*this.worldSize,f=this._computeCameraPosition(a),g=this._camera.forward(),y=s.c6(1,this._center.lat);f[2]/=y,g[2]/=y,s.au(g,g);const b=n.raycast(f,g,n.exaggeration());if(b){const E=s.bE([],f,g,b),A=new s.ac(E[0],E[1],s.c6(E[2],s.aY(E[1]))),R=(A.z+s.ae([A.x-f[0],A.y-f[1],A.z-f[2]*y]))*this._pixelsPerMercatorPixel;this._seaLevelZoom=this._zoomFromMercatorZ(R),this._centerAltitude=A.toAltitude(),this._center=this.coordinateLocation(A),this._updateZoomFromElevation(),this._constrain(),this._calcMatrices()}}_constrainCamera(n=!1){if(!this._elevation)return;const a=this._elevation,f=s.c6(1,this._center.lat)*this.worldSize,g=this._computeCameraPosition(f),y=a.getAtPointOrZero(new s.ac(...g)),b=this.pixelsPerMeter/this.worldSize*y,E=this._minimumHeightOverTerrain(),A=g[2]-b;if(A<=E)if(A<0||n){const R=this.locationCoordinate(this._center,this._centerAltitude),D=[g[0],g[1],R.z-g[2]],F=s.ae(D);D[2]-=(E-A)/this._pixelsPerMercatorPixel;const N=s.ae(D);if(N===0)return;s.bY(D,D,F/N*this._pixelsPerMercatorPixel),this._camera.position=[g[0],g[1],R.z*this._pixelsPerMercatorPixel-D[2]],this._updateStateFromCamera()}else this._isCameraConstrained=!0}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;const n=this.projection.name==="globe"||this.mercatorFromTransition;if(this.projection.isReprojectedInTileSpace||n){const N=this.center;return N.lat=s.ay(N.lat,this.minLat,this.maxLat),(this.maxBounds||!this.renderWorldCopies&&!n)&&(N.lng=s.ay(N.lng,this.minLng,this.maxLng)),this.center=N,void(this._constraining=!1)}const a=this._unmodified,{x:f,y:g}=this.point;let y=0,b=f,E=g;const A=this.width/2,R=this.height/2,D=this.worldMinY*this.scale,F=this.worldMaxY*this.scale;if(g-R<D&&(E=D+R),g+R>F&&(E=F-R),F-D<this.height&&(y=Math.max(y,this.height/(F-D)),E=(F+D)/2),this.maxBounds||!this._renderWorldCopies||!this.projection.wrap){const N=this.worldMinX*this.scale,j=this.worldMaxX*this.scale,X=this.worldSize/2-(N+j)/2;b=(f+X+this.worldSize)%this.worldSize-X,b-A<N&&(b=N+A),b+A>j&&(b=j-A),j-N<this.width&&(y=Math.max(y,this.width/(j-N)),b=(j+N)/2)}b===f&&E===g||this._allowWorldUnderZoom||(this.center=this.unproject(new s.P(b,E))),y&&!this._allowWorldUnderZoom&&(this.zoom+=this.scaleZoom(y)),this._constrainCamera(),this._unmodified=a,this._constraining=!1}_minZoomForBounds(){let n=Math.max(0,this.scaleZoom(Math.max(0,this.height)/(this.worldMaxY-this.worldMinY)));return this.maxBounds&&(n=Math.max(n,this.scaleZoom(this.width/(this.worldMaxX-this.worldMinX)))),n}_maxCameraBoundsDistance(){return this._mercatorZfromZoom(this._minZoomForBounds())}_calcMatrices(){if(!this.height)return;const n=this.centerOffset,a=this.projection.name==="globe",f=this.pixelsPerMeter;this.projection.name==="globe"&&(this._mercatorScaleRatio=s.c6(1,this.center.lat)/s.c6(1,s.cP));const g=s.cA(this.projection,this.zoom,this.width,this.height,1024);this._pixelsPerMercatorPixel=this.projection.pixelSpaceConversion(this.center.lat,this.worldSize,g),this.cameraToCenterDistance=.5/Math.tan(.5*this._fov)*this.height*this._pixelsPerMercatorPixel,this._updateCameraState(),this._farZ=this.projection.farthestPixelDistance(this),this._nearZ=this.height/50;const y=this.projection.zAxisUnit==="meters"?f:1,b=this._camera.getWorldToCamera(this.worldSize,y);let E;const A=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,this._farZ);if(A[8]=2*-n.x/this.width,A[9]=2*n.y/this.height,this.isOrthographic){let Se=.5*this.height/Math.tan(this._fov/2)*1*Math.tan(.5*this._fov),Ee=Se*this.aspect,Fe=-Ee,je=-Se;Ee-=n.x,Fe-=n.x,Se+=n.y,je+=n.y,E=this._camera.getCameraToClipOrthographic(Fe,Ee,je,Se,this._nearZ,this._farZ),((rt,it,gt,ze)=>{for(let Xe=0;Xe<16;Xe++)rt[Xe]=s.ai(it[Xe],gt[Xe],ze)})(E,E,A,s.cN(this.pitch>=ps?1:this.pitch/ps))}else E=A;const R=s.cB([],A,b);let D=s.cB([],E,b);if(this.projection.isReprojectedInTileSpace){const Se=this.locationCoordinate(this.center),Ee=s.bx([]);s.bo(Ee,Ee,[Se.x*this.worldSize,Se.y*this.worldSize,0]),s.az(Ee,Ee,s.cC(this)),s.bo(Ee,Ee,[-Se.x*this.worldSize,-Se.y*this.worldSize,0]),s.az(D,D,Ee),s.az(R,R,Ee),this.inverseAdjustmentMatrix=s.cD(this)}else this.inverseAdjustmentMatrix=[1,0,0,1];if(this.mercatorMatrix=s.cE([],D,[this.worldSize,this.worldSize,this.worldSize/y,1]),this.projMatrix=D,this.invProjMatrix=s.bi(new Float64Array(16),this.projMatrix),a){const Se=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,1/0);Se[8]=2*-n.x/this.width,Se[9]=2*n.y/this.height,this.expandedFarZProjMatrix=s.cB([],Se,b)}else this.expandedFarZProjMatrix=this.projMatrix;const F=s.bi([],E);this.frustumCorners=s.cF.fromInvProjectionMatrix(F,this.horizonLineFromTop(),this.height),this.cameraFrustum=s.cn.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,0,!a);const N=new Float32Array(16);s.bx(N),s.cE(N,N,[1,-1,1]),s.cG(N,N,this._pitch),s.by(N,N,this.angle);const j=s.c4(new Float32Array(16),this._fov,this.width/this.height,this._nearZ,this._farZ);this.starsProjMatrix=s.bw(j);const X=(Math.PI/2-this._pitch)*(this.height/this._fov)*this._horizonShift;j[8]=2*-n.x/this.width,j[9]=2*(n.y+X)/this.height,this.skyboxMatrix=s.az(N,j,N);const W=this.point,K=W.x,ee=W.y,ie=this.width%2/2,fe=this.height%2/2,_e=Math.cos(this.angle),we=Math.sin(this.angle),be=K-Math.round(K)+_e*ie+we*fe,ve=ee-Math.round(ee)+_e*fe+we*ie,ye=new Float64Array(D);if(s.bo(ye,ye,[be>.5?be-1:be,ve>.5?ve-1:ve,0]),this.alignedProjMatrix=ye,D=s.bz(),s.cE(D,D,[this.width/2,-this.height/2,1]),s.bo(D,D,[1,-1,0]),this.labelPlaneMatrix=D,D=s.bz(),s.cE(D,D,[1,-1,1]),s.bo(D,D,[-1,-1,0]),s.cE(D,D,[2/this.width,2/this.height,1]),this.glCoordMatrix=D,this.pixelMatrix=s.az(new Float64Array(16),this.labelPlaneMatrix,R),this._calcFogMatrices(),this._distanceTileDataCache={},D=s.bi(new Float64Array(16),this.pixelMatrix),!D)throw new Error("failed to invert matrix");if(this.pixelMatrixInverse=D,this.projection.name==="globe"||this.mercatorFromTransition){this.globeMatrix=s.cH(this);const Se=[this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]];this.globeCenterInViewSpace=s.ad(Se,Se,b),this.globeRadius=this.worldSize/2/Math.PI-1}else this.globeMatrix=D;this._projMatrixCache={},this._alignedProjMatrixCache={},this._pixelsToTileUnitsCache={},this._expandedProjMatrixCache={}}_calcFogMatrices(){this._fogTileMatrixCache={};const n=this.cameraWorldSizeForFog,a=this.cameraPixelsPerMeter,f=this._camera.position,g=1/this.height/this._pixelsPerMercatorPixel,y=[n,n,a];s.bY(y,y,g),s.bY(f,f,-1),s.cI(f,f,y);const b=s.bz();s.bo(b,b,f),s.cE(b,b,y),this.mercatorFogMatrix=b,this.worldToFogMatrix=this._camera.getWorldToCameraPosition(n,a,g)}_computeCameraPosition(n){const a=(n=n||this.pixelsPerMeter)/this.pixelsPerMeter,f=this._camera.forward(),g=this.point,y=this._mercatorZfromZoom(this._seaLevelZoom?this._seaLevelZoom:this._zoom)*a-n/this.worldSize*this._centerAltitude;return[g.x/this.worldSize-f[0]*y,g.y/this.worldSize-f[1]*y,n/this.worldSize*this._centerAltitude-f[2]*y]}_updateCameraState(){this.height&&(this._camera.setPitchBearing(this._pitch,this.angle),this._camera.position=this._computeCameraPosition())}_translateCameraConstrained(n){const a=this._maxCameraBoundsDistance()*Math.cos(this._pitch),f=this._camera.position[2],g=n[2];let y=1;this.projection.wrap&&(this.center=this.center.wrap()),g>0&&(y=Math.min((a-f)/g,1)),this._camera.position=s.bE([],this._camera.position,n,y),this._updateStateFromCamera()}_updateStateFromCamera(){const n=this._camera.position,a=this._camera.forward(),{pitch:f,bearing:g}=this._camera.getPitchBearing(),y=s.c6(this._centerAltitude,this.center.lat)*this._pixelsPerMercatorPixel,b=this._mercatorZfromZoom(this._maxZoom)*Math.cos(s.al(this._maxPitch)),E=Math.max((n[2]-y)/Math.cos(f),b),A=this._zoomFromMercatorZ(E);s.bE(n,n,a,E),this._pitch=s.ay(f,s.al(this.minPitch),s.al(this.maxPitch)),this.angle=s.bX(g,-Math.PI,Math.PI),this._setZoom(s.ay(A,this._minZoom,this._maxZoom)),this._updateSeaLevelZoom(),this._center=this.coordinateLocation(new s.ac(n[0],n[1],n[2])),this._unmodified=!1,this._constrain(),this._calcMatrices()}_worldSizeFromZoom(n){return Math.pow(2,n)*this.tileSize}_mercatorZfromZoom(n){return this.cameraToCenterDistance/this._worldSizeFromZoom(n)}_minimumHeightOverTerrain(){const n=Math.min(this._seaLevelZoom!=null?this._seaLevelZoom:this._zoom,this._maxZoom)+4;return this._mercatorZfromZoom(n)}_zoomFromMercatorZ(n){return this.scaleZoom(this.cameraToCenterDistance/(Math.max(0,n)*this.tileSize))}zoomFromMercatorZAdjusted(n){let a=0,f=s.cx,g=0,y=1/0;for(;f-a>1e-6&&f>a;){const b=a+.5*(f-a),E=this.tileSize*Math.pow(2,b),A=this.getCameraToCenterDistance(this.projection,b,E),R=this.scaleZoom(A/(Math.max(0,n)*this.tileSize)),D=Math.abs(b-R);D<y&&(y=D,g=b),b<R?a=b:f=b}return g}_terrainEnabled(){return!(!this._elevation||!this.projection.supportsTerrain&&(s.w("Terrain is not yet supported with alternate projections. Use mercator or globe to enable terrain."),1))}anyCornerOffEdge(n,a){const f=Math.min(n.x,a.x),g=Math.max(n.x,a.x),y=Math.min(n.y,a.y),b=Math.max(n.y,a.y);if(y<this.horizonLineFromTop(!1))return!0;if(this.projection.name!=="mercator")return!1;const E=[new s.P(f,y),new s.P(g,b),new s.P(f,b),new s.P(g,y)],A=this.renderWorldCopies?-3:0,R=this.renderWorldCopies?4:1;for(const D of E){const F=this.pointRayIntersection(D);if(F.t<0)return!0;const N=this.rayIntersectionCoordinate(F);if(N.x<A||N.y<0||N.x>R||N.y>1)return!0}return!1}isHorizonVisible(){return this.pitch+s.cJ(this.fovAboveCenter)>88||this.anyCornerOffEdge(new s.P(0,0),new s.P(this.width,this.height))}zoomDeltaToMovement(n,a){const f=s.ae(s.at([],this._camera.position,n)),g=this._zoomFromMercatorZ(f)+a;return f-this._mercatorZfromZoom(g)}getCameraPoint(){if(this.projection.name==="globe"){const n=function([a,f,g],y){const b=[a,f,g,1];s.aA(b,b,y);const E=b[3]=Math.max(b[3],1e-6);return b[0]/=E,b[1]/=E,b[2]/=E,b}([this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]],this.pixelMatrix);return new s.P(n[0],n[1])}{const n=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new s.P(0,n))}}getCameraToCenterDistance(n,a=this.zoom,f=this.worldSize){const g=s.cA(n,a,this.width,this.height,1024),y=n.pixelSpaceConversion(this.center.lat,f,g);let b=.5/Math.tan(.5*this._fov)*this.height*y;return this.isOrthographic&&(b=s.ai(1,b,s.cN(this.pitch>=ps?1:this.pitch/ps))),b}getWorldToCameraMatrix(){const n=this._camera.getWorldToCamera(this.worldSize,this.projection.zAxisUnit==="meters"?this.pixelsPerMeter:1);return this.projection.name==="globe"&&s.az(n,n,this.globeMatrix),n}getFrustum(n){return s.cn.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,n,this.projection.zAxisUnit==="meters")}}const Oa=(h,n)=>{if(n>0&&h.terrain&&s.w("Cutoff is currently disabled on terrain"),n<=0||h.terrain)return{shouldRenderCutoff:!1,uniformValues:{u_cutoff_params:[0,0,0,1]}};const a=h.transform,f=Math.max(Math.abs(a._zoom-(h.minCutoffZoom-1)),1),g=a.isLODDisabled(!1)?s.af(60,45,a.pitch):s.af(30,15,a.pitch),y=a._farZ-a._nearZ,b=n*a.height,E=((1-(A=g))*a.cameraToCenterDistance+A*(a._farZ+b))*f;var A;return{shouldRenderCutoff:g<1,uniformValues:{u_cutoff_params:[a._nearZ,a._farZ,(E-a._nearZ)/y,(E-b-a._nearZ)/y]}}},Fs={cascadeCount:2,normalOffset:3,shadowMapResolution:2048};class Gh{constructor(n,a){this.aabb=n,this.lastCascade=a}}class N2{add(n,a){const f=this.receivers[n.key];f!==void 0?(f.aabb.min[0]=Math.min(f.aabb.min[0],a.min[0]),f.aabb.min[1]=Math.min(f.aabb.min[1],a.min[1]),f.aabb.min[2]=Math.min(f.aabb.min[2],a.min[2]),f.aabb.max[0]=Math.max(f.aabb.max[0],a.max[0]),f.aabb.max[1]=Math.max(f.aabb.max[1],a.max[1]),f.aabb.max[2]=Math.max(f.aabb.max[2],a.max[2])):this.receivers[n.key]=new Gh(a,null)}clear(){this.receivers={}}get(n){return this.receivers[n.key]}computeRequiredCascades(n,a,f){const g=s.cW.fromPoints(n.points);let y=0;for(const b in this.receivers){const E=this.receivers[b];if(!E||!g.intersectsAabb(E.aabb))continue;E.aabb.min=g.closestPoint(E.aabb.min),E.aabb.max=g.closestPoint(E.aabb.max);const A=E.aabb.getCorners();for(let R=0;R<f.length;R++){let D=!0;for(const F of A){const N=[F[0]*a,F[1]*a,F[2]];if(s.ad(N,N,f[R].matrix),N[0]<-1||N[0]>1||N[1]<-1||N[1]>1){D=!1;break}}if(E.lastCascade=R,y=Math.max(y,R),D)break}}return y+1}}class z2{constructor(n){this.painter=n,this._enabled=!1,this._shadowLayerCount=0,this._numCascadesToRender=0,this._cascades=[],this._groundShadowTiles=[],this._receivers=new N2,this._depthMode=new Gt(n.context.gl.LEQUAL,Gt.ReadWrite,[0,1]),this._uniformValues={u_light_matrix_0:new Float32Array(16),u_light_matrix_1:new Float32Array(16),u_shadow_intensity:0,u_fade_range:[0,0],u_shadow_normal_offset:[1,1,1],u_shadow_texel_size:1,u_shadow_map_resolution:1,u_shadow_direction:[0,0,1],u_shadow_bias:[36e-5,.0012,.012],u_shadowmap_0:0,u_shadowmap_1:0},this._forceDisable=!1,this.useNormalOffset=!1,n.tp.registerParameter(this,["Shadows"],"_forceDisable",{label:"forceDisable"},()=>{this.painter.style.map.triggerRepaint()}),n.tp.registerParameter(Fs,["Shadows"],"cascadeCount",{min:1,max:2,step:1}),n.tp.registerParameter(Fs,["Shadows"],"normalOffset",{min:0,max:10,step:.05}),n.tp.registerParameter(Fs,["Shadows"],"shadowMapResolution",{min:32,max:2048,step:32}),n.tp.registerBinding(this,["Shadows"],"_numCascadesToRender",{readonly:!0,label:"numCascadesToRender"})}destroy(){for(const n of this._cascades)n.texture.destroy(),n.framebuffer.destroy();this._cascades=[]}updateShadowParameters(n,a){const f=this.painter;if(this._enabled=!1,this._shadowLayerCount=0,this._receivers.clear(),!a||!a.properties)return;const g=a.properties.get("shadow-intensity");if(!a.shadowsEnabled()||g<=0||(this._shadowLayerCount=f.style.order.reduce((X,W)=>{const K=f.style._mergedLayers[W];return X+(K.hasShadowPass()&&!K.isHidden(n.zoom)?1:0)},0),this._enabled=this._shadowLayerCount>0,!this.enabled))return;const y=f.context,b=Fs.shadowMapResolution,E=Fs.shadowMapResolution;if(this._cascades.length===0||Fs.shadowMapResolution!==this._cascades[0].texture.size[0]){this._cascades=[];for(let X=0;X<Fs.cascadeCount;++X){const W=f._shadowMapDebug,K=y.gl,ee=y.createFramebuffer(b,E,W,"texture"),ie=new s.T(y,{width:b,height:E,data:null},K.DEPTH_COMPONENT16);if(ee.depthAttachment.set(ie.texture),W){const fe=new s.T(y,{width:b,height:E,data:null},K.RGBA8);ee.colorAttachment.set(fe.texture)}this._cascades.push({framebuffer:ee,texture:ie,matrix:[],far:0,boundingSphereRadius:0,frustum:new s.cn,scale:0})}}this.shadowDirection=Bu(a);let A=0;if(n.elevation){const X=n.elevation,W=[1e4,-1e4];X.visibleDemTiles.filter(K=>K.dem).forEach(K=>{const ee=K.dem.tree;W[0]=Math.min(W[0],ee.minimums[0]),W[1]=Math.max(W[1],ee.maximums[0])}),W[0]!==1e4&&(A=(W[1]-W[0])*X.exaggeration())}const R=1.5*n.cameraToCenterDistance,D=3*R,F=new Float64Array(16);for(let X=0;X<this._cascades.length;++X){const W=this._cascades[X];let K=n.height/50,ee=1;Fs.cascadeCount===1?ee=D:X===0?ee=R:(K=R,ee=D);const[ie,fe]=Vu(n,this.shadowDirection,K,ee,Fs.shadowMapResolution,A);W.scale=n.scale,W.matrix=ie,W.boundingSphereRadius=fe,s.bi(F,W.matrix),W.frustum=s.cn.fromInvProjectionMatrix(F,1,0,!0),W.far=ee}const N=this._cascades.length-1;this._uniformValues.u_fade_range=[.75*this._cascades[N].far,this._cascades[N].far],this._uniformValues.u_shadow_intensity=g,this._uniformValues.u_shadow_direction=[this.shadowDirection[0],this.shadowDirection[1],this.shadowDirection[2]],this._uniformValues.u_shadow_texel_size=1/Fs.shadowMapResolution,this._uniformValues.u_shadow_map_resolution=Fs.shadowMapResolution,this._uniformValues.u_shadowmap_0=Ks.ShadowMap0,this._uniformValues.u_shadowmap_1=Ks.ShadowMap0+1,this._groundShadowTiles=f.transform.coveringTiles({tileSize:512,renderWorldCopies:!0});const j=f.transform.elevation;for(const X of this._groundShadowTiles){let W={min:0,max:0};if(j){const K=j.getMinMaxForTile(X);K&&(W=K)}this.addShadowReceiver(X.toUnwrapped(),W.min,W.max)}}get enabled(){return this._enabled&&!this._forceDisable}set enabled(n){this._enabled=n}drawShadowPass(n,a){if(!this.enabled)return;const f=this.painter,g=f.context;this._numCascadesToRender=this._receivers.computeRequiredCascades(f.transform.getFrustum(0),f.transform.worldSize,this._cascades),g.viewport.set([0,0,Fs.shadowMapResolution,Fs.shadowMapResolution]);for(let y=0;y<this._numCascadesToRender;++y){f.currentShadowCascade=y,g.bindFramebuffer.set(this._cascades[y].framebuffer.framebuffer),g.clear({color:s.am.white,depth:1});for(const b of n.order){const E=n._mergedLayers[b];if(!E.hasShadowPass()||E.isHidden(f.transform.zoom))continue;const A=n.getLayerSourceCache(E),R=A?a[A.id]:void 0;(E.type==="model"||R&&R.length)&&f.renderLayer(f,A,E,R)}}f.currentShadowCascade=0}drawGroundShadows(){if(!this.enabled)return;const n=this.painter,a=n.style,f=n.context,g=f.gl,y=a.directionalLight,b=a.ambientLight;if(!y||!b)return;const E=[],A=Oa(n,n.longestCutoffRange);A.shouldRenderCutoff&&E.push("RENDER_CUTOFF"),E.push("RENDER_SHADOWS","DEPTH_TEXTURE"),this.useNormalOffset&&E.push("NORMAL_OFFSET");const R=Zc(a,y,b),D=new Gt(g.LEQUAL,Gt.ReadOnly,n.depthRangeFor3D),F=new En({func:g.EQUAL,mask:255},0,255,g.KEEP,g.KEEP,g.KEEP);for(const N of this._groundShadowTiles){const j=N.toUnwrapped(),X=n.isTileAffectedByFog(N),W=n.getOrCreateProgram("groundShadow",{defines:E,overrideFog:X});this.setupShadows(j,W),n.uploadCommonUniforms(f,W,j,null,A);const K={u_matrix:n.transform.calculateProjMatrix(j),u_ground_shadow_factor:R};W.draw(n,g.TRIANGLES,D,F,Zn.multiply,_n.disabled,K,"ground_shadow",n.tileExtentBuffer,n.quadTriangleIndexBuffer,n.tileExtentSegments,null,n.transform.zoom,null,null)}}getShadowPassColorMode(){return this.painter._shadowMapDebug?Zn.unblended:Zn.disabled}getShadowPassDepthMode(){return this._depthMode}getShadowCastingLayerCount(){return this._shadowLayerCount}calculateShadowPassMatrixFromTile(n){const a=this.painter.transform,f=a.calculatePosMatrix(n,a.worldSize);return s.az(f,this._cascades[this.painter.currentShadowCascade].matrix,f),Float32Array.from(f)}calculateShadowPassMatrixFromMatrix(n){return s.az(n,this._cascades[this.painter.currentShadowCascade].matrix,n),Float32Array.from(n)}setupShadows(n,a,f,g=0){if(!this.enabled)return;const y=this.painter.transform,b=this.painter.context,E=b.gl,A=this._uniformValues,R=new Float64Array(16),D=y.calculatePosMatrix(n,y.worldSize);for(let F=0;F<this._cascades.length;F++)s.az(R,this._cascades[F].matrix,D),A[F===0?"u_light_matrix_0":"u_light_matrix_1"]=Float32Array.from(R),b.activeTexture.set(E.TEXTURE0+Ks.ShadowMap0+F),this._cascades[F].texture.bindExtraParam(E.LINEAR,E.LINEAR,E.CLAMP_TO_EDGE,E.CLAMP_TO_EDGE,E.GREATER);if(this.useNormalOffset=!!f,this.useNormalOffset){const F=s.cU(n.canonical),N=2/y.tileSize*s.aj/Fs.shadowMapResolution,j=N*this._cascades[0].boundingSphereRadius,X=N*this._cascades[this._cascades.length-1].boundingSphereRadius,W=(f==="vector-tile"?1:3)/Math.pow(2,g-n.canonical.z-(1-y.zoom+Math.floor(y.zoom)));A.u_shadow_normal_offset=[F,j*W,X*W],A.u_shadow_bias=[6e-5,.0012,.012]}else A.u_shadow_bias=[36e-5,.0012,.012];a.setShadowUniformValues(b,A)}setupShadowsFromMatrix(n,a,f=!1){if(!this.enabled)return;const g=this.painter.context,y=g.gl,b=this._uniformValues,E=new Float64Array(16);for(let A=0;A<Fs.cascadeCount;A++)s.az(E,this._cascades[A].matrix,n),b[A===0?"u_light_matrix_0":"u_light_matrix_1"]=Float32Array.from(E),g.activeTexture.set(y.TEXTURE0+Ks.ShadowMap0+A),this._cascades[A].texture.bindExtraParam(y.LINEAR,y.LINEAR,y.CLAMP_TO_EDGE,y.CLAMP_TO_EDGE,y.GREATER);if(this.useNormalOffset=f,f){const A=Fs.normalOffset;b.u_shadow_normal_offset=[1,A,A],b.u_shadow_bias=[6e-5,.0012,.012]}else b.u_shadow_bias=[36e-5,.0012,.012];a.setShadowUniformValues(g,b)}getShadowUniformValues(){return this._uniformValues}getCurrentCascadeFrustum(){return this._cascades[this.painter.currentShadowCascade].frustum}computeSimplifiedTileShadowVolume(n,a,f,g){if(g[2]>=0)return{};const y=function(A,R,D){const F=D/(1<<A.canonical.z);return new s.cW([A.canonical.x*F+A.wrap*D,A.canonical.y*F+A.wrap*D,0],[(A.canonical.x+1)*F+A.wrap*D,(A.canonical.y+1)*F+A.wrap*D,R])}(n,a,f).getCorners(),b=a/-g[2];g[0]<0?(s.cV(y[0],y[0],[g[0]*b,0,0]),s.cV(y[3],y[3],[g[0]*b,0,0])):g[0]>0&&(s.cV(y[1],y[1],[g[0]*b,0,0]),s.cV(y[2],y[2],[g[0]*b,0,0])),g[1]<0?(s.cV(y[0],y[0],[0,g[1]*b,0]),s.cV(y[1],y[1],[0,g[1]*b,0])):g[1]>0&&(s.cV(y[2],y[2],[0,g[1]*b,0]),s.cV(y[3],y[3],[0,g[1]*b,0]));const E={};return E.vertices=y,E.planes=[Ql(y[1],y[0],y[4]),Ql(y[2],y[1],y[5]),Ql(y[3],y[2],y[6]),Ql(y[0],y[3],y[7])],E}addShadowReceiver(n,a,f){this._receivers.add(n,s.cW.fromTileIdAndHeight(n,a,f))}getMaxCascadeForTile(n){const a=this._receivers.get(n);return a&&a.lastCascade?a.lastCascade:0}}function Ql(h,n,a){const f=s.at([],a,n),g=s.at([],h,n),y=s.bF([],f,g),b=s.ae(y);return b===0?[0,0,1,0]:(s.bY(y,y,1/b),[y[0],y[1],y[2],-s.bG(y,n)])}function Bu(h){const n=h.properties.get("direction"),a=s.cR(n.x,n.y,n.z);a[2]=s.ay(a[2],0,75);const f=s.cT([a[0],a[1],a[2]]);return s.cS(f.x,f.y,f.z)}function Zc(h,n,a){const f=n.properties.get("color-use-theme")==="none",g=n.properties.get("color"),y=n.properties.get("intensity"),b=n.properties.get("direction"),E=[b.x,b.y,b.z],A=a.properties.get("color-use-theme")==="none",R=a.properties.get("color"),D=a.properties.get("intensity"),F=Math.max(s.bG([0,0,1],E),0),N=[0,0,0];s.bY(N,R.toPremultipliedRenderColor(A?null:h.getLut(n.scope)).toArray01Linear().slice(0,3),D);const j=[0,0,0];return s.bY(j,g.toPremultipliedRenderColor(f?null:h.getLut(a.scope)).toArray01Linear().slice(0,3),F*y),s.cY([N[0]>0?N[0]/(N[0]+j[0]):0,N[1]>0?N[1]/(N[1]+j[1]):0,N[2]>0?N[2]/(N[2]+j[2]):0])}function Vu(h,n,a,f,g,y){const b=h.zoom,E=h.scale,A=h.worldSize,R=1/A,D=h.aspect,F=Math.sqrt(1+D*D)*Math.tan(.5*h.fovX),N=F*F,j=f-a,X=f+a;let W,K;N>j/X?(W=f,K=f*F):(W=.5*X*(1+N),K=.5*Math.sqrt(j*j+2*(f*f+a*a)*N+X*X*N*N));const ee=h.projection.pixelsPerMeter(h.center.lat,A),ie=h._camera.getCameraToWorldMercator(),fe=[0,0,-W*R];s.ad(fe,fe,ie);let _e=K*R;const we=h._edgeInsets;if(!(we.left===0&&we.top===0&&we.right===0&&we.bottom===0||we.left===we.right&&we.top===we.bottom)){const dt=h._camera.getWorldToCamera(h.worldSize,h.projection.zAxisUnit==="meters"?ee:1),At=h._camera.getCameraToClipPerspective(h._fov,h.width/h.height,a,f);At[8]=2*-h.centerOffset.x/h.width,At[9]=2*h.centerOffset.y/h.height;const st=new Float64Array(16);s.cB(st,At,dt);const Tt=new Float64Array(16);s.bi(Tt,st);const qt=s.cn.fromInvProjectionMatrix(Tt,A,b,!0);for(const Wt of qt.points){const Vt=((be=Wt)[0]/=E,be[1]/=E,be[2]=s.c6(be[2],h._center.lat),be);_e=Math.max(_e,s.bZ(s.cX([],fe,Vt)))}}var be;_e*=g/(g-1);const ve=Math.acos(n[2]),ye=Math.atan2(-n[0],-n[1]),Se=new Jo;Se.position=fe,Se.setPitchBearing(ve,ye);const Ee=Se.getWorldToCamera(A,ee),Fe=_e*A,je=Math.min(h._mercatorZfromZoom(17)*A*-2,-2*Fe),rt=Se.getCameraToClipOrthographic(-Fe,Fe,-Fe,Fe,je,(Fe+y*ee)/n[2]),it=new Float64Array(16);s.az(it,rt,Ee);const gt=s.cS(Math.floor(1e6*fe[0])/1e6*A,Math.floor(1e6*fe[1])/1e6*A,0),ze=.5*g,Xe=[0,0,0];s.ad(Xe,gt,it),s.bY(Xe,Xe,ze);const Re=[Math.floor(Xe[0]),Math.floor(Xe[1]),Math.floor(Xe[2])],ot=[0,0,0];s.at(ot,Xe,Re),s.bY(ot,ot,-1/ze);const Ge=new Float64Array(16);return s.bx(Ge),s.bo(Ge,Ge,ot),s.az(it,Ge,it),[it,Fe]}class Zx extends s.E{constructor(n){super(),this.requestManager=n,this.models={"":{}},this.modelUris={"":{}},this.modelByURL={},this.numModelsLoading={}}loadModel(n,a){return s.aS(this.requestManager.transformRequest(a,s.R.Model).url).then(f=>{if(!f)return;const g=s.aT(f),y=new s.aU(n,void 0,void 0,g);return y.computeBoundsAndApplyParent(),y}).catch(f=>{if(f&&f.status===404)return null;this.fire(new s.z(new Error(`Could not load model ${n} from ${a}: ${f.message}`)))})}load(n,a,f={forceReload:!1}){this.models[a]||(this.models[a]={});const g=Object.keys(n),y=[],b=[];for(const E of g){const A=n[E];this.hasURLBeenRequested(A)&&!f.forceReload||(this.modelByURL[A]={modelId:E,scope:a},y.push(this.loadModel(E,A)),b.push(E)),this.models[a][E]||(this.models[a][E]={model:null,numReferences:1})}this.numModelsLoading[a]=(this.numModelsLoading[a]||0)+b.length,Promise.allSettled(y).then(E=>{for(let A=0;A<E.length;A++){const{status:R}=E[A];if(R==="rejected")continue;const{value:D}=E[A];this.models[a][b[A]]||(this.models[a][b[A]]={model:null,numReferences:1}),this.models[a][b[A]].model=D}this.numModelsLoading[a]-=b.length,this.fire(new s.A("data",{dataType:"style"}))}).catch(E=>{this.fire(new s.z(new Error(`Could not load models: ${E.message}`)))})}isLoaded(){for(const n in this.numModelsLoading)if(this.numModelsLoading[n]>0)return!1;return!0}hasModel(n,a,f={exactIdMatch:!1}){return!!(f.exactIdMatch?this.getModel(n,a):this.getModelByURL(this.modelUris[a][n]))}getModel(n,a){return this.models[a]||(this.models[a]={}),this.models[a][n]?this.models[a][n].model:void 0}getModelByURL(n){if(!n)return null;const a=this.modelByURL[n];return a?this.models[a.scope][a.modelId].model:null}hasModelBeenAdded(n,a){return this.models[a]&&this.models[a][n]!==void 0}getModelURIs(n){return this.modelUris[n]||{}}addModel(n,a,f){this.models[f]||(this.models[f]={}),this.modelUris[f]||(this.modelUris[f]={});const g=this.requestManager.normalizeModelURL(a);if((this.hasModel(n,f,{exactIdMatch:!0})||this.hasModelBeenAdded(n,f))&&this.modelUris[f][n]===g)this.models[f][n].numReferences++;else if(this.hasURLBeenRequested(g)){const{scope:y,modelId:b}=this.modelByURL[g];this.models[y][b].numReferences++}else this.modelUris[f][n]=g,this.load({[n]:this.modelUris[f][n]},f)}addModelURLs(n,a){this.models[a]||(this.models[a]={}),this.modelUris[a]||(this.modelUris[a]={});const f=this.modelUris[a];for(const g in n)f[g]=this.requestManager.normalizeModelURL(n[g])}reloadModels(n){this.load(this.modelUris[n],n,{forceReload:!0})}addModelsFromBucket(n,a){this.models[a]||(this.models[a]={}),this.modelUris[a]||(this.modelUris[a]={});const f={};for(const g of n)this.hasModel(g,a,{exactIdMatch:!0})||this.hasURLBeenRequested(g)?this.models[a][g].numReferences++:this.modelUris[a][g]&&!this.hasURLBeenRequested(g)?f[g]=this.modelUris[a][g]:!this.hasURLBeenRequested(g)&&s.cZ(g,!1)&&(this.modelUris[a][g]=this.requestManager.normalizeModelURL(g),f[g]=this.modelUris[a][g]);this.load(f,a)}hasURLBeenRequested(n){return this.modelByURL[n]!==void 0}removeModel(n,a,f=!1){if(this.models[a]&&this.models[a][n]&&(this.models[a][n].numReferences--,this.models[a][n].numReferences===0)){const g=this.modelUris[a][n];f||delete this.modelUris[a][n],delete this.modelByURL[g];const y=this.models[a][n].model;if(!y)return;delete this.models[a][n],y.destroy()}}destroy(){for(const n of Object.keys(this.models))for(const a of Object.keys(this.models[n])){const f=this.models[n][a].model;delete this.models[n][a],f&&f.destroy()}this.models={"":{}},this.modelUris={"":{}},this.modelByURL={},this.numModelsLoading={}}listModels(n){return this.models[n]||(this.models[n]={}),Object.keys(this.models[n])}upload(n,a){this.models[a]||(this.models[a]={});for(const f in this.models[a])this.models[a][f].model&&this.models[a][f].model.upload(n.context)}}const zp=new s.a7({data:new s.a8(s.a5.colorTheme.data)}),w_={"mbx-indoor-active-floorplans":{default:["literal",[]]},"mbx-indoor-underground":{default:["literal",!1]},"mbx-indoor-loaded-levels":{default:["literal",[]]},"mbx-indoor-level-height":{default:["literal",{}]},"mbx-indoor-level-base":{default:["literal",{}]},"mbx-indoor-level-selected":{default:["literal",{}]},"mbx-indoor-level-overlapped":{default:["literal",{}]}};function cl(h){return h=h||{},Object.assign(h,w_)}class O2 extends s.E{constructor(n){super(),this.mergeFloors=!0,this._scope=void 0,this._queryFeatureSetId=void 0,this._buildingEntryFeatureSetId=void 0,this._selectedFloorplan=void 0,this._indoorData=void 0,this._floorplanStates={},s.aV(["_onLoad","_onMove","_checkFloorplanVisible"],this),this._map=n,this._checkFloorplanVisible(),this._map.on("load",this._onLoad),this._map.on("move",this._onMove)}destroy(){this._map.indoor.off("load",this._onLoad),this._map.indoor.off("move",this._onMove),this._map=void 0}_onLoad(){this._map.style.forEachFragmentStyle(n=>{n.stylesheet.indoor&&(this._queryFeatureSetId?this.fire(new s.z(new Error("Multiple indoor map styles detected, simultaneous usage is not allowed currently."))):(this._queryFeatureSetId=n.stylesheet.indoor.floorplanFeaturesetId,this._buildingEntryFeatureSetId=n.stylesheet.indoor.buildingFeaturesetId,this._scope=n.scope))}),this._queryFeatureSetId&&this._buildingEntryFeatureSetId&&this._map.addInteraction("mbx-indoor-buildingclick",{type:"click",target:{featuresetId:this._buildingEntryFeatureSetId,importId:this._scope},handler:n=>(n.feature&&n.feature.properties.floorplan&&this.selectFloorplan(n.feature.properties.floorplan),!0)}),this._checkFloorplanVisible()}_onMove(){this._checkFloorplanVisible()}_checkFloorplanVisible(){if(!this._queryFeatureSetId||!this._map.isStyleLoaded())return;const n=()=>{this._indoorData=void 0,this._selectedFloorplan=void 0,this._map.setConfigProperty(this._scope,"mbx-indoor-underground",!1),this._map.setConfigProperty(this._scope,"mbx-indoor-active-floorplans",["literal",[]]),this.fire(new s.A("floorplangone"))};if(this._map.transform.zoom<13)return void n();const a={target:{featuresetId:this._queryFeatureSetId,importId:this._scope}},f=this._map.transform.width,g=this._map.transform.height,y=f*(2/3),b=g*(2/3),E=.5*(f-y),A=.5*(g-b),R=[new s.P(E,A),new s.P(E+y,A+b)],D=this._map.queryRenderedFeatures(R,a);D.length>0?this._selectedFloorplan&&D[0].properties.id===this._selectedFloorplan.properties.id||(this._selectedFloorplan=D[0],this._floorplanSelected()):n()}_floorplanSelected(){this._indoorData=JSON.parse(this._selectedFloorplan.properties["indoor-data"]),this._indoorData.id=this._selectedFloorplan.properties.id,this._floorplanStates[this._indoorData.id]=this._floorplanStates[this._indoorData.id]||{},this._map.setConfigProperty(this._scope,"mbx-indoor-active-floorplans",["literal",[this._indoorData.id]]);const n=this._floorplanStates[this._indoorData.id].selectedBuilding,a=n?this._indoorData.buildings.find(E=>E.id===n):this._indoorData.buildings.length>0?this._indoorData.buildings[0]:null,f=this._floorplanStates[this._indoorData.id].selectedLevel,g=this._indoorData.levels.find(E=>E.id===f),y=this._indoorData.levels.find(E=>!(!a||!a.levels)&&Number(E.levelOrder)===0&&a.levels.includes(E.id)),b=g?g.id:y?y.id:void 0;this.fire(new s.A("floorplanselected",{buildings:this._indoorData.buildings,levels:this._indoorData.levels,selectedLevelId:b})),a&&this._buildingSelected(a,!1),b&&this._levelSelected(b)}_buildingSelected(n,a){if(!n||!n.id)return void console.warn("IndoorManager: Building or building id is undefined");a&&n.extent&&this._map.fitBounds(n.extent,{pitch:this._map.getPitch(),bearing:this._map.getBearing()}),this._floorplanStates[this._indoorData.id].selectedBuilding=n?n.id:void 0;const f=this._indoorData.levels.filter(g=>n.levels.includes(g.id));this.fire(new s.A("buildingselected",{buildingId:n.id,levels:f}))}_levelSelected(n){const a=this._indoorData.levels.find(f=>f.id===n);a?(this._updateLevels(a,!0),this.fire(new s.A("levelselected",{levelId:a.id}))):console.warn(`IndoorManager: Level with ID ${n} not found in the current floorplan.`)}_updateLevels(n,a){if(!n||!n.id)throw new Error("IndoorManager: Selected level or level ID is undefined");function f(R){const D=R.indexOf("/floor/");if(D===-1)return R;const F=D+7,N=R.indexOf("/",F);return N===-1?R.slice(F):R.slice(F,N)}this._floorplanStates[this._indoorData.id].selectedLevel=n.id;const g=[],y={},b={},E={},A={};for(const R of this._indoorData.levels){if(g.push(R.id),y[R.id]=R.levelOrder>=0?3*Math.abs(R.levelOrder+1):3*Math.abs(R.levelOrder),b[R.id]=R.levelOrder>=0?3*R.levelOrder:0,this.mergeFloors){const D=f(n.id),F=f(R.id);E[R.id]=F===D?"true":"false"}else E[R.id]=R.id===n.id?"true":"false";A[R.id]=R.levelOrder<n.levelOrder?"true":"false"}this._map.setConfigProperty(this._scope,"mbx-indoor-loaded-levels",["literal",g]),this._map.setConfigProperty(this._scope,"mbx-indoor-level-height",["literal",y]),this._map.setConfigProperty(this._scope,"mbx-indoor-level-base",["literal",b]),this._map.setConfigProperty(this._scope,"mbx-indoor-level-selected",["literal",E]),this._map.setConfigProperty(this._scope,"mbx-indoor-level-overlapped",["literal",A]),this._map.setConfigProperty(this._scope,"mbx-indoor-underground",n.levelOrder<0)}selectFloorplan(n){const a={target:{featuresetId:this._queryFeatureSetId,importId:this._scope}},f=[new s.P(0,0),new s.P(this._map.transform.width,this._map.transform.height)],g=this._map.queryRenderedFeatures(f,a);if(g.length>0){for(const y of g)if(JSON.parse(y.properties["indoor-data"]).id===n){this._selectedFloorplan=y,this._floorplanSelected();break}}}selectBuilding(n){const a=this._indoorData.buildings.find(f=>f.id===n);this._buildingSelected(a,!0)}selectLevel(n){this._levelSelected(n)}}function F2(h){if(!h.metadata||!h.metadata.content_area)return;const n=s.q.devicePixelRatio,{left:a,top:f,width:g,height:y}=h.metadata.content_area,b=a*n,E=f*n;return[b,E,b+g*n,E+y*n]}function Xx(h){if(h)return h.map(([n,a])=>[n*s.q.devicePixelRatio,a*s.q.devicePixelRatio])}class Yx{constructor(n,a,f){this.id=n,this.scope=a,this.sourceCache=f,this.pendingRequests=new Set,this.missingRequests=new Set}addPendingRequest(n){this.missingRequests.has(n.name)||this.pendingRequests.has(n.name)||this.pendingRequests.add(n.name)}hasPendingRequests(){return this.pendingRequests.size>0}resolvePendingRequests(){const n=new Map;if(!this.sourceCache.loaded())return n;const a=this.sourceCache.getVisibleCoordinates();if(a.length===0)return n;const f=this.sourceCache.getSource();if(!(f instanceof Zl))return n;const g=a.map(b=>this.sourceCache.getTile(b)),y=f.getImages(g,Array.from(this.pendingRequests));for(const[b,E]of y)n.set(s.I.from({name:b,iconsetId:this.id}),E),this.pendingRequests.delete(b);for(const b of this.pendingRequests)this.missingRequests.add(b);return this.pendingRequests.clear(),n}}const Xc=(h,n)=>xe(h,n&&n.filter(a=>a.identifier!=="source.canvas")),S_=s.aF(ur,["addLayer","removeLayer","setLights","setPaintProperty","setLayoutProperty","setSlot","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData","setTerrain","setFog","setSnow","setRain","setProjection","setCamera","addImport","removeImport","updateImport","addIconset","removeIconset"]),Kx=s.aF(ur,["setCenter","setZoom","setBearing","setPitch"]),Op=new Set(["background","sky","slot","custom"]),T_={version:8,layers:[],sources:{}},E_={duration:300,delay:0};class js extends s.E{constructor(n,a={}){super(),this.map=n,this.scope=a.scope||"",this.globalId=null,this.fragments=[],this.importDepth=a.importDepth||0,this.importsCache=a.importsCache||new Map,this.resolvedImports=a.resolvedImports||new Set,this.transition=s.h({},E_),this._buildingIndex=new Gx(this),this.crossTileSymbolIndex=new ao,this._mergedOrder=[],this._drapedFirstOrder=[],this._mergedLayers={},this._mergedSourceCaches={},this._mergedOtherSourceCaches={},this._mergedSymbolSourceCaches={},this._clipLayerPresent=!1,this._has3DLayers=!1,this._hasCircleLayers=!1,this._hasSymbolLayers=!1,this._changes=a.styleChanges||new Tr,this.dispatcher=a.dispatcher?a.dispatcher:new s.D(s.c$(),this),a.imageManager?this.imageManager=a.imageManager:(this.imageManager=new Cs(this.map._spriteFormat),this.imageManager.setEventedParent(this)),this.imageManager.addScope(this.scope),this.glyphManager=a.glyphManager?a.glyphManager:new s.d0(n._requestManager,a.localFontFamily?s.d1.all:a.localIdeographFontFamily?s.d1.ideographs:s.d1.none,a.localFontFamily||a.localIdeographFontFamily),a.modelManager?this.modelManager=a.modelManager:(this.modelManager=new Zx(n._requestManager),this.modelManager.setEventedParent(this)),this._layers={},this._sourceCaches={},this._otherSourceCaches={},this._symbolSourceCaches={},this._loaded=!1,this._precompileDone=!1,this._shouldPrecompile=!1,this._availableImages=[],this._availableModels={},this._order=[],this._markersNeedUpdate=!1,this.options=a.configOptions?a.configOptions:new Map,this._configDependentLayers=a.configDependentLayers?a.configDependentLayers:new Set,this._config=a.config,this._styleColorTheme={lut:null,lutLoading:!1,lutLoadingCorrelationID:0,colorTheme:null,colorThemeOverride:a.colorThemeOverride},this._styleColorThemeForScope={},this._initialConfig=a.initialConfig,this.dispatcher.broadcast("setReferrer",s.d2());const f=this;this._rtlTextPluginCallback=js.registerForPluginStateChange(g=>{f.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:g.pluginStatus,pluginURL:g.pluginURL},(y,b)=>{if(s.d3(y),b&&b.every(E=>E))for(const E in f._sourceCaches){const A=f._sourceCaches[E],R=A.getSource().type;R!=="vector"&&R!=="geojson"||A.reload()}})}),this.on("data",g=>{if(g.dataType!=="source"||g.sourceDataType!=="metadata")return;const y=this.getOwnSource(g.sourceId);if(y&&y.vectorLayerIds)for(const b in this._layers){const E=this._layers[b];E.source===y.id&&this._validateLayer(E)}})}load(n){return n?(typeof n=="string"?this.loadURL(n):this.loadJSON(n),this):this}_getGlobalId(n){if(!n)return null;if(typeof n=="string"){if(s.j(n))return n;const a=s.d4(n);if(!a.startsWith("http"))try{return new URL(a,location.href).toString()}catch{return a}return a}return`json://${s.d5(JSON.stringify(n))}`}_diffStyle(n,a,f){this.globalId=this._getGlobalId(n);const g=(y,b)=>{try{b(null,this.setState(y,f))}catch(E){b(E,!1)}};if(typeof n=="string"){const y=this.map._requestManager.normalizeStyleURL(n),b=this.map._requestManager.transformRequest(y,s.R.Style);s.n(b,(E,A)=>{E?this.fire(new s.z(E)):A&&g(A,a)})}else typeof n=="object"&&g(n,a)}loadURL(n,a={}){this.fire(new s.A("dataloading",{dataType:"style"}));const f=typeof a.validate=="boolean"?a.validate:!s.j(n);this.globalId=this._getGlobalId(n),n=this.map._requestManager.normalizeStyleURL(n,a.accessToken),this.resolvedImports.add(n);const g=this.importsCache.get(n);if(g)return this._load(g,f);const y=this.map._requestManager.transformRequest(n,s.R.Style);this._request=s.n(y,(b,E)=>{if(this._request=null,b)this.fire(new s.z(b));else if(E)return this.importsCache.set(n,E),this._load(E,f)})}loadJSON(n,a={}){this.fire(new s.A("dataloading",{dataType:"style"})),this.globalId=this._getGlobalId(n),this._request=s.q.frame(()=>{this._request=null,this._load(n,a.validate!==!1)})}loadEmpty(){this.fire(new s.A("dataloading",{dataType:"style"})),this._load(T_,!1)}_loadImports(n,a,f){if(this.importDepth>=4)return s.w("Style doesn't support nesting deeper than 5"),Promise.resolve();const g=[];for(const y of n){const b=this._createFragmentStyle(y),E=new Promise(D=>{b.once("style.import.load",D),b.once("error",D)}).then(()=>this.mergeAll());if(g.push(E),this.resolvedImports.has(y.url)){b.loadEmpty();continue}const A=y.data||this.importsCache.get(y.url);A?(b.loadJSON(A,{validate:a}),this._isInternalStyle(A)&&(b.globalId=null)):y.url?b.loadURL(y.url,{validate:a}):b.loadEmpty();const R={style:b,id:y.id,config:y.config};if(f){const D=this.fragments.findIndex(({id:F})=>F===f);this.fragments=this.fragments.slice(0,D).concat(R).concat(this.fragments.slice(D))}else this.fragments.push(R)}return Promise.allSettled(g)}getImportGlobalIds(n=this,a=new Set){for(const f of n.fragments)f.style.globalId&&a.add(f.style.globalId),this.getImportGlobalIds(f.style,a);return[...a.values()]}_createFragmentStyle(n){const a=this.scope?s.C(n.id,this.scope):n.id;let f;const g=this._initialConfig&&this._initialConfig[a];(n.config||g)&&(f=s.h({},n.config,g));const y=new js(this.map,{scope:a,styleChanges:this._changes,importDepth:this.importDepth+1,importsCache:this.importsCache,resolvedImports:new Set(this.resolvedImports),dispatcher:this.dispatcher,imageManager:this.imageManager,glyphManager:this.glyphManager,modelManager:this.modelManager,config:f,configOptions:this.options,colorThemeOverride:n["color-theme"],configDependentLayers:this._configDependentLayers});return y.setEventedParent(this.map,{style:y}),y}_reloadImports(){this.mergeAll(),this._updateMapProjection(),this.updateConfigDependencies(),this.map._triggerCameraUpdate(this.camera),this.dispatcher.broadcast("setLayers",{layers:this._serializeLayers(this._order),scope:this.scope,options:this.options}),this._shouldPrecompile=this.map._precompilePrograms&&this.isRootStyle()}_isInternalStyle(n){return this.isRootStyle()&&(n.fragment||!!n.schema&&n.fragment!==!1)}_load(n,a){const f=n.indoor?cl(n.schema):n.schema;if(this._isInternalStyle(n)){const b=s.h({},T_,{imports:[{id:"basemap",data:n,url:""}]});return void this._load(b,a)}if(this.updateConfig(this._config,f),a&&Xc(this,Ui(n)))return;this._loaded=!0,this.stylesheet=s.d6(n);const g=()=>{for(const R in n.sources)this.addSource(R,n.sources[R],{validate:!1,isInitialLoad:!0});if(n.iconsets)for(const R in n.iconsets)this.addIconset(R,n.iconsets[R]);n.sprite?this._loadIconset(n.sprite):(this.imageManager.setLoaded(!0,this.scope),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0})),this.setGlyphsUrl(n.glyphs);const b=Dh(this.stylesheet.layers);if(this._order=b.map(R=>R.id),this.stylesheet.light&&s.w("The `light` root property is deprecated, prefer using `lights` with `flat` light type instead."),this.stylesheet.lights)if(this.stylesheet.lights.length===1&&this.stylesheet.lights[0].type==="flat"){const R=this.stylesheet.lights[0];this.light=new Ue(R.properties,R.id)}else this.setLights(this.stylesheet.lights);this.light||(this.light=new Ue(this.stylesheet.light)),this._layers={};for(const R of b){const D=s.db(R,this.scope,this._styleColorTheme.lut,this.options);D.configDependencies.size!==0&&this._configDependentLayers.add(D.fqid),D.setEventedParent(this,{layer:{id:D.id}}),this._layers[D.id]=D;const F=this.getOwnLayerSourceCache(D),N=!!this.directionalLight&&this.directionalLight.shadowsEnabled();F&&D.canCastShadows()&&N&&(F.castsShadows=!0)}this.stylesheet.featuresets&&this.setFeaturesetSelectors(this.stylesheet.featuresets),this.stylesheet.models&&this.addModelURLs(this.stylesheet.models);const E=this.stylesheet.terrain;E&&(this.checkCanvasFingerprintNoise(),this.disableElevatedTerrain||this.terrainSetForDrapingOnly()||this._createTerrain(E,1)),this.stylesheet.fog&&this._createFog(this.stylesheet.fog),this.stylesheet.snow&&this._createSnow(this.stylesheet.snow),this.stylesheet.rain&&this._createRain(this.stylesheet.rain),this.stylesheet.transition&&this.setTransition(this.stylesheet.transition),this.fire(new s.A("data",{dataType:"style"}));const A=this.isRootStyle();n.imports?this._loadImports(n.imports,a).then(()=>{this._reloadImports(),this.fire(new s.A(A?"style.load":"style.import.load"))}).catch(R=>{this.fire(new s.z(new Error("Failed to load imports",R))),this.fire(new s.A(A?"style.load":"style.import.load"))}):(this._reloadImports(),this.fire(new s.A(A?"style.load":"style.import.load")))};this._styleColorTheme.colorTheme=this.stylesheet["color-theme"];const y=this._styleColorTheme.colorThemeOverride?this._styleColorTheme.colorThemeOverride:this._styleColorTheme.colorTheme;if(y){const b=this._evaluateColorThemeData(y);this._loadColorTheme(b).then(()=>{g()}).catch(E=>{s.w(`Couldn't load color theme from the stylesheet: ${E}`),g()})}else this._styleColorTheme.lut=null,g()}isRootStyle(){return this.importDepth===0}mergeAll(){let n,a,f,g,y,b,E,A,R,D;const F={};this.terrain&&this.terrain.scope!==this.scope&&delete this.terrain,this.forEachFragmentStyle(N=>{if(N.stylesheet){if(N.light!=null&&(n=N.light),N.stylesheet.lights)for(const j of N.stylesheet.lights)j.type==="ambient"&&N.ambientLight!=null&&(a=N.ambientLight),j.type==="directional"&&N.directionalLight!=null&&(f=N.directionalLight);g=this._prioritizeTerrain(g,N.terrain,N.stylesheet.terrain),N.stylesheet.fog&&N.fog!=null&&(y=N.fog),N.stylesheet.snow&&N.snow!=null&&(b=N.snow),N.stylesheet.rain&&N.rain!=null&&(E=N.rain),N.stylesheet.camera!=null&&(D=N.stylesheet.camera),N.stylesheet.projection!=null&&(A=N.stylesheet.projection),N.stylesheet.transition!=null&&(R=N.stylesheet.transition),F[N.scope]=N._styleColorTheme}}),this.light=n,this.ambientLight=a,this.directionalLight=f,this.fog=y,this.snow=b,this.rain=E,this._styleColorThemeForScope=F,g===null?delete this.terrain:this.terrain=g,this.camera=D||{"camera-projection":"perspective"},this.projection=A||{name:"mercator"},this.transition=s.h({},E_,R),this.mergeSources(),this.mergeLayers()}forEachFragmentStyle(n){const a=f=>{for(const g of f.fragments)a(g.style);n(f)};a(this)}_prioritizeTerrain(n,a,f){const g=n&&n.drapeRenderMode===0;return f===null?a&&a.drapeRenderMode===0?a:g?n:null:a!=null&&(!n||g||a&&a.drapeRenderMode===1)?a:n}mergeTerrain(){let n;this.terrain&&this.terrain.scope!==this.scope&&delete this.terrain,this.forEachFragmentStyle(a=>{n=this._prioritizeTerrain(n,a.terrain,a.stylesheet.terrain)}),n===null?delete this.terrain:this.terrain=n}mergeProjection(){let n;this.forEachFragmentStyle(a=>{a.stylesheet.projection!=null&&(n=a.stylesheet.projection)}),this.projection=n||{name:"mercator"}}mergeSources(){const n={},a={},f={};this.forEachFragmentStyle(g=>{for(const y in g._sourceCaches){const b=s.C(y,g.scope);n[b]=g._sourceCaches[y]}for(const y in g._otherSourceCaches){const b=s.C(y,g.scope);a[b]=g._otherSourceCaches[y]}for(const y in g._symbolSourceCaches){const b=s.C(y,g.scope);f[b]=g._symbolSourceCaches[y]}}),this._mergedSourceCaches=n,this._mergedOtherSourceCaches=a,this._mergedSymbolSourceCaches=f}mergeLayers(){const n={},a=[],f={};this._mergedSlots=[],this._has3DLayers=!1,this._hasCircleLayers=!1,this._hasSymbolLayers=!1,this.forEachFragmentStyle(y=>{for(const b of y._order){const E=y._layers[b];if(E.type==="slot"){const A=s.d7(b);if(n[A])continue;n[A]=[]}E.slot&&n[E.slot]?n[E.slot].push(E):a.push(E)}}),this._mergedOrder=[];const g=(y=[])=>{for(const b of y)if(b.type==="slot"){const E=s.d7(b.id);n[E]&&g(n[E]),this._mergedSlots.push(E)}else{const E=s.C(b.id,b.scope);this._mergedOrder.push(E),f[E]=b,b.is3D(!!this.terrain)&&(this._has3DLayers=!0),b.type==="circle"&&(this._hasCircleLayers=!0),b.type==="symbol"&&(this._hasSymbolLayers=!0),b.type==="clip"&&(this._clipLayerPresent=!0)}};g(a),this._mergedOrder.sort((y,b)=>{const E=f[y],A=f[b];return E.hasInitialOcclusionOpacityProperties?A.is3D(!!this.terrain)?1:0:E.is3D(!!this.terrain)&&A.hasInitialOcclusionOpacityProperties?-1:0}),this._mergedLayers=f,this.updateDrapeFirstLayers(),this._buildingIndex.processLayersChanged()}terrainSetForDrapingOnly(){return!!this.terrain&&this.terrain.drapeRenderMode===0}getCamera(){return this.stylesheet.camera}setCamera(n){return this.stylesheet.camera=s.h({},this.stylesheet.camera,n),this.camera=this.stylesheet.camera,this}_evaluateColorThemeData(n){return n.data?function(a,f,g,y){const b=s.h({},f);for(const A of Object.keys(s.a5.colorTheme))b[A]===void 0&&(b[A]=s.a5.colorTheme[A].default);const E=new s.a6(zp,a,new Map(g));return E.setTransitionOrValue(b,g),E.untransitioned().possiblyEvaluate(new s.aa(0,{worldview:void 0}))}(this.scope,n,this.options).get("data"):null}_loadColorTheme(n){this._styleColorTheme.lutLoading=!0,this._styleColorTheme.lutLoadingCorrelationID+=1;const a=this._styleColorTheme.lutLoadingCorrelationID;return new Promise((f,g)=>{const y="data:image/png;base64,";if(!n||n.length===0)return this._styleColorTheme.lut=null,this._styleColorTheme.lutLoading=!1,void f();let b=n;b.startsWith(y)||(b=y+b);const E=s.I.from("mapbox-reserved-lut"),A=new Image;A.src=b,A.onerror=()=>{this._styleColorTheme.lutLoading=!1,g(new Error("Failed to load image data"))},A.onload=()=>{if(this._styleColorTheme.lutLoadingCorrelationID!==a)return void f();this._styleColorTheme.lutLoading=!1;const{width:R,height:D,data:F}=s.q.getImageData(A);if(D>32)return void g(new Error("The height of the image must be less than or equal to 32 pixels."));if(R!==D*D)return void g(new Error("The width of the image must be equal to the height squared."));this.getImage(E)&&this.removeImage(E),this.addImage(E,{data:new s.r({width:R,height:D},F),pixelRatio:1,sdf:!1,usvg:!1,version:0});const N=this.imageManager.getImage(E,this.scope);N?(this._styleColorTheme.lut={image:N.data,data:n},f()):g(new Error("Missing LUT image."))}})}getLut(n){const a=this._styleColorThemeForScope[n];return a?a.lut:null}setProjection(n){n?this.stylesheet.projection=n:delete this.stylesheet.projection,this.mergeProjection(),this._updateMapProjection()}applyProjectionUpdate(){this._loaded&&(this.dispatcher.broadcast("setProjection",this.map.transform.projectionOptions),this.map.transform.projection.requiresDraping?(this.getTerrain()||this.stylesheet.terrain)&&!this.disableElevatedTerrain||this.setTerrainForDraping():this.terrainSetForDrapingOnly()&&this.setTerrain(null,0))}_updateMapProjection(){this.isRootStyle()&&(this.map._useExplicitProjection?this.applyProjectionUpdate():this.map._prioritizeAndUpdateProjection(null,this.projection))}_loadSprite(n){this._spriteRequest=function(a,f,g){let y,b,E;const A=s.q.devicePixelRatio>1?"@2x":"";let R=s.n(f.transformRequest(f.normalizeSpriteURL(a,A,".json"),s.R.SpriteJSON),(N,j)=>{R=null,E||(E=N,y=j,F())}),D=s.o(f.transformRequest(f.normalizeSpriteURL(a,A,".png"),s.R.SpriteImage),(N,j)=>{D=null,E||(E=N,b=j,F())});function F(){if(E)g(E);else if(y&&b){const N=s.q.getImageData(b),j={};for(const X in y){const{width:W,height:K,x:ee,y:ie,sdf:fe,pixelRatio:_e,stretchX:we,stretchY:be,content:ve}=y[X],ye=new s.r({width:W,height:K});s.r.copy(N,ye,{x:ee,y:ie},{x:0,y:0},{width:W,height:K},null),j[X]={data:ye,pixelRatio:_e,sdf:fe,stretchX:we,stretchY:be,content:ve,usvg:!1}}g(null,j)}}return{cancel(){R&&(R.cancel(),R=null),D&&(D.cancel(),D=null)}}}(n,this.map._requestManager,(a,f)=>{if(this._spriteRequest=null,a)this.fire(new s.z(a));else if(f){const g=new Map;for(const y in f)g.set(s.I.from(y),f[y]);this.addImages(g)}this.imageManager.setLoaded(!0,this.scope),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0}),this.fire(new s.A("data",{dataType:"style"}))})}addIconset(n,a){if(a.type==="sprite")return void this._loadSprite(a.url);const f=this.getOwnSourceCache(a.source);if(!f)return void this.fire(new s.z(new Error(`Source "${a.source}" as specified by iconset "${n}" does not exist and cannot be used as an iconset source`)));const g=f.getSource();if(g.type!=="raster-array")return void this.fire(new s.z(new Error(`Source "${a.source}" as specified by iconset "${n}" is not a "raster-array" source and cannot be used as an iconset source`)));g.partial=!1;const y=new Yx(n,this.scope,f);this.imageManager.addImageProvider(y,this.scope)}removeIconset(n){this.imageManager.removeImageProvider(n,this.scope)}_loadIconset(n){if(!s.j(n)&&this.map._spriteFormat!=="icon_set"||this.map._spriteFormat==="raster")return void this._loadSprite(n);const a=this.map._spriteFormat==="auto";var f,g;this._spriteRequest=(g=(y,b)=>{if(this._spriteRequest=null,y)a?this._loadSprite(n):this.fire(new s.z(y));else if(b){const E=new Map;for(const A in b)E.set(s.I.from(A),b[A]);this.addImages(E)}this.imageManager.setLoaded(!0,this.scope),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0}),this.fire(new s.A("data",{dataType:"style"}))},s.br((f=this.map._requestManager).transformRequest(f.normalizeIconsetURL(n),s.R.Iconset),(y,b)=>{if(y)return void g(y);const E={},A=s.c_(new s.bq(b));for(const R of A.icons){const D={version:1,pixelRatio:s.q.devicePixelRatio,content:F2(R),stretchX:R.metadata?Xx(R.metadata.stretch_x_areas):void 0,stretchY:R.metadata?Xx(R.metadata.stretch_y_areas):void 0,sdf:!1,usvg:!0,icon:R};E[R.name]=D}g(null,E)}))}_validateLayer(n){const a=this.getOwnSource(n.source);if(!a)return;const f=n.sourceLayer;f&&(a.type==="geojson"||a.vectorLayerIds&&a.vectorLayerIds.indexOf(f)===-1)&&this.fire(new s.z(new Error(`Source layer "${f}" does not exist on source "${a.id}" as specified by style layer "${n.id}"`)))}loaded(){if(!this._loaded||Object.keys(this._changes.getUpdatedSourceCaches()).length)return!1;for(const n in this._sourceCaches)if(!this._sourceCaches[n].loaded())return!1;if(!this.imageManager.isLoaded()||this.imageManager.hasPatternsInFlight()||!this.modelManager.isLoaded()||this._styleColorTheme.lutLoading)return!1;for(const{style:n}of this.fragments)if(!n.loaded())return!1;return!0}_serializeImports(){if(this.stylesheet.imports)return this.stylesheet.imports.map((n,a)=>{const f=this.fragments[a];return f&&f.style&&(n.data=f.style.serialize()),n})}_serializeSources(){const n={};for(const a in this._sourceCaches){const f=this._sourceCaches[a].getSource();n[f.id]||(n[f.id]=f.serialize())}return n}_serializeLayers(n){const a=[];for(const f of n){const g=this._layers[f];g&&g.type!=="custom"&&a.push(g.serialize())}return a}hasLightTransitions(){return!(!this.light||!this.light.hasTransition())||!(!this.ambientLight||!this.ambientLight.hasTransition())||!(!this.directionalLight||!this.directionalLight.hasTransition())}hasFogTransition(){return!!this.fog&&this.fog.hasTransition()}hasSnowTransition(){return!!this.snow&&this.snow.hasTransition()}hasRainTransition(){return!!this.rain&&this.rain.hasTransition()}hasTransitions(){if(this.hasLightTransitions()||this.hasFogTransition()||this.hasSnowTransition()||this.hasRainTransition())return!0;for(const n in this._sourceCaches)if(this._sourceCaches[n].hasTransition())return!0;for(const n in this._layers)if(this._layers[n].hasTransition())return!0;return!1}get order(){return this.terrain?this._drapedFirstOrder:this._mergedOrder}_getOrder(n){return n?this.order:this._mergedOrder}isLayerDraped(n){return!!this.terrain&&n.isDraped(this.getLayerSourceCache(n))}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading")}_checkLayer(n){const a=this.getOwnLayer(n);if(a)return a;this.fire(new s.z(new Error(`The layer '${n}' does not exist in the map's style.`)))}_checkSource(n){const a=this.getOwnSource(n);if(a)return a;this.fire(new s.z(new Error(`The source '${n}' does not exist in the map's style.`)))}precompilePrograms(n,a){const f=this.map.painter;if(f)for(let g=n.minzoom||0;g<(n.maxzoom||25.5);g++){const y=n.getProgramIds();if(y)for(const b of y){const E=n.getDefaultProgramParams(b,a.zoom,this._styleColorTheme.lut);E&&(f.style=this,this.fog&&(f._fogVisible=!0,E.overrideFog=!0,f.getOrCreateProgram(b,E)),f._fogVisible=!1,E.overrideFog=!1,f.getOrCreateProgram(b,E),(this.stylesheet.terrain||this.stylesheet.projection&&this.stylesheet.projection.name==="globe")&&(E.overrideRtt=!0,f.getOrCreateProgram(b,E)))}}}update(n){if(!this._loaded)return;this.ambientLight&&this.ambientLight.recalculate(n),this.directionalLight&&this.directionalLight.recalculate(n);const a=this.calculateLightsBrightness();n.brightness=a||0,a!==this._brightness&&(this._brightness=a,this.dispatcher.broadcast("setBrightness",a)),n.worldview!==this._worldview&&(this._worldview=n.worldview,this.dispatcher.broadcast("setWorldview",this._worldview));const f=this._changes.isDirty();let g=!1;if(this._changes.isDirty()){const E=this._changes.getLayerUpdatesByScope();for(const A in E){const{updatedIds:R,removedIds:D}=E[A];(R||D)&&(this._updateWorkerLayers(A,R,D),g=!0)}this.updateSourceCaches(),this._updateTilesForChangedImages(),this.updateLayers(n),this.light&&this.light.updateTransitions(n),this.ambientLight&&this.ambientLight.updateTransitions(n),this.directionalLight&&this.directionalLight.updateTransitions(n),this.fog&&this.fog.updateTransitions(n),this.snow&&this.snow.updateTransitions(n),this.rain&&this.rain.updateTransitions(n),this._changes.reset()}const y={};for(const E in this._mergedSourceCaches){const A=this._mergedSourceCaches[E];y[E]=A.used,A.used=!1,A.tileCoverLift=0}for(const E of this._mergedOrder){const A=this._mergedLayers[E];if(A.recalculate(n,this._availableImages),!A.isHidden(n.zoom)){const R=this.getLayerSourceCache(A);R&&(R.used=!0,R.tileCoverLift=Math.max(R.tileCoverLift,A.tileCoverLift()))}!this._precompileDone&&this._shouldPrecompile&&("requestIdleCallback"in window?requestIdleCallback(()=>{this.precompilePrograms(A,n)}):this.precompilePrograms(A,n))}this._shouldPrecompile&&(this._precompileDone=!0),this.terrain&&g&&this.mergeLayers();const b=this.imageManager.getPendingImageProviders();for(const E of b)E.sourceCache.used=!0;for(const E in y){const A=this._mergedSourceCaches[E];y[E]!==A.used&&A.getSource().fire(new s.A("data",{sourceDataType:"visibility",dataType:"source",sourceId:A.getSource().id}))}this.light&&this.light.recalculate(n),this.terrain&&this.terrain.recalculate(n),this.fog&&this.fog.recalculate(n),this.snow&&this.snow.recalculate(n),this.rain&&this.rain.recalculate(n),this.z=n.zoom,this._markersNeedUpdate&&(this._updateMarkersOpacity(),this._markersNeedUpdate=!1),this.imageManager.clearUpdatedImages(this.scope),f&&this.fire(new s.A("data",{dataType:"style"}))}updateImageProviders(){const n=this.imageManager.getPendingImageProviders();for(const a of n){const f=a.resolvePendingRequests(),g=this.getFragmentStyle(a.scope);g&&g.addImages(f)}}_updateTilesForChangedImages(){const n={};for(const a in this._mergedSourceCaches){const f=this._mergedSourceCaches[a].getSource().scope;n[f]=n[f]||this._changes.getUpdatedImages(f),n[f].length!==0&&this._mergedSourceCaches[a].reloadTilesForDependencies(["icons","patterns"],n[f])}for(const a in n)this._changes.resetUpdatedImages(a)}_updateWorkerLayers(n,a,f){const g=this.getFragmentStyle(n);g&&this.dispatcher.broadcast("updateLayers",{layers:a?g._serializeLayers(a):[],scope:n,removedIds:f||[],options:g.options})}setState(n,a){if(this._checkLoaded(),Xc(this,Ui(n)))return!1;(n=s.d6(n)).layers=Dh(n.layers);const f=function(b,E){if(!b)return[{command:ur.setStyle,args:[E]}];let A=[];try{if(!s.bv(b.version,E.version))return[{command:ur.setStyle,args:[E]}];if(s.bv(b.center,E.center)||A.push({command:ur.setCenter,args:[E.center]}),s.bv(b.zoom,E.zoom)||A.push({command:ur.setZoom,args:[E.zoom]}),s.bv(b.bearing,E.bearing)||A.push({command:ur.setBearing,args:[E.bearing]}),s.bv(b.pitch,E.pitch)||A.push({command:ur.setPitch,args:[E.pitch]}),s.bv(b.sprite,E.sprite)||A.push({command:ur.setSprite,args:[E.sprite]}),s.bv(b.glyphs,E.glyphs)||A.push({command:ur.setGlyphs,args:[E.glyphs]}),s.bv(b.imports,E.imports)||function(j=[],X=[],W){X=X||[];const K=(j=j||[]).map(Vc),ee=X.map(Vc),ie=j.reduce(Xl,{}),fe=X.reduce(Xl,{}),_e=K.slice();let we,be,ve,ye;for(we=0,be=0;we<K.length;we++)ve=K[we],fe.hasOwnProperty(ve)?be++:(W.push({command:ur.removeImport,args:[ve]}),_e.splice(_e.indexOf(ve,be),1));for(we=0,be=0;we<ee.length;we++)ve=ee[ee.length-1-we],_e[_e.length-1-we]!==ve&&(ie.hasOwnProperty(ve)?(W.push({command:ur.removeImport,args:[ve]}),_e.splice(_e.lastIndexOf(ve,_e.length-be),1)):be++,ye=_e[_e.length-we],W.push({command:ur.addImport,args:[fe[ve],ye]}),_e.splice(_e.length-we,0,ve));for(const Se of X){const Ee=ie[Se.id];Ee&&(delete Ee.data,s.bv(Ee,Se)||W.push({command:ur.updateImport,args:[Se.id,Se]}))}}(b.imports,E.imports,A),s.bv(b.transition,E.transition)||A.push({command:ur.setTransition,args:[E.transition]}),s.bv(b.light,E.light)||A.push({command:ur.setLight,args:[E.light]}),s.bv(b.fog,E.fog)||A.push({command:ur.setFog,args:[E.fog]}),s.bv(b.snow,E.snow)||A.push({command:ur.setSnow,args:[E.snow]}),s.bv(b.rain,E.rain)||A.push({command:ur.setRain,args:[E.rain]}),s.bv(b.projection,E.projection)||A.push({command:ur.setProjection,args:[E.projection]}),s.bv(b.lights,E.lights)||A.push({command:ur.setLights,args:[E.lights]}),s.bv(b.camera,E.camera)||A.push({command:ur.setCamera,args:[E.camera]}),s.bv(b.iconsets,E.iconsets)||function(j,X,W){let K;for(K in X=X||{},j=j||{})j.hasOwnProperty(K)&&(X.hasOwnProperty(K)||W.push({command:ur.removeIconset,args:[K]}));for(K in X){if(!X.hasOwnProperty(K))continue;const ee=X[K];j.hasOwnProperty(K)?s.bv(j[K],ee)||(W.push({command:ur.removeIconset,args:[K]}),W.push({command:ur.addIconset,args:[K,ee]})):W.push({command:ur.addIconset,args:[K,ee]})}}(b.iconsets,E.iconsets,A),!s.bv(b["color-theme"],E["color-theme"]))return[{command:ur.setStyle,args:[E]}];const R={},D=[];(function(j,X,W,K){let ee;for(ee in X=X||{},j=j||{})j.hasOwnProperty(ee)&&(X.hasOwnProperty(ee)||Lu(ee,W,K));for(ee in X){if(!X.hasOwnProperty(ee))continue;const ie=X[ee];j.hasOwnProperty(ee)?s.bv(j[ee],ie)||(j[ee].type==="geojson"&&ie.type==="geojson"&&k2(j,X,ee)?W.push({command:ur.setGeoJSONSourceData,args:[ee,ie.data]}):Lh(ee,X,W,K)):Ap(ee,X,W)}})(b.sources,E.sources,D,R);const F=[];b.layers&&b.layers.forEach(j=>{j.source&&R[j.source]?A.push({command:ur.removeLayer,args:[j.id]}):F.push(j)});let N=b.terrain;N&&R[N.source]&&(A.push({command:ur.setTerrain,args:[void 0]}),N=void 0),A=A.concat(D),s.bv(N,E.terrain)||A.push({command:ur.setTerrain,args:[E.terrain]}),function(j,X,W){X=X||[];const K=(j=j||[]).map(Vc),ee=X.map(Vc),ie=j.reduce(Xl,{}),fe=X.reduce(Xl,{}),_e=K.slice(),we=Object.create(null);let be,ve,ye,Se,Ee,Fe,je;for(be=0,ve=0;be<K.length;be++)ye=K[be],fe.hasOwnProperty(ye)?ve++:(W.push({command:ur.removeLayer,args:[ye]}),_e.splice(_e.indexOf(ye,ve),1));for(be=0,ve=0;be<ee.length;be++)ye=ee[ee.length-1-be],_e[_e.length-1-be]!==ye&&(ie.hasOwnProperty(ye)?(W.push({command:ur.removeLayer,args:[ye]}),_e.splice(_e.lastIndexOf(ye,_e.length-ve),1)):ve++,Fe=_e[_e.length-be],W.push({command:ur.addLayer,args:[fe[ye],Fe]}),_e.splice(_e.length-be,0,ye),we[ye]=!0);for(be=0;be<ee.length;be++)if(ye=ee[be],Se=ie[ye],Ee=fe[ye],!we[ye]&&!s.bv(Se,Ee))if(s.bv(Se.source,Ee.source)&&s.bv(Se["source-layer"],Ee["source-layer"])&&s.bv(Se.type,Ee.type)){for(je in Nh(Se.layout,Ee.layout,W,ye,null,ur.setLayoutProperty),Nh(Se.paint,Ee.paint,W,ye,null,ur.setPaintProperty),s.bv(Se.slot,Ee.slot)||W.push({command:ur.setSlot,args:[ye,Ee.slot]}),s.bv(Se.filter,Ee.filter)||W.push({command:ur.setFilter,args:[ye,Ee.filter]}),s.bv(Se.minzoom,Ee.minzoom)&&s.bv(Se.maxzoom,Ee.maxzoom)||W.push({command:ur.setLayerZoomRange,args:[ye,Ee.minzoom,Ee.maxzoom]}),Se)Se.hasOwnProperty(je)&&je!=="layout"&&je!=="paint"&&je!=="filter"&&je!=="metadata"&&je!=="minzoom"&&je!=="maxzoom"&&je!=="slot"&&(je.indexOf("paint.")===0?Nh(Se[je],Ee[je],W,ye,je.slice(6),ur.setPaintProperty):s.bv(Se[je],Ee[je])||W.push({command:ur.setLayerProperty,args:[ye,je,Ee[je]]}));for(je in Ee)Ee.hasOwnProperty(je)&&!Se.hasOwnProperty(je)&&je!=="layout"&&je!=="paint"&&je!=="filter"&&je!=="metadata"&&je!=="minzoom"&&je!=="maxzoom"&&je!=="slot"&&(je.indexOf("paint.")===0?Nh(Se[je],Ee[je],W,ye,je.slice(6),ur.setPaintProperty):s.bv(Se[je],Ee[je])||W.push({command:ur.setLayerProperty,args:[ye,je,Ee[je]]}))}else W.push({command:ur.removeLayer,args:[ye]}),Fe=_e[_e.lastIndexOf(ye)+1],W.push({command:ur.addLayer,args:[Ee,Fe]})}(F,E.layers,A)}catch(R){console.warn("Unable to compute style diff:",R),A=[{command:ur.setStyle,args:[E]}]}return A}(this.serialize(),n).filter(b=>!(b.command in Kx));if(f.length===0)return!1;const g=f.filter(b=>!(b.command in S_));if(g.length>0)throw new Error(`Unimplemented: ${g.map(b=>b.command).join(", ")}.`);const y=[];return f.forEach(b=>{y.push(this[b.command](...b.args))}),a&&Promise.all(y).then(a).catch(a),this.stylesheet=n,this.mergeAll(),this.dispatcher.broadcast("setLayers",{layers:this._serializeLayers(this._order),scope:this.scope,options:this.options}),!0}_updateWorkerImages(){this._availableImages=this.imageManager.listImages(this.scope),this.dispatcher.broadcast("setImages",{scope:this.scope,images:this._availableImages})}_updateWorkerModels(){this._availableModels=this.modelManager.getModelURIs(this.scope),this.dispatcher.broadcast("setModels",{scope:this.scope,models:this._availableModels})}addImages(n){for(const[a,f]of n.entries()){if(this.getImage(a))return this.fire(new s.z(new Error(`An image with the name "${a.name}" already exists.`)));this.imageManager.addImage(a,this.scope,f),this._changes.updateImage(a,this.scope)}return this._updateWorkerImages(),this.fire(new s.A("data",{dataType:"style"})),this}addImage(n,a){return this.getImage(n)?this.fire(new s.z(new Error(`An image with the name "${n.name}" already exists.`))):(this.imageManager.addImage(n,this.scope,a),this._changes.updateImage(n,this.scope),this._updateWorkerImages(),this.fire(new s.A("data",{dataType:"style"})),this)}updateImage(n,a,f=!1){this.imageManager.updateImage(n,this.scope,a),f&&(this._changes.updateImage(n,this.scope),this._updateWorkerImages(),this.fire(new s.A("data",{dataType:"style"})))}getImage(n){return this.imageManager.getImage(n,this.scope)}removeImage(n){return this.getImage(n)?(this.imageManager.removeImage(n,this.scope),this._changes.updateImage(n,this.scope),this._updateWorkerImages(),this.fire(new s.A("data",{dataType:"style"})),this):this.fire(new s.z(new Error("No image with this name exists.")))}listImages(){return this._checkLoaded(),this._availableImages.slice()}addModelURLs(n){return this.modelManager.addModelURLs(n,this.scope),this._updateWorkerModels(),this.fire(new s.A("data",{dataType:"style"})),this}addModel(n,a,f={}){return this._checkLoaded(),this._validate(ge,`models.${n}`,a,null,f)||(this.modelManager.addModel(n,a,this.scope),this.fire(new s.A("data",{dataType:"style"}))),this}hasModel(n){return this.modelManager.hasModel(n,this.scope)}removeModel(n){return this.hasModel(n)?(this.modelManager.removeModel(n,this.scope),this.fire(new s.A("data",{dataType:"style"})),this):this.fire(new s.z(new Error("No model with this ID exists.")))}listModels(){return this._checkLoaded(),this.modelManager.listModels(this.scope)}addSource(n,a,f={}){if(this._checkLoaded(),this.getOwnSource(n)!==void 0)throw new Error(`There is already a source with ID "${n}".`);if(!a.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(a).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(a.type)>=0&&this._validate(yo,`sources.${n}`,a,null,f))return;this.map&&this.map._collectResourceTiming&&(a.collectResourceTiming=!0);const g=Ah(n,a,this.dispatcher,this);g.scope=this.scope,g.setEventedParent(this,()=>({isSourceLoaded:this._isSourceCacheLoaded(g.id),source:g.serialize(),sourceId:g.id}));const y=b=>{const E=(b?"symbol:":"other:")+g.id,A=s.C(E,this.scope),R=this._sourceCaches[E]=new oo(A,g,b);(b?this._symbolSourceCaches:this._otherSourceCaches)[g.id]=R,R.onAdd(this.map)};y(!1),a.type!=="vector"&&a.type!=="geojson"||y(!0),g.onAdd&&g.onAdd(this.map),f.isInitialLoad||(this.mergeSources(),this._changes.setDirty())}removeSource(n){this._checkLoaded();const a=this.getOwnSource(n);if(!a)throw new Error("There is no source with this ID");for(const g in this._layers)if(this._layers[g].source===n)return this.fire(new s.z(new Error(`Source "${n}" cannot be removed while layer "${g}" is using it.`)));if(this.terrain&&this.terrain.scope===this.scope&&this.terrain.get().source===n)return this.fire(new s.z(new Error(`Source "${n}" cannot be removed while terrain is using it.`)));if(this.stylesheet.iconsets){const g=Object.entries(this.stylesheet.iconsets).find(([y,b])=>b.type==="source"&&b.source===n);if(g)return this.fire(new s.z(new Error(`Source "${n}" cannot be removed while iconset "${g[0]}" is using it.`)))}const f=this.getOwnSourceCaches(n);for(const g of f){const y=s.d7(g.id);delete this._sourceCaches[y],this._changes.discardSourceCacheUpdate(g.id),g.fire(new s.A("data",{sourceDataType:"metadata",dataType:"source",sourceId:g.getSource().id})),g.setEventedParent(null),g.clearTiles()}return delete this._otherSourceCaches[n],delete this._symbolSourceCaches[n],this.mergeSources(),a.setEventedParent(null),a.onRemove&&a.onRemove(this.map),this._changes.setDirty(),this}setGeoJSONSourceData(n,a){this._checkLoaded(),this.getOwnSource(n).setData(a),this._changes.setDirty()}getOwnSource(n){const a=this.getOwnSourceCache(n);return a&&a.getSource()}getOwnSources(){const n=[];for(const a in this._otherSourceCaches){const f=this.getOwnSourceCache(a);f&&n.push(f.getSource())}return n}areTilesLoaded(){const n=this._mergedSourceCaches;for(const a in n){const f=n[a]._tiles;for(const g in f){const y=f[g];if(y.state!=="loaded"&&y.state!=="errored")return!1}}return!0}setLights(n){if(this._checkLoaded(),!n)return delete this.ambientLight,void delete this.directionalLight;const a=this._getTransitionParameters();for(const y of n){if(this._validate(nl,"lights",y))return;switch(y.type){case"ambient":if(this.ambientLight){const b=this.ambientLight;b.set(y),b.updateTransitions(a)}else this.ambientLight=new Rr(y,On||(On=new s.a7({color:new s.a8(s.a5.properties_light_ambient.color),"color-use-theme":new s.a8({type:"string",default:"default","property-type":"data-constant"}),intensity:new s.a8(s.a5.properties_light_ambient.intensity)})),this.scope,this.options);break;case"directional":if(this.directionalLight){const b=this.directionalLight;b.set(y),b.updateTransitions(a)}else this.directionalLight=new Rr(y,Ur||(Ur=new s.a7({direction:new s.an(s.a5.properties_light_directional.direction),color:new s.a8(s.a5.properties_light_directional.color),"color-use-theme":new s.a8({type:"string",default:"default","property-type":"data-constant"}),intensity:new s.a8(s.a5.properties_light_directional.intensity),"cast-shadows":new s.a8(s.a5.properties_light_directional["cast-shadows"]),"shadow-quality":new s.a8(s.a5.properties_light_directional["shadow-quality"]),"shadow-intensity":new s.a8(s.a5.properties_light_directional["shadow-intensity"])})),this.scope,this.options)}}const f=Object.assign(a,{worldview:this.map.getWorldview()}),g=new s.aa(this.z||0,f);this.ambientLight&&this.ambientLight.recalculate(g),this.directionalLight&&this.directionalLight.recalculate(g),this._brightness=this.calculateLightsBrightness(),this.dispatcher.broadcast("setBrightness",this._brightness)}calculateLightsBrightness(){const n=this.directionalLight,a=this.ambientLight;if(!n||!a)return;const f=N=>.2126*(N[0]<=.03928?N[0]/12.92:Math.pow((N[0]+.055)/1.055,2.4))+.7152*(N[1]<=.03928?N[1]/12.92:Math.pow((N[1]+.055)/1.055,2.4))+.0722*(N[2]<=.03928?N[2]/12.92:Math.pow((N[2]+.055)/1.055,2.4)),g=n.properties.get("color").toNonPremultipliedRenderColor(null).toArray01(),y=n.properties.get("intensity"),b=n.properties.get("direction"),E=1-s.cR(b.x,b.y,b.z)[2]/90,A=f(g)*y*E,R=a.properties.get("color").toNonPremultipliedRenderColor(null).toArray01(),D=a.properties.get("intensity"),F=f(R)*D;return Number(((A+F)/2).toFixed(6))}getBrightness(){return this._brightness}getLights(){if(!this.enable3dLights())return null;const n=[];return this.directionalLight&&n.push(this.directionalLight.get()),this.ambientLight&&n.push(this.ambientLight.get()),n}enable3dLights(){return!!this.ambientLight&&!!this.directionalLight}getFragmentStyle(n){if(n==null||n===""&&this.isRootStyle())return this;if(s.d8(n)){const a=s.d9(n),f=this.fragments.find(({id:y})=>y===a);if(!f)return;const g=s.d7(n);return f.style.getFragmentStyle(g)}{const a=this.fragments.find(({id:f})=>f===n);return a?a.style:void 0}}setFeaturesetSelectors(n){if(!n)return;const a={},f=(g,y="")=>`${g}::${y}`;this._featuresetSelectors={};for(const g in n){const y=this._featuresetSelectors[g]=[];for(const b of n[g].selectors){if(b.featureNamespace){const A=this.getOwnLayer(b.layer);if(!A){s.w(`Layer is undefined for selector: ${b.layer}`);continue}const R=f(A.source,A.sourceLayer);if(R in a&&a[R]!==b.featureNamespace){s.w(`"featureNamespace ${b.featureNamespace} of featureset ${g}'s selector is not associated to the same source, skip this selector`);continue}a[R]=b.featureNamespace}let E;if(b.properties)for(const A in b.properties){const R=s.X(b.properties[A]);R.result==="success"&&(E=E||{},E[A]=R.value)}y.push({layerId:b.layer,namespace:b.featureNamespace,properties:E,uniqueFeatureID:b._uniqueFeatureID})}}}getFeaturesetDescriptors(n){const a=this.getFragmentStyle(n);if(!a||!a.stylesheet.featuresets)return[];const f=[];for(const g in a.stylesheet.featuresets)f.push({featuresetId:g,importId:a.scope?a.scope:void 0});return f}getFeaturesetLayers(n,a){const f=this.getFragmentStyle(a),g=f.stylesheet.featuresets;if(!g||!g[n])return this.fire(new s.z(new Error(`The featureset '${n}' does not exist in the map's style and cannot be queried.`))),[];const y=[];for(const b of g[n].selectors){const E=f.getOwnLayer(b.layer);E&&y.push(E)}return y}getConfigProperty(n,a){const f=this.getFragmentStyle(n);if(!f)return null;const g=s.C(a,f.scope),y=f.options.get(g),b=y?y.value||y.default:null;return b?b.serialize():null}setConfigProperty(n,a,f){const g=this.getFragmentStyle(n);if(!g)return;const y=g.stylesheet.indoor?cl(g.stylesheet.schema):g.stylesheet.schema;if(!y||!y[a])return;const b=s.X(f);if(b.result!=="success")return void Xc(this,b.value);const E=b.value.expression,A=s.C(a,g.scope),R=g.options.get(A);if(!R)return;let D;const{minValue:F,maxValue:N,stepValue:j,type:X,values:W}=y[a],K=s.X(y[a].default);K.result==="success"&&(D=K.value.expression),D?(this.options.set(A,Object.assign({},R,{value:E,default:D,minValue:F,maxValue:N,stepValue:j,type:X,values:W})),this.updateConfigDependencies(a)):this.fire(new s.z(new Error(`No schema defined for the config option "${a}" in the "${n}" fragment.`)))}getConfig(n){const a=this.getFragmentStyle(n);if(!a)return null;const f=a.stylesheet.schema;if(!f)return null;const g={};for(const y in f){const b=s.C(y,a.scope),E=a.options.get(b),A=E?E.value||E.default:null;g[y]=A?A.serialize():null}return g}setConfig(n,a){const f=this.getFragmentStyle(n);f&&(f.updateConfig(a,f.stylesheet.schema),this.updateConfigDependencies())}getSchema(n){const a=this.getFragmentStyle(n);return a?a.stylesheet.schema:null}setSchema(n,a){const f=this.getFragmentStyle(n);f&&(f.stylesheet.schema=a,f.updateConfig(f._config,a),this.updateConfigDependencies())}updateConfig(n,a){if(this._config=n,n||a)if(a)for(const f in a){let g,y;const b=s.X(a[f].default);if(b.result==="success"&&(g=b.value.expression),n&&n[f]!==void 0){const N=s.X(n[f]);N.result==="success"&&(y=N.value.expression)}const{minValue:E,maxValue:A,stepValue:R,type:D,values:F}=a[f];if(g){const N=s.C(f,this.scope);this.options.set(N,{default:g,value:y,minValue:E,maxValue:A,stepValue:R,type:D,values:F})}else this.fire(new s.z(new Error(`No schema defined for config option "${f}".`)))}else this.fire(new s.z(new Error("Attempting to set config for a style without schema.")))}updateConfigDependencies(n){for(const a of this._configDependentLayers){const f=this.getLayer(a);if(f){if(n&&!f.configDependencies.has(n))continue;f.possiblyEvaluateVisibility(),this._updateLayer(f)}}this.ambientLight&&this.ambientLight.updateConfig(this.options),this.directionalLight&&this.directionalLight.updateConfig(this.options),this.fog&&this.fog.updateConfig(this.options),this.snow&&this.snow.updateConfig(this.options),this.rain&&this.rain.updateConfig(this.options),this.forEachFragmentStyle(a=>{const f=a._styleColorTheme.colorThemeOverride?a._styleColorTheme.colorThemeOverride:a._styleColorTheme.colorTheme;if(f){const g=a._evaluateColorThemeData(f);(!a._styleColorTheme.lut&&g!==""||a._styleColorTheme.lut&&g!==a._styleColorTheme.lut.data)&&a.setColorTheme(f)}}),this._changes.setDirty()}addLayer(n,a,f={}){this._checkLoaded();const g=n.id;if(this._layers[g])return void this.fire(new s.z(new Error(`Layer with id "${g}" already exists on this map`)));let y;if(n.type==="custom"){if(Xc(this,s.da(n)))return;y=s.db(n,this.scope,this._styleColorTheme.lut,this.options)}else{if(typeof n.source=="object"&&(this.addSource(g,n.source),n=s.d6(n),n=s.h(n,{source:g})),this._validate(mr,`layers.${g}`,n,{arrayIndex:-1},f))return;y=s.db(n,this.scope,this._styleColorTheme.lut,this.options),this._validateLayer(y),y.setEventedParent(this,{layer:{id:g}})}y.configDependencies.size!==0&&this._configDependentLayers.add(y.fqid);let b=this._order.length;if(a){const D=this._order.indexOf(a);if(D===-1)return void this.fire(new s.z(new Error(`Layer with id "${a}" does not exist on this map.`)));y.slot===this._layers[a].slot?b=D:s.w(`Layer with id "${a}" has a different slot. Layers can only be rearranged within the same slot.`)}this._order.splice(b,0,g),this._layerOrderChanged=!0,this._layers[g]=y;const E=this.getOwnLayerSourceCache(y),A=!!this.directionalLight&&this.directionalLight.shadowsEnabled();E&&y.canCastShadows()&&A&&(E.castsShadows=!0);const R=this._changes.getRemovedLayer(y);if(R&&y.source&&E&&y.type!=="custom"){this._changes.discardLayerRemoval(y);const D=s.C(y.source,y.scope);R.type!==y.type?this._changes.updateSourceCache(D,"clear"):(this._changes.updateSourceCache(D,"reload"),E.pause())}this._updateLayer(y),y.onAdd&&y.onAdd(this.map),y.scope=this.scope,this.mergeLayers()}moveLayer(n,a){this._checkLoaded();const f=this._checkLayer(n);if(!f||n===a)return;const g=this._order.indexOf(n);this._order.splice(g,1);let y=this._order.length;if(a){const b=this._order.indexOf(a);if(b===-1)return void this.fire(new s.z(new Error(`Layer with id "${a}" does not exist on this map.`)));f.slot===this._layers[a].slot?y=b:s.w(`Layer with id "${a}" has a different slot. Layers can only be rearranged within the same slot.`)}this._order.splice(y,0,n),this._changes.setDirty(),this._layerOrderChanged=!0,this.mergeLayers()}removeLayer(n){this._checkLoaded();const a=this._checkLayer(n);if(!a)return;a.setEventedParent(null);const f=this._order.indexOf(n);this._order.splice(f,1),delete this._layers[n],this._changes.setDirty(),this._layerOrderChanged=!0,this._configDependentLayers.delete(a.fqid),this._changes.removeLayer(a);const g=this.getOwnLayerSourceCache(a);if(g&&g.castsShadows){let y=!1;for(const b in this._layers)if(this._layers[b].source===a.source&&this._layers[b].canCastShadows()){y=!0;break}g.castsShadows=y}a.onRemove&&a.onRemove(this.map),this.mergeLayers()}getOwnLayer(n){return this._layers[n]}hasLayer(n){return n in this._mergedLayers}hasLayerType(n){for(const a in this._layers)if(this._layers[a].type===n)return!0;return!1}setLayerZoomRange(n,a,f){this._checkLoaded();const g=this._checkLayer(n);g&&(g.minzoom===a&&g.maxzoom===f||(a!=null&&(g.minzoom=a),f!=null&&(g.maxzoom=f),this._updateLayer(g)))}getSlots(){return this._checkLoaded(),this._mergedSlots}setSlot(n,a){this._checkLoaded();const f=this._checkLayer(n);f&&f.slot!==a&&(f.slot=a,this._updateLayer(f))}setFilter(n,a,f={}){this._checkLoaded();const g=this._checkLayer(n);if(g&&!s.bv(g.filter,a))return a==null?(g.filter=void 0,void this._updateLayer(g)):void(this._validate(He,`layers.${g.id}.filter`,a,{layerType:g.type},f)||(g.filter=s.d6(a),this._updateLayer(g)))}getFilter(n){const a=this._checkLayer(n);if(a)return s.d6(a.filter)}setLayoutProperty(n,a,f,g={}){this._checkLoaded();const y=this._checkLayer(n);if(y&&!s.bv(y.getLayoutProperty(a),f)){if(f!=null&&(!g||g.validate!==!1)&&Xc(y,oe.call(Ui,{key:`layers.${n}.layout.${a}`,layerType:y.type,objectKey:a,value:f,styleSpec:s.a5,style:{glyphs:!0,sprite:!0}})))return;y.setLayoutProperty(a,f),y.configDependencies.size!==0&&this._configDependentLayers.add(y.fqid),this._updateLayer(y)}}getLayoutProperty(n,a){const f=this._checkLayer(n);if(f)return f.getLayoutProperty(a)}setPaintProperty(n,a,f,g={}){this._checkLoaded();const y=this._checkLayer(n);if(!y||s.bv(y.getPaintProperty(a),f)||f!=null&&(!g||g.validate!==!1)&&Xc(y,J.call(Ui,{key:`layers.${n}.paint.${a}`,layerType:y.type,objectKey:a,value:f,styleSpec:s.a5})))return;const b=y.setPaintProperty(a,f);y.configDependencies.size!==0&&this._configDependentLayers.add(y.fqid),b&&this._updateLayer(y),this._changes.updatePaintProperties(y)}getPaintProperty(n,a){const f=this._checkLayer(n);if(f)return f.getPaintProperty(a)}setFeatureState(n,a){if(this._checkLoaded(),"target"in n){if("featuresetId"in n.target){const{featuresetId:A,importId:R}=n.target,D=this.getFragmentStyle(R),F=D.getFeaturesetLayers(A);for(const{source:N,sourceLayer:j}of F)D.setFeatureState({id:n.id,source:N,sourceLayer:j},a)}else if("layerId"in n.target){const{layerId:A}=n.target,R=this.getLayer(A);this.setFeatureState({id:n.id,source:R.source,sourceLayer:R.sourceLayer},a)}return}const f=n.source,g=n.sourceLayer,y=this._checkSource(f);if(!y)return;const b=y.type;if(b==="geojson"&&g)return void this.fire(new s.z(new Error("GeoJSON sources cannot have a sourceLayer parameter.")));if(b==="vector"&&!g)return void this.fire(new s.z(new Error("The sourceLayer parameter must be provided for vector source types.")));n.id===void 0&&this.fire(new s.z(new Error("The feature id parameter must be provided.")));const E=this.getOwnSourceCaches(f);for(const A of E)A.setFeatureState(g,n.id,a)}removeFeatureState(n,a){if(this._checkLoaded(),"target"in n){if("featuresetId"in n.target){const{featuresetId:A,importId:R}=n.target,D=this.getFragmentStyle(R),F=D.getFeaturesetLayers(A);for(const{source:N,sourceLayer:j}of F)D.removeFeatureState({id:n.id,source:N,sourceLayer:j},a)}else if("layerId"in n.target){const{layerId:A}=n.target,R=this.getLayer(A);this.removeFeatureState({id:n.id,source:R.source,sourceLayer:R.sourceLayer},a)}return}const f=n.source,g=this._checkSource(f);if(!g)return;const y=g.type,b=y==="vector"?n.sourceLayer:void 0;if(y==="vector"&&!b)return void this.fire(new s.z(new Error("The sourceLayer parameter must be provided for vector source types.")));if(a&&typeof n.id!="string"&&typeof n.id!="number")return void this.fire(new s.z(new Error("A feature id is required to remove its specific state property.")));const E=this.getOwnSourceCaches(f);for(const A of E)A.removeFeatureState(b,n.id,a)}getFeatureState(n){if(this._checkLoaded(),"target"in n){let y;if("featuresetId"in n.target){const{featuresetId:b,importId:E}=n.target,A=this.getFragmentStyle(E),R=A.getFeaturesetLayers(b);for(const{source:D,sourceLayer:F}of R){const N=A.getFeatureState({id:n.id,source:D,sourceLayer:F});if(N&&!y)y=N;else if(!s.bv(y,N))return void this.fire(new s.z(new Error("The same feature id exists in multiple sources in the featureset, but their feature states are not consistent through the sources.")))}}else if("layerId"in n.target){const{layerId:b}=n.target,E=this.getLayer(b);y=this.getFeatureState({id:n.id,source:E.source,sourceLayer:E.sourceLayer})}return y}const a=n.source,f=n.sourceLayer,g=this._checkSource(a);if(g){if(g.type!=="vector"||f)return n.id===void 0&&this.fire(new s.z(new Error("The feature id parameter must be provided."))),this.getOwnSourceCaches(a)[0].getFeatureState(f,n.id);this.fire(new s.z(new Error("The sourceLayer parameter must be provided for vector source types.")))}}setTransition(n){return this.stylesheet.transition=s.h({},this.stylesheet.transition,n),this.transition=this.stylesheet.transition,this}getTransition(){return s.h({},this.stylesheet.transition)}serialize(){this._checkLoaded();const n=this.getTerrain(),a=n&&this.terrain&&this.terrain.scope===this.scope?n:this.stylesheet.terrain;return s.dc({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,fragment:this.stylesheet.fragment,iconsets:this.stylesheet.iconsets,imports:this._serializeImports(),schema:this.stylesheet.schema,camera:this.stylesheet.camera,light:this.stylesheet.light,lights:this.stylesheet.lights,terrain:a,fog:this.stylesheet.fog,snow:this.stylesheet.snow,rain:this.stylesheet.rain,center:this.stylesheet.center,"color-theme":this.stylesheet["color-theme"],zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,projection:this.stylesheet.projection,sources:this._serializeSources(),layers:this._serializeLayers(this._order)},f=>f!==void 0)}_updateFilteredLayers(n){for(const a of Object.values(this._mergedLayers))n(a)&&this._updateLayer(a)}_updateLayer(n){this._changes.updateLayer(n);const a=this.getLayerSourceCache(n),f=s.C(n.source,n.scope),g=this._changes.getUpdatedSourceCaches();n.source&&!g[f]&&a&&a.getSource().type!=="raster"&&(this._changes.updateSourceCache(f,"reload"),a.pause()),n.invalidateCompiledFilter()}_flattenAndSortRenderedFeatures(n){const a=E=>this._mergedLayers[E].is3D(!!this.terrain),f=this.order,g={},y=[];for(let E=f.length-1;E>=0;E--){const A=f[E];if(a(A)){g[A]=E;for(const R of n){const D=R[A];if(D)for(const F of D)y.push(F)}}}y.sort((E,A)=>A.intersectionZ-E.intersectionZ);const b=[];for(let E=f.length-1;E>=0;E--){const A=f[E];if(a(A))for(let R=y.length-1;R>=0;R--){const D=y[R].feature;if(D.layer&&g[D.layer.id]<E)break;b.push(D),y.pop()}else for(const R of n){const D=R[A];if(D)for(const F of D)b.push(F.feature)}}return b}queryRenderedFeatures(n,a,f){let g;a&&!Array.isArray(a)&&a.filter&&(this._validate(He,"queryRenderedFeatures.filter",a.filter,null,a),g=s.b3(a.filter));const y={},b=D=>{if(Op.has(D.type))return;const F=this.getOwnLayerSourceCache(D),N=y[F.id]=y[F.id]||{sourceCache:F,layers:{},has3DLayers:!1};D.is3D(!!this.terrain)&&(N.has3DLayers=!0),N.layers[D.fqid]=N.layers[D.fqid]||{styleLayer:D,targets:[]},N.layers[D.fqid].targets.push({filter:g})};if(a&&a.layers){if(!Array.isArray(a.layers))return this.fire(new s.z(new Error("parameters.layers must be an Array."))),[];for(const D of a.layers){const F=this._layers[D];if(!F)return this.fire(new s.z(new Error(`The layer '${D}' does not exist in the map's style and cannot be queried for features.`))),[];b(F)}}else for(const D in this._layers)b(this._layers[D]);const E=this._queryRenderedFeatures(n,y,f),A=this._flattenAndSortRenderedFeatures(E),R=[];for(const D of A)s.dd(D.layer.id)===this.scope&&R.push(D);return R}queryRenderedFeatureset(n,a,f){let g;a&&!Array.isArray(a)&&a.filter&&(this._validate(He,"queryRenderedFeatures.filter",a.filter,null,a),g=s.b3(a.filter));const y="mock",b=[];if(a&&a.target)b.push(Object.assign({},a,{targetId:y,filter:g}));else{const D=this.getFeaturesetDescriptors();for(const F of D)b.push({targetId:y,filter:g,target:F});for(const{style:F}of this.fragments){const N=F.getFeaturesetDescriptors();for(const j of N)b.push({targetId:y,filter:g,target:j})}}const E=this.queryRenderedTargets(n,b,f),A=[],R=new Set;for(const D of E)for(const F of D.variants[y])Tp(F,D,R)||A.push(new s.de(D,F));return A}queryRenderedTargets(n,a,f){const g={},y=(E,A,R,D)=>{const F=g[A.id]=g[A.id]||{sourceCache:A,layers:{},has3DLayers:!1};if(F.layers[E.fqid]=F.layers[E.fqid]||{styleLayer:E,targets:[]},E.is3D(!!this.terrain)&&(F.has3DLayers=!0),!D)return R.uniqueFeatureID=!1,void F.layers[E.fqid].targets.push(R);F.layers[E.fqid].targets.push(Object.assign({},R,{namespace:D.namespace,properties:D.properties,uniqueFeatureID:D.uniqueFeatureID}))};for(const E of a)if("featuresetId"in E.target){const{featuresetId:A,importId:R}=E.target,D=this.getFragmentStyle(R);if(!D||!D._featuresetSelectors)continue;const F=D._featuresetSelectors[A];if(!F){this.fire(new s.z(new Error(`The featureset '${A}' does not exist in the map's style and cannot be queried for features.`)));continue}for(const N of F){const j=D.getOwnLayer(N.layerId);j&&!Op.has(j.type)&&y(j,D.getOwnLayerSourceCache(j),E,N)}}else if("layerId"in E.target){const{layerId:A}=E.target,R=this.getLayer(A);if(!R||Op.has(R.type))continue;y(R,this.getLayerSourceCache(R),E)}const b=this._queryRenderedFeatures(n,g,f);return this._flattenAndSortRenderedFeatures(b)}_queryRenderedFeatures(n,a,f){const g=[],y=!!this.map._showQueryGeometry,b=_r.createFromScreenPoints(n,f);for(const E in a){const A=Ep(b,a[E],this._availableImages,f,y);Object.keys(A).length&&g.push(A)}if(this.placement)for(const E in a){if(!a[E].sourceCache._onlySymbols)continue;const A=Fc(b.screenGeometry,a[E],this._availableImages,this.placement.collisionIndex,this.placement.retainedQueryData,this.map.getWorldview());Object.keys(A).length&&g.push(A)}return g}querySourceFeatures(n,a){const f=a&&a.filter;f&&this._validate(He,"querySourceFeatures.filter",f,null,a);let g=[];const y=this.getOwnSourceCaches(n);for(const b of y)g=g.concat(Ph(b,a));return g}addSourceType(n,a,f){return js.getSourceType(n)?f(new Error(`A source type called "${n}" already exists.`)):(js.setSourceType(n,a),a.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:n,url:a.workerSourceURL},f):f(null,null))}getFlatLight(){return this.light.getLight()}setFlatLight(n,a,f={}){this._checkLoaded();const g=this.light.getLight();let y=!1;for(const E in n)if(!s.bv(n[E],g[E])){y=!0;break}if(!y)return;const b=this._getTransitionParameters();this.light.setLight(n,a,f),this.light.updateTransitions(b)}getTerrain(){return this.terrain&&this.terrain.drapeRenderMode===1?this.terrain.get():null}setTerrainForDraping(){this.setTerrain({source:"",exaggeration:0},0)}checkCanvasFingerprintNoise(){this.disableElevatedTerrain===void 0&&(this.disableElevatedTerrain=s.q.hasCanvasFingerprintNoise(),this.disableElevatedTerrain&&s.w("Terrain and hillshade are disabled because of Canvas2D limitations when fingerprinting protection is enabled (e.g. in private browsing mode)."))}setTerrain(n,a=1){if(this._checkLoaded(),!n)return this.terrainSetForDrapingOnly()||(delete this.terrain,this.map.transform.projection.requiresDraping&&this.setTerrainForDraping()),a===0&&delete this.terrain,n===null?this.stylesheet.terrain=null:delete this.stylesheet.terrain,this._force3DLayerUpdate(),void(this._markersNeedUpdate=!0);this.checkCanvasFingerprintNoise();let f=n;const g=n.source==null;if(a===1){if(this.disableElevatedTerrain)return;if(typeof f.source=="object"){const E="terrain-dem-src";this.addSource(E,f.source),f=s.d6(f),f=s.h(f,{source:E})}const y=s.h({},f),b={};if(this.terrain&&g){y.source=this.terrain.get().source;const E=this.terrain?this.getFragmentStyle(this.terrain.scope):null;E&&(b.style=E.serialize())}if(this._validate(Dt,"terrain",y,b))return}if(!this.terrain||this.terrain.scope!==this.scope&&!g||this.terrain&&a!==this.terrain.drapeRenderMode){if(!f)return;this._createTerrain(f,a),this.fire(new s.A("data",{dataType:"style"}))}else{const y=this.terrain,b=y.get();for(const E of Object.keys(s.a5.terrain))!f.hasOwnProperty(E)&&s.a5.terrain[E].default&&(f[E]=s.a5.terrain[E].default);for(const E in n)if(!s.bv(n[E],b[E])){y.set(n,this.options),this.stylesheet.terrain=n;const A=this._getTransitionParameters({duration:0});y.updateTransitions(A),this.fire(new s.A("data",{dataType:"style"}));break}}this.mergeTerrain(),this.updateDrapeFirstLayers(),this._markersNeedUpdate=!0}_createFog(n){const a=this.fog=new In(n,this.map.transform,this.scope,this.options);this.stylesheet.fog=a.get();const f=this._getTransitionParameters({duration:0});a.updateTransitions(f)}_createSnow(n){const a=this.snow=new li(n,this.map.transform,this.scope,this.options);this.stylesheet.snow=a.get();const f=this._getTransitionParameters({duration:0});a.updateTransitions(f)}_createRain(n){const a=this.rain=new ci(n,this.map.transform,this.scope,this.options);this.stylesheet.rain=a.get();const f=this._getTransitionParameters({duration:0});a.updateTransitions(f)}_updateMarkersOpacity(){this.map._markers.length!==0&&this.map._requestDomTask(()=>{for(const n of this.map._markers)n._evaluateOpacity()})}getFog(){return this.fog?this.fog.get():null}setFog(n){if(this._checkLoaded(),!n)return delete this.fog,delete this.stylesheet.fog,void(this._markersNeedUpdate=!0);if(this.fog){const a=this.fog;if(!s.bv(a.get(),n)){a.set(n,this.options),this.stylesheet.fog=a.get();const f=this._getTransitionParameters({duration:0});a.updateTransitions(f)}}else this._createFog(n);this._markersNeedUpdate=!0}getSnow(){return this.snow?this.snow.get():null}setSnow(n){if(this._checkLoaded(),!n)return delete this.snow,void delete this.stylesheet.snow;if(this.snow){const a=this.snow;if(!s.bv(a.get(),n)){a.set(n,this.options),this.stylesheet.snow=a.get();const f=this._getTransitionParameters({duration:0});a.updateTransitions(f)}}else this._createSnow(n);this._markersNeedUpdate=!0}getRain(){return this.rain?this.rain.get():null}setRain(n){if(this._checkLoaded(),!n)return delete this.rain,void delete this.stylesheet.rain;if(this.rain){const a=this.rain;if(!s.bv(a.get(),n)){a.set(n,this.options),this.stylesheet.rain=a.get();const f=this._getTransitionParameters({duration:0});a.updateTransitions(f)}}else this._createRain(n);this._markersNeedUpdate=!0}_reloadColorTheme(){const n=()=>{for(const g in this._layers)this._layers[g].lut=this._styleColorTheme.lut;for(const g in this._sourceCaches)this._sourceCaches[g].clearTiles()},a=this._styleColorTheme.colorThemeOverride?this._styleColorTheme.colorThemeOverride:this._styleColorTheme.colorTheme;if(!a)return this._styleColorTheme.lut=null,void n();const f=this._evaluateColorThemeData(a);this._loadColorTheme(f).then(()=>{this.fire(new s.A("colorthemeset")),n()}).catch(g=>{s.w(`Couldn't set color theme: ${g}`)})}setColorTheme(n){this._checkLoaded(),this._styleColorTheme.colorThemeOverride&&s.w("Note: setColorTheme is called on a style with a color-theme override, the passed color-theme won't be visible."),this._styleColorTheme.colorTheme=n,this._reloadColorTheme()}setImportColorTheme(n,a){const f=this.getFragmentStyle(n);f&&(f._styleColorTheme.colorThemeOverride=a,f._reloadColorTheme())}_getTransitionParameters(n){return{now:s.q.now(),transition:s.h(this.transition,n)}}updateDrapeFirstLayers(){if(!this.terrain)return;const n=[],a=[];for(const f of this._mergedOrder)this.isLayerDraped(this._mergedLayers[f])?n.push(f):a.push(f);this._drapedFirstOrder=[],this._drapedFirstOrder.push(...n),this._drapedFirstOrder.push(...a)}_createTerrain(n,a){const f=this.terrain=new De(n,a,this.scope,this.options,this.map.getWorldview());a===1&&(this.stylesheet.terrain=n),this.mergeTerrain(),this.updateDrapeFirstLayers(),this._force3DLayerUpdate();const g=this._getTransitionParameters({duration:0});f.updateTransitions(g)}_force3DLayerUpdate(){for(const n in this._layers){const a=this._layers[n];a.type==="fill-extrusion"&&this._updateLayer(a)}}_forceSymbolLayerUpdate(){for(const n in this._layers){const a=this._layers[n];a.type==="symbol"&&this._updateLayer(a)}}_validate(n,a,f,g,y={}){if(y&&y.validate===!1)return!1;const b=s.h({},this.serialize());return Xc(this,n.call(Ui,s.h({key:a,style:b,value:f,styleSpec:s.a5},g)))}_remove(){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),s.df.off("pluginStateChange",this._rtlTextPluginCallback);for(const n in this._mergedLayers)this._mergedLayers[n].setEventedParent(null);for(const n in this._mergedSourceCaches)this._mergedSourceCaches[n].clearTiles(),this._mergedSourceCaches[n].setEventedParent(null);this.imageManager.removeScope(this.scope),this.setEventedParent(null),delete this.fog,delete this.snow,delete this.rain,delete this.terrain,delete this.ambientLight,delete this.directionalLight,this.isRootStyle()&&(this.imageManager.setEventedParent(null),this.modelManager.setEventedParent(null),this.modelManager.destroy(),this.dispatcher.remove())}clearSource(n){const a=this.getSourceCaches(n);for(const f of a)f.clearTiles()}clearSources(){for(const n in this._mergedSourceCaches)this._mergedSourceCaches[n].clearTiles()}reloadSource(n){const a=this.getSourceCaches(n);for(const f of a)f.resume(),f.reload()}reloadSources(){for(const n of this.getSources())n.reload&&n.reload()}reloadModels(){this.modelManager.reloadModels(""),this.forEachFragmentStyle(n=>{n.modelManager.reloadModels(n.scope)})}updateSources(n){let a;this.directionalLight&&(a=Bu(this.directionalLight));const f=new Set;for(const g in this._mergedLayers){const y=this._mergedLayers[g];y.hasElevation()&&!f.has(y.source)&&f.add(y.source)}for(const g in this._mergedSourceCaches){const y=this._mergedSourceCaches[g],b=f.has(y._source.id);y.update(n,void 0,void 0,a,b)}}_generateCollisionBoxes(){for(const n in this._sourceCaches){const a=this._sourceCaches[n];a.resume(),a.reload()}}_updatePlacement(n,a,f,g,y,b,E=!1){let A=!1,R=!1;const D={},F={};for(const N of this._mergedOrder){const j=this._mergedLayers[N];if(j.type!=="symbol")continue;const X=s.C(j.source,j.scope);let W=D[X];if(!W){const ee=this.getLayerSourceCache(j);if(!ee)continue;const ie=ee.getRenderableIds(!0).map(fe=>ee.getTileByID(fe));F[X]=ie.slice(),W=D[X]=ie.sort((fe,_e)=>_e.tileID.overscaledZ-fe.tileID.overscaledZ||(fe.tileID.isLessThan(_e.tileID)?-1:1))}const K=this.crossTileSymbolIndex.addLayer(j,W,a.center.lng,a.projection);A=A||K}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._mergedOrder),E=E||this._layerOrderChanged||g===0,this._layerOrderChanged&&this.fire(new s.A("neworder")),(E||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(s.q.now(),a.zoom))&&(this.pauseablePlacement=new Lp(a,this._mergedOrder,E,f,g,y,this.placement,this.fog&&a.projection.supportsFog?this.fog.state:null,this._buildingIndex),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._mergedOrder,this._mergedLayers,D,F,this.map.painter.scaleFactor),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(s.q.now()),R=!0),A&&this.pauseablePlacement.placement.setStale()),R||A){this._buildingIndex.onNewFrame(a.zoom);for(let N=0;N<this._mergedOrder.length;N++){const j=this._mergedLayers[this._mergedOrder[N]];if(j.type!=="symbol")continue;const X=this.isLayerClipped(j);this.placement.updateLayerOpacities(j,D[s.C(j.source,j.scope)],N,X?b:null)}}return{needsRerender:!this.pauseablePlacement.isDone()||this.placement.hasTransitions(s.q.now())}}_releaseSymbolFadeTiles(){for(const n in this._sourceCaches)this._sourceCaches[n].releaseSymbolFadeTiles()}addImport(n,a){this._checkLoaded();const f=this.stylesheet.imports=this.stylesheet.imports||[];if(f.findIndex(({id:y})=>y===n.id)!==-1)return void this.fire(new s.z(new Error(`Import with id '${n.id}' already exists in the map's style.`)));if(!a)return f.push(n),this._loadImports([n],!0);const g=f.findIndex(({id:y})=>y===a);return g===-1&&this.fire(new s.z(new Error(`Import with id "${a}" does not exist on this map.`))),this.stylesheet.imports=f.slice(0,g).concat(n).concat(f.slice(g)),this._loadImports([n],!0,a)}updateImport(n,a){this._checkLoaded();const f=this.stylesheet.imports||[],g=this.getImportIndex(n);return g===-1?this:typeof a=="string"?(this.setImportUrl(n,a),this):(a.url&&a.url!==f[g].url&&this.setImportUrl(n,a.url),s.bv(a.config,f[g].config)||this.setImportConfig(n,a.config,a.data.schema),s.bv(a.data,f[g].data)||this.setImportData(n,a.data),this)}moveImport(n,a){this._checkLoaded();let f=this.stylesheet.imports||[];const g=this.getImportIndex(n);if(g===-1)return this;const y=this.getImportIndex(a);if(y===-1)return this;const b=f[g],E=this.fragments[g];return f=f.filter(({id:A})=>A!==n),this.fragments=this.fragments.filter(({id:A})=>A!==n),this.stylesheet.imports=f.slice(0,y).concat(b).concat(f.slice(y)),this.fragments=this.fragments.slice(0,y).concat(E).concat(this.fragments.slice(y)),this.mergeLayers(),this}setImportUrl(n,a){this._checkLoaded();const f=this.stylesheet.imports||[],g=this.getImportIndex(n);if(g===-1)return this;f[g].url=a;const y=this.fragments[g];return y.style=this._createFragmentStyle(f[g]),y.style.on("style.import.load",()=>this.mergeAll()),y.style.loadURL(a),this}setImportData(n,a){this._checkLoaded();const f=this.getImportIndex(n),g=this.stylesheet.imports||[];return f===-1?this:a?(this.fragments[f].style.setState(a),this._reloadImports(),this):(delete g[f].data,this.setImportUrl(n,g[f].url))}setImportConfig(n,a,f){this._checkLoaded();const g=this.getImportIndex(n),y=this.stylesheet.imports||[];if(g===-1)return this;a?y[g].config=a:delete y[g].config;const b=this.fragments[g];f&&b.style.stylesheet&&(b.style.stylesheet.schema=f);const E=b.style.stylesheet&&b.style.stylesheet.schema;return b.config=a,b.style.updateConfig(a,E),this.updateConfigDependencies(),this}removeImport(n){this._checkLoaded();const a=this.stylesheet.imports||[],f=this.getImportIndex(n);f!==-1&&(a.splice(f,1),this.fragments[f].style._remove(),this.fragments.splice(f,1),this._reloadImports())}getImportIndex(n){const a=(this.stylesheet.imports||[]).findIndex(f=>f.id===n);return a===-1&&this.fire(new s.z(new Error(`Import '${n}' does not exist in the map's style and cannot be updated.`))),a}getLayer(n){return this._mergedLayers[n]}getSources(){const n=[];for(const a in this._mergedOtherSourceCaches){const f=this._mergedOtherSourceCaches[a];f&&n.push(f.getSource())}return n}getSource(n,a){const f=this.getSourceCache(n,a);return f&&f.getSource()}getLayerSource(n){const a=this.getLayerSourceCache(n);return a&&a.getSource()}getSourceCache(n,a){const f=s.C(n,a);return this._mergedOtherSourceCaches[f]}getLayerSourceCache(n){const a=s.C(n.source,n.scope);return n.type==="symbol"?this._mergedSymbolSourceCaches[a]:this._mergedOtherSourceCaches[a]}getSourceCaches(n){if(n==null)return Object.values(this._mergedSourceCaches);const a=[];return this._mergedOtherSourceCaches[n]&&a.push(this._mergedOtherSourceCaches[n]),this._mergedSymbolSourceCaches[n]&&a.push(this._mergedSymbolSourceCaches[n]),a}updateSourceCaches(){const n=this._changes.getUpdatedSourceCaches();for(const a in n){const f=n[a];f==="reload"?this.reloadSource(a):f==="clear"&&this.clearSource(a)}}updateLayers(n){const a=this._changes.getUpdatedPaintProperties();for(const f of a){const g=this.getLayer(f);g&&g.updateTransitions(n)}}getGlyphsUrl(){return this.stylesheet.glyphs}setGlyphsUrl(n){this.stylesheet.glyphs=n,this.glyphManager.setURL(n,this.scope)}getImages(n,a,f){this.imageManager.getImages(a.images,a.scope,f),this._updateTilesForChangedImages();const g=b=>{if(b){const E=a.images.map(A=>s.I.toString(A));b.setDependencies(a.tileID.key,a.type,E)}},y=s.C(a.source,a.scope);g(this._mergedOtherSourceCaches[y]),g(this._mergedSymbolSourceCaches[y])}rasterizeImages(n,a,f){this.imageManager.rasterizeImages(a,f)}getGlyphs(n,a,f){this.glyphManager.getGlyphs(a.stacks,a.scope,f)}getResource(n,a,f){return s.dg(a,f)}getOwnSourceCache(n){return this._otherSourceCaches[n]}getOwnLayerSourceCache(n){return n.type==="symbol"?this._symbolSourceCaches[n.source]:this._otherSourceCaches[n.source]}getOwnSourceCaches(n){const a=[];return this._otherSourceCaches[n]&&a.push(this._otherSourceCaches[n]),this._symbolSourceCaches[n]&&a.push(this._symbolSourceCaches[n]),a}_isSourceCacheLoaded(n){const a=this.getOwnSourceCaches(n);return a.length===0?(this.fire(new s.z(new Error(`There is no source with ID '${n}'`))),!1):a.every(f=>f.loaded())}has3DLayers(){return this._has3DLayers}hasSymbolLayers(){return this._hasSymbolLayers}hasCircleLayers(){return this._hasCircleLayers}isLayerClipped(n,a){if(!this._clipLayerPresent&&n.type!=="fill-extrusion"&&n.type!=="building")return!1;const f=n.type==="fill-extrusion"&&n.sourceLayer==="building",g=n.type==="building";if(n.is3D(!!this.terrain)){if(f||g||a&&a.type==="batched-model"||n.type==="model")return!0}else if(n.type==="symbol")return!0;return!1}_clearWorkerCaches(){this.dispatcher.broadcast("clearCaches")}destroy(){this._clearWorkerCaches(),this.fragments.forEach(n=>{n.style._remove()}),this.terrainSetForDrapingOnly()&&(delete this.terrain,delete this.stylesheet.terrain)}}js.getSourceType=function(h){return Sp[h]},js.setSourceType=function(h,n){Sp[h]=n},js.registerForPluginStateChange=s.dh;var Hh=`
#define EPSILON 0.0000001
#define PI 3.141592653589793
#ifdef RENDER_CUTOFF
float cutoff_opacity(vec4 cutoff_params,float depth) {float near=cutoff_params.x;float far=cutoff_params.y;float cutoffStart=cutoff_params.z;float cutoffEnd=cutoff_params.w;float linearDepth=(depth-near)/(far-near);return clamp((linearDepth-cutoffStart)/(cutoffEnd-cutoffStart),0.0,1.0);}
#endif`,C_=`
out vec4 glFragColor;highp float unpack_depth(highp vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}highp vec4 pack_depth(highp float ndc_z) {highp float depth=ndc_z*0.5+0.5;const highp vec4 bit_shift=vec4(255.0*255.0*255.0,255.0*255.0,255.0,1.0);const highp vec4 bit_mask =vec4(0.0,1.0/255.0,1.0/255.0,1.0/255.0);highp vec4 res=fract(depth*bit_shift);res-=res.xxyz*bit_mask;return res;}
#ifdef INDICATOR_CUTOUT
uniform vec3 u_indicator_cutout_centers;uniform vec4 u_indicator_cutout_params;
#endif
vec4 applyCutout(vec4 color,float height) {
#ifdef INDICATOR_CUTOUT
float verticalFadeRange=u_indicator_cutout_centers.z*0.25;float holeMinOpacity=mix(1.0,u_indicator_cutout_params.x,smoothstep(u_indicator_cutout_centers.z,u_indicator_cutout_centers.z+verticalFadeRange,height));float holeRadius=max(u_indicator_cutout_params.y,0.0);float holeAspectRatio=u_indicator_cutout_params.z;float fadeStart=u_indicator_cutout_params.w;float distA=distance(vec2(gl_FragCoord.x,gl_FragCoord.y*holeAspectRatio),vec2(u_indicator_cutout_centers[0],u_indicator_cutout_centers[1]*holeAspectRatio));return color*min(smoothstep(fadeStart,holeRadius,distA)+holeMinOpacity,1.0);
#else
return color;
#endif
}
#ifdef DEBUG_WIREFRAME
#define HANDLE_WIREFRAME_DEBUG \\
glFragColor=vec4(0.7,0.0,0.0,0.7); \\
gl_FragDepth=gl_FragCoord.z-0.0001;
#else
#define HANDLE_WIREFRAME_DEBUG
#endif
#ifdef RENDER_CUTOFF
uniform highp vec4 u_cutoff_params;in float v_cutoff_opacity;
#endif
vec4 textureLodCustom(sampler2D image,highp vec2 pos,highp vec2 lod_coord) {highp vec2 size=vec2(textureSize(image,0));highp vec2 dx=dFdx(lod_coord.xy*size);highp vec2 dy=dFdy(lod_coord.xy*size);highp float delta_max_sqr=max(dot(dx,dx),dot(dy,dy));highp float lod=0.5*log2(delta_max_sqr);return textureLod(image,pos,lod);}vec4 applyLUT(highp sampler3D lut,vec4 col) {vec3 size=vec3(textureSize(lut,0));vec3 uvw=(col.rbg*float(size-1.0)+0.5)/size;return vec4(texture(lut,uvw).rgb,col.a);}vec3 applyLUT(highp sampler3D lut,vec3 col) {return applyLUT(lut,vec4(col,1.0)).rgb;}`,A_=`
#define EXTENT 8192.0
#define RAD_TO_DEG 180.0/PI
#define DEG_TO_RAD PI/180.0
#define GLOBE_RADIUS EXTENT/PI/2.0
float wrap(float n,float min,float max) {float d=max-min;float w=mod(mod(n-min,d)+d,d)+min;return (w==min) ? max : w;}
#ifdef PROJECTION_GLOBE_VIEW
vec3 mercator_tile_position(mat4 matrix,vec2 tile_anchor,vec3 tile_id,vec2 mercator_center) {
#ifndef PROJECTED_POS_ON_VIEWPORT
float tiles=tile_id.z;vec2 mercator=(tile_anchor/EXTENT+tile_id.xy)/tiles;mercator-=mercator_center;mercator.x=wrap(mercator.x,-0.5,0.5);vec4 mercator_tile=vec4(mercator.xy*EXTENT,EXTENT/(2.0*PI),1.0);mercator_tile=matrix*mercator_tile;return mercator_tile.xyz;
#else
return vec3(0.0);
#endif
}vec3 mix_globe_mercator(vec3 globe,vec3 mercator,float t) {return mix(globe,mercator,t);}mat3 globe_mercator_surface_vectors(vec3 pos_normal,vec3 up_dir,float zoom_transition) {vec3 normal=zoom_transition==0.0 ? pos_normal : normalize(mix(pos_normal,up_dir,zoom_transition));vec3 xAxis=normalize(vec3(normal.z,0.0,-normal.x));vec3 yAxis=normalize(cross(normal,xAxis));return mat3(xAxis,yAxis,normal);}
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(
unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const vec2 units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (units_to_pixels*pos+offset)/pattern_size;}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {return get_pattern_pos(pixel_coord_upper,pixel_coord_lower,pattern_size,vec2(tile_units_to_pixels),pos);}float mercatorXfromLng(float lng) {return (180.0+lng)/360.0;}float mercatorYfromLat(float lat) {return (180.0-(RAD_TO_DEG*log(tan(PI/4.0+lat/2.0*DEG_TO_RAD))))/360.0;}vec3 latLngToECEF(vec2 latLng) {latLng=DEG_TO_RAD*latLng;float cosLat=cos(latLng[0]);float sinLat=sin(latLng[0]);float cosLng=cos(latLng[1]);float sinLng=sin(latLng[1]);float sx=cosLat*sinLng*GLOBE_RADIUS;float sy=-sinLat*GLOBE_RADIUS;float sz=cosLat*cosLng*GLOBE_RADIUS;return vec3(sx,sy,sz);}
#ifdef RENDER_CUTOFF
uniform vec4 u_cutoff_params;out float v_cutoff_opacity;
#endif
const vec4 AWAY=vec4(-1000.0,-1000.0,-1000.0,1);const float skirtOffset=24575.0;vec3 decomposeToPosAndSkirt(vec2 posWithComposedSkirt)
{float skirt=float(posWithComposedSkirt.x >=skirtOffset);vec2 pos=posWithComposedSkirt-vec2(skirt*skirtOffset,0.0);return vec3(pos,skirt);}`,Uu="in highp vec3 a_pos_3f;uniform lowp mat4 u_matrix;out highp vec3 v_uv;void main() {const mat3 half_neg_pi_around_x=mat3(1.0,0.0, 0.0,0.0,0.0,-1.0,0.0,1.0, 0.0);v_uv=half_neg_pi_around_x*a_pos_3f;vec4 pos=u_matrix*vec4(a_pos_3f,1.0);gl_Position=pos.xyww;}",$u=`
#define ELEVATION_SCALE 7.0
#define ELEVATION_OFFSET 450.0
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_tl_up;uniform vec3 u_tile_tr_up;uniform vec3 u_tile_br_up;uniform vec3 u_tile_bl_up;uniform float u_tile_up_scale;vec3 elevationVector(vec2 pos) {vec2 uv=pos/EXTENT;vec3 up=normalize(mix(
mix(u_tile_tl_up,u_tile_tr_up,uv.xxx),mix(u_tile_bl_up,u_tile_br_up,uv.xxx),uv.yyy));return up*u_tile_up_scale;}
#else
vec3 elevationVector(vec2 pos) { return vec3(0,0,1); }
#endif
#ifdef TERRAIN
uniform highp sampler2D u_dem;uniform highp sampler2D u_dem_prev;uniform vec2 u_dem_tl;uniform vec2 u_dem_tl_prev;uniform float u_dem_scale;uniform float u_dem_scale_prev;uniform float u_dem_size;uniform float u_dem_lerp;uniform float u_exaggeration;uniform float u_meter_to_dem;uniform mat4 u_label_plane_matrix_inv;vec4 tileUvToDemSample(vec2 uv,float dem_size,float dem_scale,vec2 dem_tl) {vec2 pos=dem_size*(uv*dem_scale+dem_tl)+1.0;vec2 f=fract(pos);return vec4((pos-f+0.5)/(dem_size+2.0),f);}float currentElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale+u_dem_tl)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture(u_dem,pos).r;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale,u_dem_tl);vec2 pos=r.xy;vec2 f=r.zw;float tl=texture(u_dem,pos).r;float tr=texture(u_dem,pos+vec2(dd,0)).r;float bl=texture(u_dem,pos+vec2(0,dd)).r;float br=texture(u_dem,pos+vec2(dd,dd)).r;return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}float prevElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale_prev+u_dem_tl_prev)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture(u_dem_prev,pos).r;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale_prev,u_dem_tl_prev);vec2 pos=r.xy;vec2 f=r.zw;float tl=texture(u_dem_prev,pos).r;float tr=texture(u_dem_prev,pos+vec2(dd,0)).r;float bl=texture(u_dem_prev,pos+vec2(0,dd)).r;float br=texture(u_dem_prev,pos+vec2(dd,dd)).r;return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}
#ifdef TERRAIN_VERTEX_MORPHING
float elevation(vec2 apos) {
#ifdef ZERO_EXAGGERATION
return 0.0;
#endif
float nextElevation=currentElevation(apos);float prevElevation=prevElevation(apos);return mix(prevElevation,nextElevation,u_dem_lerp);}
#else
float elevation(vec2 apos) {
#ifdef ZERO_EXAGGERATION
return 0.0;
#endif
return currentElevation(apos);}
#endif
vec4 fourSample(vec2 pos,vec2 off) {float tl=texture(u_dem,pos).r;float tr=texture(u_dem,pos+vec2(off.x,0.0)).r;float bl=texture(u_dem,pos+vec2(0.0,off.y)).r;float br=texture(u_dem,pos+off).r;return vec4(tl,tr,bl,br);}float flatElevation(vec2 pack) {vec2 apos=floor(pack/8.0);vec2 span=10.0*(pack-apos*8.0);vec2 uvTex=(apos-vec2(1.0,1.0))/8190.0;float size=u_dem_size+2.0;float dd=1.0/size;vec2 pos=u_dem_size*(uvTex*u_dem_scale+u_dem_tl)+1.0;vec2 f=fract(pos);pos=(pos-f+0.5)*dd;vec4 h=fourSample(pos,vec2(dd));float z=mix(mix(h.x,h.y,f.x),mix(h.z,h.w,f.x),f.y);vec2 w=floor(0.5*(span*u_meter_to_dem-1.0));vec2 d=dd*w;h=fourSample(pos-d,2.0*d+vec2(dd));vec4 diff=abs(h.xzxy-h.ywzw);vec2 slope=min(vec2(0.25),u_meter_to_dem*0.5*(diff.xz+diff.yw)/(2.0*w+vec2(1.0)));vec2 fix=slope*span;float base=z+max(fix.x,fix.y);return u_exaggeration*base;}float elevationFromUint16(float word) {return u_exaggeration*(word/ELEVATION_SCALE-ELEVATION_OFFSET);}
#else
float elevation(vec2 pos) { return 0.0; }
#endif
#ifdef DEPTH_OCCLUSION
uniform highp sampler2D u_depth;uniform highp vec2 u_depth_size_inv;uniform highp vec2 u_depth_range_unpack;uniform highp float u_occluder_half_size;uniform highp float u_occlusion_depth_offset;
#ifdef DEPTH_D24
float unpack_depth(float depth) {return depth*u_depth_range_unpack.x+u_depth_range_unpack.y;}vec4 unpack_depth4(vec4 depth) {return depth*u_depth_range_unpack.x+vec4(u_depth_range_unpack.y);}
#else
highp float unpack_depth_rgba(vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}
#endif
bool isOccluded(vec4 frag) {vec3 coord=frag.xyz/frag.w;
#ifdef DEPTH_D24
float depth=unpack_depth(texture(u_depth,(coord.xy+1.0)*0.5).r);
#else
float depth=unpack_depth_rgba(texture(u_depth,(coord.xy+1.0)*0.5));
#endif
return coord.z+u_occlusion_depth_offset > depth;}highp vec4 getCornerDepths(vec2 coord) {highp vec3 df=vec3(u_occluder_half_size*u_depth_size_inv,0.0);highp vec2 uv=0.5*coord.xy+0.5;
#ifdef DEPTH_D24
highp vec4 depth=vec4(
texture(u_depth,uv-df.xz).r,texture(u_depth,uv+df.xz).r,texture(u_depth,uv-df.zy).r,texture(u_depth,uv+df.zy).r
);depth=unpack_depth4(depth);
#else
highp vec4 depth=vec4(
unpack_depth_rgba(texture(u_depth,uv-df.xz)),unpack_depth_rgba(texture(u_depth,uv+df.xz)),unpack_depth_rgba(texture(u_depth,uv-df.zy)),unpack_depth_rgba(texture(u_depth,uv+df.zy))
);
#endif
return depth;}highp float occlusionFadeMultiSample(vec4 frag) {highp vec3 coord=frag.xyz/frag.w;highp vec2 uv=0.5*coord.xy+0.5;int NX=3;int NY=4;highp vec2 df=u_occluder_half_size*u_depth_size_inv;highp vec2 oneStep=2.0*u_occluder_half_size*u_depth_size_inv/vec2(NX-1,NY-1);highp float res=0.0;for (int y=0; y < NY;++y) {for (int x=0; x < NX;++x) {
#ifdef DEPTH_D24
highp float depth=unpack_depth(texture(u_depth,uv-df+vec2(float(x)*oneStep.x,float(y)*oneStep.y)).r);
#else
highp float depth=unpack_depth_rgba(texture(u_depth,uv-df+vec2(float(x)*oneStep.x,float(y)*oneStep.y)));
#endif
res+=1.0-clamp(300.0*(coord.z+u_occlusion_depth_offset-depth),0.0,1.0);}}res=clamp(2.0*res/float(NX*NY)-0.5,0.0,1.0);return res;}highp float occlusionFade(vec4 frag) {highp vec3 coord=frag.xyz/frag.w;highp vec4 depth=getCornerDepths(coord.xy);return dot(vec4(0.25),vec4(1.0)-clamp(300.0*(vec4(coord.z+u_occlusion_depth_offset)-depth),0.0,1.0));}
#else
bool isOccluded(vec4 frag) { return false; }highp float occlusionFade(vec4 frag) { return 1.0; }highp float occlusionFadeMultiSample(vec4 frag) { return 1.0; }
#endif//DEPTH_OCCLUSION`,I_=`#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump mat4 u_fog_matrix;out vec3 v_fog_pos;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}vec3 fog_position(vec3 pos) {return (u_fog_matrix*vec4(pos,1.0)).xyz;}vec3 fog_position(vec2 pos) {return fog_position(vec3(pos,0.0));}float fog(vec3 pos) {float depth=length(pos);float opacity=fog_opacity(fog_range(depth));return opacity*fog_horizon_blending(pos/depth);}
#endif`,Fp=`#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump vec2 u_fog_vertical_limit;uniform mediump float u_fog_temporal_offset;in vec3 v_fog_pos;uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform highp vec2 u_viewport;uniform float u_globe_transition;uniform int u_is_globe;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}float globe_glow_progress() {highp vec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);highp vec3 dir=normalize(ray_dir);highp vec3 closest_point=dot(u_globe_pos,dir)*dir;highp float sdf=length(closest_point-u_globe_pos)/u_globe_radius;return sdf+PI*0.5;}float fog_opacity(vec3 pos) {float depth=length(pos);return fog_opacity(fog_range(depth));}vec3 fog_apply(vec3 color,vec3 pos,float opacity_limit) {float depth=length(pos);float opacity;if (u_is_globe==1) {float glow_progress=globe_glow_progress();float t=mix(glow_progress,depth,u_globe_transition);opacity=fog_opacity(fog_range(t));} else {opacity=fog_opacity(fog_range(depth));opacity*=fog_horizon_blending(pos/depth);}return mix(color,u_fog_color.rgb,min(opacity,opacity_limit));}vec3 fog_apply(vec3 color,vec3 pos) {return fog_apply(color,pos,1.0);}vec4 fog_apply_from_vert(vec4 color,float fog_opac) {float alpha=EPSILON+color.a;color.rgb=mix(color.rgb/alpha,u_fog_color.rgb,fog_opac)*alpha;return color;}vec3 fog_apply_sky_gradient(vec3 camera_ray,vec3 sky_color) {float horizon_blend=fog_horizon_blending(normalize(camera_ray));return mix(sky_color,u_fog_color.rgb,horizon_blend);}vec4 fog_apply_premultiplied(vec4 color,vec3 pos) {float alpha=EPSILON+color.a;color.rgb=fog_apply(color.rgb/alpha,pos)*alpha;return color;}vec4 fog_apply_premultiplied(vec4 color,vec3 pos,float heightMeters) {float verticalProgress=(u_fog_vertical_limit.x > 0.0 || u_fog_vertical_limit.y > 0.0) ? smoothstep(u_fog_vertical_limit.x,u_fog_vertical_limit.y,heightMeters) : 0.0;float opacityLimit=1.0-smoothstep(0.9,1.0,fog_opacity(pos));return mix(fog_apply_premultiplied(color,pos),color,min(verticalProgress,opacityLimit));}vec3 fog_dither(vec3 color) {return color;}vec4 fog_dither(vec4 color) {return vec4(fog_dither(color.rgb),color.a);}
#endif`,zo=`#ifdef RASTER_ARRAY
uniform highp sampler2D u_image0;uniform sampler2D u_image1;const vec4 NODATA=vec4(1);ivec4 _raTexLinearCoord(highp vec2 texCoord,highp vec2 texResolution,out highp vec2 fxy) {texCoord=texCoord*texResolution-0.5;fxy=fract(texCoord);texCoord-=fxy;return ivec4(texCoord.xxyy+vec2(1.5,0.5).xyxy);}vec2 _raTexLinearMix(highp vec2 fxy,highp vec4 colorMix,highp float colorOffset,highp vec4 t00,highp vec4 t10,highp vec4 t01,highp vec4 t11) {vec2 c00=t00==NODATA ? vec2(0) : vec2(colorOffset+dot(t00,colorMix),1);vec2 c10=t10==NODATA ? vec2(0) : vec2(colorOffset+dot(t10,colorMix),1);vec2 c01=t01==NODATA ? vec2(0) : vec2(colorOffset+dot(t01,colorMix),1);vec2 c11=t11==NODATA ? vec2(0) : vec2(colorOffset+dot(t11,colorMix),1);return mix(mix(c01,c11,fxy.x),mix(c00,c10,fxy.x),fxy.y);}vec2 raTexture2D_image0_linear(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec2 fxy;ivec4 c=_raTexLinearCoord(texCoord,texResolution,fxy);return _raTexLinearMix(fxy,colorMix,colorOffset,texelFetch(u_image0,c.yz,0),texelFetch(u_image0,c.xz,0),texelFetch(u_image0,c.yw,0),texelFetch(u_image0,c.xw,0)
);}vec2 raTexture2D_image1_linear(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec2 fxy;ivec4 c=_raTexLinearCoord(texCoord,texResolution,fxy);return _raTexLinearMix(fxy,colorMix,colorOffset,texelFetch(u_image1,c.yz,0),texelFetch(u_image1,c.xz,0),texelFetch(u_image1,c.yw,0),texelFetch(u_image1,c.xw,0)
);}vec2 raTexture2D_image0_nearest(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec4 t=texelFetch(u_image0,ivec2(texCoord*texResolution),0);return t==NODATA ? vec2(0) : vec2(colorOffset+dot(t,colorMix),1);}vec2 raTexture2D_image1_nearest(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec4 t=texelFetch(u_image1,ivec2(texCoord*texResolution),0);return t==NODATA ? vec2(0) : vec2(colorOffset+dot(t,colorMix),1);}
#endif`,jp=`#ifdef RASTER_ARRAY
uniform sampler2D u_velocity;uniform mediump vec2 u_velocity_res;uniform mediump float u_max_speed;const vec4 NO_DATA=vec4(1);const vec2 INVALID_VELOCITY=vec2(-1);uniform highp vec2 u_uv_offset;uniform highp float u_data_offset;uniform highp vec2 u_data_scale;ivec4 rasterArrayLinearCoord(highp vec2 texCoord,highp vec2 texResolution,out highp vec2 fxy) {texCoord=texCoord*texResolution-0.5;fxy=fract(texCoord);texCoord-=fxy;return ivec4(texCoord.xxyy+vec2(1.5,0.5).xyxy);}highp vec2 lookup_velocity(highp vec2 uv) {uv=u_uv_offset.x+u_uv_offset.y*uv;highp vec2 fxy;ivec4 c=rasterArrayLinearCoord(uv,u_velocity_res,fxy);highp vec4 tl=texelFetch(u_velocity,c.yz,0);highp vec4 tr=texelFetch(u_velocity,c.xz,0);highp vec4 bl=texelFetch(u_velocity,c.yw,0);highp vec4 br=texelFetch(u_velocity,c.xw,0);if (tl==NO_DATA) {return INVALID_VELOCITY;}if (tr==NO_DATA) {return INVALID_VELOCITY;}if (bl==NO_DATA) {return INVALID_VELOCITY;}if (br==NO_DATA) {return INVALID_VELOCITY;}highp vec4 t=mix(mix(bl,br,fxy.x),mix(tl,tr,fxy.x),fxy.y);highp vec2 velocity=u_data_offset+vec2(dot(t.rg,u_data_scale),dot(t.ba,u_data_scale));velocity.y=-velocity.y;velocity/=max(u_max_speed,length(velocity));return velocity;}
#endif
uniform highp float u_particle_pos_scale;uniform highp vec2 u_particle_pos_offset;highp vec4 pack_pos_to_rgba(highp vec2 p) {highp vec2 v=(p+u_particle_pos_offset)/u_particle_pos_scale;highp vec4 r=vec4(v.x,fract(v.x*255.0),v.y,fract(v.y*255.0));return vec4(r.x-r.y/255.0,r.y,r.z-r.w/255.0,r.w);}highp vec2 unpack_pos_from_rgba(highp vec4 v) {v=floor(v*255.0+0.5)/255.0;highp vec2 p=vec2(v.x+(v.y/255.0),v.z+(v.w/255.0));return u_particle_pos_scale*p-u_particle_pos_offset;}`,Lt=`#ifdef RENDER_SHADOWS
uniform mediump vec3 u_shadow_direction;uniform highp vec3 u_shadow_normal_offset;vec3 shadow_normal_offset(vec3 normal) {float tileInMeters=u_shadow_normal_offset[0];vec3 n=vec3(-normal.xy,tileInMeters*normal.z);float dotScale=min(1.0-dot(normal,u_shadow_direction),1.0)*0.5+0.5;return n*dotScale;}vec3 shadow_normal_offset_model(vec3 normal) {vec3 transformed_normal=vec3(-normal.xy,normal.z);float NDotL=dot(normalize(transformed_normal),u_shadow_direction);float dotScale=min(1.0-NDotL,1.0)*0.5+0.5;return normal*dotScale;}float shadow_normal_offset_multiplier0() {return u_shadow_normal_offset[1];}float shadow_normal_offset_multiplier1() {return u_shadow_normal_offset[2];}
#endif//RENDER_SHADOWS`,P_=`#ifdef RENDER_SHADOWS
precision highp sampler2DShadow;uniform sampler2DShadow u_shadowmap_0;uniform sampler2DShadow u_shadowmap_1;uniform float u_shadow_intensity;uniform float u_shadow_map_resolution;uniform float u_shadow_texel_size;uniform highp vec3 u_shadow_normal_offset;uniform vec2 u_fade_range;uniform mediump vec3 u_shadow_direction;uniform highp vec3 u_shadow_bias;float shadow_sample(sampler2DShadow shadowmap,highp vec3 pos,highp float bias) {highp vec3 coord=vec3(pos.xy*0.5+0.5,pos.z*0.5+0.5-bias);return texture(shadowmap,coord);}float shadow_occlusion(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth,highp float bias) {light_view_pos0.xyz/=light_view_pos0.w;
#ifdef SHADOWS_SINGLE_CASCADE
vec2 abs_bounds=abs(light_view_pos0.xy);if (abs_bounds.x >=1.0 || abs_bounds.y >=1.0) {return 0.0;}return shadow_sample(u_shadowmap_0,light_view_pos0.xyz,bias);
#else
light_view_pos1.xyz/=light_view_pos1.w;vec4 abs_bounds=abs(vec4(light_view_pos0.xy,light_view_pos1.xy));if (abs_bounds.x < 1.0 && abs_bounds.y < 1.0) {return shadow_sample(u_shadowmap_0,light_view_pos0.xyz,bias);}if (abs_bounds.z >=1.0 || abs_bounds.w >=1.0) {return 0.0;}float occlusion1=shadow_sample(u_shadowmap_1,light_view_pos1.xyz,bias);return clamp(mix(occlusion1,0.0,smoothstep(u_fade_range.x,u_fade_range.y,view_depth)),0.0,1.0);
#endif
}highp float calculate_shadow_bias(float NDotL) {
#ifdef NORMAL_OFFSET
return 0.5*u_shadow_bias.x;
#else
return 0.5*(u_shadow_bias.x+clamp(u_shadow_bias.y*tan(acos(NDotL)),0.0,u_shadow_bias.z));
#endif
}float shadowed_light_factor_normal(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float NDotL=dot(N,u_shadow_direction);float bias=calculate_shadow_bias(NDotL);float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}float shadowed_light_factor_normal_opacity(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth,float shadow_opacity) {float NDotL=dot(N,u_shadow_direction);float bias=calculate_shadow_bias(NDotL);float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias)*shadow_opacity;return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}float shadowed_light_factor_normal_unbiased(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float NDotL=dot(N,u_shadow_direction);float bias=0.0;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}highp vec2 compute_receiver_plane_depth_bias(highp vec3 pos_dx,highp vec3 pos_dy)
{highp vec2 biasUV=vec2(
pos_dy.y*pos_dx.z-pos_dx.y*pos_dy.z,pos_dx.x*pos_dy.z-pos_dy.x*pos_dx.z);biasUV*=1.0/((pos_dx.x*pos_dy.y)-(pos_dx.y*pos_dy.x));return biasUV;}float shadowed_light_factor_plane_bias(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {highp vec3 light_view_pos0_xyz=light_view_pos0.xyz/light_view_pos0.w*0.5+0.5;highp vec3 light_view_pos0_ddx=dFdx(light_view_pos0_xyz);highp vec3 light_view_pos0_ddy=dFdy(light_view_pos0_xyz);highp vec2 plane_depth_bias=compute_receiver_plane_depth_bias(light_view_pos0_ddx,light_view_pos0_ddy);highp float bias=dot(vec2(u_shadow_texel_size,u_shadow_texel_size),plane_depth_bias)+0.0001;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return 1.0-(u_shadow_intensity*occlusion);}float shadowed_light_factor(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float bias=0.0;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return 1.0-(u_shadow_intensity*occlusion);}float shadow_occlusion(float ndotl,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float bias=calculate_shadow_bias(ndotl);return shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);}
#endif`;const Gu=[];ea(Hh,Gu),ea(A_,Gu),ea(C_,Gu);const Hu={"_prelude_fog.vertex.glsl":I_,"_prelude_terrain.vertex.glsl":$u,"_prelude_shadow.vertex.glsl":Lt,"_prelude_fog.fragment.glsl":Fp,"_prelude_shadow.fragment.glsl":P_,"_prelude_lighting.glsl":`
#ifdef LIGHTING_3D_MODE
uniform mediump vec3 u_lighting_ambient_color;uniform mediump vec3 u_lighting_directional_dir;uniform mediump vec3 u_lighting_directional_color;uniform mediump vec3 u_ground_radiance;float calculate_ambient_directional_factor(vec3 normal) {float NdotL=dot(normal,u_lighting_directional_dir);const float factor_reduction_max=0.3;float dir_luminance=dot(u_lighting_directional_color,vec3(0.2126,0.7152,0.0722));float directional_factor_min=1.0-factor_reduction_max*min(dir_luminance,1.0);float ambient_directional_factor=mix(directional_factor_min,1.0,min((NdotL+1.0),1.0));const float vertical_factor_min=0.92;float vertical_factor=mix(vertical_factor_min,1.0,normal.z*0.5+0.5);return vertical_factor*ambient_directional_factor;}vec3 linearProduct(vec3 srgbIn,vec3 k) {return srgbIn*pow(k,vec3(1./2.2));}vec3 apply_lighting(vec3 color,vec3 normal,float dir_factor) {float ambient_directional_factor=calculate_ambient_directional_factor(normal);vec3 ambient_contrib=ambient_directional_factor*u_lighting_ambient_color;vec3 directional_contrib=u_lighting_directional_color*dir_factor;return linearProduct(color,ambient_contrib+directional_contrib);}vec4 apply_lighting(vec4 color,vec3 normal,float dir_factor) {return vec4(apply_lighting(color.rgb,normal,dir_factor),color.a);}vec3 apply_lighting(vec3 color,vec3 normal) {float dir_factor=max(dot(normal,u_lighting_directional_dir),0.0);return apply_lighting(color.rgb,normal,dir_factor);}vec4 apply_lighting(vec4 color,vec3 normal) {float dir_factor=max(dot(normal,u_lighting_directional_dir),0.0);return vec4(apply_lighting(color.rgb,normal,dir_factor),color.a);}vec3 apply_lighting_ground(vec3 color) {return color*u_ground_radiance;}vec4 apply_lighting_ground(vec4 color) {return vec4(apply_lighting_ground(color.rgb),color.a);}float calculate_NdotL(vec3 normal) {const float ext=0.70710678118;return (clamp(dot(normal,u_lighting_directional_dir),-ext,1.0)+ext)/(1.0+ext);}vec4 apply_lighting_with_emission_ground(vec4 color,float emissive_strength) {return mix(apply_lighting_ground(color),color,emissive_strength);}vec3 compute_flood_lighting(vec3 flood_light_color,float fully_occluded_factor,float occlusion,vec3 ground_shadow_factor) {vec3 fully_occluded_color=flood_light_color*mix(ground_shadow_factor,vec3(1.0),fully_occluded_factor);float occlusion_ramp=smoothstep(0.0,0.2,1.0-occlusion);return mix(fully_occluded_color,flood_light_color,occlusion_ramp);}vec3 compute_emissive_draped(vec3 unlit_color,float fully_occluded_factor,float occlusion,vec3 ground_shadow_factor) {vec3 fully_occluded_color=unlit_color*mix(ground_shadow_factor,vec3(1.0),fully_occluded_factor);return mix(fully_occluded_color,unlit_color,1.0-occlusion);}
#endif//LIGHTING_3D_MODE`,"_prelude_raster_array.glsl":zo,"_prelude_raster_particle.glsl":jp},qh={};sr("",$u),sr(Fp,I_),sr(P_,Lt),sr(zo,""),sr(jp,"");const Wh=sr(C_,A_),Fa=Hh;var Bp={background:sr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec4 u_color;uniform float u_opacity;
#ifdef LIGHTING_3D_MODE
in vec4 v_color;
#endif
void main() {vec4 out_color;
#ifdef LIGHTING_3D_MODE
out_color=v_color;
#else
out_color=u_color;
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_lighting.glsl"
in vec2 a_pos;uniform mat4 u_matrix;
#ifdef LIGHTING_3D_MODE
uniform mediump vec4 u_color;out vec4 v_color;uniform float u_emissive_strength;
#endif
void main() {gl_Position=u_matrix*vec4(a_pos,0,1);
#ifdef LIGHTING_3D_MODE
v_color=apply_lighting_with_emission_ground(u_color,u_emissive_strength);
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),backgroundPattern:sr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec2 u_pattern_tl;uniform vec2 u_pattern_br;uniform vec2 u_texsize;uniform float u_opacity;uniform float u_emissive_strength;uniform sampler2D u_image;in highp vec2 v_pos;void main() {highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(u_pattern_tl/u_texsize,u_pattern_br/u_texsize,imagecoord);vec4 out_color=textureLodCustom(u_image,pos,v_pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_pattern_size;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec2 u_pattern_units_to_pixels;in vec2 a_pos;out highp vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_pattern_size,u_pattern_units_to_pixels,a_pos);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),building:sr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
in vec4 v_color;in highp vec3 v_normal;in highp float v_height;
#ifdef RENDER_SHADOWS
in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in float v_depth_shadows;
#endif
uniform lowp float u_opacity;vec3 linearTosRGB(vec3 color) {return pow(color,vec3(1./2.2));}vec3 apply_lighting_linear(vec3 color,vec3 normal,float dir_factor) {float ambient_directional_factor=calculate_ambient_directional_factor(normal);vec3 ambient_contrib=ambient_directional_factor*u_lighting_ambient_color;vec3 directional_contrib=u_lighting_directional_color*dir_factor;return color*(ambient_contrib+directional_contrib);}void main() {vec4 color=vec4(v_color.rgb,1.0);vec3 normal=normalize(v_normal);vec3 xy_flipped_normal=vec3(-normal.xy,normal.z);float shadowed_lighting_factor=0.0;
#ifdef RENDER_SHADOWS
shadowed_lighting_factor=shadowed_light_factor_normal(xy_flipped_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);
#else
shadowed_lighting_factor=dot(normal,u_lighting_directional_dir);
#endif
color.rgb=apply_lighting_linear(color.rgb,xy_flipped_normal,shadowed_lighting_factor);color.rgb=mix(color.rgb,v_color.rgb,v_color.a);
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos,v_height));
#endif
color.rgb=linearTosRGB(color.rgb);color*=u_opacity;
#ifdef RENDER_CUTOFF
color*=v_cutoff_opacity;
#endif
#ifdef INDICATOR_CUTOUT
color=applyCutout(color,v_height);
#endif
glFragColor=color; 
#ifdef DEBUG_SHOW_NORMALS
color.rgb=xy_flipped_normal*0.5+vec3(0.5,0.5,0.5);color.a=1.0;glFragColor=color;
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec3 a_pos_3f;in vec3 a_normal_3f;out vec4 v_color;out highp vec3 v_normal;out highp float v_height;uniform mat4 u_matrix;uniform mat4 u_normal_matrix;
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out float v_depth_shadows;
#endif
vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}
#pragma mapbox: define-attribute-vertex-shader-only highp vec2 part_color_emissive
void main() {
#pragma mapbox: initialize-attribute-custom highp vec2 part_color_emissive
vec4 color_emissive=decode_color(part_color_emissive);v_color=vec4(sRGBToLinear(color_emissive.rgb),color_emissive.a);v_normal=vec3(u_normal_matrix*vec4(a_normal_3f,0.0));vec3 pos=a_pos_3f;v_height=pos.z;gl_Position=u_matrix*vec4(pos,1.0);
#ifdef RENDER_SHADOWS
vec3 shadow_pos=pos;
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset_model(v_normal);shadow_pos+=offset*shadow_normal_offset_multiplier0();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shadow_pos,1.0);v_pos_light_view_1=u_light_matrix_1*vec4(shadow_pos,1.0);v_depth_shadows=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
#ifdef RENDER_CUTOFF
v_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);
#endif
}`),buildingDepth:sr(`in highp float v_depth;void main() {
#ifndef DEPTH_TEXTURE
glFragColor=pack_depth(v_depth);
#endif
}`,"in vec3 a_pos_3f;uniform mat4 u_matrix;out highp float v_depth;void main() {gl_Position=u_matrix*vec4(a_pos_3f,1.0);v_depth=gl_Position.z/gl_Position.w;}"),circle:sr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
in vec3 v_data;in float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
uniform float u_emissive_strength;void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float blur_positive=blur < 0.0 ? 0.0 : 1.0;lowp float antialiasblur=v_data.z;float extrude_length=length(extrude)+antialiasblur*(1.0-blur_positive);float antialiased_blur=-max(abs(blur),antialiasblur);float antialiase_blur_opacity=smoothstep(0.0,antialiasblur,extrude_length-1.0);float opacity_t=blur_positive==1.0 ? 
smoothstep(0.0,-antialiased_blur,1.0-extrude_length) : 
smoothstep(antialiased_blur,0.0,extrude_length-1.0)-antialiase_blur_opacity;float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(
antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width)
);vec4 out_color=mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_apply_premultiplied(out_color,v_fog_pos);
#endif
glFragColor=out_color*(v_visibility*opacity_t);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#define NUM_VISIBILITY_RINGS 2
#define INV_SQRT2 0.70710678
#define ELEVATION_BIAS 0.0001
#define NUM_SAMPLES_PER_RING 16
uniform mat4 u_matrix;uniform mat2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
#ifdef ELEVATED_ROADS
in float a_circle_z_offset;
#endif
out vec3 v_data;out float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
vec2 calc_offset(vec2 extrusion,float radius,float stroke_width, float view_scale) {return extrusion*(radius+stroke_width)*u_extrude_scale*view_scale;}float cantilevered_elevation(vec2 pos,float radius,float stroke_width,float view_scale) {vec2 c1=pos+calc_offset(vec2(-1,-1),radius,stroke_width,view_scale);vec2 c2=pos+calc_offset(vec2(1,-1),radius,stroke_width,view_scale);vec2 c3=pos+calc_offset(vec2(1,1),radius,stroke_width,view_scale);vec2 c4=pos+calc_offset(vec2(-1,1),radius,stroke_width,view_scale);float h1=elevation(c1)+ELEVATION_BIAS;float h2=elevation(c2)+ELEVATION_BIAS;float h3=elevation(c3)+ELEVATION_BIAS;float h4=elevation(c4)+ELEVATION_BIAS;return max(h4,max(h3,max(h1,h2)));}float circle_elevation(vec2 pos) {
#if defined(TERRAIN)
return elevation(pos)+ELEVATION_BIAS;
#else
return 0.0;
#endif
}vec4 project_vertex(vec2 extrusion,vec4 world_center,vec4 projected_center,float radius,float stroke_width, float view_scale,mat3 surface_vectors) {vec2 sample_offset=calc_offset(extrusion,radius,stroke_width,view_scale);
#ifdef PITCH_WITH_MAP
#ifdef PROJECTION_GLOBE_VIEW
return u_matrix*( world_center+vec4(sample_offset.x*surface_vectors[0]+sample_offset.y*surface_vectors[1],0) );
#else
return u_matrix*( world_center+vec4(sample_offset,0,0) );
#endif
#else
return projected_center+vec4(sample_offset,0,0);
#endif
}float get_sample_step() {
#ifdef PITCH_WITH_MAP
return 2.0*PI/float(NUM_SAMPLES_PER_RING);
#else
return PI/float(NUM_SAMPLES_PER_RING);
#endif
}void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);vec4 world_center;mat3 surface_vectors;
#ifdef PROJECTION_GLOBE_VIEW
vec3 pos_normal_3=a_pos_normal_3/16384.0;surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(circle_center)*circle_elevation(circle_center);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*circle_elevation(circle_center);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,circle_center,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;vec3 pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);world_center=vec4(pos,1);
#else 
surface_vectors=mat3(1.0);float height=circle_elevation(circle_center);world_center=vec4(circle_center,height,1);
#endif
#ifdef ELEVATED_ROADS
world_center.z+=a_circle_z_offset+ELEVATION_BIAS;
#endif
vec4 projected_center=u_matrix*world_center;float view_scale=0.0;
#ifdef PITCH_WITH_MAP
#ifdef SCALE_WITH_MAP
view_scale=1.0;
#else
view_scale=projected_center.w/u_camera_to_center_distance;
#endif
#else
#ifdef SCALE_WITH_MAP
view_scale=u_camera_to_center_distance;
#else
view_scale=projected_center.w;
#endif
#endif
gl_Position=project_vertex(extrude,world_center,projected_center,radius,stroke_width,view_scale,surface_vectors);float visibility=0.0;
#ifdef TERRAIN
float step=get_sample_step();vec4 occlusion_world_center;vec4 occlusion_projected_center;
#ifdef PITCH_WITH_MAP
float cantilevered_height=cantilevered_elevation(circle_center,radius,stroke_width,view_scale);occlusion_world_center=vec4(circle_center,cantilevered_height,1);occlusion_projected_center=u_matrix*occlusion_world_center;
#else
occlusion_world_center=world_center;occlusion_projected_center=projected_center;
#endif
for(int ring=0; ring < NUM_VISIBILITY_RINGS; ring++) {float scale=(float(ring)+1.0)/float(NUM_VISIBILITY_RINGS);for(int i=0; i < NUM_SAMPLES_PER_RING; i++) {vec2 extrusion=vec2(cos(step*float(i)),-sin(step*float(i)))*scale;vec4 frag_pos=project_vertex(extrusion,occlusion_world_center,occlusion_projected_center,radius,stroke_width,view_scale,surface_vectors);visibility+=float(!isOccluded(frag_pos));}}visibility/=float(NUM_VISIBILITY_RINGS)*float(NUM_SAMPLES_PER_RING);
#else
visibility=1.0;
#endif
#ifdef PROJECTION_GLOBE_VIEW
visibility=1.0;
#endif
v_visibility=visibility;lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);
#ifdef FOG
v_fog_pos=fog_position(world_center.xyz);
#endif
}`),clippingMask:sr("void main() {glFragColor=vec4(1.0);}","in vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:sr(`#include "_prelude_fog.fragment.glsl"
uniform highp float u_intensity;in vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);glFragColor=vec4(val,1.0,1.0,1.0);
#ifdef FOG
if (u_is_globe==0) {glFragColor.r*=pow(1.0-fog_opacity(v_fog_pos),2.0);}
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_terrain.vertex.glsl"
#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
out vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 tilePos=floor(a_pos*0.5);vec3 pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 pos_normal_3=a_pos_normal_3/16384.0;mat3 surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(tilePos)*elevation(tilePos);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*elevation(tilePos);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,tilePos,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#else
pos=vec3(tilePos+extrude,elevation(tilePos));
#endif
gl_Position=u_matrix*vec4(pos,1);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),heatmapTexture:sr(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;in vec2 v_pos;void main() {float t=texture(u_image,v_pos).r;vec4 color=texture(u_color_ramp,vec2(t,0.5));glFragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(0.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,"in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=vec4(a_pos,0,1);v_pos=a_pos*0.5+0.5;}"),collisionBox:sr("in float v_placed;in float v_notUsed;void main() {vec4 red =vec4(1.0,0.0,0.0,1.0);vec4 blue=vec4(0.0,0.0,1.0,0.5);glFragColor =mix(red,blue,step(0.5,v_placed))*0.5;glFragColor*=mix(1.0,0.1,step(0.5,v_notUsed));}",`#include "_prelude_terrain.vertex.glsl"
in vec3 a_pos;in vec2 a_anchor_pos;in vec2 a_extrude;in vec2 a_placed;in vec2 a_shift;in vec2 a_elevation_from_sea;in float a_size_scale;in vec2 a_padding;in float a_auto_z_offset;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;out float v_placed;out float v_notUsed;void main() {float feature_elevation=a_elevation_from_sea.x+a_auto_z_offset;float terrain_elevation=(a_elevation_from_sea.y==1.0 ? 0.0 : elevation(a_anchor_pos));vec4 projectedPoint=u_matrix*vec4(a_pos+elevationVector(a_anchor_pos)*(feature_elevation+terrain_elevation),1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,1.5);gl_Position=projectedPoint;gl_Position.xy+=(a_extrude*a_size_scale+a_shift+a_padding)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}`),collisionCircle:sr("in float v_radius;in vec2 v_extrude;in float v_perspective_ratio;in float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);glFragColor=color*alpha*opacity_t;}",`in vec2 a_pos_2f;in float a_radius;in vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;out float v_radius;out vec2 v_extrude;out float v_perspective_ratio;out float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos_2f;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(
mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}`),debug:sr("uniform highp vec4 u_color;uniform sampler2D u_overlay;in vec2 v_uv;void main() {vec4 overlay_color=texture(u_overlay,v_uv);glFragColor=mix(u_color,overlay_color,overlay_color.a);}",`#include "_prelude_terrain.vertex.glsl"
in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;
#endif
out vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {float h=elevation(a_pos);v_uv=a_pos/8192.0;
#ifdef PROJECTION_GLOBE_VIEW
gl_Position=u_matrix*vec4(a_pos_3+elevationVector(a_pos)*h,1);
#else
gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,h,1);
#endif
}`),elevatedStructuresDepth:sr(`void main() {
#ifndef DEPTH_TEXTURE
glFragColor=vec4(0.);
#endif
}`,"in vec2 a_pos;in float a_height;uniform mat4 u_matrix;uniform float u_depth_bias;void main() {gl_Position=u_matrix*vec4(a_pos,a_height,1);gl_Position.z=gl_Position.z+u_depth_bias;}"),elevatedStructuresDepthReconstruct:sr(`#ifdef DEPTH_RECONSTRUCTION
in float v_height;
#endif
void main() {
#ifdef DEPTH_RECONSTRUCTION
if (v_height >=0.0)
discard;
#endif
glFragColor=vec4(1.0,0.0,0.0,1.0);}`,`in vec2 a_pos;in float a_height;uniform mat4 u_matrix;uniform vec3 u_camera_pos;uniform highp float u_depth_bias;uniform lowp float u_height_scale;uniform lowp float u_reset_depth;
#ifdef DEPTH_RECONSTRUCTION
out float v_height;
#endif
void main() {vec3 vpos=vec3(a_pos,a_height*u_height_scale);
#ifdef DEPTH_RECONSTRUCTION
if (u_camera_pos.z > vpos.z) {vpos-=(u_camera_pos-vpos)*(vpos.z/(u_camera_pos.z-vpos.z));}v_height=a_height;
#endif
gl_Position=u_matrix*vec4(vpos,1);gl_Position.z=u_reset_depth==1.0 ? gl_Position.w : gl_Position.z+u_depth_bias;}`),elevatedStructures:sr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
in vec3 v_normal;in float v_height;
#ifdef RENDER_SHADOWS
in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in float v_depth;
#endif
vec3 linearTosRGB(vec3 color) {return pow(color,vec3(1./2.2));}vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}vec3 compute_view_dependent_emissive_color(float ndotl,float emissive_strength,vec3 color)
{color=sRGBToLinear(color);color=color*(ndotl+(1.0-min(ndotl*57.29,1.0))*emissive_strength);color=linearTosRGB(color.rgb);return color;}uniform float u_emissive_strength;
#pragma mapbox: define highp vec4 structure_color
void main() {
#pragma mapbox: initialize highp vec4 structure_color
vec3 color=structure_color.xyz;
#ifdef LIGHTING_3D_MODE
vec3 normal=normalize(v_normal);vec3 transformed_normal=vec3(-normal.xy,normal.z);float ndotl=calculate_NdotL(transformed_normal);float emissive_strength=u_emissive_strength;emissive_strength=0.0;vec3 emissive_color=compute_view_dependent_emissive_color(ndotl,emissive_strength,color.xyz);
#ifdef RENDER_SHADOWS
float shadowed_lighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth);color.rgb=apply_lighting(color.rgb,transformed_normal,shadowed_lighting_factor);
#else
color=apply_lighting(color,transformed_normal);
#endif
color=mix(color,emissive_color,emissive_strength);if (v_height < 0.0) {float penetration=max(v_height+7.5,0.0);float occlusion=1.0-1.0/PI*acos(1.0-penetration/4.0);color=color*(1.0-pow(occlusion,2.0)*0.3);}
#endif
#ifdef FOG
color=fog_apply(color,v_fog_pos);
#endif
vec4 out_color=vec4(color,1.0);
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color,v_height);
#endif
glFragColor=out_color;HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec2 a_pos;in float a_height;in vec3 a_pos_normal_3;uniform mat4 u_matrix;out vec3 v_normal;out float v_height;
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out float v_depth;
#endif
#pragma mapbox: define highp vec4 structure_color
void main() {
#pragma mapbox: initialize highp vec4 structure_color
v_normal=a_pos_normal_3/16384.0;v_height=a_height;vec3 pos=vec3(a_pos,a_height);gl_Position=u_matrix*vec4(pos,1);
#ifdef RENDER_SHADOWS
vec3 shd_pos0=pos;vec3 shd_pos1=pos;
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(-v_normal.xy,v_normal.z));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fill:sr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
uniform float u_emissive_strength;
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
#ifdef ELEVATED_ROADS
in highp float v_road_z_offset;
#endif
#ifdef INDICATOR_CUTOUT
in highp float v_z_offset;
#endif
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
vec4 out_color=color;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);
#ifdef ELEVATED_ROADS
out_color.rgb*=mix(v_road_z_offset !=0.0 ? u_ground_shadow_factor : vec3(1.0),vec3(1.0),light);
#else
out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
out_color*=opacity;
#ifdef INDICATOR_CUTOUT
if (v_z_offset >=0.0) {out_color=applyCutout(out_color,v_z_offset);}
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;out highp float v_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
#ifdef INDICATOR_CUTOUT
out highp float v_z_offset;
#endif
uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp float z_offset
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;v_road_z_offset=z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);
#ifdef RENDER_SHADOWS
vec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
#ifdef INDICATOR_CUTOUT
v_z_offset=z_offset;
#endif
}`),fillOutline:sr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
in highp vec2 v_pos;uniform float u_emissive_strength;
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=outline_color;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
uniform mat4 u_matrix;uniform vec2 u_world;out highp vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp float z_offset
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef RENDER_SHADOWS
vec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillOutlinePattern:sr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;
#ifdef FILL_PATTERN_TRANSITION
uniform float u_pattern_transition;
#endif
uniform float u_emissive_strength;
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
in highp vec2 v_pos;in highp vec2 v_pos_world;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);highp vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);float dist=length(v_pos_world-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef FILL_PATTERN_TRANSITION
vec2 pattern_b_tl=pattern_b.xy;vec2 pattern_b_br=pattern_b.zw;highp vec2 pos_b=mix(pattern_b_tl/u_texsize,pattern_b_br/u_texsize,imagecoord);vec4 color_b=textureLodCustom(u_image,pos_b,lod_pos);out_color=out_color*(1.0-u_pattern_transition)+color_b*u_pattern_transition;
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
out highp vec2 v_pos;out highp vec2 v_pos_world;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define lowp float pixel_ratio
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
#pragma mapbox: initialize lowp float pixel_ratio
#pragma mapbox: initialize highp float z_offset
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);v_pos_world=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef RENDER_SHADOWS
vec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillPattern:sr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;
#ifdef FILL_PATTERN_TRANSITION
uniform float u_pattern_transition;
#endif
in highp vec2 v_pos;uniform float u_emissive_strength;
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
#ifdef ELEVATED_ROADS
in highp float v_road_z_offset;
#endif
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);highp vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef FILL_PATTERN_TRANSITION
vec2 pattern_b_tl=pattern_b.xy;vec2 pattern_b_br=pattern_b.zw;highp vec2 pos_b=mix(pattern_b_tl/u_texsize,pattern_b_br/u_texsize,imagecoord);vec4 color_b=textureLodCustom(u_image,pos_b,lod_pos);out_color=out_color*(1.0-u_pattern_transition)+color_b*u_pattern_transition;
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);
#ifdef ELEVATED_ROADS
out_color.rgb*=mix(v_road_z_offset !=0.0 ? u_ground_shadow_factor : vec3(1.0),vec3(1.0),light);
#else
out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;out highp float v_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
out highp vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define lowp float pixel_ratio
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
#pragma mapbox: initialize highp float z_offset
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;v_road_z_offset=z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);
#ifdef RENDER_SHADOWS
vec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillExtrusion:sr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
in vec4 v_color;in vec4 v_flat;
#ifdef RENDER_SHADOWS
in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;
#endif
uniform lowp float u_opacity;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;in vec2 v_ao;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
in vec4 v_roof_color;
#endif
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
in highp vec3 v_normal;
#endif
uniform vec3 u_flood_light_color;uniform highp float u_vertical_scale;uniform float u_flood_light_intensity;uniform vec3 u_ground_shadow_factor;
#if defined(LIGHTING_3D_MODE) && defined(FLOOD_LIGHT)
in float v_flood_radius;in float v_has_floodlight;
#endif
in float v_height;
#pragma mapbox: define highp float emissive_strength
void main() {
#pragma mapbox: initialize highp float emissive_strength
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
vec3 normal=normalize(v_normal);
#endif
float z;vec4 color=v_color;
#ifdef ZERO_ROOF_RADIUS
z=float(normal.z > 0.00001);
#ifdef LIGHTING_3D_MODE
normal=mix(normal,vec3(0.0,0.0,1.0),z);
#else
color=mix(v_color,v_roof_color,z);
#endif
#endif
float h=max(0.0,v_height);float ao_shade=1.0;
#ifdef FAUX_AO
float intensity=u_ao[0];float h_floors=h/(u_ao[1]*u_vertical_scale);float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);ao_shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;
#ifdef ZERO_ROOF_RADIUS
concave*=(1.0-z);
#endif
float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);ao_shade*=mix(1.0,x_shade*x_shade*x_shade,concave);
#ifdef LIGHTING_3D_MODE
#ifdef FLOOD_LIGHT
color.rgb*=mix(ao_shade,1.0,v_has_floodlight);
#else
color.rgb*=ao_shade;
#endif
#else
color.rgb*=ao_shade;
#endif
#endif
#ifdef LIGHTING_3D_MODE
float flood_radiance=0.0;
#ifdef FLOOD_LIGHT
flood_radiance=(1.0-min(h/v_flood_radius,1.0))*u_flood_light_intensity*v_has_floodlight;
#endif
#ifdef RENDER_SHADOWS
#ifdef FLOOD_LIGHT
float ndotl_unclamped=dot(normal,u_shadow_direction);float ndotl=max(0.0,ndotl_unclamped);float occlusion=ndotl_unclamped < 0.0 ? 1.0 : shadow_occlusion(ndotl,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);vec3 litColor=apply_lighting(color.rgb,normal,(1.0-u_shadow_intensity*occlusion)*ndotl);vec3 floodLitColor=compute_flood_lighting(u_flood_light_color*u_opacity,1.0-u_shadow_intensity,occlusion,u_ground_shadow_factor);color.rgb=mix(litColor,floodLitColor,flood_radiance);
#else
float shadowed_lighting_factor;
#ifdef RENDER_CUTOFF
shadowed_lighting_factor=shadowed_light_factor_normal_opacity(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w,v_cutoff_opacity);if (v_cutoff_opacity==0.0) {discard;}
#else
shadowed_lighting_factor=shadowed_light_factor_normal(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);
#endif
color.rgb=apply_lighting(color.rgb,normal,shadowed_lighting_factor);
#endif
#else
color.rgb=apply_lighting(color.rgb,normal);
#ifdef FLOOD_LIGHT
color.rgb=mix(color.rgb,u_flood_light_color*u_opacity,flood_radiance);
#endif
#endif
color.rgb=mix(color.rgb,v_flat.rgb,emissive_strength);color*=u_opacity;
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos,h));
#endif
#ifdef INDICATOR_CUTOUT
color=applyCutout(color,h);
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
#include "_prelude_lighting.glsl"
uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform float u_edge_radius;uniform float u_width_scale;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#ifdef RENDER_WALL_MODE
in vec3 a_join_normal_inside;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
#ifdef TERRAIN
uniform int u_height_type;uniform int u_base_type;
#endif
uniform highp float u_vertical_scale;out vec4 v_color;out vec4 v_flat;
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
out vec4 v_roof_color;
#endif
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
out highp vec3 v_normal;
#endif
#ifdef FAUX_AO
uniform lowp vec2 u_ao;out vec2 v_ao;
#endif
#if defined(LIGHTING_3D_MODE) && defined(FLOOD_LIGHT)
out float v_flood_radius;out float v_has_floodlight;
#endif
out float v_height;vec3 linearTosRGB(vec3 color) {return pow(color,vec3(1./2.2));}vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
#pragma mapbox: define highp float flood_light_wall_radius
#pragma mapbox: define highp float line_width
#pragma mapbox: define highp float emissive_strength
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize highp float flood_light_wall_radius
#pragma mapbox: initialize highp float line_width
#pragma mapbox: initialize highp float emissive_strength
base*=u_vertical_scale;height*=u_vertical_scale;vec4 pos_nx=floor(a_pos_normal_ed*0.5);vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
v_normal=normal;
#endif
base=max(0.0,base);float attr_height=height;height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
float ele=0.0;float h=0.0;float c_ele=0.0;vec3 pos;
#ifdef TERRAIN
bool is_flat_height=centroid_pos.x !=0.0 && u_height_type==1;bool is_flat_base=centroid_pos.x !=0.0 && u_base_type==1;ele=elevation(pos_nx.xy);c_ele=is_flat_height || is_flat_base ? (centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos)) : ele;float h_height=is_flat_height ? max(c_ele+height,ele+base+2.0) : ele+height;float h_base=is_flat_base ? max(c_ele+base,ele+base) : ele+(base==0.0 ?-5.0 : base);h=t > 0.0 ? max(h_base,h_height) : h_base;pos=vec3(pos_nx.xy,h);
#else
h=t > 0.0 ? height : base;pos=vec3(pos_nx.xy,h);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*h);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,pos.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*pos.z;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
float cutoff=1.0;vec3 scaled_pos=pos;
#ifdef RENDER_CUTOFF
vec3 centroid_random=vec3(centroid_pos.xy,centroid_pos.x+centroid_pos.y+1.0);vec3 ground_pos=centroid_pos.x==0.0 ? pos.xyz : (centroid_random/8.0);vec4 ground=u_matrix*vec4(ground_pos.xy,ele,1.0);cutoff=cutoff_opacity(u_cutoff_params,ground.z);if (centroid_pos.y !=0.0 && centroid_pos.x !=0.0) {vec3 g=floor(ground_pos);vec3 mod_=centroid_random-g*8.0;float seed=min(1.0,0.1*(min(3.5,max(mod_.x+mod_.y,0.2*attr_height))*0.35+mod_.z));if (cutoff < 0.8-seed) {cutoff=0.0;}}float cutoff_scale=cutoff;v_cutoff_opacity=cutoff;scaled_pos.z=mix(c_ele,h,cutoff_scale);
#endif
float hidden=float((centroid_pos.x==0.0 && centroid_pos.y==1.0) || (cutoff==0.0 && centroid_pos.x !=0.0) || (color.a==0.0));
#ifdef RENDER_WALL_MODE
vec2 wall_offset=u_width_scale*line_width*(a_join_normal_inside.xy/EXTENT);scaled_pos.xy+=(1.0-a_join_normal_inside.z)*wall_offset*0.5;scaled_pos.xy-=a_join_normal_inside.z*wall_offset*0.5;
#endif
gl_Position=mix(u_matrix*vec4(scaled_pos,1),AWAY,hidden);h=h-ele;v_height=h;
#ifdef RENDER_SHADOWS
vec3 shd_pos0=pos;vec3 shd_pos1=pos;
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(normal);shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);
#endif
float NdotL=0.0;float colorvalue=0.0;
#ifndef LIGHTING_3D_MODE
colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),NdotL);if (normal.y !=0.0) {float r=0.84;r=mix(0.7,0.98,1.0-u_lightintensity);NdotL*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}
#endif
#ifdef FAUX_AO
float concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;
#ifdef TERRAIN
top_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);
#endif
v_ao=vec2(mix(concave,-concave,start),y_ground);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);
#ifdef PROJECTION_GLOBE_VIEW
top_height+=u_height_lift;
#endif
gl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;
#endif
#ifdef LIGHTING_3D_MODE
#ifdef FLOOD_LIGHT
float is_wall=1.0-float(t > 0.0 && top_up_ny.y > 0.0);v_has_floodlight=float(flood_light_wall_radius > 0.0 && is_wall > 0.0);v_flood_radius=flood_light_wall_radius*u_vertical_scale;
#endif
v_color=vec4(color.rgb,1.0);float ndotl=calculate_NdotL(normal);v_flat.rgb=sRGBToLinear(color.rgb);v_flat.rgb=v_flat.rgb*(ndotl+(1.0-min(ndotl*57.29,1.0))*emissive_strength);v_flat=vec4(linearTosRGB(v_flat.rgb),1.0);
#else
v_color=vec4(0.0,0.0,0.0,1.0);v_color.rgb+=clamp(color.rgb*NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_color*=u_opacity;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
float roofNdotL=clamp(u_lightpos.z,0.0,1.0);roofNdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),roofNdotL);v_roof_color=vec4(0.0,0.0,0.0,1.0);v_roof_color.rgb+=clamp(color.rgb*roofNdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_roof_color*=u_opacity;
#endif
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),fillExtrusionDepth:sr(`in highp float v_depth;void main() {
#ifndef DEPTH_TEXTURE
glFragColor=pack_depth(v_depth);
#endif
}`,`#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_matrix;uniform float u_edge_radius;uniform float u_width_scale;uniform float u_vertical_scale;
#ifdef TERRAIN
uniform int u_height_type;uniform int u_base_type;
#endif
in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#ifdef RENDER_WALL_MODE
in vec3 a_join_normal_inside;
#endif
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp float line_width
#pragma mapbox: define highp vec4 color
out highp float v_depth;void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp float line_width
#pragma mapbox: initialize highp vec4 color
base*=u_vertical_scale;height*=u_vertical_scale;vec3 pos_nx=floor(a_pos_normal_ed.xyz*0.5);mediump vec3 top_up_ny=a_pos_normal_ed.xyz-2.0*pos_nx;base=max(0.0,base);height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
vec3 pos;
#ifdef TERRAIN
bool is_flat_height=centroid_pos.x !=0.0 && u_height_type==1;bool is_flat_base=centroid_pos.x !=0.0 && u_base_type==1;float ele=elevation(pos_nx.xy);float c_ele=is_flat_height || is_flat_base ? (centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos)) : ele;float h_height=is_flat_height ? max(c_ele+height,ele+base+2.0) : ele+height;float h_base=is_flat_base ? max(c_ele+base,ele+base) : ele+(base==0.0 ?-5.0 : base);float h=t > 0.0 ? max(h_base,h_height) : h_base;pos=vec3(pos_nx.xy,h);
#else
pos=vec3(pos_nx.xy,t > 0.0 ? height : base);
#endif
#ifdef RENDER_WALL_MODE
vec2 wall_offset=u_width_scale*line_width*(a_join_normal_inside.xy/EXTENT);pos.xy+=(1.0-a_join_normal_inside.z)*wall_offset*0.5;pos.xy-=a_join_normal_inside.z*wall_offset*0.5;
#endif
float hidden=float((centroid_pos.x==0.0 && centroid_pos.y==1.0) || (color.a==0.0));gl_Position=mix(u_matrix*vec4(pos,1),AWAY,hidden);v_depth=gl_Position.z/gl_Position.w;}`),fillExtrusionPattern:sr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
uniform float u_pattern_transition;
#endif
#ifdef FAUX_AO
uniform lowp vec2 u_ao;in vec3 v_ao;
#endif
#ifdef LIGHTING_3D_MODE
in vec3 v_normal;
#endif
in highp vec2 v_pos;in vec4 v_lighting;uniform lowp float u_opacity;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define mediump vec4 pattern
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define highp float pixel_ratio
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize mediump vec4 pattern
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
#pragma mapbox: initialize highp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);highp vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
vec2 pattern_b_tl=pattern_b.xy;vec2 pattern_b_br=pattern_b.zw;highp vec2 pos_b=mix(pattern_b_tl/u_texsize,pattern_b_br/u_texsize,imagecoord);vec4 color_b=textureLodCustom(u_image,pos_b,lod_pos);out_color=out_color*(1.0-u_pattern_transition)+color_b*u_pattern_transition;
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color,normalize(v_normal))*u_opacity;
#else
out_color=out_color*v_lighting;
#endif
#ifdef FAUX_AO
float intensity=u_ao[0];float h=max(0.0,v_ao.z);float h_floors=h/u_ao[1];float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);float shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);shade*=mix(1.0,x_shade*x_shade*x_shade,concave);out_color.rgb=out_color.rgb*shade;
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color,height);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#include "_prelude_lighting.glsl"
uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform float u_tile_units_to_pixels;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform float u_width_scale;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#ifdef RENDER_WALL_MODE
in vec3 a_join_normal_inside;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
#ifdef TERRAIN
uniform int u_height_type;uniform int u_base_type;
#endif
out highp vec2 v_pos;out vec4 v_lighting;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;out vec3 v_ao;
#endif
#ifdef LIGHTING_3D_MODE
out vec3 v_normal;
#endif
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump vec4 pattern
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define highp float pixel_ratio
#pragma mapbox: define highp float line_width
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump vec4 pattern
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
#pragma mapbox: initialize highp float pixel_ratio
#pragma mapbox: initialize highp float line_width
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec4 pos_nx=floor(a_pos_normal_ed*0.5);mediump vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;mediump vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));float edgedistance=a_pos_normal_ed.w;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;base=max(0.0,base);height=max(0.0,height);float t=top_up_ny.x;float z=t > 0.0 ? height : base;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
float ele=0.0;float h=z;vec3 p;float c_ele;
#ifdef TERRAIN
bool is_flat_height=centroid_pos.x !=0.0 && u_height_type==1;bool is_flat_base=centroid_pos.x !=0.0 && u_base_type==1;ele=elevation(pos_nx.xy);c_ele=is_flat_height || is_flat_base ? (centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos)) : ele;float h_height=is_flat_height ? max(c_ele+height,ele+base+2.0) : ele+height;float h_base=is_flat_base ? max(c_ele+base,ele+base) : ele+(base==0.0 ?-5.0 : base);h=t > 0.0 ? max(h_base,h_height) : h_base;p=vec3(pos_nx.xy,h);
#else
p=vec3(pos_nx.xy,z);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*(p.z+lift));vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,p.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*p.z;p=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
#ifdef RENDER_WALL_MODE
vec2 wall_offset=u_width_scale*line_width*(a_join_normal_inside.xy/EXTENT);p.xy+=(1.0-a_join_normal_inside.z)*wall_offset*0.5;p.xy-=a_join_normal_inside.z*wall_offset*0.5;
#endif
float hidden=float((centroid_pos.x==0.0 && centroid_pos.y==1.0) || (color.a==0.0));gl_Position=mix(u_matrix*vec4(p,1),AWAY,hidden);vec2 pos=normal.z==1.0
? pos_nx.xy
: vec2(edgedistance,z*u_height_factor);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float NdotL=0.0;
#ifdef LIGHTING_3D_MODE
NdotL=calculate_NdotL(normal);
#else
NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),NdotL);
#endif
if (normal.y !=0.0) {float r=0.84;
#ifndef LIGHTING_3D_MODE
r=mix(0.7,0.98,1.0-u_lightintensity);
#endif
NdotL*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}
#ifdef FAUX_AO
float concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;
#ifdef TERRAIN
top_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);
#endif
v_ao=vec3(mix(concave,-concave,start),y_ground,h-ele);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);
#ifdef PROJECTION_GLOBE_VIEW
top_height+=u_height_lift;
#endif
gl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;
#endif
#ifdef LIGHTING_3D_MODE
v_normal=normal;
#else
v_lighting.rgb+=clamp(NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;
#endif
#ifdef FOG
v_fog_pos=fog_position(p);
#endif
}`),groundShadow:sr(`#include "_prelude_shadow.fragment.glsl"
precision highp float;uniform vec3 u_ground_shadow_factor;in vec4 v_pos_light_view_0;in vec4 v_pos_light_view_1;
#ifdef FOG
in float v_fog_opacity;
#endif
void main() {float light=shadowed_light_factor_plane_bias(v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);vec3 shadow=mix(u_ground_shadow_factor,vec3(1.0),light);
#ifdef RENDER_CUTOFF
shadow=mix(vec3(1.0),shadow,cutoff_opacity(u_cutoff_params,1.0/gl_FragCoord.w));
#endif
#ifdef FOG
shadow=mix(shadow,vec3(1.0),v_fog_opacity);
#endif
#ifdef INDICATOR_CUTOUT
shadow=mix(shadow,vec3(1.0),1.0-applyCutout(vec4(1.0),0.0).r);
#endif
glFragColor=vec4(shadow,1.0);}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;in vec2 a_pos;out vec4 v_pos_light_view_0;out vec4 v_pos_light_view_1;
#ifdef FOG
out float v_fog_opacity;
#endif
void main() {gl_Position=u_matrix*vec4(a_pos,0.0,1.0);v_pos_light_view_0=u_light_matrix_0*vec4(a_pos,0.0,1.0);v_pos_light_view_1=u_light_matrix_1*vec4(a_pos,0.0,1.0);
#ifdef FOG
v_fog_pos=fog_position(a_pos);v_fog_opacity=fog(v_fog_pos);
#endif
}`),fillExtrusionGroundEffect:sr(`uniform highp float u_ao_pass;uniform highp float u_opacity;uniform highp float u_flood_light_intensity;uniform highp vec3 u_flood_light_color;uniform highp float u_attenuation;uniform sampler2D u_fb;uniform float u_fb_size;
#ifdef SDF_SUBPASS
in highp vec2 v_pos;in highp vec4 v_line_segment;in highp float v_flood_light_radius_tile;in highp vec2 v_ao;float line_df(highp vec2 a,highp vec2 b,highp vec2 p) {highp vec2 ba=b-a;highp vec2 pa=p-a;highp float r=clamp(dot(pa,ba)/dot(ba,ba),0.0,1.0);return length(pa-r*ba);}
#ifdef FOG
in highp float v_fog;
#endif
#endif
void main() {
#ifdef CLEAR_SUBPASS
vec4 color=vec4(1.0);
#ifdef CLEAR_FROM_TEXTURE
color=texture(u_fb,gl_FragCoord.xy/vec2(u_fb_size));
#endif
glFragColor=color;
#else
#ifdef SDF_SUBPASS
highp float d=line_df(v_line_segment.xy,v_line_segment.zw,v_pos);highp float effect_radius=mix(v_flood_light_radius_tile,v_ao.y,u_ao_pass);d/=effect_radius;d=min(d,1.0);d=1.0-pow(1.0-d,u_attenuation);highp float effect_intensity=mix(u_flood_light_intensity,v_ao.x,u_ao_pass);highp float fog=1.0;
#ifdef FOG
fog=v_fog;
#endif
#ifdef RENDER_CUTOFF
fog*=v_cutoff_opacity;
#endif
glFragColor=vec4(vec3(0.0),mix(1.0,d,effect_intensity*u_opacity*fog));
#else
vec4 color=mix(vec4(u_flood_light_color,1.0),vec4(vec3(0.0),1.0),u_ao_pass);
#ifdef OVERDRAW_INSPECTOR
color=vec4(1.0);
#endif
glFragColor=color;
#endif
HANDLE_WIREFRAME_DEBUG;
#endif
}`,`#include "_prelude_fog.vertex.glsl"
in highp vec4 a_pos_end;in highp float a_angular_offset_factor;in highp float a_hidden_by_landmark;
#ifdef SDF_SUBPASS
out highp vec2 v_pos;out highp vec4 v_line_segment;out highp float v_flood_light_radius_tile;out highp vec2 v_ao;
#ifdef FOG
out highp float v_fog;
#endif
#endif
uniform highp float u_flood_light_intensity;uniform highp mat4 u_matrix;uniform highp float u_ao_pass;uniform highp float u_meter_to_tile;uniform highp float u_edge_radius;uniform highp float u_dynamic_offset;uniform highp vec2 u_ao;
#pragma mapbox: define highp float flood_light_ground_radius
const float TANGENT_CUTOFF=4.0;const float NORM=32767.0;void main() {
#pragma mapbox: initialize highp float flood_light_ground_radius
vec2 p=a_pos_end.xy;vec2 q=floor(a_pos_end.zw*0.5);vec2 start_bottom=a_pos_end.zw-q*2.0;float fl_ground_radius=flood_light_ground_radius;fl_ground_radius=abs(flood_light_ground_radius);float direction=flood_light_ground_radius < 0.0 ?-1.0 : 1.0;float flood_radius_tile=fl_ground_radius*u_meter_to_tile;vec2 v=normalize(q-p);float ao_radius=u_ao.y/3.5;float effect_radius=mix(flood_radius_tile,ao_radius,u_ao_pass)+u_edge_radius;float angular_offset_factor=a_angular_offset_factor/NORM*TANGENT_CUTOFF;float angular_offset=direction*angular_offset_factor*effect_radius;float top=1.0-start_bottom.y;float side=(0.5-start_bottom.x)*2.0;vec2 extrusion_parallel=v*side*mix(u_dynamic_offset,angular_offset,top);vec2 perp=vec2(v.y,-v.x);vec2 extrusion_perp=direction*perp*effect_radius*top;vec3 pos=vec3(mix(q,p,start_bottom.x),0.0);pos.xy+=extrusion_parallel+extrusion_perp;
#ifdef SDF_SUBPASS
v_pos=pos.xy;v_line_segment=vec4(p,q)+perp.xyxy*u_edge_radius;v_flood_light_radius_tile=flood_radius_tile;v_ao=vec2(u_ao.x,ao_radius);
#ifdef FOG
v_fog_pos=fog_position(pos);v_fog=1.0-fog(v_fog_pos);
#endif
#endif
float hidden_by_landmark=0.0;
#ifdef HAS_CENTROID
hidden_by_landmark=a_hidden_by_landmark;
#endif
float isFloodlit=float(fl_ground_radius > 0.0 && u_flood_light_intensity > 0.0);float hidden=mix(1.0-isFloodlit,isFloodlit,u_ao_pass);hidden+=hidden_by_landmark;gl_Position=mix(u_matrix*vec4(pos,1.0),AWAY,float(hidden > 0.0));
#ifdef RENDER_CUTOFF
v_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);
#endif
}`),hillshadePrepare:sr(`precision highp float;uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;float getElevation(vec2 coord) {return texture(u_image,coord).r/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y));float b=getElevation(v_pos+vec2(0,-epsilon.y));float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y));float d=getElevation(v_pos+vec2(-epsilon.x,0));float e=getElevation(v_pos+vec2(epsilon.x,0));float f=getElevation(v_pos+vec2(-epsilon.x,epsilon.y));float g=getElevation(v_pos+vec2(0,epsilon.y));float h=getElevation(v_pos+vec2(epsilon.x,epsilon.y));float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2(
(c+e+e+h)-(a+d+d+f),(f+g+g+h)-(a+b+b+c)
)/pow(2.0,exaggeration+(19.2562-u_zoom));glFragColor=clamp(vec4(
deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:sr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;uniform float u_emissive_strength;void main() {vec4 pixel=texture(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);glFragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef LIGHTING_3D_MODE
glFragColor=apply_lighting_with_emission_ground(glFragColor,u_emissive_strength);
#endif
#ifdef FOG
glFragColor=fog_dither(fog_apply_premultiplied(glFragColor,v_fog_pos));
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),line:sr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
uniform lowp float u_device_pixel_ratio;uniform highp float u_width_scale;uniform highp float u_floor_width_scale;uniform float u_alpha_discard_threshold;uniform highp vec2 u_trim_offset;uniform highp vec2 u_trim_fade_range;uniform lowp vec4 u_trim_color;in vec2 v_width2;in vec2 v_normal;in float v_gamma_scale;in highp vec3 v_uv;
#ifdef ELEVATED_ROADS
in highp float v_road_z_offset;
#endif
#ifdef RENDER_LINE_DASH
uniform sampler2D u_dash_image;in vec2 v_tex;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform sampler2D u_gradient_image;
#endif
#ifdef INDICATOR_CUTOUT
in highp float v_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
float luminance(vec3 c) {return (c.r+c.r+c.b+c.g+c.g+c.g)*0.1667;}uniform float u_emissive_strength;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float border_width
#pragma mapbox: define lowp vec4 border_color
float linearstep(float edge0,float edge1,float x) {return  clamp((x-edge0)/(edge1-edge0),0.0,1.0);}void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float border_width
#pragma mapbox: initialize lowp vec4 border_color
float dist=length(v_normal)*v_width2.s;float blur2=(u_width_scale*blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);
#ifdef RENDER_LINE_DASH
float sdfdist=texture(u_dash_image,v_tex).r;float sdfgamma=1.0/(2.0*u_device_pixel_ratio)/dash.z;float scaled_floorwidth=(floorwidth*u_floor_width_scale);alpha*=linearstep(0.5-sdfgamma/scaled_floorwidth,0.5+sdfgamma/scaled_floorwidth,sdfdist);
#endif
highp vec4 out_color;
#ifdef RENDER_LINE_GRADIENT
out_color=texture(u_gradient_image,v_uv.xy);
#else
out_color=color;
#endif
float trim_alpha=1.0;
#ifdef RENDER_LINE_TRIM_OFFSET
highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=v_uv[2];if (trim_end > trim_start) {highp float start_transition=max(0.0,min(1.0,(line_progress-trim_start)/max(u_trim_fade_range[0],1.0e-9)));highp float end_transition=max(0.0,min(1.0,(trim_end-line_progress)/max(u_trim_fade_range[1],1.0e-9)));highp float transition_factor=min(start_transition,end_transition);out_color=mix(out_color,u_trim_color,transition_factor);trim_alpha=1.0-transition_factor;}
#endif
if (u_alpha_discard_threshold !=0.0) {if (alpha < u_alpha_discard_threshold) {discard;}}
#ifdef RENDER_LINE_BORDER
float edgeBlur=((border_width*u_width_scale)+1.0/u_device_pixel_ratio);float alpha2=clamp(min(dist-(v_width2.t-edgeBlur),v_width2.s-dist)/edgeBlur,0.0,1.0);if (alpha2 < 1.) {float smoothAlpha=smoothstep(0.6,1.0,alpha2);if (border_color.a==0.0) {float Y=(out_color.a > 0.01) ? luminance(out_color.rgb/out_color.a) : 1.;float adjustment=(Y > 0.) ? 0.5/Y : 0.45;if (out_color.a > 0.25 && Y < 0.25) {vec3 borderColor=(Y > 0.) ? out_color.rgb : vec3(1,1,1)*out_color.a;out_color.rgb=out_color.rgb+borderColor*(adjustment*(1.0-smoothAlpha));} else {out_color.rgb*=(0.6 +0.4*smoothAlpha);}} else {out_color=mix(border_color*trim_alpha,out_color,smoothAlpha);}}
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);
#ifdef ELEVATED_ROADS
out_color.rgb*=mix(v_road_z_offset !=0.0 ? u_ground_shadow_factor : vec3(1.0),vec3(1.0),light);
#else
out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
out_color*=(alpha*opacity);
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color,v_z_offset);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#define EXTRUDE_SCALE 0.015873016
in vec2 a_pos_normal;in vec4 a_data;
#if defined(ELEVATED) || defined(ELEVATED_ROADS) || defined(VARIABLE_LINE_WIDTH)
in vec3 a_z_offset_width;
#endif
#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)
in highp vec3 a_packed;
#endif
#ifdef RENDER_LINE_DASH
in float a_linesofar;
#endif
uniform mat4 u_matrix;uniform mat2 u_pixels_to_tile_units;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;uniform float u_width_scale;uniform highp float u_floor_width_scale;
#ifdef ELEVATED
uniform lowp float u_zbias_factor;uniform lowp float u_tile_to_meter;float sample_elevation(vec2 apos) {
#ifdef ELEVATION_REFERENCE_SEA
return 0.0;
#else
return elevation(apos);
#endif
}
#endif
out vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp vec3 v_uv;
#ifdef ELEVATED_ROADS
out highp float v_road_z_offset;
#endif
#ifdef RENDER_LINE_DASH
uniform vec2 u_texsize;uniform float u_tile_units_to_pixels;out vec2 v_tex;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform float u_image_height;
#endif
#ifdef INDICATOR_CUTOUT
out highp float v_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float border_width
#pragma mapbox: define lowp vec4 border_color
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float border_width
#pragma mapbox: initialize lowp vec4 border_color
float a_z_offset;
#if defined(ELEVATED) || defined(ELEVATED_ROADS)
a_z_offset=a_z_offset_width.x;
#endif
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth;
#ifdef VARIABLE_LINE_WIDTH
float left=a_pos_normal.y-2.0*floor(a_pos_normal.y*0.5);halfwidth=(u_width_scale*(left==1.0 ? a_z_offset_width.y : a_z_offset_width.z))/2.0;
#else
halfwidth=(u_width_scale*width)/2.0;
#endif
offset=-1.0*offset*u_width_scale;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*EXTRUDE_SCALE;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*EXTRUDE_SCALE*normal.y*mat2(t,-u,u,t);float hidden=float(opacity==0.0);vec2 extrude=dist*u_pixels_to_tile_units;vec4 projected_extrude=u_matrix*vec4(extrude,0.0,0.0);vec2 projected_extrude_xy=projected_extrude.xy;
#ifdef ELEVATED_ROADS
v_road_z_offset=a_z_offset;gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,a_z_offset,1.0)+projected_extrude;
#else
#ifdef ELEVATED
vec2 offsetTile=offset2*u_pixels_to_tile_units;vec2 offset_pos=pos+offsetTile;float ele=0.0;
#ifdef CROSS_SLOPE_VERTICAL
float top=a_pos_normal.y-2.0*floor(a_pos_normal.y*0.5);float line_height=2.0*u_tile_to_meter*outset*top*u_pixels_to_tile_units[1][1]+a_z_offset;ele=sample_elevation(offset_pos)+line_height;projected_extrude=vec4(0);
#else
#ifdef CROSS_SLOPE_HORIZONTAL
float ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,max(ele1,ele2));ele=ele_max+a_z_offset;
#else
float ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,0.5*(ele1+ele2));ele=ele_max-ele0+ele1+a_z_offset;
#endif
#endif
gl_Position=u_matrix*vec4(offset_pos,ele,1.0)+projected_extrude;float z=clamp(gl_Position.z/gl_Position.w,0.5,1.0);float zbias=max(0.00005,(pow(z,0.8)-z)*u_zbias_factor*u_exaggeration);gl_Position.z-=(gl_Position.w*zbias);gl_Position=mix(gl_Position,AWAY,hidden);
#else
gl_Position=mix(u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude,AWAY,hidden);
#endif
#endif
#ifdef ELEVATED_ROADS
#ifdef RENDER_SHADOWS
vec3 shd_pos=vec3(pos+(offset2+dist)*u_pixels_to_tile_units,a_z_offset);vec3 shd_pos0=shd_pos;vec3 shd_pos1=shd_pos;
#ifdef NORMAL_OFFSET
vec3 shd_pos_offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=shd_pos_offset*shadow_normal_offset_multiplier0();shd_pos1+=shd_pos_offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#endif
#ifndef RENDER_TO_TEXTURE
float epsilon=0.0001;float extrude_length_without_perspective=max(length(dist),epsilon);float extrude_length_with_perspective=max(length(projected_extrude_xy/gl_Position.w*u_units_to_pixels),epsilon);v_gamma_scale=mix(extrude_length_without_perspective/extrude_length_with_perspective,1.0,step(0.01,blur));
#else
v_gamma_scale=1.0;
#endif
#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)
highp float a_uv_x=a_packed[0];float a_split_index=a_packed[1];highp float line_progress=a_packed[2];
#ifdef RENDER_LINE_GRADIENT
highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec3(a_uv_x,a_split_index*texel_height-half_texel_height,line_progress);
#else
v_uv=vec3(a_uv_x,0.0,line_progress);
#endif
#endif
#ifdef RENDER_LINE_DASH
float scale=dash.z==0.0 ? 0.0 : u_tile_units_to_pixels/dash.z;float height=dash.y;v_tex=vec2(a_linesofar*scale/(floorwidth*u_floor_width_scale),(-normal.y*height+dash.x+0.5)/u_texsize.y);
#endif
v_width2=vec2(outset,inset);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
#ifdef INDICATOR_CUTOUT
v_z_offset=a_z_offset;
#endif
}`),linePattern:sr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
uniform highp float u_device_pixel_ratio;uniform highp float u_width_scale;uniform highp float u_alpha_discard_threshold;uniform highp vec2 u_texsize;uniform highp float u_tile_units_to_pixels;uniform highp vec2 u_trim_offset;uniform highp vec2 u_trim_fade_range;uniform lowp vec4 u_trim_color;uniform sampler2D u_image;
#ifdef LINE_PATTERN_TRANSITION
uniform float u_pattern_transition;
#endif
in vec2 v_normal;in vec2 v_width2;in highp float v_linesofar;in float v_gamma_scale;in float v_width;
#ifdef RENDER_LINE_TRIM_OFFSET
in highp vec3 v_uv;
#endif
#ifdef ELEVATED_ROADS
in highp float v_road_z_offset;
#endif
#ifdef LINE_JOIN_NONE
in vec2 v_pattern_data;
#endif
#ifdef INDICATOR_CUTOUT
in highp float v_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
uniform float u_emissive_strength;
#pragma mapbox: define mediump vec4 pattern
#ifdef LINE_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define mediump float pixel_ratio
#pragma mapbox: define mediump float blur
#pragma mapbox: define mediump float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern
#ifdef LINE_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
#pragma mapbox: initialize mediump float pixel_ratio
#pragma mapbox: initialize mediump float blur
#pragma mapbox: initialize mediump float opacity
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;highp float pattern_size=display_size.x/u_tile_units_to_pixels;float aspect=display_size.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(u_width_scale*blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);highp float pattern_x=v_linesofar/pattern_size*aspect;highp float x=mod(pattern_x,1.0);highp float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;highp vec2 pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(x,y));highp vec2 lod_pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(pattern_x,y));vec4 color=textureLodCustom(u_image,pos,lod_pos);
#ifdef LINE_PATTERN_TRANSITION
vec2 pattern_b_tl=pattern_b.xy;vec2 pattern_b_br=pattern_b.zw;highp vec2 pos_b=mix(pattern_b_tl*texel_size-texel_size,pattern_b_br*texel_size+texel_size,vec2(x,y));vec4 color_b=textureLodCustom(u_image,pos_b,lod_pos);color=color*(1.0-u_pattern_transition)+color_b*u_pattern_transition;
#endif
#ifdef RENDER_LINE_TRIM_OFFSET
highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=v_uv[2];if (trim_end > trim_start) {highp float start_transition=max(0.0,min(1.0,(line_progress-trim_start)/max(u_trim_fade_range[0],1.0e-9)));highp float end_transition=max(0.0,min(1.0,(trim_end-line_progress)/max(u_trim_fade_range[1],1.0e-9)));highp float transition_factor=min(start_transition,end_transition);color=mix(color,color.a*u_trim_color,transition_factor);}
#endif
#ifdef LINE_JOIN_NONE
highp float pattern_len=pattern_size/aspect;highp float segment_phase=pattern_len-mod(v_linesofar-v_pattern_data.x+pattern_len,pattern_len);highp float visible_start=segment_phase-step(pattern_len*0.5,segment_phase)*pattern_len;highp float visible_end=floor((v_pattern_data.y-segment_phase)/pattern_len)*pattern_len+segment_phase;visible_end+=step(pattern_len*0.5,v_pattern_data.y-visible_end)*pattern_len;if (v_pattern_data.x < visible_start || v_pattern_data.x >=visible_end) {color=vec4(0.0);}
#endif
#ifdef LIGHTING_3D_MODE
color=apply_lighting_with_emission_ground(color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);
#ifdef ELEVATED_ROADS
color.rgb*=mix(v_road_z_offset !=0.0 ? u_ground_shadow_factor : vec3(1.0),vec3(1.0),light);
#else
color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
color*=(alpha*opacity);if (u_alpha_discard_threshold !=0.0) {if (color.a < u_alpha_discard_threshold) {discard;}}
#ifdef INDICATOR_CUTOUT
color=applyCutout(color,v_z_offset);
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#define scale 0.015873016
in vec2 a_pos_normal;in vec4 a_data;
#if defined(ELEVATED) || defined(ELEVATED_ROADS)
in vec3 a_z_offset_width;
#endif
#ifdef RENDER_LINE_TRIM_OFFSET
in highp vec3 a_packed;
#endif
in highp float a_linesofar;
#ifdef LINE_JOIN_NONE
in highp vec3 a_pattern_data;out vec2 v_pattern_data;
#endif
#ifdef INDICATOR_CUTOUT
out highp float v_z_offset;
#endif
uniform mat4 u_matrix;uniform float u_tile_units_to_pixels;uniform vec2 u_units_to_pixels;uniform mat2 u_pixels_to_tile_units;uniform float u_device_pixel_ratio;uniform float u_width_scale;uniform float u_floor_width_scale;
#ifdef ELEVATED
uniform lowp float u_zbias_factor;uniform lowp float u_tile_to_meter;float sample_elevation(vec2 apos) {
#ifdef ELEVATION_REFERENCE_SEA
return 0.0;
#else
return elevation(apos);
#endif
}
#endif
out vec2 v_normal;out vec2 v_width2;out highp float v_linesofar;out float v_gamma_scale;out float v_width;
#ifdef RENDER_LINE_TRIM_OFFSET
out highp vec3 v_uv;
#endif
#ifdef ELEVATED_ROADS
out highp float v_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
#pragma mapbox: define mediump float blur
#pragma mapbox: define mediump float opacity
#pragma mapbox: define mediump float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define mediump float floorwidth
#pragma mapbox: define mediump vec4 pattern
#ifdef LINE_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define mediump float pixel_ratio
void main() {
#pragma mapbox: initialize mediump float blur
#pragma mapbox: initialize mediump float opacity
#pragma mapbox: initialize mediump float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize mediump float floorwidth
#pragma mapbox: initialize mediump vec4 pattern
#ifdef LINE_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
#pragma mapbox: initialize mediump float pixel_ratio
float a_z_offset;
#if defined(ELEVATED) || defined(ELEVATED_ROADS)
a_z_offset=a_z_offset_width.x;
#endif
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=(u_width_scale*width)/2.0;offset=-1.0*offset*u_width_scale;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);vec2 dist=outset*a_extrude*scale;float u=0.5*a_direction;float t=1.0-abs(u);vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float hidden=float(opacity==0.0);vec2 extrude=dist*u_pixels_to_tile_units;vec4 projected_extrude=u_matrix*vec4(extrude,0.0,0.0);vec2 projected_extrude_xy=projected_extrude.xy;
#ifdef ELEVATED_ROADS
v_road_z_offset=a_z_offset;gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,a_z_offset,1.0)+projected_extrude;
#else
#ifdef ELEVATED
vec2 offsetTile=offset2*u_pixels_to_tile_units;vec2 offset_pos=pos+offsetTile;float ele=0.0;
#ifdef CROSS_SLOPE_VERTICAL
float top=a_pos_normal.y-2.0*floor(a_pos_normal.y*0.5);float line_height=2.0*u_tile_to_meter*outset*top*u_pixels_to_tile_units[1][1]+a_z_offset;ele=sample_elevation(offset_pos)+line_height;projected_extrude=vec4(0);
#else
#ifdef CROSS_SLOPE_HORIZONTAL
float ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,max(ele1,ele2));ele=ele_max+a_z_offset;
#else
float ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,0.5*(ele1+ele2));ele=ele_max-ele0+ele1+a_z_offset;
#endif
#endif
gl_Position=u_matrix*vec4(offset_pos,ele,1.0)+projected_extrude;float z=clamp(gl_Position.z/gl_Position.w,0.5,1.0);float zbias=max(0.00005,(pow(z,0.8)-z)*u_zbias_factor*u_exaggeration);gl_Position.z-=(gl_Position.w*zbias);gl_Position=mix(gl_Position,AWAY,hidden);
#else
gl_Position=mix(u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude,AWAY,hidden);
#endif
#endif
#ifdef ELEVATED_ROADS
#ifdef RENDER_SHADOWS
vec3 shd_pos=vec3(pos+(offset2+dist)*u_pixels_to_tile_units,a_z_offset);vec3 shd_pos0=shd_pos;vec3 shd_pos1=shd_pos;
#ifdef NORMAL_OFFSET
vec3 shd_pos_offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=shd_pos_offset*shadow_normal_offset_multiplier0();shd_pos1+=shd_pos_offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#endif
#ifndef RENDER_TO_TEXTURE
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude_xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=mix(extrude_length_without_perspective/extrude_length_with_perspective,1.0,step(0.01,blur));
#else
v_gamma_scale=1.0;
#endif
#ifdef RENDER_LINE_TRIM_OFFSET
highp float a_uv_x=a_packed[0];highp float line_progress=a_packed[2];v_uv=vec3(a_uv_x,0.0,line_progress);
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=(floorwidth*u_floor_width_scale);
#ifdef LINE_JOIN_NONE
v_width=(floorwidth*u_floor_width_scale)+ANTIALIASING;mediump float pixels_to_tile_units=1.0/u_tile_units_to_pixels;mediump float pixel_ratio_inverse=1.0/pixel_ratio;mediump float aspect=v_width/((pattern.w-pattern.y)*pixel_ratio_inverse);highp float subt_multiple=(pattern.z-pattern.x)*pixel_ratio_inverse*pixels_to_tile_units*aspect*32.0;highp float subt=floor(a_pattern_data.z/subt_multiple)*subt_multiple;float offset_sign=(fract(a_pattern_data.x)-0.5)*4.0;float line_progress_offset=offset_sign*v_width*0.5*pixels_to_tile_units;v_linesofar=(a_pattern_data.z-subt)+a_linesofar+line_progress_offset;v_pattern_data=vec2(a_pattern_data.x+line_progress_offset,a_pattern_data.y);
#endif
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
#ifdef INDICATOR_CUTOUT
v_z_offset=a_z_offset;
#endif
}`),raster:sr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_raster_array.glsl"
uniform float u_fade_t;uniform float u_opacity;uniform highp float u_raster_elevation;uniform highp float u_zoom_transition;in vec2 v_pos0;in vec2 v_pos1;in float v_depth;
#ifdef PROJECTION_GLOBE_VIEW
in float v_split_fade;
#endif
uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;uniform float u_emissive_strength;
#ifndef RASTER_ARRAY
uniform highp sampler2D u_image0;uniform sampler2D u_image1;
#endif
#ifdef RASTER_COLOR
uniform sampler2D u_color_ramp;uniform highp vec4 u_colorization_mix;uniform highp float u_colorization_offset;uniform vec2 u_texture_res;
#endif
void main() {vec4 color0,color1,color;vec2 value;
#ifdef RASTER_COLOR
#ifdef RASTER_ARRAY
#ifdef RASTER_ARRAY_LINEAR
value=mix(
raTexture2D_image0_linear(v_pos0,u_texture_res,u_colorization_mix,u_colorization_offset),raTexture2D_image1_linear(v_pos1,u_texture_res,u_colorization_mix,u_colorization_offset),u_fade_t
);
#else
value=mix(
raTexture2D_image0_nearest(v_pos0,u_texture_res,u_colorization_mix,u_colorization_offset),raTexture2D_image1_nearest(v_pos1,u_texture_res,u_colorization_mix,u_colorization_offset),u_fade_t
);
#endif
if (value.y > 0.0) value.x/=value.y;
#else
color=mix(texture(u_image0,v_pos0),texture(u_image1,v_pos1),u_fade_t);value=vec2(u_colorization_offset+dot(color.rgb,u_colorization_mix.rgb),color.a);
#endif
color=texture(u_color_ramp,vec2(value.x,0.5));if (color.a > 0.0) color.rgb/=color.a;color.a*=value.y;
#else
color0=texture(u_image0,v_pos0);color1=texture(u_image1,v_pos1);if (color0.a > 0.0) color0.rgb/=color0.a;if (color1.a > 0.0) color1.rgb/=color1.a;color=mix(color0,color1,u_fade_t);
#endif
color.a*=u_opacity;
#ifdef GLOBE_POLES
color.a*=1.0-smoothstep(0.0,0.05,u_zoom_transition);
#endif
vec3 rgb=color.rgb;rgb=vec3(
dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);vec3 out_color=mix(u_high_vec,u_low_vec,rgb);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(vec4(out_color,1.0),u_emissive_strength).rgb;
#endif
#ifdef FOG
highp float fog_limit_high_meters=1000000.0;highp float fog_limit_low_meters=600000.0;float fog_limit=1.0-smoothstep(fog_limit_low_meters,fog_limit_high_meters,u_raster_elevation);out_color=fog_dither(fog_apply(out_color,v_fog_pos,fog_limit));
#endif
glFragColor=vec4(out_color*color.a,color.a);
#ifdef PROJECTION_GLOBE_VIEW
glFragColor*=mix(1.0,1.0-smoothstep(0.0,0.05,u_zoom_transition),smoothstep(0.8,0.9,v_split_fade));
#endif
#ifdef RENDER_CUTOFF
glFragColor=glFragColor*cutoff_opacity(u_cutoff_params,v_depth);
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform mat3 u_grid_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform vec2 u_perspective_transform;uniform vec2 u_texture_offset;uniform float u_raster_elevation;uniform float u_zoom_transition;uniform vec2 u_merc_center;
#define GLOBE_UPSCALE GLOBE_RADIUS/6371008.8
#ifdef GLOBE_POLES
in vec3 a_globe_pos;in vec2 a_uv;
#else
in vec2 a_pos;in vec2 a_texture_pos;
#endif
out vec2 v_pos0;out vec2 v_pos1;out float v_depth;
#ifdef PROJECTION_GLOBE_VIEW
out float v_split_fade;
#endif
void main() {vec2 uv;
#ifdef GLOBE_POLES
vec3 globe_pos=a_globe_pos;globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;gl_Position=u_matrix*u_globe_matrix*vec4(globe_pos   ,1.0);uv=a_uv;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(a_globe_pos,1.0)).xyz);
#endif
#else
float w=1.0+dot(a_texture_pos,u_perspective_transform);uv=a_texture_pos/8192.0;
#ifdef PROJECTION_GLOBE_VIEW
vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);vec3 globe_pos=latLngToECEF(latLng.xy);globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);float mercatorY=mercatorYfromLat(latLng[0]);float mercatorX=mercatorXfromLng(latLng[1]);    
v_split_fade=0.0;if (u_zoom_transition > 0.0) {vec2 merc_pos=vec2(mercatorX,mercatorY);merc_world_pos=vec4(merc_pos,u_raster_elevation,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;float opposite_merc_center=mod(u_merc_center.x+0.5,1.0);float dist_from_poles=(abs(mercatorY-0.5)*2.0);float range=0.1;v_split_fade=abs(opposite_merc_center-mercatorX);v_split_fade=clamp(1.0-v_split_fade,0.0,1.0);v_split_fade=max(smoothstep(1.0-range,1.0,dist_from_poles),max(smoothstep(1.0-range,1.0,v_split_fade),smoothstep(1.0-range,1.0,1.0-v_split_fade)));}float tiles=u_grid_matrix[0][2];if (tiles > 0.0) {float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];float uvY=mercatorY*tiles-idy;float uvX=mercatorX*tiles-idx;uv=vec2(uvX,uvY);}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition)*w,w);gl_Position=u_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
#else
gl_Position=u_matrix*vec4(a_pos*w,u_raster_elevation*w,w);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
#endif
#endif
v_pos0=uv;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;v_pos0=u_texture_offset.x+u_texture_offset.y*v_pos0;v_pos1=u_texture_offset.x+u_texture_offset.y*v_pos1;
#ifdef RENDER_CUTOFF
v_depth=gl_Position.z;
#endif
}`),rasterParticle:sr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform float u_fade_t;uniform float u_opacity;uniform highp float u_raster_elevation;in vec2 v_pos0;in vec2 v_pos1;uniform sampler2D u_image0;uniform sampler2D u_image1;void main() {vec4 color0,color1,color;color0=texture(u_image0,v_pos0);color1=texture(u_image1,v_pos1);if (color0.a > 0.0) color0.rgb/=color0.a;if (color1.a > 0.0) color1.rgb/=color1.a;color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 out_color=color.rgb;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(vec4(out_color,1.0),0.0).rgb;
#endif
#ifdef FOG
highp float fog_limit_high_meters=1000000.0;highp float fog_limit_low_meters=600000.0;float fog_limit=1.0-smoothstep(fog_limit_low_meters,fog_limit_high_meters,u_raster_elevation);out_color=fog_dither(fog_apply(out_color,v_fog_pos,fog_limit));
#endif
glFragColor=vec4(out_color*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform mat3 u_grid_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_raster_elevation;uniform float u_zoom_transition;uniform vec2 u_merc_center;
#define GLOBE_UPSCALE GLOBE_RADIUS/6371008.8
in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos0;out vec2 v_pos1;void main() {float w=1.0;vec2 uv;
#ifdef PROJECTION_GLOBE_VIEW
vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float mercatorX=mercatorXfromLng(latLng[1]);float tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];float uvX=mercatorX*tiles-idx;float uvY=mercatorY*tiles-idy;uv=vec2(uvX,uvY);vec3 globe_pos=latLngToECEF(latLng.xy);globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {vec2 merc_pos=vec2(mercatorX,mercatorY);merc_world_pos=vec4(merc_pos,u_raster_elevation,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition)*w,w);gl_Position=u_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
#else
uv=a_texture_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*w,u_raster_elevation*w,w);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
#endif
v_pos0=uv;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}`),rasterParticleDraw:sr("uniform sampler2D u_color_ramp;in float v_particle_speed;void main() {glFragColor=texture(u_color_ramp,vec2(v_particle_speed,0.5));}",`#include "_prelude_raster_particle.glsl"
in float a_index;uniform sampler2D u_particle_texture;uniform float u_particle_texture_side_len;uniform vec2 u_tile_offset;out float v_particle_speed;void main() {ivec2 pixel_coord=ivec2(
mod(a_index,u_particle_texture_side_len),a_index/u_particle_texture_side_len);vec4 pixel=texelFetch(u_particle_texture,pixel_coord,0);vec2 pos=unpack_pos_from_rgba(pixel)+u_tile_offset;vec2 tex_coord=fract(pos);vec2 velocity=lookup_velocity(tex_coord);if (velocity==INVALID_VELOCITY) {gl_Position=AWAY;v_particle_speed=0.0;} else {gl_Position=vec4(2.0*pos-1.0,0,1);v_particle_speed=length(velocity);}gl_PointSize=1.0;}`),rasterParticleTexture:sr("uniform sampler2D u_texture;uniform float u_opacity;in vec2 v_tex_pos;void main() {vec4 color=texture(u_texture,v_tex_pos);glFragColor=vec4(floor(255.0*color*u_opacity)/255.0);}","in vec2 a_pos;out vec2 v_tex_pos;void main() {vec2 uv=0.5*a_pos+vec2(0.5);v_tex_pos=uv;gl_Position=vec4(a_pos,0.0,1.0);}"),rasterParticleUpdate:sr(`#include "_prelude_raster_particle.glsl"
uniform sampler2D u_particle_texture;uniform mediump float u_particle_texture_side_len;uniform mediump float u_speed_factor;uniform highp float u_reset_rate;uniform highp float u_rand_seed;in highp vec2 v_tex_coord;vec2 linearstep(vec2 edge0,vec2 edge1,vec2 x) {return  clamp((x-edge0)/(edge1-edge0),vec2(0),vec2(1));}const highp vec3 rand_constants=vec3(12.9898,78.233,4375.85453);highp float rand(const highp vec2 co) {highp float t=dot(rand_constants.xy,co);return fract(sin(t)*(rand_constants.z+t));}void main() {ivec2 pixel_coord=ivec2(v_tex_coord*u_particle_texture_side_len);highp vec4 pixel=texelFetch(u_particle_texture,pixel_coord,0);highp vec2 pos=unpack_pos_from_rgba(pixel);highp vec2 velocity=lookup_velocity(clamp(pos,0.0,1.0));highp vec2 dp=velocity==INVALID_VELOCITY ? vec2(0) : velocity*u_speed_factor;pos=pos+dp;highp vec2 seed=(pos+v_tex_coord)*u_rand_seed;highp vec2 random_pos=vec2(rand(seed+1.3),rand(seed+2.1));highp vec2 persist_rate=pow(
linearstep(vec2(-u_particle_pos_offset),vec2(0),pos)*linearstep(vec2(1.0+u_particle_pos_offset),vec2(1),pos),vec2(4)
);highp vec2 per_frame_persist=pow(persist_rate,abs(dp)/u_particle_pos_offset);highp float drop_rate=1.0-per_frame_persist.x*per_frame_persist.y;drop_rate=any(greaterThanEqual(abs(pos-0.5),vec2(0.5+u_particle_pos_offset))) ? 1.0 : drop_rate;highp float drop=step(1.0-drop_rate-u_reset_rate,rand(seed));highp vec2 next_pos=mix(pos,random_pos,drop);glFragColor=pack_pos_to_rgba(next_pos);}`,"in vec2 a_pos;out vec2 v_tex_coord;void main() {v_tex_coord=0.5*(a_pos+vec2(1.0));gl_Position=vec4(a_pos,0.0,1.0);}"),symbol:sr(`#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;uniform bool u_is_halo;uniform lowp float u_scale_factor;
#ifdef ICON_TRANSITION
uniform float u_icon_transition;
#endif
#ifdef COLOR_ADJUSTMENT
uniform mat4 u_color_adj_mat;
#endif
#ifdef INDICATOR_CUTOUT
in highp float v_z_offset;
#else
#ifdef Z_OFFSET
#ifdef RENDER_SHADOWS
in highp float v_z_offset;
#endif
#endif
#endif
in vec2 v_tex_a;
#ifdef ICON_TRANSITION
in vec2 v_tex_b;
#endif
in float v_draw_halo;in vec3 v_gamma_scale_size_fade_opacity;
#ifdef RENDER_TEXT_AND_SYMBOL
in float is_sdf;in vec2 v_tex_a_icon;
#endif
#ifdef Z_OFFSET
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
#endif
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
#pragma mapbox: define lowp float emissive_strength
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
#pragma mapbox: initialize lowp float emissive_strength
vec4 out_color;float fade_opacity=v_gamma_scale_size_fade_opacity[2];
#ifdef RENDER_TEXT_AND_SYMBOL
if (is_sdf==ICON) {vec2 tex_icon=v_tex_a_icon;lowp float alpha=opacity*fade_opacity;glFragColor=texture(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
return;}
#endif
#ifdef RENDER_SDF
float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_gamma_scale_size_fade_opacity.x;float size=v_gamma_scale_size_fade_opacity.y;float fontScale=u_is_text ? size/24.0 : size;out_color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;bool draw_halo=v_draw_halo > 0.0;if (draw_halo) {out_color=halo_color;gamma=(halo_blur*u_scale_factor*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width*u_scale_factor/fontScale)/SDF_PX;}lowp float dist=texture(u_texture,v_tex_a).r;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);out_color*=alpha;
#else
#ifdef ICON_TRANSITION
vec4 a=texture(u_texture,v_tex_a)*(1.0-u_icon_transition);vec4 b=texture(u_texture,v_tex_b)*u_icon_transition;out_color=(a+b);
#else
out_color=texture(u_texture,v_tex_a);
#endif
#ifdef COLOR_ADJUSTMENT
out_color=u_color_adj_mat*out_color;
#endif
#endif
out_color*=opacity*fade_opacity;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,emissive_strength);
#ifdef Z_OFFSET
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);out_color.rgb*=mix(v_z_offset !=0.0 ? u_ground_shadow_factor : vec3(1.0),vec3(1.0),light);
#endif
#endif
#endif
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color,v_z_offset);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_terrain.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec4 a_pos_offset;in vec4 a_tex_size;in vec4 a_pixeloffset;in vec4 a_projected_pos;in float a_fade_opacity;
#ifdef Z_OFFSET
in float a_auto_z_offset;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_globe_anchor;in vec3 a_globe_normal;
#endif
#ifdef ICON_TRANSITION
in vec2 a_texb;
#endif
#ifdef OCCLUSION_QUERIES
in float a_occlusion_query_opacity;
#endif
#ifdef ELEVATED_ROADS
in vec3 a_x_axis;in vec3 a_y_axis;uniform float u_normal_scale;
#endif
#ifdef INDICATOR_CUTOUT
out highp float v_z_offset;
#else
#ifdef Z_OFFSET
#ifdef RENDER_SHADOWS
out highp float v_z_offset;
#endif
#endif
#endif
uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_elevation_from_sea;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;uniform vec2 u_texsize_icon;uniform bool u_is_halo;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
out vec2 v_tex_a;
#ifdef ICON_TRANSITION
out vec2 v_tex_b;
#endif
out float v_draw_halo;out vec3 v_gamma_scale_size_fade_opacity;
#ifdef RENDER_TEXT_AND_SYMBOL
out float is_sdf;out vec2 v_tex_a_icon;
#endif
#ifdef Z_OFFSET
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
#endif
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
#pragma mapbox: define lowp float emissive_strength
#pragma mapbox: define lowp float occlusion_opacity
#pragma mapbox: define lowp float z_offset
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
#pragma mapbox: initialize lowp float emissive_strength
#pragma mapbox: initialize lowp float occlusion_opacity
#pragma mapbox: initialize lowp float z_offset
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_min_font_scale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;float e=u_elevation_from_sea ? z_offset : z_offset+elevation(tile_anchor);
#ifdef Z_OFFSET
e+=a_auto_z_offset;
#endif
vec3 h=elevationVector(tile_anchor)*e;float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;vec3 world_pos_globe;
#ifdef PROJECTION_GLOBE_VIEW
mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos_globe=a_globe_anchor+h;world_pos=mix_globe_mercator(world_pos_globe,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
world_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetprojected_point;vec2 a;
#ifdef PROJECTION_GLOBE_VIEW
vec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetprojected_point=u_matrix*vec4(a_globe_anchor+displacement,1);vec4 projected_point_globe=u_matrix*vec4(world_pos_globe,1);a=projected_point_globe.xy/projected_point_globe.w;
#else
offsetprojected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);a=projected_point.xy/projected_point.w;
#endif
vec2 b=offsetprojected_point.xy/offsetprojected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;
#ifdef PROJECTION_GLOBE_VIEW
#ifdef PROJECTED_POS_ON_VIEWPORT
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xyz+h,1.0);
#else
vec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz,mercator_pos,u_zoom_transition)+h;projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);    
#endif
#else
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*max(a_min_font_scale,font_scale)+a_pxoffset/16.0);
#ifdef TERRAIN
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
#endif
#ifdef Z_OFFSET
z+=u_pitch_with_map ? a_auto_z_offset+z_offset : 0.0;
#else
z+=u_pitch_with_map ? z_offset : 0.0;
#endif
float occlusion_fade=globe_occlusion_fade;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float out_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));
#ifdef DEPTH_OCCLUSION
float depth_occlusion=occlusionFadeMultiSample(projected_point);float depth_occlusion_multplier=mix(occlusion_opacity,1.0,depth_occlusion);out_fade_opacity*=depth_occlusion_multplier;
#endif
#ifdef OCCLUSION_QUERIES
float occludedFadeMultiplier=mix(occlusion_opacity,1.0,a_occlusion_query_opacity);out_fade_opacity*=occludedFadeMultiplier;
#endif
float alpha=opacity*out_fade_opacity;float hidden=float(alpha==0.0 || projected_point.w <=0.0 || occlusion_fade==0.0);vec3 pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);pos=projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y;
#else
#ifdef ELEVATED_ROADS
vec3 xAxis=vec3(a_x_axis.xy,a_x_axis.z*u_normal_scale);vec3 yAxis=vec3(a_y_axis.xy,a_y_axis.z*u_normal_scale);pos=projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y;
#else
pos=vec3(projected_pos.xy/projected_pos.w+offset,z);
#endif
#endif
gl_Position=mix(u_coord_matrix*vec4(pos,1.0),AWAY,hidden);float gamma_scale=gl_Position.w;v_draw_halo=(u_is_halo && float(gl_InstanceID)==0.0) ? 1.0 : 0.0;v_gamma_scale_size_fade_opacity=vec3(gamma_scale,size,out_fade_opacity);v_tex_a=a_tex/u_texsize;
#ifdef RENDER_TEXT_AND_SYMBOL
is_sdf=a_size[0]-2.0*a_size_min;v_tex_a_icon=a_tex/u_texsize_icon;
#endif
#ifdef ICON_TRANSITION
v_tex_b=a_texb/u_texsize;
#endif
#ifdef Z_OFFSET
#ifdef RENDER_SHADOWS
vec4 shd_pos=u_inv_matrix*vec4(pos,1.0);vec3 shd_pos0=shd_pos.xyz;vec3 shd_pos1=shd_pos.xyz;
#ifdef NORMAL_OFFSET
vec3 shd_pos_offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=shd_pos_offset*shadow_normal_offset_multiplier0();shd_pos1+=shd_pos_offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#endif
#ifdef INDICATOR_CUTOUT
v_z_offset=e;
#else
#ifdef Z_OFFSET
#ifdef RENDER_SHADOWS
v_z_offset=e;
#endif
#endif
#endif
}`),terrainRaster:sr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image0;in vec2 v_pos0;
#ifdef FOG
in float v_fog_opacity;
#endif
#ifdef RENDER_SHADOWS
in vec4 v_pos_light_view_0;in vec4 v_pos_light_view_1;
#endif
uniform vec3 u_ground_shadow_factor;void main() {vec4 image_color=texture(u_image0,v_pos0);vec4 color;
#ifdef LIGHTING_3D_MODE
const vec3 normal=vec3(0.0,0.0,1.0);
#ifdef RENDER_SHADOWS
float cutoffOpacity=1.0;
#ifdef RENDER_CUTOFF
cutoffOpacity=cutoff_opacity(u_cutoff_params,1.0/gl_FragCoord.w);
#endif
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
vec3 unlit_base=image_color.rgb*(1.0-image_color.a);vec3 emissive_base=image_color.rgb*image_color.a;float ndotl=u_shadow_direction.z;float occlusion=ndotl < 0.0 ? 1.0 : shadow_occlusion(v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w,0.0);ndotl=max(0.0,ndotl);vec3 lit=apply_lighting(unlit_base,normal,mix(1.0,(1.0-(u_shadow_intensity*occlusion))*ndotl,cutoffOpacity));vec3 emissive=compute_emissive_draped(emissive_base,1.0-u_shadow_intensity,occlusion,u_ground_shadow_factor);color.rgb=lit+emissive;color.a=1.0;
#else
float lighting_factor=shadowed_light_factor_normal_unbiased(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);color=apply_lighting(image_color,normal,mix(1.0,lighting_factor,cutoffOpacity));
#endif
#else
float lighting_factor=u_lighting_directional_dir.z;color=apply_lighting(image_color,normal,lighting_factor);
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
color.rgb=mix(color.rgb,image_color.rgb,image_color.a);color.a=1.0;
#endif
#endif
#else
color=image_color;
#endif
#ifdef FOG
#ifdef ZERO_EXAGGERATION
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#else
color=fog_dither(fog_apply_from_vert(color,v_fog_opacity));
#endif
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_matrix;uniform float u_skirt_height;in vec2 a_pos;out vec2 v_pos0;
#ifdef FOG
out float v_fog_opacity;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out vec4 v_pos_light_view_0;out vec4 v_pos_light_view_1;out float v_depth;
#endif
void main() {vec3 decomposedPosAndSkirt=decomposeToPosAndSkirt(a_pos);float skirt=decomposedPosAndSkirt.z;vec2 decodedPos=decomposedPosAndSkirt.xy;float elevation=elevation(decodedPos)-skirt*u_skirt_height;v_pos0=decodedPos/8192.0;gl_Position=u_matrix*vec4(decodedPos,elevation,1.0);
#ifdef FOG
#ifdef ZERO_EXAGGERATION
v_fog_pos=fog_position(decodedPos);
#else
v_fog_opacity=fog(fog_position(vec3(decodedPos,elevation)));
#endif
#endif
#ifdef RENDER_SHADOWS
vec3 pos=vec3(decodedPos,elevation);v_pos_light_view_0=u_light_matrix_0*vec4(pos,1.);v_pos_light_view_1=u_light_matrix_1*vec4(pos,1.);
#endif
}`),terrainDepth:sr("precision highp float;in float v_depth;void main() {glFragColor=pack_depth(v_depth);}",`#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_matrix;in vec2 a_pos;out float v_depth;void main() {float elevation=elevation(a_pos);gl_Position=u_matrix*vec4(a_pos,elevation,1.0);v_depth=gl_Position.z/gl_Position.w;}`),skybox:sr(`#include "_prelude_fog.fragment.glsl"
in lowp vec3 v_uv;uniform lowp samplerCube u_cubemap;uniform lowp float u_opacity;uniform highp float u_temporal_offset;uniform highp vec3 u_sun_direction;float sun_disk(highp vec3 ray_direction,highp vec3 sun_direction) {highp float cos_angle=dot(normalize(ray_direction),sun_direction);const highp float cos_sun_angular_diameter=0.99996192306;const highp float smoothstep_delta=1e-5;return smoothstep(
cos_sun_angular_diameter-smoothstep_delta,cos_sun_angular_diameter+smoothstep_delta,cos_angle);}float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec3 uv=v_uv;const float y_bias=0.015;uv.y+=y_bias;uv.y=pow(abs(uv.y),1.0/5.0);uv.y=map(uv.y,0.0,1.0,-1.0,1.0);vec3 sky_color=texture(u_cubemap,uv).rgb;
#ifdef FOG
sky_color=fog_apply_sky_gradient(v_uv.xzy,sky_color);
#endif
sky_color+=0.1*sun_disk(v_uv,u_sun_direction);glFragColor=vec4(sky_color*u_opacity,u_opacity);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,Uu),skyboxGradient:sr(`#include "_prelude_fog.fragment.glsl"
in highp vec3 v_uv;uniform lowp sampler2D u_color_ramp;uniform highp vec3 u_center_direction;uniform lowp float u_radius;uniform lowp float u_opacity;uniform highp float u_temporal_offset;void main() {float progress=acos(dot(normalize(v_uv),u_center_direction))/u_radius;vec4 color=texture(u_color_ramp,vec2(progress,0.5));
#ifdef FOG
color.rgb=fog_apply_sky_gradient(v_uv.xzy,color.rgb/color.a)*color.a;
#endif
color*=u_opacity;glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,Uu),skyboxCapture:sr(`
in highp vec3 v_position;uniform highp float u_sun_intensity;uniform highp float u_luminance;uniform lowp vec3 u_sun_direction;uniform highp vec4 u_color_tint_r;uniform highp vec4 u_color_tint_m;precision highp float;
#define BETA_R                  vec3(5.5e-6,13.0e-6,22.4e-6)
#define BETA_M                  vec3(21e-6,21e-6,21e-6)
#define MIE_G                   0.76
#define DENSITY_HEIGHT_SCALE_R  8000.0
#define DENSITY_HEIGHT_SCALE_M  1200.0
#define PLANET_RADIUS           6360e3
#define ATMOSPHERE_RADIUS       6420e3
#define SAMPLE_STEPS            10
#define DENSITY_STEPS           4
float ray_sphere_exit(vec3 orig,vec3 dir,float radius) {float a=dot(dir,dir);float b=2.0*dot(dir,orig);float c=dot(orig,orig)-radius*radius;float d=sqrt(b*b-4.0*a*c);return (-b+d)/(2.0*a);}vec3 extinction(vec2 density) {return exp(-vec3(BETA_R*u_color_tint_r.a*density.x+BETA_M*u_color_tint_m.a*density.y));}vec2 local_density(vec3 point) {float height=max(length(point)-PLANET_RADIUS,0.0);float exp_r=exp(-height/DENSITY_HEIGHT_SCALE_R);float exp_m=exp(-height/DENSITY_HEIGHT_SCALE_M);return vec2(exp_r,exp_m);}float phase_ray(float cos_angle) {return (3.0/(16.0*PI))*(1.0+cos_angle*cos_angle);}float phase_mie(float cos_angle) {return (3.0/(8.0*PI))*((1.0-MIE_G*MIE_G)*(1.0+cos_angle*cos_angle))/((2.0+MIE_G*MIE_G)*pow(1.0+MIE_G*MIE_G-2.0*MIE_G*cos_angle,1.5));}vec2 density_to_atmosphere(vec3 point,vec3 light_dir) {float ray_len=ray_sphere_exit(point,light_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(DENSITY_STEPS);vec2 density_point_to_atmosphere=vec2(0.0);for (int i=0; i < DENSITY_STEPS;++i) {vec3 point_on_ray=point+light_dir*((float(i)+0.5)*step_len);density_point_to_atmosphere+=local_density(point_on_ray)*step_len;;}return density_point_to_atmosphere;}vec3 atmosphere(vec3 ray_dir,vec3 sun_direction,float sun_intensity) {vec2 density_orig_to_point=vec2(0.0);vec3 scatter_r=vec3(0.0);vec3 scatter_m=vec3(0.0);vec3 origin=vec3(0.0,PLANET_RADIUS,0.0);float ray_len=ray_sphere_exit(origin,ray_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(SAMPLE_STEPS);for (int i=0; i < SAMPLE_STEPS;++i) {vec3 point_on_ray=origin+ray_dir*((float(i)+0.5)*step_len);vec2 density=local_density(point_on_ray)*step_len;density_orig_to_point+=density;vec2 density_point_to_atmosphere=density_to_atmosphere(point_on_ray,sun_direction);vec2 density_orig_to_atmosphere=density_orig_to_point+density_point_to_atmosphere;vec3 extinction=extinction(density_orig_to_atmosphere);scatter_r+=density.x*extinction;scatter_m+=density.y*extinction;}float cos_angle=dot(ray_dir,sun_direction);float phase_r=phase_ray(cos_angle);float phase_m=phase_mie(cos_angle);vec3 beta_r=BETA_R*u_color_tint_r.rgb*u_color_tint_r.a;vec3 beta_m=BETA_M*u_color_tint_m.rgb*u_color_tint_m.a;return (scatter_r*phase_r*beta_r+scatter_m*phase_m*beta_m)*sun_intensity;}const float A=0.15;const float B=0.50;const float C=0.10;const float D=0.20;const float E=0.02;const float F=0.30;vec3 uncharted2_tonemap(vec3 x) {return ((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F;}void main() {vec3 ray_direction=v_position;ray_direction.y=pow(ray_direction.y,5.0);const float y_bias=0.015;ray_direction.y+=y_bias;vec3 color=atmosphere(normalize(ray_direction),u_sun_direction,u_sun_intensity);float white_scale=1.0748724675633854;color=uncharted2_tonemap((log2(2.0/pow(u_luminance,4.0)))*color)*white_scale;glFragColor=vec4(color,1.0);}`,"in highp vec3 a_pos_3f;uniform mat3 u_matrix_3f;out highp vec3 v_position;float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec4 pos=vec4(u_matrix_3f*a_pos_3f,1.0);v_position=pos.xyz;v_position.y*=-1.0;v_position.y=map(v_position.y,-1.0,1.0,0.0,1.0);gl_Position=vec4(a_pos_3f.xy,0.0,1.0);}"),globeRaster:sr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image0;uniform float u_far_z_cutoff;in vec2 v_pos0;
#ifndef FOG
uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform vec2 u_viewport;
#endif
void main() {vec4 color;
#ifdef CUSTOM_ANTIALIASING
highp vec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);highp vec3 dir=normalize(ray_dir);highp vec3 closest_point=dot(u_globe_pos,dir)*dir;highp float norm_dist_from_center=1.0-length(closest_point-u_globe_pos)/u_globe_radius;const float antialias_pixel=2.0;highp float antialias_factor=antialias_pixel*fwidth(norm_dist_from_center);highp float antialias=smoothstep(0.0,antialias_factor,norm_dist_from_center);vec4 raster=texture(u_image0,v_pos0);
#ifdef LIGHTING_3D_MODE
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
raster=apply_lighting_with_emission_ground(raster,raster.a);color=vec4(clamp(raster.rgb,vec3(0),vec3(1))*antialias,antialias);
#else
raster=apply_lighting_ground(raster);color=vec4(raster.rgb*antialias,raster.a*antialias);
#endif
#else
color=vec4(raster.rgb*antialias,raster.a*antialias);
#endif
#else
color=texture(u_image0,v_pos0);
#ifdef LIGHTING_3D_MODE
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
color=apply_lighting_with_emission_ground(color,color.a);color.a=1.0;
#else
color=apply_lighting_ground(color);
#endif
#endif
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
color*=1.0-step(u_far_z_cutoff,1.0/gl_FragCoord.w);glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_proj_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform float u_zoom_transition;uniform vec2 u_merc_center;uniform mat3 u_grid_matrix;uniform float u_skirt_height;
#ifdef GLOBE_POLES
in vec3 a_globe_pos;in vec2 a_uv;
#else
in vec2 a_pos;
#endif
out vec2 v_pos0;void main() {
#ifdef GLOBE_POLES
vec3 globe_pos=a_globe_pos;vec2 uv=a_uv;
#else
float tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float uvY=mercatorY*tiles-idy;float mercatorX=mercatorXfromLng(latLng[1]);float uvX=mercatorX*tiles-idx;vec3 globe_pos=latLngToECEF(latLng.xy);vec2 merc_pos=vec2(mercatorX,mercatorY);vec2 uv=vec2(uvX,uvY);
#endif
v_pos0=uv;vec2 tile_pos=uv*EXTENT;vec3 globe_derived_up_vector=normalize(globe_pos)*u_tile_up_scale;
#ifdef GLOBE_POLES
vec3 up_vector=globe_derived_up_vector;
#else
vec3 up_vector=elevationVector(tile_pos);
#endif
float height=elevation(tile_pos);globe_pos+=up_vector*height;
#ifndef GLOBE_POLES
globe_pos-=globe_derived_up_vector*u_skirt_height*decomposed_pos_and_skirt.z;
#endif
#ifdef GLOBE_POLES
vec4 interpolated_pos=u_globe_matrix*vec4(globe_pos,1.0);
#else
vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {merc_world_pos=vec4(merc_pos,height-u_skirt_height*decomposed_pos_and_skirt.z,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition),1.0);
#endif
gl_Position=u_proj_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
}`),globeAtmosphere:sr(`#include "_prelude_fog.fragment.glsl"
uniform float u_transition;uniform highp float u_fadeout_range;uniform highp float u_temporal_offset;uniform vec4 u_color;uniform vec4 u_high_color;uniform vec4 u_space_color;uniform float u_horizon_angle;in highp vec3 v_ray_dir;in highp vec3 v_horizon_dir;void main() {highp vec3 dir=normalize(v_ray_dir);float globe_pos_dot_dir;
#ifdef PROJECTION_GLOBE_VIEW
globe_pos_dot_dir=dot(u_globe_pos,dir);highp vec3 closest_point_forward=abs(globe_pos_dot_dir)*dir;float norm_dist_from_center=length(closest_point_forward-u_globe_pos)/u_globe_radius;if (norm_dist_from_center < 0.98) {
#ifdef ALPHA_PASS
glFragColor=vec4(0,0,0,0);return;
#else
#ifdef NATIVE
glFragColor=vec4(1,1,1,1);
#else
glFragColor=vec4(0,0,0,1);
#endif
return;
#endif
}
#endif
highp vec3 horizon_dir=normalize(v_horizon_dir);float horizon_angle_mercator=dir.y < horizon_dir.y ?
0.0 : max(acos(clamp(dot(dir,horizon_dir),-1.0,1.0)),0.0);float horizon_angle;
#ifdef PROJECTION_GLOBE_VIEW
highp vec3 closest_point=globe_pos_dot_dir*dir;highp float closest_point_to_center=length(closest_point-u_globe_pos);highp float theta=asin(clamp(closest_point_to_center/length(u_globe_pos),-1.0,1.0));horizon_angle=globe_pos_dot_dir < 0.0 ?
PI-theta-u_horizon_angle : theta-u_horizon_angle;float angle_t=pow(u_transition,10.0);horizon_angle=mix(horizon_angle,horizon_angle_mercator,angle_t);
#else
horizon_angle=horizon_angle_mercator;
#endif
horizon_angle/=PI;float t=exp(-horizon_angle/u_fadeout_range);float alpha_0=u_color.a;float alpha_1=u_high_color.a;float alpha_2=u_space_color.a;vec3 color_stop_0=u_color.rgb;vec3 color_stop_1=u_high_color.rgb;vec3 color_stop_2=u_space_color.rgb;
#ifdef ALPHA_PASS
float a0=mix(alpha_2,1.0,alpha_1);float a1=mix(a0,1.0,alpha_0);float a2=mix(a0,a1,t);float a =mix(alpha_2,a2,t);glFragColor=vec4(1.0,1.0,1.0,a);
#else
vec3 c0=mix(color_stop_2,color_stop_1,alpha_1);vec3 c1=mix(c0,color_stop_0,alpha_0);vec3 c2=mix(c0,c1,t);vec3 c=c2;glFragColor=vec4(c*t,t);
#endif
}`,`in vec3 a_pos;in vec2 a_uv;uniform vec3 u_frustum_tl;uniform vec3 u_frustum_tr;uniform vec3 u_frustum_br;uniform vec3 u_frustum_bl;uniform float u_horizon;out highp vec3 v_ray_dir;out highp vec3 v_horizon_dir;void main() {v_ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,a_uv.x),mix(u_frustum_bl,u_frustum_br,a_uv.x),a_uv.y);v_horizon_dir=mix(
mix(u_frustum_tl,u_frustum_bl,u_horizon),mix(u_frustum_tr,u_frustum_br,u_horizon),a_uv.x);gl_Position=vec4(a_pos,1.0);}`),model:sr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform float u_opacity;uniform vec3 u_lightcolor;uniform vec3 u_lightpos;uniform float u_lightintensity;uniform vec4 u_baseColorFactor;uniform vec4 u_emissiveFactor;uniform float u_metallicFactor;uniform float u_roughnessFactor;uniform float u_emissive_strength;in highp vec4 v_position_height;in lowp vec4 v_color_mix;
#ifdef RENDER_SHADOWS
in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in float v_depth_shadows;
#endif
#ifdef OCCLUSION_TEXTURE_TRANSFORM
uniform vec4 u_occlusionTextureTransform;
#endif
#pragma mapbox: define-attribute highp vec3 normal_3f
#pragma mapbox: define-attribute highp vec3 color_3f
#pragma mapbox: define-attribute highp vec4 color_4f
#pragma mapbox: define-attribute highp vec2 uv_2f
#pragma mapbox: initialize-attribute highp vec3 normal_3f
#pragma mapbox: initialize-attribute highp vec3 color_3f
#pragma mapbox: initialize-attribute highp vec4 color_4f
#pragma mapbox: initialize-attribute highp vec2 uv_2f
#ifdef HAS_ATTRIBUTE_a_pbr
in lowp vec4 v_roughness_metallic_emissive_alpha;in mediump vec4 v_height_based_emission_params;
#endif
#ifdef HAS_TEXTURE_u_baseColorTexture
uniform sampler2D u_baseColorTexture;uniform bool u_baseTextureIsAlpha;uniform bool u_alphaMask;uniform float u_alphaCutoff;
#endif
#ifdef HAS_TEXTURE_u_metallicRoughnessTexture
uniform sampler2D u_metallicRoughnessTexture;
#endif
#ifdef HAS_TEXTURE_u_occlusionTexture
uniform sampler2D u_occlusionTexture;uniform float u_aoIntensity;
#endif
#ifdef HAS_TEXTURE_u_normalTexture
uniform sampler2D u_normalTexture;
#endif
#ifdef HAS_TEXTURE_u_emissionTexture
uniform sampler2D u_emissionTexture;
#endif
#ifdef APPLY_LUT_ON_GPU
uniform highp sampler3D u_lutTexture;
#endif
#ifdef TERRAIN_FRAGMENT_OCCLUSION
in highp float v_depth;uniform highp sampler2D u_depthTexture;uniform highp vec2 u_inv_depth_size;uniform highp vec2 u_depth_range_unpack;
#ifdef DEPTH_D24
highp float unpack_depth(highp float depth) {return  depth*u_depth_range_unpack.x+u_depth_range_unpack.y;}
#else
highp float unpack_depth_rgba(highp vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}
#endif
bool isOccluded() {highp vec2 coord=gl_FragCoord.xy*u_inv_depth_size;
#ifdef DEPTH_D24
highp float depth=unpack_depth(texture(u_depthTexture,coord).r);
#else
highp float depth=unpack_depth_rgba(texture(u_depthTexture,coord));
#endif
return v_depth > depth+0.0005;}
#endif
#define saturate(_x) clamp(_x,0.,1.)
vec3 linearTosRGB(vec3 color) {return pow(color,vec3(1./2.2));}vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}float calculate_NdotL(vec3 normal,vec3 lightDir) {const float ext=0.70710678118;return (clamp(dot(normal,lightDir),-ext,1.0)+ext)/(1.0+ext);}vec3 getDiffuseShadedColor(vec3 albedo,vec3 normal,vec3 lightDir,vec3 lightColor)
{
#ifdef LIGHTING_3D_MODE
vec3 transformed_normal=vec3(-normal.xy,normal.z);float lighting_factor;
#ifdef RENDER_SHADOWS
lighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);
#else
lighting_factor=saturate(dot(transformed_normal,u_lighting_directional_dir));
#endif
return apply_lighting(albedo,transformed_normal,lighting_factor);
#else
vec3 n=normal;float colorvalue=((albedo.x*0.2126)+(albedo.y*0.7152))+(albedo.z*0.0722);vec3 c=vec3(0.03,0.03,0.03);float directional=clamp(dot(n,vec3(lightDir)),0.0,1.0);directional=mix(1.0-u_lightintensity,max((1.0-colorvalue)+u_lightintensity,1.0),directional);vec3 c3=c+clamp((albedo*directional)*lightColor,mix(vec3(0.0),vec3(0.3),vec3(1.0)-lightColor),vec3(1.0));return c3;
#endif
}vec4 getBaseColor() {vec4 albedo=u_baseColorFactor;
#ifdef HAS_ATTRIBUTE_a_color_3f
albedo*=vec4(color_3f,1.0);
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
#else
#ifdef HAS_ATTRIBUTE_a_color_4f
albedo*=color_4f;
#endif
#endif
#if defined (HAS_TEXTURE_u_baseColorTexture) && defined (HAS_ATTRIBUTE_a_uv_2f)
vec4 texColor=texture(u_baseColorTexture,uv_2f);if(u_alphaMask) {if (texColor.w < u_alphaCutoff) {discard;}}
#ifdef UNPREMULT_TEXTURE_IN_SHADER
if(texColor.w > 0.0) {texColor.rgb/=texColor.w;}texColor.w=1.0;
#endif
if(u_baseTextureIsAlpha) {if (texColor.r < 0.5) {discard;}} else {texColor.rgb=sRGBToLinear(texColor.rgb);albedo*=texColor;}
#endif
vec4 color=vec4(mix(albedo.rgb,v_color_mix.rgb,v_color_mix.a),albedo.a);
#ifdef APPLY_LUT_ON_GPU
color=applyLUT(u_lutTexture,color);
#endif
return color;}highp mat3 cotangentFrame(highp vec3 N,highp vec3 p,highp vec2 uv ) {
#ifdef HAS_TEXTURE_u_normalTexture
highp vec3 dp1=vec3(dFdx(p.x),dFdx(p.y),dFdx(p.z));highp vec3 dp2=vec3(dFdy(p.x),dFdy(p.y),dFdy(p.z));highp vec2 duv1=vec2(dFdx(uv.x),dFdx(uv.y));highp vec2 duv2=vec2(dFdy(uv.x),dFdy(uv.y));highp vec3 dp2perp=cross( dp2,N );highp vec3 dp1perp=cross( N,dp1 );highp vec3 T=dp2perp*duv1.x+dp1perp*duv2.x;highp vec3 B=dp2perp*duv1.y+dp1perp*duv2.y;highp float lengthT=dot(T,T);highp float lengthB=dot(B,B);highp float maxLength=max(lengthT,lengthB);highp float invmax=inversesqrt( maxLength );highp mat3 res=mat3( T*invmax,B*invmax,N );return res;
#else
return mat3(1.0);
#endif
}highp vec3 getNormal(){highp vec3 n;
#ifdef HAS_ATTRIBUTE_a_normal_3f
n=normalize(normal_3f);
#else
highp vec3 fdx=vec3(dFdx(v_position_height.x),dFdx(v_position_height.y),dFdx(v_position_height.z));highp vec3 fdy=vec3(dFdy(v_position_height.x),dFdy(v_position_height.y),dFdy(v_position_height.z));n=normalize(cross(fdx,fdy))*-1.0;
#endif
#if defined(HAS_TEXTURE_u_normalTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
vec3 nMap=texture( u_normalTexture,uv_2f).xyz;nMap=normalize(2.0*nMap-vec3(1.0));highp vec3 v=normalize(-v_position_height.xyz);highp mat3 TBN=cotangentFrame(n,v,uv_2f);n=normalize(TBN*nMap);
#endif
return n;}struct Material {float perceptualRoughness;float alphaRoughness;float metallic;vec3 f90;vec4 baseColor;vec3 diffuseColor;vec3 specularColor;highp vec3 normal;};Material getPBRMaterial() {Material mat;mat.baseColor=getBaseColor();mat.perceptualRoughness=u_roughnessFactor;mat.metallic=u_metallicFactor;
#ifdef HAS_ATTRIBUTE_a_pbr
mat.perceptualRoughness=v_roughness_metallic_emissive_alpha.x;mat.metallic=v_roughness_metallic_emissive_alpha.y;mat.baseColor.w*=v_roughness_metallic_emissive_alpha.w;
#endif
#if defined(HAS_TEXTURE_u_metallicRoughnessTexture) && defined(HAS_ATTRIBUTE_a_uv_2f) 
vec4 mrSample=texture(u_metallicRoughnessTexture,uv_2f);mat.perceptualRoughness*=mrSample.g;mat.metallic*=mrSample.b;
#endif
const float c_minRoughness=0.04;mat.perceptualRoughness=clamp(mat.perceptualRoughness,c_minRoughness,1.0);mat.metallic=saturate(mat.metallic);mat.alphaRoughness=mat.perceptualRoughness*mat.perceptualRoughness;const vec3 f0=vec3(0.04);mat.diffuseColor=mat.baseColor.rgb*(vec3(1.0)-f0);mat.diffuseColor*=1.0-mat.metallic;mat.specularColor=mix(f0,mat.baseColor.rgb,mat.metallic);highp float reflectance=max(max(mat.specularColor.r,mat.specularColor.g),mat.specularColor.b);highp float reflectance90=saturate(reflectance*25.0);mat.f90=vec3(reflectance90);mat.normal=getNormal();return mat;}float V_GGX(float NdotL,float NdotV,float roughness)
{float a2=roughness*roughness;float GGXV=NdotL*sqrt(NdotV*NdotV*(1.0-a2)+a2);float GGXL=NdotV*sqrt(NdotL*NdotL*(1.0-a2)+a2);return 0.5/(GGXV+GGXL);}float V_GGXFast(float NdotL,float NdotV,float roughness) {float a=roughness;float GGXV=NdotL*(NdotV*(1.0-a)+a);float GGXL=NdotV*(NdotL*(1.0-a)+a);return 0.5/(GGXV+GGXL);}vec3 F_Schlick(vec3 specularColor,vec3 f90,float VdotH)
{return specularColor+(f90-specularColor)*pow(clamp(1.0-VdotH,0.0,1.0),5.0);}vec3 F_SchlickFast(vec3 specularColor,float VdotH)
{float x=1.0-VdotH;float x4=x*x*x*x;return specularColor+(1.0-specularColor)*x4*x;}float D_GGX(highp float NdotH,float alphaRoughness)
{highp float a4=alphaRoughness*alphaRoughness;highp float f=(NdotH*a4-NdotH)*NdotH+1.0;return a4/(PI*f*f);}vec3 diffuseBurley(Material mat,float LdotH,float NdotL,float NdotV)
{float f90=2.0*LdotH*LdotH*mat.alphaRoughness-0.5;return (mat.diffuseColor/PI)*(1.0+f90*pow((1.0-NdotL),5.0))*(1.0+f90*pow((1.0-NdotV),5.0));}vec3 diffuseLambertian(Material mat)
{
#ifdef LIGHTING_3D_MODE
return mat.diffuseColor;
#else
return mat.diffuseColor/PI;
#endif
}vec3 EnvBRDFApprox(vec3 specularColor,float roughness,highp float NdotV)
{vec4 c0=vec4(-1,-0.0275,-0.572,0.022);vec4 c1=vec4(1,0.0425,1.04,-0.04);highp vec4 r=roughness*c0+c1;highp float a004=min(r.x*r.x,exp2(-9.28*NdotV))*r.x+r.y;vec2 AB=vec2(-1.04,1.04)*a004+r.zw;return specularColor*AB.x+AB.y;}vec3 computeIndirectLightContribution(Material mat,float NdotV,vec3 normal)
{vec3 env_light=vec3(0.65,0.65,0.65);
#ifdef LIGHTING_3D_MODE
float ambient_factor=calculate_ambient_directional_factor(normal);env_light=u_lighting_ambient_color*ambient_factor;
#endif
vec3 envBRDF=EnvBRDFApprox(mat.specularColor,mat.perceptualRoughness,NdotV);vec3 indirectSpecular= envBRDF*env_light;vec3 indirectDiffuse=mat.diffuseColor*env_light;return indirectSpecular+indirectDiffuse;}vec3 computeLightContribution(Material mat,vec3 lightPosition,vec3 lightColor)
{highp vec3 n=mat.normal;highp vec3 v=normalize(-v_position_height.xyz);highp vec3 l=normalize(lightPosition);highp vec3 h=normalize(v+l);float NdotV=clamp(abs(dot(n,v)),0.001,1.0);float NdotL=saturate(dot(n,l));highp float NdotH=saturate(dot(n,h));float VdotH=saturate(dot(v,h));vec3 f=F_SchlickFast(mat.specularColor,VdotH);float g=V_GGXFast(NdotL,NdotV,mat.alphaRoughness);float d=D_GGX(NdotH,mat.alphaRoughness);vec3 diffuseTerm=(1.0-f)*diffuseLambertian(mat);vec3 specularTerm=f*g*d;vec3 transformed_normal=vec3(-n.xy,n.z);float lighting_factor;
#ifdef RENDER_SHADOWS
lighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);
#else
lighting_factor=NdotL;
#endif
vec3 directLightColor=(specularTerm+diffuseTerm)*lighting_factor*lightColor;vec3 indirectLightColor=computeIndirectLightContribution(mat,NdotV,transformed_normal);vec3 color=(saturate(directLightColor)+indirectLightColor);float intensityFactor=1.0;
#if !defined(LIGHTING_3D_MODE)
const vec3 luminosityFactor=vec3(0.2126,0.7152,0.0722);float luminance=dot(diffuseTerm,luminosityFactor);intensityFactor=mix((1.0-u_lightintensity),max((1.0-luminance+u_lightintensity),1.0),NdotL);
#endif
color*=intensityFactor;return color;}void main() {
#ifdef TERRAIN_FRAGMENT_OCCLUSION
if (isOccluded()) {discard;}
#endif
vec3 lightDir=u_lightpos;vec3 lightColor=u_lightcolor;
#ifdef LIGHTING_3D_MODE
lightDir=u_lighting_directional_dir;lightDir.xy=-lightDir.xy;lightColor=u_lighting_directional_color;
#endif
vec4 finalColor;
#ifdef DIFFUSE_SHADED
vec3 N=getNormal();vec3 baseColor=getBaseColor().rgb;vec3 diffuse=getDiffuseShadedColor(baseColor,N,lightDir,lightColor);
#ifdef HAS_TEXTURE_u_occlusionTexture
float ao=(texture(u_occlusionTexture,uv_2f).r-1.0)*u_aoIntensity+1.0;diffuse*=ao;
#endif
finalColor=vec4(mix(diffuse,baseColor,u_emissive_strength),1.0)*u_opacity;
#else
Material mat=getPBRMaterial();vec3 color=computeLightContribution(mat,lightDir,lightColor);float ao=1.0;
#if defined (HAS_TEXTURE_u_occlusionTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
#ifdef OCCLUSION_TEXTURE_TRANSFORM
vec2 uv=uv_2f.xy*u_occlusionTextureTransform.zw+u_occlusionTextureTransform.xy;
#else
vec2 uv=uv_2f;
#endif
ao=(texture(u_occlusionTexture,uv).x-1.0)*u_aoIntensity+1.0;color*=ao;
#endif
vec4 emissive=u_emissiveFactor;
#if defined(HAS_TEXTURE_u_emissionTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
emissive.rgb*=sRGBToLinear(texture(u_emissionTexture,uv_2f).rgb);
#endif
#ifdef APPLY_LUT_ON_GPU
float emissiveFactorLength=max(length(u_emissiveFactor.rgb),0.001);emissive.rgb=sRGBToLinear(applyLUT(u_lutTexture,linearTosRGB(emissive.rgb/emissiveFactorLength).rbg))*emissiveFactorLength;
#endif
color+=emissive.rgb;float opacity=mat.baseColor.w*u_opacity;
#ifdef HAS_ATTRIBUTE_a_pbr
float resEmission=v_roughness_metallic_emissive_alpha.z;resEmission*=v_height_based_emission_params.z+v_height_based_emission_params.w*pow(clamp(v_height_based_emission_params.x,0.0,1.0),v_height_based_emission_params.y);vec3 color_mix=v_color_mix.rgb;
#ifdef APPLY_LUT_ON_GPU
color_mix=applyLUT(u_lutTexture,color_mix);
#endif
color=mix(color,color_mix,min(1.0,resEmission));
#ifdef HAS_ATTRIBUTE_a_color_4f
float distance=length(vec2(1.3*max(0.0,abs(color_4f.x)-color_4f.z),color_4f.y));distance+= mix(0.5,0.0,clamp(resEmission-1.0,0.0,1.0));opacity*=v_roughness_metallic_emissive_alpha.w*saturate(1.0-distance*distance);
#endif
#endif
vec3 unlitColor=mat.baseColor.rgb*ao+emissive.rgb;color=mix(color,unlitColor,u_emissive_strength);color=linearTosRGB(color);color*=opacity;finalColor=vec4(color,opacity);
#endif
#ifdef FOG
finalColor=fog_dither(fog_apply_premultiplied(finalColor,v_fog_pos,v_position_height.w));
#endif
#ifdef RENDER_CUTOFF
finalColor*=v_cutoff_opacity;
#endif
#ifdef INDICATOR_CUTOUT
finalColor=applyCutout(finalColor,v_position_height.w);
#endif
glFragColor=finalColor;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec3 a_pos_3f;
#pragma mapbox: define-attribute highp vec3 normal_3f
#pragma mapbox: define-attribute highp vec2 uv_2f
#pragma mapbox: define-attribute highp vec3 color_3f
#pragma mapbox: define-attribute highp vec4 color_4f
#pragma mapbox: define-attribute-vertex-shader-only highp vec4 pbr
#pragma mapbox: define-attribute-vertex-shader-only highp vec3 heightBasedEmissiveStrength
uniform mat4 u_matrix;uniform mat4 u_node_matrix;uniform mat4 u_lighting_matrix;uniform vec3 u_camera_pos;uniform vec4 u_color_mix;
#ifdef INSTANCED_ARRAYS
in vec4 a_normal_matrix0;in vec4 a_normal_matrix1;in vec4 a_normal_matrix2;in vec4 a_normal_matrix3;
#else
uniform highp mat4 u_normal_matrix;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out float v_depth_shadows;
#endif
out vec4 v_position_height;out lowp vec4 v_color_mix;
#ifdef TERRAIN_FRAGMENT_OCCLUSION
out highp float v_depth;
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
out lowp vec4 v_roughness_metallic_emissive_alpha;out mediump vec4 v_height_based_emission_params;
#endif
vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}void main() {
#pragma mapbox: initialize-attribute highp vec3 normal_3f
#pragma mapbox: initialize-attribute highp vec2 uv_2f
#pragma mapbox: initialize-attribute highp vec3 color_3f
#pragma mapbox: initialize-attribute highp vec4 color_4f
#pragma mapbox: initialize-attribute-custom highp vec4 pbr
#pragma mapbox: initialize-attribute-custom highp vec3 heightBasedEmissiveStrength
highp mat4 normal_matrix;
#ifdef INSTANCED_ARRAYS
normal_matrix=mat4(a_normal_matrix0,a_normal_matrix1,a_normal_matrix2,a_normal_matrix3);
#else
normal_matrix=u_normal_matrix;
#endif
vec3 local_pos;mat3 rs;
#ifdef MODEL_POSITION_ON_GPU
vec3 pos_color=normal_matrix[0].xyz;vec4 translate=normal_matrix[1];vec3 pos_a=floor(pos_color);vec3 rgb=1.05*(pos_color-pos_a);float hidden=float(pos_a.x > EXTENT);float color_mix=pos_a.z/100.0;v_color_mix=vec4(sRGBToLinear(rgb),color_mix);float meter_to_tile=normal_matrix[0].w;vec4 pos=vec4(pos_a.xy,translate.z,1.0);rs[0].x=normal_matrix[1].w;rs[0].yz=normal_matrix[2].xy;rs[1].xy=normal_matrix[2].zw;rs[1].z=normal_matrix[3].x;rs[2].xyz=normal_matrix[3].yzw;vec4 pos_node=u_lighting_matrix*vec4(a_pos_3f,1.0);vec3 rotated_pos_node=rs*pos_node.xyz;vec3 pos_model_tile=(rotated_pos_node+vec3(translate.xy,0.0))*vec3(meter_to_tile,meter_to_tile,1.0);pos.xyz+=pos_model_tile;local_pos=pos.xyz;gl_Position=mix(u_matrix*pos,AWAY,hidden);pos.z*=meter_to_tile;v_position_height.xyz=pos.xyz-u_camera_pos;
#else
local_pos=a_pos_3f;gl_Position=u_matrix*vec4(a_pos_3f,1);v_position_height.xyz=vec3(u_lighting_matrix*vec4(a_pos_3f,1));v_color_mix=vec4(sRGBToLinear(u_color_mix.rgb),u_color_mix.a);
#endif
v_position_height.w=a_pos_3f.z;
#ifdef HAS_ATTRIBUTE_a_pbr
vec4 albedo_c=decode_color(pbr.xy);vec2 e_r_m=unpack_float(pbr.z);vec2 r_m= unpack_float(e_r_m.y*16.0);r_m.r=r_m.r*16.0;v_color_mix=vec4(albedo_c.rgb,1.0);v_roughness_metallic_emissive_alpha=vec4(vec3(r_m,e_r_m.x)/255.0,albedo_c.a);v_roughness_metallic_emissive_alpha.z*=2.0;float heightBasedRelativeIntepolation=a_pos_3f.z*heightBasedEmissiveStrength.x+heightBasedEmissiveStrength.y;v_height_based_emission_params.x=heightBasedRelativeIntepolation;v_height_based_emission_params.y=heightBasedEmissiveStrength.z;vec2 emissionMultiplierValues=unpack_float(pbr.w)/256.0;v_height_based_emission_params.z=emissionMultiplierValues.x;v_height_based_emission_params.w=emissionMultiplierValues.y-emissionMultiplierValues.x;
#endif
#ifdef FOG
v_fog_pos=fog_position(local_pos);
#endif
#ifdef RENDER_CUTOFF
v_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);
#endif
#ifdef TERRAIN_FRAGMENT_OCCLUSION
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef HAS_ATTRIBUTE_a_normal_3f
#ifdef MODEL_POSITION_ON_GPU
float x_squared_scale=dot(rs[0],rs[0]);float y_squared_scale=dot(rs[1],rs[1]);float z_squared_scale=dot(rs[2],rs[2]);vec3 squared_scale=vec3(x_squared_scale,y_squared_scale,z_squared_scale);normal_3f=rs*((u_lighting_matrix*vec4(normal_3f,0.0)).xyz/squared_scale);normal_3f=normalize(normal_3f);
#else
normal_3f=vec3(normal_matrix*vec4(normal_3f,0));
#endif
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
#ifdef HAS_ATTRIBUTE_a_color_4f
v_roughness_metallic_emissive_alpha.w=clamp(color_4f.a*v_roughness_metallic_emissive_alpha.w*(v_roughness_metallic_emissive_alpha.z-1.0),0.0,1.0);
#endif
#endif
#ifdef RENDER_SHADOWS
vec4 shadow_pos=u_node_matrix*vec4(local_pos,1.0);
#ifdef NORMAL_OFFSET
#ifdef HAS_ATTRIBUTE_a_normal_3f
#ifdef MODEL_POSITION_ON_GPU
vec3 offset=shadow_normal_offset(vec3(-normal_3f.xy,normal_3f.z));shadow_pos.xyz+=offset*shadow_normal_offset_multiplier0();
#else
vec3 offset=shadow_normal_offset_model(normal_3f);shadow_pos.xyz+=offset*shadow_normal_offset_multiplier0();
#endif
#endif
#endif
v_pos_light_view_0=u_light_matrix_0*shadow_pos;v_pos_light_view_1=u_light_matrix_1*shadow_pos;v_depth_shadows=gl_Position.w;
#endif
}`),modelDepth:sr(`in highp float v_depth;void main() {
#ifndef DEPTH_TEXTURE
glFragColor=pack_depth(v_depth);
#endif
}`,`in vec3 a_pos_3f;uniform mat4 u_matrix;out highp float v_depth;
#ifdef MODEL_POSITION_ON_GPU
#ifdef INSTANCED_ARRAYS
in vec4 a_normal_matrix0;in vec4 a_normal_matrix1;in vec4 a_normal_matrix2;in vec4 a_normal_matrix3;
#else
uniform highp mat4 u_instance;
#endif
uniform highp mat4 u_node_matrix;
#endif
void main() {
#ifdef MODEL_POSITION_ON_GPU
highp mat4 instance;
#ifdef INSTANCED_ARRAYS
instance=mat4(a_normal_matrix0,a_normal_matrix1,a_normal_matrix2,a_normal_matrix3);
#else
instance=u_instance;
#endif
vec3 pos_color=instance[0].xyz;vec4 translate=instance[1];vec3 pos_a=floor(pos_color);float hidden=float(pos_a.x > EXTENT);float meter_to_tile=instance[0].w;vec4 pos=vec4(pos_a.xy,translate.z,1.0);mat3 rs;rs[0].x=instance[1].w;rs[0].yz=instance[2].xy;rs[1].xy=instance[2].zw;rs[1].z=instance[3].x;rs[2].xyz=instance[3].yzw;vec4 pos_node=u_node_matrix*vec4(a_pos_3f,1.0);vec3 rotated_pos_node=rs*pos_node.xyz;vec3 pos_model_tile=(rotated_pos_node+vec3(translate.xy,0.0))*vec3(meter_to_tile,meter_to_tile,1.0);pos.xyz+=pos_model_tile;gl_Position=mix(u_matrix*pos,AWAY,hidden);
#else
gl_Position=u_matrix*vec4(a_pos_3f,1);
#endif
v_depth=gl_Position.z/gl_Position.w;}`),stars:sr(`in highp vec2 v_uv;in mediump float v_intensity;float shapeCircle(in vec2 uv)
{float beginFade=0.6;float lengthFromCenter=length(v_uv);return 1.0-clamp((lengthFromCenter-beginFade)/(1.0-beginFade),0.0,1.0);}void main() {float alpha=shapeCircle(v_uv);vec3 color=vec3(1.0,1.0,1.0);alpha*=v_intensity;glFragColor=vec4(color*alpha,alpha);HANDLE_WIREFRAME_DEBUG;}`,`
in vec3 a_pos_3f;in vec2 a_uv;in float a_size_scale;in float a_fade_opacity;uniform mat4 u_matrix;uniform vec3 u_up;uniform vec3 u_right;uniform float u_intensity_multiplier;out highp vec2 v_uv;out mediump float v_intensity;void main() {v_uv=a_uv;v_intensity=a_fade_opacity*u_intensity_multiplier;vec3 pos=a_pos_3f;pos+=a_uv.x*u_right*a_size_scale;pos+=a_uv.y*u_up*a_size_scale;gl_Position=u_matrix*vec4(pos,1.0);}`),snowParticle:sr("in highp vec2 uv;in highp float alphaMultiplier;uniform vec4 u_particleColor;uniform vec2 u_simpleShapeParameters;void main() {float t=clamp((length(uv)-u_simpleShapeParameters.x)/(1.0-u_simpleShapeParameters.x),0.0,1.0);float alpha=1.0-pow(t,pow(10.0,u_simpleShapeParameters.y));alpha*=alphaMultiplier;alpha*=u_particleColor.a;vec3 color=u_particleColor.rgb*alpha;glFragColor=vec4(color,alpha) ;HANDLE_WIREFRAME_DEBUG;}",`
in highp vec3 a_pos_3f;in highp vec2 a_uv;in highp vec4 a_snowParticleData;in highp vec4 a_snowParticleDataHorizontalOscillation;uniform mat4 u_modelview;uniform mat4 u_projection;uniform vec3 u_cam_pos;uniform vec2 u_screenSize;uniform float u_time;uniform float u_boxSize;uniform float u_velocityConeAperture; 
uniform float u_velocity;uniform vec3 u_direction;uniform float u_horizontalOscillationRadius; 
uniform float u_horizontalOscillationRate; 
uniform float u_billboardSize;uniform vec2 u_thinningCenterPos;uniform vec3 u_thinningShape;uniform float u_thinningAffectedRatio;uniform float u_thinningParticleOffset;out highp vec2 uv;out highp float alphaMultiplier;void main() {vec3 pos=a_pos_3f;float halfBoxSize=0.5*u_boxSize;pos.xyz*=halfBoxSize;pos+=u_cam_pos;float velocityConeApertureRad=radians(u_velocityConeAperture*0.5);float coneAnglePichRad=velocityConeApertureRad*a_snowParticleData.z;float coneAngleHeadingRad=a_snowParticleData.w*radians(360.0);vec3 localZ=normalize(u_direction);vec3 localX=normalize(cross(localZ,vec3(1,0,0)));vec3 localY=normalize(cross(localZ,localX));vec3 direction;direction.x=cos(coneAngleHeadingRad)*sin(coneAnglePichRad);direction.y=sin(coneAngleHeadingRad)*sin(coneAnglePichRad);direction.z=cos(coneAnglePichRad);direction=normalize(direction);vec3 simPosLocal=vec3(0,0,0);float velocityScale=(1.0+3.0*a_snowParticleData.y)*u_velocity;simPosLocal+=direction*velocityScale*u_time;float horizontalOscillationRadius=u_horizontalOscillationRadius*a_snowParticleDataHorizontalOscillation.x;float horizontalOscillationAngle=u_horizontalOscillationRate*u_time*(-1.0+2.0*a_snowParticleDataHorizontalOscillation.y);simPosLocal.xy+=horizontalOscillationRadius*vec2(cos(horizontalOscillationAngle),sin(horizontalOscillationAngle));vec3 simPos=localX*simPosLocal.x+
localY*simPosLocal.y+localZ*simPosLocal.z;pos+=simPos;pos=fract((pos+vec3(halfBoxSize))/vec3(u_boxSize))*u_boxSize-vec3(halfBoxSize);float clipZ=-u_cam_pos.z+pos.z;vec4 posView=u_modelview*vec4(pos,1.0);float size=u_billboardSize;alphaMultiplier=1.0;vec4 posScreen=u_projection*posView;posScreen/=posScreen.w;posScreen.xy=vec2(0.5)+posScreen.xy*0.5;posScreen.xy*=u_screenSize;vec2 thinningCenterPos=u_thinningCenterPos.xy;thinningCenterPos.y=u_screenSize.y-thinningCenterPos.y;float screenDist=length((thinningCenterPos-posScreen.xy)/(0.5*u_screenSize));screenDist+=a_snowParticleData.x*u_thinningParticleOffset;float scaleFactorMode=0.0;float thinningShapeDist=u_thinningShape.x+u_thinningShape.y;if (screenDist < thinningShapeDist) {float thinningFadeRatio=clamp((screenDist-u_thinningShape.x)/u_thinningShape.y,0.0,1.0);thinningFadeRatio=pow(thinningFadeRatio,u_thinningShape.z);if (a_snowParticleData.x < u_thinningAffectedRatio) {scaleFactorMode=1.0-thinningFadeRatio;alphaMultiplier=thinningFadeRatio;}}vec4 posScreen1=u_projection*vec4(posView.x-size,posView.yzw);posScreen1/=posScreen1.w;vec4 posScreen2=u_projection*vec4(posView.x+size,posView.yzw);posScreen2/=posScreen2.w;posScreen1.xy=vec2(0.5)+posScreen1.xy*0.5;posScreen1.xy*=u_screenSize;posScreen2.xy=vec2(0.5)+posScreen2.xy*0.5;posScreen2.xy*=u_screenSize;float screenLength=length(posScreen1.xy-posScreen2.xy);float screenEpsilon=3.0;float scaleFactor=1.0;if (screenLength < screenEpsilon) {scaleFactor=screenEpsilon/max(screenLength,0.01);scaleFactor=mix(scaleFactor,1.0,scaleFactorMode);}float screenEpsilon2=15.0;if (screenLength > screenEpsilon2) {scaleFactor=screenEpsilon2/max(screenLength,0.01);}size*=scaleFactor;vec2 right=size*vec2(1,0);vec2 up=size*vec2(0,1);posView.xy+=right*a_uv.x;posView.xy+=up*a_uv.y;uv=a_uv;gl_Position=u_projection*posView;}`),rainParticle:sr("in highp vec2 uv;in highp float particleRandomValue;uniform sampler2D u_texScreen;uniform float u_distortionStrength;uniform vec4 u_color;uniform vec2 u_thinningCenterPos;uniform vec3 u_thinningShape;uniform float u_thinningAffectedRatio;uniform float u_thinningParticleOffset;uniform float u_shapeDirectionalPower;uniform float u_mode;void main() {vec2 st=uv*0.5+vec2(0.5);vec2 uvm=uv;uvm.y=-1.0+2.0*pow(st.y,u_shapeDirectionalPower);float shape=clamp(1.0-length(uvm),0.0,1.0);float alpha=abs(shape)*u_color.a;vec2 screenSize=vec2(textureSize(u_texScreen,0));vec2 thinningCenterPos=u_thinningCenterPos.xy;thinningCenterPos.y=screenSize.y-thinningCenterPos.y;float screenDist=length((thinningCenterPos-gl_FragCoord.xy)/(0.5*screenSize));screenDist+=(0.5+0.5*particleRandomValue)*u_thinningParticleOffset;float thinningShapeDist=u_thinningShape.x+u_thinningShape.y;float thinningAlpha=1.0;if (screenDist < thinningShapeDist) {float thinningFadeRatio=clamp((screenDist-u_thinningShape.x)/u_thinningShape.y,0.0,1.0);thinningFadeRatio=pow(thinningFadeRatio,u_thinningShape.z);thinningAlpha*=thinningFadeRatio;}vec2 offsetXY=normalize(uvm)*abs(shape);vec2 stScreen=(gl_FragCoord.xy+offsetXY*u_distortionStrength*thinningAlpha)/screenSize;vec3 colorScreen=texture(u_texScreen,stScreen).rgb;alpha*=thinningAlpha;glFragColor=mix(vec4(colorScreen,1.0),vec4(u_color.rgb*alpha,alpha),u_mode);HANDLE_WIREFRAME_DEBUG;}",`
in highp vec3 a_pos_3f;in highp vec2 a_uv;in highp vec4 a_rainParticleData;uniform mat4 u_modelview;uniform mat4 u_projection;uniform vec3 u_cam_pos;uniform float u_time;uniform float u_boxSize;uniform float u_velocityConeAperture; 
uniform float u_velocity; 
uniform vec2 u_rainDropletSize;uniform vec3 u_rainDirection;out highp vec2 uv;out highp float particleRandomValue;void main() {vec3 pos=a_pos_3f;float halfBoxSize=0.5*u_boxSize;pos*=halfBoxSize; 
pos+=u_cam_pos;float velocityConeApertureRad=radians(u_velocityConeAperture*0.5);float coneAnglePichRad=velocityConeApertureRad*a_rainParticleData.z;float coneAngleHeadingRad=a_rainParticleData.w*radians(360.0);vec3 localZ=normalize(u_rainDirection);vec3 localX=normalize(cross(localZ,vec3(1,0,0)));vec3 localY=normalize(cross(localZ,localX));vec3 directionLocal;directionLocal.x=cos(coneAngleHeadingRad)*sin(coneAnglePichRad);directionLocal.y=sin(coneAngleHeadingRad)*sin(coneAnglePichRad);directionLocal.z=cos(coneAnglePichRad);directionLocal=normalize(directionLocal);vec3 directionWorld=localX*directionLocal.x+localY*directionLocal.y+localZ*directionLocal.z;float velocityScale=(1.0+3.0*a_rainParticleData.y)*u_velocity;vec3 simPosLocal=vec3(0,0,0);simPosLocal+=directionLocal*velocityScale*u_time;vec3 simPos=localX*simPosLocal.x+
localY*simPosLocal.y+localZ*simPosLocal.z;pos+=simPos;pos=fract((pos+vec3(halfBoxSize))/vec3(u_boxSize))*u_boxSize-vec3(halfBoxSize);vec4 posView=u_modelview*vec4(pos,1.0);vec3 directionView=normalize((u_modelview*vec4(directionWorld,0.0)).xyz);vec3 side=cross(directionView,normalize(posView.xyz));posView.xyz+=side*a_uv.x*u_rainDropletSize.x;posView.xyz+=directionView*a_uv.y*u_rainDropletSize.y;uv=a_uv;particleRandomValue=a_rainParticleData.x;gl_Position=u_projection*posView;}`),vignette:sr("uniform vec3 u_vignetteShape;uniform vec4 u_vignetteColor;in vec2 st;void main() {float screenDist=length(st);float alpha=clamp((screenDist-u_vignetteShape.x)/u_vignetteShape.y,0.0,1.0);alpha=pow(alpha,u_vignetteShape.z)*u_vignetteColor.a;vec3 color=u_vignetteColor.rgb;glFragColor=vec4(color*alpha,alpha) ;}","in vec2 a_pos_2f;out vec2 st;void main() {st=a_pos_2f;gl_Position=vec4(a_pos_2f,0,1);}"),occlusion:sr("uniform vec4 u_color;void main() {glFragColor=u_color;}",`#include "_prelude_terrain.vertex.glsl"
in highp vec2 a_offset_xy;uniform highp vec3 u_anchorPos;uniform mat4 u_matrix;uniform vec2 u_screenSizePx;uniform vec2 u_occluderSizePx;void main() {vec3 world_pos=u_anchorPos;
#ifdef TERRAIN
float e=elevation(world_pos.xy);world_pos.z+=e;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1.0);projected_point.xy+=projected_point.w*a_offset_xy*0.5*u_occluderSizePx/u_screenSizePx;gl_Position=projected_point;}`)};function ea(h,n){const a=h.replace(/\s*\/\/[^\n]*\n/g,`
`).split(`
`);for(let f of a)if(f=f.trim(),f[0]==="#"&&f.includes("if")&&!f.includes("endif")){f=f.replace("#","").replace(/ifdef|ifndef|elif|if/g,"").replace(/!|defined|\(|\)|\|\||&&/g,"").replace(/\s+/g," ").trim();const g=f.split(" ");for(const y of g)n.includes(y)||n.push(y)}}function sr(h,n){const a=/#include\s+"([^"]+)"/g,f=/#pragma mapbox: ([\w\-]+) ([\w]+) ([\w]+) ([\w]+)/g;let g=n.match(/(attribute(\S*)|(^\s*|;)in) (highp |mediump |lowp )?([\w]+) ([\w]+)/gm);g&&(g=g.map(R=>{const D=R.split(" ");return D[D.length-1]}),g=[...new Set(g)]);const y={},b=[],E=[];if(h=h.replace(a,(R,D)=>(E.push(D),"")),(n=n.replace(a,(R,D)=>(b.push(D),""))).includes("flat out"))return void console.error('The usage of "flat" qualifier is disallowed, see: https://bugs.webkit.org/show_bug.cgi?id=268071');let A=[...Gu];ea(h,A),ea(n,A);for(const R of[...b,...E])Hu[R]||console.error(`Undefined include: ${R}`),qh[R]||(qh[R]=[],ea(Hu[R],qh[R])),A=[...A,...qh[R]];return{fragmentSource:h=h.replace(f,(R,D,F,N,j)=>(y[j]=!0,D==="define"?`
#ifndef HAS_UNIFORM_u_${j}
in ${F} ${N} ${j};
#else
uniform ${F} ${N} u_${j};
#endif
`:D==="initialize"?`
#ifdef HAS_UNIFORM_u_${j}
    ${F} ${N} ${j} = u_${j};
#endif
`:D==="define-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${j}
    in ${F} ${N} ${j};
#endif
`:D==="initialize-attribute"?"":void 0)),vertexSource:n=n.replace(f,(R,D,F,N,j)=>{const X=N==="float"?"vec2":N,W=j.match(/color/)?"color":X;return D==="define-attribute-vertex-shader-only"?`
#ifdef HAS_ATTRIBUTE_a_${j}
in ${F} ${N} a_${j};
#endif
`:y[j]?D==="define"?`
#ifndef HAS_UNIFORM_u_${j}
uniform lowp float u_${j}_t;
in ${F} ${X} a_${j};
out ${F} ${N} ${j};
#else
uniform ${F} ${N} u_${j};
#endif
`:D==="initialize"?W==="vec4"?`
#ifndef HAS_UNIFORM_u_${j}
    ${j} = a_${j};
#else
    ${F} ${N} ${j} = u_${j};
#endif
`:`
#ifndef HAS_UNIFORM_u_${j}
    ${j} = unpack_mix_${W}(a_${j}, u_${j}_t);
#else
    ${F} ${N} ${j} = u_${j};
#endif
`:D==="define-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${j}
    in ${F} ${N} a_${j};
    out ${F} ${N} ${j};
#endif
`:D==="initialize-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${j}
    ${j} = a_${j};
#endif
`:void 0:D==="define"?`
#ifndef HAS_UNIFORM_u_${j}
uniform lowp float u_${j}_t;
in ${F} ${X} a_${j};
#else
uniform ${F} ${N} u_${j};
#endif
`:D==="define-instanced"?W==="mat4"?`
#ifdef INSTANCED_ARRAYS
in vec4 a_${j}0;
in vec4 a_${j}1;
in vec4 a_${j}2;
in vec4 a_${j}3;
#else
uniform ${F} ${N} u_${j};
#endif
`:`
#ifdef INSTANCED_ARRAYS
in ${F} ${X} a_${j};
#else
uniform ${F} ${N} u_${j};
#endif
`:D==="initialize-attribute-custom"?`
#ifdef HAS_ATTRIBUTE_a_${j}
    ${F} ${N} ${j} = a_${j};
#endif
`:W==="vec4"?`
#ifndef HAS_UNIFORM_u_${j}
    ${F} ${N} ${j} = a_${j};
#else
    ${F} ${N} ${j} = u_${j};
#endif
`:`
#ifndef HAS_UNIFORM_u_${j}
    ${F} ${N} ${j} = unpack_mix_${W}(a_${j}, u_${j}_t);
#else
    ${F} ${N} ${j} = u_${j};
#endif
`}),staticAttributes:g,usedDefines:A,vertexIncludes:b,fragmentIncludes:E}}class qu{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffers=[],this.vao=null}bind(n,a,f,g,y,b,E,A){this.context=n;let R=this.boundPaintVertexBuffers.length!==g.length;for(let F=0;!R&&F<g.length;F++)this.boundPaintVertexBuffers[F]!==g[F]&&(R=!0);let D=this.boundDynamicVertexBuffers.length!==E.length;for(let F=0;!D&&F<E.length;F++)this.boundDynamicVertexBuffers[F]!==E[F]&&(D=!0);if(!this.vao||this.boundProgram!==a||this.boundLayoutVertexBuffer!==f||R||D||this.boundIndexBuffer!==y||this.boundVertexOffset!==b)this.freshBind(a,f,g,y,b,E,A);else{n.bindVertexArrayOES.set(this.vao);for(const F of E)F&&(F.bind(),A&&F.instanceCount&&F.setVertexAttribDivisor(n.gl,a,A));y&&y.dynamicDraw&&y.bind()}}freshBind(n,a,f,g,y,b,E){const A=n.numAttributes,R=this.context,D=R.gl;this.vao&&this.destroy(),this.vao=R.gl.createVertexArray(),R.bindVertexArrayOES.set(this.vao),this.boundProgram=n,this.boundLayoutVertexBuffer=a,this.boundPaintVertexBuffers=f,this.boundIndexBuffer=g,this.boundVertexOffset=y,this.boundDynamicVertexBuffers=b,a.enableAttributes(D,n),a.bind(),a.setVertexAttribPointers(D,n,y);for(const F of f)F.enableAttributes(D,n),F.bind(),F.setVertexAttribPointers(D,n,y);for(const F of b)F&&(F.enableAttributes(D,n),F.bind(),F.setVertexAttribPointers(D,n,y),E&&F.instanceCount&&F.setVertexAttribDivisor(D,n,E));g&&g.bind(),R.currentNumAttributes=A}destroy(){this.vao&&(this.context.gl.deleteVertexArray(this.vao),this.vao=null)}}function j2(h,n){const a=Math.pow(2,n.canonical.z),f=n.canonical.y;return[new s.ac(0,f/a).toLngLat().lat,new s.ac(0,(f+1)/a).toLngLat().lat]}function B2(h,n,a,f,g,y,b){const E=h.context,A=E.gl,R=a.hillshadeFBO;if(!R)return;h.prepareDrawTile();const D=h.isTileAffectedByFog(n),F=h.getOrCreateProgram("hillshade",{overrideFog:D});E.activeTexture.set(A.TEXTURE0),A.bindTexture(A.TEXTURE_2D,R.colorAttachment.get());const N=((K,ee,ie,fe)=>{const _e=ie.paint.get("hillshade-shadow-color"),we=ie.paint.get("hillshade-shadow-color-use-theme").constantOr("default")==="none",be=ie.paint.get("hillshade-highlight-color"),ve=ie.paint.get("hillshade-highlight-color-use-theme").constantOr("default")==="none",ye=ie.paint.get("hillshade-accent-color"),Se=ie.paint.get("hillshade-accent-color-use-theme").constantOr("default")==="none",Ee=ie.paint.get("hillshade-emissive-strength");let Fe=s.al(ie.paint.get("hillshade-illumination-direction"));if(ie.paint.get("hillshade-illumination-anchor")==="viewport")Fe-=K.transform.angle;else if(K.style&&K.style.enable3dLights()&&K.style.directionalLight){const rt=K.style.directionalLight.properties.get("direction"),it=s.cR(rt.x,rt.y,rt.z);Fe=s.al(it[1])}const je=!K.options.moving;return{u_matrix:fe||K.transform.calculateProjMatrix(ee.tileID.toUnwrapped(),je),u_image:0,u_latrange:j2(0,ee.tileID),u_light:[ie.paint.get("hillshade-exaggeration"),Fe],u_shadow:_e.toPremultipliedRenderColor(we?null:ie.lut),u_highlight:be.toPremultipliedRenderColor(ve?null:ie.lut),u_emissive_strength:Ee,u_accent:ye.toPremultipliedRenderColor(Se?null:ie.lut)}})(h,a,f,h.terrain?n.projMatrix:null);h.uploadCommonUniforms(E,F,n.toUnwrapped());const{tileBoundsBuffer:j,tileBoundsIndexBuffer:X,tileBoundsSegments:W}=h.getTileBoundsBuffers(a);F.draw(h,A.TRIANGLES,g,y,b,_n.disabled,N,f.id,j,X,W)}function Vp(h,n,a){if(!n.needsDEMTextureUpload)return;const f=h.context,g=f.gl;f.pixelStoreUnpackPremultiplyAlpha.set(!1),n.demTexture=n.demTexture||h.getTileTexture(a.stride);const y=a.getPixels();n.demTexture?n.demTexture.update(y,{premultiply:!1}):n.demTexture=new s.T(f,y,g.R32F,{premultiply:!1}),n.needsDEMTextureUpload=!1}function V2(h,n,a){const f=h.context,g=f.gl;if(!n.dem)return;const y=n.dem;if(f.activeTexture.set(g.TEXTURE1),Vp(h,n,y),!n.demTexture)return;n.demTexture.bind(g.NEAREST,g.CLAMP_TO_EDGE);const b=y.dim;f.activeTexture.set(g.TEXTURE0);let E=n.hillshadeFBO;if(!E){const N=new s.T(f,{width:b,height:b,data:null},g.RGBA8);N.bind(g.LINEAR,g.CLAMP_TO_EDGE),E=n.hillshadeFBO=f.createFramebuffer(b,b,!0,"renderbuffer"),E.colorAttachment.set(N.texture)}f.bindFramebuffer.set(E.framebuffer),f.viewport.set([0,0,b,b]);const{tileBoundsBuffer:A,tileBoundsIndexBuffer:R,tileBoundsSegments:D}=h.getMercatorTileBoundsBuffers(),F=[];h.linearFloatFilteringSupported()&&F.push("TERRAIN_DEM_FLOAT_FORMAT"),h.getOrCreateProgram("hillshadePrepare",{defines:F}).draw(h,g.TRIANGLES,Gt.disabled,En.disabled,Zn.unblended,_n.disabled,((N,j)=>{const X=j.stride,W=s.bz();return s.c5(W,0,s.aj,-8192,0,0,1),s.bo(W,W,[0,-8192,0]),{u_matrix:W,u_image:1,u_dimension:[X,X],u_zoom:N.overscaledZ}})(n.tileID,y),a.id,A,R,D),n.needsHillshadePrepare=!1}class yi{constructor(n){this.gl=n.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(n){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class Qx extends yi{getDefault(){return s.am.transparent.toNonPremultipliedRenderColor(null)}set(n){const a=this.current;(n.r!==a.r||n.g!==a.g||n.b!==a.b||n.a!==a.a||this.dirty)&&(this.gl.clearColor(n.r,n.g,n.b,n.a),this.current=n,this.dirty=!1)}}class M_ extends yi{getDefault(){return 1}set(n){(n!==this.current||this.dirty)&&(this.gl.clearDepth(n),this.current=n,this.dirty=!1)}}class U2 extends yi{getDefault(){return 0}set(n){(n!==this.current||this.dirty)&&(this.gl.clearStencil(n),this.current=n,this.dirty=!1)}}class $2 extends yi{getDefault(){return[!0,!0,!0,!0]}set(n){const a=this.current;(n[0]!==a[0]||n[1]!==a[1]||n[2]!==a[2]||n[3]!==a[3]||this.dirty)&&(this.gl.colorMask(n[0],n[1],n[2],n[3]),this.current=n,this.dirty=!1)}}class G2 extends yi{getDefault(){return!0}set(n){(n!==this.current||this.dirty)&&(this.gl.depthMask(n),this.current=n,this.dirty=!1)}}class H2 extends yi{getDefault(){return 255}set(n){(n!==this.current||this.dirty)&&(this.gl.stencilMask(n),this.current=n,this.dirty=!1)}}class Jx extends yi{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(n){const a=this.current;(n.func!==a.func||n.ref!==a.ref||n.mask!==a.mask||this.dirty)&&(this.gl.stencilFunc(n.func,n.ref,n.mask),this.current=n,this.dirty=!1)}}class q2 extends yi{getDefault(){const n=this.gl;return[n.KEEP,n.KEEP,n.KEEP]}set(n){const a=this.current;(n[0]!==a[0]||n[1]!==a[1]||n[2]!==a[2]||this.dirty)&&(this.gl.stencilOp(n[0],n[1],n[2]),this.current=n,this.dirty=!1)}}class Up extends yi{getDefault(){return!1}set(n){if(n===this.current&&!this.dirty)return;const a=this.gl;n?a.enable(a.STENCIL_TEST):a.disable(a.STENCIL_TEST),this.current=n,this.dirty=!1}}class W2 extends yi{getDefault(){return[0,1]}set(n){const a=this.current;(n[0]!==a[0]||n[1]!==a[1]||this.dirty)&&(this.gl.depthRange(n[0],n[1]),this.current=n,this.dirty=!1)}}class e0 extends yi{getDefault(){return!1}set(n){if(n===this.current&&!this.dirty)return;const a=this.gl;n?a.enable(a.DEPTH_TEST):a.disable(a.DEPTH_TEST),this.current=n,this.dirty=!1}}class R_ extends yi{getDefault(){return this.gl.LESS}set(n){(n!==this.current||this.dirty)&&(this.gl.depthFunc(n),this.current=n,this.dirty=!1)}}class $p extends yi{getDefault(){return!1}set(n){if(n===this.current&&!this.dirty)return;const a=this.gl;n?a.enable(a.BLEND):a.disable(a.BLEND),this.current=n,this.dirty=!1}}class k_ extends yi{getDefault(){const n=this.gl;return[n.ONE,n.ZERO,n.ONE,n.ZERO]}set(n){const a=this.current;(n[0]!==a[0]||n[1]!==a[1]||n[2]!==a[2]||n[3]!==a[3]||this.dirty)&&(this.gl.blendFuncSeparate(n[0],n[1],n[2],n[3]),this.current=n,this.dirty=!1)}}class Yc extends yi{getDefault(){return s.am.transparent.toNonPremultipliedRenderColor(null)}set(n){const a=this.current;(n.r!==a.r||n.g!==a.g||n.b!==a.b||n.a!==a.a||this.dirty)&&(this.gl.blendColor(n.r,n.g,n.b,n.a),this.current=n,this.dirty=!1)}}class Wu extends yi{getDefault(){return this.gl.FUNC_ADD}set(n){(n!==this.current||this.dirty)&&(this.gl.blendEquationSeparate(n,n),this.current=n,this.dirty=!1)}}class Gp extends yi{getDefault(){return!1}set(n){if(n===this.current&&!this.dirty)return;const a=this.gl;n?a.enable(a.CULL_FACE):a.disable(a.CULL_FACE),this.current=n,this.dirty=!1}}class Hp extends yi{getDefault(){return this.gl.BACK}set(n){(n!==this.current||this.dirty)&&(this.gl.cullFace(n),this.current=n,this.dirty=!1)}}class Zu extends yi{getDefault(){return this.gl.CCW}set(n){(n!==this.current||this.dirty)&&(this.gl.frontFace(n),this.current=n,this.dirty=!1)}}let t0=class extends yi{getDefault(){return null}set(h){(h!==this.current||this.dirty)&&(this.gl.useProgram(h),this.current=h,this.dirty=!1)}};class D_ extends yi{getDefault(){return this.gl.TEXTURE0}set(n){(n!==this.current||this.dirty)&&(this.gl.activeTexture(n),this.current=n,this.dirty=!1)}}class n0 extends yi{getDefault(){const n=this.gl;return[0,0,n.drawingBufferWidth,n.drawingBufferHeight]}set(n){const a=this.current;(n[0]!==a[0]||n[1]!==a[1]||n[2]!==a[2]||n[3]!==a[3]||this.dirty)&&(this.gl.viewport(n[0],n[1],n[2],n[3]),this.current=n,this.dirty=!1)}}class Xu extends yi{getDefault(){return null}set(n){if(n===this.current&&!this.dirty)return;const a=this.gl;a.bindFramebuffer(a.FRAMEBUFFER,n),this.current=n,this.dirty=!1}}class qp extends yi{getDefault(){return null}set(n){if(n===this.current&&!this.dirty)return;const a=this.gl;a.bindRenderbuffer(a.RENDERBUFFER,n),this.current=n,this.dirty=!1}}class Wp extends yi{getDefault(){return null}set(n){if(n===this.current&&!this.dirty)return;const a=this.gl;a.bindTexture(a.TEXTURE_2D,n),this.current=n,this.dirty=!1}}class L_ extends yi{getDefault(){return null}set(n){if(n===this.current&&!this.dirty)return;const a=this.gl;a.bindBuffer(a.ARRAY_BUFFER,n),this.current=n,this.dirty=!1}}class Zp extends yi{getDefault(){return null}set(n){const a=this.gl;a.bindBuffer(a.ELEMENT_ARRAY_BUFFER,n),this.current=n,this.dirty=!1}}class Zh extends yi{getDefault(){return null}set(n){this.gl&&(n!==this.current||this.dirty)&&(this.gl.bindVertexArray(n),this.current=n,this.dirty=!1)}}class r0 extends yi{getDefault(){return 4}set(n){if(n===this.current&&!this.dirty)return;const a=this.gl;a.pixelStorei(a.UNPACK_ALIGNMENT,n),this.current=n,this.dirty=!1}}class i0 extends yi{getDefault(){return!1}set(n){if(n===this.current&&!this.dirty)return;const a=this.gl;a.pixelStorei(a.UNPACK_PREMULTIPLY_ALPHA_WEBGL,n),this.current=n,this.dirty=!1}}class s0 extends yi{getDefault(){return!1}set(n){if(n===this.current&&!this.dirty)return;const a=this.gl;a.pixelStorei(a.UNPACK_FLIP_Y_WEBGL,n),this.current=n,this.dirty=!1}}class Jl extends yi{constructor(n,a){super(n),this.context=n,this.parent=a}getDefault(){return null}}class o0 extends Jl{setDirty(){this.dirty=!0}set(n){if(n===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const a=this.gl;a.framebufferTexture2D(a.FRAMEBUFFER,a.COLOR_ATTACHMENT0,a.TEXTURE_2D,n,0),this.current=n,this.dirty=!1}}class a0 extends Jl{attachment(){return this.gl.DEPTH_ATTACHMENT}set(n){if(n===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const a=this.gl;a.framebufferRenderbuffer(a.FRAMEBUFFER,this.attachment(),a.RENDERBUFFER,n),this.current=n,this.dirty=!1}}class Z2 extends Jl{attachment(){return this.gl.DEPTH_ATTACHMENT}set(n){if(n===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const a=this.gl;a.framebufferTexture2D(a.FRAMEBUFFER,this.attachment(),a.TEXTURE_2D,n,0),this.current=n,this.dirty=!1}}class X2 extends a0{attachment(){return this.gl.DEPTH_STENCIL_ATTACHMENT}}const N_=(h,n,a)=>({u_matrix:h,u_image0:0,u_skirt_height:n,u_ground_shadow_factor:a}),Xp=(h,n,a,f,g,y,b,E,A,R,D,F,N,j,X,W)=>({u_proj_matrix:Float32Array.from(h),u_globe_matrix:n,u_normalize_matrix:Float32Array.from(f),u_merc_matrix:a,u_zoom_transition:g,u_merc_center:y,u_image0:0,u_frustum_tl:b,u_frustum_tr:E,u_frustum_br:A,u_frustum_bl:R,u_globe_pos:D,u_globe_radius:F,u_viewport:N,u_grid_matrix:W?Float32Array.from(W):new Float32Array(9),u_skirt_height:j,u_far_z_cutoff:X});function Yp(h,n){return h!=null&&n!=null&&!(!h.hasData()||!n.hasData())&&h.demTexture!=null&&n.demTexture!=null&&h.tileID.key!==n.tileID.key}const ec=new class{constructor(){this.operations={}}newMorphing(h,n,a,f,g){if(h in this.operations){const y=this.operations[h];y.to.tileID.key!==a.tileID.key&&(y.queued=a)}else this.operations[h]={startTime:f,phase:0,duration:g,from:n,to:a,queued:null}}getMorphValuesForProxy(h){if(!(h in this.operations))return null;const n=this.operations[h];return{from:n.from,to:n.to,phase:n.phase}}update(h){for(const n in this.operations){const a=this.operations[n];for(a.phase=(h-a.startTime)/a.duration;a.phase>=1||!this._validOp(a);)if(!this._nextOp(a,h)){delete this.operations[n];break}}}_nextOp(h,n){return!!h.queued&&(h.from=h.to,h.to=h.queued,h.queued=null,h.phase=0,h.startTime=n,!0)}_validOp(h){return h.from.hasData()&&h.to.hasData()}},z_={0:null,1:"TERRAIN_VERTEX_MORPHING"};function O_(h,n,a){if(n===0)return 0;const f=n<1&&a===514?.25/n:1;return 6*Math.pow(1.5,22-h)*Math.max(n,1)*f}function Y2(h,n){const a=1<<h.z;return!n&&(h.x===0||h.x===a-1)||h.y===0||h.y===a-1}const Kc=h=>({u_matrix:h});function Qc(h,n,a,f,g){if(g>0){const y=s.q.now(),b=(y-h.timeAdded)/g,E=n?(y-n.timeAdded)/g:-1,A=a.getSource(),R=f.coveringZoomLevel({tileSize:A.tileSize,roundZoom:A.roundZoom}),D=!n||Math.abs(n.tileID.overscaledZ-R)>Math.abs(h.tileID.overscaledZ-R),F=D&&h.refreshedUponExpiration?1:s.ay(D?b:1-E,0,1);return h.refreshedUponExpiration&&b>=1&&(h.refreshedUponExpiration=!1),n?{opacity:1,mix:1-F}:{opacity:F,mix:0}}return{opacity:1,mix:0}}class l0 extends oo{constructor(n){const a={type:"raster-dem",maxzoom:n.transform.maxZoom},f=new s.D(s.c$(),null),g=Ah("mock-dem",a,f,n.style);super("mock-dem",g,!1),g.setEventedParent(this),this._sourceLoaded=!0}_loadTile(n,a){n.state="loaded",a(null)}}class Oo extends oo{constructor(n){const a=Ah("proxy",{type:"geojson",maxzoom:n.transform.maxZoom},new s.D(s.c$(),null),n.style);super("proxy",a,!1),a.setEventedParent(this),this.map=this.getSource().map=n,this.used=this._sourceLoaded=!0,this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}update(n,a,f){if(n.freezeTileCoverage)return;this.transform=n;const g=n.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}).reduce((y,b)=>{if(y[b.key]="",!this._tiles[b.key]){const E=new jc(b,this._source.tileSize*b.overscaleFactor(),n.tileZoom,void 0,void 0,this._source.worldview);E.state="loaded",this._tiles[b.key]=E}return y},{});for(const y in this._tiles)y in g||(this.freeFBO(y),this._tiles[y].unloadVectorData(),delete this._tiles[y])}freeFBO(n){const a=this.proxyCachedFBO[n];if(a!==void 0){const f=Object.values(a);this.renderCachePool.push(...f),delete this.proxyCachedFBO[n]}}deallocRenderCache(){this.renderCache.forEach(n=>n.fb.destroy()),this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}}class Kp extends s.aM{constructor(n,a,f){super(n.overscaledZ,n.wrap,n.canonical.z,n.canonical.x,n.canonical.y),this.proxyTileKey=a,this.projMatrix=f}}class Xh extends s.dt{constructor(n,a){super(),this._debugParams={sortTilesHiZFirst:!0,disableRenderCache:!1},n.tp.registerParameter(this._debugParams,["Terrain"],"sortTilesHiZFirst",{},()=>{this._style.map.triggerRepaint()}),n.tp.registerParameter(this._debugParams,["Terrain"],"disableRenderCache",{},()=>{this._style.map.triggerRepaint()}),n.tp.registerButton(["Terrain"],"Invalidate Render Cache",()=>{this.invalidateRenderCache=!0,this._style.map.triggerRepaint()}),this.painter=n,this.terrainTileForTile={},this.prevTerrainTileForTile={};const[f,g,y]=function(A){const R=new s.ba,D=new s.a_,F=131;R.reserve(17161),D.reserve(33800);const N=s.aj/128,j=s.aj+N/2,X=j+N;for(let K=-64;K<X;K+=N)for(let ee=-64;ee<X;ee+=N){const ie=ee<0||ee>j||K<0||K>j?24575:0,fe=s.ay(Math.round(ee),0,s.aj),_e=s.ay(Math.round(K),0,s.aj);R.emplaceBack(fe+ie,_e)}const W=(K,ee)=>{const ie=ee*F+K;D.emplaceBack(ie+1,ie,ie+F),D.emplaceBack(ie+F,ie+F+1,ie+1)};for(let K=1;K<129;K++)for(let ee=1;ee<129;ee++)W(ee,K);return[0,129].forEach(K=>{for(let ee=0;ee<130;ee++)W(ee,K),W(K,ee)}),[R,D,32768]}(),b=n.context;this.gridBuffer=b.createVertexBuffer(f,s.bc.members),this.gridIndexBuffer=b.createIndexBuffer(g),this.gridSegments=s.bd.simpleSegment(0,0,f.length,g.length),this.gridNoSkirtSegments=s.bd.simpleSegment(0,0,f.length,y),this.proxyCoords=[],this.proxiedCoords={},this._visibleDemTiles=[],this._drapedRenderBatches=[],this._sourceTilesOverlap={},this.proxySourceCache=new Oo(a.map),this.orthoMatrix=s.bz(),s.c5(this.orthoMatrix,this.painter.transform.projection.name==="globe"?.015:0,s.aj,0,s.aj,0,1);const E=b.gl;this._overlapStencilMode=new En({func:E.GEQUAL,mask:255},0,255,E.KEEP,E.KEEP,E.REPLACE),this._previousZoom=n.transform.zoom,this.pool=[],this._findCoveringTileCache={},this._tilesDirty={},this.style=a,this._useVertexMorphing=!0,this._exaggeration=1,this._mockSourceCache=new l0(a.map),this._pendingGroundEffectLayers=[]}set style(n){n.on("data",this._onStyleDataEvent.bind(this)),this._style=n,this._style.map.on("moveend",()=>{this._clearLineLayersFromRenderCache()})}update(n,a,f){if(n&&n.terrain){this._style!==n&&(this.style=n,this._evaluationZoom=void 0);const g=n.terrain.properties,y=n.terrain.drapeRenderMode===0,b=n.terrain.isZoomDependent();this._previousUpdateTimestamp=this.enabled?this._updateTimestamp:void 0,this._updateTimestamp=s.q.now();const E=n.terrain&&n.terrain.scope,A=g.get("source"),R=y?this._mockSourceCache:n.getSourceCache(A,E);if(!R)return void s.w(`Couldn't find terrain source "${A}".`);if(this.sourceCache=R,this._attenuationRange=n.terrain.getAttenuationRange(),this._exaggeration=b?this.calculateExaggeration(a):g.get("exaggeration"),!a.projection.requiresDraping&&b&&this._exaggeration===0)return void this._disable();this.enabled=!0;const D=()=>{this.sourceCache.used&&s.w(`Raster DEM source '${this.sourceCache.id}' is used both for terrain and as layer source.
This leads to lower resolution of hillshade. For full hillshade resolution but higher memory consumption, define another raster DEM source.`);const F=this.getScaledDemTileSize();this.sourceCache.update(a,F,!0),this.resetTileLookupCache(this.sourceCache.id)};this.sourceCache.usedForTerrain||(this.resetTileLookupCache(this.sourceCache.id),this.sourceCache.usedForTerrain=!0,D(),this._initializing=!0),D(),a.updateElevation(!0,f),this.resetTileLookupCache(this.proxySourceCache.id),this.proxySourceCache.update(a),this._emptyDEMTextureDirty=!0,this._previousZoom=a.zoom}else this._disable()}calculateExaggeration(n){if(this._attenuationRange&&n.zoom>=Math.ceil(this._attenuationRange[1]))return this._style.terrain.getExaggeration(n.zoom);const a=this._previousCameraAltitude,f=n.getFreeCameraOptions().position.z/n.pixelsPerMeter*n.worldSize;this._previousCameraAltitude=f;const g=a!=null?f-a:Number.MAX_VALUE;if(Math.abs(g)<2)return this._exaggeration;const y=n.zoom,b=this._style.terrain;if(!this._previousUpdateTimestamp)return b.getExaggeration(y);let E=y-this._previousZoom;const A=this._previousUpdateTimestamp;let R=y;this._evaluationZoom!=null&&(R=this._evaluationZoom,Math.abs(y-R)>.5&&(E=.5*(y-R+E)),E*g<0&&(R+=E)),this._evaluationZoom=R;const D=b.getExaggeration(R),F=D===b.getExaggeration(Math.max(0,R-.1));if(F&&Math.abs(D-this._exaggeration)<.01)return D;let N=Math.min(.1,.00375*(this._updateTimestamp-A));return(F||D<.1||Math.abs(E)<1e-4)&&(N=Math.min(.2,4*N)),s.ai(this._exaggeration,D,N)}resetTileLookupCache(n){this._findCoveringTileCache[n]={}}attenuationRange(){return this._attenuationRange}getDemUpscale(){return this.proxySourceCache.getSource().tileSize/128}getScaledDemTileSize(){return this.sourceCache.getSource().tileSize/128*this.proxySourceCache.getSource().tileSize}_onStyleDataEvent(n){n.coord&&n.dataType==="source"?this._clearRenderCacheForTile(n.sourceCacheId,n.coord):n.dataType==="style"&&(this.invalidateRenderCache=!0,this._evaluationZoom=void 0,this._previousUpdateTimestamp=void 0,this._previousCameraAltitude=void 0)}_disable(){if(this.enabled&&(this.enabled=!1,this._emptyDEMTextureDirty=!0,this._sharedDepthStencil=void 0,this._evaluationZoom=void 0,this._previousUpdateTimestamp=void 0,this.proxySourceCache.deallocRenderCache(),this._style))for(const n in this._style._mergedSourceCaches)this._style._mergedSourceCaches[n].usedForTerrain=!1}destroy(){this._disable(),this._emptyDEMTexture&&this._emptyDEMTexture.destroy(),this.pool.forEach(n=>n.fb.destroy()),this.pool=[],this.framebufferCopyTexture&&this.framebufferCopyTexture.destroy()}_source(){return this.enabled?this.sourceCache:null}isUsingMockSource(){return this.sourceCache===this._mockSourceCache}exaggeration(){return this.enabled?this._exaggeration:0}get visibleDemTiles(){return this._visibleDemTiles}get drapeBufferSize(){const n=2*this.proxySourceCache.getSource().tileSize;return[n,n]}set useVertexMorphing(n){this._useVertexMorphing=n}updateTileBinding(n){if(!this.enabled)return;this.prevTerrainTileForTile=this.terrainTileForTile;const a=this.proxySourceCache,f=this.painter.transform;this._initializing&&(this._initializing=f._centerAltitude===0&&this.getAtPointOrZero(s.ac.fromLngLat(f.center),-1)===-1,this._emptyDEMTextureDirty=!this._initializing);const g=this.proxyCoords=a.getIds().map(A=>{const R=a.getTileByID(A).tileID;return R.projMatrix=f.calculateProjMatrix(R.toUnwrapped()),R});(function(A,R){const D=R.transform.pointCoordinate(R.transform.getCameraPoint()),F=new s.P(D.x,D.y);A.sort((N,j)=>{if(j.overscaledZ-N.overscaledZ)return j.overscaledZ-N.overscaledZ;const X=new s.P(N.canonical.x+(1<<N.canonical.z)*N.wrap,N.canonical.y),W=new s.P(j.canonical.x+(1<<j.canonical.z)*j.wrap,j.canonical.y),K=F.mult(1<<N.canonical.z);return K.x-=.5,K.y-=.5,K.distSqr(X)-K.distSqr(W)})})(g,this.painter);const y=this.proxyToSource||{};this.proxyToSource={},g.forEach(A=>{this.proxyToSource[A.key]={}}),this.terrainTileForTile={};const b=this._style._mergedSourceCaches;for(const A in b){const R=b[A];if(!R.used||(R!==this.sourceCache&&this.resetTileLookupCache(R.id),this._setupProxiedCoordsForOrtho(R,n[A],y),R.usedForTerrain))continue;const D=n[A];R.getSource().reparseOverscaled&&this._assignTerrainTiles(D)}this.proxiedCoords[a.id]=g.map(A=>new Kp(A,A.key,this.orthoMatrix)),this._assignTerrainTiles(g),this._prepareDEMTextures(),this._setupDrapedRenderBatches(),this._initFBOPool(),this._setupRenderCache(y),this.renderingToTexture=!1;const E={};this._visibleDemTiles=[];for(const A of this.proxyCoords){const R=this.terrainTileForTile[A.key];if(!R)continue;const D=R.tileID.key;D in E||(this._visibleDemTiles.push(R),E[D]=D)}}_assignTerrainTiles(n){this._initializing||n.forEach(a=>{if(this.terrainTileForTile[a.key])return;const f=this._findTileCoveringTileID(a,this.sourceCache);f&&(this.terrainTileForTile[a.key]=f)})}_prepareDEMTextures(){const n=this.painter.context,a=n.gl;for(const f in this.terrainTileForTile){const g=this.terrainTileForTile[f],y=g.dem;!y||g.demTexture&&!g.needsDEMTextureUpload||(n.activeTexture.set(a.TEXTURE1),Vp(this.painter,g,y))}}_prepareDemTileUniforms(n,a,f,g){if(!a||a.demTexture==null)return!1;const y=n.tileID.canonical,b=Math.pow(2,a.tileID.canonical.z-y.z),E=g||"";return f[`u_dem_tl${E}`]=[y.x*b%1,y.y*b%1],f[`u_dem_scale${E}`]=b,!0}get emptyDEMTexture(){return!this._emptyDEMTextureDirty&&this._emptyDEMTexture?this._emptyDEMTexture:this._updateEmptyDEMTexture()}_getLoadedAreaMinimum(){if(!this.enabled)return 0;let n=0;const a=this._visibleDemTiles.reduce((f,g)=>{if(!g.dem)return f;const y=g.dem.tree.minimums[0];return y>0&&n++,f+y},0);return n?a/n:0}_updateEmptyDEMTexture(){const n=this.painter.context,a=n.gl;n.activeTexture.set(a.TEXTURE2);const f=this._getLoadedAreaMinimum(),g=new s.du({width:1,height:1},new Float32Array([f]));this._emptyDEMTextureDirty=!1;let y=this._emptyDEMTexture;return y?y.update(g,{premultiply:!1}):y=this._emptyDEMTexture=new s.T(n,g,a.R32F,{premultiply:!1}),y}setupElevationDraw(n,a,f){const g=this.painter.context,y=g.gl,b={u_dem:2,u_dem_prev:4,u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_depth_range_unpack:[0,1],u_occluder_half_size:16,u_occlusion_depth_offset:-1e-4,u_exaggeration:0};b.u_exaggeration=this.exaggeration();let E=null,A=null,R=1;if(f&&f.morphing&&this._useVertexMorphing){const j=f.morphing.srcDemTile,X=f.morphing.dstDemTile;R=f.morphing.phase,j&&X&&(this._prepareDemTileUniforms(n,j,b,"_prev")&&(A=j),this._prepareDemTileUniforms(n,X,b)&&(E=X))}const D=j=>j&&j.demTexture&&this.painter.linearFloatFilteringSupported()?y.LINEAR:y.NEAREST;let F=null;var N;if(this.enabled?A&&E?(F=E.demTexture,g.activeTexture.set(y.TEXTURE4),A.demTexture.bind(D(A),y.CLAMP_TO_EDGE),b.u_dem_lerp=R):(E=this.terrainTileForTile[n.tileID.key],F=this._prepareDemTileUniforms(n,E,b)?E.demTexture:this.emptyDEMTexture):F=this.emptyDEMTexture,g.activeTexture.set(y.TEXTURE2),F&&(b.u_dem_size=(N=F).size[0]===1?1:N.size[0]-2,F.bind(D(E),y.CLAMP_TO_EDGE)),this.painter.setupDepthForOcclusion(f&&f.useDepthForOcclusion,a,b),f&&f.useMeterToDem&&E){const j=(1<<E.tileID.canonical.z)*s.c6(1,this.painter.transform.center.lat)*this.sourceCache.getSource().tileSize;b.u_meter_to_dem=j}if(f&&f.labelPlaneMatrixInv&&(b.u_label_plane_matrix_inv=f.labelPlaneMatrixInv),a.setTerrainUniformValues(g,b),this.painter.transform.projection.name==="globe"){const j=this.globeUniformValues(this.painter.transform,n.tileID.canonical,f&&f.useDenormalizedUpVectorScale);a.setGlobeUniformValues(g,j)}}globeUniformValues(n,a,f){const g=n.projection;return{u_tile_tl_up:g.upVector(a,0,0),u_tile_tr_up:g.upVector(a,s.aj,0),u_tile_br_up:g.upVector(a,s.aj,s.aj),u_tile_bl_up:g.upVector(a,0,s.aj),u_tile_up_scale:f?s.dv(1):g.upVectorScale(a,n.center.lat,n.worldSize).metersToTile}}renderToBackBuffer(n){const a=this.painter,f=this.painter.context;n.length!==0&&(f.bindFramebuffer.set(null),f.viewport.set([0,0,a.width,a.height]),a.gpuTimingDeferredRenderStart(),this.renderingToTexture=!1,function(g,y,b,E,A){if(g.transform.projection.name==="globe")(function(R,D,F,N,j){const X=R.context,W=X.gl;let K,ee;const ie=R.transform,fe=s.dl(R,X,ie),_e=(rt,it)=>{if(ee===it)return;const gt=[z_[it],"PROJECTION_GLOBE_VIEW"];fe&&gt.push("CUSTOM_ANTIALIASING");const ze=R.isTileAffectedByFog(rt);K=R.getOrCreateProgram("globeRaster",{defines:gt,overrideFog:ze}),ee=it},we=R.colorModeForRenderPass(),be=new Gt(W.LEQUAL,Gt.ReadWrite,R.depthRangeFor3D);ec.update(j);const ve=s.dm(ie),ye=[s.aD(ie.center.lng),s.aH(ie.center.lat)],Se=R.globeSharedBuffers,Ee=[ie.width*s.q.devicePixelRatio,ie.height*s.q.devicePixelRatio],Fe=Float32Array.from(ie.globeMatrix),je={useDenormalizedUpVectorScale:!0};{const rt=R.transform,it=O_(rt.zoom,D.exaggeration(),D.sourceCache._source.tileSize);ee=-1;const gt=W.TRIANGLES;for(const ze of N){const Xe=F.getTile(ze),Re=En.disabled,ot=D.prevTerrainTileForTile[ze.key],Ge=D.terrainTileForTile[ze.key];Yp(ot,Ge)&&ec.newMorphing(ze.key,ot,Ge,j,250),X.activeTexture.set(W.TEXTURE0),Xe.texture&&Xe.texture.bind(W.LINEAR,W.CLAMP_TO_EDGE);const dt=ec.getMorphValuesForProxy(ze.key),At=dt?1:0;dt&&s.L(je,{morphing:{srcDemTile:dt.from,dstDemTile:dt.to,phase:s.dk(dt.phase)}});const st=s.dn(ze.canonical),Tt=s.dp(st.getCenter().lat),qt=s.dq(ze.canonical,st,Tt,rt.worldSize/rt._pixelsPerMercatorPixel),Wt=s.bh(s.dr(ze.canonical)),Vt=Xp(rt.expandedFarZProjMatrix,Fe,ve,Wt,s.ah(rt.zoom),ye,rt.frustumCorners.TL,rt.frustumCorners.TR,rt.frustumCorners.BR,rt.frustumCorners.BL,rt.globeCenterInViewSpace,rt.globeRadius,Ee,it,rt._farZ,qt);if(_e(ze,At),K&&(D.setupElevationDraw(Xe,K,je),R.uploadCommonUniforms(X,K,ze.toUnwrapped()),Se)){const[tn,on,cn]=Se.getGridBuffers(Tt,it!==0);K.draw(R,gt,be,Re,we,_n.backCCW,Vt,"globe_raster",tn,on,cn)}}}if(Se&&(R.renderDefaultNorthPole||R.renderDefaultSouthPole)){const rt=["GLOBE_POLES","PROJECTION_GLOBE_VIEW"];fe&&rt.push("CUSTOM_ANTIALIASING"),K=R.getOrCreateProgram("globeRaster",{defines:rt});for(const it of N){const{x:gt,y:ze,z:Xe}=it.canonical,Re=ze===0,ot=ze===(1<<Xe)-1,[Ge,dt,At,st]=Se.getPoleBuffers(Xe,!1);if(st&&(Re||ot)){const Tt=F.getTile(it);X.activeTexture.set(W.TEXTURE0),Tt.texture&&Tt.texture.bind(W.LINEAR,W.CLAMP_TO_EDGE);let qt=s.ds(Xe,gt,ie);const Wt=s.bh(s.dr(it.canonical)),Vt=(tn,on)=>tn.draw(R,W.TRIANGLES,be,En.disabled,we,_n.disabled,Xp(ie.expandedFarZProjMatrix,qt,qt,Wt,0,ye,ie.frustumCorners.TL,ie.frustumCorners.TR,ie.frustumCorners.BR,ie.frustumCorners.BL,ie.globeCenterInViewSpace,ie.globeRadius,Ee,0,ie._farZ),"globe_pole_raster",on,At,st);D.setupElevationDraw(Tt,K,je),R.uploadCommonUniforms(X,K,it.toUnwrapped()),Re&&R.renderDefaultNorthPole&&Vt(K,Ge),ot&&R.renderDefaultSouthPole&&(qt=s.cE(s.bz(),qt,[1,-1,1]),Vt(K,dt))}}}})(g,y,b,E,A);else{const R=g.context,D=R.gl;let F,N;const j=g.shadowRenderer,X=Oa(g,g.longestCutoffRange),W=we=>{if(N===we)return;const be=[];be.push(z_[we]),X.shouldRenderCutoff&&be.push("RENDER_CUTOFF"),j&&(be.push("RENDER_SHADOWS","DEPTH_TEXTURE"),j.useNormalOffset&&be.push("NORMAL_OFFSET")),F=g.getOrCreateProgram("terrainRaster",{defines:be}),N=we},K=g.colorModeForRenderPass(),ee=new Gt(D.LEQUAL,Gt.ReadWrite,g.depthRangeFor3D);ec.update(A);const ie=g.transform,fe=O_(ie.zoom,y.exaggeration(),y.sourceCache._source.tileSize);let _e=[0,0,0];if(j){const we=g.style.directionalLight,be=g.style.ambientLight;we&&be&&(_e=Zc(g.style,we,be))}{N=-1;const we=D.TRIANGLES,[be,ve]=[y.gridIndexBuffer,y.gridSegments];for(const ye of E){const Se=b.getTile(ye),Ee=En.disabled,Fe=y.prevTerrainTileForTile[ye.key],je=y.terrainTileForTile[ye.key];Yp(Fe,je)&&ec.newMorphing(ye.key,Fe,je,A,250),R.activeTexture.set(D.TEXTURE0),Se.texture&&Se.texture.bind(D.LINEAR,D.CLAMP_TO_EDGE);const rt=ec.getMorphValuesForProxy(ye.key),it=rt?1:0;let gt;rt&&(gt={morphing:{srcDemTile:rt.from,dstDemTile:rt.to,phase:s.dk(rt.phase)}});const ze=N_(ye.projMatrix,Y2(ye.canonical,ie.renderWorldCopies)?fe/10:fe,_e);if(W(it),!F)continue;y.setupElevationDraw(Se,F,gt);const Xe=ye.toUnwrapped();j&&j.setupShadows(Xe,F),g.uploadCommonUniforms(R,F,Xe,null,X),F.draw(g,we,ee,Ee,K,_n.backCCW,ze,"terrain_raster",y.gridBuffer,be,ve)}}}}(a,this,this.proxySourceCache,n,this._updateTimestamp),this.renderingToTexture=!0,a.gpuTimingDeferredRenderEnd(),n.splice(0,n.length))}renderBatch(n){if(this._drapedRenderBatches.length===0)return n+1;this.renderingToTexture=!0;const a=this.painter,f=this.painter.context,g=this.proxySourceCache,y=this.proxiedCoords[g.id],b=this._drapedRenderBatches.shift(),E=a.style.order,A=[];let R=0;for(const D of y){const F=g.getTileByID(D.proxyTileKey),N=g.proxyCachedFBO[D.key]?g.proxyCachedFBO[D.key][n]:void 0,j=N!==void 0?g.renderCache[N]:this.pool[R++],X=N!==void 0;if(F.texture=j.tex,X&&!j.dirty){A.push(F.tileID);continue}let W;f.bindFramebuffer.set(j.fb.framebuffer),this.renderedToTile=!1,j.dirty&&(f.clear({color:s.am.transparent,stencil:0}),j.dirty=!1);for(let K=b.start;K<=b.end;++K){const ee=a.style._mergedLayers[E[K]];if(ee.isHidden(a.transform.zoom))continue;const ie=a.style.getLayerSourceCache(ee),fe=ie?this.proxyToSource[D.key][ie.id]:[D];if(!fe)continue;const _e=fe;f.viewport.set([0,0,j.fb.width,j.fb.height]),W!==(ie?ie.id:null)&&(this._setupStencil(j,fe,ee,ie),W=ie?ie.id:null),a.renderLayer(a,ie,ee,_e)}if(this._drapedRenderBatches.length===0)for(const K of this._pendingGroundEffectLayers){const ee=a.style._mergedLayers[E[K]];if(ee.isHidden(a.transform.zoom))continue;const ie=a.style.getLayerSourceCache(ee),fe=ie?this.proxyToSource[D.key][ie.id]:[D];if(!fe)continue;const _e=fe;f.viewport.set([0,0,j.fb.width,j.fb.height]),W!==(ie?ie.id:null)&&(this._setupStencil(j,fe,ee,ie),W=ie?ie.id:null),a.renderLayer(a,ie,ee,_e)}this.renderedToTile?(j.dirty=!0,A.push(F.tileID)):X||--R,R===5&&(R=0,this.renderToBackBuffer(A))}return this.renderToBackBuffer(A),this.renderingToTexture=!1,f.bindFramebuffer.set(null),f.viewport.set([0,0,a.width,a.height]),b.end+1}postRender(){}isLayerOrderingCorrect(n){const a=n.order.length;let f=-1,g=a;for(let y=0;y<a;++y)this._style.isLayerDraped(n._mergedLayers[n.order[y]])?f=Math.max(f,y):g=Math.min(g,y);return g>f}getMinElevationBelowMSL(){let n=0;return this._visibleDemTiles.filter(a=>a.dem).forEach(a=>{n=Math.min(n,a.dem.tree.minimums[0])}),n===0?n:(n-30)*this._exaggeration}raycast(n,a,f){if(!this._visibleDemTiles)return null;const g=this._visibleDemTiles.filter(y=>y.dem).map(y=>{const b=y.tileID,E=1<<b.overscaledZ,{x:A,y:R}=b.canonical,D=A/E,F=(A+1)/E,N=R/E,j=(R+1)/E;return{minx:D,miny:N,maxx:F,maxy:j,t:y.dem.tree.raycastRoot(D,N,F,j,n,a,f),tile:y}});g.sort((y,b)=>(y.t!==null?y.t:Number.MAX_VALUE)-(b.t!==null?b.t:Number.MAX_VALUE));for(const y of g){if(y.t==null)return null;const b=y.tile.dem.tree.raycast(y.minx,y.miny,y.maxx,y.maxy,n,a,f);if(b!=null)return b}return null}_createFBO(){const n=this.painter.context,a=n.gl,f=this.drapeBufferSize;n.activeTexture.set(a.TEXTURE0);const g=new s.T(n,{width:f[0],height:f[1],data:null},a.RGBA8);g.bind(a.LINEAR,a.CLAMP_TO_EDGE);const y=n.createFramebuffer(f[0],f[1],!0,null);return y.colorAttachment.set(g.texture),y.depthAttachment=new X2(n,y.framebuffer),this._sharedDepthStencil===void 0?(this._sharedDepthStencil=n.createRenderbuffer(n.gl.DEPTH_STENCIL,f[0],f[1]),this._stencilRef=0,y.depthAttachment.set(this._sharedDepthStencil),n.clear({stencil:0})):y.depthAttachment.set(this._sharedDepthStencil),n.extTextureFilterAnisotropic&&a.texParameterf(a.TEXTURE_2D,n.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,n.extTextureFilterAnisotropicMax),{fb:y,tex:g,dirty:!1}}_initFBOPool(){for(;this.pool.length<Math.min(5,this.proxyCoords.length);)this.pool.push(this._createFBO())}_shouldDisableRenderCache(){if(this._debugParams.disableRenderCache||this._style.hasLightTransitions())return!0;for(const n in this._style._mergedSourceCaches)if(this._style._mergedSourceCaches[n].hasTransition())return!0;return this._style.order.some(n=>{const a=this._style._mergedLayers[n],f=a.isHidden(this.painter.transform.zoom);return a.type==="hillshade"||a.type==="custom"?!f&&a.shouldRedrape():!f&&a.hasTransition()})}_clearLineLayersFromRenderCache(){let n=!1;for(const f of this._style.getSources())if(f instanceof Ch){n=!0;break}if(!n)return;const a={};for(let f=0;f<this._style.order.length;++f){const g=this._style._mergedLayers[this._style.order[f]],y=this._style.getLayerSourceCache(g);if(y&&!a[y.id]&&!g.isHidden(this.painter.transform.zoom)&&g.type==="line"&&g.widthExpression()instanceof s.ab){a[y.id]=!0;for(const b of this.proxyCoords){const E=this.proxyToSource[b.key][y.id];if(E)for(const A of E)this._clearRenderCacheForTile(y.id,A)}}}}_clearRasterLayersFromRenderCache(){let n=!1;for(const f in this._style._mergedSourceCaches)if(this._style._mergedSourceCaches[f]._source instanceof vs){n=!0;break}if(!n)return;const a={};for(let f=0;f<this._style.order.length;++f){const g=this._style._mergedLayers[this._style.order[f]],y=this._style.getLayerSourceCache(g);if(!y||a[y.id]||g.isHidden(this.painter.transform.zoom)||g.type!=="raster")continue;const b=g.paint.get("raster-fade-duration");for(const E of this.proxyCoords){const A=this.proxyToSource[E.key][y.id];if(A)for(const R of A){const D=Qc(y.getTile(R),y.findLoadedParent(R,0),y,this.painter.transform,b);(D.opacity!==1||D.mix!==0)&&this._clearRenderCacheForTile(y.id,R)}}}}_setupDrapedRenderBatches(){this._style.updateDrapeFirstLayers();const n=this._style.order,a=n.length;if(a===0)return;const f=[];this._pendingGroundEffectLayers=[];let g,y=0,b=this._style._mergedLayers[n[y]];for(;!this._style.isLayerDraped(b)&&b.isHidden(this.painter.transform.zoom)&&++y<a;)b=this._style._mergedLayers[n[y]];for(;y<a;++y){const E=this._style._mergedLayers[n[y]];E.isHidden(this.painter.transform.zoom)||(this._style.isLayerDraped(E)?g===void 0&&(g=y):(E.type==="fill-extrusion"&&this._pendingGroundEffectLayers.push(y),g!==void 0&&(f.push({start:g,end:y-1}),g=void 0)))}if(g!==void 0&&f.push({start:g,end:y-1}),f.length!==0){const E=f[f.length-1];this._pendingGroundEffectLayers.every(A=>A>E.end)||s.w("fill-extrusion with flood lighting and/or ground ambient occlusion should be moved to be on top of all draped layers.")}this._drapedRenderBatches=f}_setupRenderCache(n){const a=this.proxySourceCache;if(this._shouldDisableRenderCache()||this.invalidateRenderCache){if(this.invalidateRenderCache=!1,a.renderCache.length>a.renderCachePool.length){const b=Object.values(a.proxyCachedFBO);a.proxyCachedFBO={};for(let E=0;E<b.length;++E){const A=Object.values(b[E]);a.renderCachePool.push(...A)}}return}this._clearRasterLayersFromRenderCache();const f=this.proxyCoords,g=this._tilesDirty;for(let b=f.length-1;b>=0;b--){const E=f[b];if(a.getTileByID(E.key),a.proxyCachedFBO[E.key]!==void 0){const A=n[E.key],R=this.proxyToSource[E.key];let D=0;for(const F in R){const N=R[F],j=A[F];if(!j||j.length!==N.length||N.some((X,W)=>X!==j[W]||g[F]&&g[F].hasOwnProperty(X.key))){D=-1;break}++D}for(const F in a.proxyCachedFBO[E.key])a.renderCache[a.proxyCachedFBO[E.key][F]].dirty=D<0||D!==Object.values(A).length}}const y=[...this._drapedRenderBatches];y.sort((b,E)=>E.end-E.start-(b.end-b.start));for(const b of y)for(const E of f){if(a.proxyCachedFBO[E.key])continue;let A=a.renderCachePool.pop();A===void 0&&a.renderCache.length<50&&(A=a.renderCache.length,a.renderCache.push(this._createFBO())),A!==void 0&&(a.proxyCachedFBO[E.key]={},a.proxyCachedFBO[E.key][b.start]=A,a.renderCache[A].dirty=!0)}this._tilesDirty={}}_setupStencil(n,a,f,g){if(!g||!this._sourceTilesOverlap[g.id])return void(this._overlapStencilType&&(this._overlapStencilType=!1));const y=this.painter.context,b=y.gl;if(a.length<=1)return void(this._overlapStencilType=!1);let E;if(f.isTileClipped())E=a.length,this._overlapStencilMode.test={func:b.EQUAL,mask:255},this._overlapStencilType="Clip";else{if(!(a[0].overscaledZ>a[a.length-1].overscaledZ))return void(this._overlapStencilType=!1);E=1,this._overlapStencilMode.test={func:b.GREATER,mask:255},this._overlapStencilType="Mask"}this._stencilRef+E>255&&(y.clear({stencil:0}),this._stencilRef=0),this._stencilRef+=E,this._overlapStencilMode.ref=this._stencilRef,f.isTileClipped()&&this._renderTileClippingMasks(a,this._overlapStencilMode.ref)}clipOrMaskOverlapStencilType(){return this._overlapStencilType==="Clip"||this._overlapStencilType==="Mask"}stencilModeForRTTOverlap(n){return this.renderingToTexture&&this._overlapStencilType?(this._overlapStencilType==="Clip"&&(this._overlapStencilMode.ref=this.painter._tileClippingMaskIDs[n.key]),this._overlapStencilMode):En.disabled}_renderTileClippingMasks(n,a){const f=this.painter,g=this.painter.context,y=g.gl;f._tileClippingMaskIDs={},g.setColorMode(Zn.disabled),g.setDepthMode(Gt.disabled);const b=f.getOrCreateProgram("clippingMask");for(const E of n){const A=f._tileClippingMaskIDs[E.key]=--a;b.draw(f,y.TRIANGLES,Gt.disabled,new En({func:y.ALWAYS,mask:0},A,255,y.KEEP,y.KEEP,y.REPLACE),Zn.disabled,_n.disabled,Kc(E.projMatrix),"$clipping",f.tileExtentBuffer,f.quadTriangleIndexBuffer,f.tileExtentSegments)}}pointCoordinate(n){const a=this.painter.transform;if(n.x<0||n.x>a.width||n.y<0||n.y>a.height)return null;const f=[n.x,n.y,1,1];s.aA(f,f,a.pixelMatrixInverse),s.cw(f,f,1/f[3]),f[0]/=a.worldSize,f[1]/=a.worldSize;const g=a._camera.position,y=s.c6(1,a.center.lat),b=[g[0],g[1],g[2]/y,0],E=s.cX([],f.slice(0,3),b);s.au(E,E);const A=this.raycast(b,E,this._exaggeration);return A!==null&&A?(s.bE(b,b,E,A),b[3]=b[2],b[2]*=y,b):null}_setupProxiedCoordsForOrtho(n,a,f){if(n.getSource()instanceof s.aP)return this._setupProxiedCoordsForImageSource(n,a,f);this._findCoveringTileCache[n.id]=this._findCoveringTileCache[n.id]||{};const g=this.proxiedCoords[n.id]=[],y=this.proxyCoords;for(let A=0;A<y.length;A++){const R=y[A],D=this._findTileCoveringTileID(R,n);if(D){const F=this._createProxiedId(R,D,f[R.key]&&f[R.key][n.id]);g.push(F),this.proxyToSource[R.key][n.id]=[F]}}let b=!1;const E=new Set;for(let A=0;A<a.length;A++){const R=n.getTile(a[A]);if(!R||!R.hasData())continue;const D=this._findTileCoveringTileID(R.tileID,this.proxySourceCache);if(D&&D.tileID.canonical.z!==R.tileID.canonical.z){const F=this.proxyToSource[D.tileID.key][n.id],N=this._createProxiedId(D.tileID,R,f[D.tileID.key]&&f[D.tileID.key][n.id]);F?F.splice(F.length-1,0,N):this.proxyToSource[D.tileID.key][n.id]=[N];const j=this.proxyToSource[D.tileID.key][n.id];E.has(j)||E.add(j),g.push(N),b=!0}}if(this._sourceTilesOverlap[n.id]=b,b&&this._debugParams.sortTilesHiZFirst)for(const A of E)A.sort((R,D)=>D.overscaledZ-R.overscaledZ)}_setupProxiedCoordsForImageSource(n,a,f){if(!n.getSource().loaded())return;const g=this.proxiedCoords[n.id]=[],y=this.proxyCoords,b=n.getSource(),E=b.tileID;if(!E)return;const A=new s.P(E.x,E.y)._div(1<<E.z),R=b.coordinates.map(s.ac.fromLngLat).reduce((F,N)=>(F.min.x=Math.min(F.min.x,N.x-A.x),F.min.y=Math.min(F.min.y,N.y-A.y),F.max.x=Math.max(F.max.x,N.x-A.x),F.max.y=Math.max(F.max.y,N.y-A.y),F),{min:new s.P(Number.MAX_VALUE,Number.MAX_VALUE),max:new s.P(-Number.MAX_VALUE,-Number.MAX_VALUE)}),D=(F,N)=>{const j=F.wrap+F.canonical.x/(1<<F.canonical.z),X=F.canonical.y/(1<<F.canonical.z),W=s.aj/(1<<F.canonical.z),K=N.wrap+N.canonical.x/(1<<N.canonical.z),ee=N.canonical.y/(1<<N.canonical.z);return j+W<K+R.min.x||j>K+R.max.x||X+W<ee+R.min.y||X>ee+R.max.y};for(let F=0;F<y.length;F++){const N=y[F];for(let j=0;j<a.length;j++){const X=n.getTile(a[j]);if(!X||!X.hasData()||D(N,X.tileID))continue;const W=this._createProxiedId(N,X,f[N.key]&&f[N.key][n.id]),K=this.proxyToSource[N.key][n.id];K?K.push(W):this.proxyToSource[N.key][n.id]=[W],g.push(W)}}}_createProxiedId(n,a,f){let g=this.orthoMatrix;if(f){const y=f.find(b=>b.key===a.tileID.key);if(y)return y}if(a.tileID.key!==n.key){const y=n.canonical.z-a.tileID.canonical.z;let b,E,A;g=s.bz();const R=a.tileID.wrap-n.wrap<<n.overscaledZ;y>0?(b=s.aj>>y,E=b*((a.tileID.canonical.x<<y)-n.canonical.x+R),A=b*((a.tileID.canonical.y<<y)-n.canonical.y)):(b=s.aj<<-y,E=s.aj*(a.tileID.canonical.x-(n.canonical.x+R<<-y)),A=s.aj*(a.tileID.canonical.y-(n.canonical.y<<-y))),s.c5(g,0,b,0,b,0,1),s.bo(g,g,[E,A,0])}return new Kp(a.tileID,n.key,g)}_findTileCoveringTileID(n,a){let f=a.getTile(n);if(f&&f.hasData())return f;const g=this._findCoveringTileCache[a.id],y=g[n.key];if(f=y?a.getTileByID(y):null,f&&f.hasData()||y===null)return f;let b=f?f.tileID:n,E=b.overscaledZ;const A=a.getSource().minzoom,R=[];if(!y){const F=a.getSource().maxzoom;if(n.canonical.z>=F){const N=n.canonical.z-F;a.getSource().reparseOverscaled?(E=Math.max(n.canonical.z+2,a.transform.tileZoom),b=new s.aM(E,n.wrap,F,n.canonical.x>>N,n.canonical.y>>N)):N!==0&&(E=F,b=new s.aM(E,n.wrap,F,n.canonical.x>>N,n.canonical.y>>N))}b.key!==n.key&&(R.push(b.key),f=a.getTile(b))}const D=F=>{R.forEach(N=>{g[N]=F}),R.length=0};for(E-=1;E>=A&&(!f||!f.hasData());E--){f&&D(f.tileID.key);const F=b.calculateScaledKey(E);if(f=a.getTileByID(F),f&&f.hasData())break;const N=g[F];if(N===null)break;N===void 0?R.push(F):f=a.getTileByID(N)}return D(f?f.tileID.key:null),f&&f.hasData()?f:null}findDEMTileFor(n){return this.enabled?this._findTileCoveringTileID(n,this.sourceCache):null}prepareDrawTile(){this.renderedToTile=!0}_clearRenderCacheForTile(n,a){let f=this._tilesDirty[n];f||(f=this._tilesDirty[n]={}),f[a.key]=!0}}function Qp(h,n,a){const f=function(E,A,R){const D=s.bG(A,E),F=s.bG(R,[.2126,.7152,.0722]),N=(X,W,K)=>(1-K)*X+K*W,j=N(1-.3*Math.min(F,1),1,Math.min(D+1,1));return N(.92,1,Math.asin(s.ay(A[2],-1,1))/Math.PI+.5)*j}(h,[0,0,1],n),g=[0,0,0];s.bY(g,a.slice(0,3),f);const y=[0,0,0];s.bY(y,n.slice(0,3),h[2]);const b=[0,0,0];return s.cV(b,g,y),s.cY(b)}const F_=["fill","fillOutline","fillPattern","line","linePattern","background","backgroundPattern","hillshade","raster"],j_=["stars","rainParticle","snowParticle","fillExtrusion","fillExtrusionGroundEffect","elevatedStructures","model","symbol"];class Jp{static cacheKey(n,a,f,g){let y=`${a}${g?g.cacheKey:""}`;for(const b of f)n.usedDefines.includes(b)&&(y+=`/${b}`);return y}constructor(n,a,f,g,y,b){const E=n.gl;this.program=E.createProgram(),this.configuration=g,this.name=a,this.fixedDefines=[...b];const A=g?g.getBinderAttributes():[],R=(f.staticAttributes||[]).concat(A);let D=g?g.defines():[];D=D.concat(b.map(K=>`#define ${K}`));const F=`#version 300 es
`;let N=F+D.concat("precision mediump float;",Fa,Wh.fragmentSource).join(`
`);for(const K of f.fragmentIncludes)N+=`
${Hu[K]}`;N+=`
${f.fragmentSource}`;let j=F+D.concat("precision highp float;",Fa,Wh.vertexSource).join(`
`);for(const K of f.vertexIncludes)j+=`
${Hu[K]}`;this.forceManualRenderingForInstanceIDShaders=n.forceManualRenderingForInstanceIDShaders&&f.vertexSource.indexOf("gl_InstanceID")!==-1,this.forceManualRenderingForInstanceIDShaders&&(j+=`
uniform int u_instanceID;
`),j+=`
${f.vertexSource}`,this.forceManualRenderingForInstanceIDShaders&&(j=j.replaceAll("gl_InstanceID","u_instanceID"));const X=E.createShader(E.FRAGMENT_SHADER);if(E.isContextLost())return void(this.failedToCreate=!0);E.shaderSource(X,N),E.compileShader(X),E.attachShader(this.program,X);const W=E.createShader(E.VERTEX_SHADER);if(E.isContextLost())this.failedToCreate=!0;else{E.shaderSource(W,j),E.compileShader(W),E.attachShader(this.program,W),this.attributes={},this.numAttributes=R.length;for(let K=0;K<this.numAttributes;K++)if(R[K]){const ee=R[K].startsWith("a_")?R[K]:`a_${R[K]}`;E.bindAttribLocation(this.program,K,ee),this.attributes[ee]=K}E.linkProgram(this.program),E.deleteShader(W),E.deleteShader(X),this.fixedUniforms=y(n),this.binderUniforms=g?g.getUniforms(n):[],this.forceManualRenderingForInstanceIDShaders&&(this.instancingUniforms=(K=>({u_instanceID:new s.c8(K)}))(n)),(b.includes("TERRAIN")||a.indexOf("symbol")!==-1||a.indexOf("circle")!==-1)&&(this.terrainUniforms=(K=>({u_dem:new s.c8(K),u_dem_prev:new s.c8(K),u_dem_tl:new s.cb(K),u_dem_scale:new s.ca(K),u_dem_tl_prev:new s.cb(K),u_dem_scale_prev:new s.ca(K),u_dem_size:new s.ca(K),u_dem_lerp:new s.ca(K),u_exaggeration:new s.ca(K),u_depth:new s.c8(K),u_depth_size_inv:new s.cb(K),u_depth_range_unpack:new s.cb(K),u_occluder_half_size:new s.ca(K),u_occlusion_depth_offset:new s.ca(K),u_meter_to_dem:new s.ca(K),u_label_plane_matrix_inv:new s.cc(K)}))(n)),b.includes("GLOBE")&&(this.globeUniforms=(K=>({u_tile_tl_up:new s.c9(K),u_tile_tr_up:new s.c9(K),u_tile_br_up:new s.c9(K),u_tile_bl_up:new s.c9(K),u_tile_up_scale:new s.ca(K)}))(n)),b.includes("FOG")&&(this.fogUniforms=(K=>({u_fog_matrix:new s.cc(K),u_fog_range:new s.cb(K),u_fog_color:new s.cQ(K),u_fog_horizon_blend:new s.ca(K),u_fog_vertical_limit:new s.cb(K),u_fog_temporal_offset:new s.ca(K),u_frustum_tl:new s.c9(K),u_frustum_tr:new s.c9(K),u_frustum_br:new s.c9(K),u_frustum_bl:new s.c9(K),u_globe_pos:new s.c9(K),u_globe_radius:new s.ca(K),u_globe_transition:new s.ca(K),u_is_globe:new s.c8(K),u_viewport:new s.cb(K)}))(n)),b.includes("RENDER_CUTOFF")&&(this.cutoffUniforms=(K=>({u_cutoff_params:new s.cQ(K)}))(n)),b.includes("LIGHTING_3D_MODE")&&(this.lightsUniforms=(K=>({u_lighting_ambient_color:new s.c9(K),u_lighting_directional_dir:new s.c9(K),u_lighting_directional_color:new s.c9(K),u_ground_radiance:new s.c9(K)}))(n)),b.includes("RENDER_SHADOWS")&&(this.shadowUniforms=(K=>({u_light_matrix_0:new s.cc(K),u_light_matrix_1:new s.cc(K),u_fade_range:new s.cb(K),u_shadow_normal_offset:new s.c9(K),u_shadow_intensity:new s.ca(K),u_shadow_texel_size:new s.ca(K),u_shadow_map_resolution:new s.ca(K),u_shadow_direction:new s.c9(K),u_shadow_bias:new s.c9(K),u_shadowmap_0:new s.c8(K),u_shadowmap_1:new s.c8(K)}))(n))}}setTerrainUniformValues(n,a){if(!this.terrainUniforms)return;const f=this.terrainUniforms;if(!this.failedToCreate){n.program.set(this.program);for(const g in a)f[g]&&f[g].set(this.program,g,a[g])}}setGlobeUniformValues(n,a){if(!this.globeUniforms)return;const f=this.globeUniforms;if(!this.failedToCreate){n.program.set(this.program);for(const g in a)f[g]&&f[g].set(this.program,g,a[g])}}setFogUniformValues(n,a){if(!this.fogUniforms)return;const f=this.fogUniforms;if(!this.failedToCreate){n.program.set(this.program);for(const g in a)f[g].set(this.program,g,a[g])}}setCutoffUniformValues(n,a){if(!this.cutoffUniforms)return;const f=this.cutoffUniforms;if(!this.failedToCreate){n.program.set(this.program);for(const g in a)f[g].set(this.program,g,a[g])}}setLightsUniformValues(n,a){if(!this.lightsUniforms)return;const f=this.lightsUniforms;if(!this.failedToCreate){n.program.set(this.program);for(const g in a)f[g].set(this.program,g,a[g])}}setShadowUniformValues(n,a){if(this.failedToCreate||!this.shadowUniforms)return;const f=this.shadowUniforms;n.program.set(this.program);for(const g in a)f[g].set(this.program,g,a[g])}_drawDebugWireframe(n,a,f,g,y,b,E,A,R,D){const F=n.options.wireframe;if(F.terrain===!1&&F.layers2D===!1&&F.layers3D===!1)return;const N=n.context;if(!(!(!F.terrain||this.name!=="terrainRaster"&&this.name!=="globeRaster")||!(!F.layers2D||n._terrain&&n._terrain.renderingToTexture||!F_.includes(this.name))||!(!F.layers3D||!j_.includes(this.name))))return;const j=N.gl,X=n.wireframeDebugCache.getLinesFromTrianglesBuffer(n.frameCounter,y,N);if(!X)return;const W=[...this.fixedDefines];W.push("DEBUG_WIREFRAME");const K=n.getOrCreateProgram(this.name,{config:this.configuration,defines:W});N.program.set(K.program);const ee=(_e,we,be)=>{if(we[_e]&&be[_e])for(const ve in we[_e])be[_e][ve]&&be[_e][ve].set(be.program,ve,we[_e][ve].current)};R&&R.setUniforms(K.program,N,K.binderUniforms,E,{zoom:A}),ee("fixedUniforms",this,K),ee("terrainUniforms",this,K),ee("globeUniforms",this,K),ee("fogUniforms",this,K),ee("lightsUniforms",this,K),ee("shadowUniforms",this,K),X.bind(),N.setColorMode(new Zn([j.ONE,j.ONE_MINUS_SRC_ALPHA,j.ZERO,j.ONE],s.am.transparent,[!0,!0,!0,!1])),N.setDepthMode(new Gt(a.func===j.LESS?j.LEQUAL:a.func,Gt.ReadOnly,a.range)),N.setStencilMode(En.disabled);const ie=3*b.primitiveLength*2,fe=3*b.primitiveOffset*2*2;if(this.forceManualRenderingForInstanceIDShaders){const _e=D||1;for(let we=0;we<_e;++we)K.instancingUniforms.u_instanceID.set(this.program,"u_instanceID",we),j.drawElements(j.LINES,ie,j.UNSIGNED_SHORT,fe)}else D&&D>1?j.drawElementsInstanced(j.LINES,ie,j.UNSIGNED_SHORT,fe,D):j.drawElements(j.LINES,ie,j.UNSIGNED_SHORT,fe);y.bind(),N.program.set(this.program),N.setDepthMode(a),N.setStencilMode(f),N.setColorMode(g)}checkUniforms(n,a,f){if(this.fixedDefines.includes(a)){for(const g of Object.keys(f))if(!f[g].initialized)throw new Error(`Program '${this.name}', from draw '${n}': uniform ${g} not set but required by ${a} being defined`)}}draw(n,a,f,g,y,b,E,A,R,D,F,N,j,X,W,K){const ee=n.context,ie=ee.gl;if(this.failedToCreate)return;ee.program.set(this.program),ee.setDepthMode(f),ee.setStencilMode(g),ee.setColorMode(y),ee.setCullFace(b);for(const we of Object.keys(this.fixedUniforms))this.fixedUniforms[we].set(this.program,we,E[we]);X&&X.setUniforms(this.program,ee,this.binderUniforms,N,{zoom:j});const fe={[ie.POINTS]:1,[ie.LINES]:2,[ie.TRIANGLES]:3,[ie.LINE_STRIP]:1}[a];this.checkUniforms(A,"RENDER_SHADOWS",this.shadowUniforms);const _e=K&&K>0?1:void 0;for(const we of F.get()){const be=we.vaos||(we.vaos={});if((be[A]||(be[A]=new qu)).bind(ee,this,R,X?X.getPaintVertexBuffers():[],D,we.vertexOffset,W||[],_e),this.forceManualRenderingForInstanceIDShaders){const ve=K||1;for(let ye=0;ye<ve;++ye)this.instancingUniforms.u_instanceID.set(this.program,"u_instanceID",ye),D?ie.drawElements(a,we.primitiveLength*fe,ie.UNSIGNED_SHORT,we.primitiveOffset*fe*2):ie.drawArrays(a,we.vertexOffset,we.vertexLength)}else K&&K>1?ie.drawElementsInstanced(a,we.primitiveLength*fe,ie.UNSIGNED_SHORT,we.primitiveOffset*fe*2,K):D?ie.drawElements(a,we.primitiveLength*fe,ie.UNSIGNED_SHORT,we.primitiveOffset*fe*2):ie.drawArrays(a,we.vertexOffset,we.vertexLength);a===ie.TRIANGLES&&D&&this._drawDebugWireframe(n,f,g,y,D,we,N,j,X,K)}}}function Yh(h,n,a=0){const f=Math.pow(2,n.tileID.overscaledZ),g=n.tileSize*Math.pow(2,h.transform.tileZoom)/f,y=g*(n.tileID.canonical.x+n.tileID.wrap*f),b=g*n.tileID.canonical.y;return{u_image:0,u_texsize:n.imageAtlasTexture?n.imageAtlasTexture.size:[0,0],u_tile_units_to_pixels:1/s.aw(n,1,h.transform.tileZoom),u_pixel_coord_upper:[y>>16,b>>16],u_pixel_coord_lower:[65535&y,65535&b],u_pattern_transition:a}}const Yu={terrain:0,flat:1},B_=s.bz(),Kh=(h,n,a,f,g,y,b,E,A,R,D,F,N,j,X,W,K,ee)=>{const ie=n.style.light,fe=ie.properties.get("position"),_e=[fe.x,fe.y,fe.z],we=s.dx();ie.properties.get("anchor")==="viewport"&&(s.dy(we,-n.transform.angle),s.dz(_e,_e,we));const be=ie.properties.get("color").toPremultipliedRenderColor(null),ve=n.transform,ye={u_matrix:h,u_lightpos:_e,u_lightintensity:ie.properties.get("intensity"),u_lightcolor:[be.r,be.g,be.b],u_vertical_gradient:+a,u_opacity:f,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:B_,u_merc_center:[0,0],u_up_dir:[0,0,0],u_height_lift:0,u_height_type:Yu[R],u_base_type:Yu[D],u_ao:g,u_edge_radius:y,u_width_scale:b,u_flood_light_color:X,u_vertical_scale:W,u_flood_light_intensity:K,u_ground_shadow_factor:ee};return ve.projection.name==="globe"&&(ye.u_tile_id=[E.canonical.x,E.canonical.y,1<<E.canonical.z],ye.u_zoom_transition=F,ye.u_inv_rot_matrix=j,ye.u_merc_center=N,ye.u_up_dir=ve.projection.upVector(new s.cp(0,0,0),N[0]*s.aj,N[1]*s.aj),ye.u_height_lift=A),ye},c0=(h,n,a,f,g,y)=>({u_matrix:h,u_edge_radius:n,u_width_scale:a,u_vertical_scale:f,u_height_type:Yu[g],u_base_type:Yu[y]}),u0=(h,n,a,f,g,y,b,E,A,R,D,F,N,j,X,W,K,ee)=>{const ie=Kh(h,n,a,f,g,y,b,E,R,D,F,N,j,X,W,K,1,[0,0,0]),fe={u_height_factor:-Math.pow(2,E.overscaledZ)/A.tileSize/8};return s.h(ie,Yh(n,A,ee),fe)},Jc=(h,n,a)=>({u_matrix:h,u_emissive_strength:n,u_ground_shadow_factor:a}),d0=(h,n,a,f,g,y=0)=>s.h(Jc(h,n,g),Yh(a,f,y)),K2=(h,n,a,f)=>({u_matrix:h,u_world:a,u_emissive_strength:n,u_ground_shadow_factor:f}),Q2=(h,n,a,f,g,y,b=0)=>s.h(d0(h,n,a,f,y,b),{u_world:g}),J2=(h,n)=>({u_matrix:h,u_ground_shadow_factor:n}),em=(h,n,a,f,g)=>({u_matrix:h,u_camera_pos:[n[0],n[1],n[2]],u_depth_bias:a,u_height_scale:f,u_reset_depth:g}),eS=(h,n,a,f)=>{const g=s.aj/a.tileSize;return{u_matrix:h,u_camera_to_center_distance:n.getCameraToCenterDistance(f),u_extrude_scale:[n.pixelsToGLUnits[0]/g,n.pixelsToGLUnits[1]/g]}},tm=(h,n,a=1)=>({u_matrix:h,u_color:n,u_overlay:0,u_overlay_scale:a}),V_=s.bz(),h0=(h,n,a,f,g,y,b)=>{const E=h.transform,A=E.projection.name==="globe",R=A?s.dA(E.zoom,n.canonical)*E._pixelsPerMercatorPixel:s.aw(a,1,y),D={u_matrix:n.projMatrix,u_extrude_scale:R,u_intensity:b,u_inv_rot_matrix:V_,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};if(A){D.u_inv_rot_matrix=f,D.u_merc_center=g,D.u_tile_id=[n.canonical.x,n.canonical.y,1<<n.canonical.z],D.u_zoom_transition=s.ah(E.zoom);const F=g[0]*s.aj,N=g[1]*s.aj;D.u_up_dir=E.projection.upVector(new s.cp(0,0,0),F,N)}return D};function eu(h,[n,a,f,g],[y,b]){if(y===b)return[0,0,0,0];const E=255*(h-1)/(h*(b-y));return[n*E,a*E,f*E,g*E]}function U_(h,n,[a,f]){return a===f?0:.5/h+(n-a)*(h-1)/(h*(f-a))}const $_=(h,n,a,f,g,y,b,E,A,R,D,F,N,j,X,W,K,ee,ie,fe,_e)=>({u_matrix:h,u_normalize_matrix:n,u_globe_matrix:a,u_merc_matrix:f,u_grid_matrix:g,u_tl_parent:y,u_scale_parent:R,u_fade_t:D.mix,u_opacity:D.opacity*F.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:F.paint.get("raster-brightness-min"),u_brightness_high:F.paint.get("raster-brightness-max"),u_saturation_factor:s.dC(F.paint.get("raster-saturation")),u_contrast_factor:s.dB(F.paint.get("raster-contrast")),u_spin_weights:f0(F.paint.get("raster-hue-rotate")),u_perspective_transform:N,u_raster_elevation:j,u_zoom_transition:b,u_merc_center:E,u_cutoff_params:A,u_colorization_mix:eu(s.dD,W,ee),u_colorization_offset:U_(s.dD,K,ee),u_color_ramp:X,u_texture_offset:[fe/(ie+2*fe),ie/(ie+2*fe)],u_texture_res:[ie+2*fe,ie+2*fe],u_emissive_strength:_e});function f0(h){h*=Math.PI/180;const n=Math.sin(h),a=Math.cos(h);return[(2*a+1)/3,(-Math.sqrt(3)*n-a+1)/3,(Math.sqrt(3)*n-a+1)/3]}const tc=.05,tu=(h,n,a,f,g,y,b,E,A,R,D,F)=>({u_matrix:h,u_normalize_matrix:n,u_globe_matrix:a,u_merc_matrix:f,u_grid_matrix:g,u_tl_parent:y,u_scale_parent:R,u_fade_t:D.mix,u_opacity:D.opacity,u_image0:0,u_image1:1,u_raster_elevation:F,u_zoom_transition:b,u_merc_center:E,u_cutoff_params:A}),p0=(h,n,a,f,g,y,b,E,A,R)=>({u_particle_texture:h,u_particle_texture_side_len:n,u_tile_offset:a,u_velocity:f,u_color_ramp:y,u_velocity_res:g,u_max_speed:b,u_uv_offset:E,u_data_scale:[255*A[0],255*A[1]],u_data_offset:R,u_particle_pos_scale:1.1,u_particle_pos_offset:[tc,tc]}),nc=(h,n,a,f,g,y,b,E,A,R)=>({u_particle_texture:h,u_particle_texture_side_len:n,u_velocity:a,u_velocity_res:f,u_max_speed:g,u_speed_factor:y,u_reset_rate:b,u_rand_seed:Math.random(),u_uv_offset:E,u_data_scale:[255*A[0],255*A[1]],u_data_offset:R,u_particle_pos_scale:1.1,u_particle_pos_offset:[tc,tc]}),nm=s.bz(),Qh=(h,n,a,f,g,y,b,E,A,R,D,F,N,j,X,W,K,ee,ie,fe,_e,we,be,ve)=>{const ye=g.transform,Se={u_is_size_zoom_constant:+(h==="constant"||h==="source"),u_is_size_feature_constant:+(h==="constant"||h==="camera"),u_size_t:n?n.uSizeT:0,u_size:n?n.uSize:0,u_camera_to_center_distance:ye.getCameraToCenterDistance(ie),u_rotate_symbol:+a,u_aspect_ratio:ye.width/ye.height,u_fade_change:g.options.fadeDuration?g.symbolFadeChange:1,u_matrix:y,u_label_plane_matrix:b,u_coord_matrix:E,u_is_text:+R,u_elevation_from_sea:A?1:0,u_pitch_with_map:+f,u_texsize:D,u_texsize_icon:F,u_texture:0,u_texture_icon:1,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:nm,u_merc_center:[0,0],u_camera_forward:[0,0,0],u_ecef_origin:[0,0,0],u_tile_matrix:nm,u_up_vector:[0,-1,0],u_color_adj_mat:we,u_icon_transition:be||0,u_gamma_scale:f?g.transform.getCameraToCenterDistance(ie)*Math.cos(g.terrain?0:g.transform._pitch):1,u_device_pixel_ratio:s.q.devicePixelRatio,u_is_halo:1,u_scale_factor:ve||1,u_ground_shadow_factor:fe,u_inv_matrix:s.bi(s.bz(),b),u_normal_scale:_e};return ie.name==="globe"&&(Se.u_tile_id=[j.canonical.x,j.canonical.y,1<<j.canonical.z],Se.u_zoom_transition=X,Se.u_inv_rot_matrix=K,Se.u_merc_center=W,Se.u_camera_forward=ye._camera.forward(),Se.u_ecef_origin=s.dE(ye.globeMatrix,j.toUnwrapped()),Se.u_tile_matrix=Float32Array.from(ye.globeMatrix),Se.u_up_vector=ee),Se},G_=(h,n,a,f)=>({u_matrix:h,u_emissive_strength:n,u_opacity:a,u_color:f}),H_=(h,n,a,f,g,y,b,E,A)=>s.h(function(R,D,F,N,j,X){const{width:W,height:K}=N.imageManager.getPixelSize(D),ee=Math.pow(2,X.tileID.overscaledZ),ie=X.tileSize*Math.pow(2,N.transform.tileZoom)/ee,fe=ie*(X.tileID.canonical.x+X.tileID.wrap*ee),_e=ie*X.tileID.canonical.y;return{u_image:0,u_pattern_tl:F.tl,u_pattern_br:F.br,u_texsize:[W,K],u_pattern_size:F.displaySize,u_pattern_units_to_pixels:j?[N.transform.width,-1*N.transform.height]:[1/s.aw(X,1,N.transform.tileZoom),1/s.aw(X,1,N.transform.tileZoom)],u_pixel_coord_upper:[fe>>16,_e>>16],u_pixel_coord_lower:[65535&fe,65535&_e]}}(0,y,b,f,E,A),{u_matrix:h,u_emissive_strength:n,u_opacity:a}),Jh=new Float32Array(s.bx([])),ef=(h,n,a,f,g,y,b,E,A,R,D,F,N,j=[0,0,0],X)=>{const W=g.style.light,K=W.properties.get("position"),ee=[-K.x,-K.y,K.z],ie=s.dx();W.properties.get("anchor")==="viewport"&&(s.dy(ie,-g.transform.angle),s.dz(ee,ee,ie));const fe=D.alphaMode==="MASK",_e=W.properties.get("color").toNonPremultipliedRenderColor(null),we=N.paint.get("model-ambient-occlusion-intensity"),be=N.paint.get("model-color").constantOr(s.am.white).toNonPremultipliedRenderColor(null);return be.a=N.paint.get("model-color-mix-intensity").constantOr(0),{u_matrix:h,u_lighting_matrix:n,u_normal_matrix:a,u_node_matrix:f||Jh,u_lightpos:ee,u_lightintensity:W.properties.get("intensity"),u_lightcolor:[_e.r,_e.g,_e.b],u_camera_pos:j,u_opacity:y,u_baseTextureIsAlpha:0,u_alphaMask:+fe,u_alphaCutoff:D.alphaCutoff,u_baseColorFactor:b.toNonPremultipliedRenderColor(null).toArray01(),u_emissiveFactor:E.toNonPremultipliedRenderColor(null).toArray01(),u_metallicFactor:A,u_roughnessFactor:R,u_baseColorTexture:Ks.BaseColor,u_metallicRoughnessTexture:Ks.MetallicRoughness,u_normalTexture:Ks.Normal,u_occlusionTexture:Ks.Occlusion,u_emissionTexture:Ks.Emission,u_lutTexture:Ks.LUT,u_color_mix:be.toArray01(),u_aoIntensity:we,u_emissive_strength:F,u_occlusionTextureTransform:X||[0,0,0,0]}},m0=(h,n=Jh,a=Jh)=>({u_matrix:h,u_instance:n,u_node_matrix:a}),g0={fillExtrusion:h=>({u_matrix:new s.cc(h),u_lightpos:new s.c9(h),u_lightintensity:new s.ca(h),u_lightcolor:new s.c9(h),u_vertical_gradient:new s.ca(h),u_opacity:new s.ca(h),u_edge_radius:new s.ca(h),u_width_scale:new s.ca(h),u_ao:new s.cb(h),u_height_type:new s.c8(h),u_base_type:new s.c8(h),u_tile_id:new s.c9(h),u_zoom_transition:new s.ca(h),u_inv_rot_matrix:new s.cc(h),u_merc_center:new s.cb(h),u_up_dir:new s.c9(h),u_height_lift:new s.ca(h),u_flood_light_color:new s.c9(h),u_vertical_scale:new s.ca(h),u_flood_light_intensity:new s.ca(h),u_ground_shadow_factor:new s.c9(h)}),fillExtrusionDepth:h=>({u_matrix:new s.cc(h),u_edge_radius:new s.ca(h),u_width_scale:new s.ca(h),u_vertical_scale:new s.ca(h),u_height_type:new s.c8(h),u_base_type:new s.c8(h)}),fillExtrusionPattern:h=>({u_matrix:new s.cc(h),u_lightpos:new s.c9(h),u_lightintensity:new s.ca(h),u_lightcolor:new s.c9(h),u_vertical_gradient:new s.ca(h),u_height_factor:new s.ca(h),u_edge_radius:new s.ca(h),u_width_scale:new s.ca(h),u_ao:new s.cb(h),u_height_type:new s.c8(h),u_base_type:new s.c8(h),u_tile_id:new s.c9(h),u_zoom_transition:new s.ca(h),u_inv_rot_matrix:new s.cc(h),u_merc_center:new s.cb(h),u_up_dir:new s.c9(h),u_height_lift:new s.ca(h),u_image:new s.c8(h),u_texsize:new s.cb(h),u_pixel_coord_upper:new s.cb(h),u_pixel_coord_lower:new s.cb(h),u_tile_units_to_pixels:new s.ca(h),u_opacity:new s.ca(h),u_pattern_transition:new s.ca(h)}),fillExtrusionGroundEffect:h=>({u_matrix:new s.cc(h),u_opacity:new s.ca(h),u_ao_pass:new s.ca(h),u_meter_to_tile:new s.ca(h),u_ao:new s.cb(h),u_flood_light_intensity:new s.ca(h),u_flood_light_color:new s.c9(h),u_attenuation:new s.ca(h),u_edge_radius:new s.ca(h),u_fb:new s.c8(h),u_fb_size:new s.ca(h),u_dynamic_offset:new s.ca(h)}),fill:h=>({u_matrix:new s.cc(h),u_emissive_strength:new s.ca(h),u_ground_shadow_factor:new s.c9(h)}),fillPattern:h=>({u_matrix:new s.cc(h),u_emissive_strength:new s.ca(h),u_image:new s.c8(h),u_texsize:new s.cb(h),u_pixel_coord_upper:new s.cb(h),u_pixel_coord_lower:new s.cb(h),u_tile_units_to_pixels:new s.ca(h),u_ground_shadow_factor:new s.c9(h),u_pattern_transition:new s.ca(h)}),fillOutline:h=>({u_matrix:new s.cc(h),u_emissive_strength:new s.ca(h),u_world:new s.cb(h),u_ground_shadow_factor:new s.c9(h)}),fillOutlinePattern:h=>({u_matrix:new s.cc(h),u_emissive_strength:new s.ca(h),u_world:new s.cb(h),u_image:new s.c8(h),u_texsize:new s.cb(h),u_pixel_coord_upper:new s.cb(h),u_pixel_coord_lower:new s.cb(h),u_tile_units_to_pixels:new s.ca(h),u_ground_shadow_factor:new s.c9(h),u_pattern_transition:new s.ca(h)}),building:h=>({u_matrix:new s.cc(h),u_normal_matrix:new s.cc(h),u_opacity:new s.ca(h)}),buildingDepth:h=>({u_matrix:new s.cc(h)}),elevatedStructuresDepth:h=>({u_matrix:new s.cc(h),u_depth_bias:new s.ca(h)}),elevatedStructures:h=>({u_matrix:new s.cc(h),u_ground_shadow_factor:new s.c9(h)}),elevatedStructuresDepthReconstruct:h=>({u_matrix:new s.cc(h),u_camera_pos:new s.c9(h),u_depth_bias:new s.ca(h),u_height_scale:new s.ca(h),u_reset_depth:new s.ca(h)}),circle:s.dH,collisionBox:h=>({u_matrix:new s.cc(h),u_camera_to_center_distance:new s.ca(h),u_extrude_scale:new s.cb(h)}),collisionCircle:h=>({u_matrix:new s.cc(h),u_inv_matrix:new s.cc(h),u_camera_to_center_distance:new s.ca(h),u_viewport_size:new s.cb(h)}),debug:h=>({u_color:new s.di(h),u_matrix:new s.cc(h),u_overlay:new s.c8(h),u_overlay_scale:new s.ca(h)}),clippingMask:h=>({u_matrix:new s.cc(h)}),heatmap:h=>({u_extrude_scale:new s.ca(h),u_intensity:new s.ca(h),u_matrix:new s.cc(h),u_inv_rot_matrix:new s.cc(h),u_merc_center:new s.cb(h),u_tile_id:new s.c9(h),u_zoom_transition:new s.ca(h),u_up_dir:new s.c9(h)}),heatmapTexture:h=>({u_image:new s.c8(h),u_color_ramp:new s.c8(h),u_opacity:new s.ca(h)}),hillshade:h=>({u_matrix:new s.cc(h),u_image:new s.c8(h),u_latrange:new s.cb(h),u_light:new s.cb(h),u_shadow:new s.di(h),u_highlight:new s.di(h),u_emissive_strength:new s.ca(h),u_accent:new s.di(h)}),hillshadePrepare:h=>({u_matrix:new s.cc(h),u_image:new s.c8(h),u_dimension:new s.cb(h),u_zoom:new s.ca(h)}),line:s.dG,linePattern:s.dF,raster:h=>({u_matrix:new s.cc(h),u_normalize_matrix:new s.cc(h),u_globe_matrix:new s.cc(h),u_merc_matrix:new s.cc(h),u_grid_matrix:new s.dj(h),u_tl_parent:new s.cb(h),u_scale_parent:new s.ca(h),u_fade_t:new s.ca(h),u_opacity:new s.ca(h),u_image0:new s.c8(h),u_image1:new s.c8(h),u_brightness_low:new s.ca(h),u_brightness_high:new s.ca(h),u_saturation_factor:new s.ca(h),u_contrast_factor:new s.ca(h),u_spin_weights:new s.c9(h),u_perspective_transform:new s.cb(h),u_raster_elevation:new s.ca(h),u_zoom_transition:new s.ca(h),u_merc_center:new s.cb(h),u_cutoff_params:new s.cQ(h),u_colorization_mix:new s.cQ(h),u_colorization_offset:new s.ca(h),u_color_ramp:new s.c8(h),u_texture_offset:new s.cb(h),u_texture_res:new s.cb(h),u_emissive_strength:new s.ca(h)}),rasterParticle:h=>({u_matrix:new s.cc(h),u_normalize_matrix:new s.cc(h),u_globe_matrix:new s.cc(h),u_merc_matrix:new s.cc(h),u_grid_matrix:new s.dj(h),u_tl_parent:new s.cb(h),u_scale_parent:new s.ca(h),u_fade_t:new s.ca(h),u_opacity:new s.ca(h),u_image0:new s.c8(h),u_image1:new s.c8(h),u_raster_elevation:new s.ca(h),u_zoom_transition:new s.ca(h),u_merc_center:new s.cb(h),u_cutoff_params:new s.cQ(h)}),rasterParticleTexture:h=>({u_texture:new s.c8(h),u_opacity:new s.ca(h)}),rasterParticleDraw:h=>({u_particle_texture:new s.c8(h),u_particle_texture_side_len:new s.ca(h),u_tile_offset:new s.cb(h),u_velocity:new s.c8(h),u_color_ramp:new s.c8(h),u_velocity_res:new s.cb(h),u_max_speed:new s.ca(h),u_uv_offset:new s.cb(h),u_data_scale:new s.cb(h),u_data_offset:new s.ca(h),u_particle_pos_scale:new s.ca(h),u_particle_pos_offset:new s.cb(h)}),rasterParticleUpdate:h=>({u_particle_texture:new s.c8(h),u_particle_texture_side_len:new s.ca(h),u_velocity:new s.c8(h),u_velocity_res:new s.cb(h),u_max_speed:new s.ca(h),u_speed_factor:new s.ca(h),u_reset_rate:new s.ca(h),u_rand_seed:new s.ca(h),u_uv_offset:new s.cb(h),u_data_scale:new s.cb(h),u_data_offset:new s.ca(h),u_particle_pos_scale:new s.ca(h),u_particle_pos_offset:new s.cb(h)}),symbol:h=>({u_is_size_zoom_constant:new s.c8(h),u_is_size_feature_constant:new s.c8(h),u_size_t:new s.ca(h),u_size:new s.ca(h),u_camera_to_center_distance:new s.ca(h),u_rotate_symbol:new s.c8(h),u_aspect_ratio:new s.ca(h),u_fade_change:new s.ca(h),u_matrix:new s.cc(h),u_label_plane_matrix:new s.cc(h),u_coord_matrix:new s.cc(h),u_is_text:new s.c8(h),u_elevation_from_sea:new s.c8(h),u_pitch_with_map:new s.c8(h),u_texsize:new s.cb(h),u_texsize_icon:new s.cb(h),u_texture:new s.c8(h),u_texture_icon:new s.c8(h),u_gamma_scale:new s.ca(h),u_device_pixel_ratio:new s.ca(h),u_tile_id:new s.c9(h),u_zoom_transition:new s.ca(h),u_inv_rot_matrix:new s.cc(h),u_merc_center:new s.cb(h),u_camera_forward:new s.c9(h),u_tile_matrix:new s.cc(h),u_up_vector:new s.c9(h),u_ecef_origin:new s.c9(h),u_is_halo:new s.c8(h),u_icon_transition:new s.ca(h),u_color_adj_mat:new s.cc(h),u_scale_factor:new s.ca(h),u_ground_shadow_factor:new s.c9(h),u_inv_matrix:new s.cc(h),u_normal_scale:new s.ca(h)}),background:h=>({u_matrix:new s.cc(h),u_emissive_strength:new s.ca(h),u_opacity:new s.ca(h),u_color:new s.di(h)}),backgroundPattern:h=>({u_matrix:new s.cc(h),u_emissive_strength:new s.ca(h),u_opacity:new s.ca(h),u_image:new s.c8(h),u_pattern_tl:new s.cb(h),u_pattern_br:new s.cb(h),u_texsize:new s.cb(h),u_pattern_size:new s.cb(h),u_pixel_coord_upper:new s.cb(h),u_pixel_coord_lower:new s.cb(h),u_pattern_units_to_pixels:new s.cb(h)}),terrainRaster:h=>({u_matrix:new s.cc(h),u_image0:new s.c8(h),u_skirt_height:new s.ca(h),u_ground_shadow_factor:new s.c9(h)}),skybox:h=>({u_matrix:new s.cc(h),u_sun_direction:new s.c9(h),u_cubemap:new s.c8(h),u_opacity:new s.ca(h),u_temporal_offset:new s.ca(h)}),skyboxGradient:h=>({u_matrix:new s.cc(h),u_color_ramp:new s.c8(h),u_center_direction:new s.c9(h),u_radius:new s.ca(h),u_opacity:new s.ca(h),u_temporal_offset:new s.ca(h)}),skyboxCapture:h=>({u_matrix_3f:new s.dj(h),u_sun_direction:new s.c9(h),u_sun_intensity:new s.ca(h),u_color_tint_r:new s.cQ(h),u_color_tint_m:new s.cQ(h),u_luminance:new s.ca(h)}),globeRaster:h=>({u_proj_matrix:new s.cc(h),u_globe_matrix:new s.cc(h),u_normalize_matrix:new s.cc(h),u_merc_matrix:new s.cc(h),u_zoom_transition:new s.ca(h),u_merc_center:new s.cb(h),u_image0:new s.c8(h),u_grid_matrix:new s.dj(h),u_skirt_height:new s.ca(h),u_far_z_cutoff:new s.ca(h),u_frustum_tl:new s.c9(h),u_frustum_tr:new s.c9(h),u_frustum_br:new s.c9(h),u_frustum_bl:new s.c9(h),u_globe_pos:new s.c9(h),u_globe_radius:new s.ca(h),u_viewport:new s.cb(h)}),globeAtmosphere:h=>({u_frustum_tl:new s.c9(h),u_frustum_tr:new s.c9(h),u_frustum_br:new s.c9(h),u_frustum_bl:new s.c9(h),u_horizon:new s.ca(h),u_transition:new s.ca(h),u_fadeout_range:new s.ca(h),u_color:new s.cQ(h),u_high_color:new s.cQ(h),u_space_color:new s.cQ(h),u_temporal_offset:new s.ca(h),u_horizon_angle:new s.ca(h)}),model:h=>({u_matrix:new s.cc(h),u_lighting_matrix:new s.cc(h),u_normal_matrix:new s.cc(h),u_node_matrix:new s.cc(h),u_lightpos:new s.c9(h),u_lightintensity:new s.ca(h),u_lightcolor:new s.c9(h),u_camera_pos:new s.c9(h),u_opacity:new s.ca(h),u_baseColorFactor:new s.cQ(h),u_emissiveFactor:new s.cQ(h),u_metallicFactor:new s.ca(h),u_roughnessFactor:new s.ca(h),u_baseTextureIsAlpha:new s.c8(h),u_alphaMask:new s.c8(h),u_alphaCutoff:new s.ca(h),u_baseColorTexture:new s.c8(h),u_metallicRoughnessTexture:new s.c8(h),u_normalTexture:new s.c8(h),u_occlusionTexture:new s.c8(h),u_emissionTexture:new s.c8(h),u_lutTexture:new s.c8(h),u_color_mix:new s.cQ(h),u_aoIntensity:new s.ca(h),u_emissive_strength:new s.ca(h),u_occlusionTextureTransform:new s.cQ(h)}),modelDepth:h=>({u_matrix:new s.cc(h),u_instance:new s.cc(h),u_node_matrix:new s.cc(h)}),groundShadow:h=>({u_matrix:new s.cc(h),u_ground_shadow_factor:new s.c9(h)}),stars:h=>({u_matrix:new s.cc(h),u_up:new s.c9(h),u_right:new s.c9(h),u_intensity_multiplier:new s.ca(h)}),snowParticle:h=>({u_modelview:new s.cc(h),u_projection:new s.cc(h),u_time:new s.ca(h),u_cam_pos:new s.c9(h),u_velocityConeAperture:new s.ca(h),u_velocity:new s.ca(h),u_horizontalOscillationRadius:new s.ca(h),u_horizontalOscillationRate:new s.ca(h),u_boxSize:new s.ca(h),u_billboardSize:new s.ca(h),u_simpleShapeParameters:new s.cb(h),u_screenSize:new s.cb(h),u_thinningCenterPos:new s.cb(h),u_thinningShape:new s.c9(h),u_thinningAffectedRatio:new s.ca(h),u_thinningParticleOffset:new s.ca(h),u_particleColor:new s.cQ(h),u_direction:new s.c9(h)}),rainParticle:h=>({u_modelview:new s.cc(h),u_projection:new s.cc(h),u_time:new s.ca(h),u_cam_pos:new s.c9(h),u_texScreen:new s.c8(h),u_velocityConeAperture:new s.ca(h),u_velocity:new s.ca(h),u_boxSize:new s.ca(h),u_rainDropletSize:new s.cb(h),u_distortionStrength:new s.ca(h),u_rainDirection:new s.c9(h),u_color:new s.cQ(h),u_screenSize:new s.cb(h),u_thinningCenterPos:new s.cb(h),u_thinningShape:new s.c9(h),u_thinningAffectedRatio:new s.ca(h),u_thinningParticleOffset:new s.ca(h),u_shapeDirectionalPower:new s.ca(h),u_shapeNormalPower:new s.ca(h),u_mode:new s.ca(h)}),vignette:h=>({u_vignetteShape:new s.c9(h),u_vignetteColor:new s.cQ(h)}),occlusion:h=>({u_matrix:new s.cc(h),u_anchorPos:new s.c9(h),u_screenSizePx:new s.cb(h),u_occluderSizePx:new s.cb(h),u_color:new s.cQ(h)})};class ta{constructor(n,a,f,g){this.id=ta.uniqueIdxCounter,ta.uniqueIdxCounter++,this.context=n;const y=n.gl;this.buffer=y.createBuffer(),this.dynamicDraw=!!f,this.context.unbindVAO(),n.bindElementBuffer.set(this.buffer),y.bufferData(y.ELEMENT_ARRAY_BUFFER,a.arrayBuffer,this.dynamicDraw?y.DYNAMIC_DRAW:y.STATIC_DRAW),this.dynamicDraw||g||a.destroy()}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(n){this.id=ta.uniqueIdxCounter,ta.uniqueIdxCounter++;const a=this.context.gl;this.context.unbindVAO(),this.bind(),a.bufferSubData(a.ELEMENT_ARRAY_BUFFER,0,n.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}ta.uniqueIdxCounter=0;const tS={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class nS{constructor(n,a,f,g,y,b){this.length=a.length,this.attributes=f,this.itemSize=a.bytesPerElement,this.dynamicDraw=g,this.instanceCount=b,this.context=n;const E=n.gl;this.buffer=E.createBuffer(),n.bindVertexBuffer.set(this.buffer),E.bufferData(E.ARRAY_BUFFER,a.arrayBuffer,this.dynamicDraw?E.DYNAMIC_DRAW:E.STATIC_DRAW),this.dynamicDraw||y||a.destroy()}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(n){const a=this.context.gl;this.bind(),a.bufferSubData(a.ARRAY_BUFFER,0,n.arrayBuffer)}enableAttributes(n,a){for(let f=0;f<this.attributes.length;f++){const g=a.attributes[this.attributes[f].name];g!==void 0&&n.enableVertexAttribArray(g)}}setVertexAttribPointers(n,a,f){for(let g=0;g<this.attributes.length;g++){const y=this.attributes[g],b=a.attributes[y.name];b!==void 0&&n.vertexAttribPointer(b,y.components,n[tS[y.type]],!1,this.itemSize,y.offset+this.itemSize*(f||0))}}setVertexAttribDivisor(n,a,f){for(let g=0;g<this.attributes.length;g++){const y=a.attributes[this.attributes[g].name];y!==void 0&&this.instanceCount&&this.instanceCount>0&&n.vertexAttribDivisor(y,f)}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class q_{constructor(n,a,f,g,y){this.context=n,this.width=a,this.height=f;const b=this.framebuffer=n.gl.createFramebuffer();g&&(this.colorAttachment=new o0(n,b)),y&&(this.depthAttachmentType=y,this.depthAttachment=y==="renderbuffer"?new a0(n,b):new Z2(n,b))}destroy(){const n=this.context.gl;if(this.colorAttachment){const a=this.colorAttachment.get();a&&n.deleteTexture(a)}if(this.depthAttachment&&this.depthAttachmentType)if(this.depthAttachmentType==="renderbuffer"){const a=this.depthAttachment.get();a&&n.deleteRenderbuffer(a)}else{const a=this.depthAttachment.get();a&&n.deleteTexture(a)}n.deleteFramebuffer(this.framebuffer)}}class rS{constructor(n,a){this.gl=n,this.clearColor=new Qx(this),this.clearDepth=new M_(this),this.clearStencil=new U2(this),this.colorMask=new $2(this),this.depthMask=new G2(this),this.stencilMask=new H2(this),this.stencilFunc=new Jx(this),this.stencilOp=new q2(this),this.stencilTest=new Up(this),this.depthRange=new W2(this),this.depthTest=new e0(this),this.depthFunc=new R_(this),this.blend=new $p(this),this.blendFunc=new k_(this),this.blendColor=new Yc(this),this.blendEquation=new Wu(this),this.cullFace=new Gp(this),this.cullFaceSide=new Hp(this),this.frontFace=new Zu(this),this.program=new t0(this),this.activeTexture=new D_(this),this.viewport=new n0(this),this.bindFramebuffer=new Xu(this),this.bindRenderbuffer=new qp(this),this.bindTexture=new Wp(this),this.bindVertexBuffer=new L_(this),this.bindElementBuffer=new Zp(this),this.bindVertexArrayOES=new Zh(this),this.pixelStoreUnpack=new r0(this),this.pixelStoreUnpackPremultiplyAlpha=new i0(this),this.pixelStoreUnpackFlipY=new s0(this),this.options=a?Object.assign({},a):{},this.options.extTextureFilterAnisotropicForceOff||(this.extTextureFilterAnisotropic=n.getExtension("EXT_texture_filter_anisotropic")||n.getExtension("MOZ_EXT_texture_filter_anisotropic")||n.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=n.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT))),this.extDebugRendererInfo=n.getExtension("WEBGL_debug_renderer_info"),this.extDebugRendererInfo&&(this.renderer=n.getParameter(this.extDebugRendererInfo.UNMASKED_RENDERER_WEBGL),this.vendor=n.getParameter(this.extDebugRendererInfo.UNMASKED_VENDOR_WEBGL)),this.forceManualRenderingForInstanceIDShaders=a&&!!a.forceManualRenderingForInstanceIDShaders||this.renderer&&this.renderer.indexOf("PowerVR")!==-1,this.options.extTextureFloatLinearForceOff||(this.extTextureFloatLinear=n.getExtension("OES_texture_float_linear")),this.extRenderToTextureHalfFloat=n.getExtension("EXT_color_buffer_half_float"),this.extTimerQuery=n.getExtension("EXT_disjoint_timer_query_webgl2"),this.maxTextureSize=n.getParameter(n.MAX_TEXTURE_SIZE),this.maxPointSize=n.getParameter(n.ALIASED_POINT_SIZE_RANGE)[1]}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArrayOES.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(n,a,f){return new ta(this,n,a,f)}createVertexBuffer(n,a,f,g,y){return new nS(this,n,a,f,g,y)}createRenderbuffer(n,a,f){const g=this.gl,y=g.createRenderbuffer();return this.bindRenderbuffer.set(y),g.renderbufferStorage(g.RENDERBUFFER,n,a,f),this.bindRenderbuffer.set(null),y}createFramebuffer(n,a,f,g){return new q_(this,n,a,f,g)}clear({color:n,depth:a,stencil:f,colorMask:g}){const y=this.gl;let b=0;n&&(b|=y.COLOR_BUFFER_BIT,this.clearColor.set(n.toNonPremultipliedRenderColor(null)),this.colorMask.set(g||[!0,!0,!0,!0])),a!==void 0&&(b|=y.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(a),this.depthMask.set(!0)),f!==void 0&&(b|=y.STENCIL_BUFFER_BIT,this.clearStencil.set(f),this.stencilMask.set(255)),y.clear(b)}setCullFace(n){n.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(n.mode),this.frontFace.set(n.frontFace))}setDepthMode(n){n.func!==this.gl.ALWAYS||n.mask?(this.depthTest.set(!0),this.depthFunc.set(n.func),this.depthMask.set(n.mask),this.depthRange.set(n.range)):this.depthTest.set(!1)}setStencilMode(n){n.test.func!==this.gl.ALWAYS||n.mask?(this.stencilTest.set(!0),this.stencilMask.set(n.mask),this.stencilOp.set([n.fail,n.depthFail,n.pass]),this.stencilFunc.set({func:n.test.func,ref:n.ref,mask:n.test.mask})):this.stencilTest.set(!1)}setColorMode(n){s.bv(n.blendFunction,Zn.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(n.blendFunction),this.blendColor.set(n.blendColor),n.blendEquation?this.blendEquation.set(n.blendEquation):this.blendEquation.setDefault()),this.colorMask.set(n.mask)}unbindVAO(){this.bindVertexArrayOES.set(null)}}let Ku;function rm(h,n,a,f,g,y,b){const E=h.context,A=E.gl,R=h.transform,D=h.getOrCreateProgram("collisionBox"),F=[];let N=0,j=0;for(let _e=0;_e<f.length;_e++){const we=f[_e],be=n.getTile(we),ve=be.getBucket(a);if(!ve)continue;const ye=vn(we,ve,R);let Se=ye;g[0]===0&&g[1]===0||(Se=h.translatePosMatrix(ye,be,g,y));const Ee=b?ve.textCollisionBox:ve.iconCollisionBox,Fe=ve.collisionCircleArray;if(Fe.length>0){const je=s.bz(),rt=Se;s.cB(je,ve.placementInvProjMatrix,R.glCoordMatrix),s.cB(je,je,ve.placementViewportMatrix),F.push({circleArray:Fe,circleOffset:j,transform:rt,invTransform:je,projection:ve.getProjection()}),N+=Fe.length/4,j=N}Ee&&(h.terrain&&h.terrain.setupElevationDraw(be,D),D.draw(h,A.LINES,Gt.disabled,En.disabled,h.colorModeForRenderPass(),_n.disabled,eS(Se,R,be,ve.getProjection()),a.id,Ee.layoutVertexBuffer,Ee.indexBuffer,Ee.segments,null,R.zoom,null,[Ee.collisionVertexBuffer,Ee.collisionVertexBufferExt]))}if(!b||!F.length)return;const X=h.getOrCreateProgram("collisionCircle"),W=new s.dI;W.resize(4*N),W._trim();let K=0;for(const _e of F)for(let we=0;we<_e.circleArray.length/4;we++){const be=4*we,ve=_e.circleArray[be+0],ye=_e.circleArray[be+1],Se=_e.circleArray[be+2],Ee=_e.circleArray[be+3];W.emplace(K++,ve,ye,Se,Ee,0),W.emplace(K++,ve,ye,Se,Ee,1),W.emplace(K++,ve,ye,Se,Ee,2),W.emplace(K++,ve,ye,Se,Ee,3)}(!Ku||Ku.length<2*N)&&(Ku=function(_e){const we=2*_e,be=new s.a_;be.resize(we),be._trim();for(let ve=0;ve<we;ve++){const ye=6*ve;be.uint16[ye+0]=4*ve+0,be.uint16[ye+1]=4*ve+1,be.uint16[ye+2]=4*ve+2,be.uint16[ye+3]=4*ve+2,be.uint16[ye+4]=4*ve+3,be.uint16[ye+5]=4*ve+0}return be}(N));const ee=E.createIndexBuffer(Ku,!0),ie=E.createVertexBuffer(W,s.dJ.members,!0);for(const _e of F){const we={u_matrix:_e.transform,u_inv_matrix:_e.invTransform,u_camera_to_center_distance:(fe=R).getCameraToCenterDistance(_e.projection),u_viewport_size:[fe.width,fe.height]};X.draw(h,A.TRIANGLES,Gt.disabled,En.disabled,h.colorModeForRenderPass(),_n.disabled,we,a.id,ie,ee,s.bd.simpleSegment(0,2*_e.circleOffset,_e.circleArray.length,_e.circleArray.length/2),null,R.zoom)}var fe;ie.destroy(),ee.destroy()}const ul=s.bz();function tf(h){const n=h._camera.getWorldToCamera(h.worldSize,1),a=s.az([],n,h.globeMatrix);s.bi(a,a);const f=[0,0,0],g=[0,1,0,0];return s.aA(g,g,a),f[0]=g[0],f[1]=g[1],f[2]=g[2],s.au(f,f),f}function nf({width:h,height:n,anchor:a,textOffset:f,textScale:g},y){const{horizontalAlign:b,verticalAlign:E}=s.bT(a),A=-(b-.5)*h,R=-(E-.5)*n,D=s.bU(a,f);return new s.P((A/g+D[0])*y,(R/g+D[1])*y)}function _0(h,n,a,f,g,y,b,E,A,R){const D=h.text.placedSymbolArray,F=h.text.dynamicLayoutVertexArray,N=h.icon.dynamicLayoutVertexArray,j={},X=h.getProjection(),W=kp(b,X,g),K=g.elevation,ee=X.upVectorScale(b.canonical,g.center.lat,g.worldSize).metersToTile;F.clear();for(let ie=0;ie<D.length;ie++){const fe=D.get(ie),{tileAnchorX:_e,tileAnchorY:we,numGlyphs:be}=fe,ve=fe.hidden||!fe.crossTileID||h.allowVerticalPlacement&&!fe.placedOrientation?null:f[fe.crossTileID];if(ve){let ye=0,Se=0,Ee=0;if(K){const ot=K?K.getAtTileOffset(b,_e,we):0,[Ge,dt,At]=X.upVector(b.canonical,_e,we);ye=ot*Ge*ee,Se=ot*dt*ee,Ee=ot*At*ee}let[Fe,je,rt,it]=ga(fe.projectedAnchorX+ye,fe.projectedAnchorY+Se,fe.projectedAnchorZ+Ee,a?W:y);const gt=zh(g.getCameraToCenterDistance(X),it);let ze=s.bJ(h.textSizeData,A,fe)*gt/s.bO;a&&(ze*=h.tilePixelRatio/E);const Xe=nf(ve,ze);a?({x:Fe,y:je,z:rt}=X.projectTilePoint(_e+Xe.x,we+Xe.y,b.canonical),[Fe,je,rt]=ga(Fe+ye,je+Se,rt+Ee,y)):(n&&Xe._rotate(-g.angle),Fe+=Xe.x,je+=Xe.y,rt=0);const Re=h.allowVerticalPlacement&&fe.placedOrientation===s.bI.vertical?Math.PI/2:0;for(let ot=0;ot<be;ot++)s.bL(F,Fe,je,rt,Re);R&&fe.associatedIconIndex>=0&&(j[fe.associatedIconIndex]={x:Fe,y:je,z:rt,angle:Re})}else Hc(be,F)}if(R){N.clear();const ie=h.icon.placedSymbolArray;for(let fe=0;fe<ie.length;fe++){const _e=ie.get(fe),{numGlyphs:we}=_e,be=j[fe];if(_e.hidden||!be)Hc(we,N);else{const{x:ve,y:ye,z:Se,angle:Ee}=be;for(let Fe=0;Fe<we;Fe++)s.bL(N,ve,ye,Se,Ee)}}h.icon.dynamicLayoutVertexBuffer.updateData(N)}h.text.dynamicLayoutVertexBuffer.updateData(F)}function Qu(h,n,a,f,g,y,b={}){const E=a.paint.get("icon-translate"),A=a.paint.get("text-translate"),R=a.paint.get("icon-translate-anchor"),D=a.paint.get("text-translate-anchor"),F=a.layout.get("icon-rotation-alignment"),N=a.layout.get("text-rotation-alignment"),j=a.layout.get("icon-pitch-alignment"),X=a.layout.get("text-pitch-alignment"),W=a.layout.get("icon-keep-upright"),K=a.layout.get("text-keep-upright"),ee=a.paint.get("icon-color-saturation"),ie=a.paint.get("icon-color-contrast"),fe=a.paint.get("icon-color-brightness-min"),_e=a.paint.get("icon-color-brightness-max"),we=a.layout.get("symbol-elevation-reference")==="sea",be=h.context,ve=be.gl,ye=h.transform,Se=F==="map",Ee=N==="map",Fe=j==="map",je=X==="map",rt=a.layout.get("symbol-sort-key").constantOr(1)!==void 0;let it=!1;const gt=h.depthModeForSublayer(0,Gt.ReadOnly),ze=new Gt(h.context.gl.LEQUAL,Gt.ReadOnly,h.depthRangeFor3D),Xe=[s.aD(ye.center.lng),s.aH(ye.center.lat)],Re=a.layout.get("text-variable-anchor"),ot=ye.projection.name==="globe",Ge=[],dt=[0,-1,0];for(const At of f){const st=n.getTile(At),Tt=st.getBucket(a);if(!Tt||Tt.projection.name==="mercator"&&ot||Tt.fullyClipped)continue;const qt=Tt.projection.name==="globe",Wt=qt?s.ah(ye.zoom):0,Vt=kp(At,Tt.getProjection(),ye),tn=ye.calculatePixelsToTileUnitsMatrix(st),on=Re&&Tt.hasTextData(),cn=Tt.hasIconTextFit()&&on&&Tt.hasIconData(),wn=Tt.getProjection().createInversionMatrix(ye,At.canonical),Bn=(1<<st.tileID.canonical.z)*s.aj/h.transform.worldSize,Ar=Xr=>{let yr=[0,0,0];if(Xr){const Ei=h.style.directionalLight,lr=h.style.ambientLight;Ei&&lr&&(yr=Zc(h.style,Ei,lr))}return yr},Zr=Xr=>{ye.depthOcclusionForSymbolsAndCircles&&(a.hasInitialOcclusionOpacityProperties||h.terrain)&&(Xr.push("DEPTH_D24"),Xr.push("DEPTH_OCCLUSION"))},kr=()=>{const Xr=Se&&a.layout.get("symbol-placement")!=="point",yr=[];Zr(yr);const Ei=Xr||cn,lr=Tt.elevationType==="road"&&Fe,Bi=h.shadowRenderer,ii=lr&&!!Bi&&Bi.enabled,Gr=Ar(ii),si=lr?ze:gt,wr=a.paint.get("icon-image-cross-fade");h.terrainRenderModeElevated()&&Fe&&yr.push("PITCH_WITH_MAP_TERRAIN"),qt&&(yr.push("PROJECTION_GLOBE_VIEW"),Ei&&yr.push("PROJECTED_POS_ON_VIEWPORT")),wr>0&&yr.push("ICON_TRANSITION"),Tt.icon.zOffsetVertexBuffer&&yr.push("Z_OFFSET"),ee===0&&ie===0&&fe===0&&_e===1||yr.push("COLOR_ADJUSTMENT"),Tt.sdfIcons&&yr.push("RENDER_SDF"),ii&&yr.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET"),lr&&Tt.icon.orientationVertexBuffer&&yr.push("ELEVATED_ROADS");const Ii=Tt.icon.programConfigurations.get(a.id),ws=h.getOrCreateProgram("symbol",{config:Ii,defines:yr}),di=st.imageAtlasTexture?st.imageAtlasTexture.size:[0,0],gr=Tt.iconSizeData,wo=s.bH(gr,ye.zoom),lo=Fe||!ye.isOrthographic,Fo=ol(Vt,st.tileID.canonical,Fe,Se,ye,Tt.getProjection(),tn),xa=Pp(Vt,st.tileID.canonical,Fe,Se,ye,Tt.getProjection(),tn),ra=h.translatePosMatrix(xa,st,E,R,!0),co=h.translatePosMatrix(Vt,st,E,R),dc=Ei?ul:Fo,ba=Se&&!Fe&&!Xr;let hc=dt;!ot&&!ye.mercatorFromTransition||Se||(hc=tf(ye));const xf=qt?hc:dt,gy=a.getColorAdjustmentMatrix(ee,ie,fe,_e),hd=Qh(gr.kind,wo,ba,Fe,h,co,dc,ra,we,!1,di,[0,0],0,At,Wt,Xe,wn,xf,Tt.getProjection(),Gr,Bn,gy,wr,null),_y=st.imageAtlasTexture?st.imageAtlasTexture:null,bf=a.layout.get("icon-size").constantOr(0)!==1||Tt.iconsNeedLinear,wm=Tt.sdfIcons||h.options.rotating||h.options.zooming||bf||lo?ve.LINEAR:ve.NEAREST,Sm=Tt.sdfIcons&&a.paint.get("icon-halo-width").constantOr(1)!==0,Ua=h.terrain&&Fe&&Xr?s.bi(s.bz(),Fo):ul;if(Xr&&Tt.icon){const fd=ye.elevation,au=fd?fd.getAtTileOffsetFunc(At,ye.center.lat,ye.worldSize,Tt.getProjection()):null,fc=Ip(Vt,st.tileID.canonical,Fe,Se,ye,Tt.getProjection(),tn);Mp(Tt,Vt,h,!1,fc,xa,Fe,W,au,At)}return{program:ws,buffers:Tt.icon,uniformValues:hd,atlasTexture:_y,atlasTextureIcon:null,atlasInterpolation:wm,atlasInterpolationIcon:null,isSDF:Tt.sdfIcons,hasHalo:Sm,depthMode:si,tile:st,renderWithShadows:ii,labelPlaneMatrixInv:Ua}},zr=()=>{const Xr=Ee&&a.layout.get("symbol-placement")!=="point",yr=[],Ei=Xr||Re||cn,lr=Tt.elevationType==="road"&&je,Bi=h.shadowRenderer,ii=lr&&!!Bi&&Bi.enabled,Gr=Ar(ii),si=lr?ze:gt;h.terrainRenderModeElevated()&&je&&yr.push("PITCH_WITH_MAP_TERRAIN"),qt&&(yr.push("PROJECTION_GLOBE_VIEW"),Ei&&yr.push("PROJECTED_POS_ON_VIEWPORT")),Tt.text.zOffsetVertexBuffer&&yr.push("Z_OFFSET"),Tt.iconsInText&&yr.push("RENDER_TEXT_AND_SYMBOL"),yr.push("RENDER_SDF"),ii&&yr.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET"),lr&&Tt.text.orientationVertexBuffer&&yr.push("ELEVATED_ROADS"),Zr(yr);const wr=Tt.text.programConfigurations.get(a.id),Ii=h.getOrCreateProgram("symbol",{config:wr,defines:yr});let ws,di=[0,0],gr=null;const wo=Tt.textSizeData;Tt.iconsInText&&(di=st.imageAtlasTexture?st.imageAtlasTexture.size:[0,0],gr=st.imageAtlasTexture?st.imageAtlasTexture:null,ws=je||!ye.isOrthographic||h.options.rotating||h.options.zooming||wo.kind==="composite"||wo.kind==="camera"?ve.LINEAR:ve.NEAREST);const lo=st.glyphAtlasTexture?st.glyphAtlasTexture.size:[0,0],Fo=a.layout.get("text-size-scale-range"),xa=s.ay(h.scaleFactor,Fo[0],Fo[1]),ra=s.bH(wo,ye.zoom,xa),co=ol(Vt,st.tileID.canonical,je,Ee,ye,Tt.getProjection(),tn),dc=Pp(Vt,st.tileID.canonical,je,Ee,ye,Tt.getProjection(),tn),ba=h.translatePosMatrix(dc,st,A,D,!0),hc=h.translatePosMatrix(Vt,st,A,D),xf=Ei?ul:co,gy=Ee&&!je&&!Xr;let hd=dt;!ot&&!ye.mercatorFromTransition||Ee||(hd=tf(ye));const _y=Qh(wo.kind,ra,gy,je,h,hc,xf,ba,we,!0,lo,di,0,At,Wt,Xe,wn,qt?hd:dt,Tt.getProjection(),Gr,Bn,null,null,xa),bf=st.glyphAtlasTexture?st.glyphAtlasTexture:null,wm=ve.LINEAR,Sm=a.paint.get("text-halo-width").constantOr(1)!==0,Ua=h.terrain&&je&&Xr?s.bi(s.bz(),co):ul;if(Xr&&Tt.text){const fd=ye.elevation,au=fd?fd.getAtTileOffsetFunc(At,ye.center.lat,ye.worldSize,Tt.getProjection()):null,fc=Ip(Vt,st.tileID.canonical,je,Ee,ye,Tt.getProjection(),tn);Mp(Tt,Vt,h,!0,fc,dc,je,K,au,At)}return{program:Ii,buffers:Tt.text,uniformValues:_y,atlasTexture:bf,atlasTextureIcon:gr,atlasInterpolation:wm,atlasInterpolationIcon:ws,isSDF:!0,hasHalo:Sm,depthMode:si,tile:st,renderWithShadows:ii,labelPlaneMatrixInv:Ua}},Di=Tt.icon.segments.get().length,Dn=Tt.text.segments.get().length,Gn=Di&&!b.onlyText?kr():null,Jn=Dn&&!b.onlyIcons?zr():null,ri=a.paint.get("icon-opacity").constantOr(1),Gi=a.paint.get("text-opacity").constantOr(1);if(rt&&Tt.canOverlap){it=!0;const Xr=ri&&!b.onlyText?Tt.icon.segments.get():[],yr=Gi&&!b.onlyIcons?Tt.text.segments.get():[];for(const Ei of Xr)Ge.push({segments:new s.bd([Ei]),sortKey:Ei.sortKey,state:Gn});for(const Ei of yr)Ge.push({segments:new s.bd([Ei]),sortKey:Ei.sortKey,state:Jn})}else b.onlyText||Ge.push({segments:ri?Tt.icon.segments:new s.bd([]),sortKey:0,state:Gn}),b.onlyIcons||Ge.push({segments:Gi?Tt.text.segments:new s.bd([]),sortKey:0,state:Jn})}it&&Ge.sort((At,st)=>At.sortKey-st.sortKey);for(const At of Ge){const st=At.state;if(st)if(h.terrain?h.terrain.setupElevationDraw(st.tile,st.program,{useDepthForOcclusion:ye.depthOcclusionForSymbolsAndCircles,labelPlaneMatrixInv:st.labelPlaneMatrixInv}):h.setupDepthForOcclusion(ye.depthOcclusionForSymbolsAndCircles,st.program),be.activeTexture.set(ve.TEXTURE0),st.atlasTexture&&st.atlasTexture.bind(st.atlasInterpolation,ve.CLAMP_TO_EDGE,!0),st.atlasTextureIcon&&(be.activeTexture.set(ve.TEXTURE1),st.atlasTextureIcon&&st.atlasTextureIcon.bind(st.atlasInterpolationIcon,ve.CLAMP_TO_EDGE,!0)),st.renderWithShadows&&h.shadowRenderer.setupShadows(st.tile.tileID.toUnwrapped(),st.program,"vector-tile",st.tile.tileID.overscaledZ),h.uploadCommonLightUniforms(h.context,st.program),st.hasHalo){const Tt=st.uniformValues;Tt.u_is_halo=1,Ju(st.buffers,At.segments,a,h,st.program,st.depthMode,g,y,Tt,2),Tt.u_is_halo=0}else{if(st.isSDF){const Tt=st.uniformValues;st.hasHalo&&(Tt.u_is_halo=1,Ju(st.buffers,At.segments,a,h,st.program,st.depthMode,g,y,Tt,1)),Tt.u_is_halo=0}Ju(st.buffers,At.segments,a,h,st.program,st.depthMode,g,y,st.uniformValues,1)}}}function Ju(h,n,a,f,g,y,b,E,A,R){const D=[h.dynamicLayoutVertexBuffer,h.opacityVertexBuffer,h.iconTransitioningVertexBuffer,h.globeExtVertexBuffer,h.zOffsetVertexBuffer,h.orientationVertexBuffer];g.draw(f,f.context.gl.TRIANGLES,y,b,E,_n.disabled,A,a.id,h.layoutVertexBuffer,h.indexBuffer,n,a.paint,f.transform.zoom,h.programConfigurations.get(a.id),D,R)}function im(h,n){const a=1<<h.canonical.z,f=(n.x*a-h.canonical.x-h.wrap*a)*s.aj,g=(n.y*a-h.canonical.y)*s.aj,y=s.dS(n.z,n.y);return s.cS(f,g,y)}function W_(h,n,a,f,g){if(!a.layout||a.layout.get("fill-elevation-reference")==="none")return;const y=h.context.gl,b=new Gt(h.context.gl.LEQUAL,Gt.ReadWrite,h.depthRangeFor3D),E=new Gt(h.context.gl.GREATER,Gt.ReadWrite,h.depthRangeFor3D),A=function(j){const X=s.cJ(j.pitch);let W=.01;return j.isOrthographic&&(W=s.ai(1e-4,W,s.cN(X>=ps?1:X/ps))),2*W}(h.transform),R=h.transform.getFreeCameraOptions().position,D="elevatedStructuresDepthReconstruct",F=h.getOrCreateProgram(D,{defines:["DEPTH_RECONSTRUCTION"]}),N=h.getOrCreateProgram(D);for(const j of f){const X=n.getTile(j),W=X.getBucket(a);if(!W)continue;const K=W.elevatedStructures;if(!K)continue;const ee=W.elevationBufferData.heightRange,ie=im(j.toUnwrapped(),R),fe=h.translatePosMatrix(j.projMatrix,X,a.paint.get("fill-translate"),a.paint.get("fill-translate-anchor"));let _e,we,be,ve;if(g==="initialize"){if(!ee||ee.min>=1||K.depthSegments.segments[0].primitiveLength===0)continue;_e=em(fe,ie,A,1,0),we=b,be=K.depthSegments,ve=F}else if(g==="reset"){if(!ee||ee.min>=0||K.maskSegments.segments[0].primitiveLength===0)continue;_e=em(fe,ie,0,0,1),we=E,be=K.maskSegments,ve=F}else if(g==="geometry"){if(K.depthSegments.segments[0].primitiveLength===0)continue;_e=em(fe,ie,A,1,0),we=b,be=K.depthSegments,ve=N}ve.draw(h,y.TRIANGLES,we,En.disabled,Zn.disabled,_n.disabled,_e,a.id,K.vertexBuffer,K.indexBuffer,be,a.paint,h.transform.zoom)}}function Z_(h,n,a){const{painter:f,sourceCache:g,layer:y,coords:b,colorMode:E,elevationType:A,terrainEnabled:R,pass:D}=h,F=f.context.gl,N=y.paint.get("fill-pattern"),j=y.paint.get("fill-pattern-cross-fade"),X=N.constantOr(null);let W=A;A!=="road"||n&&!R||(W="none");const K=W==="road",ee=h.painter.shadowRenderer,ie=K&&!!ee&&ee.enabled,fe=new Gt(f.context.gl.LEQUAL,Gt.ReadOnly,f.depthRangeFor3D);let _e=[0,0,0];if(ie){const ve=f.style.directionalLight,ye=f.style.ambientLight;ve&&ye&&(_e=Zc(f.style,ve,ye))}const we=N&&N.constantOr(1),be=(ve,ye)=>{let Se,Ee,Fe,je,rt;ye?(Se=we&&!y.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",Fe=F.LINES):(Se=we?"fillPattern":"fill",Fe=F.TRIANGLES);for(const it of b){const gt=g.getTile(it);if(we&&!gt.patternsLoaded())continue;const ze=gt.getBucket(y);if(!ze)continue;const Xe=n?ze.elevationBufferData:ze.bufferData;if(Xe.isEmpty())continue;f.prepareDrawTile();const Re=Xe.programConfigurations.get(y.id),ot=f.isTileAffectedByFog(it),Ge=[],dt=[];K&&(Ge.push("ELEVATED_ROADS"),dt.push(Xe.elevatedLayoutVertexBuffer)),ie&&Ge.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET"),we&&(f.context.activeTexture.set(F.TEXTURE0),gt.imageAtlasTexture&&gt.imageAtlasTexture.bind(F.LINEAR,F.CLAMP_TO_EDGE),Re.updatePaintBuffers());let At=!1;if(X&&gt.imageAtlas){const Vt=gt.imageAtlas,tn=s.dN.from(X),on=tn.getPrimary().scaleSelf(s.q.devicePixelRatio).toString(),cn=tn.getSecondary(),wn=Vt.patternPositions.get(on),Bn=cn?Vt.patternPositions.get(cn.scaleSelf(s.q.devicePixelRatio).toString()):null;At=!!wn&&!!Bn,wn&&Re.setConstantPatternPositions(wn,Bn)}j>0&&(At||Re.getPatternTransitionVertexBuffer("fill-pattern"))&&Ge.push("FILL_PATTERN_TRANSITION");const st=f.getOrCreateProgram(Se,{config:Re,overrideFog:ot,defines:Ge}),Tt=f.translatePosMatrix(it.projMatrix,gt,y.paint.get("fill-translate"),y.paint.get("fill-translate-anchor"));ie&&ee.setupShadows(gt.tileID.toUnwrapped(),st,"vector-tile",gt.tileID.overscaledZ);const qt=y.paint.get("fill-emissive-strength");if(ye){je=Xe.lineIndexBuffer,rt=Xe.lineSegments;const Vt=f.terrain&&f.terrain.renderingToTexture?f.terrain.drapeBufferSize:[F.drawingBufferWidth,F.drawingBufferHeight];Ee=Se==="fillOutlinePattern"&&we?Q2(Tt,qt,f,gt,Vt,_e,j):K2(Tt,qt,Vt,_e)}else je=Xe.indexBuffer,rt=Xe.triangleSegments,Ee=we?d0(Tt,qt,f,gt,_e,j):Jc(Tt,qt,_e);f.uploadCommonUniforms(f.context,st,it.toUnwrapped());let Wt=ve;(A==="road"&&!R||A==="offset")&&(Wt=fe),st.draw(f,Fe,Wt,a||f.stencilModeForClipping(it),E,_n.disabled,Ee,y.id,Xe.layoutVertexBuffer,je,rt,y.paint,f.transform.zoom,Re,dt)}};f.renderPass===D&&be(f.depthModeForSublayer(1,f.renderPass==="opaque"?Gt.ReadWrite:Gt.ReadOnly),!1),W==="none"&&f.renderPass==="translucent"&&y.paint.get("fill-antialias")&&be(f.depthModeForSublayer(y.getPaintProperty("fill-outline-color")?2:0,Gt.ReadOnly),!0)}function dl(h,n,a,f,g,y,b,E){a.resetLayerRenderingStats(h);const A=h.context,R=A.gl,D=h.transform,F=a.paint.get("fill-extrusion-pattern"),N=a.paint.get("fill-extrusion-pattern-cross-fade"),j=F.constantOr(null),X=F.constantOr(1),W=a.paint.get("fill-extrusion-opacity"),K=h.style.enable3dLights(),ee=a.paint.get(K&&!X?"fill-extrusion-ambient-occlusion-wall-radius":"fill-extrusion-ambient-occlusion-radius"),ie=[a.paint.get("fill-extrusion-ambient-occlusion-intensity"),ee],fe=a.layout.get("fill-extrusion-edge-radius"),_e=fe>0&&!a.paint.get("fill-extrusion-rounded-roof"),we=_e?0:fe,be=D.projection.name==="globe"?s.dV():0,ve=D.projection.name==="globe",ye=ve?s.ah(D.zoom):0,Se=[s.aD(D.center.lng),s.aH(D.center.lat)],Ee=a.paint.get("fill-extrusion-flood-light-color-use-theme").constantOr("default")==="none",Fe=a.paint.get("fill-extrusion-flood-light-color").toNonPremultipliedRenderColor(Ee?null:a.lut).toArray01().slice(0,3),je=a.paint.get("fill-extrusion-flood-light-intensity"),rt=a.paint.get("fill-extrusion-vertical-scale"),it=a.paint.get("fill-extrusion-line-width").constantOr(1)!==0,gt=a.paint.get("fill-extrusion-height-alignment"),ze=a.paint.get("fill-extrusion-base-alignment"),Xe=Oa(h,a.paint.get("fill-extrusion-cutoff-fade-range")),Re=[];let ot;ve&&Re.push("PROJECTION_GLOBE_VIEW"),ie[0]>0&&Re.push("FAUX_AO"),_e&&Re.push("ZERO_ROOF_RADIUS"),E&&Re.push("HAS_CENTROID"),je>0&&Re.push("FLOOD_LIGHT"),Xe.shouldRenderCutoff&&Re.push("RENDER_CUTOFF"),it&&Re.push("RENDER_WALL_MODE");const Ge=h.renderPass==="shadow",dt=h.shadowRenderer,At=Ge&&!!dt,st=Ge?_n.disabled:_n.backCCW;h.shadowRenderer&&(h.shadowRenderer.useNormalOffset=!0);let Tt=[0,0,0];if(dt){const Vt=h.style.directionalLight,tn=h.style.ambientLight;Vt&&tn&&(Tt=Zc(h.style,Vt,tn)),Ge||(Re.push("RENDER_SHADOWS","DEPTH_TEXTURE"),dt.useNormalOffset&&Re.push("NORMAL_OFFSET")),ot=Re.concat(["SHADOWS_SINGLE_CASCADE"])}const qt=At?"fillExtrusionDepth":X?"fillExtrusionPattern":"fillExtrusion",Wt=a.getLayerRenderingStats();for(const Vt of f){const tn=n.getTile(Vt),on=tn.getBucket(a);if(!on||on.projection.name!==D.projection.name)continue;let cn=!1;dt&&(cn=dt.getMaxCascadeForTile(Vt.toUnwrapped())===0);const wn=h.isTileAffectedByFog(Vt),Bn=on.programConfigurations.get(a.id);let Ar=!1;if(j&&tn.imageAtlas){const Jn=tn.imageAtlas,ri=s.dN.from(j),Gi=ri.getPrimary().scaleSelf(s.q.devicePixelRatio).toString(),Xr=ri.getSecondary(),yr=Jn.patternPositions.get(Gi),Ei=Xr?Jn.patternPositions.get(Xr.scaleSelf(s.q.devicePixelRatio).toString()):null;Ar=!!yr&&!!Ei,yr&&Bn.setConstantPatternPositions(yr,Ei)}N>0&&(Ar||Bn.getPatternTransitionVertexBuffer("fill-extrusion-pattern"))&&Re.push("FILL_EXTRUSION_PATTERN_TRANSITION");const Zr=h.getOrCreateProgram(qt,{config:Bn,defines:cn?ot:Re,overrideFog:wn});if(h.terrain&&h.terrain.setupElevationDraw(tn,Zr,{useMeterToDem:!0}),!on.centroidVertexBuffer){const Jn=Zr.attributes.a_centroid_pos;Jn!==void 0&&R.vertexAttrib2f(Jn,0,0)}!Ge&&dt&&dt.setupShadows(tn.tileID.toUnwrapped(),Zr,"vector-tile",tn.tileID.overscaledZ),X&&(h.context.activeTexture.set(R.TEXTURE0),tn.imageAtlasTexture&&tn.imageAtlasTexture.bind(R.LINEAR,R.CLAMP_TO_EDGE),Bn.updatePaintBuffers());const kr=a.paint.get("fill-extrusion-vertical-gradient"),zr=1/on.tileToMeter;let Di;if(Ge&&dt){if(ic(tn.tileID,on,h))continue;const Jn=dt.calculateShadowPassMatrixFromTile(tn.tileID.toUnwrapped());Di=c0(Jn,we,zr,rt,gt,ze)}else{const Jn=h.translatePosMatrix(Vt.expandedProjMatrix,tn,a.paint.get("fill-extrusion-translate"),a.paint.get("fill-extrusion-translate-anchor")),ri=D.projection.createInversionMatrix(D,Vt.canonical);Di=X?u0(Jn,h,kr,W,ie,we,zr,Vt,tn,be,gt,ze,ye,Se,ri,Fe,rt,N):Kh(Jn,h,kr,W,ie,we,zr,Vt,be,gt,ze,ye,Se,ri,Fe,rt,je,Tt)}h.uploadCommonUniforms(A,Zr,Vt.toUnwrapped(),null,Xe);let Dn=on.segments;if(D.projection.name==="mercator"&&!Ge&&(Dn=on.getVisibleSegments(tn.tileID,h.terrain,h.transform.getFrustum(0)),!Dn.get().length))continue;if(Wt)if(Ge)for(const Jn of Dn.get())Wt.numRenderedVerticesInShadowPass+=Jn.primitiveLength;else for(const Jn of Dn.get())Wt.numRenderedVerticesInTransparentPass+=Jn.primitiveLength;const Gn=[];(h.terrain||E)&&Gn.push(on.centroidVertexBuffer),ve&&Gn.push(on.layoutVertexExtBuffer),it&&Gn.push(on.wallVertexBuffer),Zr.draw(h,A.gl.TRIANGLES,g,y,b,st,Di,a.id,on.layoutVertexBuffer,on.indexBuffer,Dn,a.paint,h.transform.zoom,Bn,Gn)}h.shadowRenderer&&(h.shadowRenderer.useNormalOffset=!1)}function hl(h,n,a,f,g,y,b,E,A,R,D,F,N,j,X,W,K,ee,ie){const fe=h.context,_e=fe.gl,we=h.transform,be=h.transform.zoom,ve=[],ye=Oa(h,a.paint.get("fill-extrusion-cutoff-fade-range"));R==="clear"?(ve.push("CLEAR_SUBPASS"),ie&&(ve.push("CLEAR_FROM_TEXTURE"),fe.activeTexture.set(_e.TEXTURE0),ie.bind(_e.LINEAR,_e.CLAMP_TO_EDGE))):R==="sdf"&&ve.push("SDF_SUBPASS"),K&&ve.push("HAS_CENTROID"),ye.shouldRenderCutoff&&ve.push("RENDER_CUTOFF");const Se=a.layout.get("fill-extrusion-edge-radius"),Ee=(Fe,je,rt,it,gt)=>{const ze=je.programConfigurations.get(a.id),Xe=h.isTileAffectedByFog(Fe),Re=h.getOrCreateProgram("fillExtrusionGroundEffect",{config:ze,defines:ve,overrideFog:Xe}),ot=((dt,At,st,Tt,qt,Wt,Vt,tn,on,cn,wn)=>({u_matrix:At,u_opacity:st,u_ao_pass:Tt?1:0,u_meter_to_tile:qt,u_ao:Wt,u_flood_light_intensity:Vt,u_flood_light_color:tn,u_attenuation:on,u_edge_radius:cn,u_fb:0,u_fb_size:wn,u_dynamic_offset:1}))(0,it,D,A,gt,[F,N*gt],j,X,W,be>=17?0:Se*gt,ie?ie.size[0]:0),Ge=[];K&&Ge.push(je.hiddenByLandmarkVertexBuffer),h.uploadCommonUniforms(fe,Re,Fe.toUnwrapped(),null,ye),Re.draw(h,fe.gl.TRIANGLES,g,y,b,E,ot,a.id,je.vertexBuffer,je.indexBuffer,rt,a.paint,be,ze,Ge)};for(const Fe of f){const je=n.getTile(Fe),rt=je.getBucket(a);if(!rt||rt.projection.name!==we.projection.name||!rt.groundEffect||rt.groundEffect&&!rt.groundEffect.hasData())continue;const it=rt.groundEffect,gt=1/rt.tileToMeter;{const ze=h.translatePosMatrix(Fe.projMatrix,je,a.paint.get("fill-extrusion-translate"),a.paint.get("fill-extrusion-translate-anchor")),Xe=it.getDefaultSegment();Ee(Fe,it,Xe,ze,gt)}if(ee)for(let ze=0;ze<4;ze++){const Xe=s.dT[ze](Fe),Re=n.getTile(Xe);if(!Re)continue;const ot=Re.getBucket(a);if(!ot||ot.projection.name!==we.projection.name||!ot.groundEffect||ot.groundEffect&&!ot.groundEffect.hasData())continue;const Ge=ot.groundEffect;let dt,At;ze===0?(dt=[-8192,0,0],At=1):ze===1?(dt=[s.aj,0,0],At=0):ze===2?(dt=[0,-8192,0],At=3):(dt=[0,s.aj,0],At=2);const st=Ge.regionSegments[At];if(!st)continue;const Tt=new Float32Array(16);s.bo(Tt,Fe.projMatrix,dt),Ee(Fe,Ge,st,h.translatePosMatrix(Tt,je,a.paint.get("fill-extrusion-translate"),a.paint.get("fill-extrusion-translate-anchor")),gt)}}}function Ht(h,n,a,f,g,y,b){f.centroidVertexArray.length===0&&f.createCentroidsBuffer();const E=y?y.findDEMTileFor(a):null;if(!(E&&E.dem||b))return;y&&E&&E.dem&&f.selfDEMTileTimestamp!==E.dem._timestamp&&(f.borderDoneWithNeighborZ=[-1,-1,-1,-1],f.selfDEMTileTimestamp=E.dem._timestamp);const A=ee=>new s.P(Math.ceil((ee+s.dX)*s.dY),0),R=ee=>{const ie=n.getSource().minzoom,fe=we=>{const be=n.getTileByID(we);if(be&&be.hasData())return be.getBucket(g)},_e=[0,-1,1];for(const we of _e){if(ee.overscaledZ+we<ie)continue;const be=fe(ee.calculateScaledKey(ee.overscaledZ+we));if(be)return be}},D=[0,0,0],F=(ee,ie)=>(D[0]=Math.min(ee.min.y,ie.min.y),D[1]=Math.max(ee.max.y,ie.max.y),D[2]=s.aj-ie.min.x>ee.max.x?ie.min.x-s.aj:ee.max.x,D),N=(ee,ie)=>(D[0]=Math.min(ee.min.x,ie.min.x),D[1]=Math.max(ee.max.x,ie.max.x),D[2]=s.aj-ie.min.y>ee.max.y?ie.min.y-s.aj:ee.max.y,D),j=[(ee,ie)=>F(ee,ie),(ee,ie)=>F(ie,ee),(ee,ie)=>N(ee,ie),(ee,ie)=>N(ie,ee)],X=(ee,ie,fe,_e,we,be,ve)=>{if(!y)return 0;const ye=[[be?fe:ee,be?ee:fe,0],[be?fe:ie,be?ie:fe,0]],Se=ve<0?s.aj+ve:ve,Ee=[be?Se:(ee+ie)/2,be?(ee+ie)/2:Se,0];return fe===0&&ve<0||fe!==0&&ve>0?y.getForTilePoints(we,[Ee],!0,_e):ye.push(Ee),y.getForTilePoints(a,ye,!0,E),Math.max(ye[0][2],ye[1][2],Ee[2])/y.exaggeration()};for(let ee=0;ee<4;ee++){const ie=f.borderFeatureIndices[ee];if(ie.length===0)continue;const fe=s.dT[ee](a),_e=R(fe);if(!(_e&&_e instanceof s.dU))continue;const we=y?y.findDEMTileFor(fe):null;if(!(we&&we.dem||b)||(y&&we&&we.dem&&f.borderDEMTileTimestamp[ee]!==we.dem._timestamp&&(f.borderDoneWithNeighborZ[ee]=-1,f.borderDEMTileTimestamp[ee]=we.dem._timestamp),f.borderDoneWithNeighborZ[ee]===_e.canonical.z))continue;_e.centroidVertexArray.length===0&&_e.createCentroidsBuffer();const be=(ee<2?1:5)-ee,ve=_e.borderDoneWithNeighborZ[be]!==f.canonical.z,ye=_e.borderFeatureIndices[be];let Se=0;if(f.canonical.z!==_e.canonical.z){for(const Ee of ie)f.showCentroid(f.featuresOnBorder[Ee]);if(ve)for(const Ee of ye)_e.showCentroid(_e.featuresOnBorder[Ee]);f.borderDoneWithNeighborZ[ee]=_e.canonical.z,_e.borderDoneWithNeighborZ[be]=f.canonical.z}for(const Ee of ie){const Fe=f.featuresOnBorder[Ee],je=f.centroidData[Fe.centroidDataIndex],rt=Fe.borders[ee];let it;for(;Se<ye.length;){it=_e.featuresOnBorder[ye[Se]];const gt=it.borders[be];if(gt[1]>rt[0]+3||gt[0]>rt[0]-3)break;_e.showCentroid(it),Se++}if(it&&Se<ye.length){const gt=Se;let ze=0;for(;!(it.borders[be][0]>rt[1]-3)&&(ze++,++Se!==ye.length);)it=_e.featuresOnBorder[ye[Se]];it=_e.featuresOnBorder[ye[gt]];let Xe=!1;if(ze>=1){const Ge=it.borders[be];Math.abs(rt[0]-Ge[0])<3&&Math.abs(rt[1]-Ge[1])<3&&(ze=1,Xe=!0,Se=gt+1)}else if(ze===0){f.showCentroid(Fe);continue}const Re=_e.centroidData[it.centroidDataIndex];b&&Xe&&(((W=je).flags|(K=Re).flags)&s.dW?(W.flags|=s.dW,K.flags|=s.dW):(W.flags&=2147483647,K.flags&=2147483647));const ot=Fe.intersectsCount()>1||it.intersectsCount()>1;if(ze>1)Se=gt,je.centroidXY=Re.centroidXY=new s.P(0,0);else if(we&&we.dem&&!ot){const Ge=j[ee](je,Re),dt=ee%2?s.aj-1:0,At=X(Ge[0],Math.min(s.aj-1,Ge[1]),dt,we,fe,ee<2,Ge[2]);je.centroidXY=Re.centroidXY=A(At)}else ot?je.centroidXY=Re.centroidXY=new s.P(0,0):(je.centroidXY=f.encodeBorderCentroid(Fe),Re.centroidXY=_e.encodeBorderCentroid(it));f.writeCentroidToBuffer(je),_e.writeCentroidToBuffer(Re)}else f.showCentroid(Fe)}f.borderDoneWithNeighborZ[ee]=_e.canonical.z,_e.borderDoneWithNeighborZ[be]=f.canonical.z}var W,K;(f.needsCentroidUpdate||!f.centroidVertexBuffer&&f.centroidVertexArray.length!==0)&&f.uploadCentroid(h)}const y0=[1,0,0],v0=[0,1,0],rc=[0,0,1];function ic(h,n,a){const f=a.transform,g=a.shadowRenderer;if(!g)return!0;const y=h.toUnwrapped(),b=f.tileSize*g._cascades[a.currentShadowCascade].scale;let E=n.maxHeight;if(f.elevation){const W=f.elevation.getMinMaxForTile(h);W&&(E+=W.max)}const A=[...g.shadowDirection];A[2]=-A[2];const R=g.computeSimplifiedTileShadowVolume(y,E,b,A);if(!R)return!1;const D=[y0,v0,rc,A,[A[0],0,A[2]],[0,A[1],A[2]]],F=f.projection.name==="globe",N=f.scaleZoom(b),j=s.cn.fromInvProjectionMatrix(f.invProjMatrix,f.worldSize,N,!F),X=g.getCurrentCascadeFrustum();return j.intersectsPrecise(R.vertices,R.planes,D)===0||X.intersectsPrecise(R.vertices,R.planes,D)===0}function hn(h){return[h[0]*s.dZ,h[1]*s.dZ,h[2]*s.dZ,0]}function rf(h,n,a,f,g,y,b,E,A){const R=f.getSource(),D=a.globeSharedBuffers;if(!D)return;let F,N,j;if(n&&(F=f.getTile(n)),R instanceof s.aP?(N=R.texture,j=s.ds(0,0,a.transform)):F&&n&&(N=F.texture,j=s.ds(n.canonical.z,n.canonical.x,a.transform)),!N||!j)return;h||(j=s.cE(s.bz(),j,[1,-1,1]));const X=a.context,W=X.gl,K=g.paint.get("raster-resampling")==="nearest"?W.NEAREST:W.LINEAR,ee=a.colorModeForDrapableLayerRenderPass(y),ie=b.defines;ie.push("GLOBE_POLES");const fe=new Gt(W.LEQUAL,Gt.ReadWrite,a.depthRangeFor3D),_e=Float32Array.from(a.transform.expandedFarZProjMatrix),we=Float32Array.from(s.bh(s.dr(new s.cp(0,0,0))));a.terrain&&a.terrain.prepareDrawTile(),X.activeTexture.set(W.TEXTURE0),N.bind(K,W.CLAMP_TO_EDGE),X.activeTexture.set(W.TEXTURE1),N.bind(K,W.CLAMP_TO_EDGE),"useMipmap"in N&&X.extTextureFilterAnisotropic&&a.transform.pitch>20&&W.texParameterf(W.TEXTURE_2D,X.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,X.extTextureFilterAnisotropicMax);const[be,ve,ye,Se]=n?D.getPoleBuffers(n.canonical.z,!1):D.getPoleBuffers(0,!0),Ee=g.paint.get("raster-elevation");let Fe;h?(Fe=be,a.renderDefaultNorthPole=Ee!==0):(Fe=ve,a.renderDefaultSouthPole=Ee!==0);const je=hn(b.mix),rt=((gt,ze,Xe,Re,ot,Ge,dt,At,st,Tt,qt,Wt,Vt)=>$_(gt,ze,Xe,new Float32Array(16),new Float32Array(9),[0,0],Re,[0,0],[0,0,0,0],1,{opacity:1,mix:0},Ge,[0,0],At,2,Tt,qt,Wt,1,0,Vt))(_e,we,j,s.ah(a.transform.zoom),0,g,0,Ee,0,je,b.offset,b.range,y),it=a.getOrCreateProgram("raster",{defines:ie});a.uploadCommonUniforms(X,it,null),it.draw(a,W.TRIANGLES,fe,A,ee,E,rt,g.id,Fe,ye,Se)}function iS(h){const n=h._nearZ,a=h.projection.farthestPixelDistance(h),f=a-n,g=.2*h.height,y=n+g;return[n,a,(y-g-n)/f,(y-n)/f]}function sS(h,n,a,f){if(h)return n instanceof Zl&&h instanceof ku?n.getTextureDescriptor(h,a,!0):{texture:h.texture,mix:hn(f.mix),offset:f.offset,buffer:0,tileSize:1}}var X_=s.d_([{name:"a_index",type:"Int16",components:1}]);class x0{constructor(n,a,f,g){const y={width:f[0],height:f[1],data:null},b=n.gl;this.targetColorTexture=new s.T(n,y,b.RGBA8,{useMipmap:!1}),this.backgroundColorTexture=new s.T(n,y,b.RGBA8,{useMipmap:!1}),this.context=n,this.updateParticleTexture(a,g),this.lastInvalidatedAt=0}updateParticleTexture(n,a){if(this.particleTextureDimension===a.width)return;(this.particleTexture0||this.particleTexture1||this.particleIndexBuffer||this.particleSegment)&&(this.particleTexture0.destroy(),this.particleTexture1.destroy(),this.particleIndexBuffer.destroy(),this.particleSegment.destroy());const f=this.context.gl,g=a.width*a.height;this.particleTexture0=new s.T(this.context,a,f.RGBA8,{premultiply:!1,useMipmap:!1}),this.particleTexture1=new s.T(this.context,a,f.RGBA8,{premultiply:!1,useMipmap:!1});const y=new s.d$;y.reserve(g);for(let b=0;b<g;b++)y.emplaceBack(b);this.particleIndexBuffer=this.context.createVertexBuffer(y,X_.members,!0),this.particleSegment=s.bd.simpleSegment(0,0,this.particleIndexBuffer.length,0),this.particleTextureDimension=a.width}update(n){return!(this.lastInvalidatedAt<n&&(this.lastInvalidatedAt=s.q.now(),1))}destroy(){this.targetColorTexture.destroy(),this.backgroundColorTexture.destroy(),this.particleIndexBuffer.destroy(),this.particleTexture0.destroy(),this.particleTexture1.destroy(),this.particleSegment.destroy()}}function oS(h,n,a){if(!h)return null;const f=n.getTextureDescriptor(h,a,!0);if(!f)return null;let{texture:g,mix:y,offset:b,tileSize:E,buffer:A,format:R}=f;if(!g||!R)return null;let D=!1;return R==="uint32"&&(D=!0,y[3]=0,y=eu(s.e0,y,[0,a.paint.get("raster-particle-max-speed")]),b=U_(s.e0,b,[0,a.paint.get("raster-particle-max-speed")])),{texture:g,textureOffset:[A/(E+2*A),E/(E+2*A)],tileSize:E,scalarData:D,scale:y,offset:b,defines:["RASTER_ARRAY",{uint8:"DATA_FORMAT_UINT8",uint16:"DATA_FORMAT_UINT16",uint32:"DATA_FORMAT_UINT32"}[R]]}}function b0(h){const n=h._nearZ,a=h.projection.farthestPixelDistance(h),f=a-n,g=.2*h.height,y=n+g;return[n,a,(y-g-n)/f,(y-n)/f]}const aS=new s.am(1,0,0,1),lS=new s.am(0,1,0,1),bo=new s.am(0,0,1,1),Y_=new s.am(1,0,1,1),Qs=new s.am(0,1,1,1);function fl(h,n,a,f,g,y){for(let b=0;b<a.length;b++)if(g){const R=new s.am(f.r*.8,f.g*.8,f.b*.8,1);nu(h,n,a[b],f,-1,-1,y),nu(h,n,a[b],f,-1,1,y),nu(h,n,a[b],f,1,1,y),nu(h,n,a[b],f,1,-1,y),nu(h,n,a[b],R,0,0,y)}else nu(h,n,a[b],f,0,0,y)}function nu(h,n,a,f,g,y,b){const E=h.context,A=h.transform,R=E.gl,D=A.projection.name==="globe",F=D?["PROJECTION_GLOBE_VIEW"]:[];let N=s.bw(a.projMatrix);if(D&&s.ah(A.zoom)>0){const je=s.bg(a.canonical,A),rt=s.e1(je);N=s.az(new Float32Array(16),A.globeMatrix,rt),s.az(N,A.projMatrix,N)}const j=s.bz();j[12]+=2*g/(s.q.devicePixelRatio*A.width),j[13]+=2*y/(s.q.devicePixelRatio*A.height),s.az(N,j,N);const X=h.getOrCreateProgram("debug",{defines:F}),W=n.getTileByID(a.key);h.terrain&&h.terrain.setupElevationDraw(W,X);const K=Gt.disabled,ee=En.disabled,ie=h.colorModeForRenderPass(),fe="$debug";E.activeTexture.set(R.TEXTURE0),h.emptyTexture.bind(R.LINEAR,R.CLAMP_TO_EDGE),D?W._makeGlobeTileDebugBuffers(h.context,A):W._makeDebugTileBoundsBuffers(h.context,A.projection);const _e=W._tileDebugBuffer||h.debugBuffer,we=W._tileDebugIndexBuffer||h.debugIndexBuffer,be=W._tileDebugSegments||h.debugSegments;if(X.draw(h,R.LINE_STRIP,K,ee,ie,_n.disabled,tm(N,f.toPremultipliedRenderColor(null)),fe,_e,we,be,null,null,null,[W._globeTileDebugBorderBuffer]),b){const je=W.latestRawTileData,rt=Math.floor((je&&je.byteLength||0)/1024);let it=a.canonical.toString();a.overscaledZ!==a.canonical.z&&(it+=` => ${a.overscaledZ}`),it+=` ${W.state}`,it+=` ${rt}kb`,function(gt,ze){gt.initDebugOverlayCanvas();const Xe=gt.debugOverlayCanvas,Re=gt.context.gl,ot=gt.debugOverlayCanvas.getContext("2d");ot.clearRect(0,0,Xe.width,Xe.height),ot.shadowColor="white",ot.shadowBlur=2,ot.lineWidth=1.5,ot.strokeStyle="white",ot.textBaseline="top",ot.font="bold 36px Open Sans, sans-serif",ot.fillText(ze,5,5),ot.strokeText(ze,5,5),gt.debugOverlayTexture.update(Xe),gt.debugOverlayTexture.bind(Re.LINEAR,Re.CLAMP_TO_EDGE)}(h,it)}const ve=n.getTile(a).tileSize,ye=512/Math.min(ve,512)*(a.overscaledZ/A.zoom)*.5,Se=W._tileDebugTextBuffer||h.debugBuffer,Ee=W._tileDebugTextIndexBuffer||h.quadTriangleIndexBuffer,Fe=W._tileDebugTextSegments||h.debugSegments;X.draw(h,R.TRIANGLES,K,ee,Zn.alphaBlended,_n.disabled,tm(N,s.am.transparent.toPremultipliedRenderColor(null),ye),fe,Se,Ee,Fe,null,null,null,[W._globeTileDebugTextBuffer])}function sm(h,n,a,f){ed(h,0,n+a/2,h.transform.width,a,f)}function om(h,n,a,f){ed(h,n-a/2,0,a,h.transform.height,f)}function ed(h,n,a,f,g,y){const b=h.context,E=b.gl;E.enable(E.SCISSOR_TEST),E.scissor(n*s.q.devicePixelRatio,a*s.q.devicePixelRatio,f*s.q.devicePixelRatio,g*s.q.devicePixelRatio),b.clear({color:y}),E.disable(E.SCISSOR_TEST)}const w0=s.d_([{name:"a_pos_3f",components:3,type:"Float32"}]),{members:pl}=w0;function Fr(h,n,a,f){h.emplaceBack(n,a,f)}class sf{constructor(n){this.vertexArray=new s.e2,this.indices=new s.a_,Fr(this.vertexArray,-1,-1,1),Fr(this.vertexArray,1,-1,1),Fr(this.vertexArray,-1,1,1),Fr(this.vertexArray,1,1,1),Fr(this.vertexArray,-1,-1,-1),Fr(this.vertexArray,1,-1,-1),Fr(this.vertexArray,-1,1,-1),Fr(this.vertexArray,1,1,-1),this.indices.emplaceBack(5,1,3),this.indices.emplaceBack(3,7,5),this.indices.emplaceBack(6,2,0),this.indices.emplaceBack(0,4,6),this.indices.emplaceBack(2,6,7),this.indices.emplaceBack(7,3,2),this.indices.emplaceBack(5,4,0),this.indices.emplaceBack(0,1,5),this.indices.emplaceBack(0,2,3),this.indices.emplaceBack(3,1,0),this.indices.emplaceBack(7,6,4),this.indices.emplaceBack(4,5,7),this.vertexBuffer=n.createVertexBuffer(this.vertexArray,pl),this.indexBuffer=n.createIndexBuffer(this.indices),this.segment=s.bd.simpleSegment(0,0,36,12)}}function sc(h,n,a,f,g,y){const b=h.context.gl,E=n.paint.get("sky-atmosphere-color"),A=n.paint.get("sky-atmosphere-halo-color"),R=n.paint.get("sky-atmosphere-sun-intensity"),D=((F,N,j,X,W)=>({u_matrix_3f:F,u_sun_direction:N,u_sun_intensity:j,u_color_tint_r:[X.r,X.g,X.b,X.a],u_color_tint_m:[W.r,W.g,W.b,W.a],u_luminance:5e-5}))(s.e4(s.dx(),f),g,R,E.toPremultipliedRenderColor(null),A.toPremultipliedRenderColor(null));b.framebufferTexture2D(b.FRAMEBUFFER,b.COLOR_ATTACHMENT0,b.TEXTURE_CUBE_MAP_POSITIVE_X+y,n.skyboxTexture,0),a.draw(h,b.TRIANGLES,Gt.disabled,En.disabled,Zn.unblended,_n.frontCW,D,"skyboxCapture",n.skyboxGeometry.vertexBuffer,n.skyboxGeometry.indexBuffer,n.skyboxGeometry.segment)}const S0=s.d_([{type:"Float32",name:"a_pos",components:3},{type:"Float32",name:"a_uv",components:2}]);class T0{constructor(n){const a=new s.e5;a.emplaceBack(-1,1,1,0,0),a.emplaceBack(1,1,1,1,0),a.emplaceBack(1,-1,1,1,1),a.emplaceBack(-1,-1,1,0,1);const f=new s.a_;f.emplaceBack(0,1,2),f.emplaceBack(2,3,0),this.vertexBuffer=n.createVertexBuffer(a,S0.members),this.indexBuffer=n.createIndexBuffer(f),this.segments=s.bd.simpleSegment(0,0,4,2)}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy()}}const E0=s.d_([{type:"Float32",name:"a_pos_3f",components:3},{type:"Float32",name:"a_uv",components:2},{type:"Float32",name:"a_size_scale",components:1},{type:"Float32",name:"a_fade_opacity",components:1}]);class cS{constructor(){this.starsCount=16e3,this.sizeMultiplier=.15,this.sizeRange=100,this.intensityRange=200}}class td{constructor(n){this.colorModeAlphaBlendedWriteRGB=new Zn([1,Wc,1,Wc],s.am.transparent,[!0,!0,!0,!1]),this.colorModeWriteAlpha=new Zn([1,0,1,0],s.am.transparent,[!1,!1,!1,!0]),this.params=new cS,this.updateNeeded=!0,n.tp.registerParameter(this.params,["Stars"],"starsCount",{min:100,max:16e3,step:1},()=>{this.updateNeeded=!0}),n.tp.registerParameter(this.params,["Stars"],"sizeMultiplier",{min:.01,max:2,step:.01}),n.tp.registerParameter(this.params,["Stars"],"sizeRange",{min:0,max:200,step:1},()=>{this.updateNeeded=!0}),n.tp.registerParameter(this.params,["Stars"],"intensityRange",{min:0,max:200,step:1},()=>{this.updateNeeded=!0})}update(n){const a=n.context;if(!this.atmosphereBuffer||this.updateNeeded){this.updateNeeded=!1,this.atmosphereBuffer=new T0(a);const f=this.params.sizeRange,g=this.params.intensityRange,y=function(D){const F=s.e7(30),N=[];for(let j=0;j<D;++j){const X=2*Math.PI*F(),W=Math.acos(1-2*F())-.5*Math.PI;N.push(s.cS(Math.cos(W)*Math.cos(X),Math.cos(W)*Math.sin(X),Math.sin(W)))}return N}(this.params.starsCount),b=s.e7(300),E=new s.e6,A=new s.a_;let R=0;for(let D=0;D<y.length;++D){const F=s.bY([],y[D],200),N=Math.max(0,1+.01*f*(1*b()-.5)),j=Math.max(0,1+.01*g*(1*b()-.5));E.emplaceBack(F[0],F[1],F[2],-1,-1,N,j),E.emplaceBack(F[0],F[1],F[2],1,-1,N,j),E.emplaceBack(F[0],F[1],F[2],1,1,N,j),E.emplaceBack(F[0],F[1],F[2],-1,1,N,j),A.emplaceBack(R+0,R+1,R+2),A.emplaceBack(R+0,R+2,R+3),R+=4}this.starsVx=a.createVertexBuffer(E,E0.members),this.starsIdx=a.createIndexBuffer(A),this.starsSegments=s.bd.simpleSegment(0,0,E.length,A.length)}}destroy(){this.atmosphereBuffer&&this.atmosphereBuffer.destroy(),this.starsVx&&this.starsVx.destroy(),this.starsIdx&&this.starsIdx.destroy()}drawAtmosphereGlow(n,a){const f=n.context,g=f.gl,y=n.transform,b=new Gt(g.LEQUAL,Gt.ReadOnly,[0,1]),E=s.ah(y.zoom),A=n.style.getLut(a.scope),R=a.properties.get("color-use-theme")==="none",D=a.properties.get("color").toNonPremultipliedRenderColor(R?null:A).toArray01(),F=a.properties.get("high-color-use-theme")==="none",N=a.properties.get("high-color").toNonPremultipliedRenderColor(F?null:A).toArray01(),j=a.properties.get("space-color-use-theme")==="none",X=a.properties.get("space-color").toNonPremultipliedRenderColor(j?null:A).toArray01(),W=5e-4,K=s.e8(a.properties.get("horizon-blend"),0,1,W,.25),ee=s.dl(n,f,y)&&K===W?y.worldSize/(2*Math.PI*1.025)-1:y.globeRadius,ie=n.frameCounter/1e3%1,fe=s.ae(y.globeCenterInViewSpace),_e=Math.sqrt(Math.pow(fe,2)-Math.pow(ee,2)),we=Math.acos(_e/fe),be=ve=>{const ye=y.projection.name==="globe"?["PROJECTION_GLOBE_VIEW","FOG"]:["FOG"];ve&&ye.push("ALPHA_PASS");const Se=n.getOrCreateProgram("globeAtmosphere",{defines:ye}),Ee=((je,rt,it,gt,ze,Xe,Re,ot,Ge,dt,At,st)=>({u_frustum_tl:je,u_frustum_tr:rt,u_frustum_br:it,u_frustum_bl:gt,u_horizon:ze,u_transition:Xe,u_fadeout_range:Re,u_color:ot,u_high_color:Ge,u_space_color:dt,u_temporal_offset:At,u_horizon_angle:st}))(y.frustumCorners.TL,y.frustumCorners.TR,y.frustumCorners.BR,y.frustumCorners.BL,y.frustumCorners.horizon,E,K,D,N,X,ie,we);n.uploadCommonUniforms(f,Se);const Fe=this.atmosphereBuffer;Fe&&Se.draw(n,g.TRIANGLES,b,En.disabled,ve?this.colorModeWriteAlpha:this.colorModeAlphaBlendedWriteRGB,_n.backCW,Ee,ve?"atmosphere_glow_alpha":"atmosphere_glow",Fe.vertexBuffer,Fe.indexBuffer,Fe.segments)};be(!1),be(!0)}drawStars(n,a){const f=s.ay(a.properties.get("star-intensity"),0,1);if(f===0)return;const g=n.context,y=g.gl,b=n.transform,E=n.getOrCreateProgram("stars"),A=s.b_([]);s.c0(A,A,-b._pitch),s.b$(A,A,-b.angle),s.c0(A,A,s.al(b._center.lat)),s.e9(A,A,-s.al(b._center.lng));const R=s.c3(new Float32Array(16),A),D=s.az([],b.starsProjMatrix,R),F=s.e4([],R),N=s.ea([],F),j=[0,1,0];s.dz(j,j,N),s.bY(j,j,this.params.sizeMultiplier);const X=[1,0,0];s.dz(X,X,N),s.bY(X,X,this.params.sizeMultiplier);const W=(K=j,ee=X,ie=f,{u_matrix:Float32Array.from(D),u_up:K,u_right:ee,u_intensity_multiplier:ie});var K,ee,ie;n.uploadCommonUniforms(g,E),this.starsVx&&this.starsIdx&&E.draw(n,y.TRIANGLES,Gt.disabled,En.disabled,this.colorModeAlphaBlendedWriteRGB,_n.disabled,W,"atmosphere_stars",this.starsVx,this.starsIdx,this.starsSegments)}}function ru(h,n){const a=[...h],f=n.cameraWorldSizeForFog/n.worldSize,g=s.bx([]);return s.cE(g,g,[f,f,1]),s.az(a,g,a),s.az(a,n.worldToFogMatrix,a),a}function bt(h,n,a,f,g){const y=a.material,b=f.context,{baseColorTexture:E,metallicRoughnessTexture:A}=y.pbrMetallicRoughness,{normalTexture:R,occlusionTexture:D,emissionTexture:F}=y;function N(X,W,K){if(X&&(h.push(W),b.activeTexture.set(b.gl.TEXTURE0+K),X.gfxTexture)){const{minFilter:ee,magFilter:ie,wrapS:fe,wrapT:_e}=X.sampler;X.gfxTexture.bindExtraParam(ee,ie,fe,_e)}}N(E,"HAS_TEXTURE_u_baseColorTexture",Ks.BaseColor),N(A,"HAS_TEXTURE_u_metallicRoughnessTexture",Ks.MetallicRoughness),N(R,"HAS_TEXTURE_u_normalTexture",Ks.Normal),N(D,"HAS_TEXTURE_u_occlusionTexture",Ks.Occlusion),N(F,"HAS_TEXTURE_u_emissionTexture",Ks.Emission),g&&(g.texture||(g.texture=new s.eh(f.context,g.image,[g.image.height,g.image.height,g.image.height],b.gl.RGBA8)),b.activeTexture.set(b.gl.TEXTURE0+Ks.LUT),g.texture&&g.texture.bind(b.gl.LINEAR,b.gl.CLAMP_TO_EDGE),h.push("APPLY_LUT_ON_GPU")),a.texcoordBuffer&&(h.push("HAS_ATTRIBUTE_a_uv_2f"),n.push(a.texcoordBuffer)),a.colorBuffer&&(h.push(a.colorBuffer.itemSize===12?"HAS_ATTRIBUTE_a_color_3f":"HAS_ATTRIBUTE_a_color_4f"),n.push(a.colorBuffer)),a.normalBuffer&&(h.push("HAS_ATTRIBUTE_a_normal_3f"),n.push(a.normalBuffer)),a.pbrBuffer&&(h.push("HAS_ATTRIBUTE_a_pbr"),h.push("HAS_ATTRIBUTE_a_heightBasedEmissiveStrength"),n.push(a.pbrBuffer)),y.alphaMode!=="OPAQUE"&&y.alphaMode!=="MASK"||h.push("UNPREMULT_TEXTURE_IN_SHADER"),y.defined||h.push("DIFFUSE_SHADED");const j=f.shadowRenderer;j&&(h.push("RENDER_SHADOWS","DEPTH_TEXTURE"),j.useNormalOffset&&h.push("NORMAL_OFFSET"))}function Bt(h,n,a,f,g,y){const b=a.paint.get("model-opacity").constantOr(1),E=n.context,A=new Gt(n.context.gl.LEQUAL,Gt.ReadWrite,n.depthRangeFor3D),R=n.transform,D=h.mesh,F=D.material,N=F.pbrMetallicRoughness,j=n.style.fog;let X;X=n.transform.projection.zAxisUnit==="pixels"?[...h.nodeModelMatrix]:s.az([],f.zScaleMatrix,h.nodeModelMatrix),s.az(X,f.negCameraPosMatrix,X);const W=s.bi([],X);s.ee(W,W);const K=a.paint.get("model-color-use-theme").constantOr("default")==="none",ee=a.paint.get("model-emissive-strength").constantOr(0),ie=ef(new Float32Array(h.worldViewProjection),new Float32Array(X),new Float32Array(W),null,n,b,N.baseColorFactor,F.emissiveFactor,N.metallicFactor,N.roughnessFactor,F,ee,a),fe={defines:[]},_e=[],we=n.shadowRenderer;we&&(we.useNormalOffset=!1),bt(fe.defines,_e,D,n,K?null:a.lut);let be=null;if(j){const Se=ru(h.nodeModelMatrix,n.transform);if(be=new Float32Array(Se),R.projection.name!=="globe"){const Ee=D.aabb.min,Fe=D.aabb.max,[je,rt]=j.getOpacityForBounds(Se,Ee[0],Ee[1],Fe[0],Fe[1]);fe.overrideFog=je>=qe||rt>=qe}}const ve=Oa(n,a.paint.get("model-cutoff-fade-range"));ve.shouldRenderCutoff&&fe.defines.push("RENDER_CUTOFF");const ye=n.getOrCreateProgram("model",fe);n.uploadCommonUniforms(E,ye,null,be,ve),n.renderPass!=="shadow"&&we&&we.setupShadowsFromMatrix(h.nodeModelMatrix,ye),ye.draw(n,E.gl.TRIANGLES,A,g,y,D.material.doubleSided?_n.disabled:_n.backCCW,ie,a.id,D.vertexBuffer,D.indexBuffer,D.segments,a.paint,n.transform.zoom,void 0,_e)}function iu(h,n,a,f,g,y,b){let E;E=h.projection.name==="globe"?s.ed(a,h):[...a],s.az(E,E,n.matrix);const A=s.az([],f,E);if(n.meshes)for(const R of n.meshes){if(R.material.alphaMode!=="BLEND"){b.push({mesh:R,depth:0,modelIndex:g,worldViewProjection:A,nodeModelMatrix:E});continue}const D=s.ad([],R.centroid,A);!h.isOrthographic&&D[2]<=0||y.push({mesh:R,depth:D[2],modelIndex:g,worldViewProjection:A,nodeModelMatrix:E})}if(n.children)for(const R of n.children)iu(h,R,a,f,g,y,b)}function Ti(h,n,a,f){const g=a.shadowRenderer;if(!g)return;const y=g.getShadowPassDepthMode(),b=g.getShadowPassColorMode(),E=g.calculateShadowPassMatrixFromMatrix(n),A=m0(E);a.getOrCreateProgram("modelDepth",{defines:a._shadowMapDebug?[]:["DEPTH_TEXTURE"]}).draw(a,a.context.gl.TRIANGLES,y,En.disabled,b,_n.backCCW,A,f.id,h.vertexBuffer,h.indexBuffer,h.segments,f.paint,a.transform.zoom,void 0,void 0)}function Oe(h,n,a){const f=n.updateZoomBasedPaintProperties(),g=function(y,b,E){let A,R,D,F=y.terrain?y.terrain.exaggeration():0;if(y.terrain&&F>0){const N=y.terrain,j=N.findDEMTileFor(E);j&&j.dem?A=s.ei.create(N,E,j):F=0}if(F===0&&(b.terrainElevationMin=0,b.terrainElevationMax=0),F===b.validForExaggeration&&(F===0||A&&A._demTile&&A._demTile.tileID===b.validForDEMTile.id&&A._dem._timestamp===b.validForDEMTile.timestamp))return!1;for(const N in b.instancesPerModel){const j=b.instancesPerModel[N];for(let X=0;X<j.instancedDataArray.length;++X){const W=(A?F*A.getElevationAt(0|j.instancedDataArray.float32[16*X],0|j.instancedDataArray.float32[16*X+1],!0,!0):0)+j.instancesEvaluatedElevation[X];j.instancedDataArray.float32[16*X+6]=W,R=R?Math.min(b.terrainElevationMin,W):W,D=D?Math.max(b.terrainElevationMax,W):W}}return b.terrainElevationMin=R||0,b.terrainElevationMax=D||0,b.validForExaggeration=F,b.validForDEMTile=A&&A._demTile?{id:A._demTile.tileID,timestamp:A._dem._timestamp}:{id:void 0,timestamp:0},!0}(h,n,a);(f||g)&&(n.uploaded=!1,n.upload(h.context))}const ya={shadowUniformsInitialized:!1,useSingleShadowCascade:!1,tileMatrix:new Float64Array(16),shadowTileMatrix:new Float32Array(16),aabb:new s.cW([0,0,0],[s.aj,s.aj,0])};function am(h,n){const a=1<<h.canonical.z,f=n.getFreeCameraOptions().position,g=n.elevation,y=h.canonical.x/a,b=(h.canonical.x+1)/a,E=h.canonical.y/a,A=(h.canonical.y+1)/a;let R=n._centerAltitude;if(g){const j=g.getMinMaxForTile(h);j&&j.max>R&&(R=j.max)}const D=s.ay(f.x,y,b)-f.x,F=s.ay(f.y,E,A)-f.y,N=s.c6(R,n.center.lat)-f.z;return n._zoomFromMercatorZ(Math.sqrt(D*D+F*F+N*N))}function lm(h,n,a,f,g,y,b){const E=h.context,A=h.renderPass==="shadow",R=h.shadowRenderer,D=A&&R?R.getShadowPassDepthMode():new Gt(E.gl.LEQUAL,Gt.ReadWrite,h.depthRangeFor3D),F=h.isTileAffectedByFog(y);if(a.meshes)for(const N of a.meshes){const j=["MODEL_POSITION_ON_GPU"],X=[];let W,K,ee;f.instancedDataArray.length>20&&j.push("INSTANCED_ARRAYS");const ie=Oa(h,n.paint.get("model-cutoff-fade-range"));if(ie.shouldRenderCutoff&&j.push("RENDER_CUTOFF"),A&&R)W=h.getOrCreateProgram("modelDepth",{defines:j}),K=m0(b.shadowTileMatrix,b.shadowTileMatrix,Float32Array.from(a.matrix)),ee=R.getShadowPassColorMode();else{bt(j,X,N,h,n.paint.get("model-color-use-theme").constantOr("default")==="none"?null:n.lut),W=h.getOrCreateProgram("model",{defines:j,overrideFog:F});const _e=N.material,we=_e.pbrMetallicRoughness,be=n.paint.get("model-opacity").constantOr(1),ve=n.paint.get("model-emissive-strength").constantOr(0);K=ef(y.expandedProjMatrix,Float32Array.from(a.matrix),new Float32Array(16),null,h,be,we.baseColorFactor,_e.emissiveFactor,we.metallicFactor,we.roughnessFactor,_e,ve,n,g),R&&(b.shadowUniformsInitialized?W.setShadowUniformValues(E,R.getShadowUniformValues()):(R.setupShadows(y.toUnwrapped(),W,"model-tile",y.overscaledZ),b.shadowUniformsInitialized=!0)),ee=ie.shouldRenderCutoff||be<1||_e.alphaMode!=="OPAQUE"?Zn.alphaBlended:Zn.unblended}h.uploadCommonUniforms(E,W,y.toUnwrapped(),null,ie);const fe=N.material.doubleSided?_n.disabled:_n.backCCW;if(f.instancedDataArray.length>20)X.push(f.instancedDataBuffer),W.draw(h,E.gl.TRIANGLES,D,En.disabled,ee,fe,K,n.id,N.vertexBuffer,N.indexBuffer,N.segments,n.paint,h.transform.zoom,void 0,X,f.instancedDataArray.length);else{const _e=A?"u_instance":"u_normal_matrix";for(let we=0;we<f.instancedDataArray.length;++we)K[_e]=new Float32Array(f.instancedDataArray.arrayBuffer,64*we,16),W.draw(h,E.gl.TRIANGLES,D,En.disabled,ee,fe,K,n.id,N.vertexBuffer,N.indexBuffer,N.segments,n.paint,h.transform.zoom,void 0,X)}}if(a.children)for(const N of a.children)lm(h,n,N,f,g,y,b)}const K_=[1,-1,1];function C0(h,n,a,f){if(!a.modelManager)return!0;const g=a.modelManager;if(!a.shadowRenderer)return!0;const y=a.shadowRenderer,b=n.aabb;let E=!0,A=h.maxHeight;if(A===0){let D=0;for(const F in h.instancesPerModel){const N=g.getModel(F,f);N?D=Math.max(D,Math.max(Math.max(N.aabb.max[0],N.aabb.max[1]),N.aabb.max[2])):E=!1}A=h.maxScale*D*1.41+h.maxVerticalOffset,E&&(h.maxHeight=A)}b.max[2]=A,b.min[2]+=h.terrainElevationMin,b.max[2]+=h.terrainElevationMax,s.ad(b.min,b.min,n.tileMatrix),s.ad(b.max,b.max,n.tileMatrix);const R=b.intersects(y.getCurrentCascadeFrustum());return a.currentShadowCascade===0&&(h.isInsideFirstShadowMapFrustum=R===2),R===0}function A0(h,n){const a=h.uniformValues.u_cutoff_params[0],f=h.uniformValues.u_cutoff_params[1],g=h.uniformValues.u_cutoff_params[2],y=h.uniformValues.u_cutoff_params[3];return f===a||y===g?1:s.ay(((n-a)/(f-a)-g)/(y-g),0,1)}function nd(h,n,a,f){if(n.pitch<20)return 1;const g=n.getWorldToCameraMatrix();s.az(g,g,h);const y=s.ej(a.min[0],a.min[1],a.min[2],1);let b=s.aA(s.ek(),y,g),E=b,A=b;y[1]=a.max[1],b=s.aA(s.ek(),y,g),E=b[1]<E[1]?b:E,A=b[1]>A[1]?b:A,y[0]=a.max[0],b=s.aA(s.ek(),y,g),E=b[1]<E[1]?b:E,A=b[1]>A[1]?b:A,y[1]=a.min[1],b=s.aA(s.ek(),y,g),E=b[1]<E[1]?b:E,A=b[1]>A[1]?b:A;const R=s.ay(f[0],0,1),D=100*n.pixelsPerMeter*s.ay(f[1],0,1),F=s.ay(f[2],0,1),N=s.el(s.ek(),E,A,R),j=Math.tan(.5*n.fovX),X=-N[2]*j;if(D===0)return N[1]<-Math.abs(X)?F:1;const W=(-Math.abs(X)-N[1])/D,K=(ie,fe,_e)=>(1-_e)*ie+_e*fe,ee=s.ay(K(1,F,W),F,1);return K(1,ee,s.ay((n.pitch-20)/20,0,1))}class uS{}class dS{constructor(){this._storage=new Map}getLinesFromTrianglesBuffer(n,a,f){{const F=this._storage.get(a.id);if(F)return F.lastUsedFrameIdx=n,F.buf}const g=f.gl,y=g.getBufferParameter(g.ELEMENT_ARRAY_BUFFER,g.BUFFER_SIZE),b=new ArrayBuffer(y),E=new Int16Array(b);g.getBufferSubData(g.ELEMENT_ARRAY_BUFFER,0,new Int16Array(b));const A=new s.en;for(let F=0;F<y/2;F+=3){const N=E[F],j=E[F+1],X=E[F+2];A.emplaceBack(N,j),A.emplaceBack(j,X),A.emplaceBack(X,N)}const R=f.bindVertexArrayOES.current,D=new uS;return D.buf=new ta(f,A),D.lastUsedFrameIdx=n,this._storage.set(a.id,D),f.bindVertexArrayOES.set(R),D.buf}update(n){for(const[a,f]of this._storage)n-f.lastUsedFrameIdx>30&&(f.buf.destroy(),this._storage.delete(a))}destroy(){for(const[n,a]of this._storage)a.buf.destroy(),this._storage.delete(n)}}class I0{constructor(n){this.occluderSize=30,this.depthOffset=-1e-4,n.registerParameter(this,["Occlusion"],"occluderSize",{min:1,max:100,step:1}),n.registerParameter(this,["Occlusion"],"depthOffset",{min:-.05,max:0,step:1e-5})}}const cm=s.d_([{type:"Float32",name:"a_pos_3f",components:3},{type:"Float32",name:"a_uv",components:2},{type:"Float32",name:"a_rainParticleData",components:4}]);class Q_{registerParameter(){}registerButton(){}registerBinding(){}refreshUI(){}}class J_{constructor(n,a){this.revealStart=11,this.revealRange=2,n.registerParameter(this,[...a,"Reveal"],"revealStart",{min:0,max:17,step:.05}),n.registerParameter(this,[...a,"Reveal"],"revealRange",{min:.1,max:5.1,step:.05})}}const P0=s.d_([{type:"Float32",name:"a_pos_2f",components:2}]);class um{destroy(){this.vignetteVx&&this.vignetteVx.destroy(),this.vignetteIdx&&this.vignetteIdx.destroy()}draw(n,a){const f=n.getOrCreateProgram("vignette");if(!this.vignetteVx||!this.vignetteIdx){const b=new s.eo,E=new s.a_;b.emplaceBack(-1,-1),b.emplaceBack(1,-1),b.emplaceBack(1,1),b.emplaceBack(-1,1),E.emplaceBack(0,1,2),E.emplaceBack(0,2,3),this.vignetteVx=n.context.createVertexBuffer(b,P0.members),this.vignetteIdx=n.context.createIndexBuffer(E)}const g=s.bd.simpleSegment(0,0,4,6);if(this.vignetteVx&&this.vignetteIdx){n.uploadCommonUniforms(n.context,f);const b={u_vignetteShape:(y={vignetteShape:[a.start,a.range,Math.pow(10,a.fadePower)],vignetteColor:[a.color.r,a.color.g,a.color.b,a.color.a*a.strength]}).vignetteShape,u_vignetteColor:y.vignetteColor};f.draw(n,n.context.gl.TRIANGLES,Gt.disabled,En.disabled,Zn.alphaBlended,_n.disabled,b,"vignette",this.vignetteVx,this.vignetteIdx,g)}var y}}class of{constructor(){this._accumulatedOffsetX=0,this._accumulatedOffsetY=0,this._accumulatedElevation=0}update(n,a){const f=n.getFreeCameraOptions().position,g=f.toAltitude(),y=f.toLngLat(),b=s.al(y.lng),E=s.al(y.lat),A=n.pixelsPerMeter/a,R=b*s.eq,D=s.eq*Math.log(Math.tan(Math.PI/4+E/2));if(this._offsetXPrev===void 0)this._offsetXPrev=0,this._offsetYPrev=0,this._elevationPrev=0,this._accumulatedOffsetX=0,this._accumulatedOffsetY=0,this._accumulatedElevation=0;else{const F=-this._offsetYPrev+D,N=-this._elevationPrev+g;this._accumulatedOffsetX+=(-this._offsetXPrev+R)*A,this._accumulatedOffsetY+=F*A,this._accumulatedElevation+=N*A,this._offsetXPrev=R,this._offsetYPrev=D,this._elevationPrev=g}}getPosition(){return[this._accumulatedOffsetX,this._accumulatedOffsetY,this._accumulatedElevation]}}function su(h,n){return[-(h[0]-Math.floor(h[0]/n)*n),-(h[1]-Math.floor(h[1]/n)*n),-(h[2]-Math.floor(h[2]/n)*n)]}function ey(h){const n=s.e7(1323123451230),a=[];for(let f=0;f<h;++f){const g=2*n()-1,y=2*n()-1,b=2*n()-1;a.push(s.cS(g,y,b))}return a}function oc(h,n,a,f,g){const y=s.ay((g-a)/(f-a),0,1);return(1-y)*h+y*n}class Bs{constructor(n){this._movement=new of,this._accumulatedTimeFromStart=0,this._prevTime=Date.now()/1e3,this._vignette=new um,this._ppmScaleFactor=n}destroy(){this.particlesVx&&this.particlesVx.destroy(),this.particlesIdx&&this.particlesIdx.destroy(),this._vignette&&this._vignette.destroy()}updateOnRender(n,a){const f=n.transform;this._movement.update(f,this._ppmScaleFactor);const g=f.starsProjMatrix,y=s.b_([]);s.c0(y,y,s.al(90)-f._pitch),s.b$(y,y,-f.angle);const b=s.c3(new Float32Array(16),y),E=s.ep(1,0,0,0,0,0,1,0,0,-1,0,0,0,0,0,1),A=s.ee([],E),R=s.az([],A,b),D=Date.now()/1e3;return this._accumulatedTimeFromStart+=(D-this._prevTime)*a,this._prevTime=D,{projectionMatrix:g,modelviewMatrix:R}}}class hS extends Bs{constructor(n){super(4.25),this._params={overrideStyleParameters:!1,intensity:.5,timeFactor:1,velocityConeAperture:0,velocity:300,boxSize:2500,dropletSizeX:1,dropletSizeYScale:10,distortionStrength:70,screenThinning:{intensity:.57,start:.46,range:1.17,fadePower:.17,affectedRatio:1,particleOffset:-.2},color:{r:.66,g:.68,b:.74,a:.7},direction:{x:-50,y:-35},shapeDirPower:2,shapeNormalPower:1},this._revealParams=new J_(n.tp,["Precipitation","Rain"]),this._vignetteParams={strength:1,start:.7,range:1,fadePower:.4,color:{r:.27,g:.27,b:.27,a:1}},this.particlesCount=16e3}update(n){const a=n.context;if(!this.particlesVx){const f=ey(this.particlesCount),g=new s.er,y=new s.a_;let b=0;const E=s.e7(1323123451230);for(let A=0;A<f.length;++A){const R=f[A],D=[2*E()-1,E(),E(),E()];g.emplaceBack(R[0],R[1],R[2],-1,-1,...D),g.emplaceBack(R[0],R[1],R[2],1,-1,...D),g.emplaceBack(R[0],R[1],R[2],1,1,...D),g.emplaceBack(R[0],R[1],R[2],-1,1,...D),y.emplaceBack(b+0,b+1,b+2),y.emplaceBack(b+0,b+2,b+3),b+=4}this.particlesVx=a.createVertexBuffer(g,cm.members),this.particlesIdx=a.createIndexBuffer(y)}}draw(n){if(!this._params.overrideStyleParameters&&!n.style.rain)return;const a=this._params.overrideStyleParameters?this._revealParams:{revealStart:0,revealRange:.01},f=n.transform.zoom;if(a.revealStart>f)return;const g=oc(0,1,a.revealStart,a.revealStart+a.revealRange,f);if(!this.particlesVx||!this.particlesIdx)return;const y=structuredClone(this._params);let b=[-y.direction.x,y.direction.y,-100];s.au(b,b);const E=structuredClone(this._vignetteParams);E.strength*=g,y.overrideStyleParameters||(y.intensity=n.style.rain.state.density,y.timeFactor=n.style.rain.state.intensity,y.color=structuredClone(n.style.rain.state.color),b=structuredClone(n.style.rain.state.direction),y.screenThinning.intensity=n.style.rain.state.centerThinning,y.dropletSizeX=n.style.rain.state.dropletSize[0],y.dropletSizeYScale=n.style.rain.state.dropletSize[1]/n.style.rain.state.dropletSize[0],y.distortionStrength=100*n.style.rain.state.distortionStrength,E.strength=1,E.color=structuredClone(n.style.rain.state.vignetteColor));const A=this.updateOnRender(n,y.timeFactor),R=n.context,D=R.gl,F=n.transform;this.screenTexture&&this.screenTexture.size[0]===n.width&&this.screenTexture.size[1]===n.height||(this.screenTexture=new s.T(R,{width:n.width,height:n.height,data:null},D.RGBA8)),y.distortionStrength>0&&(R.activeTexture.set(D.TEXTURE0),this.screenTexture.bind(D.LINEAR,D.CLAMP_TO_EDGE),D.copyTexSubImage2D(D.TEXTURE_2D,0,0,0,0,0,n.width,n.height));const N=n.getOrCreateProgram("rainParticle");n.uploadCommonUniforms(R,N),R.activeTexture.set(D.TEXTURE0),this.screenTexture.bind(D.LINEAR,D.CLAMP_TO_EDGE);const j=[y.color.r,y.color.g,y.color.b,y.color.a],X=(W,K)=>{const ee=su(this._movement.getPosition(),W),ie=y.dropletSizeX,fe=y.dropletSizeX*y.dropletSizeYScale,_e=n.width/2,we=n.height/2,be=oc(0,y.screenThinning.start,0,1,y.screenThinning.intensity),ve=oc(.001,y.screenThinning.range,0,1,y.screenThinning.intensity),ye=oc(0,y.screenThinning.particleOffset,0,1,y.screenThinning.intensity),Se=(Ee={modelview:A.modelviewMatrix,projection:A.projectionMatrix,time:this._accumulatedTimeFromStart,camPos:ee,velocityConeAperture:y.velocityConeAperture,velocity:y.velocity,boxSize:W,rainDropletSize:[ie,fe],distortionStrength:y.distortionStrength,rainDirection:b,color:j,screenSize:[F.width,F.height],thinningCenterPos:[_e,we],thinningShape:[be,ve,Math.pow(10,y.screenThinning.fadePower)],thinningAffectedRatio:y.screenThinning.affectedRatio,thinningParticleOffset:ye,shapeDirectionalPower:y.shapeDirPower,shapeNormalPower:y.shapeNormalPower,mode:K?0:1},{u_modelview:Float32Array.from(Ee.modelview),u_projection:Float32Array.from(Ee.projection),u_time:Ee.time,u_cam_pos:Ee.camPos,u_texScreen:0,u_velocityConeAperture:Ee.velocityConeAperture,u_velocity:Ee.velocity,u_boxSize:Ee.boxSize,u_rainDropletSize:Ee.rainDropletSize,u_distortionStrength:Ee.distortionStrength,u_rainDirection:Ee.rainDirection,u_color:Ee.color,u_screenSize:Ee.screenSize,u_thinningCenterPos:Ee.thinningCenterPos,u_thinningShape:Ee.thinningShape,u_thinningAffectedRatio:Ee.thinningAffectedRatio,u_thinningParticleOffset:Ee.thinningParticleOffset,u_shapeDirectionalPower:Ee.shapeDirectionalPower,u_shapeNormalPower:Ee.shapeNormalPower,u_mode:Ee.mode});var Ee;const Fe=Math.round(y.intensity*this.particlesCount),je=s.bd.simpleSegment(0,0,4*Fe,2*Fe);N.draw(n,D.TRIANGLES,Gt.disabled,En.disabled,Zn.alphaBlended,_n.disabled,Se,"rain_particles",this.particlesVx,this.particlesIdx,je)};y.distortionStrength>0&&X(y.boxSize,!0),X(y.boxSize,!1),this._vignette.draw(n,E)}}const af=s.d_([{type:"Float32",name:"a_pos_3f",components:3},{type:"Float32",name:"a_uv",components:2},{type:"Float32",name:"a_snowParticleData",components:4},{type:"Float32",name:"a_snowParticleDataHorizontalOscillation",components:2}]);class ui extends Bs{constructor(n){super(2.25),this._params={overrideStyleParameters:!1,intensity:.85,timeFactor:.75,velocityConeAperture:70,velocity:40,horizontalOscillationRadius:4,horizontalOscillationRate:1.5,boxSize:2e3,billboardSize:2,shapeFadeStart:.27,shapeFadePower:.21,screenThinning:{intensity:.4,start:.15,range:1.4,fadePower:.24,affectedRatio:1,particleOffset:-.2},color:{r:1,g:1,b:1,a:1},direction:{x:-50,y:-35}},this._revealParams=new J_(n.tp,["Precipitation","Snow"]),this._vignetteParams={strength:.3,start:.78,range:.46,fadePower:.2,color:{r:1,g:1,b:1,a:1}},this.particlesCount=16e3}update(n){const a=n.context;if(!this.particlesVx){const f=ey(this.particlesCount),g=new s.es,y=new s.a_;let b=0;const E=s.e7(1323123451230);for(let A=0;A<f.length;++A){const R=f[A],D=E(),F=E(),N=E(),j=[A/f.length,D,F,N],X=[E(),E()];g.emplaceBack(R[0],R[1],R[2],-1,-1,...j,...X),g.emplaceBack(R[0],R[1],R[2],1,-1,...j,...X),g.emplaceBack(R[0],R[1],R[2],1,1,...j,...X),g.emplaceBack(R[0],R[1],R[2],-1,1,...j,...X),y.emplaceBack(b+0,b+1,b+2),y.emplaceBack(b+0,b+2,b+3),b+=4}this.particlesVx=a.createVertexBuffer(g,af.members),this.particlesIdx=a.createIndexBuffer(y)}}draw(n){if(!this._params.overrideStyleParameters&&!n.style.snow)return;const a=structuredClone(this._params);let f=[-a.direction.x,a.direction.y,-100];s.au(f,f);const g=structuredClone(this._vignetteParams),y=a.overrideStyleParameters?this._revealParams:{revealStart:0,revealRange:.01},b=n.transform.zoom;if(y.revealStart>b)return;const E=oc(0,1,y.revealStart,y.revealStart+y.revealRange,b);g.strength*=E,a.overrideStyleParameters||(a.intensity=n.style.snow.state.density,a.timeFactor=n.style.snow.state.intensity,a.color=structuredClone(n.style.snow.state.color),f=structuredClone(n.style.snow.state.direction),a.screenThinning.intensity=n.style.snow.state.centerThinning,a.billboardSize=2.79*n.style.snow.state.flakeSize,g.strength=1,g.color=structuredClone(n.style.snow.state.vignetteColor));const A=this.updateOnRender(n,a.timeFactor);if(!this.particlesVx||!this.particlesIdx)return;const R=n.context,D=R.gl,F=n.transform,N=n.getOrCreateProgram("snowParticle");n.uploadCommonUniforms(R,N),((j,X,W)=>{const K=su(this._movement.getPosition(),j),ee=F.width/2,ie=F.height/2,fe=oc(0,W.screenThinning.start,0,1,W.screenThinning.intensity),_e=oc(.001,W.screenThinning.range,0,1,W.screenThinning.intensity),we=oc(0,W.screenThinning.particleOffset,0,1,W.screenThinning.intensity),be=(ve={modelview:A.modelviewMatrix,projection:A.projectionMatrix,time:this._accumulatedTimeFromStart,camPos:K,velocityConeAperture:W.velocityConeAperture,velocity:W.velocity,horizontalOscillationRadius:W.horizontalOscillationRadius,horizontalOscillationRate:W.horizontalOscillationRate,boxSize:j,billboardSize:1*W.billboardSize,simpleShapeParameters:[W.shapeFadeStart,W.shapeFadePower],screenSize:[F.width,F.height],thinningCenterPos:[ee,ie],thinningShape:[fe,_e,Math.pow(10,W.screenThinning.fadePower)],thinningAffectedRatio:W.screenThinning.affectedRatio,thinningParticleOffset:we,color:[W.color.r,W.color.g,W.color.b,W.color.a],direction:f},{u_modelview:Float32Array.from(ve.modelview),u_projection:Float32Array.from(ve.projection),u_time:ve.time,u_cam_pos:ve.camPos,u_velocityConeAperture:ve.velocityConeAperture,u_velocity:ve.velocity,u_horizontalOscillationRadius:ve.horizontalOscillationRadius,u_horizontalOscillationRate:ve.horizontalOscillationRate,u_boxSize:ve.boxSize,u_billboardSize:ve.billboardSize,u_simpleShapeParameters:ve.simpleShapeParameters,u_screenSize:ve.screenSize,u_thinningCenterPos:ve.thinningCenterPos,u_thinningShape:ve.thinningShape,u_thinningAffectedRatio:ve.thinningAffectedRatio,u_thinningParticleOffset:ve.thinningParticleOffset,u_particleColor:ve.color,u_direction:ve.direction});var ve;const ye=Math.round(W.intensity*this.particlesCount),Se=s.bd.simpleSegment(0,0,4*ye,2*ye);this.particlesVx&&this.particlesIdx&&N.draw(n,D.TRIANGLES,Gt.disabled,En.disabled,Zn.alphaBlended,_n.disabled,be,"snow_particles",this.particlesVx,this.particlesIdx,Se)})(a.boxSize,0,a),this._vignette.draw(n,g)}}const hr={symbol:function(h,n,a,f,g){if(h.renderPass!=="translucent")return;const y=En.disabled,b=h.colorModeForRenderPass(),E=a.layout.get("text-variable-anchor"),A=a.layout.get("text-size-scale-range"),R=s.ay(h.scaleFactor,A[0],A[1]);E&&function(N,j,X,W,K,ee,ie,fe){const _e=j.transform,we=K==="map",be=ee==="map";for(const ve of N){const ye=W.getTile(ve),Se=ye.getBucket(X);if(!Se||!Se.text||!Se.text.segments.get().length)continue;const Ee=s.bH(Se.textSizeData,_e.zoom,fe),Fe=kp(ve,Se.getProjection(),_e),je=_e.calculatePixelsToTileUnitsMatrix(ye),rt=ol(Fe,ye.tileID.canonical,be,we,_e,Se.getProjection(),je),it=Se.hasIconTextFit()&&Se.hasIconData();Ee&&_0(Se,we,be,ie,_e,rt,ve,Math.pow(2,_e.zoom-ye.tileID.overscaledZ),Ee,it)}}(f,h,a,n,a.layout.get("text-rotation-alignment"),a.layout.get("text-pitch-alignment"),g,R);const D=a.paint.get("icon-opacity").constantOr(1)!==0,F=a.paint.get("text-opacity").constantOr(1)!==0;a.layout.get("symbol-sort-key").constantOr(1)!==void 0&&(D||F)?Qu(h,n,a,f,y,b):(D&&Qu(h,n,a,f,y,b,{onlyIcons:!0}),F&&Qu(h,n,a,f,y,b,{onlyText:!0})),n.map.showCollisionBoxes&&(rm(h,n,a,f,a.paint.get("text-translate"),a.paint.get("text-translate-anchor"),!0),rm(h,n,a,f,a.paint.get("icon-translate"),a.paint.get("icon-translate-anchor"),!1))},circle:function(h,n,a,f){if(h.renderPass!=="translucent")return;const g=a.paint.get("circle-opacity"),y=a.paint.get("circle-stroke-width"),b=a.paint.get("circle-stroke-opacity"),E=a.layout.get("circle-sort-key").constantOr(1)!==void 0,A=a.paint.get("circle-emissive-strength");if(g.constantOr(1)===0&&(y.constantOr(1)===0||b.constantOr(1)===0))return;const R=h.context,D=R.gl,F=h.transform,N=!(!h.terrain||!h.terrain.enabled),j=a.layout.get("circle-elevation-reference"),X=h.depthModeForSublayer(0,Gt.ReadOnly),W=new Gt(h.context.gl.LEQUAL,Gt.ReadOnly,h.depthRangeFor3D),K=j==="none"||N?X:W,ee=En.disabled,ie=h.colorModeForDrapableLayerRenderPass(A),fe=F.projection.name==="globe",_e=[s.aD(F.center.lng),s.aH(F.center.lat)],we=[];for(let ve=0;ve<f.length;ve++){const ye=f[ve],Se=n.getTile(ye),Ee=Se.getBucket(a);if(!Ee||Ee.projection.name!==F.projection.name)continue;const Fe=Ee.programConfigurations.get(a.id),je=Ee.layoutVertexBuffer,rt=Ee.globeExtVertexBuffer,it=Ee.indexBuffer,gt=s.dK(a),ze=[rt],Xe=h.isTileAffectedByFog(ye);fe&&gt.push("PROJECTION_GLOBE_VIEW"),gt.push("DEPTH_D24"),h.terrain&&F.depthOcclusionForSymbolsAndCircles&&gt.push("DEPTH_OCCLUSION"),Ee.hasElevation&&(gt.push("ELEVATED_ROADS"),ze.push(Ee.elevatedLayoutVertexBuffer));const Re=h.getOrCreateProgram("circle",{config:Fe,defines:gt,overrideFog:Xe}),ot=F.projection.createInversionMatrix(F,ye.canonical),Ge={programConfiguration:Fe,program:Re,layoutVertexBuffer:je,dynamicBuffers:ze,indexBuffer:it,uniformValues:s.dL(h,ye,Se,ot,_e,a),tile:Se};if(E){const dt=Ee.segments.get();for(const At of dt)we.push({segments:new s.bd([At]),sortKey:At.sortKey,state:Ge})}else we.push({segments:Ee.segments,sortKey:0,state:Ge})}E&&we.sort((ve,ye)=>ve.sortKey-ye.sortKey);const be={useDepthForOcclusion:F.depthOcclusionForSymbolsAndCircles};for(const ve of we){const{programConfiguration:ye,program:Se,layoutVertexBuffer:Ee,dynamicBuffers:Fe,indexBuffer:je,uniformValues:rt,tile:it}=ve.state,gt=ve.segments;h.terrain&&h.terrain.setupElevationDraw(it,Se,be),h.uploadCommonUniforms(R,Se,it.tileID.toUnwrapped()),Se.draw(h,D.TRIANGLES,K,ee,ie,_n.disabled,rt,a.id,Ee,je,gt,a.paint,F.zoom,ye,Fe)}},heatmap:function(h,n,a,f){if(a.paint.get("heatmap-opacity")!==0)if(h.renderPass==="offscreen"){const g=h.context,y=g.gl,b=En.disabled,E=new Zn([y.ONE,y.ONE,y.ONE,y.ONE],s.am.transparent,[!0,!0,!0,!0]);(function(j,X,W,K){const ee=j.gl,ie=X.width*K,fe=X.height*K;j.activeTexture.set(ee.TEXTURE1),j.viewport.set([0,0,ie,fe]);let _e=W.heatmapFbo;if(!_e||_e&&(_e.width!==ie||_e.height!==fe)){_e&&_e.destroy();const we=ee.createTexture();ee.bindTexture(ee.TEXTURE_2D,we),ee.texParameteri(ee.TEXTURE_2D,ee.TEXTURE_WRAP_S,ee.CLAMP_TO_EDGE),ee.texParameteri(ee.TEXTURE_2D,ee.TEXTURE_WRAP_T,ee.CLAMP_TO_EDGE),ee.texParameteri(ee.TEXTURE_2D,ee.TEXTURE_MIN_FILTER,ee.LINEAR),ee.texParameteri(ee.TEXTURE_2D,ee.TEXTURE_MAG_FILTER,ee.LINEAR),_e=W.heatmapFbo=j.createFramebuffer(ie,fe,!0,null),function(be,ve,ye,Se,Ee,Fe){const je=be.gl;je.texImage2D(je.TEXTURE_2D,0,be.extRenderToTextureHalfFloat?je.RGBA16F:je.RGBA,Ee,Fe,0,je.RGBA,be.extRenderToTextureHalfFloat?je.HALF_FLOAT:je.UNSIGNED_BYTE,null),Se.colorAttachment.set(ye)}(j,0,we,_e,ie,fe)}else ee.bindTexture(ee.TEXTURE_2D,_e.colorAttachment.get()),j.bindFramebuffer.set(_e.framebuffer)})(g,h,a,h.transform.projection.name==="globe"?.5:.25),g.clear({color:s.am.transparent});const A=h.transform,R=A.projection.name==="globe",D=R?["PROJECTION_GLOBE_VIEW"]:[],F=R?_n.frontCCW:_n.disabled,N=[s.aD(A.center.lng),s.aH(A.center.lat)];for(let j=0;j<f.length;j++){const X=f[j];if(n.hasRenderableParent(X))continue;const W=n.getTile(X),K=W.getBucket(a);if(!K||K.projection.name!==A.projection.name)continue;const ee=h.isTileAffectedByFog(X),ie=K.programConfigurations.get(a.id),fe=h.getOrCreateProgram("heatmap",{config:ie,defines:D,overrideFog:ee}),{zoom:_e}=h.transform;h.terrain&&h.terrain.setupElevationDraw(W,fe),h.uploadCommonUniforms(g,fe,X.toUnwrapped());const we=A.projection.createInversionMatrix(A,X.canonical);fe.draw(h,y.TRIANGLES,Gt.disabled,b,E,F,h0(h,X,W,we,N,_e,a.paint.get("heatmap-intensity")),a.id,K.layoutVertexBuffer,K.indexBuffer,K.segments,a.paint,h.transform.zoom,ie,R?[K.globeExtVertexBuffer]:null)}g.viewport.set([0,0,h.width,h.height])}else h.renderPass==="translucent"&&(h.context.setColorMode(h.colorModeForRenderPass()),function(g,y){const b=g.context,E=b.gl,A=y.heatmapFbo;if(!A)return;b.activeTexture.set(E.TEXTURE0),E.bindTexture(E.TEXTURE_2D,A.colorAttachment.get()),b.activeTexture.set(E.TEXTURE1);let R=y.colorRampTexture;R||(R=y.colorRampTexture=new s.T(b,y.colorRamp,E.RGBA8)),R.bind(E.LINEAR,E.CLAMP_TO_EDGE),g.getOrCreateProgram("heatmapTexture").draw(g,E.TRIANGLES,Gt.disabled,En.disabled,g.colorModeForRenderPass(),_n.disabled,((D,F,N,j)=>({u_image:0,u_color_ramp:1,u_opacity:F.paint.get("heatmap-opacity")}))(0,y),y.id,g.viewportBuffer,g.quadTriangleIndexBuffer,g.viewportSegments,y.paint,g.transform.zoom)}(h,a))},line:function(h,n,a,f){if(h.renderPass!=="translucent")return;const g=a.paint.get("line-opacity"),y=a.paint.get("line-width");if(g.constantOr(1)===0||y.constantOr(1)===0)return;const b=a.paint.get("line-emissive-strength"),E=a.paint.get("line-occlusion-opacity"),A=a.layout.get("line-elevation-reference"),R=a.layout.get("line-width-unit")==="meters",D=A==="sea",F=!(!h.terrain||!h.terrain.enabled),N=h.context,j=N.gl;if(a.hasElevatedBuckets&&h.transform.projection.name==="globe")return;const X=a.layout.get("line-cross-slope"),W=X!==void 0,K=X<1,ee=h.colorModeForDrapableLayerRenderPass(b),ie=h.terrain&&h.terrain.renderingToTexture,fe=ie?1:s.q.devicePixelRatio,_e=a.paint.get("line-dasharray"),we=_e.constantOr(1),be=a.layout.get("line-cap"),ve=_e.constantOr(null),ye=be.constantOr(null),Se=a.paint.get("line-pattern"),Ee=Se.constantOr(1),Fe=a.paint.get("line-pattern-cross-fade"),je=Se.constantOr(null),rt=a.paint.get("line-opacity").constantOr(1);let it=!Ee&&rt!==1||h.depthOcclusion&&E>0&&E<1;const gt=a.paint.get("line-gradient"),ze=Ee?"linePattern":"line",Xe=s.dM(a);let Re;if(ie&&h.terrain&&h.terrain.clipOrMaskOverlapStencilType()&&(it=!1),E!==0&&h.depthOcclusion){const At=a.paint._values["line-opacity"];At&&At.value&&At.value.kind==="constant"?Re=At.value:s.w(`Occlusion opacity for layer ${a.id} is supported only when line-opacity isn't data-driven.`)}y.value.kind!=="constant"&&y.value.isLineProgressConstant===!1&&Xe.push("VARIABLE_LINE_WIDTH");const ot=(At,st,Tt,qt,Wt,Vt)=>{for(const tn of At){const on=n.getTile(tn);if(Ee&&!on.patternsLoaded())continue;const cn=on.getBucket(a);if(!cn||cn.elevationType!=="none"&&!Wt||cn.elevationType==="none"&&Wt)continue;h.prepareDrawTile();const wn=[...st],Bn=h.shadowRenderer,Ar=cn.elevationType==="road"&&!!Bn&&Bn.enabled;let Zr=[0,0,0];if(Ar){const lr=h.style.directionalLight,Bi=h.style.ambientLight;lr&&Bi&&(Zr=Zc(h.style,lr,Bi)),wn.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET")}const kr=cn.programConfigurations.get(a.id);let zr=!1;if(je&&on.imageAtlas){const lr=s.dN.from(je),Bi=lr.getPrimary().scaleSelf(fe).toString(),ii=on.imageAtlas.patternPositions.get(Bi),Gr=lr.getSecondary(),si=Gr?on.imageAtlas.patternPositions.get(Gr.scaleSelf(fe).toString()):null;zr=!!ii&&!!si,ii&&kr.setConstantPatternPositions(ii,si)}Fe>0&&(zr||kr.getPatternTransitionVertexBuffer("line-pattern"))&&wn.push("LINE_PATTERN_TRANSITION");const Di=h.isTileAffectedByFog(tn),Dn=h.getOrCreateProgram(ze,{config:kr,defines:wn,overrideFog:Di,overrideRtt:!Wt&&void 0});if(!Ee&&ve&&ye&&on.lineAtlas){const lr=on.lineAtlas.getDash(ve,ye);lr&&kr.setConstantPatternPositions(lr)}Ar&&Bn.setupShadows(on.tileID.toUnwrapped(),Dn,"vector-tile",on.tileID.overscaledZ);let[Gn,Jn]=a.paint.get("line-trim-offset");(ye==="round"||ye==="square")&&Gn!==Jn&&(Gn===0&&(Gn-=1),Jn===1&&(Jn+=1));const ri=ie?tn.projMatrix:null,Gi=R?1/cn.tileToMeter/s.aw(on,1,h.transform.zoom):1,Xr=R?1/cn.tileToMeter/s.aw(on,1,Math.floor(h.transform.zoom)):1,yr=Ee?s.dO(h,on,a,ri,fe,Gi,Xr,[Gn,Jn],Zr,Fe):s.dP(h,on,a,ri,cn.lineClipsArray.length,fe,Gi,Xr,[Gn,Jn],Zr);if(gt){const lr=cn.gradients[a.id];let Bi=lr.texture;if(a.gradientVersion!==lr.version){let ii=256;if(a.stepInterpolant){const Gr=n.getSource().maxzoom,si=tn.canonical.z===Gr?Math.ceil(1<<h.transform.maxZoom-tn.canonical.z):1;ii=s.ay(s.dQ(cn.maxLineLength/s.aj*1024*si),256,N.maxTextureSize)}lr.gradient=s.dR({expression:a.gradientExpression(),evaluationKey:"lineProgress",resolution:ii,image:lr.gradient||void 0,clips:cn.lineClipsArray}),lr.texture?lr.texture.update(lr.gradient):lr.texture=new s.T(N,lr.gradient,j.RGBA8),lr.version=a.gradientVersion,Bi=lr.texture}N.activeTexture.set(j.TEXTURE1),Bi.bind(a.stepInterpolant?j.NEAREST:j.LINEAR,j.CLAMP_TO_EDGE)}we&&(N.activeTexture.set(j.TEXTURE0),on.lineAtlasTexture&&on.lineAtlasTexture.bind(j.LINEAR,j.REPEAT),kr.updatePaintBuffers()),Ee&&(N.activeTexture.set(j.TEXTURE0),on.imageAtlasTexture&&on.imageAtlasTexture.bind(j.LINEAR,j.CLAMP_TO_EDGE),kr.updatePaintBuffers()),Wt&&!D&&h.terrain.setupElevationDraw(on,Dn),h.uploadCommonUniforms(N,Dn,tn.toUnwrapped());const Ei=lr=>{Re!=null&&(Re.value=rt*E),Dn.draw(h,j.TRIANGLES,Tt,lr,ee,_n.disabled,yr,a.id,cn.layoutVertexBuffer,cn.indexBuffer,cn.segments,a.paint,h.transform.zoom,kr,[cn.layoutVertexBuffer2,cn.patternVertexBuffer,cn.zOffsetVertexBuffer]),Re!=null&&(Re.value=rt)};if(it&&!Wt){const lr=h.stencilModeForClipping(tn).ref;lr===0&&ie&&N.clear({stencil:0});const Bi={func:j.EQUAL,mask:255};yr.u_alpha_discard_threshold=.8,Ei(new En(Bi,lr,255,j.KEEP,j.KEEP,j.INVERT)),yr.u_alpha_discard_threshold=0,Ei(new En(Bi,lr,255,j.KEEP,j.KEEP,j.KEEP))}else yr.u_alpha_discard_threshold=it&&Wt&&Vt?.8:0,Ei(Wt?qt:h.stencilModeForClipping(tn))}};let Ge=h.depthModeForSublayer(0,Gt.ReadOnly);const dt=new Gt(h.depthOcclusion?j.GREATER:j.LEQUAL,Gt.ReadOnly,h.depthRangeFor3D);if(a.hasNonElevatedBuckets){const At=!ie&&h.terrain;E!==0&&At?s.w(`Occlusion opacity for layer ${a.id} is supported on terrain only if the layer has line-z-offset enabled.`):At?s.w(`Cannot render non-elevated lines in immediate mode when terrain is enabled. Layer: ${a.id}.`):ot(f,Xe,Ge,En.disabled,!1,!0)}if(a.hasElevatedBuckets){A==="hd-road-markup"?F||(Ge=dt,Xe.push("ELEVATED_ROADS")):(Xe.push("ELEVATED"),Ge=dt,W&&Xe.push(K?"CROSS_SLOPE_HORIZONTAL":"CROSS_SLOPE_VERTICAL"),D&&Xe.push("ELEVATION_REFERENCE_SEA"));const At=it?h.stencilModeFor3D():En.disabled;h.forceTerrainMode=!0,ot(f,Xe,Ge,At,!0,!0),it&&ot(f,Xe,Ge,At,!0,!1),h.forceTerrainMode=!1}it&&(h.resetStencilClippingMasks(),ie&&N.clear({stencil:0})),E===0||h.depthOcclusion||ie||h.layersWithOcclusionOpacity.push(h.currentLayer)},fill:function(h,n,a,f){const g=a.paint.get("fill-color"),y=a.paint.get("fill-opacity");if(y.constantOr(1)===0)return;const b=a.paint.get("fill-emissive-strength"),E=h.colorModeForDrapableLayerRenderPass(b),A=a.paint.get("fill-pattern"),R=h.opaquePassEnabledForLayer()&&!A.constantOr(1)&&g.constantOr(s.am.transparent).a===1&&y.constantOr(0)===1?"opaque":"translucent";let D="none";a.layout.get("fill-elevation-reference")!=="none"?D="road":a.paint.get("fill-z-offset").constantOr(1)!==0&&(D="offset");const F=!(!h.terrain||!h.terrain.enabled),N={painter:h,sourceCache:n,layer:a,coords:f,colorMode:E,elevationType:D,terrainEnabled:F,pass:R};if(h.renderPass!=="shadow")if(D!=="offset"){if(Z_(N,!1),D==="road"){const j=!F&&h.renderPass==="translucent";j&&W_(h,n,a,f,"geometry"),Z_(N,!0,En.disabled),j&&function(X){const{painter:W,sourceCache:K,layer:ee,coords:ie,colorMode:fe}=X,_e=W.context.gl,we=X.painter.shadowRenderer,be=!!we&&we.enabled,ve=new Gt(W.context.gl.LEQUAL,Gt.ReadOnly,W.depthRangeFor3D);let ye=[0,0,0];if(be){const Ee=W.style.directionalLight,Fe=W.style.ambientLight;Ee&&Fe&&(ye=Zc(W.style,Ee,Fe))}const Se=Ee=>{for(const Fe of ie){const je=K.getTile(Fe),rt=je.getBucket(ee);if(!rt)continue;const it=rt.elevatedStructures;if(!it)continue;let gt,ze;if(Ee?(gt=it.renderableBridgeSegments,ze=it.bridgeProgramConfigurations.get(ee.id)):(gt=it.renderableTunnelSegments,ze=it.tunnelProgramConfigurations.get(ee.id)),!gt||gt.segments[0].primitiveLength===0)continue;ze.updatePaintBuffers(),W.prepareDrawTile();const Xe=W.isTileAffectedByFog(Fe),Re=[];be&&Re.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET");const ot=W.getOrCreateProgram("elevatedStructures",{config:ze,overrideFog:Xe,defines:Re}),Ge=W.translatePosMatrix(Fe.projMatrix,je,ee.paint.get("fill-translate"),ee.paint.get("fill-translate-anchor"));be&&we.setupShadows(je.tileID.toUnwrapped(),ot,"vector-tile",je.tileID.overscaledZ);const dt=J2(Ge,ye);W.uploadCommonUniforms(W.context,ot,Fe.toUnwrapped()),ot.draw(W,_e.TRIANGLES,ve,En.disabled,fe,_n.backCCW,dt,ee.id,it.vertexBuffer,it.indexBuffer,gt,ee.paint,W.transform.zoom,ze,[it.vertexBufferNormal])}};Se(!0),Se(!1)}(N)}}else Z_(N,!1,h.stencilModeFor3D());else h.shadowRenderer&&D==="road"&&!F&&function(j){const{painter:X,sourceCache:W,layer:K,coords:ee}=j,ie=X.context.gl,fe=j.painter.shadowRenderer;for(const _e of ee){const we=W.getTile(_e),be=we.getBucket(K);if(!be)continue;const ve=be.elevatedStructures;if(!ve||!ve.shadowCasterSegments||ve.shadowCasterSegments.segments[0].primitiveLength===0)continue;X.prepareDrawTile();const ye=be.bufferData.programConfigurations.get(K.id),Se=X.isTileAffectedByFog(_e),Ee=X.getOrCreateProgram("elevatedStructuresDepth",{config:ye,overrideFog:Se}),Fe=fe.calculateShadowPassMatrixFromTile(we.tileID.toUnwrapped());X.uploadCommonUniforms(X.context,Ee,_e.toUnwrapped());const je={u_matrix:Fe,u_depth_bias:.001};Ee.draw(X,ie.TRIANGLES,fe.getShadowPassDepthMode(),En.disabled,fe.getShadowPassColorMode(),_n.disabled,je,K.id,ve.vertexBuffer,ve.indexBuffer,ve.shadowCasterSegments,K.paint,X.transform.zoom,ye)}}(N)},"fill-extrusion":function(h,n,a,f){const g=a.paint.get("fill-extrusion-opacity"),y=h.context,b=y.gl,E=h.terrain,A=E&&E.renderingToTexture;if(g===0)return;const R=h.conflationActive&&h.style.isLayerClipped(a,n.getSource()),D=h.style.order.indexOf(a.fqid);if(R&&function(F,N,j,X,W){for(const K of X){const ee=N.getTile(K).getBucket(j);ee&&(ee.updateReplacement(K,F.replacementSource,W),ee.uploadCentroid(F.context))}}(h,n,a,f,D),E||R)for(const F of f){const N=n.getTile(F).getBucket(a);N&&Ht(h.context,n,F,N,a,E,R)}if(h.renderPass==="shadow"&&h.shadowRenderer){const F=h.shadowRenderer;if(E&&g<.65&&a._transitionablePaint._values["fill-extrusion-opacity"].value.expression instanceof s.ab)return;const N=F.getShadowPassDepthMode(),j=F.getShadowPassColorMode();dl(h,n,a,f,N,En.disabled,j,R)}else if(h.renderPass==="translucent"){const F=!a.paint.get("fill-extrusion-pattern").constantOr(1),N=a.paint.get("fill-extrusion-color").constantOr(s.am.white);if(!A&&N.a!==0){const j=new Gt(h.context.gl.LEQUAL,Gt.ReadWrite,h.depthRangeFor3D);g===1&&F?dl(h,n,a,f,j,En.disabled,Zn.unblended,R):(dl(h,n,a,f,j,En.disabled,Zn.disabled,R),dl(h,n,a,f,j,h.stencilModeFor3D(),h.colorModeForRenderPass(),R),h.resetStencilClippingMasks())}if(h.style.enable3dLights()&&F&&(!E&&h.transform.projection.name!=="globe"||A)){const j=a.paint.get("fill-extrusion-opacity"),X=a.paint.get("fill-extrusion-ambient-occlusion-intensity"),W=a.paint.get("fill-extrusion-ambient-occlusion-ground-radius"),K=a.paint.get("fill-extrusion-flood-light-intensity"),ee=a.paint.get("fill-extrusion-flood-light-color-use-theme").constantOr("default")==="none",ie=a.paint.get("fill-extrusion-flood-light-color").toNonPremultipliedRenderColor(ee?null:a.lut).toArray01().slice(0,3),fe=X>0&&W>0,_e=K>0,we=(ve,ye,Se)=>(1-Se)*ve+Se*ye,be=ve=>{const ye=h.depthModeForSublayer(1,Gt.ReadOnly,b.LEQUAL,!0),Se=a.paint.get(ve?"fill-extrusion-ambient-occlusion-ground-attenuation":"fill-extrusion-flood-light-ground-attenuation"),Ee=we(.1,3,Se),Fe=h._showOverdrawInspector;if(!Fe){const je=new En({func:b.ALWAYS,mask:255},255,255,b.KEEP,b.KEEP,b.REPLACE),rt=new Zn([b.ONE,b.ONE,b.ONE,b.ONE],s.am.transparent,[!1,!1,!1,!0],b.MIN);hl(h,n,a,f,ye,je,rt,_n.disabled,ve,"sdf",j,X,W,K,ie,Ee,R,!1)}{const je=Fe?En.disabled:new En({func:b.EQUAL,mask:255},255,255,b.KEEP,b.DECR,b.DECR),rt=Fe?h.colorModeForRenderPass():new Zn([b.ONE_MINUS_DST_ALPHA,b.DST_ALPHA,b.ONE,b.ONE],s.am.transparent,[!0,!0,!0,!0]);hl(h,n,a,f,ye,je,rt,_n.disabled,ve,"color",j,X,W,K,ie,Ee,R,!1)}};if(A){const ve=(ye,Se,Ee)=>{const Fe=h.depthModeForSublayer(1,Gt.ReadOnly,b.LEQUAL,!1),je=a.paint.get(ye?"fill-extrusion-ambient-occlusion-ground-attenuation":"fill-extrusion-flood-light-ground-attenuation"),rt=we(.1,3,je);{const it=new Zn([b.ONE,b.ONE,b.ONE,b.ONE],s.am.transparent,[!1,!1,!1,!0]);hl(h,n,a,f,Fe,En.disabled,it,_n.disabled,ye,"clear",j,X,W,K,ie,rt,R,Se)}{const it=new En({func:b.ALWAYS,mask:255},255,255,b.KEEP,b.KEEP,b.REPLACE),gt=new Zn([b.ONE,b.ONE,b.ONE,b.ONE],s.am.transparent,[!1,!1,!1,!0],b.MIN);hl(h,n,a,f,Fe,it,gt,_n.disabled,ye,"sdf",j,X,W,K,ie,rt,R,Se)}{const it=ye?b.ZERO:b.ONE_MINUS_DST_ALPHA,gt=new En({func:b.EQUAL,mask:255},255,255,b.KEEP,b.DECR,b.DECR),ze=new Zn([it,b.DST_ALPHA,b.ONE_MINUS_DST_ALPHA,b.ZERO],s.am.transparent,[!0,!0,!0,!0]);hl(h,n,a,f,Fe,gt,ze,_n.disabled,ye,"color",j,X,W,K,ie,rt,R,Se)}{const it=new Zn([b.ONE,b.ONE,b.ONE,ye?b.ZERO:b.ONE],s.am.transparent,[!1,!1,!1,!0],ye?b.FUNC_ADD:b.MAX);hl(h,n,a,f,Fe,En.disabled,it,_n.disabled,ye,"clear",j,X,W,K,ie,rt,R,Se,Ee)}};if(fe||_e){let ye;if(h.prepareDrawTile(),E){const Se=E.drapeBufferSize[0],Ee=E.drapeBufferSize[1];ye=E.framebufferCopyTexture,ye&&(!ye||ye.size[0]===Se&&ye.size[1]===Ee)||(ye&&ye.destroy(),ye=E.framebufferCopyTexture=new s.T(y,new s.r({width:Se,height:Ee}),b.RGBA8)),ye.bind(b.LINEAR,b.CLAMP_TO_EDGE),b.copyTexSubImage2D(b.TEXTURE_2D,0,0,0,0,0,Se,Ee)}fe&&ve(!0,!1,ye),_e&&ve(!1,!0,ye)}}else fe&&be(!0),_e&&be(!1),(fe||_e)&&h.resetStencilClippingMasks()}}},building:function(h,n,a,f){},hillshade:function(h,n,a,f){if(h.renderPass!=="offscreen"&&h.renderPass!=="translucent"||h.style.disableElevatedTerrain)return;const g=h.context,y=h.terrain&&h.terrain.renderingToTexture,[b,E]=h.renderPass!=="translucent"||y?[{},f]:h.stencilConfigForOverlap(f);for(const A of E){const R=n.getTile(A);if(R.needsHillshadePrepare&&h.renderPass==="offscreen")V2(h,R,a);else if(h.renderPass==="translucent"){const D=h.depthModeForSublayer(0,Gt.ReadOnly),F=a.paint.get("hillshade-emissive-strength"),N=h.colorModeForDrapableLayerRenderPass(F),j=y&&h.terrain?h.terrain.stencilModeForRTTOverlap(A):b[A.overscaledZ];B2(h,A,R,a,D,j,N)}}g.viewport.set([0,0,h.width,h.height]),h.resetStencilClippingMasks()},raster:function(h,n,a,f,g,y){if(h.renderPass!=="translucent"||a.paint.get("raster-opacity")===0)return;const b=h.transform.projection.name==="globe",E=a.paint.get("raster-elevation")!==0,A=E&&b;if(h.renderElevatedRasterBackface&&!A)return;const R=h.context,D=R.gl,F=n.getSource(),N=function(be,ve,ye,Se){const Ee=ve.paint.get("raster-color"),Fe=be.type==="raster-array",je=[],rt=ve.paint.get("raster-resampling"),it=ve.paint.get("raster-color-mix");let gt=ve.paint.get("raster-color-range");const ze=[it[0],it[1],it[2],0],Xe=it[3];let Re=rt==="nearest"?Se.NEAREST:Se.LINEAR;if(Fe&&(je.push("RASTER_ARRAY"),Ee||je.push("RASTER_COLOR"),rt==="linear"&&je.push("RASTER_ARRAY_LINEAR"),Re=Se.NEAREST,!gt&&be.rasterLayers)){const ot=be.rasterLayers.find(({id:Ge})=>Ge===ve.sourceLayer);ot&&ot.fields&&ot.fields.range&&(gt=ot.fields.range)}if(gt=gt||[0,1],Ee){je.push("RASTER_COLOR"),ye.activeTexture.set(Se.TEXTURE2),ve.updateColorRamp(gt);let ot=ve.colorRampTexture;ot||(ot=ve.colorRampTexture=new s.T(ye,ve.colorRamp,Se.RGBA8)),ot.bind(Se.LINEAR,Se.CLAMP_TO_EDGE)}return{mix:ze,range:gt,offset:Xe,defines:je,resampling:Re}}(F,a,R,D);if(F instanceof s.aP&&!f.length&&!b)return;const j=a.paint.get("raster-emissive-strength"),X=h.colorModeForDrapableLayerRenderPass(j),W=h.terrain&&h.terrain.renderingToTexture,K=!h.options.moving,ee=a.paint.get("raster-resampling")==="nearest"?D.NEAREST:D.LINEAR;if(F instanceof s.aP&&!f.length&&(F.onNorthPole||F.onSouthPole)){const be=E?h.stencilModeFor3D():En.disabled;return void rf(!!F.onNorthPole,null,h,n,a,j,N,_n.disabled,be)}if(!f.length)return;const[ie,fe]=F instanceof s.aP||W?[{},f]:h.stencilConfigForOverlap(f),_e=fe[fe.length-1].overscaledZ;A&&N.defines.push("PROJECTION_GLOBE_VIEW"),E&&N.defines.push("RENDER_CUTOFF");const we=(be,ve,ye)=>{for(const Se of be){const Ee=Se.toUnwrapped(),Fe=n.getTile(Se);if(W&&(!Fe||!Fe.hasData()))continue;R.activeTexture.set(D.TEXTURE0);const je=sS(Fe,F,a,N);if(!je||!je.texture)continue;const{texture:rt,mix:it,offset:gt,tileSize:ze,buffer:Xe}=je;let Re,ot;W?(Re=Gt.disabled,ot=Se.projMatrix):E?(Re=new Gt(D.LEQUAL,Gt.ReadWrite,h.depthRangeFor3D),ot=b?Float32Array.from(h.transform.expandedFarZProjMatrix):h.transform.calculateProjMatrix(Ee,K)):(Re=h.depthModeForSublayer(Se.overscaledZ-_e,a.paint.get("raster-opacity")===1?Gt.ReadWrite:Gt.ReadOnly,D.LESS),ot=h.transform.calculateProjMatrix(Ee,K));const Ge=h.terrain&&W?h.terrain.stencilModeForRTTOverlap(Se):ie[Se.overscaledZ],dt=y?0:a.paint.get("raster-fade-duration");Fe.registerFadeDuration(dt);const At=n.findLoadedParent(Se,0),st=Qc(Fe,At,n,h.transform,dt);let Tt,qt;h.terrain&&h.terrain.prepareDrawTile(),R.activeTexture.set(D.TEXTURE0),rt.bind(ee,D.CLAMP_TO_EDGE),R.activeTexture.set(D.TEXTURE1),At?(At.texture&&At.texture.bind(ee,D.CLAMP_TO_EDGE),Tt=Math.pow(2,At.tileID.overscaledZ-Fe.tileID.overscaledZ),qt=[Fe.tileID.canonical.x*Tt%1,Fe.tileID.canonical.y*Tt%1]):rt.bind(ee,D.CLAMP_TO_EDGE),"useMipmap"in rt&&R.extTextureFilterAnisotropic&&h.transform.pitch>20&&D.texParameterf(D.TEXTURE_2D,R.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,R.extTextureFilterAnisotropicMax);const Wt=h.transform;let Vt;const tn=E?iS(Wt):[0,0,0,0];let on,cn,wn,Bn,Ar,Zr=0;if(A&&F instanceof s.aP&&F.coordinates.length>3)on=Float32Array.from(s.bh(s.dr(new s.cp(0,0,0)))),cn=Float32Array.from(Wt.globeMatrix),wn=Float32Array.from(s.dm(Wt)),Bn=[s.aD(Wt.center.lng),s.aH(Wt.center.lat)],Vt=F.elevatedGlobePerspectiveTransform,Ar=F.elevatedGlobeGridMatrix||new Float32Array(9);else if(A){const Dn=s.dn(Se.canonical);Zr=s.dp(Dn.getCenter().lat),on=Float32Array.from(s.bh(s.dr(Se.canonical))),cn=Float32Array.from(Wt.globeMatrix),wn=Float32Array.from(s.dm(Wt)),Bn=[s.aD(Wt.center.lng),s.aH(Wt.center.lat)],Vt=[0,0],Ar=Float32Array.from(s.dq(Se.canonical,Dn,Zr,Wt.worldSize/Wt._pixelsPerMercatorPixel))}else Vt=F instanceof s.aP?F.perspectiveTransform:[0,0],on=new Float32Array(16),cn=new Float32Array(9),wn=new Float32Array(16),Bn=[0,0],Ar=new Float32Array(9);const kr=$_(ot,on,cn,wn,Ar,qt||[0,0],s.ah(h.transform.zoom),Bn,tn,Tt||1,st,a,Vt,E?a.paint.get("raster-elevation"):0,2,it,gt,N.range,ze,Xe,j),zr=h.isTileAffectedByFog(Se),Di=h.getOrCreateProgram("raster",{defines:N.defines,overrideFog:zr});if(h.uploadCommonUniforms(R,Di,Ee),F instanceof s.aP){const Dn=F.elevatedGlobeVertexBuffer,Gn=F.elevatedGlobeIndexBuffer;if(W||!b)F.boundsBuffer&&F.boundsSegments&&Di.draw(h,D.TRIANGLES,Re,En.disabled,X,_n.disabled,kr,a.id,F.boundsBuffer,h.quadTriangleIndexBuffer,F.boundsSegments);else if(Dn&&Gn){const Jn=Wt.zoom<=s.cL?F.elevatedGlobeSegments:F.getSegmentsForLongitude(Wt.center.lng);Jn&&Di.draw(h,D.TRIANGLES,Re,En.disabled,X,ve,kr,a.id,Dn,Gn,Jn)}}else if(A){Re=new Gt(D.LEQUAL,Gt.ReadOnly,h.depthRangeFor3D);const Dn=h.globeSharedBuffers;if(Dn){const[Gn,Jn,ri]=Dn.getGridBuffers(Zr,!1);Di.draw(h,D.TRIANGLES,Re,ye||Ge,h.colorModeForRenderPass(),ve,kr,a.id,Gn,Jn,ri)}}else{const{tileBoundsBuffer:Dn,tileBoundsIndexBuffer:Gn,tileBoundsSegments:Jn}=h.getTileBoundsBuffers(Fe);Di.draw(h,D.TRIANGLES,Re,Ge,X,_n.disabled,kr,a.id,Dn,Gn,Jn)}}if(!(F instanceof s.aP)&&A)for(const Se of be){const Ee=Se.canonical.y===(1<<Se.canonical.z)-1;Se.canonical.y===0&&rf(!0,Se,h,n,a,j,N,ve,ye||En.disabled),Ee&&rf(!1,Se,h,n,a,j,N,ve===_n.frontCW?_n.backCW:_n.frontCW,ye||En.disabled)}};A?we(fe,h.renderElevatedRasterBackface?_n.backCW:_n.frontCW,h.stencilModeFor3D()):we(fe,_n.disabled,void 0),h.resetStencilClippingMasks()},"raster-particle":function(h,n,a,f,g,y){h.renderPass==="offscreen"&&function(b,E,A,R){if(!R.length)return;const D=b.context,F=D.gl,N=E.getSource();if(!(N instanceof Zl))return;const j=Math.ceil(Math.sqrt(A.paint.get("raster-particle-count")));let X=A.particlePositionRGBAImage;if(!X||X.width!==j){const fe=function(_e){const we=_e*_e,be=new Uint8Array(4*we),ve=function(Se){return Se|=0,Se=Math.imul(2747636419^Se,2654435769),Se=Math.imul(Se^Se>>>16,2654435769),((Se=Math.imul(Se^Se>>>16,2654435769))>>>0)/4294967296},ye=1/1.1;for(let Se=0;Se<we;Se++){const Ee=ye*(ve(2*Se+0)+tc),Fe=ye*(ve(2*Se+1)+tc),je=255*Ee%1,rt=255*Fe%1,it=je,gt=Fe-rt/255,ze=rt;be[4*Se+0]=255*(Ee-je/255),be[4*Se+1]=255*it,be[4*Se+2]=255*gt,be[4*Se+3]=255*ze}return be}(j);X=A.particlePositionRGBAImage=new s.r({width:j,height:j},fe)}let W=A.particleFramebuffer;W?W.width!==j&&(W.destroy(),W=A.particleFramebuffer=D.createFramebuffer(j,j,!0,null)):W=A.particleFramebuffer=D.createFramebuffer(j,j,!0,null);const K=[];for(const fe of R){const _e=E.getTile(fe);if(!(_e instanceof ku))continue;const we=oS(_e,N,A);if(!we)continue;const be=[_e.tileSize,_e.tileSize];let ve=A.tileFramebuffer;ve||(ve=A.tileFramebuffer=D.createFramebuffer(be[0],be[1],!0,null));let ye=_e.rasterParticleState;ye||(ye=_e.rasterParticleState=new x0(D,fe,be,X));const Se=ye.update(A.lastInvalidatedAt);ye.particleTextureDimension!==j&&ye.updateParticleTexture(fe,X);const Ee=ye.targetColorTexture;ye.targetColorTexture=ye.backgroundColorTexture,ye.backgroundColorTexture=Ee;const Fe=ye.particleTexture0;ye.particleTexture0=ye.particleTexture1,ye.particleTexture1=Fe,K.push([fe,we,ye,Se])}if(K.length===0)return;const ee=s.q.now(),ie=A.previousDrawTimestamp?.001*(ee-A.previousDrawTimestamp):.0167;if(A.previousDrawTimestamp=ee,A.hasColorMap()){D.activeTexture.set(F.TEXTURE0+2);let fe=A.colorRampTexture;fe||(fe=A.colorRampTexture=new s.T(D,A.colorRamp,F.RGBA8)),fe.bind(F.LINEAR,F.CLAMP_TO_EDGE)}D.bindFramebuffer.set(A.tileFramebuffer.framebuffer),function(fe,_e,we){const be=fe.context,ve=be.gl,ye=_e.tileFramebuffer;be.activeTexture.set(ve.TEXTURE0);const Se={u_texture:0,u_opacity:1.05*(Fe=_e.paint.get("raster-particle-fade-opacity-factor"))/(Fe+.05)},Ee=fe.getOrCreateProgram("rasterParticleTexture",{defines:[],overrideFog:!1});var Fe;for(const je of we){const[,,rt,it]=je;ye.colorAttachment.set(rt.targetColorTexture.texture),be.viewport.set([0,0,ye.width,ye.height]),be.clear({color:s.am.transparent}),it&&(rt.backgroundColorTexture.bind(ve.NEAREST,ve.CLAMP_TO_EDGE),Ee.draw(fe,ve.TRIANGLES,Gt.disabled,En.disabled,Zn.alphaBlended,_n.disabled,Se,_e.id,fe.viewportBuffer,fe.quadTriangleIndexBuffer,fe.viewportSegments))}}(b,A,K),function(fe,_e,we,be){const ve=fe.context,ye=ve.gl,Se=we.tileFramebuffer,Ee=fe.transform.projection.name==="globe",Fe=we.paint.get("raster-particle-max-speed");for(const je of be){const[rt,it,gt]=je;ve.activeTexture.set(ye.TEXTURE0+0),it.texture.bind(ye.LINEAR,ye.CLAMP_TO_EDGE),Se.colorAttachment.set(gt.targetColorTexture.texture);const ze=fe.getOrCreateProgram("rasterParticleDraw",{defines:it.defines,overrideFog:!1});ve.activeTexture.set(ye.TEXTURE0+1);const Xe=it.scalarData?[]:[0,1,2,3].map(Ge=>s.dT[Ge](rt));Xe.push(rt);const Re=rt.canonical.x,ot=rt.canonical.y;for(const Ge of Xe){const dt=_e.getTile(Ee?Ge.wrapped():Ge);if(!dt)continue;const At=dt.rasterParticleState;if(!At)continue;const st=Ge.canonical.x+(1<<Ge.canonical.z)*(Ge.wrap-rt.wrap),Tt=Ge.canonical.y;At.particleTexture0.bind(ye.NEAREST,ye.CLAMP_TO_EDGE);const qt=p0(1,At.particleTexture0.size[0],[st-Re,Tt-ot],0,it.texture.size,2,Fe,it.textureOffset,it.scale,it.offset);ze.draw(fe,ye.POINTS,Gt.disabled,En.disabled,Zn.alphaBlended,_n.disabled,qt,we.id,At.particleIndexBuffer,void 0,At.particleSegment)}}}(b,E,A,K),D.bindFramebuffer.set(A.particleFramebuffer.framebuffer),function(fe,_e,we,be){const ve=fe.context,ye=ve.gl,Se=_e.paint.get("raster-particle-max-speed"),Ee=be*_e.paint.get("raster-particle-speed-factor")*.15,Fe=function(rt){return Math.pow(rt,6)}(.01+1*_e.paint.get("raster-particle-reset-rate-factor")),je=_e.particleFramebuffer;ve.viewport.set([0,0,je.width,je.height]);for(const rt of we){const[,it,gt]=rt;ve.activeTexture.set(ye.TEXTURE0+0),it.texture.bind(ye.LINEAR,ye.CLAMP_TO_EDGE),ve.activeTexture.set(ye.TEXTURE0+1);const ze=gt.particleTexture0;ze.bind(ye.NEAREST,ye.CLAMP_TO_EDGE);const Xe=nc(1,ze.size[0],0,it.texture.size,Se,Ee,Fe,it.textureOffset,it.scale,it.offset);je.colorAttachment.set(gt.particleTexture1.texture),ve.clear({color:s.am.transparent}),fe.getOrCreateProgram("rasterParticleUpdate",{defines:it.defines}).draw(fe,ye.TRIANGLES,Gt.disabled,En.disabled,Zn.unblended,_n.disabled,Xe,_e.id,fe.viewportBuffer,fe.quadTriangleIndexBuffer,fe.viewportSegments)}}(b,A,K,ie)}(h,n,a,f),h.renderPass==="translucent"&&(function(b,E,A,R,D){const F=b.context,N=F.gl,j=E.getSource().tileSize,X=5*(1-s.af(s.cx,s.cx+1,b.transform.zoom))*j+A.paint.get("raster-particle-elevation"),W=!b.options.moving,K=b.transform.projection.name==="globe";if(!R.length)return;const[ee,ie]=b.stencilConfigForOverlap(R),fe=[];K&&fe.push("PROJECTION_GLOBE_VIEW");const _e=b.stencilModeFor3D();for(const we of ie){const be=we.toUnwrapped(),ve=E.getTile(we);if(!ve.rasterParticleState)continue;const ye=ve.rasterParticleState,Se=100;ve.registerFadeDuration(Se);const Ee=E.findLoadedParent(we,0),Fe=Qc(ve,Ee,E,b.transform,Se);let je,rt;b.terrain&&b.terrain.prepareDrawTile(),F.activeTexture.set(N.TEXTURE0),ye.targetColorTexture.bind(N.LINEAR,N.CLAMP_TO_EDGE),F.activeTexture.set(N.TEXTURE1),Ee&&Ee.rasterParticleState?(Ee.rasterParticleState.targetColorTexture.bind(N.LINEAR,N.CLAMP_TO_EDGE),je=Math.pow(2,Ee.tileID.overscaledZ-ve.tileID.overscaledZ),rt=[ve.tileID.canonical.x*je%1,ve.tileID.canonical.y*je%1]):ye.targetColorTexture.bind(N.LINEAR,N.CLAMP_TO_EDGE);const it=K?Float32Array.from(b.transform.expandedFarZProjMatrix):b.transform.calculateProjMatrix(be,W),gt=b.transform,ze=b0(gt),Xe=s.dn(we.canonical),Re=s.dp(Xe.getCenter().lat);let ot,Ge,dt,At,st;K?(ot=Float32Array.from(s.bh(s.dr(we.canonical))),Ge=Float32Array.from(gt.globeMatrix),dt=Float32Array.from(s.dm(gt)),At=[s.aD(gt.center.lng),s.aH(gt.center.lat)],st=Float32Array.from(s.dq(we.canonical,Xe,Re,gt.worldSize/gt._pixelsPerMercatorPixel))):(ot=new Float32Array(16),Ge=new Float32Array(9),dt=new Float32Array(16),At=[0,0],st=new Float32Array(9));const Tt=tu(it,ot,Ge,dt,st,rt||[0,0],s.ah(b.transform.zoom),At,ze,je||1,Fe,X),qt=b.isTileAffectedByFog(we),Wt=b.getOrCreateProgram("rasterParticle",{defines:fe,overrideFog:qt});if(b.uploadCommonUniforms(F,Wt,be),K){const Vt=new Gt(N.LEQUAL,Gt.ReadOnly,b.depthRangeFor3D),tn=0,on=b.globeSharedBuffers;if(on){const[cn,wn,Bn]=on.getGridBuffers(Re,tn!==0);Wt.draw(b,N.TRIANGLES,Vt,_e,Zn.alphaBlended,b.renderElevatedRasterBackface?_n.frontCCW:_n.backCCW,Tt,A.id,cn,wn,Bn)}}else{const Vt=b.depthModeForSublayer(0,Gt.ReadOnly),tn=ee[we.overscaledZ],{tileBoundsBuffer:on,tileBoundsIndexBuffer:cn,tileBoundsSegments:wn}=b.getTileBoundsBuffers(ve);Wt.draw(b,N.TRIANGLES,Vt,tn,Zn.alphaBlended,_n.disabled,Tt,A.id,on,cn,wn)}}b.resetStencilClippingMasks()}(h,n,a,f),h.style.map.triggerRepaint())},background:function(h,n,a,f){const g=a.paint.get("background-color"),y=a.paint.get("background-color-use-theme").constantOr("default")==="none",b=a.paint.get("background-opacity"),E=a.paint.get("background-emissive-strength"),A=a.paint.get("background-pitch-alignment")==="viewport";if(b===0)return;const R=h.context,D=R.gl,F=h.transform,N=F.tileSize,j=a.paint.get("background-pattern");let X;if(j!==void 0&&(j===null||(X=h.imageManager.getPattern(s.I.from(j.toString()),a.scope,h.style.getLut(a.scope)),!X)))return;const W=!j&&g.a===1&&b===1&&h.opaquePassEnabledForLayer()?"opaque":"translucent";if(h.renderPass!==W)return;const K=En.disabled,ee=h.depthModeForSublayer(0,W==="opaque"?Gt.ReadWrite:Gt.ReadOnly),ie=h.colorModeForDrapableLayerRenderPass(E),fe=j?"backgroundPattern":"background";let _e,we=f;if(we||(_e=h.getBackgroundTiles(),we=Object.values(_e).map(be=>be.tileID)),j&&(R.activeTexture.set(D.TEXTURE0),h.imageManager.bind(h.context,a.scope)),A){const be=h.getOrCreateProgram(fe,{overrideFog:!1,overrideRtt:!0}),ve=new Float32Array(s.bx([])),ye=new s.aM(0,0,0,0,0),Se=j?H_(ve,E,b,h,0,a.scope,X,A,{tileID:ye,tileSize:N}):G_(ve,E,b,g.toPremultipliedRenderColor(y?null:a.lut));be.draw(h,D.TRIANGLES,ee,K,ie,_n.disabled,Se,a.id,h.viewportBuffer,h.quadTriangleIndexBuffer,h.viewportSegments)}else for(const be of we){const ve=h.isTileAffectedByFog(be),ye=h.getOrCreateProgram(fe,{overrideFog:ve}),Se=be.toUnwrapped(),Ee=f?be.projMatrix:h.transform.calculateProjMatrix(Se);h.prepareDrawTile();const Fe=n?n.getTile(be):_e?_e[be.key]:new jc(be,N,F.zoom,h),je=j?H_(Ee,E,b,h,0,a.scope,X,A,{tileID:be,tileSize:N}):G_(Ee,E,b,g.toPremultipliedRenderColor(y?null:a.lut));h.uploadCommonUniforms(R,ye,Se);const{tileBoundsBuffer:rt,tileBoundsIndexBuffer:it,tileBoundsSegments:gt}=h.getTileBoundsBuffers(Fe);ye.draw(h,D.TRIANGLES,ee,K,ie,_n.disabled,je,a.id,rt,it,gt)}},sky:function(h,n,a){const f=h._atmosphere?s.ah(h.transform.zoom):1,g=a.paint.get("sky-opacity")*f;if(g===0)return;const y=h.context,b=a.paint.get("sky-type"),E=new Gt(y.gl.LEQUAL,Gt.ReadOnly,[0,1]),A=h.frameCounter/1e3%1;b==="atmosphere"?h.renderPass==="offscreen"?a.needsSkyboxCapture(h)&&(function(R,D,F,N){const j=R.context,X=j.gl;let W=D.skyboxFbo;if(!W){W=D.skyboxFbo=j.createFramebuffer(32,32,!0,null),D.skyboxGeometry=new sf(j),D.skyboxTexture=j.gl.createTexture(),X.bindTexture(X.TEXTURE_CUBE_MAP,D.skyboxTexture),X.texParameteri(X.TEXTURE_CUBE_MAP,X.TEXTURE_WRAP_S,X.CLAMP_TO_EDGE),X.texParameteri(X.TEXTURE_CUBE_MAP,X.TEXTURE_WRAP_T,X.CLAMP_TO_EDGE),X.texParameteri(X.TEXTURE_CUBE_MAP,X.TEXTURE_MIN_FILTER,X.LINEAR),X.texParameteri(X.TEXTURE_CUBE_MAP,X.TEXTURE_MAG_FILTER,X.LINEAR);for(let fe=0;fe<6;++fe)X.texImage2D(X.TEXTURE_CUBE_MAP_POSITIVE_X+fe,0,X.RGBA,32,32,0,X.RGBA,X.UNSIGNED_BYTE,null)}j.bindFramebuffer.set(W.framebuffer),j.viewport.set([0,0,32,32]);const K=D.getCenter(R,!0),ee=R.getOrCreateProgram("skyboxCapture"),ie=new Float64Array(16);s.bx(ie),s.e3(ie,ie,.5*-Math.PI),sc(R,D,ee,ie,K,0),s.bx(ie),s.e3(ie,ie,.5*Math.PI),sc(R,D,ee,ie,K,1),s.bx(ie),s.cG(ie,ie,.5*-Math.PI),sc(R,D,ee,ie,K,2),s.bx(ie),s.cG(ie,ie,.5*Math.PI),sc(R,D,ee,ie,K,3),s.bx(ie),sc(R,D,ee,ie,K,4),s.bx(ie),s.e3(ie,ie,Math.PI),sc(R,D,ee,ie,K,5),j.viewport.set([0,0,R.width,R.height])}(h,a),a.markSkyboxValid(h)):h.renderPass==="sky"&&function(R,D,F,N,j){const X=R.context,W=X.gl,K=R.transform,ee=R.getOrCreateProgram("skybox");X.activeTexture.set(W.TEXTURE0),W.bindTexture(W.TEXTURE_CUBE_MAP,D.skyboxTexture);const ie=((fe,_e,we,be,ve)=>({u_matrix:fe,u_sun_direction:_e,u_cubemap:0,u_opacity:be,u_temporal_offset:ve}))(K.skyboxMatrix,D.getCenter(R,!1),0,N,j);R.uploadCommonUniforms(X,ee),ee.draw(R,W.TRIANGLES,F,En.disabled,R.colorModeForRenderPass(),_n.backCW,ie,"skybox",D.skyboxGeometry.vertexBuffer,D.skyboxGeometry.indexBuffer,D.skyboxGeometry.segment)}(h,a,E,g,A):b==="gradient"&&h.renderPass==="sky"&&function(R,D,F,N,j){const X=R.context,W=X.gl,K=R.transform,ee=R.getOrCreateProgram("skyboxGradient");D.skyboxGeometry||(D.skyboxGeometry=new sf(X)),X.activeTexture.set(W.TEXTURE0);let ie=D.colorRampTexture;ie||(ie=D.colorRampTexture=new s.T(X,D.colorRamp,W.RGBA8)),ie.bind(W.LINEAR,W.CLAMP_TO_EDGE);const fe=((_e,we,be,ve,ye)=>({u_matrix:_e,u_color_ramp:0,u_center_direction:we,u_radius:s.al(be),u_opacity:ve,u_temporal_offset:ye}))(K.skyboxMatrix,D.getCenter(R,!1),D.paint.get("sky-gradient-radius"),N,j);R.uploadCommonUniforms(X,ee),ee.draw(R,W.TRIANGLES,F,En.disabled,R.colorModeForRenderPass(),_n.backCW,fe,"skyboxGradient",D.skyboxGeometry.vertexBuffer,D.skyboxGeometry.indexBuffer,D.skyboxGeometry.segment)}(h,a,E,g,A)},custom:function(h,n,a,f){const g=h.context,y=a.implementation;if(!h.transform.projection.unsupportedLayers||!h.transform.projection.unsupportedLayers.includes("custom")||h.terrain&&(h.terrain.renderingToTexture||h.renderPass==="offscreen")&&a.isDraped(n)){if(h.renderPass==="offscreen"){const b=y.prerender;if(b){if(h.setCustomLayerDefaults(),g.setColorMode(h.colorModeForRenderPass()),h.transform.projection.name==="globe"){const E=h.transform.pointMerc;b.call(y,g.gl,h.transform.customLayerMatrix(),h.transform.getProjection(),h.transform.globeToMercatorMatrix(),s.ah(h.transform.zoom),[E.x,E.y],h.transform.pixelsPerMeterRatio)}else b.call(y,g.gl,h.transform.customLayerMatrix());g.setDirty(),h.setBaseState()}}else if(h.renderPass==="translucent"){if(h.terrain&&h.terrain.renderingToTexture){const E=y.renderToTile;if(E){const A=f[0].canonical,R={x:A.x+f[0].wrap*(y.wrapTileId?0:1<<A.z),y:A.y,z:A.z};g.setDepthMode(Gt.disabled),g.setStencilMode(En.disabled),g.setColorMode(h.colorModeForRenderPass()),h.setCustomLayerDefaults(),E.call(y,g.gl,R),g.setDirty(),h.setBaseState()}return}h.setCustomLayerDefaults(),g.setColorMode(h.colorModeForRenderPass()),g.setStencilMode(En.disabled);const b=y.renderingMode==="3d"?new Gt(h.context.gl.LEQUAL,Gt.ReadWrite,h.depthRangeFor3D):h.depthModeForSublayer(0,Gt.ReadOnly);if(g.setDepthMode(b),h.transform.projection.name==="globe"){const E=h.transform.pointMerc;y.render(g.gl,h.transform.customLayerMatrix(),h.transform.getProjection(),h.transform.globeToMercatorMatrix(),s.ah(h.transform.zoom),[E.x,E.y],h.transform.pixelsPerMeterRatio)}else y.render(g.gl,h.transform.customLayerMatrix());g.setDirty(),h.setBaseState(),g.bindFramebuffer.set(null)}}else s.w("Custom layers are not yet supported with this projection. Use mercator or globe to enable usage of custom layers.")},model:function(h,n,a,f){if(h.renderPass==="opaque")return;const g=a.paint.get("model-opacity").constantOr(1);if(g===0)return;const y=a.paint.get("model-cast-shadows");if(h.renderPass==="shadow"&&(!y||h.terrain&&g<.65&&a._transitionablePaint._values["model-opacity"].value.expression instanceof s.ab))return;const b=h.shadowRenderer,E=a.paint.get("model-receive-shadows");b&&(b.useNormalOffset=!0,E||(b.enabled=!1));const A=()=>{b&&(b.useNormalOffset=!0,E||(b.enabled=!0))},R=n.getSource();if(h.renderPass==="light-beam"&&R.type!=="batched-model")return;if(R.type==="vector"||R.type==="geojson")return function(ee,ie,fe,_e,we){const be=ee.transform;if(be.projection.name!=="mercator")return void s.w(`Drawing 3D models for ${be.projection.name} projection is not yet implemented`);const ve=be.getFreeCameraOptions().position;if(!ee.modelManager)return;const ye=ee.modelManager;fe.modelManager=ye;const Se=ee.shadowRenderer;if(!fe._unevaluatedLayout._values.hasOwnProperty("model-id"))return;const Ee=fe._unevaluatedLayout._values["model-id"],Fe=Object.assign({},fe.layout.get("model-id").parameters),je=ee.style.order.indexOf(fe.fqid);for(const rt of _e){const it=ie.getTile(rt).getBucket(fe);if(!it||it.projection.name!==be.projection.name)continue;const gt=it.getModelUris();gt&&!it.modelsRequested&&(ye.addModelsFromBucket(gt,we),it.modelsRequested=!0);const ze=am(rt,be);Fe.zoom=ze;const Xe=Ee.possiblyEvaluate(Fe);if(Oe(ee,it,rt),ya.shadowUniformsInitialized=!1,ya.useSingleShadowCascade=!!Se&&Se.getMaxCascadeForTile(rt.toUnwrapped())===0,ee.renderPass==="shadow"&&Se){if(ee.currentShadowCascade===1&&it.isInsideFirstShadowMapFrustum)continue;const Ge=be.calculatePosMatrix(rt.toUnwrapped(),be.worldSize);if(ya.tileMatrix.set(Ge),ya.shadowTileMatrix=Float32Array.from(Se.calculateShadowPassMatrixFromMatrix(Ge)),ya.aabb.min.fill(0),ya.aabb.max[0]=ya.aabb.max[1]=s.aj,ya.aabb.max[2]=0,C0(it,ya,ee,fe.scope))continue}const Re=1<<rt.canonical.z,ot=[((ve.x-rt.wrap)*Re-rt.canonical.x)*s.aj,(ve.y*Re-rt.canonical.y)*s.aj,ve.z*Re*s.aj];ee.conflationActive&&Object.keys(it.instancesPerModel).length>0&&ee.style.isLayerClipped(fe,ie.getSource())&&it.updateReplacement(rt,ee.replacementSource,je,we)&&(it.uploaded=!1,it.upload(ee.context));for(let Ge in it.instancesPerModel){const dt=it.instancesPerModel[Ge];dt.features.length>0&&(Ge=Xe.evaluate(dt.features[0].feature,{}));const At=ye.getModel(Ge,we);if(At||ye.hasURLBeenRequested(Ge)||it.modelUris.includes(Ge)||(it.modelUris.push(Ge),it.modelsRequested=!1),At&&At.uploaded)for(const st of At.nodes)lm(ee,fe,st,dt,ot,rt,ya)}}}(h,n,a,f,R.type==="vector"?a.scope:""),void A();if(!R.loaded())return;if(R.type==="batched-model")return function(ee,ie,fe,_e){fe.resetLayerRenderingStats(ee);const we=ee.context,be=ee.transform,ve=ee.style.fog,ye=ee.shadowRenderer;if(be.projection.name!=="mercator")return void s.w(`Drawing 3D landmark models for ${be.projection.name} projection is not yet implemented`);const Se=ee.transform.getFreeCameraOptions().position,Ee=s.bY([],[Se.x,Se.y,Se.z],ee.transform.worldSize),Fe=s.eb([],Ee),je=s.bx([]),rt=s.ec(be.center.lat,be.zoom),it=s.bn([],[1,1,1/rt]);s.bo(je,je,Fe);const gt=fe.paint.get("model-opacity").constantOr(1),ze=new Gt(we.gl.LEQUAL,Gt.ReadWrite,ee.depthRangeFor3D),Xe=new Gt(we.gl.LEQUAL,Gt.ReadOnly,ee.depthRangeFor3D),Re=new s.cW([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),ot=ee.renderPass==="shadow",Ge=ot&&ye?ye.getCurrentCascadeFrustum():be.getFrustum(be.scaleZoom(be.worldSize)),dt=fe.paint.get("model-front-cutoff"),At=dt[2]<1,st=Oa(ee,fe.paint.get("model-cutoff-fade-range")),Tt=fe.getLayerRenderingStats();(function(qt,Wt,Vt,tn){const on=qt.terrain?qt.terrain.exaggeration():0,cn=qt.transform.zoom;for(const wn of tn){const Bn=Wt.getTile(wn).getBucket(Vt);Bn&&(Bn.setFilter(Vt.filter),qt.conflationActive&&Bn.updateReplacement(wn,qt.replacementSource),Bn.evaluateTransform(qt,Vt),qt.terrain&&on>0&&Bn.elevationUpdate(qt.terrain,on,wn,Vt.source),Bn.needsReEvaluation(qt,cn,Vt)&&Bn.evaluate(Vt))}})(ee,ie,fe,_e),function(){let qt,Wt,Vt;At?(qt=_e.length-1,Wt=-1,Vt=-1):(qt=0,Wt=_e.length,Vt=1);const tn=new Float64Array(16),on=s.ef(),cn=new s.P(0,0);for(let wn=qt;wn!==Wt;wn+=Vt){const Bn=_e[wn],Ar=ie.getTile(Bn).getBucket(fe);if(!Ar||!Ar.uploaded)continue;let Zr=!1;ye&&(Zr=ye.getMaxCascadeForTile(Bn.toUnwrapped())===0);const kr=be.calculatePosMatrix(Bn.toUnwrapped(),be.worldSize),zr=Ar.modelTraits;!ot&&At&&(s.bi(tn,kr),s.ad(on,Ee,tn),cn.x=on[0],cn.y=on[1]);const Di=[];Ar.setFilter(fe.filter);for(const Dn of Ar.getNodesInfo()){if(Dn.hiddenByReplacement||!Dn.node.meshes)continue;const Gn=Dn.node;let Jn=0;ee.terrain&&Gn.elevation&&(Jn=Gn.elevation*ee.terrain.exaggeration());const ri=(()=>{const Ii=Dn.aabb;return Re.min=[...Ii.min],Re.max=[...Ii.max],Re.min[2]+=Jn,Re.max[2]+=Jn,s.ad(Re.min,Re.min,kr),s.ad(Re.max,Re.max,kr),Re})(),Gi=Dn.evaluatedScale;if(Gi[0]<=1&&Gi[1]<=1&&Gi[2]<=1&&ri.intersects(Ge)===0)continue;if(!ot&&At){const Ii=.16666666666666666;Dn.cameraCollisionOpacity=Ee[0]>ri.min[0]&&Ee[0]<ri.max[0]&&Ee[1]>ri.min[1]&&Ee[1]<ri.max[1]&&Ee[2]*rt<ri.max[2]&&Gn.footprint&&s.bS(cn,Gn.footprint)?Math.max(Dn.cameraCollisionOpacity-Ii,0):Math.min(1,Dn.cameraCollisionOpacity+Ii)}const Xr=[...kr],yr=1/s.cU(Bn.canonical),Ei=Gn.anchor?Gn.anchor[0]:0,lr=Gn.anchor?Gn.anchor[1]:0;s.bo(Xr,Xr,[Ei*(Gi[0]-1)+Dn.evaluatedTranslation[0]*yr,lr*(Gi[1]-1)+Dn.evaluatedTranslation[1]*yr,Jn+Dn.evaluatedTranslation[2]]),s.ci(Gi,s.eg)||s.cE(Xr,Xr,Gi);const Bi=s.az([],Xr,Gn.matrix),ii=s.az([],be.expandedFarZProjMatrix,Bi),Gr=s.az([],be.expandedFarZProjMatrix,Xr),si=s.aA([],[Ei,lr,Jn,1],ii)[2];Gn.hidden=!1;let wr=gt;ot||(At&&(wr*=Dn.cameraCollisionOpacity,wr*=nd(Xr,be,Dn.aabb,dt)),wr*=A0(st,si)),wr!==0?Di.push({nodeInfo:Dn,depth:si,opacity:wr,wvpForNode:ii,wvpForTile:Gr,nodeModelMatrix:Bi,tileModelMatrix:Xr}):Gn.hidden=!0}ot||Di.sort((Dn,Gn)=>!At||Dn.opacity===1&&Gn.opacity===1?Dn.depth<Gn.depth?-1:1:Dn.opacity===1?-1:Gn.opacity===1?1:Dn.depth>Gn.depth?-1:1);for(const Dn of Di){const Gn=Dn.nodeInfo,Jn=Gn.node;let ri=s.az([],it,Dn.tileModelMatrix);s.az(ri,je,ri);const Gi=s.bi([],ri);s.ee(Gi,Gi),s.cE(Gi,Gi,K_),ri=s.az(ri,ri,Jn.matrix);const Xr=ee.renderPass==="light-beam",yr=fe.paint.get("model-color-use-theme").constantOr("default")==="none",Ei=zr&s.em.HasMapboxMeshFeatures,lr=Ei?0:Gn.evaluatedRMEA[0][2];for(let Bi=0;Bi<Jn.meshes.length;++Bi){const ii=Jn.meshes[Bi],Gr=Bi===Jn.lightMeshIndex;let si=Dn.wvpForNode;if(Gr){if(!Xr&&!ee.terrain&&ee.shadowRenderer){ee.currentLayer<ee.firstLightBeamLayer&&(ee.firstLightBeamLayer=ee.currentLayer);continue}si=Dn.wvpForTile}else if(Xr)continue;const wr={defines:[]},Ii=[];if(!ot&&ye&&(ye.useNormalOffset=!!ii.normalBuffer),bt(wr.defines,Ii,ii,ee,yr?null:fe.lut),Ei||wr.defines.push("DIFFUSE_SHADED"),Zr&&wr.defines.push("SHADOWS_SINGLE_CASCADE"),Tt&&(ot?Tt.numRenderedVerticesInShadowPass+=ii.vertexArray.length:Tt.numRenderedVerticesInTransparentPass+=ii.vertexArray.length),ot){Ti(ii,Dn.nodeModelMatrix,ee,fe);continue}let ws=null;if(ve){const xa=ru(Dn.nodeModelMatrix,ee.transform);if(ws=new Float32Array(xa),be.projection.name!=="globe"){const ra=ii.aabb.min,co=ii.aabb.max,[dc,ba]=ve.getOpacityForBounds(xa,ra[0],ra[1],co[0],co[1]);wr.overrideFog=dc>=qe||ba>=qe}}const di=ii.material;let gr;di.occlusionTexture&&di.occlusionTexture.offsetScale&&(gr=di.occlusionTexture.offsetScale,wr.defines.push("OCCLUSION_TEXTURE_TRANSFORM"));const wo=ee.getOrCreateProgram("model",wr);!ot&&ye&&ye.setupShadowsFromMatrix(Dn.tileModelMatrix,wo,ye.useNormalOffset),ee.uploadCommonUniforms(we,wo,null,ws);const lo=di.pbrMetallicRoughness;lo.metallicFactor=.9,lo.roughnessFactor=.5;const Fo=ef(new Float32Array(si),new Float32Array(ri),new Float32Array(Gi),new Float32Array(Jn.matrix),ee,Dn.opacity,lo.baseColorFactor,di.emissiveFactor,lo.metallicFactor,lo.roughnessFactor,di,lr,fe,[0,0,0],gr);!Gr&&(Gn.hasTranslucentParts||Dn.opacity<1)&&wo.draw(ee,we.gl.TRIANGLES,ze,En.disabled,Zn.disabled,_n.backCCW,Fo,fe.id,ii.vertexBuffer,ii.indexBuffer,ii.segments,fe.paint,ee.transform.zoom,void 0,Ii),wo.draw(ee,we.gl.TRIANGLES,Gr?Xe:ze,En.disabled,Gr||Dn.opacity<1||Gn.hasTranslucentParts?Zn.alphaBlended:Zn.unblended,_n.backCCW,Fo,fe.id,ii.vertexBuffer,ii.indexBuffer,ii.segments,fe.paint,ee.transform.zoom,void 0,Ii)}}}}()}(h,n,a,f),void A();if(R.type!=="model")return;const D=R.getModels(),F=[],N=h.transform.getFreeCameraOptions().position,j=s.bY([],[N.x,N.y,N.z],h.transform.worldSize);s.eb(j,j);const X=[],W=[];let K=0;for(const ee of D){const ie=a.paint.get("model-rotation").constantOr(null),fe=a.paint.get("model-scale").constantOr(null),_e=a.paint.get("model-translation").constantOr(null);ee.computeModelMatrix(h,ie,fe,_e,!0,!0,!1);const we=s.bx([]),be=s.ec(ee.position.lat,h.transform.zoom),ve=s.bn([],[1,1,1/be]);s.bo(we,we,j),F.push({zScaleMatrix:ve,negCameraPosMatrix:we});for(const ye of ee.nodes)iu(h.transform,ye,ee.matrix,h.transform.expandedFarZProjMatrix,K,X,W);K++}if(X.sort((ee,ie)=>ie.depth-ee.depth),h.renderPass!=="shadow"){if(g===1)for(const ee of W)Bt(ee,h,a,F[ee.modelIndex],En.disabled,h.colorModeForRenderPass());else{for(const ee of W)Bt(ee,h,a,F[ee.modelIndex],En.disabled,Zn.disabled);for(const ee of W)Bt(ee,h,a,F[ee.modelIndex],h.stencilModeFor3D(),h.colorModeForRenderPass());h.resetStencilClippingMasks()}for(const ee of X)Bt(ee,h,a,F[ee.modelIndex],En.disabled,h.colorModeForRenderPass());A()}else{for(const ee of W)Ti(ee.mesh,ee.nodeModelMatrix,h,a);for(const ee of X)Ti(ee.mesh,ee.nodeModelMatrix,h,a);A()}}},ty={line:function(h,n,a){if(h.hasElevatedBuckets=!1,h.hasNonElevatedBuckets=!1,h._unevaluatedLayout.getValue("line-elevation-reference")!==void 0||h._unevaluatedLayout.getValue("line-z-offset")!==void 0){if(n){const f=n.getVisibleCoordinates();for(const g of f){const y=n.getTile(g).getBucket(h);if(y&&(y.elevationType!=="none"?h.hasElevatedBuckets=!0:h.hasNonElevatedBuckets=!0,h.hasElevatedBuckets&&h.hasNonElevatedBuckets))break}}}else h.hasNonElevatedBuckets=!0},model:function(h,n,a){const f=n.getSource();if(!f.loaded())return;if(f.type==="vector"||f.type==="geojson")return void(a.modelManager&&a.modelManager.upload(a,f.type==="vector"?h.scope:""));if(f.type==="batched-model"||f.type!=="model")return;const g=f.getModels();for(const y of g)y.upload(a.context)},raster:function(h,n,a){const f=n.getSource();if(!(f instanceof Zl&&f.loaded()))return;const g=h.sourceLayer||f.rasterLayerIds&&f.rasterLayerIds[0];if(!g)return;const y=h.paint.get("raster-array-band")||f.getInitialBand(g);if(y==null)return;const b=n.getIds().map(E=>n.getTileByID(E));for(const E of b)E.updateNeeded(g,y)&&f.prepareTile(E,g,y)},"raster-particle":function(h,n,a){const f=n.getSource();if(!(f instanceof Zl&&f.loaded()))return;const g=h.sourceLayer||f.rasterLayerIds&&f.rasterLayerIds[0];if(!g)return;const y=h.paint.get("raster-particle-array-band")||f.getInitialBand(g);if(y==null)return;const b=n.getIds().map(E=>n.getTileByID(E));for(const E of b)E.updateNeeded(g,y)&&f.prepareTile(E,g,y)}},ml={fill:W_},lf={fill:function(h,n,a,f){if(!a.layout||a.layout.get("fill-elevation-reference")==="none")return;const g=h.context.gl,y=new Gt(g.LEQUAL,Gt.ReadOnly,h.depthRangeFor3D),b=new En({func:g.ALWAYS,mask:255},255,255,g.KEEP,g.KEEP,g.REPLACE),E=h.transform.getFreeCameraOptions().position,A=h.getOrCreateProgram("elevatedStructuresDepthReconstruct",{defines:["DEPTH_RECONSTRUCTION"]});for(const R of f){const D=n.getTile(R),F=D.getBucket(a);if(!F)continue;const N=F.elevatedStructures;if(!N||N.maskSegments.segments[0].primitiveLength===0)continue;const j=im(R.toUnwrapped(),E),X=h.translatePosMatrix(R.projMatrix,D,a.paint.get("fill-translate"),a.paint.get("fill-translate-anchor")),W=em(X,j,0,0,0);A.draw(h,g.TRIANGLES,y,b,Zn.disabled,_n.disabled,W,a.id,N.vertexBuffer,N.indexBuffer,N.maskSegments,a.paint,h.transform.zoom)}}};class rd{constructor(n,a,f,g,y,b){this.context=new rS(n,a),this.transform=f,this._tileTextures={},this.frameCopies=[],this.loadTimeStamps=[],this.tp=y,this._timeStamp=s.q.now(),this._averageFPS=0,this._fpsHistory=[],this._dt=0,this._debugParams={forceEnablePrecipitation:!1,showTerrainProxyTiles:!1,fpsWindow:30,continousRedraw:!1,enabledLayers:{}};const E=["fill","line","symbol","circle","heatmap","fill-extrusion","building","raster","raster-particle","hillshade","model","background","sky"];for(const R of E)this._debugParams.enabledLayers[R]=!0;y.registerParameter(this._debugParams,["Terrain"],"showTerrainProxyTiles",{},()=>{this.style.map.triggerRepaint()}),y.registerParameter(this._debugParams,["Precipitation"],"forceEnablePrecipitation"),y.registerParameter(this._debugParams,["FPS"],"fpsWindow",{min:1,max:100,step:1}),y.registerBinding(this._debugParams,["FPS"],"continousRedraw",{readonly:!0,label:"continuous redraw"}),y.registerBinding(this,["FPS"],"_averageFPS",{readonly:!0,label:"value"}),y.registerBinding(this,["FPS"],"_averageFPS",{readonly:!0,label:"graph",view:"graph",min:0,max:200});for(const R of E)y.registerParameter(this._debugParams.enabledLayers,["Debug","Layers"],R);this.occlusionParams=new I0(y),this.setup(),this.numSublayers=oo.maxUnderzooming+oo.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.deferredRenderGpuTimeQueries=[],this.gpuTimers={},this.frameCounter=0,this._backgroundTiles={},this.conflationActive=!1,this.replacementSource=new s.et,this.longestCutoffRange=0,this.minCutoffZoom=0,this._fogVisible=!1,this._cachedTileFogOpacities={},this._shadowRenderer=new z2(this),this._wireframeDebugCache=new dS,this.renderDefaultNorthPole=!0,this.renderDefaultSouthPole=!0,this.layersWithOcclusionOpacity=[];const A=new s.r({width:1,height:1},Uint8Array.of(0,0,0,0));this.emptyDepthTexture=new s.T(this.context,A,n.RGBA8),this._clippingActiveLastFrame=!1,this.scaleFactor=g,this.worldview=b}updateTerrain(n,a){const f=!!n&&!!n.terrain&&this.transform.projection.supportsTerrain;if(!(f||this._terrain&&this._terrain.enabled))return;this._terrain||(this._terrain=new Xh(this,n));const g=this._terrain;this.transform.elevation=f?g:null,g.update(n,this.transform,a),this.transform.elevation&&!g.enabled&&(this.transform.elevation=null)}_updateFog(n){const a=n.fog;if(!a||this.transform.projection.name==="globe"||a.getOpacity(this.transform.pitch)<1||a.properties.get("horizon-blend")<.03)return void(this.transform.fogCullDistSq=null);const[f,g]=a.getFovAdjustedRange(this.transform._fov);if(f>g)return void(this.transform.fogCullDistSq=null);const y=f+.78*(g-f);this.transform.fogCullDistSq=y*y}get terrain(){return this.transform._terrainEnabled()&&this._terrain&&this._terrain.enabled||this._forceTerrainMode?this._terrain:null}get forceTerrainMode(){return this._forceTerrainMode}set forceTerrainMode(n){n&&!this._terrain&&(this._terrain=new Xh(this,this.style)),this._forceTerrainMode=n}get shadowRenderer(){return this._shadowRenderer&&this._shadowRenderer.enabled?this._shadowRenderer:null}get wireframeDebugCache(){return this._wireframeDebugCache}resize(n,a){if(this.width=n*s.q.devicePixelRatio,this.height=a*s.q.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const f of this.style.order)this.style._mergedLayers[f].resize()}setup(){const n=this.context,a=new s.ba;a.emplaceBack(0,0),a.emplaceBack(s.aj,0),a.emplaceBack(0,s.aj),a.emplaceBack(s.aj,s.aj),this.tileExtentBuffer=n.createVertexBuffer(a,s.bc.members),this.tileExtentSegments=s.bd.simpleSegment(0,0,4,2);const f=new s.ba;f.emplaceBack(0,0),f.emplaceBack(s.aj,0),f.emplaceBack(0,s.aj),f.emplaceBack(s.aj,s.aj),this.debugBuffer=n.createVertexBuffer(f,s.bc.members),this.debugSegments=s.bd.simpleSegment(0,0,4,5);const g=new s.ba;g.emplaceBack(-1,-1),g.emplaceBack(1,-1),g.emplaceBack(-1,1),g.emplaceBack(1,1),this.viewportBuffer=n.createVertexBuffer(g,s.bc.members),this.viewportSegments=s.bd.simpleSegment(0,0,4,2);const y=new s.aZ;y.emplaceBack(0,0,0,0),y.emplaceBack(s.aj,0,s.aj,0),y.emplaceBack(0,s.aj,0,s.aj),y.emplaceBack(s.aj,s.aj,s.aj,s.aj),this.mercatorBoundsBuffer=n.createVertexBuffer(y,s.bf.members),this.mercatorBoundsSegments=s.bd.simpleSegment(0,0,4,2);const b=new s.a_;b.emplaceBack(0,1,2),b.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=n.createIndexBuffer(b);const E=new s.bb;for(const R of[0,1,3,2,0])E.emplaceBack(R);this.debugIndexBuffer=n.createIndexBuffer(E),this.emptyTexture=new s.T(n,new s.r({width:1,height:1},Uint8Array.of(0,0,0,0)),n.gl.RGBA8),this.identityMat=s.bz();const A=this.context.gl;this.stencilClearMode=new En({func:A.ALWAYS,mask:0},0,255,A.ZERO,A.ZERO,A.ZERO),this.loadTimeStamps.push(performance.now())}getMercatorTileBoundsBuffers(){return{tileBoundsBuffer:this.mercatorBoundsBuffer,tileBoundsIndexBuffer:this.quadTriangleIndexBuffer,tileBoundsSegments:this.mercatorBoundsSegments}}getTileBoundsBuffers(n){return n._makeTileBoundsBuffers(this.context,this.transform.projection),n._tileBoundsBuffer?{tileBoundsBuffer:n._tileBoundsBuffer,tileBoundsIndexBuffer:n._tileBoundsIndexBuffer,tileBoundsSegments:n._tileBoundsSegments}:this.getMercatorTileBoundsBuffers()}clearStencil(){const n=this.context.gl;this.nextStencilID=1,this.currentStencilSource=void 0,this._tileClippingMaskIDs={},this.getOrCreateProgram("clippingMask").draw(this,n.TRIANGLES,Gt.disabled,this.stencilClearMode,Zn.disabled,_n.disabled,Kc(this.identityMat),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}resetStencilClippingMasks(){this.terrain||(this.currentStencilSource=void 0,this._tileClippingMaskIDs={})}_renderTileClippingMasks(n,a,f){if(!a||this.currentStencilSource===a.id||!n.isTileClipped()||!f||f.length===0)return;if(this._tileClippingMaskIDs&&!this.terrain){let E=!1;for(const A of f)if(this._tileClippingMaskIDs[A.key]===void 0){E=!0;break}if(!E)return}this.currentStencilSource=a.id;const g=this.context,y=g.gl;this.nextStencilID+f.length>256&&this.clearStencil(),g.setColorMode(Zn.disabled),g.setDepthMode(Gt.disabled);const b=this.getOrCreateProgram("clippingMask");this._tileClippingMaskIDs={};for(const E of f){const A=a.getTile(E),R=this._tileClippingMaskIDs[E.key]=this.nextStencilID++,{tileBoundsBuffer:D,tileBoundsIndexBuffer:F,tileBoundsSegments:N}=this.getTileBoundsBuffers(A);b.draw(this,y.TRIANGLES,Gt.disabled,new En({func:y.ALWAYS,mask:0},R,255,y.KEEP,y.KEEP,y.REPLACE),Zn.disabled,_n.disabled,Kc(E.projMatrix),"$clipping",D,F,N)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const n=this.nextStencilID++,a=this.context.gl;return new En({func:a.NOTEQUAL,mask:255},n,255,a.KEEP,a.KEEP,a.REPLACE)}stencilModeForClipping(n){if(this.terrain)return this.terrain.stencilModeForRTTOverlap(n);const a=this.context.gl;return new En({func:a.EQUAL,mask:255},this._tileClippingMaskIDs[n.key],0,a.KEEP,a.KEEP,a.REPLACE)}stencilConfigForOverlap(n){const a=this.context.gl,f=n.sort((b,E)=>E.overscaledZ-b.overscaledZ),g=f[f.length-1].overscaledZ,y=f[0].overscaledZ-g+1;if(y>1){this.currentStencilSource=void 0,this.nextStencilID+y>256&&this.clearStencil();const b={};for(let E=0;E<y;E++)b[E+g]=new En({func:a.GEQUAL,mask:255},E+this.nextStencilID,255,a.KEEP,a.KEEP,a.REPLACE);return this.nextStencilID+=y,[b,f]}return[{[g]:En.disabled},f]}colorModeForRenderPass(){const n=this.context.gl;return this._showOverdrawInspector?new Zn([n.CONSTANT_COLOR,n.ONE,n.CONSTANT_COLOR,n.ONE],new s.am(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?Zn.unblended:Zn.alphaBlended}colorModeForDrapableLayerRenderPass(n){const a=this.context.gl;return this.style&&this.style.enable3dLights()&&this.terrain&&this.terrain.renderingToTexture&&this.renderPass==="translucent"?new Zn([a.ONE,a.ONE_MINUS_SRC_ALPHA,a.CONSTANT_ALPHA,a.ONE_MINUS_SRC_ALPHA],new s.am(0,0,0,n===void 0?0:n),[!0,!0,!0,!0]):this.colorModeForRenderPass()}depthModeForSublayer(n,a,f,g=!1){if(this.depthOcclusion)return new Gt(this.context.gl.GREATER,Gt.ReadOnly,this.depthRangeFor3D);if(!this.opaquePassEnabledForLayer()&&!g)return Gt.disabled;const y=1-((1+this.currentLayer)*this.numSublayers+n)*this.depthEpsilon;return new Gt(f||this.context.gl.LEQUAL,a,[y,y])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}blitDepth(){const n=this.context.gl,a=Math.ceil(this.width),f=Math.ceil(this.height),g=this.context.bindFramebuffer.get(),y=n.getParameter(n.TEXTURE_BINDING_2D);this.depthFBO&&this.depthFBO.width===a&&this.depthFBO.height===f||(this.depthFBO&&(this.depthFBO.destroy(),this.depthFBO=void 0,this.depthTexture=void 0),a!==0&&f!==0&&(this.depthFBO=new q_(this.context,a,f,!1,"texture"),this.depthTexture=new s.T(this.context,{width:a,height:f,data:null},n.DEPTH24_STENCIL8),this.depthFBO.depthAttachment.set(this.depthTexture.texture))),this.context.bindFramebuffer.set(g),n.bindTexture(n.TEXTURE_2D,y),this.depthFBO&&(n.bindFramebuffer(n.READ_FRAMEBUFFER,null),n.bindFramebuffer(n.DRAW_FRAMEBUFFER,this.depthFBO.framebuffer),n.blitFramebuffer(0,0,a,f,0,0,a,f,n.DEPTH_BUFFER_BIT,n.NEAREST),n.bindFramebuffer(n.FRAMEBUFFER,this.context.bindFramebuffer.current))}updateAverageFPS(){this._fpsHistory.push(this._dt===0?0:1e3/this._dt),this._fpsHistory.length>this._debugParams.fpsWindow&&this._fpsHistory.splice(0,this._fpsHistory.length-this._debugParams.fpsWindow),this._averageFPS=Math.round(this._fpsHistory.reduce((n,a)=>n+a/this._fpsHistory.length,0))}render(n,a){const f=s.q.now();this._dt=f-this._timeStamp,this._timeStamp=f,this._wireframeDebugCache.update(this.frameCounter),this._debugParams.continousRedraw=n.map.repaint,this.style=n,this.options=a;const g=this.style._mergedLayers,y=!(!this.terrain||!this.terrain.enabled),b=()=>this.style._getOrder(y).filter(ze=>{const Xe=g[ze];return!(Xe.type in this._debugParams.enabledLayers)||this._debugParams.enabledLayers[Xe.type]});let E=b(),A=!1,R=!1;for(const ze of E){const Xe=g[ze];Xe.type==="circle"&&(A=!0),Xe.type==="symbol"&&(Xe.hasInitialOcclusionOpacityProperties?R=!0:A=!0)}let D=E.map(ze=>g[ze]);const F=this.style._mergedSourceCaches;this.imageManager=n.imageManager,this.modelManager=n.modelManager,this.symbolFadeChange=n.placement.symbolFadeChange(s.q.now()),this.imageManager.beginFrame();let N=0,j=!1;for(const ze in F){const Xe=F[ze];Xe.used&&(Xe.prepare(this.context),Xe.getSource().usedInConflation&&++N)}let X=!1;for(const ze of D)ze.isHidden(this.transform.zoom)||(ze.type==="clip"&&(X=!0),this.prepareLayer(ze));const W={},K={},ee={},ie={},fe={};for(const ze in F){const Xe=F[ze];W[ze]=Xe.getVisibleCoordinates(),K[ze]=W[ze].slice().reverse(),ee[ze]=Xe.getVisibleCoordinates(!0).reverse(),ie[ze]=Xe.getShadowCasterCoordinates(),fe[ze]=Xe.sortCoordinatesByDistance(W[ze])}const _e=ze=>{const Xe=this.style.getLayerSourceCache(ze);return Xe&&Xe.used?Xe.getSource():null};if(N||X||this._clippingActiveLastFrame){const ze=[],Xe=[];let Re=0;for(const ot of D)this.isSourceForClippingOrConflation(ot,_e(ot))&&(ze.push(ot),Xe.push(Re)),Re++;if(ze&&(X||ze.length>1)||this._clippingActiveLastFrame){X=!1;const ot=[];for(let Ge=0;Ge<ze.length;Ge++){const dt=ze[Ge],At=Xe[Ge],st=this.style.getLayerSourceCache(dt);if(!st||!st.used||!st.getSource().usedInConflation&&dt.type!=="clip")continue;let Tt=s.eu,qt=s.bQ.None;const Wt=[];let Vt=!0;if(dt.type==="clip"){Tt=At;for(const tn of dt.layout.get("clip-layer-types"))qt|=tn==="model"?s.bQ.Model:tn==="symbol"?s.bQ.Symbol:s.bQ.FillExtrusion;for(const tn of dt.layout.get("clip-layer-scope"))Wt.push(tn);dt.isHidden(this.transform.zoom)?Vt=!1:X=!0}Vt&&ot.push({layer:dt.fqid,cache:st,order:Tt,clipMask:qt,clipScope:Wt})}this.replacementSource.setSources(ot),j=!0}}this._clippingActiveLastFrame=X,j||this.replacementSource.clear(),this.conflationActive=j,this.minCutoffZoom=0,this.longestCutoffRange=0,this.opaquePassCutoff=1/0,this._lastOcclusionLayer=-1,this.layersWithOcclusionOpacity=[];for(let ze=0;ze<D.length;ze++){const Xe=D[ze],Re=Xe.cutoffRange();if(this.longestCutoffRange=Math.max(Re,this.longestCutoffRange),Re>0){const ot=_e(Xe);ot&&(this.minCutoffZoom=Math.max(ot.minzoom,this.minCutoffZoom)),Xe.minzoom&&(this.minCutoffZoom=Math.max(Xe.minzoom,this.minCutoffZoom))}Xe.is3D(y)&&(this.opaquePassCutoff===1/0&&(this.opaquePassCutoff=ze),this._lastOcclusionLayer=ze)}const we=this.style&&this.style.fog;we?(this._fogVisible=we.getOpacity(this.transform.pitch)!==0,this._fogVisible&&this.transform.projection.name!=="globe"&&(this._fogVisible=we.isVisibleOnFrustum(this.transform.cameraFrustum))):this._fogVisible=!1,this._cachedTileFogOpacities={},this.terrain&&(this.terrain.updateTileBinding(ee),this.opaquePassCutoff=0,E=b(),D=E.map(ze=>g[ze]));const be=this._shadowRenderer;if(be){be.updateShadowParameters(this.transform,this.style.directionalLight);for(const ze in F)for(const Xe of W[ze]){let Re={min:0,max:0};this.terrain&&(Re=this.terrain.getMinMaxForTile(Xe)||Re),be.addShadowReceiver(Xe.toUnwrapped(),Re.min,Re.max)}}this.transform.projection.name!=="globe"||this.globeSharedBuffers||(this.globeSharedBuffers=new s.ev(this.context)),this.style.fog&&this.transform.projection.supportsFog?(this._atmosphere||(this._atmosphere=new td(this)),this._atmosphere.update(this)):this._atmosphere&&(this._atmosphere.destroy(),this._atmosphere=void 0);const ve=this._debugParams.forceEnablePrecipitation||!(!this.style||!this.style.snow),ye=this._debugParams.forceEnablePrecipitation||!(!this.style||!this.style.rain);if(ve&&!this._snow&&(this._snow=new ui(this)),!ve&&this._snow&&(this._snow.destroy(),delete this._snow),ye&&!this._rain&&(this._rain=new hS(this)),!ye&&this._rain&&(this._rain.destroy(),delete this._rain),this._snow&&this._snow.update(this),this._rain&&this._rain.update(this),!Lr.has(this.context.gl))return;this.renderPass="offscreen";for(const ze of D){const Xe=n.getLayerSourceCache(ze);if(!ze.hasOffscreenPass()||ze.isHidden(this.transform.zoom))continue;const Re=Xe?K[Xe.id]:void 0;(ze.type==="custom"||ze.type==="raster"||ze.type==="raster-particle"||ze.isSky()||Re&&Re.length)&&this.renderLayer(this,Xe,ze,Re)}this.depthRangeFor3D=[0,1-(D.length+2)*this.numSublayers*this.depthEpsilon],this._shadowRenderer&&(this.renderPass="shadow",this._shadowRenderer.drawShadowPass(this.style,ie)),this.context.bindFramebuffer.set(null),this.context.viewport.set([0,0,this.width,this.height]);const Se=this.transform.projection.name==="globe"||this.transform.isHorizonVisible(),Ee=(()=>{if(a.showOverdrawInspector)return s.am.black;const ze=this.style.fog;if(ze&&this.transform.projection.supportsFog){const Xe=this.style.getLut(ze.scope);if(!Se){const Re=ze.properties.get("color-use-theme")==="none",ot=ze.properties.get("color").toNonPremultipliedRenderColor(Re?null:Xe).toArray01();return new s.am(...ot)}if(Se){const Re=ze.properties.get("space-color-use-theme")==="none",ot=ze.properties.get("space-color").toNonPremultipliedRenderColor(Re?null:Xe).toArray01();return new s.am(...ot)}}return s.am.transparent})();if(this.context.clear({color:Ee,depth:1}),this.clearStencil(),this._showOverdrawInspector=a.showOverdrawInspector,this.renderPass="opaque",this.style.fog&&this.transform.projection.supportsFog&&this._atmosphere&&!this._showOverdrawInspector&&Se&&this._atmosphere.drawStars(this,this.style.fog),!this.terrain)for(this.currentLayer=E.length-1;this.currentLayer>=0;this.currentLayer--){const ze=D[this.currentLayer],Xe=n.getLayerSourceCache(ze);if(ze.isSky())continue;const Re=Xe?(ze.is3D(y)?fe:K)[Xe.id]:void 0;this._renderTileClippingMasks(ze,Xe,Re),this.renderLayer(this,Xe,ze,Re)}if(this.style.fog&&this.transform.projection.supportsFog&&this._atmosphere&&!this._showOverdrawInspector&&Se&&this._atmosphere.drawAtmosphereGlow(this,this.style.fog),this.renderPass="sky",(!this._atmosphere||s.ah(this.transform.zoom)>0)&&(this.transform.projection.name==="globe"||this.transform.isHorizonVisible()))for(this.currentLayer=0;this.currentLayer<E.length;this.currentLayer++){const ze=D[this.currentLayer],Xe=n.getLayerSourceCache(ze);ze.isSky()&&this.renderLayer(this,Xe,ze,Xe?K[Xe.id]:void 0)}function Fe(ze,Xe){let Re;return Xe&&(Re=(ze.type==="symbol"?ee:ze.is3D(y)?fe:K)[Xe.id]),Re}if(this.renderPass="translucent",this.transform.projection.name==="globe"){for(this.renderElevatedRasterBackface=!0,this.currentLayer=0;this.currentLayer<E.length;){const ze=D[this.currentLayer];if(ze.type==="raster"||ze.type==="raster-particle"){const Xe=n.getLayerSourceCache(ze);this.renderLayer(this,Xe,ze,Fe(ze,Xe))}++this.currentLayer}this.renderElevatedRasterBackface=!1}this.currentLayer=0,this.firstLightBeamLayer=Number.MAX_SAFE_INTEGER;let je=0;be&&(je=be.getShadowCastingLayerCount());let rt=!1,it=-1;for(let ze=0;ze<E.length;++ze){const Xe=D[ze];Xe.isHidden(this.transform.zoom)||Xe.is3D(y)&&(it=ze)}R&&it===-1&&(A=!0);let gt=!1;for(;this.currentLayer<E.length;){const ze=D[this.currentLayer],Xe=n.getLayerSourceCache(ze);if(ze.isSky())++this.currentLayer;else if(this.terrain&&this.style.isLayerDraped(ze)){if(ze.isHidden(this.transform.zoom)){++this.currentLayer;continue}this.currentLayer=this.terrain.renderBatch(this.currentLayer),this._lastOcclusionLayer=Math.max(this.currentLayer,this._lastOcclusionLayer)}else{if(!gt&&ze.is3D(y)&&!y){const Re=this.currentLayer,ot=Ge=>{for(this.currentLayer=0;this.currentLayer<D.length;this.currentLayer++){const dt=D[this.currentLayer];if(ml[dt.type]){const At=this.style.getLayerSourceCache(dt);ml[dt.type](this,At,dt,Fe(dt,At),Ge)}}};ot("initialize"),ot("reset"),this.currentLayer=Re,gt=!0}if(A&&!rt&&this.terrain&&!this.transform.isOrthographic&&(rt=!0,this.blitDepth()),R&&it!==-1&&this.currentLayer===it+1&&!this.transform.isOrthographic&&this.blitDepth(),this.terrain||this._renderTileClippingMasks(ze,Xe,Xe?W[Xe.id]:void 0),this.renderLayer(this,Xe,ze,Fe(ze,Xe)),!this.terrain&&be&&je>0&&ze.hasShadowPass()&&--je==0){{this.clearStencil();const Re=this.currentLayer;for(this.currentLayer=0;this.currentLayer<D.length;this.currentLayer++){const ot=D[this.currentLayer];if(lf[ot.type]){const Ge=this.style.getLayerSourceCache(ot);lf[ot.type](this,Ge,ot,Fe(ot,Ge))}}this.currentLayer=Re}if(be.drawGroundShadows(),this.firstLightBeamLayer<=this.currentLayer){const Re=this.currentLayer;for(this.renderPass="light-beam",this.currentLayer=this.firstLightBeamLayer;this.currentLayer<=Re;this.currentLayer++){const ot=D[this.currentLayer];if(!ot.hasLightBeamPass())continue;const Ge=n.getLayerSourceCache(ot);this.renderLayer(this,Ge,ot,Ge?K[Ge.id]:void 0)}this.currentLayer=Re,this.renderPass="translucent"}}if(this.currentLayer>=this._lastOcclusionLayer&&this.layersWithOcclusionOpacity.length>0){const Re=this.currentLayer;this.depthOcclusion=!0;for(const ot of this.layersWithOcclusionOpacity){this.currentLayer=ot;const Ge=D[this.currentLayer],dt=n.getLayerSourceCache(Ge),At=dt?K[dt.id]:void 0;this.terrain||this._renderTileClippingMasks(Ge,dt,dt?W[dt.id]:void 0),this.renderLayer(this,dt,Ge,At)}this.depthOcclusion=!1,this.currentLayer=Re,this.renderPass="translucent",this.layersWithOcclusionOpacity=[]}++this.currentLayer}}if(this.terrain&&this.terrain.postRender(),this._snow&&this._snow.draw(this),this._rain&&this._rain.draw(this),this.options.showTileBoundaries||this.options.showQueryGeometry||this.options.showTileAABBs){let ze=null;D.forEach(Xe=>{const Re=n.getLayerSourceCache(Xe);Re&&!Xe.isHidden(this.transform.zoom)&&Re.getVisibleCoordinates().length&&(!ze||ze.getSource().maxzoom<Re.getSource().maxzoom)&&(ze=Re)}),ze&&this.options.showTileBoundaries&&fl(this,ze,ze.getVisibleCoordinates(),s.am.red,!1,this.options.showParseStatus)}this.terrain&&this._debugParams.showTerrainProxyTiles&&fl(this,this.terrain.proxySourceCache,this.terrain.proxyCoords,new s.am(1,.8,.1,1),!0,this.options.showParseStatus),this.options.showPadding&&function(ze){const Xe=ze.transform.padding;sm(ze,ze.transform.height-(Xe.top||0),3,aS),sm(ze,Xe.bottom||0,3,lS),om(ze,Xe.left||0,3,bo),om(ze,ze.transform.width-(Xe.right||0),3,Y_);const Re=ze.transform.centerPoint;(function(ot,Ge,dt,At){ed(ot,Ge-1,dt-10,2,20,At),ed(ot,Ge-10,dt-1,20,2,At)})(ze,Re.x,ze.transform.height-Re.y,Qs)}(this),this.context.setDefault(),this.frameCounter=(this.frameCounter+1)%Number.MAX_SAFE_INTEGER,this.tileLoaded&&this.options.speedIndexTiming&&(this.loadTimeStamps.push(performance.now()),this.saveCanvasCopy()),j||(this.conflationActive=!1)}prepareLayer(n){this.gpuTimingStart(n);const{unsupportedLayers:a}=this.transform.projection,f=!a||!a.includes(n.type);if(ty[n.type]&&(f||this.terrain&&n.type==="custom")){const g=this.style.getLayerSourceCache(n);ty[n.type](n,g,this)}this.gpuTimingEnd()}renderLayer(n,a,f,g){f.isHidden(this.transform.zoom)||(f.type==="background"||f.type==="sky"||f.type==="custom"||f.type==="model"||f.type==="raster"||f.type==="raster-particle"||g&&g.length)&&(this.id=f.id,this.gpuTimingStart(f),n.transform.projection.unsupportedLayers&&n.transform.projection.unsupportedLayers.includes(f.type)&&(!n.terrain||f.type!=="custom")||f.type==="clip"||hr[f.type](n,a,f,g,this.style.placement.variableOffsets,this.options.isInitialLoad),this.gpuTimingEnd())}gpuTimingStart(n){if(!this.options.gpuTiming)return;const a=this.context.extTimerQuery,f=this.context.gl;let g=this.gpuTimers[n.id];g||(g=this.gpuTimers[n.id]={calls:0,cpuTime:0,query:f.createQuery()}),g.calls++,f.beginQuery(a.TIME_ELAPSED_EXT,g.query)}gpuTimingDeferredRenderStart(){if(this.options.gpuTimingDeferredRender){const n=this.context.extTimerQuery,a=this.context.gl,f=a.createQuery();this.deferredRenderGpuTimeQueries.push(f),a.beginQuery(n.TIME_ELAPSED_EXT,f)}}gpuTimingDeferredRenderEnd(){this.options.gpuTimingDeferredRender&&this.context.gl.endQuery(this.context.extTimerQuery.TIME_ELAPSED_EXT)}gpuTimingEnd(){this.options.gpuTiming&&this.context.gl.endQuery(this.context.extTimerQuery.TIME_ELAPSED_EXT)}collectGpuTimers(){const n=this.gpuTimers;return this.gpuTimers={},n}collectDeferredRenderGpuQueries(){const n=this.deferredRenderGpuTimeQueries;return this.deferredRenderGpuTimeQueries=[],n}queryGpuTimers(n){const a={};for(const f in n){const g=n[f],y=this.context.extTimerQuery,b=y.getQueryParameter(g.query,this.context.gl.QUERY_RESULT)/1e6;y.deleteQueryEXT(g.query),a[f]=b}return a}queryGpuTimeDeferredRender(n){if(!this.options.gpuTimingDeferredRender)return 0;const a=this.context.gl;let f=0;for(const g of n)f+=a.getQueryParameter(g,a.QUERY_RESULT)/1e6,a.deleteQuery(g);return f}translatePosMatrix(n,a,f,g,y){if(!f[0]&&!f[1])return n;const b=y?g==="map"?this.transform.angle:0:g==="viewport"?-this.transform.angle:0;if(b){const R=Math.sin(b),D=Math.cos(b);f=[f[0]*D-f[1]*R,f[0]*R+f[1]*D]}const E=[y?f[0]:s.aw(a,f[0],this.transform.zoom),y?f[1]:s.aw(a,f[1],this.transform.zoom),0],A=new Float32Array(16);return s.bo(A,n,E),A}saveTileTexture(n){const a=n.size[0],f=this._tileTextures[a];f?f.push(n):this._tileTextures[a]=[n]}getTileTexture(n){const a=this._tileTextures[n];return a&&a.length>0?a.pop():null}terrainRenderModeElevated(){return this.style&&!!this.style.getTerrain()&&!!this.terrain&&!this.terrain.renderingToTexture||this.forceTerrainMode}linearFloatFilteringSupported(){return this.context.extTextureFloatLinear!=null}currentGlobalDefines(n,a,f){const g=f===void 0?this.terrain&&this.terrain.renderingToTexture:f,y=[];return this.style&&this.style.enable3dLights()&&(n==="globeRaster"||n==="terrainRaster"?(y.push("LIGHTING_3D_MODE"),y.push("LIGHTING_3D_ALPHA_EMISSIVENESS")):g||y.push("LIGHTING_3D_MODE")),this.renderPass==="shadow"&&(this._shadowMapDebug||y.push("DEPTH_TEXTURE")),this.terrainRenderModeElevated()&&(y.push("TERRAIN"),this.linearFloatFilteringSupported()&&y.push("TERRAIN_DEM_FLOAT_FORMAT")),this.transform.projection.name==="globe"&&y.push("GLOBE"),!this._fogVisible||g||a!==void 0&&!a||y.push("FOG","FOG_DITHERING"),g&&y.push("RENDER_TO_TEXTURE"),this._showOverdrawInspector&&y.push("OVERDRAW_INSPECTOR"),y}getOrCreateProgram(n,a){this.cache=this.cache||{};const f=a&&a.defines||[],g=a&&a.config,y=this.currentGlobalDefines(n,a&&a.overrideFog,a&&a.overrideRtt).concat(f),b=Jp.cacheKey(Bp[n],n,y,g);return this.cache[b]||(this.cache[b]=new Jp(this.context,n,Bp[n],g,g0[n],y)),this.cache[b]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.frontFace.setDefault(),this.context.cullFaceSide.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const n=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(n.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new s.T(this.context,this.debugOverlayCanvas,this.context.gl.RGBA8))}destroy(){this._terrain&&this._terrain.destroy(),this._atmosphere&&(this._atmosphere.destroy(),this._atmosphere=void 0),this.globeSharedBuffers&&this.globeSharedBuffers.destroy(),this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy(),this._wireframeDebugCache.destroy(),this.depthFBO&&(this.depthFBO.destroy(),this.depthFBO=void 0,this.depthTexture=void 0),this.emptyDepthTexture&&this.emptyDepthTexture.destroy()}prepareDrawTile(){this.terrain&&this.terrain.prepareDrawTile()}uploadCommonLightUniforms(n,a){if(this.style.enable3dLights()){const f=this.style.directionalLight,g=this.style.ambientLight;if(f&&g){const y=((b,E,A)=>{const R=b.properties.get("direction"),D=b.properties.get("color-use-theme")==="none",F=b.properties.get("color").toNonPremultipliedRenderColor(D?null:A.getLut(b.scope)).toArray01(),N=b.properties.get("intensity"),j=E.properties.get("color-use-theme")==="none",X=E.properties.get("color").toNonPremultipliedRenderColor(j?null:A.getLut(E.scope)).toArray01(),W=E.properties.get("intensity"),K=[R.x,R.y,R.z],ee=s.dw(X,W),ie=s.dw(F,N);return{u_lighting_ambient_color:ee,u_lighting_directional_dir:K,u_lighting_directional_color:ie,u_ground_radiance:Qp(K,ie,ee)}})(f,g,this.style);a.setLightsUniformValues(n,y)}}}uploadCommonUniforms(n,a,f,g,y){if(this.uploadCommonLightUniforms(n,a),this.terrain&&this.terrain.renderingToTexture)return;const b=this.style.fog;if(b){const E=b.getOpacity(this.transform.pitch),A=((R,D,F,N,j,X,W,K,ee,ie,fe,_e)=>{const we=R.transform,be=D.properties.get("color-use-theme")==="none",ve=D.properties.get("color").toNonPremultipliedRenderColor(be?null:R.style.getLut(D.scope)).toArray01();ve[3]=N;const ye=R.frameCounter/1e3%1,[Se,Ee]=D.properties.get("vertical-range");return{u_fog_matrix:F?we.calculateFogTileMatrix(F):_e||R.identityMat,u_fog_range:D.getFovAdjustedRange(we._fov),u_fog_color:ve,u_fog_horizon_blend:D.properties.get("horizon-blend"),u_fog_vertical_limit:[Math.min(Se,Ee),Ee],u_fog_temporal_offset:ye,u_frustum_tl:j,u_frustum_tr:X,u_frustum_br:W,u_frustum_bl:K,u_globe_pos:ee,u_globe_radius:ie,u_viewport:fe,u_globe_transition:s.ah(we.zoom),u_is_globe:+(we.projection.name==="globe")}})(this,b,f,E,this.transform.frustumCorners.TL,this.transform.frustumCorners.TR,this.transform.frustumCorners.BR,this.transform.frustumCorners.BL,this.transform.globeCenterInViewSpace,this.transform.globeRadius,[this.transform.width*s.q.devicePixelRatio,this.transform.height*s.q.devicePixelRatio],g);a.setFogUniformValues(n,A)}y&&a.setCutoffUniformValues(n,y.uniformValues)}setTileLoadedFlag(n){this.tileLoaded=n}saveCanvasCopy(){const n=this.canvasCopy();n&&(this.frameCopies.push(n),this.tileLoaded=!1)}canvasCopy(){const n=this.context.gl,a=n.createTexture();return n.bindTexture(n.TEXTURE_2D,a),n.copyTexImage2D(n.TEXTURE_2D,0,n.RGBA,0,0,n.drawingBufferWidth,n.drawingBufferHeight,0),a}getCanvasCopiesAndTimestamps(){return{canvasCopies:this.frameCopies,timeStamps:this.loadTimeStamps}}averageElevationNeedsEasing(){if(!this.transform._elevation)return!1;const n=this.style&&this.style.fog;return!!n&&n.getOpacity(this.transform.pitch)!==0}getBackgroundTiles(){const n=this._backgroundTiles,a=this._backgroundTiles={},f=this.transform.coveringTiles({tileSize:512});for(const g of f)a[g.key]=n[g.key]||new jc(g,512,this.transform.tileZoom,this,void 0,this.worldview);return a}clearBackgroundTiles(){this._backgroundTiles={}}isSourceForClippingOrConflation(n,a){return!(!n.is3D(!(!this.terrain||!this.terrain.enabled))||n.type!=="clip"&&(n.minzoom&&n.minzoom>this.transform.zoom||(this.style._clipLayerPresent||n.sourceLayer!=="building")&&(!a||a.type!=="batched-model")))}isTileAffectedByFog(n){if(!this.style||!this.style.fog)return!1;if(this.transform.projection.name==="globe")return!0;let a=this._cachedTileFogOpacities[n.key];return a||(this._cachedTileFogOpacities[n.key]=a=this.style.fog.getOpacityForTile(n)),a[0]>=qe||a[1]>=qe}setupDepthForOcclusion(n,a,f){const g=this.context,y=g.gl,b=!!f;var E;f||(f={u_dem:2,u_dem_prev:4,u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_depth_range_unpack:[0,1],u_occluder_half_size:16,u_occlusion_depth_offset:-1e-4,u_exaggeration:0}),g.activeTexture.set(y.TEXTURE3),n&&this.depthFBO&&this.depthTexture?(this.depthTexture.bind(y.NEAREST,y.CLAMP_TO_EDGE),f.u_depth_size_inv=[1/this.depthFBO.width,1/this.depthFBO.height],f.u_depth_range_unpack=[2/((E=this.depthRangeFor3D)[1]-E[0]),-1-2*E[0]/(E[1]-E[0])],f.u_occluder_half_size=.5*this.occlusionParams.occluderSize,f.u_occlusion_depth_offset=this.occlusionParams.depthOffset):this.emptyDepthTexture.bind(y.NEAREST,y.CLAMP_TO_EDGE),g.activeTexture.set(y.TEXTURE0),b||a.setTerrainUniformValues(g,f)}}function ac(h,n){let a=!1,f=null;const g=()=>{f=null,a&&(h(),f=setTimeout(g,n),a=!1)};return()=>(a=!0,f||g(),f)}class ny{constructor(n){this._hashName=n&&encodeURIComponent(n),s.aV(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=ac(this._updateHashUnthrottled.bind(this),300)}addTo(n){return this._map=n,window.addEventListener("hashchange",this._onHashChange,!1),n.on("moveend",this._updateHash),this}remove(){return this._map?(this._map.off("moveend",this._updateHash),window.removeEventListener("hashchange",this._onHashChange,!1),clearTimeout(this._updateHash()),this._map=void 0,this):this}getHashString(){const n=this._map;if(!n)return"";const a=dm(n);if(this._hashName){const f=this._hashName;let g=!1;const y=location.hash.slice(1).split("&").map(b=>{const E=b.split("=")[0];return E===f?(g=!0,`${E}=${a}`):b}).filter(b=>b);return g||y.push(`${f}=${a}`),`#${y.join("&")}`}return`#${a}`}_getCurrentHash(){const n=location.hash.replace("#","");if(this._hashName){let a;return n.split("&").map(f=>f.split("=")).forEach(f=>{f[0]===this._hashName&&(a=f)}),(a&&a[1]||"").split("/")}return n.split("/")}_onHashChange(){const n=this._map;if(!n)return!1;const a=this._getCurrentHash();if(a.length>=3&&!a.some(f=>isNaN(Number(f)))){const f=n.dragRotate.isEnabled()&&n.touchZoomRotate.isEnabled()?+(a[3]||0):n.getBearing();return n.jumpTo({center:[+a[2],+a[1]],zoom:+a[0],bearing:f,pitch:+(a[4]||0)}),!0}return!1}_updateHashUnthrottled(){history.replaceState(history.state,"",location.href.replace(/(#.+)?$/,this.getHashString()))}}function dm(h,n){const a=h.getCenter(),f=Math.round(100*h.getZoom())/100,g=Math.ceil((f*Math.LN2+Math.log(512/360/.5))/Math.LN10),y=Math.pow(10,g),b=Math.round(a.lng*y)/y,E=Math.round(a.lat*y)/y,A=h.getBearing(),R=h.getPitch();let D=n?`/${b}/${E}/${f}`:`${f}/${E}/${b}`;return(A||R)&&(D+="/"+Math.round(10*A)/10),R&&(D+=`/${Math.round(R)}`),D}const id={linearity:.3,easing:s.ew(0,0,.3,1)},ry=s.h({deceleration:2500,maxSpeed:1400},id),ja=s.h({deceleration:20,maxSpeed:1400},id),lc=s.h({deceleration:1e3,maxSpeed:360},id),cf=s.h({deceleration:1e3,maxSpeed:90},id);class hm{constructor(n){this._map=n,this.clear()}clear(){this._inertiaBuffer=[]}record(n){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:s.q.now(),settings:n})}_drainInertiaBuffer(){const n=this._inertiaBuffer,a=s.q.now();for(;n.length>0&&a-n[0].time>160;)n.shift()}_onMoveEnd(n){if(this._map._prefersReducedMotion()||(this._drainInertiaBuffer(),this._inertiaBuffer.length<2))return;const a={zoom:0,bearing:0,pitch:0,pan:new s.P(0,0),pinchAround:void 0,around:void 0};for(const{settings:y}of this._inertiaBuffer)a.zoom+=y.zoomDelta||0,a.bearing+=y.bearingDelta||0,a.pitch+=y.pitchDelta||0,y.panDelta&&a.pan._add(y.panDelta),y.around&&(a.around=y.around),y.pinchAround&&(a.pinchAround=y.pinchAround);const f=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,g={};if(a.pan.mag()){const y=od(a.pan.mag(),f,s.h({},ry,n||{}));g.offset=a.pan.mult(y.amount/a.pan.mag()),g.center=this._map.transform.center,sd(g,y)}if(a.zoom){const y=od(a.zoom,f,ja);g.zoom=this._map.transform.zoom+y.amount,sd(g,y)}if(a.bearing){const y=od(a.bearing,f,lc);g.bearing=this._map.transform.bearing+s.ay(y.amount,-179,179),sd(g,y)}if(a.pitch){const y=od(a.pitch,f,cf);g.pitch=this._map.transform.pitch+y.amount,sd(g,y)}if(g.zoom||g.bearing){const y=a.pinchAround===void 0?a.around:a.pinchAround;g.around=y?this._map.unproject(y):this._map.getCenter()}return this.clear(),g.noMoveStart=!0,g}}function sd(h,n){(!h.duration||h.duration<n.duration)&&(h.duration=n.duration,h.easing=n.easing)}function od(h,n,a){const{maxSpeed:f,linearity:g,deceleration:y}=a,b=s.ay(h*g/(n/1e3),-f,f),E=Math.abs(b)/(y*g);return{easing:a.easing,duration:1e3*E,amount:b*(E/2)}}class xs extends s.A{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(n,a,f,g={}){const y=Ye(a.getCanvasContainer(),f),b=a.unproject(y);super(n,s.h({point:y,lngLat:b,originalEvent:f},g)),this._defaultPrevented=!1,this.target=a}}class ad extends s.A{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(n,a,f){const g=n==="touchend"?f.changedTouches:f.touches,y=vt(a.getCanvasContainer(),g),b=y.map(A=>a.unproject(A)),E=y.reduce((A,R,D,F)=>A.add(R.div(F.length)),new s.P(0,0));super(n,{points:y,point:E,lngLats:b,lngLat:a.unproject(E),originalEvent:f}),this._defaultPrevented=!1}}class cc extends s.A{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(n,a){super("wheel",{originalEvent:a}),this._defaultPrevented=!1}}class iy{constructor(n,a){this._map=n,this._clickTolerance=a.clickTolerance}reset(){this._mousedownPos=void 0}wheel(n){return this._firePreventable(new cc(this._map,n))}mousedown(n,a){return this._mousedownPos=a,this._firePreventable(new xs(n.type,this._map,n))}mouseup(n){this._map.fire(new xs(n.type,this._map,n))}preclick(n){const a=s.h({},n);a.type="preclick",this._map.fire(new xs(a.type,this._map,a))}click(n,a){this._mousedownPos&&this._mousedownPos.dist(a)>=this._clickTolerance||(this.preclick(n),this._map.fire(new xs(n.type,this._map,n)))}dblclick(n){return this._firePreventable(new xs(n.type,this._map,n))}mouseover(n){this._map.fire(new xs(n.type,this._map,n))}mouseout(n){this._map.fire(new xs(n.type,this._map,n))}touchstart(n){return this._firePreventable(new ad(n.type,this._map,n))}touchmove(n){this._map.fire(new ad(n.type,this._map,n))}touchend(n){this._map.fire(new ad(n.type,this._map,n))}touchcancel(n){this._map.fire(new ad(n.type,this._map,n))}_firePreventable(n){if(this._map.fire(n),n.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class fm{constructor(n){this._map=n}reset(){this._delayContextMenu=!1,this._contextMenuEvent=void 0}mousemove(n){this._map.fire(new xs(n.type,this._map,n))}mousedown(){this._delayContextMenu=!0}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new xs("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(n){this._delayContextMenu?this._contextMenuEvent=n:this._map.fire(new xs(n.type,this._map,n)),this._map.listens("contextmenu")&&n.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class sy{constructor(n,a){this._map=n,this._el=n.getCanvasContainer(),this._container=n.getContainer(),this._clickTolerance=a.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(n,a){this.isEnabled()&&n.shiftKey&&n.button===0&&(Me(),this._startPos=this._lastPos=a,this._active=!0)}mousemoveWindow(n,a){if(!this._active)return;const f=a,g=this._startPos,y=this._lastPos;if(!g||!y||y.equals(f)||!this._box&&f.dist(g)<this._clickTolerance)return;this._lastPos=f,this._box||(this._box=H("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",n));const b=Math.min(g.x,f.x),E=Math.max(g.x,f.x),A=Math.min(g.y,f.y),R=Math.max(g.y,f.y);this._map._requestDomTask(()=>{this._box&&(this._box.style.transform=`translate(${b}px,${A}px)`,this._box.style.width=E-b+"px",this._box.style.height=R-A+"px")})}mouseupWindow(n,a){if(!this._active)return;const f=this._startPos,g=a;if(f&&n.button===0){if(this.reset(),Pe(),f.x!==g.x||f.y!==g.y)return this._map.fire(new s.A("boxzoomend",{originalEvent:n})),{cameraAnimation:y=>y.fitScreenCoordinates(f,g,this._map.getBearing(),{linear:!1})};this._fireEvent("boxzoomcancel",n)}}keydown(n){this._active&&n.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",n))}blur(){this.reset()}reset(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(this._box.remove(),this._box=null),Le(),delete this._startPos,delete this._lastPos}_fireEvent(n,a){return this._map.fire(new s.A(n,{originalEvent:a}))}}function uf(h,n){const a={};for(let f=0;f<h.length;f++)a[h[f].identifier]=n[f];return a}class bs{constructor(n){this.reset(),this.numTouches=n.numTouches}reset(){this.centroid=void 0,this.startTime=0,this.touches={},this.aborted=!1}touchstart(n,a,f){(this.centroid||f.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===0&&(this.startTime=n.timeStamp),f.length===this.numTouches&&(this.centroid=function(g){const y=new s.P(0,0);for(const b of g)y._add(b);return y.div(g.length)}(a),this.touches=uf(f,a)))}touchmove(n,a,f){if(this.aborted||!this.centroid)return;const g=uf(f,a);for(const y in this.touches){const b=g[y];(!b||b.dist(this.touches[y])>30)&&(this.aborted=!0)}}touchend(n,a,f){if((!this.centroid||n.timeStamp-this.startTime>500)&&(this.aborted=!0),f.length===0){const g=!this.aborted&&this.centroid;if(this.reset(),g)return g}}}class df{constructor(n){this.singleTap=new bs(n),this.numTaps=n.numTaps,this.reset()}reset(){this.lastTime=1/0,this.lastTap=void 0,this.count=0,this.singleTap.reset()}touchstart(n,a,f){this.singleTap.touchstart(n,a,f)}touchmove(n,a,f){this.singleTap.touchmove(n,a,f)}touchend(n,a,f){const g=this.singleTap.touchend(n,a,f);if(g){const y=n.timeStamp-this.lastTime<500,b=!this.lastTap||this.lastTap.dist(g)<30;if(y&&b||this.reset(),this.count++,this.lastTime=n.timeStamp,this.lastTap=g,this.count===this.numTaps)return this.reset(),g}}}class oy{constructor(){this._zoomIn=new df({numTouches:1,numTaps:2}),this._zoomOut=new df({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(n,a,f){this._zoomIn.touchstart(n,a,f),this._zoomOut.touchstart(n,a,f)}touchmove(n,a,f){this._zoomIn.touchmove(n,a,f),this._zoomOut.touchmove(n,a,f)}touchend(n,a,f){const g=this._zoomIn.touchend(n,a,f),y=this._zoomOut.touchend(n,a,f);return g?(this._active=!0,n.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:b=>b.easeTo({duration:300,zoom:b.getZoom()+1,around:b.unproject(g)},{originalEvent:n})}):y?(this._active=!0,n.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:b=>b.easeTo({duration:300,zoom:b.getZoom()-1,around:b.unproject(y)},{originalEvent:n})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}const ay={0:1,2:2},uc={Control:"ctrlKey",Alt:"altKey",Shift:"shiftKey",Meta:"metaKey"};class hf{constructor(n){this.reset(),this._clickTolerance=n.clickTolerance||1}blur(){this.reset()}reset(){this._active=!1,this._moved=!1,this._lastPoint=void 0,this._eventButton=void 0}_correctButton(n,a){return!1}_move(n,a){return{}}mousedown(n,a){if(this._lastPoint)return;const f=It(n);this._correctButton(n,f)&&(this._lastPoint=a,this._eventButton=f)}mousemoveWindow(n,a){const f=this._lastPoint;if(f){if(n.preventDefault(),this._eventButton!=null&&function(g,y){const b=ay[y];return g.buttons===void 0||(g.buttons&b)!==b}(n,this._eventButton))this.reset();else if(this._moved||!(a.dist(f)<this._clickTolerance))return this._moved=!0,this._lastPoint=a,this._move(f,a)}}mouseupWindow(n){this._lastPoint&&It(n)===this._eventButton&&(this._moved&&Pe(),this.reset())}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class ly extends hf{mousedown(n,a){super.mousedown(n,a),this._lastPoint&&(this._active=!0)}_correctButton(n,a){return a===0&&!n.ctrlKey}_move(n,a){return{around:a,panDelta:a.sub(n)}}}class pm extends hf{constructor(n){super(n),this._pitchRotateKey=n.pitchRotateKey?uc[n.pitchRotateKey]:void 0}_correctButton(n,a){return this._pitchRotateKey?a===0&&n[this._pitchRotateKey]:a===0&&n.ctrlKey||a===2}_move(n,a){const f=.8*(a.x-n.x);if(f)return this._active=!0,{bearingDelta:f}}contextmenu(n){this._pitchRotateKey||n.preventDefault()}}class ou extends hf{constructor(n){super(n),this._pitchRotateKey=n.pitchRotateKey?uc[n.pitchRotateKey]:void 0}_correctButton(n,a){return this._pitchRotateKey?a===0&&n[this._pitchRotateKey]:a===0&&n.ctrlKey||a===2}_move(n,a){const f=-.5*(a.y-n.y);if(f)return this._active=!0,{pitchDelta:f}}contextmenu(n){this._pitchRotateKey||n.preventDefault()}}class cy{constructor(n,a){this._map=n,this._el=n.getCanvasContainer(),this._minTouches=1,this._clickTolerance=a.clickTolerance||1,this.reset(),s.aV(["_addTouchPanBlocker","_showTouchPanBlockerAlert"],this)}reset(){this._active=!1,this._touches={},this._sum=new s.P(0,0)}touchstart(n,a,f){return this._calculateTransform(n,a,f)}touchmove(n,a,f){if(this._active&&!(f.length<this._minTouches)){if(this._map._cooperativeGestures&&!this._map.isMoving()){if(f.length===1&&!s.ex())return void this._showTouchPanBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}return n.cancelable&&n.preventDefault(),this._calculateTransform(n,a,f)}}touchend(n,a,f){this._calculateTransform(n,a,f),this._active&&f.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(n,a,f){f.length>0&&(this._active=!0);const g=uf(f,a),y=new s.P(0,0),b=new s.P(0,0);let E=0;for(const R in g){const D=g[R],F=this._touches[R];F&&(y._add(D),b._add(D.sub(F)),E++,g[R]=D)}if(this._touches=g,E<this._minTouches||!b.mag())return;const A=b.div(E);return this._sum._add(A),this._sum.mag()<this._clickTolerance?void 0:{around:y.div(E),panDelta:A}}enable(){this._enabled=!0,this._map._cooperativeGestures&&(this._addTouchPanBlocker(),this._el.classList.add("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page"))}disable(){this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove(),this._el.classList.remove("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page")),this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}_addTouchPanBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=H("div","mapboxgl-touch-pan-blocker",this._map._container),this._alertContainer.textContent=this._map._getUIString("TouchPanBlocker.Message"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showTouchPanBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-touch-pan-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=window.setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-touch-pan-blocker-show"),this._alertContainer.removeAttribute("role")},500)}}class ff{constructor(){this.reset()}reset(){this._active=!1,this._firstTwoTouches=void 0}_start(n){}_move(n,a,f){return{}}touchstart(n,a,f){this._firstTwoTouches||f.length<2||(this._firstTwoTouches=[f[0].identifier,f[1].identifier],this._start([a[0],a[1]]))}touchmove(n,a,f){const g=this._firstTwoTouches;if(!g)return;n.preventDefault();const[y,b]=g,E=ld(f,a,y),A=ld(f,a,b);if(!E||!A)return;const R=this._aroundCenter?null:E.add(A).div(2);return this._move([E,A],R,n)}touchend(n,a,f){if(!this._firstTwoTouches)return;const[g,y]=this._firstTwoTouches,b=ld(f,a,g),E=ld(f,a,y);b&&E||(this._active&&Pe(),this.reset())}touchcancel(){this.reset()}enable(n){this._enabled=!0,this._aroundCenter=!!n&&n.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function ld(h,n,a){for(let f=0;f<h.length;f++)if(h[f].identifier===a)return n[f]}function pf(h,n){return Math.log(h/n)/Math.LN2}class uy extends ff{reset(){super.reset(),this._distance=0,this._startDistance=0}_start(n){this._startDistance=this._distance=n[0].dist(n[1])}_move(n,a){const f=this._distance;if(this._distance=n[0].dist(n[1]),this._active||!(Math.abs(pf(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:pf(this._distance,f),pinchAround:a}}}function mm(h,n){return 180*h.angleWith(n)/Math.PI}class M0 extends ff{reset(){super.reset(),this._minDiameter=0,this._startVector=void 0,this._vector=void 0}_start(n){this._startVector=this._vector=n[0].sub(n[1]),this._minDiameter=n[0].dist(n[1])}_move(n,a){const f=this._vector;if(this._vector=n[0].sub(n[1]),f&&(this._active||!this._isBelowThreshold(this._vector)))return this._active=!0,{bearingDelta:mm(this._vector,f),pinchAround:a}}_isBelowThreshold(n){this._minDiameter=Math.min(this._minDiameter,n.mag());const a=25/(Math.PI*this._minDiameter)*360,f=this._startVector;if(!f)return!1;const g=mm(n,f);return Math.abs(g)<a}}function gm(h){return Math.abs(h.y)>Math.abs(h.x)}class R0 extends ff{constructor(n){super(),this._map=n}reset(){super.reset(),this._valid=void 0,this._firstMove=void 0,this._lastPoints=void 0}_start(n){this._lastPoints=n,gm(n[0].sub(n[1]))&&(this._valid=!1)}_move(n,a,f){const g=this._lastPoints;if(!g)return;const y=n[0].sub(g[0]),b=n[1].sub(g[1]);return this._map._cooperativeGestures&&!s.ex()&&f.touches.length<3||(this._valid=this.gestureBeginsVertically(y,b,f.timeStamp),!this._valid)?void 0:(this._lastPoints=n,this._active=!0,{pitchDelta:(y.y+b.y)/2*-.5})}gestureBeginsVertically(n,a,f){if(this._valid!==void 0)return this._valid;const g=n.mag()>=2,y=a.mag()>=2;if(!g&&!y)return;if(!g||!y)return this._firstMove==null&&(this._firstMove=f),f-this._firstMove<100&&void 0;const b=n.y>0==a.y>0;return gm(n)&&gm(a)&&b}}const k0={panStep:100,bearingStep:15,pitchStep:10};class D0{constructor(){const n=k0;this._panStep=n.panStep,this._bearingStep=n.bearingStep,this._pitchStep=n.pitchStep,this._rotationDisabled=!1}blur(){this.reset()}reset(){this._active=!1}keydown(n){if(n.altKey||n.ctrlKey||n.metaKey)return;let a=0,f=0,g=0,y=0,b=0;switch(n.keyCode){case 61:case 107:case 171:case 187:a=1;break;case 189:case 109:case 173:a=-1;break;case 37:n.shiftKey?f=-1:(n.preventDefault(),y=-1);break;case 39:n.shiftKey?f=1:(n.preventDefault(),y=1);break;case 38:n.shiftKey?g=1:(n.preventDefault(),b=-1);break;case 40:n.shiftKey?g=-1:(n.preventDefault(),b=1);break;default:return}return this._rotationDisabled&&(f=0,g=0),{cameraAnimation:E=>{const A=E.getZoom();E.easeTo({duration:300,easeId:"keyboardHandler",easing:L0,zoom:a?Math.round(A)+a*(n.shiftKey?2:1):A,bearing:E.getBearing()+f*this._bearingStep,pitch:E.getPitch()+g*this._pitchStep,offset:[-y*this._panStep,-b*this._panStep],center:E.getCenter()},{originalEvent:n})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function L0(h){return h*(2-h)}const dy=4.000244140625,N0=1/450;class z0{constructor(n,a){this._map=n,this._el=n.getCanvasContainer(),this._handler=a,this._delta=0,this._lastDelta=0,this._defaultZoomRate=.01,this._wheelZoomRate=N0,s.aV(["_onTimeout","_addScrollZoomBlocker","_showBlockerAlert"],this)}setZoomRate(n){this._defaultZoomRate=n}setWheelZoomRate(n){this._wheelZoomRate=n}isEnabled(){return!!this._enabled}isActive(){return this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(n){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!n&&n.around==="center",this._map._cooperativeGestures&&this._addScrollZoomBlocker())}disable(){this.isEnabled()&&(this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove()))}wheel(n){if(!this.isEnabled())return;if(this._map._cooperativeGestures){if(!(n.ctrlKey||n.metaKey||this.isZooming()||s.ex()))return void this._showBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}let a=n.deltaMode===WheelEvent.DOM_DELTA_LINE?40*n.deltaY:n.deltaY;const f=s.q.now(),g=f-(this._lastWheelEventTime||0);this._lastWheelEventTime=f,a!==0&&a%dy==0?this._type="wheel":a!==0&&Math.abs(a)<4?this._type="trackpad":g>400?(this._type=null,this._lastValue=a,this._timeout=window.setTimeout(this._onTimeout,40,n)):this._type||(this._type=Math.abs(g*a)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,a+=this._lastValue)),n.shiftKey&&a&&(a/=4),this._type&&(this._lastWheelEvent=n,this._delta-=a,this._active||this._start(n)),n.preventDefault()}_onTimeout(n){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(n)}_start(n){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const a=Ye(this._el,n);this._aroundPoint=this._aroundCenter?this._map.transform.centerPoint:a,this._aroundCoord=this._map.transform.pointCoordinate3D(this._aroundPoint),this._targetZoom=void 0,this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const n=this._map.transform;this._type==="wheel"&&n.projection.wrap&&(n._center.lng>=180||n._center.lng<=-180)&&(this._prevEase=null,this._easing=null,this._lastWheelEvent=null,this._lastWheelEventTime=0);const a=()=>n._terrainEnabled()&&this._aroundCoord?n.computeZoomRelativeTo(this._aroundCoord):n.zoom;if(this._delta!==0){const R=this._type==="wheel"&&Math.abs(this._delta)>dy?this._wheelZoomRate:this._defaultZoomRate;let D=2/(1+Math.exp(-Math.abs(this._delta*R)));this._delta<0&&D!==0&&(D=1/D);const F=a(),N=Math.pow(2,F),j=typeof this._targetZoom=="number"?n.zoomScale(this._targetZoom):N;this._targetZoom=Math.min(n.maxZoom,Math.max(n.minZoom,n.scaleZoom(j*D))),this._type==="wheel"&&(this._startZoom=F,this._easing=this._smoothOutEasing(200)),this._lastDelta=this._delta,this._delta=0}const f=typeof this._targetZoom=="number"?this._targetZoom:a(),g=this._startZoom,y=this._easing;let b,E=!1;if(this._type==="wheel"&&g&&y){const R=Math.min((s.q.now()-this._lastWheelEventTime)/200,1),D=y(R);b=s.ai(g,f,D),R<1?this._frameId||(this._frameId=!0):E=!0}else b=f,E=!0;this._active=!0,E&&(this._active=!1,this._finishTimeout=window.setTimeout(()=>{this._zooming=!1,this._handler._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200));let A=b-a();return A*this._lastDelta<0&&(A=0),{noInertia:!0,needsRenderFrame:!E,zoomDelta:A,around:this._aroundPoint,aroundCoord:this._aroundCoord,originalEvent:this._lastWheelEvent}}_smoothOutEasing(n){let a=s.ey;if(this._prevEase){const f=this._prevEase,g=(s.q.now()-f.start)/f.duration,y=f.easing(g+.01)-f.easing(g),b=.27/Math.sqrt(y*y+1e-4)*.01,E=Math.sqrt(.0729-b*b);a=s.ew(b,E,.25,1)}return this._prevEase={start:s.q.now(),duration:n,easing:a},a}blur(){this.reset()}reset(){this._active=!1}_addScrollZoomBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=H("div","mapboxgl-scroll-zoom-blocker",this._map._container),this._alertContainer.textContent=/(Mac|iPad)/i.test(navigator.userAgent)?this._map._getUIString("ScrollZoomBlocker.CmdMessage"):this._map._getUIString("ScrollZoomBlocker.CtrlMessage"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=window.setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.removeAttribute("role")},200)}}class O0{constructor(n,a){this._clickZoom=n,this._tapZoom=a}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class F0{constructor(){this.reset()}reset(){this._active=!1}blur(){this.reset()}dblclick(n,a){return n.preventDefault(),{cameraAnimation:f=>{f.easeTo({duration:300,zoom:f.getZoom()+(n.shiftKey?-1:1),around:f.unproject(a)},{originalEvent:n})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class j0{constructor(){this._tap=new df({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,this._swipePoint=void 0,this._swipeTouch=0,this._tapTime=0,this._tap.reset()}touchstart(n,a,f){this._swipePoint||(this._tapTime&&n.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?f.length>0&&(this._swipePoint=a[0],this._swipeTouch=f[0].identifier):this._tap.touchstart(n,a,f))}touchmove(n,a,f){if(this._tapTime){if(this._swipePoint){if(f[0].identifier!==this._swipeTouch)return;const g=a[0],y=g.y-this._swipePoint.y;return this._swipePoint=g,n.preventDefault(),this._active=!0,{zoomDelta:y/128}}}else this._tap.touchmove(n,a,f)}touchend(n,a,f){this._tapTime?this._swipePoint&&f.length===0&&this.reset():this._tap.touchend(n,a,f)&&(this._tapTime=n.timeStamp)}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class B0{constructor(n,a,f){this._el=n,this._mousePan=a,this._touchPan=f}enable(n){this._inertiaOptions=n||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class fS{constructor(n,a,f){this._pitchWithRotate=n.pitchWithRotate,this._mouseRotate=a,this._mousePitch=f}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class pS{constructor(n,a,f,g){this._el=n,this._touchZoom=a,this._touchRotate=f,this._tapDragZoom=g,this._rotationDisabled=!1,this._enabled=!0}enable(n){this._touchZoom.enable(n),this._rotationDisabled||this._touchRotate.enable(n),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}const _m=h=>h.zoom||h.drag||h.pitch||h.rotate;class Ai extends s.A{}class V0{constructor(){this.constants=[1,1,.01],this.radius=0}setup(n,a){const f=s.at([],a,n);this.radius=s.ae(f[2]<0?s.eA([],f,this.constants):[f[0],f[1],0])}projectRay(n){s.eA(n,n,this.constants),s.au(n,n),s.eB(n,n,this.constants);const a=s.bY([],n,this.radius);if(a[2]>0){const f=s.bY([],[0,0,1],s.bG(a,[0,0,1])),g=s.bY([],s.au([],[a[0],a[1],0]),this.radius),y=s.cV([],a,s.bY([],s.at([],s.cV([],g,f),a),2));a[0]=y[0],a[1]=y[1]}return a}}function ym(h){return h.panDelta&&h.panDelta.mag()||h.zoomDelta||h.bearingDelta||h.pitchDelta}class hy{constructor(n,a){this._map=n,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new hm(n),this._bearingSnap=a.bearingSnap,this._previousActiveHandlers={},this._trackingEllipsoid=new V0,this._dragOrigin=null,this._eventsInProgress={},this._addDefaultHandlers(a),s.aV(["handleEvent","handleWindowEvent"],this);const f=this._el;this._listeners=[[f,"touchstart",{passive:!0}],[f,"touchmove",{passive:!1}],[f,"touchend",void 0],[f,"touchcancel",void 0],[f,"mousedown",void 0],[f,"mousemove",void 0],[f,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[f,"mouseover",void 0],[f,"mouseout",void 0],[f,"dblclick",void 0],[f,"click",void 0],[f,"keydown",{capture:!1}],[f,"keyup",void 0],[f,"wheel",{passive:!1}],[f,"contextmenu",void 0],[window,"blur",void 0]];for(const[g,y,b]of this._listeners){const E=g===document?this.handleWindowEvent:this.handleEvent;g.addEventListener(y,E,b)}}destroy(){for(const[n,a,f]of this._listeners){const g=n===document?this.handleWindowEvent:this.handleEvent;n.removeEventListener(a,g,f)}}_addDefaultHandlers(n){const a=this._map,f=a.getCanvasContainer();this._add("mapEvent",new iy(a,n));const g=a.boxZoom=new sy(a,n);this._add("boxZoom",g);const y=new oy,b=new F0;a.doubleClickZoom=new O0(b,y),this._add("tapZoom",y),this._add("clickZoom",b);const E=new j0;this._add("tapDragZoom",E);const A=a.touchPitch=new R0(a);this._add("touchPitch",A);const R=new pm(n),D=new ou(n);a.dragRotate=new fS(n,R,D),this._add("mouseRotate",R,["mousePitch"]),this._add("mousePitch",D,["mouseRotate"]);const F=new ly(n),N=new cy(a,n);a.dragPan=new B0(f,F,N),this._add("mousePan",F),this._add("touchPan",N,["touchZoom","touchRotate"]);const j=new M0,X=new uy;a.touchZoomRotate=new pS(f,X,j,E),this._add("touchRotate",j,["touchPan","touchZoom"]),this._add("touchZoom",X,["touchPan","touchRotate"]),this._add("blockableMapEvent",new fm(a));const W=a.scrollZoom=new z0(a,this);this._add("scrollZoom",W,["mousePan"]);const K=a.keyboard=new D0;this._add("keyboard",K);for(const ee of["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"])n.interactive&&n[ee]&&a[ee].enable(n[ee])}_add(n,a,f){this._handlers.push({handlerName:n,handler:a,allowed:f}),this._handlersById[n]=a}stop(n){if(!this._updatingCamera){for(const{handler:a}of this._handlers)a.reset();this._inertia.clear(),this._fireEvents({},{},n),this._changes=[],this._originalZoom=void 0}}isActive(){for(const{handler:n}of this._handlers)if(n.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!_m(this._eventsInProgress)||this.isZooming()}_isDragging(){return!!this._eventsInProgress.drag}_blockedByActive(n,a,f){for(const g in n)if(g!==f&&(!a||a.indexOf(g)<0))return!0;return!1}handleWindowEvent(n){this.handleEvent(n,`${n.type}Window`)}_getMapTouches(n){const a=[];for(const f of n)this._el.contains(f.target)&&a.push(f);return a}handleEvent(n,a){this._updatingCamera=!0;const f=n.type==="renderFrame",g=f?void 0:n,y={needsRenderFrame:!1},b={},E={},A=n.touches?this._getMapTouches(n.touches):void 0,R=A?vt(this._el,A):f?void 0:Ye(this._el,n);for(const{handlerName:N,handler:j,allowed:X}of this._handlers){if(!j.isEnabled())continue;let W;this._blockedByActive(E,X,N)?j.reset():j[a||n.type]&&(W=j[a||n.type](n,R,A),this.mergeHandlerResult(y,b,W,N,g),W&&W.needsRenderFrame&&this._triggerRenderFrame()),(W||j.isActive())&&(E[N]=j)}const D={};for(const N in this._previousActiveHandlers)E[N]||(D[N]=g);this._previousActiveHandlers=E,(Object.keys(D).length||ym(y))&&(this._changes.push([y,b,D]),this._triggerRenderFrame()),(Object.keys(E).length||ym(y))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:F}=y;F&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],F(this._map))}mergeHandlerResult(n,a,f,g,y){if(!f)return;s.h(n,f);const b={handlerName:g,originalEvent:f.originalEvent||y};f.zoomDelta!==void 0&&(a.zoom=b),f.panDelta!==void 0&&(a.drag=b),f.pitchDelta!==void 0&&(a.pitch=b),f.bearingDelta!==void 0&&(a.rotate=b)}_applyChanges(){const n={},a={},f={};for(const[g,y,b]of this._changes)g.panDelta&&(n.panDelta=(n.panDelta||new s.P(0,0))._add(g.panDelta)),g.zoomDelta&&(n.zoomDelta=(n.zoomDelta||0)+g.zoomDelta),g.bearingDelta&&(n.bearingDelta=(n.bearingDelta||0)+g.bearingDelta),g.pitchDelta&&(n.pitchDelta=(n.pitchDelta||0)+g.pitchDelta),g.around!==void 0&&(n.around=g.around),g.aroundCoord!==void 0&&(n.aroundCoord=g.aroundCoord),g.pinchAround!==void 0&&(n.pinchAround=g.pinchAround),g.noInertia&&(n.noInertia=g.noInertia),s.h(a,y),s.h(f,b);this._updateMapTransform(n,a,f),this._changes=[]}_updateMapTransform(n,a,f){const g=this._map,y=g.transform,b=ie=>[ie.x,ie.y,ie.z];if((ie=>{const fe=this._eventsInProgress.drag;return fe&&!this._handlersById[fe.handlerName].isActive()})()&&!ym(n)){const ie=y.zoom;y.cameraElevationReference="sea",this._originalZoom!=null&&y._orthographicProjectionAtLowPitch&&y.projection.name!=="globe"&&y.pitch===0?(y.cameraElevationReference="ground",y.zoom=this._originalZoom):(y.recenterOnTerrain(),y.cameraElevationReference="ground"),ie!==y.zoom&&this._map._update(!0)}if(y._isCameraConstrained&&g._stop(!0),!ym(n))return void this._fireEvents(a,f,!0);let{panDelta:E,zoomDelta:A,bearingDelta:R,pitchDelta:D,around:F,aroundCoord:N,pinchAround:j}=n;y._isCameraConstrained&&(A>0&&(A=0),y._isCameraConstrained=!1),j!==void 0&&(F=j),(A||(ie=>a[ie]&&!this._eventsInProgress[ie])("drag"))&&F&&(this._dragOrigin=b(y.pointCoordinate3D(F)),this._originalZoom=y.zoom,this._trackingEllipsoid.setup(y._camera.position,this._dragOrigin)),y.cameraElevationReference="sea",g._stop(!0),F=F||g.transform.centerPoint,R&&(y.bearing+=R),D&&(y.pitch+=D),y._updateCameraState();const X=[0,0,0];if(E)if(y.projection.name==="mercator"){const ie=this._trackingEllipsoid.projectRay(y.screenPointToMercatorRay(F).dir),fe=this._trackingEllipsoid.projectRay(y.screenPointToMercatorRay(F.sub(E)).dir);X[0]=fe[0]-ie[0],X[1]=fe[1]-ie[1]}else{const ie=y.pointCoordinate(F);if(y.projection.name==="globe"){E=E.rotate(-y.angle);const fe=y._pixelsPerMercatorPixel/y.worldSize;X[0]=-E.x*s.ez(s.aY(ie.y))*fe,X[1]=-E.y*s.ez(y.center.lat)*fe}else{const fe=y.pointCoordinate(F.sub(E));ie&&fe&&(X[0]=fe.x-ie.x,X[1]=fe.y-ie.y)}}const W=y.zoom,K=[0,0,0];if(A){const ie=b(N||y.pointCoordinate3D(F)),fe={dir:s.au([],s.at([],ie,y._camera.position))};if(fe.dir[2]<0){const _e=y.zoomDeltaToMovement(ie,A);s.bY(K,fe.dir,_e)}}const ee=s.cV(X,X,K);y._translateCameraConstrained(ee),A&&Math.abs(y.zoom-W)>1e-4&&y.recenterOnTerrain(),y.cameraElevationReference="ground",this._map._update(),n.noInertia||this._inertia.record(n),this._fireEvents(a,f,!0)}_fireEvents(n,a,f){const g=_m(this._eventsInProgress),y=_m(n),b={};for(const D in n){const{originalEvent:F}=n[D];this._eventsInProgress[D]||(b[`${D}start`]=F),this._eventsInProgress[D]=n[D]}!g&&y&&this._fireEvent("movestart",y.originalEvent);for(const D in b)this._fireEvent(D,b[D]);y&&this._fireEvent("move",y.originalEvent);for(const D in n){const{originalEvent:F}=n[D];this._fireEvent(D,F)}const E={};let A;for(const D in this._eventsInProgress){const{handlerName:F,originalEvent:N}=this._eventsInProgress[D];this._handlersById[F].isActive()||(delete this._eventsInProgress[D],A=a[F]||N,E[`${D}end`]=A)}for(const D in E)this._fireEvent(D,E[D]);const R=_m(this._eventsInProgress);if(f&&(g||y)&&!R){this._updatingCamera=!0;const D=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),F=N=>N!==0&&-this._bearingSnap<N&&N<this._bearingSnap;D?(F(D.bearing||this._map.getBearing())&&(D.bearing=0),this._map.easeTo(D,{originalEvent:A})):(this._map.fire(new s.A("moveend",{originalEvent:A})),F(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}}_fireEvent(n,a){this._map.fire(new s.A(n,a?{originalEvent:a}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(n=>{this._frameId=void 0,this.handleEvent(new Ai("renderFrame",{timeStamp:n})),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}const U0="map.setFreeCameraOptions(...) and map.getFreeCameraOptions() are not yet supported for non-mercator projections.";class mf extends s.E{constructor(n,a){super(),this._moving=!1,this._zooming=!1,this.transform=n,this._bearingSnap=a.bearingSnap,this._respectPrefersReducedMotion=a.respectPrefersReducedMotion!==!1,s.aV(["_renderFrameCallback"],this)}getCenter(){return new s.cd(this.transform.center.lng,this.transform.center.lat)}setCenter(n,a){return this.jumpTo({center:n},a)}panBy(n,a,f){return n=s.P.convert(n).mult(-1),this.panTo(this.transform.center,s.h({offset:n},a),f)}panTo(n,a,f){return this.easeTo(s.h({center:n},a),f)}getZoom(){return this.transform.zoom}setZoom(n,a){return this.jumpTo({zoom:n},a),this}zoomTo(n,a,f){return this.easeTo(s.h({zoom:n},a),f)}zoomIn(n,a){return this.zoomTo(this.getZoom()+1,n,a),this}zoomOut(n,a){return this.zoomTo(this.getZoom()-1,n,a),this}getBearing(){return this.transform.bearing}setBearing(n,a){return this.jumpTo({bearing:n},a),this}getPadding(){return this.transform.padding}setPadding(n,a){return this.jumpTo({padding:n},a),this}rotateTo(n,a,f){return this.easeTo(s.h({bearing:n},a),f)}resetNorth(n,a){return this.rotateTo(0,s.h({duration:1e3},n),a),this}resetNorthPitch(n,a){return this.easeTo(s.h({bearing:0,pitch:0,duration:1e3},n),a),this}snapToNorth(n,a){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(n,a):this}getPitch(){return this.transform.pitch}setPitch(n,a){return this.jumpTo({pitch:n},a),this}cameraForBounds(n,a){n=s.aG.convert(n);const f=a&&a.bearing||0,g=a&&a.pitch||0,y=n.getNorthWest(),b=n.getSouthEast();return this._cameraForBounds(this.transform,y,b,f,g,a)}_extendPadding(n){const a={top:0,right:0,bottom:0,left:0};return n==null?s.h({},a,this.transform.padding):typeof n=="number"?{top:n,bottom:n,right:n,left:n}:s.h({},a,n)}_extendCameraOptions(n){return(n=s.h({offset:[0,0],maxZoom:this.transform.maxZoom},n)).padding=this._extendPadding(n.padding),n}_minimumAABBFrustumDistance(n,a){const f=a.max[0]-a.min[0],g=a.max[1]-a.min[1];return f/g>n.aspect?f/(2*Math.tan(.5*n.fovX)*n.aspect):g/(2*Math.tan(.5*n.fovY)*n.aspect)}_cameraForBoundsOnGlobe(n,a,f,g,y,b){const E=n.clone(),A=this._extendCameraOptions(b);E.bearing=g,E.pitch=y;const R=s.cd.convert(a),D=s.cd.convert(f),F=.5*(R.lat+D.lat),N=.5*(R.lng+D.lng),j=s.eC(F,N),X=s.au([],j),W=s.au([],s.bF([],X,[0,1,0])),K=s.bF([],W,X),ee=[W[0],W[1],W[2],0,K[0],K[1],K[2],0,X[0],X[1],X[2],0,0,0,0,1],ie=[j,s.eC(R.lat,R.lng),s.eC(D.lat,R.lng),s.eC(D.lat,D.lng),s.eC(R.lat,D.lng),s.eC(F,R.lng),s.eC(F,D.lng),s.eC(R.lat,N),s.eC(D.lat,N)];let fe=s.cW.fromPoints(ie.map(Ge=>[s.bG(W,Ge),s.bG(K,Ge),s.bG(X,Ge)]));const _e=s.ad([],fe.center,ee);s.eD(_e)===0&&s.eE(_e,0,0,1),s.au(_e,_e),s.bY(_e,_e,s.aB),E.center=s.eF(_e);const we=E.getWorldToCameraMatrix(),be=s.bi(new Float64Array(16),we);fe=s.cW.applyTransform(fe,s.az([],we,ee));const ve=this._extendAABB(fe,E,A,g);if(!ve)return void s.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");fe=ve,s.ad(_e,_e,we);const ye=.5*(fe.max[2]-fe.min[2]),Se=this._minimumAABBFrustumDistance(E,fe),Ee=s.bY([],[0,0,1],ye),Fe=s.cV(Ee,_e,Ee),je=Se+(E.pitch===0?0:s.bD(_e,Fe)),rt=E.globeCenterInViewSpace,it=s.at([],_e,[rt[0],rt[1],rt[2]]);s.au(it,it),s.bY(it,it,je);const gt=s.cV([],_e,it);s.ad(gt,gt,be);const ze=s.eq/s.aB,Xe=s.ae(gt),Re=s.c6(Math.max(Xe*ze-s.eq,Number.EPSILON),0),ot=Math.min(E.zoomFromMercatorZAdjusted(Re),A.maxZoom);return ot>.5*(s.cL+s.cx)?(E.setProjection({name:"mercator"}),E.zoom=ot,this._cameraForBounds(E,a,f,g,y,b)):{center:E.center,zoom:ot,bearing:g,pitch:y}}_extendAABB(n,a,f,g){const y=.5*((f.padding.left||0)+(f.padding.right||0)),b=.5*((f.padding.top||0)+(f.padding.bottom||0)),E=b,A=y,R=y,D=b,F=a.width-(A+R),N=a.height-(E+D),j=s.at([],n.max,n.min),X=Math.min(F/j[0],N/j[1]),W=Math.min(a.scaleZoom(a.scale*X),f.maxZoom);if(isNaN(W))return null;const K=a.scale/a.zoomScale(W),ee=new s.cW([n.min[0]-A*K,n.min[1]-D*K,n.min[2]],[n.max[0]+R*K,n.max[1]+E*K,n.max[2]]),ie=(typeof f.offset.x=="number"&&typeof f.offset.y=="number"?new s.P(f.offset.x,f.offset.y):s.P.convert(f.offset)).rotate(-s.al(g));return ee.center[0]-=ie.x*K,ee.center[1]+=ie.y*K,ee}queryTerrainElevation(n,a){const f=this.transform.elevation;return f?(a=s.h({},{exaggerated:!0},a),f.getAtPoint(s.ac.fromLngLat(n),null,a.exaggerated)):null}_cameraForBounds(n,a,f,g,y,b){if(n.projection.name==="globe")return this._cameraForBoundsOnGlobe(n,a,f,g,y,b);const E=n.clone(),A=this._extendCameraOptions(b);E.bearing=g,E.pitch=y;const R=s.cd.convert(a),D=s.cd.convert(f),F=new s.cd(R.lng,D.lat),N=new s.cd(D.lng,R.lat),j=E.project(R),X=E.project(D),W=this.queryTerrainElevation(R),K=this.queryTerrainElevation(D),ee=this.queryTerrainElevation(F),ie=this.queryTerrainElevation(N),fe=[[j.x,j.y,Math.min(W||0,K||0,ee||0,ie||0)],[X.x,X.y,Math.max(W||0,K||0,ee||0,ie||0)]];let _e=s.cW.fromPoints(fe);const we=E.getWorldToCameraMatrix(),be=s.bi(new Float64Array(16),we);_e=s.cW.applyTransform(_e,we);const ve=this._extendAABB(_e,E,A,g);if(!ve)return void s.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");_e=ve;const ye=.5*s.at([],_e.max,_e.min)[2],Se=this._minimumAABBFrustumDistance(E,_e),Ee=[0,0,1,0];s.aA(Ee,Ee,we),s.eG(Ee,Ee);const Fe=s.bY([],Ee,Se+ye),je=s.cV([],_e.center,Fe);s.ad(_e.center,_e.center,be),s.ad(je,je,be);const rt=E.unproject(new s.P(_e.center[0],_e.center[1])),it=s.eH(E.projection,rt),gt=Math.pow(2,it),ze=Math.min(E._zoomFromMercatorZ(je[2]*E.pixelsPerMeter*gt/E.worldSize),A.maxZoom);return E.mercatorFromTransition&&ze<.5*(s.cL+s.cx)?(E.setProjection({name:"globe"}),E.zoom=ze,this._cameraForBounds(E,a,f,g,y,b)):{center:rt,zoom:ze,bearing:g,pitch:y}}fitBounds(n,a,f){const g=this.cameraForBounds(n,a);return this._fitInternal(g,a,f)}fitScreenCoordinates(n,a,f,g,y){const b=s.P.convert(n),E=s.P.convert(a),A=new s.P(Math.min(b.x,E.x),Math.min(b.y,E.y)),R=new s.P(Math.max(b.x,E.x),Math.max(b.y,E.y));if(this.transform.projection.name==="mercator"&&this.transform.anyCornerOffEdge(b,E))return this;const D=this.transform.pointLocation3D(A),F=this.transform.pointLocation3D(R),N=this.transform.pointLocation3D(new s.P(A.x,R.y)),j=this.transform.pointLocation3D(new s.P(R.x,A.y)),X=[Math.min(D.lng,F.lng,N.lng,j.lng),Math.min(D.lat,F.lat,N.lat,j.lat)],W=[Math.max(D.lng,F.lng,N.lng,j.lng),Math.max(D.lat,F.lat,N.lat,j.lat)],K=g&&g.pitch?g.pitch:this.getPitch(),ee=this._cameraForBounds(this.transform,X,W,f,K,g);return this._fitInternal(ee,g,y)}_fitInternal(n,a,f){return n?(a=s.h(n,a)).linear?this.easeTo(a,f):this.flyTo(a,f):this}jumpTo(n,a){this.stop();const f=n.preloadOnly?this.transform.clone():this.transform;let g=!1,y=!1,b=!1;"zoom"in n&&f.zoom!==+n.zoom&&(g=!0,f.zoom=+n.zoom),n.center!==void 0&&(f.center=s.cd.convert(n.center)),"bearing"in n&&f.bearing!==+n.bearing&&(y=!0,f.bearing=+n.bearing),"pitch"in n&&f.pitch!==+n.pitch&&(b=!0,f.pitch=+n.pitch);const E=typeof n.padding=="number"?this._extendPadding(n.padding):n.padding;if(n.padding!=null&&!f.isPaddingEqual(E))if(n.retainPadding===!1){const A=f.clone();A.padding=E,f.setLocationAtPoint(f.center,A.centerPoint)}else f.padding=E;return n.preloadOnly?(this._preloadTiles(f),this):(this.fire(new s.A("movestart",a)).fire(new s.A("move",a)),g&&this.fire(new s.A("zoomstart",a)).fire(new s.A("zoom",a)).fire(new s.A("zoomend",a)),y&&this.fire(new s.A("rotatestart",a)).fire(new s.A("rotate",a)).fire(new s.A("rotateend",a)),b&&this.fire(new s.A("pitchstart",a)).fire(new s.A("pitch",a)).fire(new s.A("pitchend",a)),this.fire(new s.A("moveend",a)))}getFreeCameraOptions(){return this.transform.projection.supportsFreeCamera||s.w(U0),this.transform.getFreeCameraOptions()}setFreeCameraOptions(n,a){const f=this.transform;if(!f.projection.supportsFreeCamera)return s.w(U0),this;this.stop();const g=f.zoom,y=f.pitch,b=f.bearing;f.setFreeCameraOptions(n);const E=g!==f.zoom,A=y!==f.pitch,R=b!==f.bearing;return this.fire(new s.A("movestart",a)).fire(new s.A("move",a)),E&&this.fire(new s.A("zoomstart",a)).fire(new s.A("zoom",a)).fire(new s.A("zoomend",a)),R&&this.fire(new s.A("rotatestart",a)).fire(new s.A("rotate",a)).fire(new s.A("rotateend",a)),A&&this.fire(new s.A("pitchstart",a)).fire(new s.A("pitch",a)).fire(new s.A("pitchend",a)),this.fire(new s.A("moveend",a)),this}easeTo(n,a){this._stop(!1,n.easeId),((n=s.h({offset:[0,0],duration:500,easing:s.ey},n)).animate===!1||this._prefersReducedMotion(n))&&(n.duration=0);const f=this.transform,g=this.getZoom(),y=this.getBearing(),b=this.getPitch(),E=this.getPadding(),A="zoom"in n?+n.zoom:g,R="bearing"in n?this._normalizeBearing(n.bearing,y):y,D="pitch"in n?+n.pitch:b,F=this._extendPadding(n.padding),N=s.P.convert(n.offset);let j,X,W;if(f.projection.name==="globe"){const Ee=s.ac.fromLngLat(f.center),Fe=N.rotate(-f.angle);Ee.x+=Fe.x/f.worldSize,Ee.y+=Fe.y/f.worldSize;const je=Ee.toLngLat(),rt=s.cd.convert(n.center||je);this._normalizeCenter(rt),j=f.centerPoint.add(Fe),X=new s.P(Ee.x,Ee.y).mult(f.worldSize),W=new s.P(s.aD(rt.lng),s.aH(rt.lat)).mult(f.worldSize).sub(X)}else{j=f.centerPoint.add(N);const Ee=f.pointLocation(j),Fe=s.cd.convert(n.center||Ee);this._normalizeCenter(Fe),X=f.project(Ee),W=f.project(Fe).sub(X)}const K=f.zoomScale(A-g);let ee,ie;n.around&&(ee=s.cd.convert(n.around),ie=f.locationPoint(ee));const fe=this._zooming||A!==g,_e=this._rotating||y!==R,we=this._pitching||D!==b,be=!f.isPaddingEqual(F),ve=n.retainPadding===!1?f.clone():f,ye=Ee=>Fe=>{if(fe&&(Ee.zoom=s.ai(g,A,Fe)),_e&&(Ee.bearing=s.ai(y,R,Fe)),we&&(Ee.pitch=s.ai(b,D,Fe)),be&&(ve.interpolatePadding(E,F,Fe),j=ve.centerPoint.add(N)),ee)Ee.setLocationAtPoint(ee,ie);else{const je=Ee.zoomScale(Ee.zoom-g),rt=A>g?Math.min(2,K):Math.max(.5,K),it=Math.pow(rt,1-Fe),gt=Ee.unproject(X.add(W.mult(Fe*it)).mult(je));Ee.setLocationAtPoint(Ee.renderWorldCopies?gt.wrap():gt,j)}return n.preloadOnly||this._fireMoveEvents(a),Ee};if(n.preloadOnly){const Ee=this._emulate(ye,n.duration,f);return this._preloadTiles(Ee),this}const Se={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=fe,this._rotating=_e,this._pitching=we,this._padding=be,this._easeId=n.easeId,this._prepareEase(a,n.noMoveStart,Se),this._ease(ye(f),Ee=>{f.cameraElevationReference==="sea"&&f.recenterOnTerrain(),this._afterEase(a,Ee)},n),this}_prepareEase(n,a,f={}){this._moving=!0,this.transform.cameraElevationReference="sea",this.transform._orthographicProjectionAtLowPitch&&this.transform.pitch===0&&this.transform.projection.name!=="globe"&&(this.transform.cameraElevationReference="ground"),a||f.moving||this.fire(new s.A("movestart",n)),this._zooming&&!f.zooming&&this.fire(new s.A("zoomstart",n)),this._rotating&&!f.rotating&&this.fire(new s.A("rotatestart",n)),this._pitching&&!f.pitching&&this.fire(new s.A("pitchstart",n))}_fireMoveEvents(n){this.fire(new s.A("move",n)),this._zooming&&this.fire(new s.A("zoom",n)),this._rotating&&this.fire(new s.A("rotate",n)),this._pitching&&this.fire(new s.A("pitch",n))}_afterEase(n,a){if(this._easeId&&a&&this._easeId===a)return;this._easeId=void 0,this.transform.cameraElevationReference="ground";const f=this._zooming,g=this._rotating,y=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,f&&this.fire(new s.A("zoomend",n)),g&&this.fire(new s.A("rotateend",n)),y&&this.fire(new s.A("pitchend",n)),this.fire(new s.A("moveend",n))}flyTo(n,a){if(this._prefersReducedMotion(n)){const Ge=s.aF(n,["center","zoom","bearing","pitch","around","padding","retainPadding"]);return this.jumpTo(Ge,a)}this.stop(),n=s.h({offset:[0,0],speed:1.2,curve:1.42,easing:s.ey},n);const f=this.transform,g=this.getZoom(),y=this.getBearing(),b=this.getPitch(),E=this.getPadding(),A="zoom"in n?s.ay(+n.zoom,f.minZoom,f.maxZoom):g,R="bearing"in n?this._normalizeBearing(n.bearing,y):y,D="pitch"in n?+n.pitch:b,F=this._extendPadding(n.padding),N=f.zoomScale(A-g),j=s.P.convert(n.offset);let X=f.centerPoint.add(j);const W=f.pointLocation(X),K=s.cd.convert(n.center||W);this._normalizeCenter(K);const ee=f.project(W),ie=f.project(K).sub(ee);let fe=n.curve;const _e=Math.max(f.width,f.height),we=_e/N,be=ie.mag();if("minZoom"in n){const Ge=s.ay(Math.min(n.minZoom,g,A),f.minZoom,f.maxZoom),dt=_e/f.zoomScale(Ge-g);fe=Math.sqrt(dt/be*2)}const ve=fe*fe;function ye(Ge){const dt=(we*we-_e*_e+(Ge?-1:1)*ve*ve*be*be)/(2*(Ge?we:_e)*ve*be);return Math.log(Math.sqrt(dt*dt+1)-dt)}function Se(Ge){return(Math.exp(Ge)-Math.exp(-Ge))/2}function Ee(Ge){return(Math.exp(Ge)+Math.exp(-Ge))/2}const Fe=ye(0);let je=function(Ge){return Ee(Fe)/Ee(Fe+fe*Ge)},rt=function(Ge){return _e*((Ee(Fe)*(Se(dt=Fe+fe*Ge)/Ee(dt))-Se(Fe))/ve)/be;var dt},it=(ye(1)-Fe)/fe;if(Math.abs(be)<1e-6||!isFinite(it)){if(Math.abs(_e-we)<1e-6)return this.easeTo(n,a);const Ge=we<_e?-1:1;it=Math.abs(Math.log(we/_e))/fe,rt=function(){return 0},je=function(dt){return Math.exp(Ge*fe*dt)}}n.duration="duration"in n?+n.duration:1e3*it/("screenSpeed"in n?+n.screenSpeed/fe:+n.speed),n.maxDuration&&n.duration>n.maxDuration&&(n.duration=0);const gt=y!==R,ze=D!==b,Xe=!f.isPaddingEqual(F),Re=n.retainPadding===!1?f.clone():f,ot=Ge=>dt=>{const At=dt*it,st=1/je(At);Ge.zoom=dt===1?A:g+Ge.scaleZoom(st),gt&&(Ge.bearing=s.ai(y,R,dt)),ze&&(Ge.pitch=s.ai(b,D,dt)),Xe&&(Re.interpolatePadding(E,F,dt),X=Re.centerPoint.add(j));const Tt=dt===1?K:Ge.unproject(ee.add(ie.mult(rt(At))).mult(st));return Ge.setLocationAtPoint(Ge.renderWorldCopies?Tt.wrap():Tt,X),Ge._updateCameraOnTerrain(),n.preloadOnly||this._fireMoveEvents(a),Ge};if(n.preloadOnly){const Ge=this._emulate(ot,n.duration,f);return this._preloadTiles(Ge),this}return this._zooming=!0,this._rotating=gt,this._pitching=ze,this._padding=Xe,this._prepareEase(a,!1),this._ease(ot(f),()=>this._afterEase(a),n),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_requestRenderFrame(n){}_cancelRenderFrame(n){}_stop(n,a){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),this._easeFrameId=void 0,this._onEaseFrame=void 0),this._onEaseEnd){const f=this._onEaseEnd;this._onEaseEnd=void 0,f.call(this,a)}if(!n){const f=this.handlers;f&&f.stop(!1)}return this}_ease(n,a,f){f.animate===!1||f.duration===0?(n(1),a()):(this._easeStart=s.q.now(),this._easeOptions=f,this._onEaseFrame=n,this._onEaseEnd=a,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_renderFrameCallback(){const n=Math.min((s.q.now()-this._easeStart)/this._easeOptions.duration,1),a=this._onEaseFrame;a&&a(this._easeOptions.easing(n)),n<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()}_normalizeBearing(n,a){n=s.bX(n,-180,180);const f=Math.abs(n-a);return Math.abs(n-360-a)<f&&(n-=360),Math.abs(n+360-a)<f&&(n+=360),n}_normalizeCenter(n){const a=this.transform;if(a.maxBounds||a.projection.name!=="globe"&&!a.renderWorldCopies)return;const f=n.lng-a.center.lng;n.lng+=f>180?-360:f<-180?360:0}_prefersReducedMotion(n){return this._respectPrefersReducedMotion&&s.q.prefersReducedMotion&&!(n&&n.essential)}_emulate(n,a,f){const g=Math.ceil(15*a/1e3),y=[],b=n(f.clone());for(let E=0;E<=g;E++){const A=b(E/g);y.push(A.clone())}return y}_preloadTiles(n,a){}}class fy{constructor(n={}){this.options=n,s.aV(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)}getDefaultPosition(){return"bottom-right"}onAdd(n){const a=this.options&&this.options.compact,f=n._getUIString("AttributionControl.ToggleAttribution");this._map=n,this._container=H("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=H("button","mapboxgl-ctrl-attrib-button",this._container),this._compactButton.type="button",this._compactButton.addEventListener("click",this._toggleAttribution),this._compactButton.setAttribute("aria-label",f);const g=H("span","mapboxgl-ctrl-icon",this._compactButton);return g.setAttribute("aria-hidden","true"),g.setAttribute("title",f),this._innerContainer=H("div","mapboxgl-ctrl-attrib-inner",this._container),a&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),a===void 0&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container}onRemove(){this._container.remove(),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0}_toggleAttribution(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","true"))}_updateEditLink(){let n=this._editLink;n||(n=this._editLink=this._container.querySelector(".mapbox-improve-map"));const a=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||s.e.ACCESS_TOKEN}];if(n){const f=a.reduce((g,y,b)=>(y.value&&(g+=`${y.key}=${y.value}${b<a.length-1?"&":""}`),g),"?");n.href=`${s.e.FEEDBACK_URL}/${f}#${dm(this._map,!0)}`,n.rel="noopener nofollow"}}_updateData(n){!n||n.sourceDataType!=="metadata"&&n.sourceDataType!=="visibility"&&n.dataType!=="style"||(this._updateAttributions(),this._updateEditLink())}_updateAttributions(){if(!this._map.style)return;let n=[];if(this._map.style.stylesheet){const g=this._map.style.stylesheet;this.styleOwner=g.owner,this.styleId=g.id}const a=this._map.style._mergedSourceCaches;for(const g in a){const y=a[g];if(y.used){const b=y.getSource();b.attribution&&n.indexOf(b.attribution)<0&&n.push(b.attribution)}}n.sort((g,y)=>g.length-y.length),n=n.filter((g,y)=>{for(let b=y+1;b<n.length;b++)if(n[b].indexOf(g)>=0)return!1;return!0}),this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?n=[...this.options.customAttribution,...n]:n.unshift(this.options.customAttribution));const f=n.join(" | ");f!==this._attribHTML&&(this._attribHTML=f,n.length?(this._innerContainer.innerHTML=f,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}_updateCompact(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")}}class vm{constructor(){s.aV(["_updateLogo","_updateCompact"],this)}onAdd(n){this._map=n,this._container=H("div","mapboxgl-ctrl");const a=H("a","mapboxgl-ctrl-logo");return a.target="_blank",a.rel="noopener nofollow",a.href="https://www.mapbox.com/",a.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),a.setAttribute("rel","noopener nofollow"),this._container.appendChild(a),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){this._container.remove(),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)}getDefaultPosition(){return"bottom-left"}_updateLogo(n){n&&n.sourceDataType!=="metadata"||(this._container.style.display=this._logoRequired()?"block":"none")}_logoRequired(){if(!this._map.style)return!0;const n=this._map.style._sourceCaches;if(Object.entries(n).length===0)return!0;for(const a in n){const f=n[a].getSource();if(f.hasOwnProperty("mapbox_logo")&&!f.mapbox_logo)return!1}return!0}_updateCompact(){const n=this._container.children;if(n.length){const a=n[0];this._map.getCanvasContainer().offsetWidth<250?a.classList.add("mapboxgl-compact"):a.classList.remove("mapboxgl-compact")}}}class gf{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(n){const a=++this._id;return this._queue.push({callback:n,id:a,cancelled:!1}),a}remove(n){const a=this._currentlyRunning,f=a?this._queue.concat(a):this._queue;for(const g of f)if(g.id===n)return void(g.cancelled=!0)}run(n=0){const a=this._currentlyRunning=this._queue;this._queue=[];for(const f of a)if(!f.cancelled&&(f.callback(n),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}class gl{constructor(n){this.jumpTo(n)}getValue(n){if(n<=this._startTime)return this._start;if(n>=this._endTime)return this._end;const a=s.dk((n-this._startTime)/(this._endTime-this._startTime));return this._start*(1-a)+this._end*a}isEasing(n){return n>=this._startTime&&n<=this._endTime}jumpTo(n){this._startTime=-1/0,this._endTime=-1/0,this._start=n,this._end=n}easeTo(n,a,f){this._start=this.getValue(a),this._end=n,this._startTime=a,this._endTime=a+f}}const xm={"AttributionControl.ToggleAttribution":"Toggle attribution","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox homepage","Map.Title":"Map","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScrollZoomBlocker.CtrlMessage":"Use ctrl + scroll to zoom the map","ScrollZoomBlocker.CmdMessage":"Use ⌘ + scroll to zoom the map","TouchPanBlocker.Message":"Use two fingers to move the map"};class ji extends s.A{constructor(n,a,f,g){const{point:y,lngLat:b,originalEvent:E,target:A}=n;super(n.type,{point:y,lngLat:b,originalEvent:E,target:A}),this.preventDefault=()=>{n.preventDefault()},this.id=a,this.interaction=f,this.feature=g}}class Ba{constructor(n){this.map=n,this.interactionsByType=new Map,this.delegatedInteractions=new Map,this.typeById=new Map,this.filters=new Map,this.handleType=this.handleType.bind(this),this.handleMove=this.handleMove.bind(this),this.handleOut=this.handleOut.bind(this),this.hoveredFeatures=new Map,this.prevHoveredFeatures=new Map}add(n,a){if(this.typeById.has(n))throw new Error(`Interaction id "${n}" already exists.`);const f=a.filter;let g=a.type;f&&this.filters.set(n,s.b3(f)),g==="mouseover"&&(g="mouseenter"),g==="mouseout"&&(g="mouseleave");const y=this.interactionsByType.get(g)||new Map;g==="mouseenter"||g==="mouseleave"?(this.delegatedInteractions.size===0&&(this.map.on("mousemove",this.handleMove),this.map.on("mouseout",this.handleOut)),this.delegatedInteractions.set(n,a)):y.size===0&&this.map.on(g,this.handleType),y.size===0&&this.interactionsByType.set(g,y),y.set(n,a),this.typeById.set(n,g)}get(n){const a=this.typeById.get(n);if(!a)return;const f=this.interactionsByType.get(a);return f?f.get(n):void 0}remove(n){const a=this.typeById.get(n);if(!a)return;this.typeById.delete(n),this.filters.delete(n);const f=this.interactionsByType.get(a);f&&(f.delete(n),a==="mouseenter"||a==="mouseleave"?(this.delegatedInteractions.delete(n),this.delegatedInteractions.size===0&&(this.map.off("mousemove",this.handleMove),this.map.off("mouseout",this.handleOut))):f.size===0&&this.map.off(a,this.handleType))}queryTargets(n,a){const f=[];for(const[g,y]of a)y.target&&f.push({targetId:g,target:y.target,filter:this.filters.get(g)});return this.map.style.queryRenderedTargets(n,f,this.map.transform)}handleMove(n){this.prevHoveredFeatures=this.hoveredFeatures,this.hoveredFeatures=new Map;const a=this.queryTargets(n.point,Array.from(this.delegatedInteractions).reverse());a.length&&(n.type="mouseenter",this.handleType(n,a));const f=new Map;for(const[g,{feature:y}]of this.prevHoveredFeatures)this.hoveredFeatures.has(g)||f.set(y.id,y);f.size&&(n.type="mouseleave",this.handleType(n,Array.from(f.values())))}handleOut(n){const a=Array.from(this.hoveredFeatures.values()).map(({feature:f})=>f);a.length&&(n.type="mouseleave",this.handleType(n,a)),this.hoveredFeatures.clear()}handleType(n,a){const f=n.type==="mouseenter";if(f&&!this.interactionsByType.has(n.type))return void s.w("mouseenter interaction required for mouseleave to work.");const g=Array.from(this.interactionsByType.get(n.type)).reverse(),y=!!a;a=a||this.queryTargets(n.point,g);let b=!1;const E=new Set;for(const A of a){for(const[R,D]of g){if(!D.target)continue;const F=A.variants?A.variants[R]:null;if(F){for(const N of F){if(Tp(N,A,E,R))continue;const j=new s.de(A,N),X=Ih(N,A,R);y&&(j.state=this.map.getFeatureState(j));const W=f?this.prevHoveredFeatures.get(X):null,K=new ji(n,R,D,j),ee=W?W.stop:D.handler(K);if(f&&this.hoveredFeatures.set(X,{feature:A,stop:ee}),ee!==!1){b=!0;break}}if(b)break}}if(b)break}if(!b)for(const[A,R]of g){const{handler:D,target:F}=R;if(!F&&D(new ji(n,A,R,null))!==!1)break}}}function _f(h,n){if(Array.isArray(h)&&Array.isArray(n)){const a=new Set(h),f=new Set(n);return a.size===f.size&&h.every(g=>f.has(g))}return s.bv(h,n)}const bm={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:85,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,performanceMetricsCollection:!0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,antialias:!1,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,minTileCacheSize:null,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",localFontFamily:null,transformRequest:null,accessToken:null,fadeDuration:300,respectPrefersReducedMotion:!0,crossSourceCollisions:!0,collectResourceTiming:!1,testMode:!1,precompilePrograms:!0,scaleFactor:1,spriteFormat:"auto"},$0={showCompass:!0,showZoom:!0,visualizePitch:!1};class mS{constructor(n,a,f=!1){this._clickTolerance=10,this.element=a,this.mouseRotate=new pm({clickTolerance:n.dragRotate._mouseRotate._clickTolerance}),this.map=n,f&&(this.mousePitch=new ou({clickTolerance:n.dragRotate._mousePitch._clickTolerance})),s.aV(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),a.addEventListener("mousedown",this.mousedown),a.addEventListener("touchstart",this.touchstart,{passive:!1}),a.addEventListener("touchmove",this.touchmove),a.addEventListener("touchend",this.touchend),a.addEventListener("touchcancel",this.reset)}down(n,a){this.mouseRotate.mousedown(n,a),this.mousePitch&&this.mousePitch.mousedown(n,a),Me()}move(n,a){const f=this.map,g=this.mouseRotate.mousemoveWindow(n,a),y=g&&g.bearingDelta;if(y&&f.setBearing(f.getBearing()+y),this.mousePitch){const b=this.mousePitch.mousemoveWindow(n,a),E=b&&b.pitchDelta;E&&f.setPitch(f.getPitch()+E)}}off(){const n=this.element;n.removeEventListener("mousedown",this.mousedown),n.removeEventListener("touchstart",this.touchstart),n.removeEventListener("touchmove",this.touchmove),n.removeEventListener("touchend",this.touchend),n.removeEventListener("touchcancel",this.reset),this.offTemp()}offTemp(){Le(),window.removeEventListener("mousemove",this.mousemove),window.removeEventListener("mouseup",this.mouseup)}mousedown(n){this.down(s.h({},n,{ctrlKey:!0,preventDefault:()=>n.preventDefault()}),Ye(this.element,n)),window.addEventListener("mousemove",this.mousemove),window.addEventListener("mouseup",this.mouseup)}mousemove(n){this.move(n,Ye(this.element,n))}mouseup(n){this.mouseRotate.mouseupWindow(n),this.mousePitch&&this.mousePitch.mouseupWindow(n),this.offTemp()}touchstart(n){n.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=vt(this.element,n.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:()=>n.preventDefault()},this._startPos))}touchmove(n){n.targetTouches.length!==1?this.reset():(this._lastPos=vt(this.element,n.targetTouches)[0],this.move({preventDefault:()=>n.preventDefault()},this._lastPos))}touchend(n){n.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()}reset(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()}}function cd(h,n,a){if(h=new s.cd(h.lng,h.lat),n){const f=new s.cd(h.lng-360,h.lat),g=new s.cd(h.lng+360,h.lat),y=360*Math.ceil(Math.abs(h.lng-a.center.lng)/360),b=a.locationPoint3D(h).distSqr(n),E=n.x<0||n.y<0||n.x>a.width||n.y>a.height;a.locationPoint3D(f).distSqr(n)<b&&(E||Math.abs(f.lng-a.center.lng)<y)?h=f:a.locationPoint3D(g).distSqr(n)<b&&(E||Math.abs(g.lng-a.center.lng)<y)&&(h=g)}for(;Math.abs(h.lng-a.center.lng)>180;){const f=a.locationPoint3D(h);if(f.x>=0&&f.y>=0&&f.x<=a.width&&f.y<=a.height)break;h.lng>a.center.lng?h.lng-=360:h.lng+=360}return h}const py={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"},Va={rotation:0,rotationAlignment:"auto",pitchAlignment:"auto",occludedOpacity:.2,altitude:0};class yf extends s.E{constructor(n,a){super(),(n instanceof HTMLElement||a)&&(n=s.h({element:n},a)),s.aV(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress","_clearFadeTimer"],this);const{anchor:f="center",color:g="#3FB1CE",scale:y=1,draggable:b=!1,clickTolerance:E=0,rotation:A=Va.rotation,rotationAlignment:R=Va.rotationAlignment,pitchAlignment:D=Va.pitchAlignment,occludedOpacity:F=Va.occludedOpacity,altitude:N=Va.altitude}=n||{};this._anchor=f,this._color=g,this._scale=y,this._draggable=b,this._clickTolerance=E,this._rotation=A,this._rotationAlignment=R,this._pitchAlignment=D,this._occludedOpacity=F,this._altitude=N,this._state="inactive",this._isDragging=!1,this._updateMoving=()=>this._update(!0),n&&n.element?(this._element=n.element,this._offset=s.P.convert(n&&n.offset||[0,0])):(this._defaultMarker=!0,this._element=this._createDefaultMarker(),this._offset=s.P.convert(n&&n.offset||[0,-14])),this._element.hasAttribute("aria-label")||this._element.setAttribute("aria-label","Map marker"),this._element.hasAttribute("role")||this._element.setAttribute("role","img"),this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",W=>{W.preventDefault()}),this._element.addEventListener("mousedown",W=>{W.preventDefault()});const j=this._element.classList;for(const W in py)j.remove(`mapboxgl-marker-anchor-${W}`);j.add(`mapboxgl-marker-anchor-${this._anchor}`);const X=n&&n.className?n.className.trim().split(/\s+/):[];j.add(...X),this._popup=null}_createDefaultMarker(){const n=H("div"),a=ne("svg",{display:"block",height:41*this._scale+"px",width:27*this._scale+"px",viewBox:"0 0 27 41"},n);if(this._altitude===0){const f=ne("radialGradient",{id:"shadowGradient"},ne("defs",{},a));ne("stop",{offset:"10%","stop-opacity":.4},f),ne("stop",{offset:"100%","stop-opacity":.05},f),ne("ellipse",{cx:13.5,cy:34.8,rx:10.5,ry:5.25,fill:"url(#shadowGradient)"},a)}return ne("path",{fill:this._color,d:"M27,13.5C27,19.07 20.25,27 14.75,34.5C14.02,35.5 12.98,35.5 12.25,34.5C6.75,27 0,19.22 0,13.5C0,6.04 6.04,0 13.5,0C20.96,0 27,6.04 27,13.5Z"},a),ne("path",{opacity:.25,d:"M13.5,0C6.04,0 0,6.04 0,13.5C0,19.22 6.75,27 12.25,34.5C13,35.52 14.02,35.5 14.75,34.5C20.25,27 27,19.07 27,13.5C27,6.04 20.96,0 13.5,0ZM13.5,1C20.42,1 26,6.58 26,13.5C26,15.9 24.5,19.18 22.22,22.74C19.95,26.3 16.71,30.14 13.94,33.91C13.74,34.18 13.61,34.32 13.5,34.44C13.39,34.32 13.26,34.18 13.06,33.91C10.28,30.13 7.41,26.31 5.02,22.77C2.62,19.23 1,15.95 1,13.5C1,6.58 6.58,1 13.5,1Z"},a),ne("circle",{fill:"white",cx:13.5,cy:13.5,r:5.5},a),n}addTo(n){return n===this._map||(this.remove(),this._map=n,n.getCanvasContainer().appendChild(this._element),n.on("move",this._updateMoving),n.on("moveend",this._update),n.on("remove",this._clearFadeTimer),n._addMarker(this),this.setDraggable(this._draggable),this._update(),n.on("click",this._onMapClick)),this}remove(){const n=this._map;return n&&(n.off("click",this._onMapClick),n.off("move",this._updateMoving),n.off("moveend",this._update),n.off("mousedown",this._addDragHandler),n.off("touchstart",this._addDragHandler),n.off("mouseup",this._onUp),n.off("touchend",this._onUp),n.off("mousemove",this._onMove),n.off("touchmove",this._onMove),n.off("remove",this._clearFadeTimer),n._removeMarker(this),this._map=void 0),this._clearFadeTimer(),this._element.remove(),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(n){return this._lngLat=s.cd.convert(n),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(!0),this}setAltitude(n){return n===this._altitude||(this._defaultMarker&&(this._altitude===0&&n!==0||this._altitude!==0&&n===0)&&(this._element=this._createDefaultMarker()),this._altitude=n||Va.altitude,this._update()),this}getAltitude(){return this._altitude}getElement(){return this._element}setPopup(n){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeAttribute("role"),this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),n){if(!("offset"in n.options)){const g=Math.sqrt(Math.pow(13.5,2)/2);n.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[g,-1*(38.1-13.5+g)],"bottom-right":[-g,-1*(38.1-13.5+g)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=n,n._marker=this,n._altitude=this._altitude,this._lngLat&&this._popup.setLngLat(this._lngLat),this._element.setAttribute("role","button"),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress),this._element.setAttribute("aria-expanded","false")}return this}_onKeyPress(n){const a=n.code,f=n.charCode||n.keyCode;a!=="Space"&&a!=="Enter"&&f!==32&&f!==13||this.togglePopup()}_onMapClick(n){const a=n.originalEvent.target,f=this._element;this._popup&&(a===f||f.contains(a))&&this.togglePopup()}getPopup(){return this._popup}togglePopup(){const n=this._popup;return n?(n.isOpen()?(n.remove(),this._element.setAttribute("aria-expanded","false")):this._map&&(n.addTo(this._map),this._element.setAttribute("aria-expanded","true")),this):this}_behindTerrain(){const n=this._map,a=this._pos;if(!n||!a)return!1;const f=n.unproject(a,this._altitude),g=n.getFreeCameraOptions();if(!g.position)return!1;const y=g.position.toLngLat();return y.distanceTo(f)<.9*y.distanceTo(this._lngLat)}_evaluateOpacity(){const n=this._map;if(!n)return;const a=this._pos;if(!a||a.x<0||a.x>n.transform.width||a.y<0||a.y>n.transform.height)return void this._clearFadeTimer();const f=n.unproject(a,this._altitude);let g;n._showingGlobe()&&s.eK(n.transform,this._lngLat)?g=0:(g=1-n._queryFogOpacity(f),n.transform._terrainEnabled()&&n.getTerrain()&&this._behindTerrain()&&(g*=this._occludedOpacity)),this._element.style.opacity=`${g}`,this._element.style.pointerEvents=g>0?"auto":"none",this._popup&&this._popup._setOpacity(g),this._fadeTimer=null}_clearFadeTimer(){this._fadeTimer&&(clearTimeout(this._fadeTimer),this._fadeTimer=null)}_updateDOM(){const n=this._pos;if(!n||!this._map)return;const a=this._offset.mult(this._scale);this._element.style.transform=`
            translate(${n.x}px,${n.y}px)
            ${py[this._anchor]}
            ${this._calculateXYTransform()} ${this._calculateZTransform()}
            translate(${a.x}px,${a.y}px)
        `}_calculateXYTransform(){const n=this._pos,a=this._map,f=this.getPitchAlignment();if(!a||!n||f!=="map")return"";if(!a._showingGlobe()){const A=a.getPitch();return A?`rotateX(${A}deg)`:""}const g=s.cJ(s.eL(a.transform,this._lngLat)),y=n.sub(s.eM(a.transform)),b=Math.abs(y.x)+Math.abs(y.y);if(b===0)return"";const E=g/b;return`rotateX(${-y.y*E}deg) rotateY(${y.x*E}deg)`}_calculateZTransform(){const n=this._pos,a=this._map;if(!a||!n)return"";let f=0;const g=this.getRotationAlignment();if(g==="map")if(a._showingGlobe()){const y=a.project(new s.cd(this._lngLat.lng,this._lngLat.lat+.001),this._altitude),b=a.project(new s.cd(this._lngLat.lng,this._lngLat.lat-.001),this._altitude).sub(y);f=s.cJ(Math.atan2(b.y,b.x))-90}else f=-a.getBearing();else if(g==="horizon"){const y=s.af(4,6,a.getZoom()),b=s.eM(a.transform);b.y+=y*a.transform.height;const E=n.sub(b),A=s.cJ(Math.atan2(E.y,E.x));f=(A>90?A-270:A+90)*(1-y)}return f+=this._rotation,f?`rotateZ(${f}deg)`:""}_update(n){cancelAnimationFrame(this._updateFrameId);const a=this._map;a&&(a.transform.renderWorldCopies&&(this._lngLat=cd(this._lngLat,this._pos,a.transform)),this._pos=a.project(this._lngLat,this._altitude),n===!0?this._updateFrameId=requestAnimationFrame(()=>{this._element&&this._pos&&this._anchor&&(this._pos=this._pos.round(),this._updateDOM())}):this._pos=this._pos.round(),a._requestDomTask(()=>{this._map&&(this._element&&this._pos&&this._anchor&&this._updateDOM(),(a._showingGlobe()||a.getTerrain()||a.getFog())&&!this._fadeTimer&&(this._fadeTimer=window.setTimeout(this._evaluateOpacity.bind(this),60)))}))}getOffset(){return this._offset}setOffset(n){return this._offset=s.P.convert(n),this._update(),this}addClassName(n){return this._element.classList.add(n),this}removeClassName(n){return this._element.classList.remove(n),this}toggleClassName(n){return this._element.classList.toggle(n)}_onMove(n){const a=this._map;if(!a)return;const f=this._pointerdownPos,g=this._positionDelta;if(f&&g){if(!this._isDragging){const y=this._clickTolerance||a._clickTolerance;if(n.point.dist(f)<y)return;this._isDragging=!0}this._pos=n.point.sub(g),this._lngLat=a.unproject(this._pos,this._altitude),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new s.A("dragstart"))),this.fire(new s.A("drag"))}}_onUp(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1;const n=this._map;n&&(n.off("mousemove",this._onMove),n.off("touchmove",this._onMove)),this._state==="active"&&this.fire(new s.A("dragend")),this._state="inactive"}_addDragHandler(n){const a=this._map,f=this._pos;a&&f&&this._element.contains(n.originalEvent.target)&&(n.preventDefault(),this._positionDelta=n.point.sub(f),this._pointerdownPos=n.point,this._state="pending",a.on("mousemove",this._onMove),a.on("touchmove",this._onMove),a.once("mouseup",this._onUp),a.once("touchend",this._onUp))}setDraggable(n){this._draggable=!!n;const a=this._map;return a&&(n?(a.on("mousedown",this._addDragHandler),a.on("touchstart",this._addDragHandler)):(a.off("mousedown",this._addDragHandler),a.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(n){return this._rotation=n||Va.rotation,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(n){return this._rotationAlignment=n||Va.rotationAlignment,this._update(),this}getRotationAlignment(){return this._rotationAlignment==="auto"||this._rotationAlignment==="horizon"&&this._map&&!this._map._showingGlobe()?"viewport":this._rotationAlignment}setPitchAlignment(n){return this._pitchAlignment=n||Va.pitchAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment==="auto"?this.getRotationAlignment():this._pitchAlignment}setOccludedOpacity(n){return this._occludedOpacity=n||Va.occludedOpacity,this._update(),this}getOccludedOpacity(){return this._occludedOpacity}}const my={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0,showUserHeading:!1},vf={maxWidth:100,unit:"metric"},ud={kilometer:"km",meter:"m",mile:"mi",foot:"ft","nautical-mile":"nm"},_l={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px",altitude:0},va=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function na(h=new s.P(0,0),n="bottom"){if(typeof h=="number"){const a=Math.round(Math.sqrt(.5*Math.pow(h,2)));switch(n){case"top":return new s.P(0,h);case"top-left":return new s.P(a,a);case"top-right":return new s.P(-a,a);case"bottom":return new s.P(0,-h);case"bottom-left":return new s.P(a,-a);case"bottom-right":return new s.P(-a,-a);case"left":return new s.P(h,0);case"right":return new s.P(-h,0)}return new s.P(0,0)}return h instanceof s.P||Array.isArray(h)?s.P.convert(h):s.P.convert(h[n]||[0,0])}return{version:k,supported:ae.supported,setRTLTextPlugin:s.eQ,getRTLTextPluginStatus:s.eP,Map:class extends mf{constructor(h){V.mark(z.create);const n=h;if((h=s.h({},bm,h)).minZoom!=null&&h.maxZoom!=null&&h.minZoom>h.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(h.minPitch!=null&&h.maxPitch!=null&&h.minPitch>h.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(h.minPitch!=null&&h.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(h.maxPitch!=null&&h.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(h.antialias&&s.eI(window)&&(h.antialias=!1,s.w("Antialiasing is disabled for this WebGL context to avoid browser bug: https://github.com/mapbox/mapbox-gl-js/issues/11609")),super(new b_(h.minZoom,h.maxZoom,h.minPitch,h.maxPitch,h.renderWorldCopies,null,null),h),this._repaint=!!h.repaint,this._interactive=h.interactive,this._minTileCacheSize=h.minTileCacheSize,this._maxTileCacheSize=h.maxTileCacheSize,this._failIfMajorPerformanceCaveat=h.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=h.preserveDrawingBuffer,this._antialias=h.antialias,this._trackResize=h.trackResize,this._bearingSnap=h.bearingSnap,this._refreshExpiredTiles=h.refreshExpiredTiles,this._fadeDuration=h.fadeDuration,this._isInitialLoad=!0,this._crossSourceCollisions=h.crossSourceCollisions,this._collectResourceTiming=h.collectResourceTiming,this._language=this._parseLanguage(h.language),this._worldview=h.worldview,this._renderTaskQueue=new gf,this._domRenderTaskQueue=new gf,this._controls=[],this._markers=[],this._popups=[],this._mapId=s.a$(),this._locale=s.h({},xm,h.locale),this._clickTolerance=h.clickTolerance,this._cooperativeGestures=h.cooperativeGestures,this._performanceMetricsCollection=h.performanceMetricsCollection,this._tessellationStep=h.tessellationStep,this._containerWidth=0,this._containerHeight=0,this._showParseStatus=!0,this._precompilePrograms=h.precompilePrograms,this._scaleFactorChanged=!1,this._averageElevationLastSampledAt=-1/0,this._averageElevationExaggeration=0,this._averageElevation=new gl(0),this._interactionRange=[1/0,-1/0],this._visibilityHidden=0,this._useExplicitProjection=!1,this._frameId=0,this._scaleFactor=h.scaleFactor,this._requestManager=new Ve(h.transformRequest,h.accessToken,h.testMode),this._silenceAuthErrors=!!h.testMode,this._contextCreateOptions=h.contextCreateOptions?Object.assign({},h.contextCreateOptions):{},typeof h.container=="string"){const a=document.getElementById(h.container);if(!a)throw new Error(`Container '${h.container.toString()}' not found.`);this._container=a}else{if(!(h.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=h.container}if(this._container.childNodes.length>0&&s.w("The map container element should be empty, otherwise the map's interactivity will be negatively impacted. If you want to display a message when WebGL is not supported, use the Mapbox GL Supported plugin instead."),h.maxBounds&&this.setMaxBounds(h.maxBounds),this._spriteFormat=h.spriteFormat,s.aV(["_onWindowOnline","_onWindowResize","_onVisibilityChange","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._tp||(this._tp=new Q_),this._tp.registerParameter(this,["Debug"],"showOverdrawInspector"),this._tp.registerParameter(this,["Debug"],"showTileBoundaries"),this._tp.registerParameter(this,["Debug"],"showParseStatus"),this._tp.registerParameter(this,["Debug"],"repaint"),this._tp.registerParameter(this,["Debug"],"showTileAABBs"),this._tp.registerParameter(this,["Debug"],"showPadding"),this._tp.registerParameter(this,["Debug"],"showCollisionBoxes",{noSave:!0}),this._tp.registerParameter(this.transform,["Debug"],"freezeTileCoverage",{noSave:!0},()=>{this._update()}),this._tp.registerParameter(this,["Debug","Wireframe"],"showTerrainWireframe"),this._tp.registerParameter(this,["Debug","Wireframe"],"showLayers2DWireframe"),this._tp.registerParameter(this,["Debug","Wireframe"],"showLayers3DWireframe"),this._tp.registerParameter(this,["Scaling"],"_scaleFactor",{min:.1,max:10,step:.1},()=>{this.setScaleFactor(this._scaleFactor)}),this._setupPainter(),this.painter===void 0)throw new Error("Failed to initialize WebGL.");if(this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),this._fullscreenchangeEvent="onfullscreenchange"in document?"fullscreenchange":"webkitfullscreenchange",window.addEventListener("online",this._onWindowOnline,!1),window.addEventListener("resize",this._onWindowResize,!1),window.addEventListener("orientationchange",this._onWindowResize,!1),window.addEventListener(this._fullscreenchangeEvent,this._onWindowResize,!1),window.addEventListener("visibilitychange",this._onVisibilityChange,!1),this.handlers=new hy(this,h),this._localFontFamily=h.localFontFamily,this._localIdeographFontFamily=h.localIdeographFontFamily,(h.style||!h.testMode)&&this.setStyle(h.style||s.e.DEFAULT_STYLE,{config:h.config,localFontFamily:this._localFontFamily,localIdeographFontFamily:this._localIdeographFontFamily}),h.projection&&this.setProjection(h.projection),this.indoor=new O2(this),h.hash&&(this._hash=new ny(typeof h.hash=="string"&&h.hash||void 0).addTo(this)),!this._hash||!this._hash._onHashChange()){n.center==null&&n.zoom==null||(this.transform._unmodified=!1),this.jumpTo({center:h.center,zoom:h.zoom,bearing:h.bearing,pitch:h.pitch});const a=h.bounds;a&&(this.resize(),this.fitBounds(a,s.h({},h.fitBoundsOptions,{duration:0})))}this.resize(),h.attributionControl&&this.addControl(new fy({customAttribution:h.customAttribution})),this._logoControl=new vm,this.addControl(this._logoControl,h.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet),this._postStyleLoadEvent()}),this.on("data",a=>{this._update(a.dataType==="style"),this.fire(new s.A(`${a.dataType}data`,a))}),this.on("dataloading",a=>{this.fire(new s.A(`${a.dataType}dataloading`,a))}),this._interactions=new Ba(this)}_getMapId(){return this._mapId}addControl(h,n){if(n===void 0&&(n=h.getDefaultPosition?h.getDefaultPosition():"top-right"),!h||!h.onAdd)return this.fire(new s.z(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const a=h.onAdd(this);this._controls.push(h);const f=this._controlPositions[n];return n.indexOf("bottom")!==-1?f.insertBefore(a,f.firstChild):f.appendChild(a),this}removeControl(h){if(!h||!h.onRemove)return this.fire(new s.z(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const n=this._controls.indexOf(h);return n>-1&&this._controls.splice(n,1),h.onRemove(this),this}hasControl(h){return this._controls.indexOf(h)>-1}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}resize(h){if(this._updateContainerDimensions(),this._containerWidth===this.transform.width&&this._containerHeight===this.transform.height)return this;this._resizeCanvas(this._containerWidth,this._containerHeight),this.transform.resize(this._containerWidth,this._containerHeight),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight));const n=!this._moving;return n&&this.fire(new s.A("movestart",h)).fire(new s.A("move",h)),this.fire(new s.A("resize",h)),n&&this.fire(new s.A("moveend",h)),this}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()||null}setMaxBounds(h){return this.transform.setMaxBounds(s.aG.convert(h)),this._update()}setMinZoom(h){if((h=h??-2)>=-2&&h<=this.transform.maxZoom)return this.transform.minZoom=h,this._update(),this.getZoom()<h?this.setZoom(h):this.fire(new s.A("zoomstart")).fire(new s.A("zoom")).fire(new s.A("zoomend")),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(h){if((h=h??22)>=this.transform.minZoom)return this.transform.maxZoom=h,this._update(),this.getZoom()>h?this.setZoom(h):this.fire(new s.A("zoomstart")).fire(new s.A("zoom")).fire(new s.A("zoomend")),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(h){if((h=h??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(h>=0&&h<=this.transform.maxPitch)return this.transform.minPitch=h,this._update(),this.getPitch()<h?this.setPitch(h):this.fire(new s.A("pitchstart")).fire(new s.A("pitch")).fire(new s.A("pitchend")),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(h){if((h=h??85)>85)throw new Error("maxPitch must be less than or equal to 85");if(h>=this.transform.minPitch)return this.transform.maxPitch=h,this._update(),this.getPitch()>h?this.setPitch(h):this.fire(new s.A("pitchstart")).fire(new s.A("pitch")).fire(new s.A("pitchend")),this;throw new Error("maxPitch must be greater than or equal to minPitch")}getMaxPitch(){return this.transform.maxPitch}getScaleFactor(){return this._scaleFactor}setScaleFactor(h){return this._scaleFactor=h,this.painter.scaleFactor=h,this._tp.refreshUI(),this._scaleFactorChanged=!0,this.style._updateFilteredLayers(n=>n.type==="symbol"),this._update(!0),this}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(h){return this.transform.renderWorldCopies=h,this.transform.renderWorldCopies||this._forceMarkerAndPopupUpdate(!0),this._update()}getLanguage(){return this._language}_parseLanguage(h){return h==="auto"?navigator.language:Array.isArray(h)?h.length===0?void 0:h.map(n=>n==="auto"?navigator.language:n):h}setLanguage(h){const n=this._parseLanguage(h);if(!this.style||n===this._language)return this;this._language=n,this.style.reloadSources();for(const a of this._controls)a._setLanguage&&a._setLanguage(this._language);return this}getWorldview(){return this._worldview}setWorldview(h){return this.style&&h!==this._worldview?(this._worldview=h,this._styleDirty=!0,this.style.reloadSources(),this):this}getProjection(){return this.transform.mercatorFromTransition?{name:"globe",center:[0,0]}:this.transform.getProjection()}_showingGlobe(){return this.transform.projection.name==="globe"}setProjection(h){return this._lazyInitEmptyStyle(),h?typeof h=="string"&&(h={name:h}):h=null,this._useExplicitProjection=!!h,this._prioritizeAndUpdateProjection(h,this.style.projection)}_updateProjectionTransition(){if(this.getProjection().name!=="globe")return;const h=this.transform,n=h.projection.name;let a;n==="globe"&&h.zoom>=s.cx?(h.setMercatorFromTransition(),a=!0):n==="mercator"&&h.zoom<s.cx&&(h.setProjection({name:"globe"}),a=!0),a&&(this.style.applyProjectionUpdate(),this.style._forceSymbolLayerUpdate(),this._update(!0))}_prioritizeAndUpdateProjection(h,n){return this._updateProjection(h||n||{name:"mercator"})}_updateProjection(h){let n;return n=h.name==="globe"&&this.transform.zoom>=s.cx?this.transform.setMercatorFromTransition():this.transform.setProjection(h),this.style.applyProjectionUpdate(),n&&(this.painter.clearBackgroundTiles(),this.style.clearSources(),this._update(!0),this._forceMarkerAndPopupUpdate(!0)),this}project(h,n){return this.transform.locationPoint3D(s.cd.convert(h),n)}unproject(h,n){return this.transform.pointLocation3D(s.P.convert(h),n)}isMoving(){return this._moving||this.handlers&&this.handlers.isMoving()||!1}isZooming(){return this._zooming||this.handlers&&this.handlers.isZooming()||!1}isRotating(){return this._rotating||this.handlers&&this.handlers.isRotating()||!1}_isDragging(){return this.handlers&&this.handlers._isDragging()||!1}_createDelegatedListener(h,n,a){const f=g=>{let y=[];if(Array.isArray(n)){const b=n.filter(E=>this.getLayer(E));y=b.length?this.queryRenderedFeatures(g,{layers:b}):[]}else y=this.queryRenderedFeatures(g,{target:n});return y};if(h==="mouseenter"||h==="mouseover"){let g=!1;return{listener:a,targets:n,delegates:{mousemove:b=>{const E=f(b.point);E.length?g||(g=!0,a.call(this,new xs(h,this,b.originalEvent,{features:E}))):g=!1},mouseout:()=>{g=!1}}}}if(h==="mouseleave"||h==="mouseout"){let g=!1;return{listener:a,targets:n,delegates:{mousemove:E=>{f(E.point).length?g=!0:g&&(g=!1,a.call(this,new xs(h,this,E.originalEvent)))},mouseout:E=>{g&&(g=!1,a.call(this,new xs(h,this,E.originalEvent)))}}}}{const g=y=>{const b=f(y.point);b.length&&(y.features=b,a.call(this,y),delete y.features)};return{listener:a,targets:n,delegates:{[h]:g}}}}on(h,n,a){if(typeof n=="function"||a===void 0)return super.on(h,n);if(typeof n=="string"&&(n=[n]),!this._areTargetsValid(n))return this;const f=this._createDelegatedListener(h,n,a);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[h]=this._delegatedListeners[h]||[],this._delegatedListeners[h].push(f);for(const g in f.delegates)this.on(g,f.delegates[g]);return this}once(h,n,a){if(typeof n=="function"||a===void 0)return super.once(h,n);if(typeof n=="string"&&(n=[n]),!this._areTargetsValid(n))return this;const f=this._createDelegatedListener(h,n,a);for(const g in f.delegates)this.once(g,f.delegates[g]);return this}off(h,n,a){if(typeof n=="function"||a===void 0)return super.off(h,n);if(typeof n=="string"&&(n=[n]),!this._areTargetsValid(n))return this;const f=this._delegatedListeners?this._delegatedListeners[h]:void 0;return f&&(g=>{for(let y=0;y<g.length;y++){const b=g[y];if(b.listener===a&&_f(b.targets,n)){for(const E in b.delegates)this.off(E,b.delegates[E]);return g.splice(y,1),this}}})(f),this}queryRenderedFeatures(h,n){if(!this.style)return[];if(h===void 0||h instanceof s.P||Array.isArray(h)||n!==void 0||(n=h,h=void 0),h=h||[[0,0],[this.transform.width,this.transform.height]],!n){const y=this.style.queryRenderedFeatures(h,void 0,this.transform),b=this.style.queryRenderedFeatureset(h,void 0,this.transform);return y.concat(b)}let a=!0;if(n.target&&(a=this._isTargetValid(n.target),a&&!n.layers))return this.style.queryRenderedFeatureset(h,n,this.transform);let f=!0;if(n.layers&&Array.isArray(n.layers)){for(const y of n.layers)if(!this._isValidId(y)){f=!1;break}if(f&&!n.target)return this.style.queryRenderedFeatures(h,n,this.transform)}let g=[];return f&&(g=g.concat(this.style.queryRenderedFeatures(h,n,this.transform))),a&&(g=g.concat(this.style.queryRenderedFeatureset(h,n,this.transform))),g}querySourceFeatures(h,n){return!h||typeof h=="string"&&!this._isValidId(h)?[]:this.style.querySourceFeatures(h,n)}isPointOnSurface(h){const{name:n}=this.transform.projection;return n!=="globe"&&n!=="mercator"&&s.w(`${n} projection does not support isPointOnSurface, this API may behave unexpectedly.`),this.transform.isPointOnSurface(s.P.convert(h))}addInteraction(h,n){return this._interactions.add(h,n),this}removeInteraction(h){return this._interactions.remove(h),this}getCooperativeGestures(){return this._cooperativeGestures}setCooperativeGestures(h){return this._cooperativeGestures=h,this}setStyle(h,n){return n=s.h({},{localIdeographFontFamily:this._localIdeographFontFamily,localFontFamily:this._localFontFamily},n),this.style&&h&&n.diff!==!1&&n.localFontFamily===this._localFontFamily&&n.localIdeographFontFamily===this._localIdeographFontFamily&&!n.config?(this.style._diffStyle(h,(a,f)=>{if(a){const g=typeof a=="string"?a:a instanceof Error?a.message:a.error;s.w(`Unable to perform style diff: ${g}. Rebuilding the style from scratch.`),this._updateStyle(h,n)}else f&&this._update(!0)},()=>this._postStyleLoadEvent()),this):(this._localIdeographFontFamily=n.localIdeographFontFamily,this._localFontFamily=n.localFontFamily,this._updateStyle(h,n))}_getUIString(h){const n=this._locale[h];if(n==null)throw new Error(`Missing UI string '${h}'`);return n}_updateStyle(h,n){if(this.style&&(this.style.setEventedParent(null),this.style._remove(),this.style=void 0),h){const a=s.h({},n);n&&n.config&&(a.initialConfig=n.config,delete a.config),this.style=new js(this,a).load(h),this.style.setEventedParent(this,{style:this.style})}return this._updateTerrain(),this}_lazyInitEmptyStyle(){this.style||(this.style=new js(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():(s.w("There is no style added to the map."),!1)}_isValidId(h){return h==null?(this.fire(new s.z(new Error("IDs can't be empty."))),!1):!s.d8(h)||(this.fire(new s.z(new Error(`IDs can't contain special symbols: "${h}".`))),!1)}_isTargetValid(h){return"featuresetId"in h?this._isValidId("importId"in h?h.importId:h.featuresetId):"layerId"in h&&this._isValidId(h.layerId)}_areTargetsValid(h){if(Array.isArray(h)){for(const n of h)if(!this._isValidId(n))return!1;return!0}return this._isTargetValid(h)}addSource(h,n){return this._isValidId(h)?(this._lazyInitEmptyStyle(),this.style.addSource(h,n),this._update(!0)):this}isSourceLoaded(h){return!!this._isValidId(h)&&!!this.style&&this.style._isSourceCacheLoaded(h)}areTilesLoaded(){return this.style.areTilesLoaded()}addSourceType(h,n,a){this._lazyInitEmptyStyle(),this.style.addSourceType(h,n,a)}removeSource(h){return this._isValidId(h)?(this.style.removeSource(h),this._updateTerrain(),this._update(!0)):this}getSource(h){return this._isValidId(h)?this.style.getOwnSource(h):null}addImage(h,n,{pixelRatio:a=1,sdf:f=!1,stretchX:g,stretchY:y,content:b}={}){this._lazyInitEmptyStyle();const E=s.I.from(h);if(n instanceof HTMLImageElement||ImageBitmap&&n instanceof ImageBitmap){const{width:A,height:R,data:D}=s.q.getImageData(n);this.style.addImage(E,{data:new s.r({width:A,height:R},D),pixelRatio:a,stretchX:g,stretchY:y,content:b,sdf:f,version:0,usvg:!1})}else if(n.width===void 0||n.height===void 0)this.fire(new s.z(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));else{const{width:A,height:R}=n,D=n;this.style.addImage(E,{data:new s.r({width:A,height:R},new Uint8Array(D.data)),pixelRatio:a,stretchX:g,stretchY:y,content:b,sdf:f,usvg:!1,version:0,userImage:D}),D.onAdd&&D.onAdd(this,h)}}updateImage(h,n){this._lazyInitEmptyStyle();const a=s.I.from(h),f=this.style.getImage(a);if(!f)return void this.fire(new s.z(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const g=n instanceof HTMLImageElement||ImageBitmap&&n instanceof ImageBitmap?s.q.getImageData(n):n,{width:y,height:b,data:E}=g;if(y===void 0||b===void 0)return void this.fire(new s.z(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(y!==(f.usvg?f.icon.usvg_tree.width:f.data.width)||b!==(f.usvg?f.icon.usvg_tree.height:f.data.height))return void this.fire(new s.z(new Error(`The width and height of the updated image (${y}, ${b})
                must be that same as the previous version of the image
                (${f.data.width}, ${f.data.height})`)));const A=!(n instanceof HTMLImageElement||ImageBitmap&&n instanceof ImageBitmap);let R=!1;f.usvg?(f.data=new s.r({width:y,height:b},new Uint8Array(E)),f.usvg=!1,f.icon=void 0,R=!0):f.data.replace(E,A),this.style.updateImage(a,f,R)}hasImage(h){return h?!!this.style&&!!this.style.getImage(s.I.from(h)):(this.fire(new s.z(new Error("Missing required image id"))),!1)}removeImage(h){this.style.removeImage(s.I.from(h))}loadImage(h,n){s.o(this._requestManager.transformRequest(h,s.R.Image),(a,f)=>{n(a,f instanceof HTMLImageElement?s.q.getImageData(f):f)})}listImages(){return this.style.listImages().map(h=>h.name)}addModel(h,n){this._lazyInitEmptyStyle(),this.style.addModel(h,n)}hasModel(h){return h?this.style.hasModel(h):(this.fire(new s.z(new Error("Missing required model id"))),!1)}removeModel(h){this.style.removeModel(h)}listModels(){return this.style.listModels()}addLayer(h,n){return this._isValidId(h.id)?(this._lazyInitEmptyStyle(),this.style.addLayer(h,n),this._update(!0)):this}getSlot(h){const n=this.getLayer(h);return n&&n.slot||null}setSlot(h,n){return this.style.setSlot(h,n),this.style.mergeLayers(),this._update(!0)}addImport(h,n){return this.style.addImport(h,n).catch(a=>this.fire(new s.z(new Error("Failed to add import",a)))),this}updateImport(h,n){return typeof n!="string"&&n.id!==h?(this.removeImport(h),this.addImport(n)):(this.style.updateImport(h,n),this._update(!0))}removeImport(h){return this.style.removeImport(h),this}moveImport(h,n){return this.style.moveImport(h,n),this._update(!0)}moveLayer(h,n){return this._isValidId(h)?(this.style.moveLayer(h,n),this._update(!0)):this}removeLayer(h){return this._isValidId(h)?(this.style.removeLayer(h),this._update(!0)):this}getLayer(h){if(!this._isValidId(h))return null;const n=this.style.getOwnLayer(h);return n?n.type==="custom"?n.implementation:n.serialize():void 0}getSlots(){return this.style.getSlots()}setLayerZoomRange(h,n,a){return this._isValidId(h)?(this.style.setLayerZoomRange(h,n,a),this._update(!0)):this}setFilter(h,n,a={}){return this._isValidId(h)?(this.style.setFilter(h,n,a),this._update(!0)):this}getFilter(h){return this._isValidId(h)?this.style.getFilter(h):null}setPaintProperty(h,n,a,f={}){return this._isValidId(h)?(this.style.setPaintProperty(h,n,a,f),this._update(!0)):this}getPaintProperty(h,n){return this._isValidId(h)?this.style.getPaintProperty(h,n):null}setLayoutProperty(h,n,a,f={}){return this._isValidId(h)?(this.style.setLayoutProperty(h,n,a,f),this._update(!0)):this}getLayoutProperty(h,n){return this._isValidId(h)?this.style.getLayoutProperty(h,n):null}getGlyphsUrl(){return this.style.getGlyphsUrl()}setGlyphsUrl(h){return this.style.setGlyphsUrl(h),this._update(!0)}getSchema(h){return this.style.getSchema(h)}setSchema(h,n){return this.style.setSchema(h,n),this._update(!0)}getConfig(h){return this.style.getConfig(h)}setConfig(h,n){return this.style.setConfig(h,n),this._update(!0)}getConfigProperty(h,n){return this.style.getConfigProperty(h,n)}setConfigProperty(h,n,a){return this.style.setConfigProperty(h,n,a),this._update(!0)}getFeaturesetDescriptors(h){return this.style.getFeaturesetDescriptors(h)}setLights(h){if(this._lazyInitEmptyStyle(),h&&h.length===1&&h[0].type==="flat"){const n=h[0];n.properties?this.style.setFlatLight(n.properties,n.id,{}):this.style.setFlatLight({},"flat")}else this.style.setLights(h),this.painter.terrain&&(this.painter.terrain.invalidateRenderCache=!0);return this._update(!0)}getLights(){const h=this.style.getLights()||[];return h.length===0&&h.push({id:this.style.light.id,type:"flat",properties:this.style.getFlatLight()}),h}setLight(h,n={}){return console.log("The `map.setLight` function is deprecated, prefer using `map.setLights` with `flat` light type instead."),this.setLights([{id:"flat",type:"flat",properties:h}])}getLight(){return console.log("The `map.getLight` function is deprecated, prefer using `map.getLights` instead."),this.style.getFlatLight()}setTerrain(h){return this._lazyInitEmptyStyle(),!h&&this.transform.projection.requiresDraping?this.style.setTerrainForDraping():this.style.setTerrain(h),this._averageElevationLastSampledAt=-1/0,this._update(!0)}getTerrain(){return this.style?this.style.getTerrain():null}setFog(h){return this._lazyInitEmptyStyle(),this.style.setFog(h),this._update(!0)}getFog(){return this.style?this.style.getFog():null}setSnow(h){return this._lazyInitEmptyStyle(),this.style.setSnow(h),this._update(!0)}getSnow(){return this.style?this.style.getSnow():null}setRain(h){return this._lazyInitEmptyStyle(),this.style.setRain(h),this._update(!0)}getRain(){return this.style?this.style.getRain():null}setColorTheme(h){return this._lazyInitEmptyStyle(),this.style.setColorTheme(h),this._update(!0)}setImportColorTheme(h,n){return this._lazyInitEmptyStyle(),this.style.setImportColorTheme(h,n),this._update(!0)}setCamera(h){return this.style.setCamera(h),this._triggerCameraUpdate(h)}_triggerCameraUpdate(h){return this._update(this.transform.setOrthographicProjectionAtLowPitch(h["camera-projection"]==="orthographic"))}getCamera(){return this.style.camera}_queryFogOpacity(h){return this.style&&this.style.fog?this.style.fog.getOpacityAtLatLng(s.cd.convert(h),this.transform):0}setFeatureState(h,n){return h.source&&!this._isValidId(h.source)?this:(this.style.setFeatureState(h,n),this._update())}removeFeatureState(h,n){return h.source&&!this._isValidId(h.source)?this:(this.style.removeFeatureState(h,n),this._update())}getFeatureState(h){return h.source&&!this._isValidId(h.source)?null:this.style.getFeatureState(h)}_updateContainerDimensions(){if(!this._container)return;const h=this._container.getBoundingClientRect().width||400,n=this._container.getBoundingClientRect().height||300;let a,f,g,y=this._container;for(;y&&(!f||!g);){const b=window.getComputedStyle(y).transform;b&&b!=="none"&&(a=b.match(/matrix.*\((.+)\)/)[1].split(", "),a[0]&&a[0]!=="0"&&a[0]!=="1"&&(f=a[0]),a[3]&&a[3]!=="0"&&a[3]!=="1"&&(g=a[3])),y=y.parentElement}this._containerWidth=f?Math.abs(h/f):h,this._containerHeight=g?Math.abs(n/g):n}_detectMissingCSS(){window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")!=="rgb(250, 128, 114)"&&s.w("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")}_setupContainer(){const h=this._container;h.classList.add("mapboxgl-map"),(this._missingCSSCanary=H("div","mapboxgl-canary",h)).style.visibility="hidden",this._detectMissingCSS();const n=this._canvasContainer=H("div","mapboxgl-canvas-container",h);this._canvas=H("canvas","mapboxgl-canvas",n),this._interactive&&(n.classList.add("mapboxgl-interactive"),this._canvas.setAttribute("tabindex","0")),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region"),this._updateContainerDimensions(),this._resizeCanvas(this._containerWidth,this._containerHeight);const a=this._controlContainer=H("div","mapboxgl-control-container",h),f=this._controlPositions={};["top-left","top","top-right","right","bottom-right","bottom","bottom-left","left"].forEach(g=>{f[g]=H("div",`mapboxgl-ctrl-${g}`,a)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(h,n){const a=s.q.devicePixelRatio||1;this._canvas.width=a*Math.ceil(h),this._canvas.height=a*Math.ceil(n),this._canvas.style.width=`${h}px`,this._canvas.style.height=`${n}px`}_addMarker(h){this._markers.push(h)}_removeMarker(h){const n=this._markers.indexOf(h);n!==-1&&this._markers.splice(n,1)}_addPopup(h){this._popups.push(h)}_removePopup(h){const n=this._popups.indexOf(h);n!==-1&&this._popups.splice(n,1)}_setupPainter(){const h=s.h({},ae.supported.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),n=this._canvas.getContext("webgl2",h);n?(xr(n,!0),this.painter=new rd(n,this._contextCreateOptions,this.transform,this._scaleFactor,this._tp,this._worldview),this.on("data",a=>{a.dataType==="source"&&this.painter.setTileLoadedFlag(!0)}),s.l.testSupport(n)):this.fire(new s.z(new Error("Failed to initialize WebGL")))}_contextLost(h){h.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new s.A("webglcontextlost",{originalEvent:h}))}_contextRestored(h){this._setupPainter(),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight)),this._updateTerrain(),this.style&&(this.style.reloadModels(),this.style.clearSources()),this._update(),this.fire(new s.A("webglcontextrestored",{originalEvent:h}))}_onMapScroll(h){if(h.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1}idle(){return!this.isMoving()&&this.loaded()}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}frameReady(){return this.loaded()&&!this._placementDirty}_update(h){return this.style?(this._styleDirty=this._styleDirty||h,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(h){return this._update(),this._renderTaskQueue.add(h)}_cancelRenderFrame(h){this._renderTaskQueue.remove(h)}_requestDomTask(h){!this.loaded()||this.loaded()&&!this.isMoving()?h():this._domRenderTaskQueue.add(h)}_render(h){let n;this.fire(new s.A("renderstart")),++this._frameId;const a=this.painter.context.extTimerQuery,f=s.q.now(),g=this.painter.context.gl;if(this.listens("gpu-timing-frame")&&(n=g.createQuery(),g.beginQuery(a.TIME_ELAPSED_EXT,n)),this.painter.context.setDirty(),this.painter.setBaseState(),(this.isMoving()||this.isRotating()||this.isZooming())&&(this._interactionRange[0]=Math.min(this._interactionRange[0],performance.now()),this._interactionRange[1]=Math.max(this._interactionRange[1],performance.now())),this._renderTaskQueue.run(h),this._domRenderTaskQueue.run(h),this._removed)return;this._updateProjectionTransition();const y=this._isInitialLoad?0:this._fadeDuration;if(this.style&&this._styleDirty){this._styleDirty=!1;const R=this.transform.zoom,D=this.transform.pitch,F=s.q.now(),N=new s.aa(R,{now:F,fadeDuration:y,pitch:D,transition:this.style.transition,worldview:this._worldview});this.style.update(N)}this.style&&this.style.hasFogTransition()&&(this.style._markersNeedUpdate=!0,this._sourcesDirty=!0);let b=!1;this.style&&this._sourcesDirty?(this._sourcesDirty=!1,this.painter._updateFog(this.style),this._updateTerrain(),b=this._updateAverageElevation(f),this.style.updateSources(this.transform),this.style.updateImageProviders(),this.isMoving()||this._forceMarkerAndPopupUpdate()):b=this._updateAverageElevation(f);const E=this.style&&this.style._updatePlacement(this.painter,this.painter.transform,this.showCollisionBoxes,y,this._crossSourceCollisions,this.painter.replacementSource,this._scaleFactorChanged);if(this._scaleFactorChanged&&(this._scaleFactorChanged=!1),E&&(this._placementDirty=E.needsRerender),this.style&&this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showParseStatus:this.showParseStatus,wireframe:{terrain:this.showTerrainWireframe,layers2D:this.showLayers2DWireframe,layers3D:this.showLayers3DWireframe},showOverdrawInspector:this._showOverdrawInspector,showQueryGeometry:!!this._showQueryGeometry,showTileAABBs:this.showTileAABBs,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:y,isInitialLoad:this._isInitialLoad,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer"),gpuTimingDeferredRender:!!this.listens("gpu-timing-deferred-render"),speedIndexTiming:this.speedIndexTiming}),this.fire(new s.A("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,V.mark(z.load),this.fire(new s.A("load"))),this.style&&this.style.hasTransitions()&&(this._styleDirty=!0),this.style&&(this.style.snow||this.style.rain)&&(this._styleDirty=!0),this.style&&this.style.imageManager.hasPatternsInFlight()&&(this._styleDirty=!0),this.style&&!this.style.modelManager.isLoaded()&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),n){const R=s.q.now()-f;g.endQuery(a.TIME_ELAPSED_EXT),setTimeout(()=>{const D=g.getQueryParameter(n,g.QUERY_RESULT)/1e6;g.deleteQuery(n),this.fire(new s.A("gpu-timing-frame",{cpuTime:R,gpuTime:D}))},50)}if(this.listens("gpu-timing-layer")){const R=this.painter.collectGpuTimers();setTimeout(()=>{const D=this.painter.queryGpuTimers(R);this.fire(new s.A("gpu-timing-layer",{layerTimes:D}))},50)}if(this.listens("gpu-timing-deferred-render")){const R=this.painter.collectDeferredRenderGpuQueries();setTimeout(()=>{const D=this.painter.queryGpuTimeDeferredRender(R);this.fire(new s.A("gpu-timing-deferred-render",{gpuTime:D}))},50)}const A=this._sourcesDirty||this._styleDirty||this._placementDirty||b;if(A||this._repaint)this.triggerRepaint();else{const R=this.idle();if(R&&(b=this._updateAverageElevation(f,!0)),b)this.triggerRepaint();else if(this._triggerFrame(!1),R&&(this.fire(new s.A("idle")),this._isInitialLoad=!1,this.speedIndexTiming)){const D=this._calculateSpeedIndex();this.fire(new s.A("speedindexcompleted",{speedIndex:D})),this.speedIndexTiming=!1}}!this._loaded||this._fullyLoaded||A||(this._fullyLoaded=!0,V.mark(z.fullLoad),this._performanceMetricsCollection&&or(this._requestManager._customAccessToken,{width:this.painter.width,height:this.painter.height,interactionRange:this._interactionRange,visibilityHidden:this._visibilityHidden,terrainEnabled:!!this.painter.style.getTerrain(),fogEnabled:!!this.painter.style.getFog(),projection:this.getProjection().name,zoom:this.transform.zoom,renderer:this.painter.context.renderer,vendor:this.painter.context.vendor}),this._authenticate())}_forceMarkerAndPopupUpdate(h){for(const n of this._markers)h&&!this.getRenderWorldCopies()&&(n._lngLat=n._lngLat.wrap()),n._update();for(const n of this._popups)!h||this.getRenderWorldCopies()||n._trackPointer||(n._lngLat=n._lngLat.wrap()),n._update()}_updateAverageElevation(h,n=!1){const a=g=>(this.transform.averageElevation=g,this._update(!1),!0);if(!this.painter.averageElevationNeedsEasing())return this.transform.averageElevation!==0&&a(0);const f=this.transform.elevation&&this.transform.elevation.exaggeration()!==this._averageElevationExaggeration;if(f||(n||h-this._averageElevationLastSampledAt>500)&&!this._averageElevation.isEasing(h)){const g=this.transform.averageElevation;let y=this.transform.sampleAverageElevation();this.transform.elevation!=null&&(this._averageElevationExaggeration=this.transform.elevation.exaggeration()),isNaN(y)?y=0:this._averageElevationLastSampledAt=h;const b=Math.abs(g-y);if(b>1){if(this._isInitialLoad||f)return this._averageElevation.jumpTo(y),a(y);this._averageElevation.easeTo(y,h,300)}else if(b>1e-4)return this._averageElevation.jumpTo(y),a(y)}return!!this._averageElevation.isEasing(h)&&a(this._averageElevation.getValue(h))}_authenticate(){Mr(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,h=>{if(h&&(h.message===$t||h.status===401)){const n=this.painter.context.gl;xr(n,!1),this._logoControl instanceof vm&&this._logoControl._updateLogo(),n&&n.clear(n.DEPTH_BUFFER_BIT|n.COLOR_BUFFER_BIT|n.STENCIL_BUFFER_BIT),this._silenceAuthErrors||this.fire(new s.z(new Error("A valid Mapbox access token is required to use Mapbox GL JS. To create an account or a new access token, visit https://account.mapbox.com/")))}}),$n(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,()=>{})}_postStyleLoadEvent(){this.style.globalId&&rn(this._requestManager._customAccessToken,{map:this,style:this.style.globalId,importedStyles:this.style.getImportGlobalIds()})}_updateTerrain(){const h=this._isDragging();this.painter.updateTerrain(this.style,h)}_calculateSpeedIndex(){const h=this.painter.canvasCopy(),n=this.painter.getCanvasCopiesAndTimestamps();n.timeStamps.push(performance.now());const a=this.painter.context.gl,f=a.createFramebuffer();function g(y){a.framebufferTexture2D(a.FRAMEBUFFER,a.COLOR_ATTACHMENT0,a.TEXTURE_2D,y,0);const b=new Uint8Array(a.drawingBufferWidth*a.drawingBufferHeight*4);return a.readPixels(0,0,a.drawingBufferWidth,a.drawingBufferHeight,a.RGBA,a.UNSIGNED_BYTE,b),b}return a.bindFramebuffer(a.FRAMEBUFFER,f),this._canvasPixelComparison(g(h),n.canvasCopies.map(g),n.timeStamps)}_canvasPixelComparison(h,n,a){let f=a[1]-a[0];const g=h.length/4;for(let y=0;y<n.length;y++){const b=n[y];let E=0;for(let A=0;A<b.length;A+=4)b[A]===h[A]&&b[A+1]===h[A+1]&&b[A+2]===h[A+2]&&b[A+3]===h[A+3]&&(E+=1);f+=(a[y+2]-a[y+1])*(1-E/g)}return f}remove(){this._hash&&this._hash.remove();for(const n of this._controls)n.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this._domRenderTaskQueue.clear(),this.style&&this.style.destroy(),this.indoor.destroy(),this.painter.destroy(),this.handlers&&this.handlers.destroy(),this.handlers=void 0,this.setStyle(null),window.removeEventListener("resize",this._onWindowResize,!1),window.removeEventListener("orientationchange",this._onWindowResize,!1),window.removeEventListener(this._fullscreenchangeEvent,this._onWindowResize,!1),window.removeEventListener("online",this._onWindowOnline,!1),window.removeEventListener("visibilitychange",this._onVisibilityChange,!1);const h=this.painter.context.gl.getExtension("WEBGL_lose_context");h&&h.loseContext(),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvasContainer.remove(),this._controlContainer.remove(),this._missingCSSCanary.remove(),this._canvas=void 0,this._canvasContainer=void 0,this._controlContainer=void 0,this._missingCSSCanary=void 0,this._container.classList.remove("mapboxgl-map"),this._container.removeEventListener("scroll",this._onMapScroll,!1),Lr.delete(this.painter.context.gl),Mn.remove(),Qn.remove(),this._removed=!0,this.fire(new s.A("remove"))}triggerRepaint(){this._triggerFrame(!0)}_triggerFrame(h){this._renderNextFrame=this._renderNextFrame||h,this.style&&!this._frame&&(this._frame=s.q.frame(n=>{const a=!!this._renderNextFrame;this._frame=null,this._renderNextFrame=null,a&&this._render(n)}))}_preloadTiles(h){const n=this.style?this.style.getSourceCaches():[];return s.bt(n,(a,f)=>a._preloadTiles(h,f),()=>{this.triggerRepaint()}),this}_onWindowOnline(){this._update()}_onWindowResize(h){this._trackResize&&this.resize({originalEvent:h})._update()}_onVisibilityChange(){document.visibilityState==="hidden"&&this._visibilityHidden++}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(h){this._showTileBoundaries!==h&&(this._showTileBoundaries=h,this._tp.refreshUI(),this._update())}get showParseStatus(){return!!this._showParseStatus}set showParseStatus(h){this._showParseStatus!==h&&(this._showParseStatus=h,this._tp.refreshUI(),this._update())}get showTerrainWireframe(){return!!this._showTerrainWireframe}set showTerrainWireframe(h){this._showTerrainWireframe!==h&&(this._showTerrainWireframe=h,this._tp.refreshUI(),this._update())}get showLayers2DWireframe(){return!!this._showLayers2DWireframe}set showLayers2DWireframe(h){this._showLayers2DWireframe!==h&&(this._showLayers2DWireframe=h,this._tp.refreshUI(),this._update())}get showLayers3DWireframe(){return!!this._showLayers3DWireframe}set showLayers3DWireframe(h){this._showLayers3DWireframe!==h&&(this._showLayers3DWireframe=h,this._tp.refreshUI(),this._update())}get speedIndexTiming(){return!!this._speedIndexTiming}set speedIndexTiming(h){this._speedIndexTiming!==h&&(this._speedIndexTiming=h,this._update())}get showPadding(){return!!this._showPadding}set showPadding(h){this._showPadding!==h&&(this._showPadding=h,this._tp.refreshUI(),this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(h){this._showCollisionBoxes!==h&&(this._showCollisionBoxes=h,this._tp.refreshUI(),h?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(h){this._showOverdrawInspector!==h&&(this._showOverdrawInspector=h,this._tp.refreshUI(),this._update())}get repaint(){return!!this._repaint}set repaint(h){this._repaint!==h&&(this._repaint=h,this._tp.refreshUI(),this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(h){this._vertices=h,this._update()}get showTileAABBs(){return!!this._showTileAABBs}set showTileAABBs(h){this._showTileAABBs!==h&&(this._showTileAABBs=h,this._tp.refreshUI(),h&&this._update())}_setCacheLimits(h,n){s.eJ(h,n)}get version(){return k}},NavigationControl:class{constructor(h={}){this.options=s.h({},$0,h),this._container=H("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",n=>n.preventDefault()),this.options.showZoom&&(s.aV(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",n=>{this._map&&this._map.zoomIn({},{originalEvent:n})}),H("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",n=>{this._map&&this._map.zoomOut({},{originalEvent:n})}),H("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(s.aV(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",n=>{const a=this._map;a&&(this.options.visualizePitch?a.resetNorthPitch({},{originalEvent:n}):a.resetNorth({},{originalEvent:n}))}),this._compassIcon=H("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}_updateZoomButtons(){const h=this._map;if(!h)return;const n=h.getZoom(),a=n===h.getMaxZoom(),f=n===h.getMinZoom();this._zoomInButton.disabled=a,this._zoomOutButton.disabled=f,this._zoomInButton.setAttribute("aria-disabled",a.toString()),this._zoomOutButton.setAttribute("aria-disabled",f.toString())}_rotateCompassArrow(){const h=this._map;if(!h)return;const n=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(h.transform.pitch*(Math.PI/180)),.5)}) rotateX(${h.transform.pitch}deg) rotateZ(${h.transform.angle*(180/Math.PI)}deg)`:`rotate(${h.transform.angle*(180/Math.PI)}deg)`;h._requestDomTask(()=>{this._compassIcon&&(this._compassIcon.style.transform=n)})}onAdd(h){return this._map=h,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),h.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&h.on("pitch",this._rotateCompassArrow),h.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new mS(h,this._compass,this.options.visualizePitch)),this._container}onRemove(){const h=this._map;h&&(this._container.remove(),this.options.showZoom&&h.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&h.off("pitch",this._rotateCompassArrow),h.off("rotate",this._rotateCompassArrow),this._handler&&this._handler.off(),this._handler=void 0),this._map=void 0)}_createButton(h,n){const a=H("button",h,this._container);return a.type="button",a.addEventListener("click",n),a}_setButtonTitle(h,n){if(!this._map)return;const a=this._map._getUIString(`NavigationControl.${n}`);h.setAttribute("aria-label",a),h.firstElementChild&&h.firstElementChild.setAttribute("title",a)}},GeolocateControl:class extends s.E{constructor(h={}){super();const n=navigator.geolocation;this.options=s.h({geolocation:n},my,h),s.aV(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker","_updateMarkerRotation","_onDeviceOrientation"],this),this._updateMarkerRotationThrottled=ac(this._updateMarkerRotation,20),this._numberOfWatches=0}onAdd(h){return this._map=h,this._container=H("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkGeolocationSupport(this._setupUI),this._container}onRemove(){this._geolocationWatchID!==void 0&&(this.options.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),this._container.remove(),this._map.off("zoom",this._onZoom),this._map=void 0,this._numberOfWatches=0,this._noTimeout=!1}_checkGeolocationSupport(h){const n=(a=!!this.options.geolocation)=>{this._supportsGeolocation=a,h(a)};this._supportsGeolocation!==void 0?h(this._supportsGeolocation):navigator.permissions!==void 0?navigator.permissions.query({name:"geolocation"}).then(a=>n(a.state!=="denied")).catch(()=>n()):n()}_isOutOfMapMaxBounds(h){const n=this._map.getMaxBounds(),a=h.coords;return!!n&&(a.longitude<n.getWest()||a.longitude>n.getEast()||a.latitude<n.getSouth()||a.latitude>n.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}}_onSuccess(h){if(this._map){if(this._isOutOfMapMaxBounds(h))return this._setErrorState(),this.fire(new s.A("outofmaxbounds",h)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=h,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(h),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(h),this.options.showUserLocation&&this._userLocationDotMarker.removeClassName("mapboxgl-user-location-dot-stale"),this.fire(new s.A("geolocate",h)),this._finish()}}_updateCamera(h){const n=new s.cd(h.coords.longitude,h.coords.latitude),a=h.coords.accuracy,f=this._map.getBearing(),g=s.h({bearing:f},this.options.fitBoundsOptions);this._map.fitBounds(n.toBounds(a),g,{geolocateSource:!0})}_updateMarker(h){if(h){const n=new s.cd(h.coords.longitude,h.coords.latitude);this._accuracyCircleMarker.setLngLat(n).addTo(this._map),this._userLocationDotMarker.setLngLat(n).addTo(this._map),this._accuracy=h.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()}_updateCircleRadius(){const h=this._map.transform,n=s.c6(1,h._center.lat)*h.worldSize,a=Math.ceil(2*this._accuracy*n);this._circleElement.style.width=`${a}px`,this._circleElement.style.height=`${a}px`}_onZoom(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}_updateMarkerRotation(){this._userLocationDotMarker&&typeof this._heading=="number"?(this._userLocationDotMarker.setRotation(this._heading),this._userLocationDotMarker.addClassName("mapboxgl-user-location-show-heading")):(this._userLocationDotMarker.removeClassName("mapboxgl-user-location-show-heading"),this._userLocationDotMarker.setRotation(0))}_onError(h){if(this._map){if(this.options.trackUserLocation)if(h.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const n=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.setAttribute("aria-label",n),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",n),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(h.code===3&&this._noTimeout)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._userLocationDotMarker.addClassName("mapboxgl-user-location-dot-stale"),this.fire(new s.A("error",h)),this._finish()}}_finish(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0}_setupUI(h){if(this._map!==void 0){if(this._container.addEventListener("contextmenu",n=>n.preventDefault()),this._geolocateButton=H("button","mapboxgl-ctrl-geolocate",this._container),H("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",h===!1){s.w("Geolocation support is not available so the GeolocateControl will be disabled.");const n=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.setAttribute("aria-label",n),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",n)}else{const n=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.setAttribute("aria-label",n),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",n)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=H("div","mapboxgl-user-location"),this._dotElement.appendChild(H("div","mapboxgl-user-location-dot")),this._dotElement.appendChild(H("div","mapboxgl-user-location-heading")),this._userLocationDotMarker=new yf({element:this._dotElement,rotationAlignment:"map",pitchAlignment:"map"}),this._circleElement=H("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new yf({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",n=>{n.geolocateSource||this._watchState!=="ACTIVE_LOCK"||n.originalEvent&&n.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this.fire(new s.A("trackuserlocationend")))})}}_onDeviceOrientation(h){this._userLocationDotMarker&&(h.webkitCompassHeading?this._heading=h.webkitCompassHeading:h.absolute===!0&&(this._heading=-1*h.alpha),this._updateMarkerRotationThrottled())}trigger(){if(!this._setup)return s.w("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new s.A("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":this._numberOfWatches--,this._noTimeout=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new s.A("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new s.A("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let h;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),this._numberOfWatches++,this._numberOfWatches>1?(h={maximumAge:6e5,timeout:0},this._noTimeout=!0):(h=this.options.positionOptions,this._noTimeout=!1),this._geolocationWatchID=this.options.geolocation.watchPosition(this._onSuccess,this._onError,h),this.options.showUserHeading&&this._addDeviceOrientationListener()}}else this.options.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=window.setTimeout(this._finish,1e4);return!0}_addDeviceOrientationListener(){const h=()=>{"ondeviceorientationabsolute"in window?window.addEventListener("deviceorientationabsolute",this._onDeviceOrientation):window.addEventListener("deviceorientation",this._onDeviceOrientation)};typeof DeviceMotionEvent<"u"&&typeof DeviceMotionEvent.requestPermission=="function"?DeviceOrientationEvent.requestPermission().then(n=>{n==="granted"&&h()}).catch(console.error):h()}_clearWatch(){this.options.geolocation.clearWatch(this._geolocationWatchID),window.removeEventListener("deviceorientation",this._onDeviceOrientation),window.removeEventListener("deviceorientationabsolute",this._onDeviceOrientation),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},AttributionControl:fy,ScaleControl:class{constructor(h={}){this.options=s.h({},vf,h),this._isNumberFormatSupported=function(){try{return new Intl.NumberFormat("en",{style:"unit",unitDisplay:"short",unit:"meter"}),!0}catch{return!1}}(),s.aV(["_update","_setScale","setUnit"],this)}getDefaultPosition(){return"bottom-left"}_update(){const h=this.options.maxWidth||100,n=this._map,a=n._containerHeight/2,f=n._containerWidth/2-h/2,g=n.unproject([f,a]),y=n.unproject([f+h,a]),b=g.distanceTo(y);if(this.options.unit==="imperial"){const E=3.2808*b;E>5280?this._setScale(h,E/5280,"mile"):this._setScale(h,E,"foot")}else this.options.unit==="nautical"?this._setScale(h,b/1852,"nautical-mile"):b>=1e3?this._setScale(h,b/1e3,"kilometer"):this._setScale(h,b,"meter")}_setScale(h,n,a){this._map._requestDomTask(()=>{const f=function(y){const b=Math.pow(10,`${Math.floor(y)}`.length-1);let E=y/b;return E=E>=10?10:E>=5?5:E>=3?3:E>=2?2:E>=1?1:function(A){const R=Math.pow(10,Math.ceil(-Math.log(A)/Math.LN10));return Math.round(A*R)/R}(E),b*E}(n),g=f/n;this._container.innerHTML=this._isNumberFormatSupported&&a!=="nautical-mile"?new Intl.NumberFormat(this._language,{style:"unit",unitDisplay:"short",unit:a}).format(f):`${f}&nbsp;${ud[a]}`,this._container.style.width=h*g+"px"})}onAdd(h){return this._map=h,this._language=h.getLanguage(),this._container=H("div","mapboxgl-ctrl mapboxgl-ctrl-scale",h.getContainer()),this._container.dir="auto",this._map.on("move",this._update),this._update(),this._container}onRemove(){this._container.remove(),this._map.off("move",this._update),this._map=void 0}_setLanguage(h){this._language=h,this._update()}setUnit(h){this.options.unit=h,this._update()}},FullscreenControl:class{constructor(h={}){this._fullscreen=!1,h&&h.container&&(h.container instanceof HTMLElement?this._container=h.container:s.w("Full screen control 'container' must be a DOM element.")),s.aV(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onwebkitfullscreenchange"in document&&(this._fullscreenchange="webkitfullscreenchange")}onAdd(h){return this._map=h,this._container||(this._container=this._map.getContainer()),this._controlContainer=H("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",s.w("This device does not support fullscreen mode.")),this._controlContainer}onRemove(){this._controlContainer.remove(),this._map=null,document.removeEventListener(this._fullscreenchange,this._changeIcon)}_checkFullscreenSupport(){return!(!document.fullscreenEnabled&&!document.webkitFullscreenEnabled)}_setupUI(){const h=this._fullscreenButton=H("button","mapboxgl-ctrl-fullscreen",this._controlContainer);H("span","mapboxgl-ctrl-icon",h).setAttribute("aria-hidden","true"),h.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),document.addEventListener(this._fullscreenchange,this._changeIcon)}_updateTitle(){const h=this._getTitle();this._fullscreenButton.setAttribute("aria-label",h),this._fullscreenButton.firstElementChild&&this._fullscreenButton.firstElementChild.setAttribute("title",h)}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_changeIcon(){(document.fullscreenElement||document.webkitFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())}_onClickFullscreen(){this._isFullscreen()?document.exitFullscreen?document.exitFullscreen():document.webkitCancelFullScreen&&document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()}},Popup:class extends s.E{constructor(h){super(),this.options=s.h(Object.create(_l),h),this._altitude=this.options.altitude,s.aV(["_update","_onClose","remove","_onMouseEvent"],this),this._classList=new Set(h&&h.className?h.className.trim().split(/\s+/):[])}addTo(h){return this._map&&this.remove(),this._map=h,this.options.closeOnClick&&h.on("preclick",this._onClose),this.options.closeOnMove&&h.on("move",this._onClose),h.on("remove",this.remove),this._update(),h._addPopup(this),this._focusFirstElement(),this._trackPointer?(h.on("mousemove",this._onMouseEvent),h.on("mouseup",this._onMouseEvent),h._canvasContainer.classList.add("mapboxgl-track-pointer")):h.on("move",this._update),this.fire(new s.A("open")),this}isOpen(){return!!this._map}remove(){this._content&&this._content.remove(),this._container&&(this._container.remove(),this._container=void 0);const h=this._map;return h&&(h.off("move",this._update),h.off("move",this._onClose),h.off("preclick",this._onClose),h.off("click",this._onClose),h.off("remove",this.remove),h.off("mousemove",this._onMouseEvent),h.off("mouseup",this._onMouseEvent),h.off("drag",this._onMouseEvent),h._canvasContainer&&h._canvasContainer.classList.remove("mapboxgl-track-pointer"),h._removePopup(this),this._map=void 0),this.fire(new s.A("close")),this}getLngLat(){return this._lngLat}setLngLat(h){this._lngLat=s.cd.convert(h),this._pos=null,this._trackPointer=!1,this._update();const n=this._map;return n&&(n.on("move",this._update),n.off("mousemove",this._onMouseEvent),n._canvasContainer.classList.remove("mapboxgl-track-pointer")),this}getAltitude(){return this._altitude}setAltitude(h){return this._altitude=h,this._update(),this}trackPointer(){this._trackPointer=!0,this._pos=null,this._update();const h=this._map;return h&&(h.off("move",this._update),h.on("mousemove",this._onMouseEvent),h.on("drag",this._onMouseEvent),h._canvasContainer.classList.add("mapboxgl-track-pointer")),this}getElement(){return this._container}setText(h){return this.setDOMContent(document.createTextNode(h))}setHTML(h){const n=document.createDocumentFragment(),a=document.createElement("body");let f;for(a.innerHTML=h;f=a.firstChild,f;)n.appendChild(f);return this.setDOMContent(n)}getMaxWidth(){return this._container&&this._container.style.maxWidth}setMaxWidth(h){return this.options.maxWidth=h,this._update(),this}setDOMContent(h){let n=this._content;if(n)for(;n.hasChildNodes();)n.firstChild&&n.removeChild(n.firstChild);else n=this._content=H("div","mapboxgl-popup-content",this._container||void 0);if(n.appendChild(h),this.options.closeButton){const a=this._closeButton=H("button","mapboxgl-popup-close-button",n);a.type="button",a.setAttribute("aria-label","Close popup"),a.innerHTML='<span aria-hidden="true">&#215;</span>',a.addEventListener("click",this._onClose)}return this._update(),this._focusFirstElement(),this}addClassName(h){return this._classList.add(h),this._updateClassList(),this}removeClassName(h){return this._classList.delete(h),this._updateClassList(),this}setOffset(h){return this.options.offset=h,this._update(),this}toggleClassName(h){let n;return this._classList.delete(h)?n=!1:(this._classList.add(h),n=!0),this._updateClassList(),n}_onMouseEvent(h){this._update(h.point)}_getAnchor(h){if(this.options.anchor)return this.options.anchor;const n=this._map,a=this._container,f=this._pos;if(!n||!a||!f)return"bottom";const g=a.offsetWidth,y=a.offsetHeight,b=f.x<g/2,E=f.x>n.transform.width-g/2;if(f.y+h<y)return b?"top-left":E?"top-right":"top";if(f.y>n.transform.height-y){if(b)return"bottom-left";if(E)return"bottom-right"}return b?"left":E?"right":"bottom"}_updateClassList(){const h=this._container;if(!h)return;const n=[...this._classList];n.push("mapboxgl-popup"),this._anchor&&n.push(`mapboxgl-popup-anchor-${this._anchor}`),this._trackPointer&&n.push("mapboxgl-popup-track-pointer"),h.className=n.join(" ")}_update(h){const n=this._map,a=this._content;if(!n||!this._lngLat&&!this._trackPointer||!a)return;let f=this._container;if(f||(f=this._container=H("div","mapboxgl-popup",n.getContainer()),this._tip=H("div","mapboxgl-popup-tip",f),f.appendChild(a)),this.options.maxWidth&&f.style.maxWidth!==this.options.maxWidth&&(f.style.maxWidth=this.options.maxWidth),n.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=cd(this._lngLat,this._pos,n.transform)),!this._trackPointer||h){const g=this._pos=this._trackPointer&&h instanceof s.P?h:n.project(this._lngLat,this._altitude),y=na(this.options.offset),b=this._anchor=this._getAnchor(y.y),E=na(this.options.offset,b),A=g.add(E).round();n._requestDomTask(()=>{this._container&&b&&(this._container.style.transform=`${py[b]} translate(${A.x}px,${A.y}px)`)})}if(!this._marker&&n._showingGlobe()){const g=s.eK(n.transform,this._lngLat)?0:1;this._setOpacity(g)}this._updateClassList()}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const h=this._container.querySelector(va);h&&h.focus()}_onClose(){this.remove()}_setOpacity(h){this._container&&(this._container.style.opacity=`${h}`),this._content&&(this._content.style.pointerEvents=h?"auto":"none")}},Marker:yf,Style:js,LngLat:s.cd,LngLatBounds:s.aG,Point:s.P,MercatorCoordinate:s.ac,FreeCameraOptions:Wx,Evented:s.E,config:s.e,prewarm:s.eO,clearPrewarmedResources:s.eN,get accessToken(){return s.e.ACCESS_TOKEN},set accessToken(h){s.e.ACCESS_TOKEN=h},get baseApiUrl(){return s.e.API_URL},set baseApiUrl(h){s.e.API_URL=h},get workerCount(){return s.eX.workerCount},set workerCount(h){s.eX.workerCount=h},get maxParallelImageRequests(){return s.e.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(h){s.e.MAX_PARALLEL_IMAGE_REQUESTS=h},clearStorage(h){s.eW(h)},get workerUrl(){return s.eV.workerUrl},set workerUrl(h){s.eV.workerUrl=h},get workerClass(){return s.eV.workerClass},set workerClass(h){s.eV.workerClass=h},get workerParams(){return s.eV.workerParams},set workerParams(h){s.eV.workerParams=h},get dracoUrl(){return s.eU()},set dracoUrl(h){s.eT(h)},get meshoptUrl(){return s.eS()},set meshoptUrl(h){s.eR(h)},setNow:s.q.setNow,restoreNow:s.q.restoreNow}});var C=_;return C})})(tj);var ZZ=tj.exports;const Ed=zw(ZZ),XZ=r_("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",{variants:{variant:{default:"bg-primary text-primary-foreground hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground hover:bg-destructive/90",outline:"border border-input bg-background hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-10 px-4 py-2",sm:"h-9 rounded-md px-3",lg:"h-11 rounded-md px-8",icon:"h-10 w-10"}},defaultVariants:{variant:"default",size:"default"}}),An=B.forwardRef(({className:t,variant:r,size:l,asChild:d=!1,..._},x)=>{const C=d?Rc:"button";return w.jsx(C,{className:rr(XZ({variant:r,size:l,className:t})),ref:x,..._})});An.displayName="Button";const YZ=({onLocationSelect:t,onHumanitarianClick:r,humanitarianMode:l,onMapReady:d,onRegionSelect:_,devLocation:x})=>{console.log("MapView component rendered");const C=B.useRef(null),s=B.useRef(null),k=B.useRef(null),[z,V]=B.useState("pk.eyJ1IjoianhlbiIsImEiOiJjbTQ0NXB4azUwbDltMmtzZGd3cHBrZ3NnIn0.-2BPKrq0mp2-xFVQNSW7eQ"),[U,$]=B.useState(!1),se=Hl(),ae=B.useRef(!1),[H,ne]=B.useState(null),[Y,te]=B.useState(!1),de=B.useRef([]);B.useEffect(()=>{ae.current=U,de.current.forEach(Je=>{const mt=Je.getElement();U?mt.style.display="none":mt.style.display="block"})},[U]),B.useEffect(()=>{l!==void 0&&l!==U&&$(l)},[l]),B.useEffect(()=>{if(s.current)if(k.current&&(k.current.remove(),k.current=null),x){console.log("Setting dev location marker at:",x);const Je=document.createElement("div");Je.className="dev-location-marker",Je.style.width="30px",Je.style.height="30px",Je.style.borderRadius="50%",Je.style.backgroundColor="#FF6B00",Je.style.border="3px solid white",Je.style.boxShadow="0 0 10px rgba(255, 107, 0, 0.5)",Je.style.cursor="pointer",Je.title=`Dev Location: ${x.name}`,Je.style.animation="pulse 2s infinite";const mt=new Ed.Popup({offset:25}).setHTML(`
          <div class="p-2">
            <p class="font-semibold text-orange-600">🛠️ Dev Location</p>
            <p class="text-sm">${x.name}</p>
            <p class="text-xs text-muted-foreground mt-1">
              ${x.lat.toFixed(4)}, ${x.lng.toFixed(4)}
            </p>
          </div>
        `);k.current=new Ed.Marker(Je).setLngLat([x.lng,x.lat]).setPopup(mt).addTo(s.current),ne({lat:x.lat,lng:x.lng})}else Pe()},[x]);const Me=Je=>({sf:[{id:1,title:"Mission District Street Fair Returns",type:"news",category:"Community Events",location:"Mission District",source:"Mission Local"},{id:2,name:"Sunset District Neighborhood Watch",type:"community",category:"Safety",location:"Sunset District",members:450},{id:3,name:"Castro Street Fair",type:"event",venue:"Castro Street",location:"Castro District",date:"2024-10-06"},{id:4,title:"New Bike Lanes Coming to Valencia Street",type:"news",category:"Transportation",location:"Mission District",source:"Streetsblog SF"},{id:5,name:"Chinatown Community Garden",type:"community",category:"Environment",location:"Chinatown",members:89}]})[Je]||[];console.log("MapView state:",{hasToken:!!z,tokenValid:!!(z&&z.length>0)});const Le=Je=>{if(console.log("initializeMap function called"),console.log("mapContainer.current:",C.current),!C.current){console.log("mapContainer.current is null, returning early");return}console.log("Initializing map with token:",Je.substring(0,20)+"..."),Ed.accessToken=Je;try{s.current=new Ed.Map({container:C.current,style:"mapbox://styles/mapbox/dark-v11",center:[0,20],zoom:1.2,projection:"globe"}),console.log("Map created successfully"),s.current.on("load",()=>{te(!0),console.log("Map loaded and ready"),d&&d({centerOnLocation:Ve})})}catch(mt){console.error("Error creating map:",mt),d&&d({centerOnLocation:(ft,Ct)=>{console.log(`Fallback: Centering on ${Ct||"location"} at [${ft[0]}, ${ft[1]}]`),te(!0),console.log(`Fallback map centering completed for: ${Ct}`),ne({lat:ft[1],lng:ft[0]})}});return}s.current.on("style.load",()=>{if(!s.current)return;s.current.setFog({color:"rgb(20, 20, 30)","high-color":"rgb(5, 5, 15)","horizon-blend":.02,"space-color":"rgb(5, 5, 15)","star-intensity":.6}),[{id:"san_francisco",communityId:"community_sf",coords:[-122.4194,37.7749],name:"San Francisco, CA",type:"communities",category:"Housing & Homelessness Solutions"},{id:"arusha",communityId:"community_arusha",coords:[36.6833,-3.3667],name:"Arusha, Tanzania",type:"communities",category:"Wildlife Conservation Network"},{id:"miami",communityId:"community_miami",coords:[-80.1918,25.7617],name:"Miami, Florida",type:"communities",category:"Hurricane Preparedness Initiative"},{id:"tokyo",communityId:"community_tokyo",coords:[139.6917,35.6895],name:"Tokyo, Japan",type:"communities",category:"Earthquake Response Team"},{id:"amsterdam",communityId:"community_amsterdam",coords:[4.9041,52.3676],name:"Amsterdam, Netherlands",type:"communities",category:"Climate Adaptation Forum"},{id:"sydney",communityId:"community_sydney",coords:[151.2093,-33.8688],name:"Sydney, Australia",type:"communities",category:"Bushfire Preparedness Coalition"},{id:"mumbai",communityId:"community_mumbai",coords:[72.8777,19.076],name:"Mumbai, India",type:"communities",category:"Monsoon Resilience Network"},{id:"sao_paulo",communityId:"community_sao_paulo",coords:[-46.6333,-23.5505],name:"São Paulo, Brazil",type:"communities",category:"Urban Sustainability Project"},{id:"dubai",communityId:"community_dubai",coords:[55.2708,25.2048],name:"Dubai, UAE",type:"communities",category:"Water Conservation Alliance"},{id:"vancouver",communityId:"community_vancouver",coords:[-123.1207,49.2827],name:"Vancouver, Canada",type:"communities",category:"Indigenous Community Hub"},{id:"reykjavik",communityId:"community_reykjavik",coords:[-21.8174,64.1466],name:"Reykjavik, Iceland",type:"communities",category:"Renewable Energy Collective"}].forEach(Be=>{const ft=Be.type==="news"?"#3b82f6":Be.type==="communities"?"#10b981":"#f59e0b",Ct=new Ed.Popup({offset:25}).setHTML(`
            <div class="p-3 bg-card text-card-foreground rounded cursor-pointer transition-colors" 
                 data-community-id="${Be.communityId}"
                 data-community-name="${Be.category}"
                 style="cursor: pointer;">
              <h3 class="font-semibold mb-1">${Be.name}</h3>
              <p class="text-sm text-muted-foreground mb-2">
                ${Be.category}
              </p>
              <div class="text-xs text-primary font-medium">
                Click to open community →
              </div>
            </div>
          `);Ct.on("open",()=>{const fn=document.querySelector(`[data-community-id="${Be.communityId}"]`);fn&&fn.addEventListener("click",()=>{const Qn=new URLSearchParams({id:Be.communityId,name:Be.category,type:Be.type,location:Be.name,category:Be.category,members:"0",description:""});se(`/community-chat?${Qn.toString()}`)})});const Zt=new Ed.Marker({color:ft,scale:.8}).setLngLat(Be.coords).setPopup(Ct).addTo(s.current);de.current.push(Zt)})}),s.current.addControl(new Ed.NavigationControl,"bottom-right"),s.current.on("click",async mt=>{if(ae.current){r==null||r();return}if(!t)return;const{lng:Be,lat:ft}=mt.lngLat;let Ct="Unknown",Zt=[];Be>=-122.52&&Be<=-122.35&&ft>=37.7&&ft<=37.85&&(Ct="San Francisco",Zt=Me("sf")),t({lat:ft,lng:Be,name:Ct,regionData:Zt})}),s.current.on("load",()=>{if(!s.current)return;const mt={type:"FeatureCollection",features:[{type:"Feature",geometry:{type:"Point",coordinates:[34.4669,31.5017]},properties:{intensity:100,id:"gaza-2024",name:"Gaza Strip",description:"Aid access heavily constrained; nearly entire population displaced during war.",affected:"~2.1M in need of food aid",image:"https://images.unsplash.com/photo-1578662996442-48f60103fc96?w=400&h=300&fit=crop"}},{type:"Feature",geometry:{type:"Point",coordinates:[32.5599,15.5007]},properties:{intensity:100,id:"sudan-2025",name:"Sudan",description:"Largest humanitarian crisis; >4M refugees in neighboring states + massive internal displacement.",affected:"30.4M people in need",image:"https://images.unsplash.com/photo-1547471080-7cc2caa01a7e?w=400&h=300&fit=crop"}},{type:"Feature",geometry:{type:"Point",coordinates:[30.5234,50.4501]},properties:{intensity:90,id:"ukraine-2025",name:"Ukraine",description:"Ongoing strikes on energy and civilian infrastructure.",affected:"12.7M need assistance in 2025",image:"https://images.unsplash.com/photo-1605818610003-0a1476dfbc26?w=400&h=300&fit=crop"}},{type:"Feature",geometry:{type:"Point",coordinates:[36.2021,36.2021]},properties:{intensity:95,id:"syria-2025",name:"Syria",description:"Response plans remain severely underfunded.",affected:"~17M need assistance",image:"https://images.unsplash.com/photo-1591608971362-f08b2a75731a?w=400&h=300&fit=crop"}},{type:"Feature",geometry:{type:"Point",coordinates:[44.2075,15.5527]},properties:{intensity:90,id:"yemen-2025",name:"Yemen",description:"Funding gaps are acute.",affected:"~19.5M people need aid in 2025",image:"https://images.unsplash.com/photo-1591608971362-f08b2a75731a?w=400&h=300&fit=crop"}},{type:"Feature",geometry:{type:"Point",coordinates:[69.2075,34.5553]},properties:{intensity:95,id:"afghanistan-2025",name:"Afghanistan",description:"Agencies warn of winter risks and service shutdowns due to cuts.",affected:"~22.9M need aid",image:"https://images.unsplash.com/photo-1564859228273-274232fdb516?w=400&h=300&fit=crop"}},{type:"Feature",geometry:{type:"Point",coordinates:[96.1951,16.8661]},properties:{intensity:90,id:"myanmar-2025",name:"Myanmar",description:"Civil conflict with massive displacement.",affected:"~20-22M need aid, ~3.6M IDPs",image:"https://images.unsplash.com/photo-1528181304800-259b08848526?w=400&h=300&fit=crop"}},{type:"Feature",geometry:{type:"Point",coordinates:[15.2663,-4.0383]},properties:{intensity:95,id:"drc-2025",name:"DR Congo",description:"Conflict in the east and record hunger.",affected:"~28M require assistance",image:"https://images.unsplash.com/photo-1584380931214-dbb5b72e7fd0?w=400&h=300&fit=crop"}},{type:"Feature",geometry:{type:"Point",coordinates:[45.3182,2.0469]},properties:{intensity:80,id:"somalia-2025",name:"Somalia",description:"Drought, flooding, and conflict.",affected:"~6M in need, >3.5M displaced",image:"https://images.unsplash.com/photo-1593113598332-cd288d649433?w=400&h=300&fit=crop"}},{type:"Feature",geometry:{type:"Point",coordinates:[31.5656,6.877]},properties:{intensity:85,id:"south-sudan-2025",name:"South Sudan",description:"Flooding and violence; nearly 0.5M newly displaced in 2025.",affected:"~9.3M in need",image:"https://images.unsplash.com/photo-1547471080-7cc2caa01a7e?w=400&h=300&fit=crop"}},{type:"Feature",geometry:{type:"Point",coordinates:[-72.2852,18.5944]},properties:{intensity:85,id:"haiti-2025",name:"Haiti",description:"Gang control over Port-au-Prince, political vacuum, kidnappings, cholera resurgence, famine-risk zones.",affected:">5M in need (≈ half the population)",image:"https://images.unsplash.com/photo-1505142468610-359e7d316be0?w=400&h=300&fit=crop"}},{type:"Feature",geometry:{type:"Point",coordinates:[-1.5616,12.2383]},properties:{intensity:80,id:"burkina-faso-2025",name:"Burkina Faso",description:"Severely neglected crisis.",affected:"~5.9M in need, >2M IDPs",image:"https://images.unsplash.com/photo-1516026672322-bc52d61a55d5?w=400&h=300&fit=crop"}},{type:"Feature",geometry:{type:"Point",coordinates:[15.0444,12.1348]},properties:{intensity:75,id:"chad-2025",name:"Chad",description:"Hosting Sudanese refugees, straining fragile context.",affected:"~1.28M Sudanese refugees",image:"https://images.unsplash.com/photo-1547471080-7cc2caa01a7e?w=400&h=300&fit=crop"}},{type:"Feature",geometry:{type:"Point",coordinates:[92.1265,21.4272]},properties:{intensity:75,id:"rohingya-2025",name:"Rohingya (Bangladesh)",description:"Refugees in Cox's Bazar and Bhasan Char.",affected:"~1.1-1.2M refugees; 2025 JRP targets 1.48M",image:"https://images.unsplash.com/photo-1528181304800-259b08848526?w=400&h=300&fit=crop"}},{type:"Feature",geometry:{type:"Point",coordinates:[18.5582,4.3947]},properties:{intensity:70,id:"car-2025",name:"Central African Republic",description:"Limited humanitarian access and funding.",affected:"~2.4M highly vulnerable",image:"https://images.unsplash.com/photo-1584380931214-dbb5b72e7fd0?w=400&h=300&fit=crop"}},{type:"Feature",geometry:{type:"Point",coordinates:[35.5018,33.8886]},properties:{intensity:75,id:"lebanon-2025",name:"Lebanon",description:"Economic collapse and regional conflict spillovers.",affected:"~4.1M people in need",image:"https://images.unsplash.com/photo-1552832230-c0197dd311b5?w=400&h=300&fit=crop"}},{type:"Feature",geometry:{type:"Point",coordinates:[-66.5897,6.4238]},properties:{intensity:90,id:"venezuela-2025",name:"Venezuela",description:"Largest displacement in Western Hemisphere - comparable to Syria. Economic collapse, food/medicine shortages.",affected:"~7-8M Venezuelans displaced across Latin America",image:"https://images.unsplash.com/photo-1589909202802-8f4aadce1849?w=400&h=300&fit=crop"}},{type:"Feature",geometry:{type:"Point",coordinates:[127.5101,40.3399]},properties:{intensity:80,id:"north-korea-2025",name:"North Korea",description:"Severe food insecurity and chronic malnutrition crisis.",affected:"~10M+ facing food shortages",image:"https://images.unsplash.com/photo-1564859228273-274232fdb516?w=400&h=300&fit=crop"}},{type:"Feature",geometry:{type:"Point",coordinates:[-74.0721,4.711]},properties:{intensity:75,id:"colombia-2025",name:"Colombia",description:"Resurgent armed groups (ELN, FARC dissidents), coca-economy violence, Venezuelan refugee strain.",affected:"~6M in humanitarian need",image:"https://images.unsplash.com/photo-1589909202802-8f4aadce1849?w=400&h=300&fit=crop"}},{type:"Feature",geometry:{type:"Point",coordinates:[-90.5069,14.6349]},properties:{intensity:70,id:"central-america-2025",name:"Central America (Northern Triangle)",description:"Chronic violence, extortion, corruption, climate crop failures. Millions displaced or migrating north.",affected:"Millions displaced/migrating (Guatemala, El Salvador, Honduras)",image:"https://images.unsplash.com/photo-1505142468610-359e7d316be0?w=400&h=300&fit=crop"}},{type:"Feature",geometry:{type:"Point",coordinates:[-82.3666,23.1136]},properties:{intensity:65,id:"cuba-2025",name:"Cuba",description:"Severe economic crisis, power shortages, medicine scarcity, record outward migration to U.S.",affected:"Humanitarian stress, record migration in 2024-25",image:"https://images.unsplash.com/photo-1505142468610-359e7d316be0?w=400&h=300&fit=crop"}}]};s.current.addSource("crisis-data",{type:"geojson",data:mt}),s.current.addLayer({id:"crisis-heatmap",type:"heatmap",source:"crisis-data",layout:{visibility:"none"},paint:{"heatmap-weight":["interpolate",["linear"],["get","intensity"],0,0,100,1],"heatmap-intensity":["interpolate",["linear"],["zoom"],0,1,9,3],"heatmap-color":["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 0, 0)",.2,"#800000",.4,"#cc0000",.6,"#ff0000",.8,"#ff3333",1,"#ff6666"],"heatmap-radius":["interpolate",["linear"],["zoom"],0,20,9,50],"heatmap-opacity":["interpolate",["linear"],["zoom"],0,.8,9,.6]}}),s.current.addLayer({id:"crisis-points",type:"circle",source:"crisis-data",layout:{visibility:"none"},paint:{"circle-radius":["interpolate",["linear"],["get","intensity"],0,3,100,15],"circle-color":["interpolate",["linear"],["get","intensity"],0,"#660000",50,"#cc0000",100,"#ff0000"],"circle-opacity":.8,"circle-stroke-color":"#330000","circle-stroke-width":1}}),s.current.on("click","crisis-points",Be=>{if(Be.preventDefault(),!ae.current||!Be.features||Be.features.length===0)return;const ft=Be.features[0],Ct=ft.properties,Zt=ft.geometry.coordinates;if(!Zt||!Ct)return;document.querySelectorAll(".mapboxgl-popup").forEach(Hn=>Hn.remove());const $n=`
          <div class="crisis-popup p-4 max-w-sm bg-white dark:bg-gray-800 rounded-lg shadow-xl border border-gray-200 dark:border-gray-600">
            <div class="flex justify-between items-start mb-3">
              <h3 class="font-bold text-lg text-gray-900 dark:text-white hover:text-blue-600 dark:hover:text-blue-400 cursor-pointer transition-colors leading-tight" 
                  onclick="window.location.href='/crisis/${Ct.id||Math.random().toString(36).substr(2,9)}'">${Ct.name}</h3>
              <button class="text-gray-400 hover:text-gray-600 dark:hover:text-gray-300 ml-3 p-1 rounded-full hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors flex-shrink-0" 
                      onclick="this.closest('.mapboxgl-popup').remove()"
                      title="Close">
                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <line x1="18" y1="6" x2="6" y2="18"></line>
                  <line x1="6" y1="6" x2="18" y2="18"></line>
                </svg>
              </button>
            </div>
            <img src="${Ct.image}" 
                 alt="${Ct.name}" 
                 class="w-full h-32 object-cover rounded-md mb-3 shadow-sm"
                 onerror="this.style.display='none'" />
            <p class="text-sm text-gray-700 dark:text-gray-200 mb-3 leading-relaxed">${Ct.description}</p>
            <div class="text-sm text-gray-600 dark:text-gray-300 border-t border-gray-200 dark:border-gray-600 pt-3">
              <div class="flex items-center gap-2">
                <span class="w-2 h-2 bg-red-500 rounded-full"></span>
                <span class="font-medium">Affected: ${Ct.affected}</span>
              </div>
            </div>
          </div>
        `;new Ed.Popup({closeButton:!1,closeOnClick:!1,maxWidth:"320px"}).setLngLat(Zt).setHTML($n).addTo(s.current),console.log("Crisis popup created for:",Ct.name)}),s.current.on("click",Be=>{s.current.queryRenderedFeatures(Be.point,{layers:["crisis-points"]}).length>0&&ae.current||ae.current&&document.querySelectorAll(".mapboxgl-popup").forEach(Zt=>Zt.remove())}),s.current.on("mouseenter","crisis-points",()=>{ae.current&&s.current&&(s.current.getCanvas().style.cursor="pointer")}),s.current.on("mouseleave","crisis-points",()=>{s.current&&(s.current.getCanvas().style.cursor="")})})},lt=()=>{if(!s.current)return;const Je=!U;$(Je),ae.current=Je,Je?(s.current.setLayoutProperty("crisis-heatmap","visibility","visible"),s.current.setLayoutProperty("crisis-points","visibility","visible")):(s.current.setLayoutProperty("crisis-heatmap","visibility","none"),s.current.setLayoutProperty("crisis-points","visibility","none"))},Pe=()=>{navigator.geolocation?navigator.geolocation.getCurrentPosition(Je=>{const{latitude:mt,longitude:Be}=Je.coords;ne({lat:mt,lng:Be})},Je=>{console.error("Error getting location:",Je),ne({lat:37.7749,lng:-122.4194})}):ne({lat:37.7749,lng:-122.4194})},Ye={neighborhood:{zoom:16,description:"Neighborhood"},city:{zoom:12,description:"City"},state:{zoom:5.5,description:"State"},national:{zoom:3.2,description:"National"},global:{zoom:1.2,description:"Global"}},vt=(Je,mt,Be)=>{switch(Je){case"neighborhood":return[Be,mt];case"city":return It(mt,Be);case"state":return Ut(mt,Be);case"national":return Pt(mt,Be);case"global":return $t(mt,Be);default:return[Be,mt]}},It=(Je,mt)=>Je>=37.7&&Je<=37.8&&mt>=-122.5&&mt<=-122.3?[-122.4194,37.7749]:Je>=34&&Je<=34.1&&mt>=-118.3&&mt<=-118.2?[-118.2437,34.0522]:Je>=40.7&&Je<=40.8&&mt>=-74&&mt<=-73.9?[-73.9857,40.7484]:Je>=41.8&&Je<=41.9&&mt>=-87.7&&mt<=-87.6?[-87.6298,41.8781]:Je>=29.7&&Je<=29.8&&mt>=-95.4&&mt<=-95.3?[-95.3698,29.7604]:[mt,Je],Ut=(Je,mt)=>Je>=32.5&&Je<=42&&mt>=-124.5&&mt<=-114.1?[-119.4179,36.7783]:Je>=25.8&&Je<=31&&mt>=-106.6&&mt<=-93.5?[-99.9018,31.9686]:Je>=40.5&&Je<=45&&mt>=-79.8&&mt<=-71.8?[-74.9,42.2]:Je>=39.7&&Je<=42.5&&mt>=-90.6&&mt<=-84.8?[-89.3985,40.6331]:Je>=45.9&&Je<=49.4&&mt>=-124.8&&mt<=-116.9?[-120.5542,47.0379]:[mt,Je],Pt=(Je,mt)=>Je>=25&&Je<=72&&mt>=-168&&mt<=-52?[-95.7129,37.0902]:Je>=42&&Je<=83&&mt>=-141&&mt<=-52?[-106.3468,56.1304]:Je>=14&&Je<=33&&mt>=-118&&mt<=-86?[-102.5528,23.6345]:Je>=35&&Je<=71&&mt>=-10&&mt<=40?[10.4515,51.1657]:Je>=-10&&Je<=81&&mt>=26&&mt<=180?[104.1954,35.8617]:[mt,Je],$t=(Je,mt)=>Je>=7&&Je<=83&&mt>=-168&&mt<=-34?[-95.7129,45.0902]:Je>=-56&&Je<=13&&mt>=-82&&mt<=-34?[-58.3816,-14.235]:Je>=35&&Je<=71&&mt>=-10&&mt<=40?[10.4515,54.526]:Je>=-10&&Je<=81&&mt>=26&&mt<=180?[104.1954,34.0479]:Je>=-35&&Je<=37&&mt>=-18&&mt<=52?[20,0]:Je>=-47&&Je<=-10&&mt>=113&&mt<=180?[133.7751,-25.2744]:[0,20],Ve=(Je,mt)=>{if(console.log(`centerOnLocation called with coordinates: [${Je[0]}, ${Je[1]}], locationName: ${mt}`),console.log("map.current:",!!s.current,"mapReady:",Y),!s.current||!Y){console.log("Map not ready or not available");return}console.log("Calling map.flyTo..."),s.current.flyTo({center:Je,zoom:10,duration:1500}),mt&&console.log(`Centered map on: ${mt}`)},jt=Je=>{if(!s.current||!Y||Je!=="global"&&!H)return;const{zoom:mt}=Ye[Je],Be=Je==="global"&&!H?[0,20]:vt(Je,H.lat,H.lng);s.current.flyTo({center:Be,zoom:mt,duration:1500}),_&&_(Je)};return B.useEffect(()=>{z&&z.length>0&&C.current?(console.log("Container is now available, initializing map..."),Le(z)):C.current&&d&&(console.log("No valid token available, providing fallback controls immediately"),d({centerOnLocation:(mt,Be)=>{console.log(`Fallback: Centering on ${Be||"location"} at [${mt[0]}, ${mt[1]}]`),te(!0),console.log(`Fallback map centering completed for: ${Be}`),ne({lat:mt[1],lng:mt[0]})}}))},[z,d]),B.useEffect(()=>{Pe()},[]),B.useEffect(()=>{H&&s.current&&Y&&s.current.flyTo({center:[H.lng,H.lat],zoom:12,duration:2e3,essential:!0})},[H,Y]),B.useEffect(()=>()=>{var Je;(Je=s.current)==null||Je.remove()},[]),w.jsxs("div",{className:"relative w-full h-screen",children:[w.jsx("div",{ref:C,className:"absolute inset-0"}),w.jsx("div",{className:"absolute top-4 left-1/2 transform -translate-x-1/2 z-10",children:w.jsxs("div",{className:"flex gap-2 bg-background/90 backdrop-blur-sm rounded-lg p-2 shadow-lg border",children:[w.jsx(An,{onClick:()=>jt("neighborhood"),variant:"outline",size:"sm",className:"text-xs","data-testid":"button-zoom-neighborhood",disabled:!H||!Y,children:"Neighborhood"}),w.jsx(An,{onClick:()=>jt("city"),variant:"outline",size:"sm",className:"text-xs","data-testid":"button-zoom-city",disabled:!H||!Y,children:"City"}),w.jsx(An,{onClick:()=>jt("state"),variant:"outline",size:"sm",className:"text-xs","data-testid":"button-zoom-state",disabled:!H||!Y,children:"State"}),w.jsx(An,{onClick:()=>jt("national"),variant:"outline",size:"sm",className:"text-xs","data-testid":"button-zoom-national",disabled:!H||!Y,children:"National"}),w.jsx(An,{onClick:()=>jt("global"),variant:"outline",size:"sm",className:"text-xs","data-testid":"button-zoom-global",disabled:!Y,children:"Global"})]})}),w.jsx("div",{className:"absolute bottom-6 left-1/2 transform -translate-x-1/2 z-10",children:w.jsx(An,{onClick:lt,variant:U?"destructive":"secondary",className:"shadow-lg backdrop-blur-sm bg-background/90 border",children:U?"Exit Humanitarian Mode":"Humanitarian Mode"})})]})},Mo=B.forwardRef(({className:t,type:r,...l},d)=>w.jsx("input",{type:r,className:rr("flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",t),ref:d,...l}));Mo.displayName="Input";const KZ=r_("inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground hover:bg-primary/80",secondary:"border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80",destructive:"border-transparent bg-destructive text-destructive-foreground hover:bg-destructive/80",outline:"text-foreground"}},defaultVariants:{variant:"default"}});function wi({className:t,variant:r,...l}){return w.jsx("div",{className:rr(KZ({variant:r}),t),...l})}var fE=0;function p2(){B.useEffect(()=>{const t=document.querySelectorAll("[data-radix-focus-guard]");return document.body.insertAdjacentElement("afterbegin",t[0]??tN()),document.body.insertAdjacentElement("beforeend",t[1]??tN()),fE++,()=>{fE===1&&document.querySelectorAll("[data-radix-focus-guard]").forEach(r=>r.remove()),fE--}},[])}function tN(){const t=document.createElement("span");return t.setAttribute("data-radix-focus-guard",""),t.tabIndex=0,t.style.outline="none",t.style.opacity="0",t.style.position="fixed",t.style.pointerEvents="none",t}var pE="focusScope.autoFocusOnMount",mE="focusScope.autoFocusOnUnmount",nN={bubbles:!1,cancelable:!0},QZ="FocusScope",Nx=B.forwardRef((t,r)=>{const{loop:l=!1,trapped:d=!1,onMountAutoFocus:_,onUnmountAutoFocus:x,...C}=t,[s,k]=B.useState(null),z=os(_),V=os(x),U=B.useRef(null),$=ni(r,H=>k(H)),se=B.useRef({paused:!1,pause(){this.paused=!0},resume(){this.paused=!1}}).current;B.useEffect(()=>{if(d){let H=function(de){if(se.paused||!s)return;const Me=de.target;s.contains(Me)?U.current=Me:Ad(U.current,{select:!0})},ne=function(de){if(se.paused||!s)return;const Me=de.relatedTarget;Me!==null&&(s.contains(Me)||Ad(U.current,{select:!0}))},Y=function(de){if(document.activeElement===document.body)for(const Le of de)Le.removedNodes.length>0&&Ad(s)};document.addEventListener("focusin",H),document.addEventListener("focusout",ne);const te=new MutationObserver(Y);return s&&te.observe(s,{childList:!0,subtree:!0}),()=>{document.removeEventListener("focusin",H),document.removeEventListener("focusout",ne),te.disconnect()}}},[d,s,se.paused]),B.useEffect(()=>{if(s){iN.add(se);const H=document.activeElement;if(!s.contains(H)){const Y=new CustomEvent(pE,nN);s.addEventListener(pE,z),s.dispatchEvent(Y),Y.defaultPrevented||(JZ(iX(rj(s)),{select:!0}),document.activeElement===H&&Ad(s))}return()=>{s.removeEventListener(pE,z),setTimeout(()=>{const Y=new CustomEvent(mE,nN);s.addEventListener(mE,V),s.dispatchEvent(Y),Y.defaultPrevented||Ad(H??document.body,{select:!0}),s.removeEventListener(mE,V),iN.remove(se)},0)}}},[s,z,V,se]);const ae=B.useCallback(H=>{if(!l&&!d||se.paused)return;const ne=H.key==="Tab"&&!H.altKey&&!H.ctrlKey&&!H.metaKey,Y=document.activeElement;if(ne&&Y){const te=H.currentTarget,[de,Me]=eX(te);de&&Me?!H.shiftKey&&Y===Me?(H.preventDefault(),l&&Ad(de,{select:!0})):H.shiftKey&&Y===de&&(H.preventDefault(),l&&Ad(Me,{select:!0})):Y===te&&H.preventDefault()}},[l,d,se.paused]);return w.jsx(ir.div,{tabIndex:-1,...C,ref:$,onKeyDown:ae})});Nx.displayName=QZ;function JZ(t,{select:r=!1}={}){const l=document.activeElement;for(const d of t)if(Ad(d,{select:r}),document.activeElement!==l)return}function eX(t){const r=rj(t),l=rN(r,t),d=rN(r.reverse(),t);return[l,d]}function rj(t){const r=[],l=document.createTreeWalker(t,NodeFilter.SHOW_ELEMENT,{acceptNode:d=>{const _=d.tagName==="INPUT"&&d.type==="hidden";return d.disabled||d.hidden||_?NodeFilter.FILTER_SKIP:d.tabIndex>=0?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP}});for(;l.nextNode();)r.push(l.currentNode);return r}function rN(t,r){for(const l of t)if(!tX(l,{upTo:r}))return l}function tX(t,{upTo:r}){if(getComputedStyle(t).visibility==="hidden")return!0;for(;t;){if(r!==void 0&&t===r)return!1;if(getComputedStyle(t).display==="none")return!0;t=t.parentElement}return!1}function nX(t){return t instanceof HTMLInputElement&&"select"in t}function Ad(t,{select:r=!1}={}){if(t&&t.focus){const l=document.activeElement;t.focus({preventScroll:!0}),t!==l&&nX(t)&&r&&t.select()}}var iN=rX();function rX(){let t=[];return{add(r){const l=t[0];r!==l&&(l==null||l.pause()),t=sN(t,r),t.unshift(r)},remove(r){var l;t=sN(t,r),(l=t[0])==null||l.resume()}}}function sN(t,r){const l=[...t],d=l.indexOf(r);return d!==-1&&l.splice(d,1),l}function iX(t){return t.filter(r=>r.tagName!=="A")}var sX=function(t){if(typeof document>"u")return null;var r=Array.isArray(t)?t[0]:t;return r.ownerDocument.body},Um=new WeakMap,cb=new WeakMap,ub={},gE=0,ij=function(t){return t&&(t.host||ij(t.parentNode))},oX=function(t,r){return r.map(function(l){if(t.contains(l))return l;var d=ij(l);return d&&t.contains(d)?d:(console.error("aria-hidden",l,"in not contained inside",t,". Doing nothing"),null)}).filter(function(l){return!!l})},aX=function(t,r,l,d){var _=oX(r,Array.isArray(t)?t:[t]);ub[l]||(ub[l]=new WeakMap);var x=ub[l],C=[],s=new Set,k=new Set(_),z=function(U){!U||s.has(U)||(s.add(U),z(U.parentNode))};_.forEach(z);var V=function(U){!U||k.has(U)||Array.prototype.forEach.call(U.children,function($){if(s.has($))V($);else try{var se=$.getAttribute(d),ae=se!==null&&se!=="false",H=(Um.get($)||0)+1,ne=(x.get($)||0)+1;Um.set($,H),x.set($,ne),C.push($),H===1&&ae&&cb.set($,!0),ne===1&&$.setAttribute(l,"true"),ae||$.setAttribute(d,"true")}catch(Y){console.error("aria-hidden: cannot operate on ",$,Y)}})};return V(r),s.clear(),gE++,function(){C.forEach(function(U){var $=Um.get(U)-1,se=x.get(U)-1;Um.set(U,$),x.set(U,se),$||(cb.has(U)||U.removeAttribute(d),cb.delete(U)),se||U.removeAttribute(l)}),gE--,gE||(Um=new WeakMap,Um=new WeakMap,cb=new WeakMap,ub={})}},m2=function(t,r,l){l===void 0&&(l="data-aria-hidden");var d=Array.from(Array.isArray(t)?t:[t]),_=sX(t);return _?(d.push.apply(d,Array.from(_.querySelectorAll("[aria-live]"))),aX(d,_,l,"aria-hidden")):function(){return null}},Ec=function(){return Ec=Object.assign||function(r){for(var l,d=1,_=arguments.length;d<_;d++){l=arguments[d];for(var x in l)Object.prototype.hasOwnProperty.call(l,x)&&(r[x]=l[x])}return r},Ec.apply(this,arguments)};function sj(t,r){var l={};for(var d in t)Object.prototype.hasOwnProperty.call(t,d)&&r.indexOf(d)<0&&(l[d]=t[d]);if(t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var _=0,d=Object.getOwnPropertySymbols(t);_<d.length;_++)r.indexOf(d[_])<0&&Object.prototype.propertyIsEnumerable.call(t,d[_])&&(l[d[_]]=t[d[_]]);return l}function lX(t,r,l){if(l||arguments.length===2)for(var d=0,_=r.length,x;d<_;d++)(x||!(d in r))&&(x||(x=Array.prototype.slice.call(r,0,d)),x[d]=r[d]);return t.concat(x||Array.prototype.slice.call(r))}var Lb="right-scroll-bar-position",Nb="width-before-scroll-bar",cX="with-scroll-bars-hidden",uX="--removed-body-scroll-bar-size";function _E(t,r){return typeof t=="function"?t(r):t&&(t.current=r),t}function dX(t,r){var l=B.useState(function(){return{value:t,callback:r,facade:{get current(){return l.value},set current(d){var _=l.value;_!==d&&(l.value=d,l.callback(d,_))}}}})[0];return l.callback=r,l.facade}var hX=typeof window<"u"?B.useLayoutEffect:B.useEffect,oN=new WeakMap;function fX(t,r){var l=dX(null,function(d){return t.forEach(function(_){return _E(_,d)})});return hX(function(){var d=oN.get(l);if(d){var _=new Set(d),x=new Set(t),C=l.current;_.forEach(function(s){x.has(s)||_E(s,null)}),x.forEach(function(s){_.has(s)||_E(s,C)})}oN.set(l,t)},[t]),l}function pX(t){return t}function mX(t,r){r===void 0&&(r=pX);var l=[],d=!1,_={read:function(){if(d)throw new Error("Sidecar: could not `read` from an `assigned` medium. `read` could be used only with `useMedium`.");return l.length?l[l.length-1]:t},useMedium:function(x){var C=r(x,d);return l.push(C),function(){l=l.filter(function(s){return s!==C})}},assignSyncMedium:function(x){for(d=!0;l.length;){var C=l;l=[],C.forEach(x)}l={push:function(s){return x(s)},filter:function(){return l}}},assignMedium:function(x){d=!0;var C=[];if(l.length){var s=l;l=[],s.forEach(x),C=l}var k=function(){var V=C;C=[],V.forEach(x)},z=function(){return Promise.resolve().then(k)};z(),l={push:function(V){C.push(V),z()},filter:function(V){return C=C.filter(V),l}}}};return _}function gX(t){t===void 0&&(t={});var r=mX(null);return r.options=Ec({async:!0,ssr:!1},t),r}var oj=function(t){var r=t.sideCar,l=sj(t,["sideCar"]);if(!r)throw new Error("Sidecar: please provide `sideCar` property to import the right car");var d=r.read();if(!d)throw new Error("Sidecar medium not found");return B.createElement(d,Ec({},l))};oj.isSideCarExport=!0;function _X(t,r){return t.useMedium(r),oj}var aj=gX(),yE=function(){},g2=B.forwardRef(function(t,r){var l=B.useRef(null),d=B.useState({onScrollCapture:yE,onWheelCapture:yE,onTouchMoveCapture:yE}),_=d[0],x=d[1],C=t.forwardProps,s=t.children,k=t.className,z=t.removeScrollBar,V=t.enabled,U=t.shards,$=t.sideCar,se=t.noIsolation,ae=t.inert,H=t.allowPinchZoom,ne=t.as,Y=ne===void 0?"div":ne,te=t.gapMode,de=sj(t,["forwardProps","children","className","removeScrollBar","enabled","shards","sideCar","noIsolation","inert","allowPinchZoom","as","gapMode"]),Me=$,Le=fX([l,r]),lt=Ec(Ec({},de),_);return B.createElement(B.Fragment,null,V&&B.createElement(Me,{sideCar:aj,removeScrollBar:z,shards:U,noIsolation:se,inert:ae,setCallbacks:x,allowPinchZoom:!!H,lockRef:l,gapMode:te}),C?B.cloneElement(B.Children.only(s),Ec(Ec({},lt),{ref:Le})):B.createElement(Y,Ec({},lt,{className:k,ref:Le}),s))});g2.defaultProps={enabled:!0,removeScrollBar:!0,inert:!1};g2.classNames={fullWidth:Nb,zeroRight:Lb};var yX=function(){if(typeof __webpack_nonce__<"u")return __webpack_nonce__};function vX(){if(!document)return null;var t=document.createElement("style");t.type="text/css";var r=yX();return r&&t.setAttribute("nonce",r),t}function xX(t,r){t.styleSheet?t.styleSheet.cssText=r:t.appendChild(document.createTextNode(r))}function bX(t){var r=document.head||document.getElementsByTagName("head")[0];r.appendChild(t)}var wX=function(){var t=0,r=null;return{add:function(l){t==0&&(r=vX())&&(xX(r,l),bX(r)),t++},remove:function(){t--,!t&&r&&(r.parentNode&&r.parentNode.removeChild(r),r=null)}}},SX=function(){var t=wX();return function(r,l){B.useEffect(function(){return t.add(r),function(){t.remove()}},[r&&l])}},lj=function(){var t=SX(),r=function(l){var d=l.styles,_=l.dynamic;return t(d,_),null};return r},TX={left:0,top:0,right:0,gap:0},vE=function(t){return parseInt(t||"",10)||0},EX=function(t){var r=window.getComputedStyle(document.body),l=r[t==="padding"?"paddingLeft":"marginLeft"],d=r[t==="padding"?"paddingTop":"marginTop"],_=r[t==="padding"?"paddingRight":"marginRight"];return[vE(l),vE(d),vE(_)]},CX=function(t){if(t===void 0&&(t="margin"),typeof window>"u")return TX;var r=EX(t),l=document.documentElement.clientWidth,d=window.innerWidth;return{left:r[0],top:r[1],right:r[2],gap:Math.max(0,d-l+r[2]-r[0])}},AX=lj(),yg="data-scroll-locked",IX=function(t,r,l,d){var _=t.left,x=t.top,C=t.right,s=t.gap;return l===void 0&&(l="margin"),`
  .`.concat(cX,` {
   overflow: hidden `).concat(d,`;
   padding-right: `).concat(s,"px ").concat(d,`;
  }
  body[`).concat(yg,`] {
    overflow: hidden `).concat(d,`;
    overscroll-behavior: contain;
    `).concat([r&&"position: relative ".concat(d,";"),l==="margin"&&`
    padding-left: `.concat(_,`px;
    padding-top: `).concat(x,`px;
    padding-right: `).concat(C,`px;
    margin-left:0;
    margin-top:0;
    margin-right: `).concat(s,"px ").concat(d,`;
    `),l==="padding"&&"padding-right: ".concat(s,"px ").concat(d,";")].filter(Boolean).join(""),`
  }
  
  .`).concat(Lb,` {
    right: `).concat(s,"px ").concat(d,`;
  }
  
  .`).concat(Nb,` {
    margin-right: `).concat(s,"px ").concat(d,`;
  }
  
  .`).concat(Lb," .").concat(Lb,` {
    right: 0 `).concat(d,`;
  }
  
  .`).concat(Nb," .").concat(Nb,` {
    margin-right: 0 `).concat(d,`;
  }
  
  body[`).concat(yg,`] {
    `).concat(uX,": ").concat(s,`px;
  }
`)},aN=function(){var t=parseInt(document.body.getAttribute(yg)||"0",10);return isFinite(t)?t:0},PX=function(){B.useEffect(function(){return document.body.setAttribute(yg,(aN()+1).toString()),function(){var t=aN()-1;t<=0?document.body.removeAttribute(yg):document.body.setAttribute(yg,t.toString())}},[])},MX=function(t){var r=t.noRelative,l=t.noImportant,d=t.gapMode,_=d===void 0?"margin":d;PX();var x=B.useMemo(function(){return CX(_)},[_]);return B.createElement(AX,{styles:IX(x,!r,_,l?"":"!important")})},WC=!1;if(typeof window<"u")try{var db=Object.defineProperty({},"passive",{get:function(){return WC=!0,!0}});window.addEventListener("test",db,db),window.removeEventListener("test",db,db)}catch{WC=!1}var $m=WC?{passive:!1}:!1,RX=function(t){return t.tagName==="TEXTAREA"},cj=function(t,r){if(!(t instanceof Element))return!1;var l=window.getComputedStyle(t);return l[r]!=="hidden"&&!(l.overflowY===l.overflowX&&!RX(t)&&l[r]==="visible")},kX=function(t){return cj(t,"overflowY")},DX=function(t){return cj(t,"overflowX")},lN=function(t,r){var l=r.ownerDocument,d=r;do{typeof ShadowRoot<"u"&&d instanceof ShadowRoot&&(d=d.host);var _=uj(t,d);if(_){var x=dj(t,d),C=x[1],s=x[2];if(C>s)return!0}d=d.parentNode}while(d&&d!==l.body);return!1},LX=function(t){var r=t.scrollTop,l=t.scrollHeight,d=t.clientHeight;return[r,l,d]},NX=function(t){var r=t.scrollLeft,l=t.scrollWidth,d=t.clientWidth;return[r,l,d]},uj=function(t,r){return t==="v"?kX(r):DX(r)},dj=function(t,r){return t==="v"?LX(r):NX(r)},zX=function(t,r){return t==="h"&&r==="rtl"?-1:1},OX=function(t,r,l,d,_){var x=zX(t,window.getComputedStyle(r).direction),C=x*d,s=l.target,k=r.contains(s),z=!1,V=C>0,U=0,$=0;do{var se=dj(t,s),ae=se[0],H=se[1],ne=se[2],Y=H-ne-x*ae;(ae||Y)&&uj(t,s)&&(U+=Y,$+=ae),s instanceof ShadowRoot?s=s.host:s=s.parentNode}while(!k&&s!==document.body||k&&(r.contains(s)||r===s));return(V&&(Math.abs(U)<1||!_)||!V&&(Math.abs($)<1||!_))&&(z=!0),z},hb=function(t){return"changedTouches"in t?[t.changedTouches[0].clientX,t.changedTouches[0].clientY]:[0,0]},cN=function(t){return[t.deltaX,t.deltaY]},uN=function(t){return t&&"current"in t?t.current:t},FX=function(t,r){return t[0]===r[0]&&t[1]===r[1]},jX=function(t){return`
  .block-interactivity-`.concat(t,` {pointer-events: none;}
  .allow-interactivity-`).concat(t,` {pointer-events: all;}
`)},BX=0,Gm=[];function VX(t){var r=B.useRef([]),l=B.useRef([0,0]),d=B.useRef(),_=B.useState(BX++)[0],x=B.useState(lj)[0],C=B.useRef(t);B.useEffect(function(){C.current=t},[t]),B.useEffect(function(){if(t.inert){document.body.classList.add("block-interactivity-".concat(_));var H=lX([t.lockRef.current],(t.shards||[]).map(uN),!0).filter(Boolean);return H.forEach(function(ne){return ne.classList.add("allow-interactivity-".concat(_))}),function(){document.body.classList.remove("block-interactivity-".concat(_)),H.forEach(function(ne){return ne.classList.remove("allow-interactivity-".concat(_))})}}},[t.inert,t.lockRef.current,t.shards]);var s=B.useCallback(function(H,ne){if("touches"in H&&H.touches.length===2||H.type==="wheel"&&H.ctrlKey)return!C.current.allowPinchZoom;var Y=hb(H),te=l.current,de="deltaX"in H?H.deltaX:te[0]-Y[0],Me="deltaY"in H?H.deltaY:te[1]-Y[1],Le,lt=H.target,Pe=Math.abs(de)>Math.abs(Me)?"h":"v";if("touches"in H&&Pe==="h"&&lt.type==="range")return!1;var Ye=lN(Pe,lt);if(!Ye)return!0;if(Ye?Le=Pe:(Le=Pe==="v"?"h":"v",Ye=lN(Pe,lt)),!Ye)return!1;if(!d.current&&"changedTouches"in H&&(de||Me)&&(d.current=Le),!Le)return!0;var vt=d.current||Le;return OX(vt,ne,H,vt==="h"?de:Me,!0)},[]),k=B.useCallback(function(H){var ne=H;if(!(!Gm.length||Gm[Gm.length-1]!==x)){var Y="deltaY"in ne?cN(ne):hb(ne),te=r.current.filter(function(Le){return Le.name===ne.type&&(Le.target===ne.target||ne.target===Le.shadowParent)&&FX(Le.delta,Y)})[0];if(te&&te.should){ne.cancelable&&ne.preventDefault();return}if(!te){var de=(C.current.shards||[]).map(uN).filter(Boolean).filter(function(Le){return Le.contains(ne.target)}),Me=de.length>0?s(ne,de[0]):!C.current.noIsolation;Me&&ne.cancelable&&ne.preventDefault()}}},[]),z=B.useCallback(function(H,ne,Y,te){var de={name:H,delta:ne,target:Y,should:te,shadowParent:UX(Y)};r.current.push(de),setTimeout(function(){r.current=r.current.filter(function(Me){return Me!==de})},1)},[]),V=B.useCallback(function(H){l.current=hb(H),d.current=void 0},[]),U=B.useCallback(function(H){z(H.type,cN(H),H.target,s(H,t.lockRef.current))},[]),$=B.useCallback(function(H){z(H.type,hb(H),H.target,s(H,t.lockRef.current))},[]);B.useEffect(function(){return Gm.push(x),t.setCallbacks({onScrollCapture:U,onWheelCapture:U,onTouchMoveCapture:$}),document.addEventListener("wheel",k,$m),document.addEventListener("touchmove",k,$m),document.addEventListener("touchstart",V,$m),function(){Gm=Gm.filter(function(H){return H!==x}),document.removeEventListener("wheel",k,$m),document.removeEventListener("touchmove",k,$m),document.removeEventListener("touchstart",V,$m)}},[]);var se=t.removeScrollBar,ae=t.inert;return B.createElement(B.Fragment,null,ae?B.createElement(x,{styles:jX(_)}):null,se?B.createElement(MX,{gapMode:t.gapMode}):null)}function UX(t){for(var r=null;t!==null;)t instanceof ShadowRoot&&(r=t.host,t=t.host),t=t.parentNode;return r}const $X=_X(aj,VX);var zx=B.forwardRef(function(t,r){return B.createElement(g2,Ec({},t,{ref:r,sideCar:$X}))});zx.classNames=g2.classNames;var kI="Popover",[hj,Yte]=Gl(kI,[xh]),Ox=xh(),[GX,wh]=hj(kI),fj=t=>{const{__scopePopover:r,children:l,open:d,defaultOpen:_,onOpenChange:x,modal:C=!1}=t,s=Ox(r),k=B.useRef(null),[z,V]=B.useState(!1),[U=!1,$]=kc({prop:d,defaultProp:_,onChange:x});return w.jsx(TI,{...s,children:w.jsx(GX,{scope:r,contentId:Ol(),triggerRef:k,open:U,onOpenChange:$,onOpenToggle:B.useCallback(()=>$(se=>!se),[$]),hasCustomAnchor:z,onCustomAnchorAdd:B.useCallback(()=>V(!0),[]),onCustomAnchorRemove:B.useCallback(()=>V(!1),[]),modal:C,children:l})})};fj.displayName=kI;var pj="PopoverAnchor",HX=B.forwardRef((t,r)=>{const{__scopePopover:l,...d}=t,_=wh(pj,l),x=Ox(l),{onCustomAnchorAdd:C,onCustomAnchorRemove:s}=_;return B.useEffect(()=>(C(),()=>s()),[C,s]),w.jsx(Dx,{...x,...d,ref:r})});HX.displayName=pj;var mj="PopoverTrigger",gj=B.forwardRef((t,r)=>{const{__scopePopover:l,...d}=t,_=wh(mj,l),x=Ox(l),C=ni(r,_.triggerRef),s=w.jsx(ir.button,{type:"button","aria-haspopup":"dialog","aria-expanded":_.open,"aria-controls":_.contentId,"data-state":bj(_.open),...d,ref:C,onClick:mn(t.onClick,_.onOpenToggle)});return _.hasCustomAnchor?s:w.jsx(Dx,{asChild:!0,...x,children:s})});gj.displayName=mj;var DI="PopoverPortal",[qX,WX]=hj(DI,{forceMount:void 0}),_j=t=>{const{__scopePopover:r,forceMount:l,children:d,container:_}=t,x=wh(DI,r);return w.jsx(qX,{scope:r,forceMount:l,children:w.jsx(io,{present:l||x.open,children:w.jsx(n_,{asChild:!0,container:_,children:d})})})};_j.displayName=DI;var Hg="PopoverContent",yj=B.forwardRef((t,r)=>{const l=WX(Hg,t.__scopePopover),{forceMount:d=l.forceMount,..._}=t,x=wh(Hg,t.__scopePopover);return w.jsx(io,{present:d||x.open,children:x.modal?w.jsx(ZX,{..._,ref:r}):w.jsx(XX,{..._,ref:r})})});yj.displayName=Hg;var ZX=B.forwardRef((t,r)=>{const l=wh(Hg,t.__scopePopover),d=B.useRef(null),_=ni(r,d),x=B.useRef(!1);return B.useEffect(()=>{const C=d.current;if(C)return m2(C)},[]),w.jsx(zx,{as:Rc,allowPinchZoom:!0,children:w.jsx(vj,{...t,ref:_,trapFocus:l.open,disableOutsidePointerEvents:!0,onCloseAutoFocus:mn(t.onCloseAutoFocus,C=>{var s;C.preventDefault(),x.current||(s=l.triggerRef.current)==null||s.focus()}),onPointerDownOutside:mn(t.onPointerDownOutside,C=>{const s=C.detail.originalEvent,k=s.button===0&&s.ctrlKey===!0,z=s.button===2||k;x.current=z},{checkForDefaultPrevented:!1}),onFocusOutside:mn(t.onFocusOutside,C=>C.preventDefault(),{checkForDefaultPrevented:!1})})})}),XX=B.forwardRef((t,r)=>{const l=wh(Hg,t.__scopePopover),d=B.useRef(!1),_=B.useRef(!1);return w.jsx(vj,{...t,ref:r,trapFocus:!1,disableOutsidePointerEvents:!1,onCloseAutoFocus:x=>{var C,s;(C=t.onCloseAutoFocus)==null||C.call(t,x),x.defaultPrevented||(d.current||(s=l.triggerRef.current)==null||s.focus(),x.preventDefault()),d.current=!1,_.current=!1},onInteractOutside:x=>{var k,z;(k=t.onInteractOutside)==null||k.call(t,x),x.defaultPrevented||(d.current=!0,x.detail.originalEvent.type==="pointerdown"&&(_.current=!0));const C=x.target;((z=l.triggerRef.current)==null?void 0:z.contains(C))&&x.preventDefault(),x.detail.originalEvent.type==="focusin"&&_.current&&x.preventDefault()}})}),vj=B.forwardRef((t,r)=>{const{__scopePopover:l,trapFocus:d,onOpenAutoFocus:_,onCloseAutoFocus:x,disableOutsidePointerEvents:C,onEscapeKeyDown:s,onPointerDownOutside:k,onFocusOutside:z,onInteractOutside:V,...U}=t,$=wh(Hg,l),se=Ox(l);return p2(),w.jsx(Nx,{asChild:!0,loop:!0,trapped:d,onMountAutoFocus:_,onUnmountAutoFocus:x,children:w.jsx(vp,{asChild:!0,disableOutsidePointerEvents:C,onInteractOutside:V,onEscapeKeyDown:s,onPointerDownOutside:k,onFocusOutside:z,onDismiss:()=>$.onOpenChange(!1),children:w.jsx(l2,{"data-state":bj($.open),role:"dialog",id:$.contentId,...se,...U,ref:r,style:{...U.style,"--radix-popover-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-popover-content-available-width":"var(--radix-popper-available-width)","--radix-popover-content-available-height":"var(--radix-popper-available-height)","--radix-popover-trigger-width":"var(--radix-popper-anchor-width)","--radix-popover-trigger-height":"var(--radix-popper-anchor-height)"}})})})}),xj="PopoverClose",YX=B.forwardRef((t,r)=>{const{__scopePopover:l,...d}=t,_=wh(xj,l);return w.jsx(ir.button,{type:"button",...d,ref:r,onClick:mn(t.onClick,()=>_.onOpenChange(!1))})});YX.displayName=xj;var KX="PopoverArrow",QX=B.forwardRef((t,r)=>{const{__scopePopover:l,...d}=t,_=Ox(l);return w.jsx(c2,{..._,...d,ref:r})});QX.displayName=KX;function bj(t){return t?"open":"closed"}var JX=fj,eY=gj,tY=_j,wj=yj;const nY=JX,rY=eY,Sj=B.forwardRef(({className:t,align:r="center",sideOffset:l=4,...d},_)=>w.jsx(tY,{children:w.jsx(wj,{ref:_,align:r,sideOffset:l,className:rr("z-50 w-72 rounded-md border bg-popover p-4 text-popover-foreground shadow-md outline-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",t),...d})}));Sj.displayName=wj.displayName;const iY=({onSearch:t,onFilterChange:r})=>{const l=Hl(),[d,_]=B.useState(""),[x,C]=B.useState(!1),[s,k]=B.useState([]);B.useState(!0);const z=["Decentralized Tech","Social Groups","Volunteer","Professional","Hobby","Support Groups"],V=()=>{t(d)},U=se=>{if(se==="communities"){l("/communities");return}const ae=s.includes(se)?s.filter(H=>H!==se):[...s,se];k(ae),r(ae)},$=["Mission District community events","Castro neighborhood groups","Chinatown volunteer opportunities","Professional networking groups"];return w.jsx("div",{className:"absolute top-6 left-6 z-10 w-96 max-w-[calc(100vw-3rem)]",children:w.jsxs("div",{className:"bg-card/95 backdrop-blur-sm rounded-lg border shadow-lg p-4 space-y-4",children:[w.jsxs("div",{className:"relative",children:[w.jsx(ex,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-muted-foreground"}),w.jsx(g7,{className:"absolute right-12 top-1/2 transform -translate-y-1/2 h-4 w-4 text-primary"}),w.jsx(Mo,{placeholder:"AI Search: Find communities, events...",value:d,onChange:se=>_(se.target.value),onKeyDown:se=>se.key==="Enter"&&V(),className:"pl-10 pr-16 bg-background/50"}),w.jsx(An,{onClick:V,size:"sm",className:"absolute right-2 top-1/2 transform -translate-y-1/2 h-7",children:w.jsx(ex,{className:"h-3 w-3"})})]}),w.jsxs("div",{className:"flex justify-between items-center",children:[w.jsxs(nY,{children:[w.jsx(rY,{asChild:!0,children:w.jsxs(An,{variant:"ghost",size:"sm",className:"text-muted-foreground",children:[w.jsx(LO,{className:"h-4 w-4 mr-1"}),"Search Help"]})}),w.jsx(Sj,{className:"w-80",align:"start",children:w.jsxs("div",{className:"space-y-3",children:[w.jsx("h4",{className:"font-semibold",children:"Search Examples:"}),w.jsx("div",{className:"space-y-1",children:$.map((se,ae)=>w.jsxs("button",{onClick:()=>_(se),className:"block w-full text-left text-sm text-muted-foreground hover:text-foreground hover:bg-muted/50 p-2 rounded",children:['"',se,'"']},ae))})]})})]}),w.jsxs(An,{variant:"ghost",size:"sm",onClick:()=>C(!x),className:"text-muted-foreground",children:[w.jsx(zO,{className:"h-4 w-4 mr-1"}),"Filters"]})]}),x&&w.jsx("div",{className:"space-y-3 border-t pt-4",children:w.jsxs("div",{children:[w.jsx("h5",{className:"text-sm font-medium mb-2",children:"Community Types"}),w.jsx("div",{className:"flex flex-wrap gap-1",children:z.map(se=>w.jsx(wi,{variant:s.includes(se)?"default":"outline",className:"cursor-pointer text-xs",onClick:()=>U(se),children:se},se))})]})}),w.jsxs("div",{className:"flex items-center gap-4 text-xs text-muted-foreground border-t pt-3",children:[w.jsxs("div",{className:"flex items-center gap-1",children:[w.jsx("div",{className:"w-2 h-2 rounded-full bg-communities"}),w.jsx("span",{children:"Communities"})]}),w.jsxs("div",{className:"flex items-center gap-1",children:[w.jsx("div",{className:"w-2 h-2 rounded-full bg-events"}),w.jsx("span",{children:"Events"})]})]})]})})},sY=r_("relative w-full rounded-lg border p-4 [&>svg~*]:pl-7 [&>svg+div]:translate-y-[-3px] [&>svg]:absolute [&>svg]:left-4 [&>svg]:top-4 [&>svg]:text-foreground",{variants:{variant:{default:"bg-background text-foreground",destructive:"border-destructive/50 text-destructive dark:border-destructive [&>svg]:text-destructive"}},defaultVariants:{variant:"default"}}),vg=B.forwardRef(({className:t,variant:r,...l},d)=>w.jsx("div",{ref:d,role:"alert",className:rr(sY({variant:r}),t),...l}));vg.displayName="Alert";const oY=B.forwardRef(({className:t,...r},l)=>w.jsx("h5",{ref:l,className:rr("mb-1 font-medium leading-none tracking-tight",t),...r}));oY.displayName="AlertTitle";const xg=B.forwardRef(({className:t,...r},l)=>w.jsx("div",{ref:l,className:rr("text-sm [&_p]:leading-relaxed",t),...r}));xg.displayName="AlertDescription";const aY=({onLocationFound:t})=>{const[r,l]=B.useState(""),[d,_]=B.useState(!1),[x,C]=B.useState(null),s=[{name:"San Francisco, CA, USA",coords:[-122.4194,37.7749],keywords:["san francisco","sf","san fran"]},{name:"New York, NY, USA",coords:[-74.006,40.7128],keywords:["new york","nyc","new york city"]},{name:"London, England, UK",coords:[-.1276,51.5074],keywords:["london","london uk","london england"]},{name:"Tokyo, Japan",coords:[139.6503,35.6762],keywords:["tokyo","tokyo japan"]},{name:"Paris, France",coords:[2.3522,48.8566],keywords:["paris","paris france"]},{name:"Berlin, Germany",coords:[13.405,52.52],keywords:["berlin","berlin germany","germany"]},{name:"Sydney, Australia",coords:[151.2093,-33.8688],keywords:["sydney","sydney australia","australia"]},{name:"Mumbai, India",coords:[72.8777,19.076],keywords:["mumbai","mumbai india","india"]}],k=$=>{const se=$.toLowerCase().trim();return s.find(ae=>ae.keywords.some(H=>H.includes(se)||se.includes(H)))},z=async()=>{if(!r.trim())return;_(!0),C(null);const $=k(r);if($){console.log(`Found predefined location: ${$.name} at [${$.coords[0]}, ${$.coords[1]}]`),t($.coords,$.name),l(""),_(!1);return}const se="pk.eyJ1IjoianhlbiIsImEiOiJjbTQ0NXB4azUwbDltMmtzZGd3cHBrZ3NnIn0.-2BPKrq0mp2-xFVQNSW7eQ";try{const ae=await fetch(`https://api.mapbox.com/geocoding/v5/mapbox.places/${encodeURIComponent(r)}.json?access_token=${se}&types=country,region,district,place,locality&limit=1`);if(!ae.ok)throw new Error("Failed to search location");const H=await ae.json();if(H.features&&H.features.length>0){const ne=H.features[0],[Y,te]=ne.center,de=ne.place_name;t([Y,te],de),l("")}else C("Location not found. Try searching for a city or country name.")}catch(ae){console.error("Geocoding error:",ae),C("Failed to search location. Please try again.")}finally{_(!1)}},V=$=>{$.key==="Enter"&&z()},U=["San Francisco","New York City","London","Tokyo","Paris","Germany"];return w.jsxs("div",{className:"bg-card/95 backdrop-blur-sm rounded-lg border shadow-lg p-4 space-y-4",children:[w.jsxs("div",{className:"flex items-center gap-2",children:[w.jsx(ro,{className:"h-4 w-4 text-primary"}),w.jsx("h3",{className:"font-medium text-sm",children:"Go to Location"})]}),w.jsxs("div",{className:"relative",children:[w.jsx(ro,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-muted-foreground"}),w.jsx(Mo,{placeholder:"Enter city or country name...",value:r,onChange:$=>l($.target.value),onKeyDown:V,className:"pl-10 pr-16 bg-background/50",disabled:d,"data-testid":"input-location-search"}),w.jsx(An,{onClick:z,size:"sm",className:"absolute right-2 top-1/2 transform -translate-y-1/2 h-7",disabled:d||!r.trim(),"data-testid":"button-search-location",children:d?w.jsx(Jv,{className:"h-3 w-3 animate-spin"}):w.jsx(ex,{className:"h-3 w-3"})})]}),x&&w.jsxs(vg,{className:"py-2",children:[w.jsx(fI,{className:"h-4 w-4"}),w.jsx(xg,{className:"text-xs",children:x})]}),w.jsxs("div",{className:"space-y-2",children:[w.jsx("p",{className:"text-xs text-muted-foreground",children:"Quick examples:"}),w.jsx("div",{className:"flex flex-wrap gap-1",children:U.map($=>w.jsx("button",{onClick:()=>l($),className:"text-xs px-2 py-1 bg-muted/50 hover:bg-muted rounded text-muted-foreground hover:text-foreground transition-colors",disabled:d,"data-testid":`button-example-${$.toLowerCase().replace(/\s+/g,"-")}`,children:$},$))})]})]})},ei=B.forwardRef(({className:t,...r},l)=>w.jsx("div",{ref:l,className:rr("rounded-lg border bg-card text-card-foreground shadow-sm",t),...r}));ei.displayName="Card";const Yi=B.forwardRef(({className:t,...r},l)=>w.jsx("div",{ref:l,className:rr("flex flex-col space-y-1.5 p-6",t),...r}));Yi.displayName="CardHeader";const us=B.forwardRef(({className:t,...r},l)=>w.jsx("h3",{ref:l,className:rr("text-2xl font-semibold leading-none tracking-tight",t),...r}));us.displayName="CardTitle";const Fl=B.forwardRef(({className:t,...r},l)=>w.jsx("p",{ref:l,className:rr("text-sm text-muted-foreground",t),...r}));Fl.displayName="CardDescription";const fi=B.forwardRef(({className:t,...r},l)=>w.jsx("div",{ref:l,className:rr("p-6 pt-0",t),...r}));fi.displayName="CardContent";const lY=B.forwardRef(({className:t,...r},l)=>w.jsx("div",{ref:l,className:rr("flex items-center p-6 pt-0",t),...r}));lY.displayName="CardFooter";var LI="Avatar",[cY,Kte]=Gl(LI),[uY,Tj]=cY(LI),Ej=B.forwardRef((t,r)=>{const{__scopeAvatar:l,...d}=t,[_,x]=B.useState("idle");return w.jsx(uY,{scope:l,imageLoadingStatus:_,onImageLoadingStatusChange:x,children:w.jsx(ir.span,{...d,ref:r})})});Ej.displayName=LI;var Cj="AvatarImage",Aj=B.forwardRef((t,r)=>{const{__scopeAvatar:l,src:d,onLoadingStatusChange:_=()=>{},...x}=t,C=Tj(Cj,l),s=dY(d,x.referrerPolicy),k=os(z=>{_(z),C.onImageLoadingStatusChange(z)});return qs(()=>{s!=="idle"&&k(s)},[s,k]),s==="loaded"?w.jsx(ir.img,{...x,ref:r,src:d}):null});Aj.displayName=Cj;var Ij="AvatarFallback",Pj=B.forwardRef((t,r)=>{const{__scopeAvatar:l,delayMs:d,..._}=t,x=Tj(Ij,l),[C,s]=B.useState(d===void 0);return B.useEffect(()=>{if(d!==void 0){const k=window.setTimeout(()=>s(!0),d);return()=>window.clearTimeout(k)}},[d]),C&&x.imageLoadingStatus!=="loaded"?w.jsx(ir.span,{..._,ref:r}):null});Pj.displayName=Ij;function dY(t,r){const[l,d]=B.useState("idle");return qs(()=>{if(!t){d("error");return}let _=!0;const x=new window.Image,C=s=>()=>{_&&d(s)};return d("loading"),x.onload=C("loaded"),x.onerror=C("error"),x.src=t,r&&(x.referrerPolicy=r),()=>{_=!1}},[t,r]),l}var Mj=Ej,Rj=Aj,kj=Pj;const fo=B.forwardRef(({className:t,...r},l)=>w.jsx(Mj,{ref:l,className:rr("relative flex h-10 w-10 shrink-0 overflow-hidden rounded-full",t),...r}));fo.displayName=Mj.displayName;const Ra=B.forwardRef(({className:t,...r},l)=>w.jsx(Rj,{ref:l,className:rr("aspect-square h-full w-full",t),...r}));Ra.displayName=Rj.displayName;const po=B.forwardRef(({className:t,...r},l)=>w.jsx(kj,{ref:l,className:rr("flex h-full w-full items-center justify-center rounded-full bg-muted",t),...r}));po.displayName=kj.displayName;const hY=({isOpen:t,onClose:r,searchResults:l=[],onCommunityClick:d,selectedRegion:_="global"})=>{const x=Hl(),[C,s]=B.useState("all");B.useState(!0);const{data:k=[],isLoading:z}=Ia({queryKey:["/api/communities"]}),V=["neighborhood","city","state","national","global"],U=V.indexOf(_),se=k.filter(Y=>V.indexOf(Y.maxGeographicScope||"global")<=U).sort((Y,te)=>(te.memberCount||0)-(Y.memberCount||0)).map(Y=>({id:Y.id,type:"community",name:Y.name,type_detail:"Community Group",location:`${Y.category}`,category:Y.category,members:Y.memberCount,image:"/api/placeholder/80/80",meetingTime:"",verified:!0,description:Y.description,maxGeographicScope:Y.maxGeographicScope})),ae=[{id:"3",type:"event",name:"Chinatown Night Market",venue:"Grant Avenue",location:"Chinatown, San Francisco",date:"2024-08-15",time:"6:00 PM - 11:00 PM",price:"Free",image:"/api/placeholder/80/80",organizer:"Chinatown Community Development Center",categories:["Food","Culture","Shopping"]},{id:"6",type:"event",name:"Golden Gate Park Volunteer Day",venue:"Golden Gate Park",location:"Golden Gate Park, San Francisco",date:"2024-08-20",time:"9:00 AM - 2:00 PM",price:"Free",image:"/api/placeholder/80/80",organizer:"SF Parks Alliance",categories:["Volunteer","Environment","Community"]}],H=[...se,...ae],ne=C==="all"?H:H.filter(Y=>C==="communities"?Y.type==="community":C==="events"?Y.type==="event":!0);return t?w.jsx("div",{className:"fixed top-0 right-0 h-full w-96 max-w-[calc(100vw-2rem)] bg-card/95 backdrop-blur-sm border-l shadow-xl z-20 overflow-hidden",children:w.jsxs("div",{className:"flex flex-col h-full",children:[w.jsxs("div",{className:"p-4 border-b",children:[w.jsxs("div",{className:"flex items-center justify-between mb-3",children:[w.jsxs("div",{className:"flex items-center gap-2",children:[w.jsx("h2",{className:"text-lg font-semibold",children:"Communities"}),w.jsx(wi,{variant:"secondary",className:"capitalize",children:_})]}),w.jsx(An,{variant:"ghost",size:"sm",onClick:r,children:w.jsx(vh,{className:"h-4 w-4"})})]}),w.jsx("div",{className:"flex gap-1",children:[{id:"all",label:"All",count:H.length},{id:"communities",label:"Communities",count:H.filter(Y=>Y.type==="community").length},{id:"events",label:"Events",count:H.filter(Y=>Y.type==="event").length}].map(Y=>w.jsxs(An,{variant:C===Y.id?"default":"ghost",size:"sm",onClick:()=>s(Y.id),className:"flex items-center gap-1 text-xs",children:[Y.label,w.jsx(wi,{variant:"secondary",className:"text-xs px-1 py-0 h-4",children:Y.count})]},Y.id))})]}),w.jsx("div",{className:"flex-1 overflow-y-auto p-4 space-y-4",children:ne.map(Y=>w.jsx(ei,{className:"hover:shadow-md transition-shadow",children:w.jsxs(fi,{className:"p-4",children:[Y.type==="community"&&w.jsxs("div",{className:"space-y-3",children:[w.jsxs("div",{className:"flex items-start gap-3",children:[w.jsxs(fo,{className:"h-12 w-12",children:[w.jsx(Ra,{src:Y.image}),w.jsx(po,{className:"bg-communities/20 text-communities",children:w.jsx(ho,{className:"h-5 w-5"})})]}),w.jsxs("div",{className:"flex-1 min-w-0",children:[w.jsx("h3",{className:"font-semibold",children:Y.name}),w.jsx("p",{className:"text-sm font-medium text-communities",children:Y.type_detail}),w.jsxs("div",{className:"flex items-center gap-1 text-sm text-muted-foreground",children:[w.jsx(ro,{className:"h-3 w-3"}),Y.location]}),w.jsxs("div",{className:"flex items-center gap-1 text-sm",children:[w.jsx(ho,{className:"h-3 w-3"}),Y.members?Y.members.toLocaleString()+" members":"Community Group"]}),Y.meetingTime&&w.jsxs("p",{className:"text-xs text-muted-foreground",children:["Meets: ",Y.meetingTime]})]})]}),w.jsx("div",{className:"flex flex-wrap gap-1",children:w.jsx(wi,{variant:"outline",className:"text-xs",children:Y.category})}),w.jsx("p",{className:"text-sm text-muted-foreground",children:Y.description}),w.jsxs("div",{className:"flex gap-2",children:[w.jsxs(An,{size:"sm",className:"flex-1",onClick:()=>{var de;const te=new URLSearchParams({id:Y.id,name:Y.name,type:Y.type_detail,location:Y.location,category:Y.category,members:((de=Y.members)==null?void 0:de.toString())||"0",description:Y.description||""});x(`/community-chat?${te.toString()}`)},"data-testid":`button-join-community-${Y.id}`,children:[w.jsx(h7,{className:"h-3 w-3 mr-1"}),"Join Community"]}),w.jsx(An,{variant:"outline",size:"sm",children:w.jsx(wC,{className:"h-3 w-3"})})]})]}),Y.type==="event"&&w.jsxs("div",{className:"space-y-3",children:[w.jsxs("div",{className:"flex items-start gap-3",children:[w.jsxs(fo,{className:"h-12 w-12 rounded-lg",children:[w.jsx(Ra,{src:Y.image}),w.jsx(po,{className:"bg-events/20 text-events rounded-lg",children:w.jsx(vu,{className:"h-5 w-5"})})]}),w.jsxs("div",{className:"flex-1 min-w-0",children:[w.jsx("h3",{className:"font-semibold",children:Y.name}),w.jsx("p",{className:"text-sm text-muted-foreground",children:Y.venue}),w.jsxs("div",{className:"flex items-center gap-1 text-sm text-muted-foreground",children:[w.jsx(ro,{className:"h-3 w-3"}),Y.location]}),w.jsxs("div",{className:"text-sm",children:[Y.date?new Date(Y.date).toLocaleDateString():"TBA"," • ",Y.time||"TBA"]}),w.jsx("div",{className:"text-sm font-medium text-events",children:Y.price||"See event details"})]})]}),w.jsx("div",{className:"flex flex-wrap gap-1",children:(Y.categories||["Community Event"]).map(te=>w.jsx(wi,{variant:"outline",className:"text-xs",children:te},te))}),w.jsxs("div",{className:"flex gap-2",children:[w.jsxs(An,{size:"sm",className:"flex-1",children:[w.jsx(wC,{className:"h-3 w-3 mr-1"}),"Get Tickets"]}),w.jsx(An,{variant:"outline",size:"sm",children:w.jsx(vu,{className:"h-3 w-3"})})]})]})]})},Y.id))})]})}):null};function ZC(t,[r,l]){return Math.min(l,Math.max(r,t))}var fY=B.createContext(void 0);function Fx(t){const r=B.useContext(fY);return t||r||"ltr"}function Dj(t){const r=B.useRef({value:t,previous:t});return B.useMemo(()=>(r.current.value!==t&&(r.current.previous=r.current.value,r.current.value=t),r.current.previous),[t])}var pY=[" ","Enter","ArrowUp","ArrowDown"],mY=[" ","Enter"],jx="Select",[_2,y2,gY]=e2(jx),[d_,Qte]=Gl(jx,[gY,xh]),v2=xh(),[_Y,Sh]=d_(jx),[yY,vY]=d_(jx),Lj=t=>{const{__scopeSelect:r,children:l,open:d,defaultOpen:_,onOpenChange:x,value:C,defaultValue:s,onValueChange:k,dir:z,name:V,autoComplete:U,disabled:$,required:se,form:ae}=t,H=v2(r),[ne,Y]=B.useState(null),[te,de]=B.useState(null),[Me,Le]=B.useState(!1),lt=Fx(z),[Pe=!1,Ye]=kc({prop:d,defaultProp:_,onChange:x}),[vt,It]=kc({prop:C,defaultProp:s,onChange:k}),Ut=B.useRef(null),Pt=ne?ae||!!ne.closest("form"):!0,[$t,Ve]=B.useState(new Set),jt=Array.from($t).map(Je=>Je.props.value).join(";");return w.jsx(TI,{...H,children:w.jsxs(_Y,{required:se,scope:r,trigger:ne,onTriggerChange:Y,valueNode:te,onValueNodeChange:de,valueNodeHasChildren:Me,onValueNodeHasChildrenChange:Le,contentId:Ol(),value:vt,onValueChange:It,open:Pe,onOpenChange:Ye,dir:lt,triggerPointerDownPosRef:Ut,disabled:$,children:[w.jsx(_2.Provider,{scope:r,children:w.jsx(yY,{scope:t.__scopeSelect,onNativeOptionAdd:B.useCallback(Je=>{Ve(mt=>new Set(mt).add(Je))},[]),onNativeOptionRemove:B.useCallback(Je=>{Ve(mt=>{const Be=new Set(mt);return Be.delete(Je),Be})},[]),children:l})}),Pt?w.jsxs(s4,{"aria-hidden":!0,required:se,tabIndex:-1,name:V,autoComplete:U,value:vt,onChange:Je=>It(Je.target.value),disabled:$,form:ae,children:[vt===void 0?w.jsx("option",{value:""}):null,Array.from($t)]},jt):null]})})};Lj.displayName=jx;var Nj="SelectTrigger",zj=B.forwardRef((t,r)=>{const{__scopeSelect:l,disabled:d=!1,..._}=t,x=v2(l),C=Sh(Nj,l),s=C.disabled||d,k=ni(r,C.onTriggerChange),z=y2(l),V=B.useRef("touch"),[U,$,se]=o4(H=>{const ne=z().filter(de=>!de.disabled),Y=ne.find(de=>de.value===C.value),te=a4(ne,H,Y);te!==void 0&&C.onValueChange(te.value)}),ae=H=>{s||(C.onOpenChange(!0),se()),H&&(C.triggerPointerDownPosRef.current={x:Math.round(H.pageX),y:Math.round(H.pageY)})};return w.jsx(Dx,{asChild:!0,...x,children:w.jsx(ir.button,{type:"button",role:"combobox","aria-controls":C.contentId,"aria-expanded":C.open,"aria-required":C.required,"aria-autocomplete":"none",dir:C.dir,"data-state":C.open?"open":"closed",disabled:s,"data-disabled":s?"":void 0,"data-placeholder":i4(C.value)?"":void 0,..._,ref:k,onClick:mn(_.onClick,H=>{H.currentTarget.focus(),V.current!=="mouse"&&ae(H)}),onPointerDown:mn(_.onPointerDown,H=>{V.current=H.pointerType;const ne=H.target;ne.hasPointerCapture(H.pointerId)&&ne.releasePointerCapture(H.pointerId),H.button===0&&H.ctrlKey===!1&&H.pointerType==="mouse"&&(ae(H),H.preventDefault())}),onKeyDown:mn(_.onKeyDown,H=>{const ne=U.current!=="";!(H.ctrlKey||H.altKey||H.metaKey)&&H.key.length===1&&$(H.key),!(ne&&H.key===" ")&&pY.includes(H.key)&&(ae(),H.preventDefault())})})})});zj.displayName=Nj;var Oj="SelectValue",Fj=B.forwardRef((t,r)=>{const{__scopeSelect:l,className:d,style:_,children:x,placeholder:C="",...s}=t,k=Sh(Oj,l),{onValueNodeHasChildrenChange:z}=k,V=x!==void 0,U=ni(r,k.onValueNodeChange);return qs(()=>{z(V)},[z,V]),w.jsx(ir.span,{...s,ref:U,style:{pointerEvents:"none"},children:i4(k.value)?w.jsx(w.Fragment,{children:C}):x})});Fj.displayName=Oj;var xY="SelectIcon",jj=B.forwardRef((t,r)=>{const{__scopeSelect:l,children:d,..._}=t;return w.jsx(ir.span,{"aria-hidden":!0,..._,ref:r,children:d||"▼"})});jj.displayName=xY;var bY="SelectPortal",Bj=t=>w.jsx(n_,{asChild:!0,...t});Bj.displayName=bY;var ap="SelectContent",Vj=B.forwardRef((t,r)=>{const l=Sh(ap,t.__scopeSelect),[d,_]=B.useState();if(qs(()=>{_(new DocumentFragment)},[]),!l.open){const x=d;return x?_p.createPortal(w.jsx(Uj,{scope:t.__scopeSelect,children:w.jsx(_2.Slot,{scope:t.__scopeSelect,children:w.jsx("div",{children:t.children})})}),x):null}return w.jsx($j,{...t,ref:r})});Vj.displayName=ap;var Tl=10,[Uj,Th]=d_(ap),wY="SelectContentImpl",$j=B.forwardRef((t,r)=>{const{__scopeSelect:l,position:d="item-aligned",onCloseAutoFocus:_,onEscapeKeyDown:x,onPointerDownOutside:C,side:s,sideOffset:k,align:z,alignOffset:V,arrowPadding:U,collisionBoundary:$,collisionPadding:se,sticky:ae,hideWhenDetached:H,avoidCollisions:ne,...Y}=t,te=Sh(ap,l),[de,Me]=B.useState(null),[Le,lt]=B.useState(null),Pe=ni(r,an=>Me(an)),[Ye,vt]=B.useState(null),[It,Ut]=B.useState(null),Pt=y2(l),[$t,Ve]=B.useState(!1),jt=B.useRef(!1);B.useEffect(()=>{if(de)return m2(de)},[de]),p2();const Je=B.useCallback(an=>{const[or,...Mn]=Pt().map(xr=>xr.ref.current),[Mr]=Mn.slice(-1),Lr=document.activeElement;for(const xr of an)if(xr===Lr||(xr==null||xr.scrollIntoView({block:"nearest"}),xr===or&&Le&&(Le.scrollTop=0),xr===Mr&&Le&&(Le.scrollTop=Le.scrollHeight),xr==null||xr.focus(),document.activeElement!==Lr))return},[Pt,Le]),mt=B.useCallback(()=>Je([Ye,de]),[Je,Ye,de]);B.useEffect(()=>{$t&&mt()},[$t,mt]);const{onOpenChange:Be,triggerPointerDownPosRef:ft}=te;B.useEffect(()=>{if(de){let an={x:0,y:0};const or=Mr=>{var Lr,xr;an={x:Math.abs(Math.round(Mr.pageX)-(((Lr=ft.current)==null?void 0:Lr.x)??0)),y:Math.abs(Math.round(Mr.pageY)-(((xr=ft.current)==null?void 0:xr.y)??0))}},Mn=Mr=>{an.x<=10&&an.y<=10?Mr.preventDefault():de.contains(Mr.target)||Be(!1),document.removeEventListener("pointermove",or),ft.current=null};return ft.current!==null&&(document.addEventListener("pointermove",or),document.addEventListener("pointerup",Mn,{capture:!0,once:!0})),()=>{document.removeEventListener("pointermove",or),document.removeEventListener("pointerup",Mn,{capture:!0})}}},[de,Be,ft]),B.useEffect(()=>{const an=()=>Be(!1);return window.addEventListener("blur",an),window.addEventListener("resize",an),()=>{window.removeEventListener("blur",an),window.removeEventListener("resize",an)}},[Be]);const[Ct,Zt]=o4(an=>{const or=Pt().filter(Lr=>!Lr.disabled),Mn=or.find(Lr=>Lr.ref.current===document.activeElement),Mr=a4(or,an,Mn);Mr&&setTimeout(()=>Mr.ref.current.focus())}),fn=B.useCallback((an,or,Mn)=>{const Mr=!jt.current&&!Mn;(te.value!==void 0&&te.value===or||Mr)&&(vt(an),Mr&&(jt.current=!0))},[te.value]),Qn=B.useCallback(()=>de==null?void 0:de.focus(),[de]),$n=B.useCallback((an,or,Mn)=>{const Mr=!jt.current&&!Mn;(te.value!==void 0&&te.value===or||Mr)&&Ut(an)},[te.value]),Hn=d==="popper"?XC:Gj,rn=Hn===XC?{side:s,sideOffset:k,align:z,alignOffset:V,arrowPadding:U,collisionBoundary:$,collisionPadding:se,sticky:ae,hideWhenDetached:H,avoidCollisions:ne}:{};return w.jsx(Uj,{scope:l,content:de,viewport:Le,onViewportChange:lt,itemRefCallback:fn,selectedItem:Ye,onItemLeave:Qn,itemTextRefCallback:$n,focusSelectedItem:mt,selectedItemText:It,position:d,isPositioned:$t,searchRef:Ct,children:w.jsx(zx,{as:Rc,allowPinchZoom:!0,children:w.jsx(Nx,{asChild:!0,trapped:te.open,onMountAutoFocus:an=>{an.preventDefault()},onUnmountAutoFocus:mn(_,an=>{var or;(or=te.trigger)==null||or.focus({preventScroll:!0}),an.preventDefault()}),children:w.jsx(vp,{asChild:!0,disableOutsidePointerEvents:!0,onEscapeKeyDown:x,onPointerDownOutside:C,onFocusOutside:an=>an.preventDefault(),onDismiss:()=>te.onOpenChange(!1),children:w.jsx(Hn,{role:"listbox",id:te.contentId,"data-state":te.open?"open":"closed",dir:te.dir,onContextMenu:an=>an.preventDefault(),...Y,...rn,onPlaced:()=>Ve(!0),ref:Pe,style:{display:"flex",flexDirection:"column",outline:"none",...Y.style},onKeyDown:mn(Y.onKeyDown,an=>{const or=an.ctrlKey||an.altKey||an.metaKey;if(an.key==="Tab"&&an.preventDefault(),!or&&an.key.length===1&&Zt(an.key),["ArrowUp","ArrowDown","Home","End"].includes(an.key)){let Mr=Pt().filter(Lr=>!Lr.disabled).map(Lr=>Lr.ref.current);if(["ArrowUp","End"].includes(an.key)&&(Mr=Mr.slice().reverse()),["ArrowUp","ArrowDown"].includes(an.key)){const Lr=an.target,xr=Mr.indexOf(Lr);Mr=Mr.slice(xr+1)}setTimeout(()=>Je(Mr)),an.preventDefault()}})})})})})})});$j.displayName=wY;var SY="SelectItemAlignedPosition",Gj=B.forwardRef((t,r)=>{const{__scopeSelect:l,onPlaced:d,..._}=t,x=Sh(ap,l),C=Th(ap,l),[s,k]=B.useState(null),[z,V]=B.useState(null),U=ni(r,Pe=>V(Pe)),$=y2(l),se=B.useRef(!1),ae=B.useRef(!0),{viewport:H,selectedItem:ne,selectedItemText:Y,focusSelectedItem:te}=C,de=B.useCallback(()=>{if(x.trigger&&x.valueNode&&s&&z&&H&&ne&&Y){const Pe=x.trigger.getBoundingClientRect(),Ye=z.getBoundingClientRect(),vt=x.valueNode.getBoundingClientRect(),It=Y.getBoundingClientRect();if(x.dir!=="rtl"){const Lr=It.left-Ye.left,xr=vt.left-Lr,Tr=Pe.left-xr,Ki=Pe.width+Tr,Cs=Math.max(Ki,Ye.width),Ri=window.innerWidth-Tl,Ws=ZC(xr,[Tl,Math.max(Tl,Ri-Cs)]);s.style.minWidth=Ki+"px",s.style.left=Ws+"px"}else{const Lr=Ye.right-It.right,xr=window.innerWidth-vt.right-Lr,Tr=window.innerWidth-Pe.right-xr,Ki=Pe.width+Tr,Cs=Math.max(Ki,Ye.width),Ri=window.innerWidth-Tl,Ws=ZC(xr,[Tl,Math.max(Tl,Ri-Cs)]);s.style.minWidth=Ki+"px",s.style.right=Ws+"px"}const Ut=$(),Pt=window.innerHeight-Tl*2,$t=H.scrollHeight,Ve=window.getComputedStyle(z),jt=parseInt(Ve.borderTopWidth,10),Je=parseInt(Ve.paddingTop,10),mt=parseInt(Ve.borderBottomWidth,10),Be=parseInt(Ve.paddingBottom,10),ft=jt+Je+$t+Be+mt,Ct=Math.min(ne.offsetHeight*5,ft),Zt=window.getComputedStyle(H),fn=parseInt(Zt.paddingTop,10),Qn=parseInt(Zt.paddingBottom,10),$n=Pe.top+Pe.height/2-Tl,Hn=Pt-$n,rn=ne.offsetHeight/2,an=ne.offsetTop+rn,or=jt+Je+an,Mn=ft-or;if(or<=$n){const Lr=Ut.length>0&&ne===Ut[Ut.length-1].ref.current;s.style.bottom="0px";const xr=z.clientHeight-H.offsetTop-H.offsetHeight,Tr=Math.max(Hn,rn+(Lr?Qn:0)+xr+mt),Ki=or+Tr;s.style.height=Ki+"px"}else{const Lr=Ut.length>0&&ne===Ut[0].ref.current;s.style.top="0px";const Tr=Math.max($n,jt+H.offsetTop+(Lr?fn:0)+rn)+Mn;s.style.height=Tr+"px",H.scrollTop=or-$n+H.offsetTop}s.style.margin=`${Tl}px 0`,s.style.minHeight=Ct+"px",s.style.maxHeight=Pt+"px",d==null||d(),requestAnimationFrame(()=>se.current=!0)}},[$,x.trigger,x.valueNode,s,z,H,ne,Y,x.dir,d]);qs(()=>de(),[de]);const[Me,Le]=B.useState();qs(()=>{z&&Le(window.getComputedStyle(z).zIndex)},[z]);const lt=B.useCallback(Pe=>{Pe&&ae.current===!0&&(de(),te==null||te(),ae.current=!1)},[de,te]);return w.jsx(EY,{scope:l,contentWrapper:s,shouldExpandOnScrollRef:se,onScrollButtonChange:lt,children:w.jsx("div",{ref:k,style:{display:"flex",flexDirection:"column",position:"fixed",zIndex:Me},children:w.jsx(ir.div,{..._,ref:U,style:{boxSizing:"border-box",maxHeight:"100%",..._.style}})})})});Gj.displayName=SY;var TY="SelectPopperPosition",XC=B.forwardRef((t,r)=>{const{__scopeSelect:l,align:d="start",collisionPadding:_=Tl,...x}=t,C=v2(l);return w.jsx(l2,{...C,...x,ref:r,align:d,collisionPadding:_,style:{boxSizing:"border-box",...x.style,"--radix-select-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-select-content-available-width":"var(--radix-popper-available-width)","--radix-select-content-available-height":"var(--radix-popper-available-height)","--radix-select-trigger-width":"var(--radix-popper-anchor-width)","--radix-select-trigger-height":"var(--radix-popper-anchor-height)"}})});XC.displayName=TY;var[EY,NI]=d_(ap,{}),YC="SelectViewport",Hj=B.forwardRef((t,r)=>{const{__scopeSelect:l,nonce:d,..._}=t,x=Th(YC,l),C=NI(YC,l),s=ni(r,x.onViewportChange),k=B.useRef(0);return w.jsxs(w.Fragment,{children:[w.jsx("style",{dangerouslySetInnerHTML:{__html:"[data-radix-select-viewport]{scrollbar-width:none;-ms-overflow-style:none;-webkit-overflow-scrolling:touch;}[data-radix-select-viewport]::-webkit-scrollbar{display:none}"},nonce:d}),w.jsx(_2.Slot,{scope:l,children:w.jsx(ir.div,{"data-radix-select-viewport":"",role:"presentation",..._,ref:s,style:{position:"relative",flex:1,overflow:"hidden auto",..._.style},onScroll:mn(_.onScroll,z=>{const V=z.currentTarget,{contentWrapper:U,shouldExpandOnScrollRef:$}=C;if($!=null&&$.current&&U){const se=Math.abs(k.current-V.scrollTop);if(se>0){const ae=window.innerHeight-Tl*2,H=parseFloat(U.style.minHeight),ne=parseFloat(U.style.height),Y=Math.max(H,ne);if(Y<ae){const te=Y+se,de=Math.min(ae,te),Me=te-de;U.style.height=de+"px",U.style.bottom==="0px"&&(V.scrollTop=Me>0?Me:0,U.style.justifyContent="flex-end")}}}k.current=V.scrollTop})})})]})});Hj.displayName=YC;var qj="SelectGroup",[CY,AY]=d_(qj),IY=B.forwardRef((t,r)=>{const{__scopeSelect:l,...d}=t,_=Ol();return w.jsx(CY,{scope:l,id:_,children:w.jsx(ir.div,{role:"group","aria-labelledby":_,...d,ref:r})})});IY.displayName=qj;var Wj="SelectLabel",Zj=B.forwardRef((t,r)=>{const{__scopeSelect:l,...d}=t,_=AY(Wj,l);return w.jsx(ir.div,{id:_.id,...d,ref:r})});Zj.displayName=Wj;var _w="SelectItem",[PY,Xj]=d_(_w),Yj=B.forwardRef((t,r)=>{const{__scopeSelect:l,value:d,disabled:_=!1,textValue:x,...C}=t,s=Sh(_w,l),k=Th(_w,l),z=s.value===d,[V,U]=B.useState(x??""),[$,se]=B.useState(!1),ae=ni(r,te=>{var de;return(de=k.itemRefCallback)==null?void 0:de.call(k,te,d,_)}),H=Ol(),ne=B.useRef("touch"),Y=()=>{_||(s.onValueChange(d),s.onOpenChange(!1))};if(d==="")throw new Error("A <Select.Item /> must have a value prop that is not an empty string. This is because the Select value can be set to an empty string to clear the selection and show the placeholder.");return w.jsx(PY,{scope:l,value:d,disabled:_,textId:H,isSelected:z,onItemTextChange:B.useCallback(te=>{U(de=>de||((te==null?void 0:te.textContent)??"").trim())},[]),children:w.jsx(_2.ItemSlot,{scope:l,value:d,disabled:_,textValue:V,children:w.jsx(ir.div,{role:"option","aria-labelledby":H,"data-highlighted":$?"":void 0,"aria-selected":z&&$,"data-state":z?"checked":"unchecked","aria-disabled":_||void 0,"data-disabled":_?"":void 0,tabIndex:_?void 0:-1,...C,ref:ae,onFocus:mn(C.onFocus,()=>se(!0)),onBlur:mn(C.onBlur,()=>se(!1)),onClick:mn(C.onClick,()=>{ne.current!=="mouse"&&Y()}),onPointerUp:mn(C.onPointerUp,()=>{ne.current==="mouse"&&Y()}),onPointerDown:mn(C.onPointerDown,te=>{ne.current=te.pointerType}),onPointerMove:mn(C.onPointerMove,te=>{var de;ne.current=te.pointerType,_?(de=k.onItemLeave)==null||de.call(k):ne.current==="mouse"&&te.currentTarget.focus({preventScroll:!0})}),onPointerLeave:mn(C.onPointerLeave,te=>{var de;te.currentTarget===document.activeElement&&((de=k.onItemLeave)==null||de.call(k))}),onKeyDown:mn(C.onKeyDown,te=>{var Me;((Me=k.searchRef)==null?void 0:Me.current)!==""&&te.key===" "||(mY.includes(te.key)&&Y(),te.key===" "&&te.preventDefault())})})})})});Yj.displayName=_w;var yv="SelectItemText",Kj=B.forwardRef((t,r)=>{const{__scopeSelect:l,className:d,style:_,...x}=t,C=Sh(yv,l),s=Th(yv,l),k=Xj(yv,l),z=vY(yv,l),[V,U]=B.useState(null),$=ni(r,Y=>U(Y),k.onItemTextChange,Y=>{var te;return(te=s.itemTextRefCallback)==null?void 0:te.call(s,Y,k.value,k.disabled)}),se=V==null?void 0:V.textContent,ae=B.useMemo(()=>w.jsx("option",{value:k.value,disabled:k.disabled,children:se},k.value),[k.disabled,k.value,se]),{onNativeOptionAdd:H,onNativeOptionRemove:ne}=z;return qs(()=>(H(ae),()=>ne(ae)),[H,ne,ae]),w.jsxs(w.Fragment,{children:[w.jsx(ir.span,{id:k.textId,...x,ref:$}),k.isSelected&&C.valueNode&&!C.valueNodeHasChildren?_p.createPortal(x.children,C.valueNode):null]})});Kj.displayName=yv;var Qj="SelectItemIndicator",Jj=B.forwardRef((t,r)=>{const{__scopeSelect:l,...d}=t;return Xj(Qj,l).isSelected?w.jsx(ir.span,{"aria-hidden":!0,...d,ref:r}):null});Jj.displayName=Qj;var KC="SelectScrollUpButton",e4=B.forwardRef((t,r)=>{const l=Th(KC,t.__scopeSelect),d=NI(KC,t.__scopeSelect),[_,x]=B.useState(!1),C=ni(r,d.onScrollButtonChange);return qs(()=>{if(l.viewport&&l.isPositioned){let s=function(){const z=k.scrollTop>0;x(z)};const k=l.viewport;return s(),k.addEventListener("scroll",s),()=>k.removeEventListener("scroll",s)}},[l.viewport,l.isPositioned]),_?w.jsx(n4,{...t,ref:C,onAutoScroll:()=>{const{viewport:s,selectedItem:k}=l;s&&k&&(s.scrollTop=s.scrollTop-k.offsetHeight)}}):null});e4.displayName=KC;var QC="SelectScrollDownButton",t4=B.forwardRef((t,r)=>{const l=Th(QC,t.__scopeSelect),d=NI(QC,t.__scopeSelect),[_,x]=B.useState(!1),C=ni(r,d.onScrollButtonChange);return qs(()=>{if(l.viewport&&l.isPositioned){let s=function(){const z=k.scrollHeight-k.clientHeight,V=Math.ceil(k.scrollTop)<z;x(V)};const k=l.viewport;return s(),k.addEventListener("scroll",s),()=>k.removeEventListener("scroll",s)}},[l.viewport,l.isPositioned]),_?w.jsx(n4,{...t,ref:C,onAutoScroll:()=>{const{viewport:s,selectedItem:k}=l;s&&k&&(s.scrollTop=s.scrollTop+k.offsetHeight)}}):null});t4.displayName=QC;var n4=B.forwardRef((t,r)=>{const{__scopeSelect:l,onAutoScroll:d,..._}=t,x=Th("SelectScrollButton",l),C=B.useRef(null),s=y2(l),k=B.useCallback(()=>{C.current!==null&&(window.clearInterval(C.current),C.current=null)},[]);return B.useEffect(()=>()=>k(),[k]),qs(()=>{var V;const z=s().find(U=>U.ref.current===document.activeElement);(V=z==null?void 0:z.ref.current)==null||V.scrollIntoView({block:"nearest"})},[s]),w.jsx(ir.div,{"aria-hidden":!0,..._,ref:r,style:{flexShrink:0,..._.style},onPointerDown:mn(_.onPointerDown,()=>{C.current===null&&(C.current=window.setInterval(d,50))}),onPointerMove:mn(_.onPointerMove,()=>{var z;(z=x.onItemLeave)==null||z.call(x),C.current===null&&(C.current=window.setInterval(d,50))}),onPointerLeave:mn(_.onPointerLeave,()=>{k()})})}),MY="SelectSeparator",r4=B.forwardRef((t,r)=>{const{__scopeSelect:l,...d}=t;return w.jsx(ir.div,{"aria-hidden":!0,...d,ref:r})});r4.displayName=MY;var JC="SelectArrow",RY=B.forwardRef((t,r)=>{const{__scopeSelect:l,...d}=t,_=v2(l),x=Sh(JC,l),C=Th(JC,l);return x.open&&C.position==="popper"?w.jsx(c2,{..._,...d,ref:r}):null});RY.displayName=JC;function i4(t){return t===""||t===void 0}var s4=B.forwardRef((t,r)=>{const{value:l,...d}=t,_=B.useRef(null),x=ni(r,_),C=Dj(l);return B.useEffect(()=>{const s=_.current,k=window.HTMLSelectElement.prototype,V=Object.getOwnPropertyDescriptor(k,"value").set;if(C!==l&&V){const U=new Event("change",{bubbles:!0});V.call(s,l),s.dispatchEvent(U)}},[C,l]),w.jsx(Rx,{asChild:!0,children:w.jsx("select",{...d,ref:x,defaultValue:l})})});s4.displayName="BubbleSelect";function o4(t){const r=os(t),l=B.useRef(""),d=B.useRef(0),_=B.useCallback(C=>{const s=l.current+C;r(s),function k(z){l.current=z,window.clearTimeout(d.current),z!==""&&(d.current=window.setTimeout(()=>k(""),1e3))}(s)},[r]),x=B.useCallback(()=>{l.current="",window.clearTimeout(d.current)},[]);return B.useEffect(()=>()=>window.clearTimeout(d.current),[]),[l,_,x]}function a4(t,r,l){const _=r.length>1&&Array.from(r).every(z=>z===r[0])?r[0]:r,x=l?t.indexOf(l):-1;let C=kY(t,Math.max(x,0));_.length===1&&(C=C.filter(z=>z!==l));const k=C.find(z=>z.textValue.toLowerCase().startsWith(_.toLowerCase()));return k!==l?k:void 0}function kY(t,r){return t.map((l,d)=>t[(r+d)%t.length])}var DY=Lj,l4=zj,LY=Fj,NY=jj,zY=Bj,c4=Vj,OY=Hj,u4=Zj,d4=Yj,FY=Kj,jY=Jj,h4=e4,f4=t4,p4=r4;const qg=DY,Wg=LY,lp=B.forwardRef(({className:t,children:r,...l},d)=>w.jsxs(l4,{ref:d,className:rr("flex h-10 w-full items-center justify-between rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 [&>span]:line-clamp-1",t),...l,children:[r,w.jsx(NY,{asChild:!0,children:w.jsx(DO,{className:"h-4 w-4 opacity-50"})})]}));lp.displayName=l4.displayName;const m4=B.forwardRef(({className:t,...r},l)=>w.jsx(h4,{ref:l,className:rr("flex cursor-default items-center justify-center py-1",t),...r,children:w.jsx(o7,{className:"h-4 w-4"})}));m4.displayName=h4.displayName;const g4=B.forwardRef(({className:t,...r},l)=>w.jsx(f4,{ref:l,className:rr("flex cursor-default items-center justify-center py-1",t),...r,children:w.jsx(DO,{className:"h-4 w-4"})}));g4.displayName=f4.displayName;const cp=B.forwardRef(({className:t,children:r,position:l="popper",...d},_)=>w.jsx(zY,{children:w.jsxs(c4,{ref:_,className:rr("relative z-50 max-h-96 min-w-[8rem] overflow-hidden rounded-md border bg-popover text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",l==="popper"&&"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1",t),position:l,...d,children:[w.jsx(m4,{}),w.jsx(OY,{className:rr("p-1",l==="popper"&&"h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)]"),children:r}),w.jsx(g4,{})]})}));cp.displayName=c4.displayName;const BY=B.forwardRef(({className:t,...r},l)=>w.jsx(u4,{ref:l,className:rr("py-1.5 pl-8 pr-2 text-sm font-semibold",t),...r}));BY.displayName=u4.displayName;const zi=B.forwardRef(({className:t,children:r,...l},d)=>w.jsxs(d4,{ref:d,className:rr("relative flex w-full cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",t),...l,children:[w.jsx("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:w.jsx(jY,{children:w.jsx(hI,{className:"h-4 w-4"})})}),w.jsx(FY,{children:r})]}));zi.displayName=d4.displayName;const VY=B.forwardRef(({className:t,...r},l)=>w.jsx(p4,{ref:l,className:rr("-mx-1 my-1 h-px bg-muted",t),...r}));VY.displayName=p4.displayName;function UY(t,r){return B.useReducer((l,d)=>r[l][d]??l,t)}var zI="ScrollArea",[_4,Jte]=Gl(zI),[$Y,el]=_4(zI),y4=B.forwardRef((t,r)=>{const{__scopeScrollArea:l,type:d="hover",dir:_,scrollHideDelay:x=600,...C}=t,[s,k]=B.useState(null),[z,V]=B.useState(null),[U,$]=B.useState(null),[se,ae]=B.useState(null),[H,ne]=B.useState(null),[Y,te]=B.useState(0),[de,Me]=B.useState(0),[Le,lt]=B.useState(!1),[Pe,Ye]=B.useState(!1),vt=ni(r,Ut=>k(Ut)),It=Fx(_);return w.jsx($Y,{scope:l,type:d,dir:It,scrollHideDelay:x,scrollArea:s,viewport:z,onViewportChange:V,content:U,onContentChange:$,scrollbarX:se,onScrollbarXChange:ae,scrollbarXEnabled:Le,onScrollbarXEnabledChange:lt,scrollbarY:H,onScrollbarYChange:ne,scrollbarYEnabled:Pe,onScrollbarYEnabledChange:Ye,onCornerWidthChange:te,onCornerHeightChange:Me,children:w.jsx(ir.div,{dir:It,...C,ref:vt,style:{position:"relative","--radix-scroll-area-corner-width":Y+"px","--radix-scroll-area-corner-height":de+"px",...t.style}})})});y4.displayName=zI;var v4="ScrollAreaViewport",x4=B.forwardRef((t,r)=>{const{__scopeScrollArea:l,children:d,asChild:_,nonce:x,...C}=t,s=el(v4,l),k=B.useRef(null),z=ni(r,k,s.onViewportChange);return w.jsxs(w.Fragment,{children:[w.jsx("style",{dangerouslySetInnerHTML:{__html:`
[data-radix-scroll-area-viewport] {
  scrollbar-width: none;
  -ms-overflow-style: none;
  -webkit-overflow-scrolling: touch;
}
[data-radix-scroll-area-viewport]::-webkit-scrollbar {
  display: none;
}
:where([data-radix-scroll-area-viewport]) {
  display: flex;
  flex-direction: column;
  align-items: stretch;
}
:where([data-radix-scroll-area-content]) {
  flex-grow: 1;
}
`},nonce:x}),w.jsx(ir.div,{"data-radix-scroll-area-viewport":"",...C,asChild:_,ref:z,style:{overflowX:s.scrollbarXEnabled?"scroll":"hidden",overflowY:s.scrollbarYEnabled?"scroll":"hidden",...t.style},children:JY({asChild:_,children:d},V=>w.jsx("div",{"data-radix-scroll-area-content":"",ref:s.onContentChange,style:{minWidth:s.scrollbarXEnabled?"fit-content":void 0},children:V}))})]})});x4.displayName=v4;var Oc="ScrollAreaScrollbar",OI=B.forwardRef((t,r)=>{const{forceMount:l,...d}=t,_=el(Oc,t.__scopeScrollArea),{onScrollbarXEnabledChange:x,onScrollbarYEnabledChange:C}=_,s=t.orientation==="horizontal";return B.useEffect(()=>(s?x(!0):C(!0),()=>{s?x(!1):C(!1)}),[s,x,C]),_.type==="hover"?w.jsx(GY,{...d,ref:r,forceMount:l}):_.type==="scroll"?w.jsx(HY,{...d,ref:r,forceMount:l}):_.type==="auto"?w.jsx(b4,{...d,ref:r,forceMount:l}):_.type==="always"?w.jsx(FI,{...d,ref:r}):null});OI.displayName=Oc;var GY=B.forwardRef((t,r)=>{const{forceMount:l,...d}=t,_=el(Oc,t.__scopeScrollArea),[x,C]=B.useState(!1);return B.useEffect(()=>{const s=_.scrollArea;let k=0;if(s){const z=()=>{window.clearTimeout(k),C(!0)},V=()=>{k=window.setTimeout(()=>C(!1),_.scrollHideDelay)};return s.addEventListener("pointerenter",z),s.addEventListener("pointerleave",V),()=>{window.clearTimeout(k),s.removeEventListener("pointerenter",z),s.removeEventListener("pointerleave",V)}}},[_.scrollArea,_.scrollHideDelay]),w.jsx(io,{present:l||x,children:w.jsx(b4,{"data-state":x?"visible":"hidden",...d,ref:r})})}),HY=B.forwardRef((t,r)=>{const{forceMount:l,...d}=t,_=el(Oc,t.__scopeScrollArea),x=t.orientation==="horizontal",C=b2(()=>k("SCROLL_END"),100),[s,k]=UY("hidden",{hidden:{SCROLL:"scrolling"},scrolling:{SCROLL_END:"idle",POINTER_ENTER:"interacting"},interacting:{SCROLL:"interacting",POINTER_LEAVE:"idle"},idle:{HIDE:"hidden",SCROLL:"scrolling",POINTER_ENTER:"interacting"}});return B.useEffect(()=>{if(s==="idle"){const z=window.setTimeout(()=>k("HIDE"),_.scrollHideDelay);return()=>window.clearTimeout(z)}},[s,_.scrollHideDelay,k]),B.useEffect(()=>{const z=_.viewport,V=x?"scrollLeft":"scrollTop";if(z){let U=z[V];const $=()=>{const se=z[V];U!==se&&(k("SCROLL"),C()),U=se};return z.addEventListener("scroll",$),()=>z.removeEventListener("scroll",$)}},[_.viewport,x,k,C]),w.jsx(io,{present:l||s!=="hidden",children:w.jsx(FI,{"data-state":s==="hidden"?"hidden":"visible",...d,ref:r,onPointerEnter:mn(t.onPointerEnter,()=>k("POINTER_ENTER")),onPointerLeave:mn(t.onPointerLeave,()=>k("POINTER_LEAVE"))})})}),b4=B.forwardRef((t,r)=>{const l=el(Oc,t.__scopeScrollArea),{forceMount:d,..._}=t,[x,C]=B.useState(!1),s=t.orientation==="horizontal",k=b2(()=>{if(l.viewport){const z=l.viewport.offsetWidth<l.viewport.scrollWidth,V=l.viewport.offsetHeight<l.viewport.scrollHeight;C(s?z:V)}},10);return Zg(l.viewport,k),Zg(l.content,k),w.jsx(io,{present:d||x,children:w.jsx(FI,{"data-state":x?"visible":"hidden",..._,ref:r})})}),FI=B.forwardRef((t,r)=>{const{orientation:l="vertical",...d}=t,_=el(Oc,t.__scopeScrollArea),x=B.useRef(null),C=B.useRef(0),[s,k]=B.useState({content:0,viewport:0,scrollbar:{size:0,paddingStart:0,paddingEnd:0}}),z=C4(s.viewport,s.content),V={...d,sizes:s,onSizesChange:k,hasThumb:z>0&&z<1,onThumbChange:$=>x.current=$,onThumbPointerUp:()=>C.current=0,onThumbPointerDown:$=>C.current=$};function U($,se){return KY($,C.current,s,se)}return l==="horizontal"?w.jsx(qY,{...V,ref:r,onThumbPositionChange:()=>{if(_.viewport&&x.current){const $=_.viewport.scrollLeft,se=dN($,s,_.dir);x.current.style.transform=`translate3d(${se}px, 0, 0)`}},onWheelScroll:$=>{_.viewport&&(_.viewport.scrollLeft=$)},onDragScroll:$=>{_.viewport&&(_.viewport.scrollLeft=U($,_.dir))}}):l==="vertical"?w.jsx(WY,{...V,ref:r,onThumbPositionChange:()=>{if(_.viewport&&x.current){const $=_.viewport.scrollTop,se=dN($,s);x.current.style.transform=`translate3d(0, ${se}px, 0)`}},onWheelScroll:$=>{_.viewport&&(_.viewport.scrollTop=$)},onDragScroll:$=>{_.viewport&&(_.viewport.scrollTop=U($))}}):null}),qY=B.forwardRef((t,r)=>{const{sizes:l,onSizesChange:d,..._}=t,x=el(Oc,t.__scopeScrollArea),[C,s]=B.useState(),k=B.useRef(null),z=ni(r,k,x.onScrollbarXChange);return B.useEffect(()=>{k.current&&s(getComputedStyle(k.current))},[k]),w.jsx(S4,{"data-orientation":"horizontal",..._,ref:z,sizes:l,style:{bottom:0,left:x.dir==="rtl"?"var(--radix-scroll-area-corner-width)":0,right:x.dir==="ltr"?"var(--radix-scroll-area-corner-width)":0,"--radix-scroll-area-thumb-width":x2(l)+"px",...t.style},onThumbPointerDown:V=>t.onThumbPointerDown(V.x),onDragScroll:V=>t.onDragScroll(V.x),onWheelScroll:(V,U)=>{if(x.viewport){const $=x.viewport.scrollLeft+V.deltaX;t.onWheelScroll($),I4($,U)&&V.preventDefault()}},onResize:()=>{k.current&&x.viewport&&C&&d({content:x.viewport.scrollWidth,viewport:x.viewport.offsetWidth,scrollbar:{size:k.current.clientWidth,paddingStart:vw(C.paddingLeft),paddingEnd:vw(C.paddingRight)}})}})}),WY=B.forwardRef((t,r)=>{const{sizes:l,onSizesChange:d,..._}=t,x=el(Oc,t.__scopeScrollArea),[C,s]=B.useState(),k=B.useRef(null),z=ni(r,k,x.onScrollbarYChange);return B.useEffect(()=>{k.current&&s(getComputedStyle(k.current))},[k]),w.jsx(S4,{"data-orientation":"vertical",..._,ref:z,sizes:l,style:{top:0,right:x.dir==="ltr"?0:void 0,left:x.dir==="rtl"?0:void 0,bottom:"var(--radix-scroll-area-corner-height)","--radix-scroll-area-thumb-height":x2(l)+"px",...t.style},onThumbPointerDown:V=>t.onThumbPointerDown(V.y),onDragScroll:V=>t.onDragScroll(V.y),onWheelScroll:(V,U)=>{if(x.viewport){const $=x.viewport.scrollTop+V.deltaY;t.onWheelScroll($),I4($,U)&&V.preventDefault()}},onResize:()=>{k.current&&x.viewport&&C&&d({content:x.viewport.scrollHeight,viewport:x.viewport.offsetHeight,scrollbar:{size:k.current.clientHeight,paddingStart:vw(C.paddingTop),paddingEnd:vw(C.paddingBottom)}})}})}),[ZY,w4]=_4(Oc),S4=B.forwardRef((t,r)=>{const{__scopeScrollArea:l,sizes:d,hasThumb:_,onThumbChange:x,onThumbPointerUp:C,onThumbPointerDown:s,onThumbPositionChange:k,onDragScroll:z,onWheelScroll:V,onResize:U,...$}=t,se=el(Oc,l),[ae,H]=B.useState(null),ne=ni(r,vt=>H(vt)),Y=B.useRef(null),te=B.useRef(""),de=se.viewport,Me=d.content-d.viewport,Le=os(V),lt=os(k),Pe=b2(U,10);function Ye(vt){if(Y.current){const It=vt.clientX-Y.current.left,Ut=vt.clientY-Y.current.top;z({x:It,y:Ut})}}return B.useEffect(()=>{const vt=It=>{const Ut=It.target;(ae==null?void 0:ae.contains(Ut))&&Le(It,Me)};return document.addEventListener("wheel",vt,{passive:!1}),()=>document.removeEventListener("wheel",vt,{passive:!1})},[de,ae,Me,Le]),B.useEffect(lt,[d,lt]),Zg(ae,Pe),Zg(se.content,Pe),w.jsx(ZY,{scope:l,scrollbar:ae,hasThumb:_,onThumbChange:os(x),onThumbPointerUp:os(C),onThumbPositionChange:lt,onThumbPointerDown:os(s),children:w.jsx(ir.div,{...$,ref:ne,style:{position:"absolute",...$.style},onPointerDown:mn(t.onPointerDown,vt=>{vt.button===0&&(vt.target.setPointerCapture(vt.pointerId),Y.current=ae.getBoundingClientRect(),te.current=document.body.style.webkitUserSelect,document.body.style.webkitUserSelect="none",se.viewport&&(se.viewport.style.scrollBehavior="auto"),Ye(vt))}),onPointerMove:mn(t.onPointerMove,Ye),onPointerUp:mn(t.onPointerUp,vt=>{const It=vt.target;It.hasPointerCapture(vt.pointerId)&&It.releasePointerCapture(vt.pointerId),document.body.style.webkitUserSelect=te.current,se.viewport&&(se.viewport.style.scrollBehavior=""),Y.current=null})})})}),yw="ScrollAreaThumb",T4=B.forwardRef((t,r)=>{const{forceMount:l,...d}=t,_=w4(yw,t.__scopeScrollArea);return w.jsx(io,{present:l||_.hasThumb,children:w.jsx(XY,{ref:r,...d})})}),XY=B.forwardRef((t,r)=>{const{__scopeScrollArea:l,style:d,..._}=t,x=el(yw,l),C=w4(yw,l),{onThumbPositionChange:s}=C,k=ni(r,U=>C.onThumbChange(U)),z=B.useRef(),V=b2(()=>{z.current&&(z.current(),z.current=void 0)},100);return B.useEffect(()=>{const U=x.viewport;if(U){const $=()=>{if(V(),!z.current){const se=QY(U,s);z.current=se,s()}};return s(),U.addEventListener("scroll",$),()=>U.removeEventListener("scroll",$)}},[x.viewport,V,s]),w.jsx(ir.div,{"data-state":C.hasThumb?"visible":"hidden",..._,ref:k,style:{width:"var(--radix-scroll-area-thumb-width)",height:"var(--radix-scroll-area-thumb-height)",...d},onPointerDownCapture:mn(t.onPointerDownCapture,U=>{const se=U.target.getBoundingClientRect(),ae=U.clientX-se.left,H=U.clientY-se.top;C.onThumbPointerDown({x:ae,y:H})}),onPointerUp:mn(t.onPointerUp,C.onThumbPointerUp)})});T4.displayName=yw;var jI="ScrollAreaCorner",E4=B.forwardRef((t,r)=>{const l=el(jI,t.__scopeScrollArea),d=!!(l.scrollbarX&&l.scrollbarY);return l.type!=="scroll"&&d?w.jsx(YY,{...t,ref:r}):null});E4.displayName=jI;var YY=B.forwardRef((t,r)=>{const{__scopeScrollArea:l,...d}=t,_=el(jI,l),[x,C]=B.useState(0),[s,k]=B.useState(0),z=!!(x&&s);return Zg(_.scrollbarX,()=>{var U;const V=((U=_.scrollbarX)==null?void 0:U.offsetHeight)||0;_.onCornerHeightChange(V),k(V)}),Zg(_.scrollbarY,()=>{var U;const V=((U=_.scrollbarY)==null?void 0:U.offsetWidth)||0;_.onCornerWidthChange(V),C(V)}),z?w.jsx(ir.div,{...d,ref:r,style:{width:x,height:s,position:"absolute",right:_.dir==="ltr"?0:void 0,left:_.dir==="rtl"?0:void 0,bottom:0,...t.style}}):null});function vw(t){return t?parseInt(t,10):0}function C4(t,r){const l=t/r;return isNaN(l)?0:l}function x2(t){const r=C4(t.viewport,t.content),l=t.scrollbar.paddingStart+t.scrollbar.paddingEnd,d=(t.scrollbar.size-l)*r;return Math.max(d,18)}function KY(t,r,l,d="ltr"){const _=x2(l),x=_/2,C=r||x,s=_-C,k=l.scrollbar.paddingStart+C,z=l.scrollbar.size-l.scrollbar.paddingEnd-s,V=l.content-l.viewport,U=d==="ltr"?[0,V]:[V*-1,0];return A4([k,z],U)(t)}function dN(t,r,l="ltr"){const d=x2(r),_=r.scrollbar.paddingStart+r.scrollbar.paddingEnd,x=r.scrollbar.size-_,C=r.content-r.viewport,s=x-d,k=l==="ltr"?[0,C]:[C*-1,0],z=ZC(t,k);return A4([0,C],[0,s])(z)}function A4(t,r){return l=>{if(t[0]===t[1]||r[0]===r[1])return r[0];const d=(r[1]-r[0])/(t[1]-t[0]);return r[0]+d*(l-t[0])}}function I4(t,r){return t>0&&t<r}var QY=(t,r=()=>{})=>{let l={left:t.scrollLeft,top:t.scrollTop},d=0;return function _(){const x={left:t.scrollLeft,top:t.scrollTop},C=l.left!==x.left,s=l.top!==x.top;(C||s)&&r(),l=x,d=window.requestAnimationFrame(_)}(),()=>window.cancelAnimationFrame(d)};function b2(t,r){const l=os(t),d=B.useRef(0);return B.useEffect(()=>()=>window.clearTimeout(d.current),[]),B.useCallback(()=>{window.clearTimeout(d.current),d.current=window.setTimeout(l,r)},[l,r])}function Zg(t,r){const l=os(r);qs(()=>{let d=0;if(t){const _=new ResizeObserver(()=>{cancelAnimationFrame(d),d=window.requestAnimationFrame(l)});return _.observe(t),()=>{window.cancelAnimationFrame(d),_.unobserve(t)}}},[t,l])}function JY(t,r){const{asChild:l,children:d}=t;if(!l)return typeof r=="function"?r(d):r;const _=B.Children.only(d);return B.cloneElement(_,{children:typeof r=="function"?r(_.props.children):r})}var P4=y4,eK=x4,tK=E4;const up=B.forwardRef(({className:t,children:r,...l},d)=>w.jsxs(P4,{ref:d,className:rr("relative overflow-hidden",t),...l,children:[w.jsx(eK,{className:"h-full w-full rounded-[inherit]",children:r}),w.jsx(M4,{}),w.jsx(tK,{})]}));up.displayName=P4.displayName;const M4=B.forwardRef(({className:t,orientation:r="vertical",...l},d)=>w.jsx(OI,{ref:d,orientation:r,className:rr("flex touch-none select-none transition-colors",r==="vertical"&&"h-full w-2.5 border-l border-l-transparent p-[1px]",r==="horizontal"&&"h-2.5 flex-col border-t border-t-transparent p-[1px]",t),...l,children:w.jsx(T4,{className:"relative flex-1 rounded-full bg-border"})}));M4.displayName=OI.displayName;var nK="Separator",hN="horizontal",rK=["horizontal","vertical"],R4=B.forwardRef((t,r)=>{const{decorative:l,orientation:d=hN,..._}=t,x=iK(d)?d:hN,s=l?{role:"none"}:{"aria-orientation":x==="vertical"?x:void 0,role:"separator"};return w.jsx(ir.div,{"data-orientation":x,...s,..._,ref:r})});R4.displayName=nK;function iK(t){return rK.includes(t)}var k4=R4;const eA=B.forwardRef(({className:t,orientation:r="horizontal",decorative:l=!0,...d},_)=>w.jsx(k4,{ref:_,decorative:l,orientation:r,className:rr("shrink-0 bg-border",r==="horizontal"?"h-[1px] w-full":"h-full w-[1px]",t),...d}));eA.displayName=k4.displayName;const sK=({threads:t,activeThread:r,onThreadChange:l})=>w.jsx("div",{className:"flex-1 p-2 space-y-1",children:t.map(d=>{const _=d.icon;return w.jsx(An,{variant:r===d.id?"secondary":"ghost",className:"w-full justify-start h-auto p-3",onClick:()=>l(d.id),children:w.jsxs("div",{className:"flex items-center gap-3 w-full",children:[w.jsx(_,{className:"h-4 w-4 text-muted-foreground"}),w.jsx("div",{className:"flex-1 text-left",children:w.jsx("div",{className:"font-medium text-sm",children:d.label})}),w.jsx(wi,{variant:"outline",className:"text-xs h-5 px-2",children:d.count})]})},d.id)})}),oK={twitter:VO,instagram:FO,linkedin:jO,facebook:NO,youtube:UO,tiktok:null};function fN({profiles:t,size:r="md"}){if(!t||t.length===0)return null;const l=r==="sm"?"h-3 w-3":"h-4 w-4";return w.jsx("div",{className:"flex flex-wrap gap-1",children:t.map(d=>{const _=oK[d.platform],x=d.profileUrl||"#";return w.jsxs(An,{variant:"outline",size:"sm",className:r==="sm"?"h-7 px-2":"h-8 px-3",onClick:()=>x!=="#"&&window.open(x,"_blank"),title:`${d.displayName||d.username||""} on ${d.platform}`,"data-testid":`social-link-${d.platform}`,children:[_&&w.jsx(_,{className:l}),!_&&w.jsx("span",{className:"text-xs font-medium uppercase",children:d.platform[0]}),r==="md"&&d.username&&w.jsx("span",{className:"ml-1 text-xs",children:d.username})]},d.platform)})})}const BI=({communityId:t,communityName:r,currentUserId:l,currentUserName:d,onOpenDM:_,onClose:x})=>{var $t;const[C,s]=B.useState("global"),[k,z]=B.useState(""),[V,U]=B.useState("content"),$=B.useRef(null),se=[{id:"intro",label:"Introductions",icon:b7,count:3},{id:"content",label:"General Discussion",icon:c7,count:2},{id:"faq",label:"FAQ & Help",icon:LO,count:3}],{data:ae}=Ia({queryKey:["/api/communities",t],queryFn:async()=>{const Ve=await fetch(`/api/communities/${t}`);if(!Ve.ok)throw new Error("Failed to fetch community");return Ve.json()}}),{data:H}=Ia({queryKey:["/api/users",ae==null?void 0:ae.createdBy],queryFn:async()=>{if(!(ae!=null&&ae.createdBy))throw new Error("No creator ID");const Ve=await fetch(`/api/users/${ae.createdBy}`);if(!Ve.ok)throw new Error("Failed to fetch creator");return Ve.json()},enabled:!!(ae!=null&&ae.createdBy)}),{data:ne=[],isLoading:Y,refetch:te}=Ia({queryKey:["/api/chat",t,C,V],queryFn:async()=>{const Ve=await fetch(`/api/chat/${t}?region=${C}&thread=${V}`);if(!Ve.ok)throw new Error("Failed to fetch chat messages");return Ve.json()},refetchInterval:3e3}),{data:de=[]}=Ia({queryKey:["/api/chat",t,"active-members"],queryFn:async()=>{const Ve=await fetch(`/api/chat/${t}/active-members?limit=10`);if(!Ve.ok)throw new Error("Failed to fetch active members");return Ve.json()},refetchInterval:1e4}),Le=(()=>{const Ve=(ae==null?void 0:ae.maxGeographicScope)||"global",jt=["neighborhood","city","state","national","global"],Je=jt.indexOf(Ve),mt=["global"];for(let Be=0;Be<=Je;Be++)jt[Be]!=="global"&&mt.push(jt[Be]);return mt})(),lt=dh({mutationFn:async Ve=>{const jt=await fetch("/api/chat",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(Ve)});if(!jt.ok)throw new Error("Failed to send message");return jt.json()},onSuccess:()=>{Pu.invalidateQueries({queryKey:["/api/chat",t,C,V]}),Pu.invalidateQueries({queryKey:["/api/chat",t,"active-members"]}),z("")}});B.useEffect(()=>{var Ve;(Ve=$.current)==null||Ve.scrollIntoView({behavior:"smooth"})},[ne]);const Pe=Ve=>{switch(Ve){case"neighborhood":return w.jsx(OO,{className:"h-4 w-4"});case"city":return w.jsx(kO,{className:"h-4 w-4"});case"state":return w.jsx(BO,{className:"h-4 w-4"});case"national":return w.jsx(pI,{className:"h-4 w-4"});case"global":return w.jsx(tp,{className:"h-4 w-4"});default:return w.jsx(Pc,{className:"h-4 w-4"})}},Ye=Ve=>{switch(Ve){case"neighborhood":return"bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-300";case"city":return"bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-300";case"state":return"bg-purple-100 text-purple-800 dark:bg-purple-900 dark:text-purple-300";case"national":return"bg-orange-100 text-orange-800 dark:bg-orange-900 dark:text-orange-300";case"global":return"bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-300";default:return"bg-gray-100 text-gray-800 dark:bg-gray-900 dark:text-gray-300"}},vt=()=>{if(!k.trim()||lt.isPending)return;const Ve={communityId:t,region:C,thread:V,content:k,authorId:l,authorName:d,messageType:"text"};lt.mutate(Ve)},It=Ve=>{Ve.key==="Enter"&&!Ve.shiftKey&&(Ve.preventDefault(),vt())},Ut=Ve=>new Date(Ve).toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit",hour12:!1}),Pt=(Ve,jt)=>{Ve!==l&&_&&_(Ve,jt)};return w.jsxs("div",{className:"fixed inset-0 bg-background z-30 flex flex-col",children:[x&&w.jsx("div",{className:"border-b bg-card/95 backdrop-blur-sm",children:w.jsxs("div",{className:"flex items-center justify-between p-4",children:[w.jsxs("div",{className:"flex items-center gap-3",children:[w.jsx(An,{variant:"ghost",size:"sm",onClick:x,"data-testid":"button-close-chat",children:w.jsx(r2,{className:"h-4 w-4"})}),w.jsx(fo,{className:"h-10 w-10",children:w.jsx(po,{className:"bg-communities/20 text-communities",children:w.jsx(ho,{className:"h-5 w-5"})})}),w.jsxs("div",{children:[w.jsx("h2",{className:"font-semibold",children:r}),w.jsx("p",{className:"text-sm text-muted-foreground",children:"Regional Community Chat"})]})]}),w.jsx(An,{variant:"ghost",size:"sm",children:w.jsx(f7,{className:"h-4 w-4"})})]})}),w.jsxs("div",{className:"flex-1 grid grid-cols-1 lg:grid-cols-5 gap-6 p-6",children:[w.jsx("div",{className:"lg:col-span-1",children:w.jsxs(ei,{className:"h-full",children:[w.jsx(Yi,{className:"pb-3",children:w.jsx(us,{className:"text-sm",children:"About"})}),w.jsxs(fi,{className:"px-4 pb-4",children:[w.jsx("p",{className:"text-sm text-muted-foreground mb-4",children:(ae==null?void 0:ae.description)||"Community description"}),w.jsxs("div",{className:"space-y-3",children:[w.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[w.jsx(ro,{className:"h-4 w-4 text-muted-foreground"}),w.jsx("span",{className:"text-muted-foreground capitalize",children:(ae==null?void 0:ae.maxGeographicScope)||"Global"})]}),w.jsxs("div",{className:"text-sm",children:[w.jsx("span",{className:"font-medium",children:"Category"}),w.jsx("br",{}),w.jsx("span",{className:"text-muted-foreground",children:(ae==null?void 0:ae.category)||"Community"})]}),H&&w.jsxs(w.Fragment,{children:[w.jsx(eA,{}),w.jsxs("div",{className:"space-y-2",children:[w.jsx("p",{className:"text-xs font-medium text-muted-foreground",children:"Created By"}),w.jsxs("div",{className:"flex items-center gap-2",children:[w.jsxs(fo,{className:"h-8 w-8",children:[w.jsx(Ra,{src:H.profilePicture,alt:H.name}),w.jsx(po,{children:H.name.substring(0,2).toUpperCase()})]}),w.jsxs("div",{className:"flex-1 min-w-0",children:[w.jsx("p",{className:"text-sm font-medium truncate",children:H.name}),H.socialProfiles&&H.socialProfiles.length>0&&w.jsx("div",{className:"mt-1",children:w.jsx(fN,{profiles:H.socialProfiles,size:"sm"})})]})]})]})]})]})]}),w.jsx(eA,{}),w.jsx(sK,{threads:se,activeThread:V,onThreadChange:U})]})}),w.jsx("div",{className:"lg:col-span-3",children:w.jsxs(ei,{className:"h-full flex flex-col",children:[w.jsx(Yi,{className:"pb-3",children:w.jsxs("div",{className:"flex items-center justify-between",children:[w.jsxs("div",{className:"flex items-center gap-3",children:[w.jsx(us,{className:"text-lg",children:r}),w.jsxs(wi,{variant:"outline",className:`${Ye(C)}`,"data-testid":"badge-current-region",children:[Pe(C),w.jsxs("span",{className:"ml-1 capitalize",children:[C," Chat"]})]})]}),w.jsxs(qg,{value:C,onValueChange:Ve=>s(Ve),children:[w.jsx(lp,{className:"w-48","data-testid":"select-chat-region",children:w.jsx(Wg,{})}),w.jsxs(cp,{children:[Le.includes("global")&&w.jsx(zi,{value:"global",children:"🌍 Global Chat"}),Le.includes("national")&&w.jsx(zi,{value:"national",children:"🏛️ National Chat"}),Le.includes("state")&&w.jsx(zi,{value:"state",children:"🗺️ State Chat"}),Le.includes("city")&&w.jsx(zi,{value:"city",children:"🏢 City Chat"}),Le.includes("neighborhood")&&w.jsx(zi,{value:"neighborhood",children:"🏠 Neighborhood Chat"})]})]})]})}),w.jsxs(fi,{className:"flex-1 flex flex-col p-0",children:[w.jsx(up,{className:"flex-1 px-4",children:w.jsxs("div",{className:"space-y-4 py-4",children:[Y?w.jsxs("div",{className:"text-center py-12","data-testid":"text-loading-messages",children:[w.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary mx-auto mb-4"}),w.jsx("p",{className:"text-muted-foreground",children:"Loading messages..."})]}):ne.length===0?w.jsxs("div",{className:"text-center py-12","data-testid":"text-no-messages",children:[w.jsx(Pc,{className:"h-12 w-12 text-muted-foreground mx-auto mb-4"}),w.jsx("h3",{className:"text-lg font-semibold mb-2",children:"No messages yet"}),w.jsxs("p",{className:"text-muted-foreground",children:["Be the first to start a conversation in the ",C," chat!"]})]}):ne.map(Ve=>w.jsxs("div",{className:"flex gap-3","data-testid":`message-${Ve.id}`,children:[w.jsxs(fo,{className:"h-8 w-8 cursor-pointer hover:ring-2 hover:ring-primary",onClick:()=>Pt(Ve.authorId,Ve.authorName),"data-testid":`avatar-${Ve.authorId}`,children:[w.jsx(Ra,{src:Ve.authorAvatar}),w.jsx(po,{className:"text-xs",children:Ve.authorName.substring(0,2).toUpperCase()})]}),w.jsxs("div",{className:"flex-1 min-w-0",children:[w.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[w.jsx("span",{className:"font-semibold text-sm cursor-pointer hover:underline",onClick:()=>Pt(Ve.authorId,Ve.authorName),"data-testid":`name-${Ve.authorId}`,children:Ve.authorName}),w.jsx("span",{className:"text-xs text-muted-foreground",children:Ut(Ve.createdAt)}),Ve.authorLocation&&w.jsxs(wi,{variant:"outline",className:"text-xs",children:["📍 ",Ve.authorLocation.name]})]}),w.jsx("p",{className:"text-sm text-foreground leading-relaxed",children:Ve.content}),Ve.reactions.length>0&&w.jsx("div",{className:"flex gap-1 mt-2",children:Ve.reactions.map((jt,Je)=>w.jsxs(An,{variant:"ghost",size:"sm",className:"h-6 px-2 text-xs","data-testid":`reaction-${jt.emoji}-${Ve.id}`,children:[jt.emoji," 1"]},Je))})]})]},Ve.id)),w.jsx("div",{ref:$})]})}),w.jsx("div",{className:"p-4 border-t",children:w.jsxs("div",{className:"flex gap-2",children:[w.jsx(Mo,{value:k,onChange:Ve=>z(Ve.target.value),onKeyPress:It,placeholder:`Message ${(($t=se.find(Ve=>Ve.id===V))==null?void 0:$t.label)||"chat"}...`,className:"flex-1","data-testid":"input-chat-message"}),w.jsx(An,{onClick:vt,disabled:!k.trim()||lt.isPending,"data-testid":"button-send-message",children:w.jsx(i2,{className:"h-4 w-4"})})]})})]})]})}),w.jsx("div",{className:"lg:col-span-1",children:w.jsxs(ei,{className:"h-full",children:[w.jsx(Yi,{className:"pb-3",children:w.jsxs(us,{className:"text-sm flex items-center gap-2",children:[w.jsx(ho,{className:"h-4 w-4"}),"Most Active Members (",de.length,")"]})}),w.jsx(fi,{className:"p-0",children:w.jsx(up,{className:"h-[500px]",children:w.jsx("div",{className:"space-y-1 p-4",children:de.length===0?w.jsxs("div",{className:"text-center py-8 text-muted-foreground text-sm","data-testid":"text-no-members",children:[w.jsx(ho,{className:"h-8 w-8 mx-auto mb-2 opacity-50"}),w.jsx("p",{children:"No active members yet"}),w.jsx("p",{className:"text-xs mt-1",children:"Be the first to chat!"})]}):de.map((Ve,jt)=>{var Je,mt;return w.jsxs("div",{className:"p-2 rounded-lg hover:bg-muted transition-colors","data-testid":`user-${Ve.userId}`,children:[w.jsxs("div",{className:"flex items-center gap-3 cursor-pointer",onClick:()=>Pt(Ve.userId,Ve.userName),children:[w.jsxs("div",{className:"relative",children:[w.jsxs(fo,{className:"h-8 w-8",children:[((Je=Ve.user)==null?void 0:Je.profilePicture)&&w.jsx(Ra,{src:Ve.user.profilePicture,alt:Ve.userName}),w.jsx(po,{className:"text-xs",children:Ve.userName.substring(0,2).toUpperCase()})]}),jt<3&&w.jsx("div",{className:"absolute -top-1 -right-1 bg-yellow-500 text-white text-[10px] rounded-full w-4 h-4 flex items-center justify-center font-bold",children:jt+1})]}),w.jsxs("div",{className:"flex-1 min-w-0",children:[w.jsx("p",{className:"text-sm font-medium truncate",children:Ve.userName}),w.jsxs("p",{className:"text-xs text-muted-foreground",children:[Ve.messageCount," message",Ve.messageCount!==1?"s":""]})]}),Ve.userId!==l&&w.jsx(An,{variant:"ghost",size:"sm",className:"h-6 w-6 p-0",onClick:Be=>{Be.stopPropagation(),Pt(Ve.userId,Ve.userName)},"data-testid":`button-dm-${Ve.userId}`,children:w.jsx(Pc,{className:"h-3 w-3"})})]}),((mt=Ve.user)==null?void 0:mt.socialProfiles)&&Ve.user.socialProfiles.length>0&&w.jsx("div",{className:"mt-2 pl-11",children:w.jsx(fN,{profiles:Ve.user.socialProfiles,size:"sm"})})]},Ve.userId)})})})})]})})]})]})},dp=B.forwardRef(({className:t,...r},l)=>w.jsx("textarea",{className:rr("flex min-h-[80px] w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",t),ref:l,...r}));dp.displayName="Textarea";const aK=({onClose:t})=>{const[r,l]=B.useState(5),[d,_]=B.useState(""),[x,C]=B.useState(""),s=()=>{console.log("Support submission:",{amount:r,contact:d,message:x}),t()};return w.jsx(ei,{className:"w-80 bg-background/95 backdrop-blur-sm border shadow-xl",children:w.jsxs(fi,{className:"p-4 space-y-2",children:[w.jsxs("div",{className:"flex items-center justify-between",children:[w.jsxs("div",{className:"flex items-center gap-2",children:[w.jsx(kv,{className:"h-5 w-5 text-red-500 fill-red-500"}),w.jsxs("h3",{className:"font-semibold",children:["Support"," ",w.jsx("span",{className:"text-blue-600 underline underline-offset-2",children:"The Mission"})]})]}),w.jsxs("div",{className:"flex items-center gap-2",children:[w.jsx(xL,{className:"h-5 w-5 text-amber-600"}),w.jsx(An,{variant:"ghost",size:"sm",onClick:t,className:"p-1 h-8 w-8","data-testid":"button-close-support",children:w.jsx(vh,{className:"h-4 w-4"})})]})]}),w.jsx("p",{className:"text-xs text-muted-foreground",children:"Help us connect communities and local businesses. Every contribution makes a difference! ✨"}),w.jsxs("div",{className:"space-y-1",children:[w.jsxs("div",{className:"flex items-center justify-between",children:[w.jsx("label",{className:"text-xs font-medium",children:"Amount ($5 minimum)"}),w.jsxs(An,{className:"bg-blue-600 hover:bg-blue-700 text-white px-3 py-1 text-xs",onClick:s,"data-testid":"button-buy-coffee",children:[w.jsx(xL,{className:"h-3 w-3 mr-1"}),"Buy us a coffee ☕"]})]}),w.jsxs("div",{className:"flex items-center gap-2",children:[w.jsx("span",{className:"text-sm",children:"$"}),w.jsx(Mo,{type:"number",value:r,onChange:k=>l(Math.max(5,parseInt(k.target.value)||5)),min:5,className:"flex-1 h-8","data-testid":"input-amount"})]})]}),w.jsxs("div",{className:"space-y-1",children:[w.jsx(Mo,{type:"text",placeholder:"Email/Phone (optional)",value:d,onChange:k=>_(k.target.value),className:"h-8","data-testid":"input-contact"}),w.jsxs("div",{className:"relative",children:[w.jsx(dp,{placeholder:"Leave a message (optional)...",value:x,onChange:k=>C(k.target.value.slice(0,200)),className:"min-h-[40px] resize-none text-xs","data-testid":"textarea-message"}),w.jsxs("div",{className:"flex items-center justify-between mt-1",children:[w.jsxs("span",{className:"text-xs text-muted-foreground",children:[x.length,"/200"]}),w.jsxs(An,{variant:"ghost",size:"sm",onClick:s,className:"flex items-center gap-1 h-6 px-2","data-testid":"button-send",children:[w.jsx(i2,{className:"h-3 w-3"}),"Send"]})]})]})]})]})})},lK=({isOpen:t,onClose:r})=>{const l=Hl(),[d,_]=B.useState(!1),x=[{id:"gaza-2024",name:"Gaza Humanitarian Crisis",location:"Gaza, Palestine",severity:"Critical",affected:22e5,category:"Armed Conflict",lastUpdated:"2024-09-24",image:"https://images.unsplash.com/photo-1578662996442-48f60103fc96?w=400&h=300&fit=crop",description:"Ongoing humanitarian crisis affecting the entire population of Gaza with urgent need for medical supplies, food, and shelter.",status:"Active"},{id:"ukraine-2024",name:"Ukraine Refugee Crisis",location:"Ukraine & Neighboring Countries",severity:"Critical",affected:6e6,category:"Armed Conflict",lastUpdated:"2024-09-23",image:"https://images.unsplash.com/photo-1544027993-37dbfe43562a?w=400&h=300&fit=crop",description:"Millions displaced by ongoing conflict requiring international humanitarian assistance and refugee support.",status:"Active"},{id:"sudan-2024",name:"Sudan Civil War Crisis",location:"Sudan",severity:"Critical",affected:45e5,category:"Armed Conflict",lastUpdated:"2024-09-22",image:"https://images.unsplash.com/photo-1547036967-23d11aacaee0?w=400&h=300&fit=crop",description:"Internal conflict has displaced millions with severe food insecurity and lack of basic services.",status:"Active"},{id:"afghanistan-2024",name:"Afghanistan Humanitarian Crisis",location:"Afghanistan",severity:"High",affected:28e6,category:"Economic Collapse",lastUpdated:"2024-09-21",image:"https://images.unsplash.com/photo-1578662996442-48f60103fc96?w=400&h=300&fit=crop",description:"Economic collapse and restrictions on women have created widespread humanitarian needs.",status:"Ongoing"},{id:"syria-2024",name:"Syria Refugee Crisis",location:"Syria & Region",severity:"High",affected:131e5,category:"Armed Conflict",lastUpdated:"2024-09-20",image:"https://images.unsplash.com/photo-1544027993-37dbfe43562a?w=400&h=300&fit=crop",description:"Long-term displacement and destruction continue to affect millions across Syria and neighboring countries.",status:"Ongoing"},{id:"myanmar-2024",name:"Myanmar Political Crisis",location:"Myanmar",severity:"High",affected:18e5,category:"Political Conflict",lastUpdated:"2024-09-19",image:"https://images.unsplash.com/photo-1547036967-23d11aacaee0?w=400&h=300&fit=crop",description:"Political instability has led to widespread displacement and humanitarian needs.",status:"Ongoing"}],C=k=>{switch(k){case"Critical":return"bg-red-500";case"High":return"bg-orange-500";case"Medium":return"bg-yellow-500";default:return"bg-gray-500"}},s=k=>{l(`/crisis/${k.id}`)};return t?w.jsx("div",{className:"fixed top-0 right-0 h-full w-96 max-w-[calc(100vw-2rem)] bg-card/95 backdrop-blur-sm border-l shadow-xl z-20 overflow-hidden",children:w.jsxs("div",{className:"flex flex-col h-full",children:[w.jsxs("div",{className:"p-4 border-b",children:[w.jsxs("div",{className:"flex items-center justify-between mb-3",children:[w.jsx("h2",{className:"text-lg font-semibold",children:"Global Humanitarian Crises"}),w.jsx(An,{variant:"ghost",size:"sm",onClick:r,children:w.jsx(vh,{className:"h-4 w-4"})})]}),w.jsx("div",{className:"flex items-center justify-center mb-3",children:w.jsxs("div",{className:"flex items-center bg-muted/50 rounded-full p-1",children:[w.jsxs("button",{onClick:()=>_(!1),className:`px-3 py-1.5 rounded-full text-xs font-medium transition-all duration-200 flex items-center gap-1.5 ${d?"text-muted-foreground hover:text-foreground":"bg-background text-foreground shadow-sm"}`,"data-testid":"button-global-mode-crises",children:[w.jsx(tp,{className:"h-3 w-3"}),"Global"]}),w.jsxs("button",{onClick:()=>_(!0),className:`px-3 py-1.5 rounded-full text-xs font-medium transition-all duration-200 flex items-center gap-1.5 ${d?"bg-background text-foreground shadow-sm":"text-muted-foreground hover:text-foreground"}`,"data-testid":"button-local-mode-crises",children:[w.jsx(np,{className:"h-3 w-3"}),"Regional"]})]})}),w.jsx("p",{className:"text-sm text-muted-foreground",children:"Click on any crisis to view details and get involved"})]}),w.jsx("div",{className:"flex-1 overflow-y-auto p-4 space-y-4",children:x.map(k=>w.jsx(ei,{className:"hover:shadow-md transition-shadow cursor-pointer",onClick:()=>s(k),"data-testid":`crisis-card-${k.id}`,children:w.jsx(fi,{className:"p-4",children:w.jsxs("div",{className:"space-y-3",children:[w.jsxs("div",{className:"flex items-start gap-3",children:[w.jsxs(fo,{className:"h-12 w-12",children:[w.jsx(Ra,{src:k.image}),w.jsx(po,{className:"bg-red-500/20 text-red-600",children:w.jsx(v7,{className:"h-5 w-5"})})]}),w.jsxs("div",{className:"flex-1 min-w-0",children:[w.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[w.jsx("h3",{className:"font-semibold truncate",children:k.name}),w.jsx("div",{className:`w-2 h-2 rounded-full ${C(k.severity)}`})]}),w.jsxs("div",{className:"flex items-center gap-1 text-sm text-muted-foreground mb-1",children:[w.jsx(ro,{className:"h-3 w-3"}),k.location]}),w.jsxs("div",{className:"flex items-center gap-1 text-sm text-muted-foreground",children:[w.jsx(ho,{className:"h-3 w-3"}),k.affected.toLocaleString()," affected"]})]})]}),w.jsxs("div",{className:"flex flex-wrap gap-1",children:[w.jsx(wi,{variant:"outline",className:"text-xs",children:k.category}),w.jsx(wi,{variant:k.status==="Active"?"destructive":"secondary",className:"text-xs",children:k.status}),w.jsx(wi,{variant:"outline",className:"text-xs",children:k.severity})]}),w.jsx("p",{className:"text-sm text-muted-foreground line-clamp-2",children:k.description}),w.jsxs("div",{className:"flex items-center justify-between",children:[w.jsxs("span",{className:"text-xs text-muted-foreground",children:["Updated: ",new Date(k.lastUpdated).toLocaleDateString()]}),w.jsxs(An,{size:"sm",variant:"ghost",className:"flex items-center gap-1",onClick:z=>{z.stopPropagation(),s(k)},children:[w.jsx(wC,{className:"h-3 w-3"}),"View"]})]})]})})},k.id))})]})}):null};function cK(){const{data:t=[]}=Ia({queryKey:["/api/stories/pending"],refetchInterval:3e4,enabled:QF()});return t.length===0?null:w.jsx("div",{className:"fixed bottom-4 right-4 z-50",children:w.jsxs(Db,{to:"/moderation",className:"flex items-center gap-2 bg-yellow-500 hover:bg-yellow-600 text-yellow-950 px-3 py-2 rounded-lg shadow-lg transition-colors","data-testid":"moderation-status-badge",children:[w.jsx(m7,{className:"h-4 w-4"}),w.jsxs("span",{className:"text-sm font-medium",children:[t.length," stories need review"]}),w.jsxs(wi,{variant:"secondary",className:"ml-1",children:[w.jsx(Mb,{className:"h-3 w-3 mr-1"}),"Pending"]})]})})}var uK="Label",D4=B.forwardRef((t,r)=>w.jsx(ir.label,{...t,ref:r,onMouseDown:l=>{var _;l.target.closest("button, input, select, textarea")||((_=t.onMouseDown)==null||_.call(t,l),!l.defaultPrevented&&l.detail>1&&l.preventDefault())}}));D4.displayName=uK;var L4=D4;const dK=r_("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"),Ml=B.forwardRef(({className:t,...r},l)=>w.jsx(L4,{ref:l,className:rr(dK(),t),...r}));Ml.displayName=L4.displayName;var VI="Dialog",[N4,ene]=Gl(VI),[hK,ql]=N4(VI),z4=t=>{const{__scopeDialog:r,children:l,open:d,defaultOpen:_,onOpenChange:x,modal:C=!0}=t,s=B.useRef(null),k=B.useRef(null),[z=!1,V]=kc({prop:d,defaultProp:_,onChange:x});return w.jsx(hK,{scope:r,triggerRef:s,contentRef:k,contentId:Ol(),titleId:Ol(),descriptionId:Ol(),open:z,onOpenChange:V,onOpenToggle:B.useCallback(()=>V(U=>!U),[V]),modal:C,children:l})};z4.displayName=VI;var O4="DialogTrigger",F4=B.forwardRef((t,r)=>{const{__scopeDialog:l,...d}=t,_=ql(O4,l),x=ni(r,_.triggerRef);return w.jsx(ir.button,{type:"button","aria-haspopup":"dialog","aria-expanded":_.open,"aria-controls":_.contentId,"data-state":GI(_.open),...d,ref:x,onClick:mn(t.onClick,_.onOpenToggle)})});F4.displayName=O4;var UI="DialogPortal",[fK,j4]=N4(UI,{forceMount:void 0}),B4=t=>{const{__scopeDialog:r,forceMount:l,children:d,container:_}=t,x=ql(UI,r);return w.jsx(fK,{scope:r,forceMount:l,children:B.Children.map(d,C=>w.jsx(io,{present:l||x.open,children:w.jsx(n_,{asChild:!0,container:_,children:C})}))})};B4.displayName=UI;var xw="DialogOverlay",V4=B.forwardRef((t,r)=>{const l=j4(xw,t.__scopeDialog),{forceMount:d=l.forceMount,..._}=t,x=ql(xw,t.__scopeDialog);return x.modal?w.jsx(io,{present:d||x.open,children:w.jsx(pK,{..._,ref:r})}):null});V4.displayName=xw;var pK=B.forwardRef((t,r)=>{const{__scopeDialog:l,...d}=t,_=ql(xw,l);return w.jsx(zx,{as:Rc,allowPinchZoom:!0,shards:[_.contentRef],children:w.jsx(ir.div,{"data-state":GI(_.open),...d,ref:r,style:{pointerEvents:"auto",...d.style}})})}),hp="DialogContent",U4=B.forwardRef((t,r)=>{const l=j4(hp,t.__scopeDialog),{forceMount:d=l.forceMount,..._}=t,x=ql(hp,t.__scopeDialog);return w.jsx(io,{present:d||x.open,children:x.modal?w.jsx(mK,{..._,ref:r}):w.jsx(gK,{..._,ref:r})})});U4.displayName=hp;var mK=B.forwardRef((t,r)=>{const l=ql(hp,t.__scopeDialog),d=B.useRef(null),_=ni(r,l.contentRef,d);return B.useEffect(()=>{const x=d.current;if(x)return m2(x)},[]),w.jsx($4,{...t,ref:_,trapFocus:l.open,disableOutsidePointerEvents:!0,onCloseAutoFocus:mn(t.onCloseAutoFocus,x=>{var C;x.preventDefault(),(C=l.triggerRef.current)==null||C.focus()}),onPointerDownOutside:mn(t.onPointerDownOutside,x=>{const C=x.detail.originalEvent,s=C.button===0&&C.ctrlKey===!0;(C.button===2||s)&&x.preventDefault()}),onFocusOutside:mn(t.onFocusOutside,x=>x.preventDefault())})}),gK=B.forwardRef((t,r)=>{const l=ql(hp,t.__scopeDialog),d=B.useRef(!1),_=B.useRef(!1);return w.jsx($4,{...t,ref:r,trapFocus:!1,disableOutsidePointerEvents:!1,onCloseAutoFocus:x=>{var C,s;(C=t.onCloseAutoFocus)==null||C.call(t,x),x.defaultPrevented||(d.current||(s=l.triggerRef.current)==null||s.focus(),x.preventDefault()),d.current=!1,_.current=!1},onInteractOutside:x=>{var k,z;(k=t.onInteractOutside)==null||k.call(t,x),x.defaultPrevented||(d.current=!0,x.detail.originalEvent.type==="pointerdown"&&(_.current=!0));const C=x.target;((z=l.triggerRef.current)==null?void 0:z.contains(C))&&x.preventDefault(),x.detail.originalEvent.type==="focusin"&&_.current&&x.preventDefault()}})}),$4=B.forwardRef((t,r)=>{const{__scopeDialog:l,trapFocus:d,onOpenAutoFocus:_,onCloseAutoFocus:x,...C}=t,s=ql(hp,l),k=B.useRef(null),z=ni(r,k);return p2(),w.jsxs(w.Fragment,{children:[w.jsx(Nx,{asChild:!0,loop:!0,trapped:d,onMountAutoFocus:_,onUnmountAutoFocus:x,children:w.jsx(vp,{role:"dialog",id:s.contentId,"aria-describedby":s.descriptionId,"aria-labelledby":s.titleId,"data-state":GI(s.open),...C,ref:z,onDismiss:()=>s.onOpenChange(!1)})}),w.jsxs(w.Fragment,{children:[w.jsx(_K,{titleId:s.titleId}),w.jsx(vK,{contentRef:k,descriptionId:s.descriptionId})]})]})}),$I="DialogTitle",G4=B.forwardRef((t,r)=>{const{__scopeDialog:l,...d}=t,_=ql($I,l);return w.jsx(ir.h2,{id:_.titleId,...d,ref:r})});G4.displayName=$I;var H4="DialogDescription",q4=B.forwardRef((t,r)=>{const{__scopeDialog:l,...d}=t,_=ql(H4,l);return w.jsx(ir.p,{id:_.descriptionId,...d,ref:r})});q4.displayName=H4;var W4="DialogClose",Z4=B.forwardRef((t,r)=>{const{__scopeDialog:l,...d}=t,_=ql(W4,l);return w.jsx(ir.button,{type:"button",...d,ref:r,onClick:mn(t.onClick,()=>_.onOpenChange(!1))})});Z4.displayName=W4;function GI(t){return t?"open":"closed"}var X4="DialogTitleWarning",[tne,Y4]=v9(X4,{contentName:hp,titleName:$I,docsSlug:"dialog"}),_K=({titleId:t})=>{const r=Y4(X4),l=`\`${r.contentName}\` requires a \`${r.titleName}\` for the component to be accessible for screen reader users.

If you want to hide the \`${r.titleName}\`, you can wrap it with our VisuallyHidden component.

For more information, see https://radix-ui.com/primitives/docs/components/${r.docsSlug}`;return B.useEffect(()=>{t&&(document.getElementById(t)||console.error(l))},[l,t]),null},yK="DialogDescriptionWarning",vK=({contentRef:t,descriptionId:r})=>{const d=`Warning: Missing \`Description\` or \`aria-describedby={undefined}\` for {${Y4(yK).contentName}}.`;return B.useEffect(()=>{var x;const _=(x=t.current)==null?void 0:x.getAttribute("aria-describedby");r&&_&&(document.getElementById(r)||console.warn(d))},[d,t,r]),null},xK=z4,bK=F4,wK=B4,K4=V4,Q4=U4,J4=G4,e5=q4,SK=Z4;const tA=xK,TK=bK,EK=wK,t5=B.forwardRef(({className:t,...r},l)=>w.jsx(K4,{ref:l,className:rr("fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",t),...r}));t5.displayName=K4.displayName;const bw=B.forwardRef(({className:t,children:r,...l},d)=>w.jsxs(EK,{children:[w.jsx(t5,{}),w.jsxs(Q4,{ref:d,className:rr("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",t),...l,children:[r,w.jsxs(SK,{className:"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-accent data-[state=open]:text-muted-foreground",children:[w.jsx(vh,{className:"h-4 w-4"}),w.jsx("span",{className:"sr-only",children:"Close"})]})]})]}));bw.displayName=Q4.displayName;const HI=({className:t,...r})=>w.jsx("div",{className:rr("flex flex-col space-y-1.5 text-center sm:text-left",t),...r});HI.displayName="DialogHeader";const qI=B.forwardRef(({className:t,...r},l)=>w.jsx(J4,{ref:l,className:rr("text-lg font-semibold leading-none tracking-tight",t),...r}));qI.displayName=J4.displayName;const n5=B.forwardRef(({className:t,...r},l)=>w.jsx(e5,{ref:l,className:rr("text-sm text-muted-foreground",t),...r}));n5.displayName=e5.displayName;const pN=[{value:"twitter",label:"Twitter/X",icon:VO},{value:"instagram",label:"Instagram",icon:FO},{value:"linkedin",label:"LinkedIn",icon:jO},{value:"facebook",label:"Facebook",icon:NO},{value:"youtube",label:"YouTube",icon:UO},{value:"tiktok",label:"TikTok",icon:null}];function CK({user:t}){const[r,l]=B.useState(!1),[d,_]=B.useState(""),[x,C]=B.useState(""),[s,k]=B.useState(""),z=h2(),{toast:V}=yp(),U=dh({mutationFn:async H=>await op("/api/user/social-profiles",{method:"POST",body:JSON.stringify(H)}),onSuccess:()=>{z.invalidateQueries({queryKey:["/api/auth/user"]}),l(!1),_(""),C(""),k(""),V({title:"Social profile added",description:"Your social profile has been connected successfully"})},onError:()=>{V({title:"Error",description:"Failed to add social profile",variant:"destructive"})}}),$=dh({mutationFn:async H=>await op(`/api/user/social-profiles/${H}`,{method:"DELETE"}),onSuccess:()=>{z.invalidateQueries({queryKey:["/api/auth/user"]}),V({title:"Social profile removed",description:"Your social profile has been disconnected"})},onError:()=>{V({title:"Error",description:"Failed to remove social profile",variant:"destructive"})}}),se=H=>{H.preventDefault(),!(!d||!x)&&U.mutate({platform:d,username:x,profileUrl:s})},ae=H=>{const ne=pN.find(te=>te.value===H);if(!ne||!ne.icon)return null;const Y=ne.icon;return w.jsx(Y,{className:"h-4 w-4"})};return w.jsxs("div",{className:"space-y-3",children:[w.jsxs("div",{className:"flex items-center justify-between",children:[w.jsx("h3",{className:"text-sm font-medium",children:"Connected Accounts"}),w.jsxs(tA,{open:r,onOpenChange:l,children:[w.jsx(TK,{asChild:!0,children:w.jsxs(An,{variant:"outline",size:"sm","data-testid":"button-add-social",children:[w.jsx(Ug,{className:"h-3 w-3 mr-1"}),"Add Social"]})}),w.jsxs(bw,{children:[w.jsxs(HI,{children:[w.jsx(qI,{children:"Connect Social Account"}),w.jsx(n5,{children:"Add your social media profiles to show on your communities"})]}),w.jsxs("form",{onSubmit:se,className:"space-y-4",children:[w.jsxs("div",{children:[w.jsx(Ml,{htmlFor:"platform",children:"Platform"}),w.jsxs(qg,{value:d,onValueChange:_,required:!0,children:[w.jsx(lp,{id:"platform","data-testid":"select-platform",children:w.jsx(Wg,{placeholder:"Select platform"})}),w.jsx(cp,{children:pN.map(H=>w.jsx(zi,{value:H.value,children:H.label},H.value))})]})]}),w.jsxs("div",{children:[w.jsx(Ml,{htmlFor:"username",children:"Username/Handle"}),w.jsx(Mo,{id:"username",value:x,onChange:H=>C(H.target.value),placeholder:"@username",required:!0,"data-testid":"input-username"})]}),w.jsxs("div",{children:[w.jsx(Ml,{htmlFor:"profileUrl",children:"Profile URL (optional)"}),w.jsx(Mo,{id:"profileUrl",type:"url",value:s,onChange:H=>k(H.target.value),placeholder:"https://...","data-testid":"input-profile-url"})]}),w.jsx(An,{type:"submit",className:"w-full",disabled:U.isPending,"data-testid":"button-submit-social",children:U.isPending?"Connecting...":"Connect Account"})]})]})]})]}),t.socialProfiles&&t.socialProfiles.length>0?w.jsx("div",{className:"space-y-2",children:t.socialProfiles.map(H=>w.jsxs("div",{className:"flex items-center justify-between p-2 rounded-md border bg-muted/50","data-testid":`social-profile-${H.platform}`,children:[w.jsxs("div",{className:"flex items-center gap-2",children:[ae(H.platform),w.jsxs("div",{children:[w.jsx("p",{className:"text-sm font-medium capitalize",children:H.platform}),w.jsx("p",{className:"text-xs text-muted-foreground",children:H.username})]})]}),w.jsx(An,{variant:"ghost",size:"sm",onClick:()=>$.mutate(H.platform),disabled:$.isPending,"data-testid":`button-remove-${H.platform}`,children:w.jsx(_7,{className:"h-3 w-3"})})]},H.platform))}):w.jsx("p",{className:"text-sm text-muted-foreground",children:"No social accounts connected yet"})]})}const AK=({onLocationChange:t,onUseRealLocation:r})=>(B.useState(!1),B.useState("No location set"),B.useState(""),B.useState(""),null);function IK(t,r=[]){let l=[];function d(x,C){const s=B.createContext(C),k=l.length;l=[...l,C];function z(U){const{scope:$,children:se,...ae}=U,H=($==null?void 0:$[t][k])||s,ne=B.useMemo(()=>ae,Object.values(ae));return w.jsx(H.Provider,{value:ne,children:se})}function V(U,$){const se=($==null?void 0:$[t][k])||s,ae=B.useContext(se);if(ae)return ae;if(C!==void 0)return C;throw new Error(`\`${U}\` must be used within \`${x}\``)}return z.displayName=x+"Provider",[z,V]}const _=()=>{const x=l.map(C=>B.createContext(C));return function(s){const k=(s==null?void 0:s[t])||x;return B.useMemo(()=>({[`__scope${t}`]:{...s,[t]:k}}),[s,k])}};return _.scopeName=t,[d,PK(_,...r)]}function PK(...t){const r=t[0];if(t.length===1)return r;const l=()=>{const d=t.map(_=>({useScope:_(),scopeName:_.scopeName}));return function(x){const C=d.reduce((s,{useScope:k,scopeName:z})=>{const U=k(x)[`__scope${z}`];return{...s,...U}},{});return B.useMemo(()=>({[`__scope${r.scopeName}`]:C}),[C])}};return l.scopeName=r.scopeName,l}var xE="rovingFocusGroup.onEntryFocus",MK={bubbles:!1,cancelable:!0},w2="RovingFocusGroup",[nA,r5,RK]=e2(w2),[kK,S2]=IK(w2,[RK]),[DK,LK]=kK(w2),i5=B.forwardRef((t,r)=>w.jsx(nA.Provider,{scope:t.__scopeRovingFocusGroup,children:w.jsx(nA.Slot,{scope:t.__scopeRovingFocusGroup,children:w.jsx(NK,{...t,ref:r})})}));i5.displayName=w2;var NK=B.forwardRef((t,r)=>{const{__scopeRovingFocusGroup:l,orientation:d,loop:_=!1,dir:x,currentTabStopId:C,defaultCurrentTabStopId:s,onCurrentTabStopIdChange:k,onEntryFocus:z,preventScrollOnEntryFocus:V=!1,...U}=t,$=B.useRef(null),se=ni(r,$),ae=Fx(x),[H=null,ne]=kc({prop:C,defaultProp:s,onChange:k}),[Y,te]=B.useState(!1),de=os(z),Me=r5(l),Le=B.useRef(!1),[lt,Pe]=B.useState(0);return B.useEffect(()=>{const Ye=$.current;if(Ye)return Ye.addEventListener(xE,de),()=>Ye.removeEventListener(xE,de)},[de]),w.jsx(DK,{scope:l,orientation:d,dir:ae,loop:_,currentTabStopId:H,onItemFocus:B.useCallback(Ye=>ne(Ye),[ne]),onItemShiftTab:B.useCallback(()=>te(!0),[]),onFocusableItemAdd:B.useCallback(()=>Pe(Ye=>Ye+1),[]),onFocusableItemRemove:B.useCallback(()=>Pe(Ye=>Ye-1),[]),children:w.jsx(ir.div,{tabIndex:Y||lt===0?-1:0,"data-orientation":d,...U,ref:se,style:{outline:"none",...t.style},onMouseDown:mn(t.onMouseDown,()=>{Le.current=!0}),onFocus:mn(t.onFocus,Ye=>{const vt=!Le.current;if(Ye.target===Ye.currentTarget&&vt&&!Y){const It=new CustomEvent(xE,MK);if(Ye.currentTarget.dispatchEvent(It),!It.defaultPrevented){const Ut=Me().filter(Je=>Je.focusable),Pt=Ut.find(Je=>Je.active),$t=Ut.find(Je=>Je.id===H),jt=[Pt,$t,...Ut].filter(Boolean).map(Je=>Je.ref.current);a5(jt,V)}}Le.current=!1}),onBlur:mn(t.onBlur,()=>te(!1))})})}),s5="RovingFocusGroupItem",o5=B.forwardRef((t,r)=>{const{__scopeRovingFocusGroup:l,focusable:d=!0,active:_=!1,tabStopId:x,...C}=t,s=Ol(),k=x||s,z=LK(s5,l),V=z.currentTabStopId===k,U=r5(l),{onFocusableItemAdd:$,onFocusableItemRemove:se}=z;return B.useEffect(()=>{if(d)return $(),()=>se()},[d,$,se]),w.jsx(nA.ItemSlot,{scope:l,id:k,focusable:d,active:_,children:w.jsx(ir.span,{tabIndex:V?0:-1,"data-orientation":z.orientation,...C,ref:r,onMouseDown:mn(t.onMouseDown,ae=>{d?z.onItemFocus(k):ae.preventDefault()}),onFocus:mn(t.onFocus,()=>z.onItemFocus(k)),onKeyDown:mn(t.onKeyDown,ae=>{if(ae.key==="Tab"&&ae.shiftKey){z.onItemShiftTab();return}if(ae.target!==ae.currentTarget)return;const H=FK(ae,z.orientation,z.dir);if(H!==void 0){if(ae.metaKey||ae.ctrlKey||ae.altKey||ae.shiftKey)return;ae.preventDefault();let Y=U().filter(te=>te.focusable).map(te=>te.ref.current);if(H==="last")Y.reverse();else if(H==="prev"||H==="next"){H==="prev"&&Y.reverse();const te=Y.indexOf(ae.currentTarget);Y=z.loop?jK(Y,te+1):Y.slice(te+1)}setTimeout(()=>a5(Y))}})})})});o5.displayName=s5;var zK={ArrowLeft:"prev",ArrowUp:"prev",ArrowRight:"next",ArrowDown:"next",PageUp:"first",Home:"first",PageDown:"last",End:"last"};function OK(t,r){return r!=="rtl"?t:t==="ArrowLeft"?"ArrowRight":t==="ArrowRight"?"ArrowLeft":t}function FK(t,r,l){const d=OK(t.key,l);if(!(r==="vertical"&&["ArrowLeft","ArrowRight"].includes(d))&&!(r==="horizontal"&&["ArrowUp","ArrowDown"].includes(d)))return zK[d]}function a5(t,r=!1){const l=document.activeElement;for(const d of t)if(d===l||(d.focus({preventScroll:r}),document.activeElement!==l))return}function jK(t,r){return t.map((l,d)=>t[(r+d)%t.length])}var l5=i5,c5=o5,rA=["Enter"," "],BK=["ArrowDown","PageUp","Home"],u5=["ArrowUp","PageDown","End"],VK=[...BK,...u5],UK={ltr:[...rA,"ArrowRight"],rtl:[...rA,"ArrowLeft"]},$K={ltr:["ArrowLeft"],rtl:["ArrowRight"]},Bx="Menu",[ox,GK,HK]=e2(Bx),[bp,d5]=Gl(Bx,[HK,xh,S2]),T2=xh(),h5=S2(),[qK,wp]=bp(Bx),[WK,Vx]=bp(Bx),f5=t=>{const{__scopeMenu:r,open:l=!1,children:d,dir:_,onOpenChange:x,modal:C=!0}=t,s=T2(r),[k,z]=B.useState(null),V=B.useRef(!1),U=os(x),$=Fx(_);return B.useEffect(()=>{const se=()=>{V.current=!0,document.addEventListener("pointerdown",ae,{capture:!0,once:!0}),document.addEventListener("pointermove",ae,{capture:!0,once:!0})},ae=()=>V.current=!1;return document.addEventListener("keydown",se,{capture:!0}),()=>{document.removeEventListener("keydown",se,{capture:!0}),document.removeEventListener("pointerdown",ae,{capture:!0}),document.removeEventListener("pointermove",ae,{capture:!0})}},[]),w.jsx(TI,{...s,children:w.jsx(qK,{scope:r,open:l,onOpenChange:U,content:k,onContentChange:z,children:w.jsx(WK,{scope:r,onClose:B.useCallback(()=>U(!1),[U]),isUsingKeyboardRef:V,dir:$,modal:C,children:d})})})};f5.displayName=Bx;var ZK="MenuAnchor",WI=B.forwardRef((t,r)=>{const{__scopeMenu:l,...d}=t,_=T2(l);return w.jsx(Dx,{..._,...d,ref:r})});WI.displayName=ZK;var ZI="MenuPortal",[XK,p5]=bp(ZI,{forceMount:void 0}),m5=t=>{const{__scopeMenu:r,forceMount:l,children:d,container:_}=t,x=wp(ZI,r);return w.jsx(XK,{scope:r,forceMount:l,children:w.jsx(io,{present:l||x.open,children:w.jsx(n_,{asChild:!0,container:_,children:d})})})};m5.displayName=ZI;var Ka="MenuContent",[YK,XI]=bp(Ka),g5=B.forwardRef((t,r)=>{const l=p5(Ka,t.__scopeMenu),{forceMount:d=l.forceMount,..._}=t,x=wp(Ka,t.__scopeMenu),C=Vx(Ka,t.__scopeMenu);return w.jsx(ox.Provider,{scope:t.__scopeMenu,children:w.jsx(io,{present:d||x.open,children:w.jsx(ox.Slot,{scope:t.__scopeMenu,children:C.modal?w.jsx(KK,{..._,ref:r}):w.jsx(QK,{..._,ref:r})})})})}),KK=B.forwardRef((t,r)=>{const l=wp(Ka,t.__scopeMenu),d=B.useRef(null),_=ni(r,d);return B.useEffect(()=>{const x=d.current;if(x)return m2(x)},[]),w.jsx(YI,{...t,ref:_,trapFocus:l.open,disableOutsidePointerEvents:l.open,disableOutsideScroll:!0,onFocusOutside:mn(t.onFocusOutside,x=>x.preventDefault(),{checkForDefaultPrevented:!1}),onDismiss:()=>l.onOpenChange(!1)})}),QK=B.forwardRef((t,r)=>{const l=wp(Ka,t.__scopeMenu);return w.jsx(YI,{...t,ref:r,trapFocus:!1,disableOutsidePointerEvents:!1,disableOutsideScroll:!1,onDismiss:()=>l.onOpenChange(!1)})}),YI=B.forwardRef((t,r)=>{const{__scopeMenu:l,loop:d=!1,trapFocus:_,onOpenAutoFocus:x,onCloseAutoFocus:C,disableOutsidePointerEvents:s,onEntryFocus:k,onEscapeKeyDown:z,onPointerDownOutside:V,onFocusOutside:U,onInteractOutside:$,onDismiss:se,disableOutsideScroll:ae,...H}=t,ne=wp(Ka,l),Y=Vx(Ka,l),te=T2(l),de=h5(l),Me=GK(l),[Le,lt]=B.useState(null),Pe=B.useRef(null),Ye=ni(r,Pe,ne.onContentChange),vt=B.useRef(0),It=B.useRef(""),Ut=B.useRef(0),Pt=B.useRef(null),$t=B.useRef("right"),Ve=B.useRef(0),jt=ae?zx:B.Fragment,Je=ae?{as:Rc,allowPinchZoom:!0}:void 0,mt=ft=>{var an,or;const Ct=It.current+ft,Zt=Me().filter(Mn=>!Mn.disabled),fn=document.activeElement,Qn=(an=Zt.find(Mn=>Mn.ref.current===fn))==null?void 0:an.textValue,$n=Zt.map(Mn=>Mn.textValue),Hn=uQ($n,Ct,Qn),rn=(or=Zt.find(Mn=>Mn.textValue===Hn))==null?void 0:or.ref.current;(function Mn(Mr){It.current=Mr,window.clearTimeout(vt.current),Mr!==""&&(vt.current=window.setTimeout(()=>Mn(""),1e3))})(Ct),rn&&setTimeout(()=>rn.focus())};B.useEffect(()=>()=>window.clearTimeout(vt.current),[]),p2();const Be=B.useCallback(ft=>{var Zt,fn;return $t.current===((Zt=Pt.current)==null?void 0:Zt.side)&&hQ(ft,(fn=Pt.current)==null?void 0:fn.area)},[]);return w.jsx(YK,{scope:l,searchRef:It,onItemEnter:B.useCallback(ft=>{Be(ft)&&ft.preventDefault()},[Be]),onItemLeave:B.useCallback(ft=>{var Ct;Be(ft)||((Ct=Pe.current)==null||Ct.focus(),lt(null))},[Be]),onTriggerLeave:B.useCallback(ft=>{Be(ft)&&ft.preventDefault()},[Be]),pointerGraceTimerRef:Ut,onPointerGraceIntentChange:B.useCallback(ft=>{Pt.current=ft},[]),children:w.jsx(jt,{...Je,children:w.jsx(Nx,{asChild:!0,trapped:_,onMountAutoFocus:mn(x,ft=>{var Ct;ft.preventDefault(),(Ct=Pe.current)==null||Ct.focus({preventScroll:!0})}),onUnmountAutoFocus:C,children:w.jsx(vp,{asChild:!0,disableOutsidePointerEvents:s,onEscapeKeyDown:z,onPointerDownOutside:V,onFocusOutside:U,onInteractOutside:$,onDismiss:se,children:w.jsx(l5,{asChild:!0,...de,dir:Y.dir,orientation:"vertical",loop:d,currentTabStopId:Le,onCurrentTabStopIdChange:lt,onEntryFocus:mn(k,ft=>{Y.isUsingKeyboardRef.current||ft.preventDefault()}),preventScrollOnEntryFocus:!0,children:w.jsx(l2,{role:"menu","aria-orientation":"vertical","data-state":k5(ne.open),"data-radix-menu-content":"",dir:Y.dir,...te,...H,ref:Ye,style:{outline:"none",...H.style},onKeyDown:mn(H.onKeyDown,ft=>{const Zt=ft.target.closest("[data-radix-menu-content]")===ft.currentTarget,fn=ft.ctrlKey||ft.altKey||ft.metaKey,Qn=ft.key.length===1;Zt&&(ft.key==="Tab"&&ft.preventDefault(),!fn&&Qn&&mt(ft.key));const $n=Pe.current;if(ft.target!==$n||!VK.includes(ft.key))return;ft.preventDefault();const rn=Me().filter(an=>!an.disabled).map(an=>an.ref.current);u5.includes(ft.key)&&rn.reverse(),lQ(rn)}),onBlur:mn(t.onBlur,ft=>{ft.currentTarget.contains(ft.target)||(window.clearTimeout(vt.current),It.current="")}),onPointerMove:mn(t.onPointerMove,ax(ft=>{const Ct=ft.target,Zt=Ve.current!==ft.clientX;if(ft.currentTarget.contains(Ct)&&Zt){const fn=ft.clientX>Ve.current?"right":"left";$t.current=fn,Ve.current=ft.clientX}}))})})})})})})});g5.displayName=Ka;var JK="MenuGroup",KI=B.forwardRef((t,r)=>{const{__scopeMenu:l,...d}=t;return w.jsx(ir.div,{role:"group",...d,ref:r})});KI.displayName=JK;var eQ="MenuLabel",_5=B.forwardRef((t,r)=>{const{__scopeMenu:l,...d}=t;return w.jsx(ir.div,{...d,ref:r})});_5.displayName=eQ;var ww="MenuItem",mN="menu.itemSelect",E2=B.forwardRef((t,r)=>{const{disabled:l=!1,onSelect:d,..._}=t,x=B.useRef(null),C=Vx(ww,t.__scopeMenu),s=XI(ww,t.__scopeMenu),k=ni(r,x),z=B.useRef(!1),V=()=>{const U=x.current;if(!l&&U){const $=new CustomEvent(mN,{bubbles:!0,cancelable:!0});U.addEventListener(mN,se=>d==null?void 0:d(se),{once:!0}),lI(U,$),$.defaultPrevented?z.current=!1:C.onClose()}};return w.jsx(y5,{..._,ref:k,disabled:l,onClick:mn(t.onClick,V),onPointerDown:U=>{var $;($=t.onPointerDown)==null||$.call(t,U),z.current=!0},onPointerUp:mn(t.onPointerUp,U=>{var $;z.current||($=U.currentTarget)==null||$.click()}),onKeyDown:mn(t.onKeyDown,U=>{const $=s.searchRef.current!=="";l||$&&U.key===" "||rA.includes(U.key)&&(U.currentTarget.click(),U.preventDefault())})})});E2.displayName=ww;var y5=B.forwardRef((t,r)=>{const{__scopeMenu:l,disabled:d=!1,textValue:_,...x}=t,C=XI(ww,l),s=h5(l),k=B.useRef(null),z=ni(r,k),[V,U]=B.useState(!1),[$,se]=B.useState("");return B.useEffect(()=>{const ae=k.current;ae&&se((ae.textContent??"").trim())},[x.children]),w.jsx(ox.ItemSlot,{scope:l,disabled:d,textValue:_??$,children:w.jsx(c5,{asChild:!0,...s,focusable:!d,children:w.jsx(ir.div,{role:"menuitem","data-highlighted":V?"":void 0,"aria-disabled":d||void 0,"data-disabled":d?"":void 0,...x,ref:z,onPointerMove:mn(t.onPointerMove,ax(ae=>{d?C.onItemLeave(ae):(C.onItemEnter(ae),ae.defaultPrevented||ae.currentTarget.focus({preventScroll:!0}))})),onPointerLeave:mn(t.onPointerLeave,ax(ae=>C.onItemLeave(ae))),onFocus:mn(t.onFocus,()=>U(!0)),onBlur:mn(t.onBlur,()=>U(!1))})})})}),tQ="MenuCheckboxItem",v5=B.forwardRef((t,r)=>{const{checked:l=!1,onCheckedChange:d,..._}=t;return w.jsx(T5,{scope:t.__scopeMenu,checked:l,children:w.jsx(E2,{role:"menuitemcheckbox","aria-checked":Sw(l)?"mixed":l,..._,ref:r,"data-state":JI(l),onSelect:mn(_.onSelect,()=>d==null?void 0:d(Sw(l)?!0:!l),{checkForDefaultPrevented:!1})})})});v5.displayName=tQ;var x5="MenuRadioGroup",[nQ,rQ]=bp(x5,{value:void 0,onValueChange:()=>{}}),b5=B.forwardRef((t,r)=>{const{value:l,onValueChange:d,..._}=t,x=os(d);return w.jsx(nQ,{scope:t.__scopeMenu,value:l,onValueChange:x,children:w.jsx(KI,{..._,ref:r})})});b5.displayName=x5;var w5="MenuRadioItem",S5=B.forwardRef((t,r)=>{const{value:l,...d}=t,_=rQ(w5,t.__scopeMenu),x=l===_.value;return w.jsx(T5,{scope:t.__scopeMenu,checked:x,children:w.jsx(E2,{role:"menuitemradio","aria-checked":x,...d,ref:r,"data-state":JI(x),onSelect:mn(d.onSelect,()=>{var C;return(C=_.onValueChange)==null?void 0:C.call(_,l)},{checkForDefaultPrevented:!1})})})});S5.displayName=w5;var QI="MenuItemIndicator",[T5,iQ]=bp(QI,{checked:!1}),E5=B.forwardRef((t,r)=>{const{__scopeMenu:l,forceMount:d,..._}=t,x=iQ(QI,l);return w.jsx(io,{present:d||Sw(x.checked)||x.checked===!0,children:w.jsx(ir.span,{..._,ref:r,"data-state":JI(x.checked)})})});E5.displayName=QI;var sQ="MenuSeparator",C5=B.forwardRef((t,r)=>{const{__scopeMenu:l,...d}=t;return w.jsx(ir.div,{role:"separator","aria-orientation":"horizontal",...d,ref:r})});C5.displayName=sQ;var oQ="MenuArrow",A5=B.forwardRef((t,r)=>{const{__scopeMenu:l,...d}=t,_=T2(l);return w.jsx(c2,{..._,...d,ref:r})});A5.displayName=oQ;var aQ="MenuSub",[nne,I5]=bp(aQ),vv="MenuSubTrigger",P5=B.forwardRef((t,r)=>{const l=wp(vv,t.__scopeMenu),d=Vx(vv,t.__scopeMenu),_=I5(vv,t.__scopeMenu),x=XI(vv,t.__scopeMenu),C=B.useRef(null),{pointerGraceTimerRef:s,onPointerGraceIntentChange:k}=x,z={__scopeMenu:t.__scopeMenu},V=B.useCallback(()=>{C.current&&window.clearTimeout(C.current),C.current=null},[]);return B.useEffect(()=>V,[V]),B.useEffect(()=>{const U=s.current;return()=>{window.clearTimeout(U),k(null)}},[s,k]),w.jsx(WI,{asChild:!0,...z,children:w.jsx(y5,{id:_.triggerId,"aria-haspopup":"menu","aria-expanded":l.open,"aria-controls":_.contentId,"data-state":k5(l.open),...t,ref:Jw(r,_.onTriggerChange),onClick:U=>{var $;($=t.onClick)==null||$.call(t,U),!(t.disabled||U.defaultPrevented)&&(U.currentTarget.focus(),l.open||l.onOpenChange(!0))},onPointerMove:mn(t.onPointerMove,ax(U=>{x.onItemEnter(U),!U.defaultPrevented&&!t.disabled&&!l.open&&!C.current&&(x.onPointerGraceIntentChange(null),C.current=window.setTimeout(()=>{l.onOpenChange(!0),V()},100))})),onPointerLeave:mn(t.onPointerLeave,ax(U=>{var se,ae;V();const $=(se=l.content)==null?void 0:se.getBoundingClientRect();if($){const H=(ae=l.content)==null?void 0:ae.dataset.side,ne=H==="right",Y=ne?-5:5,te=$[ne?"left":"right"],de=$[ne?"right":"left"];x.onPointerGraceIntentChange({area:[{x:U.clientX+Y,y:U.clientY},{x:te,y:$.top},{x:de,y:$.top},{x:de,y:$.bottom},{x:te,y:$.bottom}],side:H}),window.clearTimeout(s.current),s.current=window.setTimeout(()=>x.onPointerGraceIntentChange(null),300)}else{if(x.onTriggerLeave(U),U.defaultPrevented)return;x.onPointerGraceIntentChange(null)}})),onKeyDown:mn(t.onKeyDown,U=>{var se;const $=x.searchRef.current!=="";t.disabled||$&&U.key===" "||UK[d.dir].includes(U.key)&&(l.onOpenChange(!0),(se=l.content)==null||se.focus(),U.preventDefault())})})})});P5.displayName=vv;var M5="MenuSubContent",R5=B.forwardRef((t,r)=>{const l=p5(Ka,t.__scopeMenu),{forceMount:d=l.forceMount,..._}=t,x=wp(Ka,t.__scopeMenu),C=Vx(Ka,t.__scopeMenu),s=I5(M5,t.__scopeMenu),k=B.useRef(null),z=ni(r,k);return w.jsx(ox.Provider,{scope:t.__scopeMenu,children:w.jsx(io,{present:d||x.open,children:w.jsx(ox.Slot,{scope:t.__scopeMenu,children:w.jsx(YI,{id:s.contentId,"aria-labelledby":s.triggerId,..._,ref:z,align:"start",side:C.dir==="rtl"?"left":"right",disableOutsidePointerEvents:!1,disableOutsideScroll:!1,trapFocus:!1,onOpenAutoFocus:V=>{var U;C.isUsingKeyboardRef.current&&((U=k.current)==null||U.focus()),V.preventDefault()},onCloseAutoFocus:V=>V.preventDefault(),onFocusOutside:mn(t.onFocusOutside,V=>{V.target!==s.trigger&&x.onOpenChange(!1)}),onEscapeKeyDown:mn(t.onEscapeKeyDown,V=>{C.onClose(),V.preventDefault()}),onKeyDown:mn(t.onKeyDown,V=>{var se;const U=V.currentTarget.contains(V.target),$=$K[C.dir].includes(V.key);U&&$&&(x.onOpenChange(!1),(se=s.trigger)==null||se.focus(),V.preventDefault())})})})})})});R5.displayName=M5;function k5(t){return t?"open":"closed"}function Sw(t){return t==="indeterminate"}function JI(t){return Sw(t)?"indeterminate":t?"checked":"unchecked"}function lQ(t){const r=document.activeElement;for(const l of t)if(l===r||(l.focus(),document.activeElement!==r))return}function cQ(t,r){return t.map((l,d)=>t[(r+d)%t.length])}function uQ(t,r,l){const _=r.length>1&&Array.from(r).every(z=>z===r[0])?r[0]:r,x=l?t.indexOf(l):-1;let C=cQ(t,Math.max(x,0));_.length===1&&(C=C.filter(z=>z!==l));const k=C.find(z=>z.toLowerCase().startsWith(_.toLowerCase()));return k!==l?k:void 0}function dQ(t,r){const{x:l,y:d}=t;let _=!1;for(let x=0,C=r.length-1;x<r.length;C=x++){const s=r[x].x,k=r[x].y,z=r[C].x,V=r[C].y;k>d!=V>d&&l<(z-s)*(d-k)/(V-k)+s&&(_=!_)}return _}function hQ(t,r){if(!r)return!1;const l={x:t.clientX,y:t.clientY};return dQ(l,r)}function ax(t){return r=>r.pointerType==="mouse"?t(r):void 0}var fQ=f5,pQ=WI,mQ=m5,gQ=g5,_Q=KI,yQ=_5,vQ=E2,xQ=v5,bQ=b5,wQ=S5,SQ=E5,TQ=C5,EQ=A5,CQ=P5,AQ=R5,eP="DropdownMenu",[IQ,rne]=Gl(eP,[d5]),Xo=d5(),[PQ,D5]=IQ(eP),L5=t=>{const{__scopeDropdownMenu:r,children:l,dir:d,open:_,defaultOpen:x,onOpenChange:C,modal:s=!0}=t,k=Xo(r),z=B.useRef(null),[V=!1,U]=kc({prop:_,defaultProp:x,onChange:C});return w.jsx(PQ,{scope:r,triggerId:Ol(),triggerRef:z,contentId:Ol(),open:V,onOpenChange:U,onOpenToggle:B.useCallback(()=>U($=>!$),[U]),modal:s,children:w.jsx(fQ,{...k,open:V,onOpenChange:U,dir:d,modal:s,children:l})})};L5.displayName=eP;var N5="DropdownMenuTrigger",z5=B.forwardRef((t,r)=>{const{__scopeDropdownMenu:l,disabled:d=!1,..._}=t,x=D5(N5,l),C=Xo(l);return w.jsx(pQ,{asChild:!0,...C,children:w.jsx(ir.button,{type:"button",id:x.triggerId,"aria-haspopup":"menu","aria-expanded":x.open,"aria-controls":x.open?x.contentId:void 0,"data-state":x.open?"open":"closed","data-disabled":d?"":void 0,disabled:d,..._,ref:Jw(r,x.triggerRef),onPointerDown:mn(t.onPointerDown,s=>{!d&&s.button===0&&s.ctrlKey===!1&&(x.onOpenToggle(),x.open||s.preventDefault())}),onKeyDown:mn(t.onKeyDown,s=>{d||(["Enter"," "].includes(s.key)&&x.onOpenToggle(),s.key==="ArrowDown"&&x.onOpenChange(!0),["Enter"," ","ArrowDown"].includes(s.key)&&s.preventDefault())})})})});z5.displayName=N5;var MQ="DropdownMenuPortal",O5=t=>{const{__scopeDropdownMenu:r,...l}=t,d=Xo(r);return w.jsx(mQ,{...d,...l})};O5.displayName=MQ;var F5="DropdownMenuContent",j5=B.forwardRef((t,r)=>{const{__scopeDropdownMenu:l,...d}=t,_=D5(F5,l),x=Xo(l),C=B.useRef(!1);return w.jsx(gQ,{id:_.contentId,"aria-labelledby":_.triggerId,...x,...d,ref:r,onCloseAutoFocus:mn(t.onCloseAutoFocus,s=>{var k;C.current||(k=_.triggerRef.current)==null||k.focus(),C.current=!1,s.preventDefault()}),onInteractOutside:mn(t.onInteractOutside,s=>{const k=s.detail.originalEvent,z=k.button===0&&k.ctrlKey===!0,V=k.button===2||z;(!_.modal||V)&&(C.current=!0)}),style:{...t.style,"--radix-dropdown-menu-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-dropdown-menu-content-available-width":"var(--radix-popper-available-width)","--radix-dropdown-menu-content-available-height":"var(--radix-popper-available-height)","--radix-dropdown-menu-trigger-width":"var(--radix-popper-anchor-width)","--radix-dropdown-menu-trigger-height":"var(--radix-popper-anchor-height)"}})});j5.displayName=F5;var RQ="DropdownMenuGroup",kQ=B.forwardRef((t,r)=>{const{__scopeDropdownMenu:l,...d}=t,_=Xo(l);return w.jsx(_Q,{..._,...d,ref:r})});kQ.displayName=RQ;var DQ="DropdownMenuLabel",B5=B.forwardRef((t,r)=>{const{__scopeDropdownMenu:l,...d}=t,_=Xo(l);return w.jsx(yQ,{..._,...d,ref:r})});B5.displayName=DQ;var LQ="DropdownMenuItem",V5=B.forwardRef((t,r)=>{const{__scopeDropdownMenu:l,...d}=t,_=Xo(l);return w.jsx(vQ,{..._,...d,ref:r})});V5.displayName=LQ;var NQ="DropdownMenuCheckboxItem",U5=B.forwardRef((t,r)=>{const{__scopeDropdownMenu:l,...d}=t,_=Xo(l);return w.jsx(xQ,{..._,...d,ref:r})});U5.displayName=NQ;var zQ="DropdownMenuRadioGroup",OQ=B.forwardRef((t,r)=>{const{__scopeDropdownMenu:l,...d}=t,_=Xo(l);return w.jsx(bQ,{..._,...d,ref:r})});OQ.displayName=zQ;var FQ="DropdownMenuRadioItem",$5=B.forwardRef((t,r)=>{const{__scopeDropdownMenu:l,...d}=t,_=Xo(l);return w.jsx(wQ,{..._,...d,ref:r})});$5.displayName=FQ;var jQ="DropdownMenuItemIndicator",G5=B.forwardRef((t,r)=>{const{__scopeDropdownMenu:l,...d}=t,_=Xo(l);return w.jsx(SQ,{..._,...d,ref:r})});G5.displayName=jQ;var BQ="DropdownMenuSeparator",H5=B.forwardRef((t,r)=>{const{__scopeDropdownMenu:l,...d}=t,_=Xo(l);return w.jsx(TQ,{..._,...d,ref:r})});H5.displayName=BQ;var VQ="DropdownMenuArrow",UQ=B.forwardRef((t,r)=>{const{__scopeDropdownMenu:l,...d}=t,_=Xo(l);return w.jsx(EQ,{..._,...d,ref:r})});UQ.displayName=VQ;var $Q="DropdownMenuSubTrigger",q5=B.forwardRef((t,r)=>{const{__scopeDropdownMenu:l,...d}=t,_=Xo(l);return w.jsx(CQ,{..._,...d,ref:r})});q5.displayName=$Q;var GQ="DropdownMenuSubContent",W5=B.forwardRef((t,r)=>{const{__scopeDropdownMenu:l,...d}=t,_=Xo(l);return w.jsx(AQ,{..._,...d,ref:r,style:{...t.style,"--radix-dropdown-menu-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-dropdown-menu-content-available-width":"var(--radix-popper-available-width)","--radix-dropdown-menu-content-available-height":"var(--radix-popper-available-height)","--radix-dropdown-menu-trigger-width":"var(--radix-popper-anchor-width)","--radix-dropdown-menu-trigger-height":"var(--radix-popper-anchor-height)"}})});W5.displayName=GQ;var HQ=L5,qQ=z5,WQ=O5,Z5=j5,X5=B5,Y5=V5,K5=U5,Q5=$5,J5=G5,eB=H5,tB=q5,nB=W5;const ZQ=HQ,XQ=qQ,YQ=B.forwardRef(({className:t,inset:r,children:l,...d},_)=>w.jsxs(tB,{ref:_,className:rr("flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent data-[state=open]:bg-accent",r&&"pl-8",t),...d,children:[l,w.jsx(s7,{className:"ml-auto h-4 w-4"})]}));YQ.displayName=tB.displayName;const KQ=B.forwardRef(({className:t,...r},l)=>w.jsx(nB,{ref:l,className:rr("z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-lg data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",t),...r}));KQ.displayName=nB.displayName;const rB=B.forwardRef(({className:t,sideOffset:r=4,...l},d)=>w.jsx(WQ,{children:w.jsx(Z5,{ref:d,sideOffset:r,className:rr("z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",t),...l})}));rB.displayName=Z5.displayName;const zb=B.forwardRef(({className:t,inset:r,...l},d)=>w.jsx(Y5,{ref:d,className:rr("relative flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",r&&"pl-8",t),...l}));zb.displayName=Y5.displayName;const QQ=B.forwardRef(({className:t,children:r,checked:l,...d},_)=>w.jsxs(K5,{ref:_,className:rr("relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",t),checked:l,...d,children:[w.jsx("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:w.jsx(J5,{children:w.jsx(hI,{className:"h-4 w-4"})})}),r]}));QQ.displayName=K5.displayName;const JQ=B.forwardRef(({className:t,children:r,...l},d)=>w.jsxs(Q5,{ref:d,className:rr("relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",t),...l,children:[w.jsx("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:w.jsx(J5,{children:w.jsx(a7,{className:"h-2 w-2 fill-current"})})}),r]}));JQ.displayName=Q5.displayName;const eJ=B.forwardRef(({className:t,inset:r,...l},d)=>w.jsx(X5,{ref:d,className:rr("px-2 py-1.5 text-sm font-semibold",r&&"pl-8",t),...l}));eJ.displayName=X5.displayName;const iA=B.forwardRef(({className:t,...r},l)=>w.jsx(eB,{ref:l,className:rr("-mx-1 my-1 h-px bg-muted",t),...r}));iA.displayName=eB.displayName;const tJ=()=>{var Hn;const t=Hl(),{user:r,googleUser:l,signIn:d,signOut:_,loading:x,isVerifiedHost:C}=u_(),[s,k]=B.useState([]),[z,V]=B.useState(!1),[U,$]=B.useState(null),[se,ae]=B.useState(null),[H,ne]=B.useState(!1),[Y,te]=B.useState(!0),[de,Me]=B.useState(!0),[Le,lt]=B.useState(!1),[Pe,Ye]=B.useState(null),[vt,It]=B.useState("global"),[Ut,Pt]=B.useState(null),$t=rn=>{console.log("Searching for:",rn),V(!0)},Ve=rn=>{console.log("Filters changed:",rn)},jt=rn=>{$(rn),rn.regionData&&k(rn.regionData),V(!0)},Je=rn=>{ae(rn),ne(!0),V(!1)},mt=()=>{ne(!1),ae(null)},Be=()=>{te(!1)},ft=()=>{Y&&Be()},Ct=()=>{lt(!0)},Zt=(rn,an)=>{console.log("handleLocationFound called with:",rn,an),console.log("mapViewRef:",Pe),Pe&&Pe.centerOnLocation?(console.log("Calling centerOnLocation..."),Pe.centerOnLocation(rn,an)):console.log("mapViewRef or centerOnLocation not available")},fn=rn=>{It(rn),V(!0)},Qn=(rn,an,or)=>{console.log("Dev location set:",{lat:rn,lng:an,name:or}),Pt({lat:rn,lng:an,name:or}),Pe&&Pe.centerOnLocation&&Pe.centerOnLocation([an,rn],or)},$n=()=>{Pt(null)};return B.useEffect(()=>{const rn=an=>{an.ctrlKey&&an.shiftKey&&an.key==="M"&&t("/moderation")};return window.addEventListener("keydown",rn),()=>window.removeEventListener("keydown",rn)},[t]),w.jsxs("div",{className:"relative h-screen overflow-hidden bg-background",onClick:ft,children:[w.jsx(YZ,{onLocationSelect:jt,onHumanitarianClick:Ct,onMapReady:Ye,onRegionSelect:fn,devLocation:Ut}),w.jsx("div",{className:"absolute top-6 right-6 z-20 flex items-center gap-3",children:x?w.jsx("div",{className:"bg-card/95 backdrop-blur-sm rounded-lg border shadow-lg p-3",children:w.jsx("div",{className:"animate-spin rounded-full h-6 w-6 border-b-2 border-primary"})}):l?w.jsx("div",{className:"bg-card/95 backdrop-blur-sm rounded-lg border shadow-lg p-3",children:w.jsxs(ZQ,{children:[w.jsx(XQ,{asChild:!0,children:w.jsxs(An,{variant:"ghost",className:"flex items-center gap-2 p-2","data-testid":"button-user-menu",children:[w.jsxs(fo,{className:"h-8 w-8",children:[w.jsx(Ra,{src:l.picture,alt:l.name}),w.jsx(po,{children:(Hn=l.name)==null?void 0:Hn.substring(0,2).toUpperCase()})]}),w.jsxs("div",{className:"text-left",children:[w.jsx("p",{className:"text-sm font-medium",children:l.name}),w.jsx("div",{className:"flex items-center gap-1",children:C?w.jsxs(wi,{variant:"secondary",className:"text-xs bg-yellow-900 text-yellow-400","data-testid":"badge-verified-host",children:[w.jsx(l7,{className:"h-3 w-3 mr-1"}),"Verified Host"]}):w.jsx("span",{className:"text-xs text-muted-foreground",children:"Regular User"})})]})]})}),w.jsxs(rB,{align:"end",className:"w-80",children:[w.jsx("div",{className:"p-3",children:r&&w.jsx(CK,{user:r})}),w.jsx(iA,{}),w.jsxs(zb,{onClick:()=>t("/communities"),"data-testid":"menu-communities",children:[w.jsx(ho,{className:"h-4 w-4 mr-2"}),"View Communities"]}),w.jsxs(zb,{onClick:()=>t("/create-community"),"data-testid":"menu-create-community",children:[w.jsx(Ug,{className:"h-4 w-4 mr-2"}),"Create Community"]}),w.jsx(iA,{}),w.jsxs(zb,{onClick:_,"data-testid":"menu-sign-out",children:[w.jsx(d7,{className:"h-4 w-4 mr-2"}),"Sign out"]})]})]})}):w.jsx("div",{className:"bg-card/95 backdrop-blur-sm rounded-lg border shadow-lg p-4",children:w.jsxs("div",{className:"text-center",children:[w.jsx("h3",{className:"text-sm font-medium mb-2",children:"Crisis Response Platform"}),w.jsx("p",{className:"text-xs text-muted-foreground mb-3",children:"Sign in to access communities and submit stories"}),w.jsxs(An,{onClick:d,className:"w-full","data-testid":"button-sign-in",children:[w.jsx(np,{className:"h-4 w-4 mr-2"}),"Sign in with Google"]})]})})}),Y&&w.jsx("div",{className:"absolute top-10 left-1/2 transform -translate-x-1/2 z-10 text-center",children:w.jsxs("div",{className:"bg-background/90 backdrop-blur-sm rounded-lg border shadow-2xl p-8 max-w-md mx-auto relative",onClick:rn=>rn.stopPropagation(),"data-testid":"title-banner",children:[w.jsx("button",{onClick:Be,className:"absolute top-4 right-4 p-1 rounded-full hover:bg-muted transition-colors","aria-label":"Dismiss banner","data-testid":"button-dismiss-title",children:w.jsx(vh,{className:"h-4 w-4"})}),w.jsx("h1",{className:"text-3xl md:text-4xl font-bold text-foreground mb-4",children:"Get Involved in Real Conversations"}),w.jsx("p",{className:"text-lg md:text-xl text-muted-foreground mb-2",children:"A social platform for meaningful local and global connection."}),w.jsx("p",{className:"text-base md:text-lg text-primary font-medium",children:"Organize around causes, share stories, and build real-world impact — not just engagement."})]})}),w.jsx(iY,{onSearch:$t,onFilterChange:Ve}),w.jsx("div",{className:"absolute top-52 left-6 z-20 w-96 max-w-[calc(100vw-3rem)]",children:w.jsx(aY,{onLocationFound:Zt})}),w.jsx(hY,{isOpen:z,onClose:()=>V(!1),searchResults:s,onCommunityClick:Je,selectedRegion:vt}),w.jsx(lK,{isOpen:Le,onClose:()=>lt(!1)}),H&&se&&w.jsx(BI,{communityId:se.id||"unknown",communityName:se.name||"Unknown Community",currentUserId:"user-1",currentUserName:"Demo User",onClose:mt}),de&&w.jsx("div",{className:"absolute bottom-6 left-6 z-10",children:w.jsx(aK,{onClose:()=>Me(!1)})}),w.jsx(cK,{}),w.jsx(AK,{onLocationChange:Qn,onUseRealLocation:$n})]})},nJ=()=>{const t=c_();return B.useEffect(()=>{console.error("404 Error: User attempted to access non-existent route:",t.pathname)},[t.pathname]),w.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gray-100",children:w.jsxs("div",{className:"text-center",children:[w.jsx("h1",{className:"text-4xl font-bold mb-4",children:"404"}),w.jsx("p",{className:"text-xl text-gray-600 mb-4",children:"Oops! Page not found"}),w.jsx("a",{href:"/",className:"text-blue-500 hover:text-blue-700 underline",children:"Return to Home"})]})})};var tP="Tabs",[rJ,ine]=Gl(tP,[S2]),iB=S2(),[iJ,nP]=rJ(tP),sB=B.forwardRef((t,r)=>{const{__scopeTabs:l,value:d,onValueChange:_,defaultValue:x,orientation:C="horizontal",dir:s,activationMode:k="automatic",...z}=t,V=Fx(s),[U,$]=kc({prop:d,onChange:_,defaultProp:x});return w.jsx(iJ,{scope:l,baseId:Ol(),value:U,onValueChange:$,orientation:C,dir:V,activationMode:k,children:w.jsx(ir.div,{dir:V,"data-orientation":C,...z,ref:r})})});sB.displayName=tP;var oB="TabsList",aB=B.forwardRef((t,r)=>{const{__scopeTabs:l,loop:d=!0,..._}=t,x=nP(oB,l),C=iB(l);return w.jsx(l5,{asChild:!0,...C,orientation:x.orientation,dir:x.dir,loop:d,children:w.jsx(ir.div,{role:"tablist","aria-orientation":x.orientation,..._,ref:r})})});aB.displayName=oB;var lB="TabsTrigger",cB=B.forwardRef((t,r)=>{const{__scopeTabs:l,value:d,disabled:_=!1,...x}=t,C=nP(lB,l),s=iB(l),k=hB(C.baseId,d),z=fB(C.baseId,d),V=d===C.value;return w.jsx(c5,{asChild:!0,...s,focusable:!_,active:V,children:w.jsx(ir.button,{type:"button",role:"tab","aria-selected":V,"aria-controls":z,"data-state":V?"active":"inactive","data-disabled":_?"":void 0,disabled:_,id:k,...x,ref:r,onMouseDown:mn(t.onMouseDown,U=>{!_&&U.button===0&&U.ctrlKey===!1?C.onValueChange(d):U.preventDefault()}),onKeyDown:mn(t.onKeyDown,U=>{[" ","Enter"].includes(U.key)&&C.onValueChange(d)}),onFocus:mn(t.onFocus,()=>{const U=C.activationMode!=="manual";!V&&!_&&U&&C.onValueChange(d)})})})});cB.displayName=lB;var uB="TabsContent",dB=B.forwardRef((t,r)=>{const{__scopeTabs:l,value:d,forceMount:_,children:x,...C}=t,s=nP(uB,l),k=hB(s.baseId,d),z=fB(s.baseId,d),V=d===s.value,U=B.useRef(V);return B.useEffect(()=>{const $=requestAnimationFrame(()=>U.current=!1);return()=>cancelAnimationFrame($)},[]),w.jsx(io,{present:_||V,children:({present:$})=>w.jsx(ir.div,{"data-state":V?"active":"inactive","data-orientation":s.orientation,role:"tabpanel","aria-labelledby":k,hidden:!$,id:z,tabIndex:0,...C,ref:r,style:{...t.style,animationDuration:U.current?"0s":void 0},children:$&&x})})});dB.displayName=uB;function hB(t,r){return`${t}-trigger-${r}`}function fB(t,r){return`${t}-content-${r}`}var sJ=sB,pB=aB,mB=cB,gB=dB;const rP=sJ,C2=B.forwardRef(({className:t,...r},l)=>w.jsx(pB,{ref:l,className:rr("inline-flex h-10 items-center justify-center rounded-md bg-muted p-1 text-muted-foreground",t),...r}));C2.displayName=pB.displayName;const kl=B.forwardRef(({className:t,...r},l)=>w.jsx(mB,{ref:l,className:rr("inline-flex items-center justify-center whitespace-nowrap rounded-sm px-3 py-1.5 text-sm font-medium ring-offset-background transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:bg-background data-[state=active]:text-foreground data-[state=active]:shadow-sm",t),...r}));kl.displayName=mB.displayName;const Dl=B.forwardRef(({className:t,...r},l)=>w.jsx(gB,{ref:l,className:rr("mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2",t),...r}));Dl.displayName=gB.displayName;var Ux=t=>t.type==="checkbox",Ff=t=>t instanceof Date,Go=t=>t==null;const _B=t=>typeof t=="object";var Es=t=>!Go(t)&&!Array.isArray(t)&&_B(t)&&!Ff(t),yB=t=>Es(t)&&t.target?Ux(t.target)?t.target.checked:t.target.value:t,oJ=t=>t.substring(0,t.search(/\.\d+(\.|$)/))||t,vB=(t,r)=>t.has(oJ(r)),aJ=t=>{const r=t.constructor&&t.constructor.prototype;return Es(r)&&r.hasOwnProperty("isPrototypeOf")},iP=typeof window<"u"&&typeof window.HTMLElement<"u"&&typeof document<"u";function sa(t){let r;const l=Array.isArray(t);if(t instanceof Date)r=new Date(t);else if(t instanceof Set)r=new Set(t);else if(!(iP&&(t instanceof Blob||t instanceof FileList))&&(l||Es(t)))if(r=l?[]:{},!l&&!aJ(t))r=t;else for(const d in t)t.hasOwnProperty(d)&&(r[d]=sa(t[d]));else return t;return r}var A2=t=>Array.isArray(t)?t.filter(Boolean):[],ys=t=>t===void 0,Sn=(t,r,l)=>{if(!r||!Es(t))return l;const d=A2(r.split(/[,[\].]+?/)).reduce((_,x)=>Go(_)?_:_[x],t);return ys(d)||d===t?ys(t[r])?l:t[r]:d},qa=t=>typeof t=="boolean",sP=t=>/^\w*$/.test(t),xB=t=>A2(t.replace(/["|']|\]/g,"").split(/\.|\[/)),Oi=(t,r,l)=>{let d=-1;const _=sP(r)?[r]:xB(r),x=_.length,C=x-1;for(;++d<x;){const s=_[d];let k=l;if(d!==C){const z=t[s];k=Es(z)||Array.isArray(z)?z:isNaN(+_[d+1])?{}:[]}if(s==="__proto__")return;t[s]=k,t=t[s]}return t};const Tw={BLUR:"blur",FOCUS_OUT:"focusout",CHANGE:"change"},Rl={onBlur:"onBlur",onChange:"onChange",onSubmit:"onSubmit",onTouched:"onTouched",all:"all"},du={max:"max",min:"min",maxLength:"maxLength",minLength:"minLength",pattern:"pattern",required:"required",validate:"validate"},bB=Nt.createContext(null),I2=()=>Nt.useContext(bB),lJ=t=>{const{children:r,...l}=t;return Nt.createElement(bB.Provider,{value:l},r)};var wB=(t,r,l,d=!0)=>{const _={defaultValues:r._defaultValues};for(const x in t)Object.defineProperty(_,x,{get:()=>{const C=x;return r._proxyFormState[C]!==Rl.all&&(r._proxyFormState[C]=!d||Rl.all),l&&(l[C]=!0),t[C]}});return _},la=t=>Es(t)&&!Object.keys(t).length,SB=(t,r,l,d)=>{l(t);const{name:_,...x}=t;return la(x)||Object.keys(x).length>=Object.keys(r).length||Object.keys(x).find(C=>r[C]===(!d||Rl.all))},Dv=t=>Array.isArray(t)?t:[t],TB=(t,r,l)=>!t||!r||t===r||Dv(t).some(d=>d&&(l?d===r:d.startsWith(r)||r.startsWith(d)));function oP(t){const r=Nt.useRef(t);r.current=t,Nt.useEffect(()=>{const l=!t.disabled&&r.current.subject&&r.current.subject.subscribe({next:r.current.next});return()=>{l&&l.unsubscribe()}},[t.disabled])}function cJ(t){const r=I2(),{control:l=r.control,disabled:d,name:_,exact:x}=t||{},[C,s]=Nt.useState(l._formState),k=Nt.useRef(!0),z=Nt.useRef({isDirty:!1,isLoading:!1,dirtyFields:!1,touchedFields:!1,validatingFields:!1,isValidating:!1,isValid:!1,errors:!1}),V=Nt.useRef(_);return V.current=_,oP({disabled:d,next:U=>k.current&&TB(V.current,U.name,x)&&SB(U,z.current,l._updateFormState)&&s({...l._formState,...U}),subject:l._subjects.state}),Nt.useEffect(()=>(k.current=!0,z.current.isValid&&l._updateValid(!0),()=>{k.current=!1}),[l]),wB(C,l,z.current,!1)}var Cc=t=>typeof t=="string",EB=(t,r,l,d,_)=>Cc(t)?(d&&r.watch.add(t),Sn(l,t,_)):Array.isArray(t)?t.map(x=>(d&&r.watch.add(x),Sn(l,x))):(d&&(r.watchAll=!0),l);function uJ(t){const r=I2(),{control:l=r.control,name:d,defaultValue:_,disabled:x,exact:C}=t||{},s=Nt.useRef(d);s.current=d,oP({disabled:x,subject:l._subjects.values,next:V=>{TB(s.current,V.name,C)&&z(sa(EB(s.current,l._names,V.values||l._formValues,!1,_)))}});const[k,z]=Nt.useState(l._getWatch(d,_));return Nt.useEffect(()=>l._removeUnmounted()),k}function dJ(t){const r=I2(),{name:l,disabled:d,control:_=r.control,shouldUnregister:x}=t,C=vB(_._names.array,l),s=uJ({control:_,name:l,defaultValue:Sn(_._formValues,l,Sn(_._defaultValues,l,t.defaultValue)),exact:!0}),k=cJ({control:_,name:l,exact:!0}),z=Nt.useRef(_.register(l,{...t.rules,value:s,...qa(t.disabled)?{disabled:t.disabled}:{}}));return Nt.useEffect(()=>{const V=_._options.shouldUnregister||x,U=($,se)=>{const ae=Sn(_._fields,$);ae&&ae._f&&(ae._f.mount=se)};if(U(l,!0),V){const $=sa(Sn(_._options.defaultValues,l));Oi(_._defaultValues,l,$),ys(Sn(_._formValues,l))&&Oi(_._formValues,l,$)}return()=>{(C?V&&!_._state.action:V)?_.unregister(l):U(l,!1)}},[l,_,C,x]),Nt.useEffect(()=>{Sn(_._fields,l)&&_._updateDisabledField({disabled:d,fields:_._fields,name:l,value:Sn(_._fields,l)._f.value})},[d,l,_]),{field:{name:l,value:s,...qa(d)||k.disabled?{disabled:k.disabled||d}:{},onChange:Nt.useCallback(V=>z.current.onChange({target:{value:yB(V),name:l},type:Tw.CHANGE}),[l]),onBlur:Nt.useCallback(()=>z.current.onBlur({target:{value:Sn(_._formValues,l),name:l},type:Tw.BLUR}),[l,_]),ref:Nt.useCallback(V=>{const U=Sn(_._fields,l);U&&V&&(U._f.ref={focus:()=>V.focus(),select:()=>V.select(),setCustomValidity:$=>V.setCustomValidity($),reportValidity:()=>V.reportValidity()})},[_._fields,l])},formState:k,fieldState:Object.defineProperties({},{invalid:{enumerable:!0,get:()=>!!Sn(k.errors,l)},isDirty:{enumerable:!0,get:()=>!!Sn(k.dirtyFields,l)},isTouched:{enumerable:!0,get:()=>!!Sn(k.touchedFields,l)},isValidating:{enumerable:!0,get:()=>!!Sn(k.validatingFields,l)},error:{enumerable:!0,get:()=>Sn(k.errors,l)}})}}const hJ=t=>t.render(dJ(t));var CB=(t,r,l,d,_)=>r?{...l[t],types:{...l[t]&&l[t].types?l[t].types:{},[d]:_||!0}}:{},gN=t=>({isOnSubmit:!t||t===Rl.onSubmit,isOnBlur:t===Rl.onBlur,isOnChange:t===Rl.onChange,isOnAll:t===Rl.all,isOnTouch:t===Rl.onTouched}),_N=(t,r,l)=>!l&&(r.watchAll||r.watch.has(t)||[...r.watch].some(d=>t.startsWith(d)&&/^\.\w+/.test(t.slice(d.length))));const Lv=(t,r,l,d)=>{for(const _ of l||Object.keys(t)){const x=Sn(t,_);if(x){const{_f:C,...s}=x;if(C){if(C.refs&&C.refs[0]&&r(C.refs[0],_)&&!d)return!0;if(C.ref&&r(C.ref,C.name)&&!d)return!0;if(Lv(s,r))break}else if(Es(s)&&Lv(s,r))break}}};var fJ=(t,r,l)=>{const d=Dv(Sn(t,l));return Oi(d,"root",r[l]),Oi(t,l,d),t},aP=t=>t.type==="file",xu=t=>typeof t=="function",Ew=t=>{if(!iP)return!1;const r=t?t.ownerDocument:0;return t instanceof(r&&r.defaultView?r.defaultView.HTMLElement:HTMLElement)},Ob=t=>Cc(t),lP=t=>t.type==="radio",Cw=t=>t instanceof RegExp;const yN={value:!1,isValid:!1},vN={value:!0,isValid:!0};var AB=t=>{if(Array.isArray(t)){if(t.length>1){const r=t.filter(l=>l&&l.checked&&!l.disabled).map(l=>l.value);return{value:r,isValid:!!r.length}}return t[0].checked&&!t[0].disabled?t[0].attributes&&!ys(t[0].attributes.value)?ys(t[0].value)||t[0].value===""?vN:{value:t[0].value,isValid:!0}:vN:yN}return yN};const xN={isValid:!1,value:null};var IB=t=>Array.isArray(t)?t.reduce((r,l)=>l&&l.checked&&!l.disabled?{isValid:!0,value:l.value}:r,xN):xN;function bN(t,r,l="validate"){if(Ob(t)||Array.isArray(t)&&t.every(Ob)||qa(t)&&!t)return{type:l,message:Ob(t)?t:"",ref:r}}var Hm=t=>Es(t)&&!Cw(t)?t:{value:t,message:""},wN=async(t,r,l,d,_)=>{const{ref:x,refs:C,required:s,maxLength:k,minLength:z,min:V,max:U,pattern:$,validate:se,name:ae,valueAsNumber:H,mount:ne,disabled:Y}=t._f,te=Sn(r,ae);if(!ne||Y)return{};const de=C?C[0]:x,Me=Pt=>{d&&de.reportValidity&&(de.setCustomValidity(qa(Pt)?"":Pt||""),de.reportValidity())},Le={},lt=lP(x),Pe=Ux(x),Ye=lt||Pe,vt=(H||aP(x))&&ys(x.value)&&ys(te)||Ew(x)&&x.value===""||te===""||Array.isArray(te)&&!te.length,It=CB.bind(null,ae,l,Le),Ut=(Pt,$t,Ve,jt=du.maxLength,Je=du.minLength)=>{const mt=Pt?$t:Ve;Le[ae]={type:Pt?jt:Je,message:mt,ref:x,...It(Pt?jt:Je,mt)}};if(_?!Array.isArray(te)||!te.length:s&&(!Ye&&(vt||Go(te))||qa(te)&&!te||Pe&&!AB(C).isValid||lt&&!IB(C).isValid)){const{value:Pt,message:$t}=Ob(s)?{value:!!s,message:s}:Hm(s);if(Pt&&(Le[ae]={type:du.required,message:$t,ref:de,...It(du.required,$t)},!l))return Me($t),Le}if(!vt&&(!Go(V)||!Go(U))){let Pt,$t;const Ve=Hm(U),jt=Hm(V);if(!Go(te)&&!isNaN(te)){const Je=x.valueAsNumber||te&&+te;Go(Ve.value)||(Pt=Je>Ve.value),Go(jt.value)||($t=Je<jt.value)}else{const Je=x.valueAsDate||new Date(te),mt=Ct=>new Date(new Date().toDateString()+" "+Ct),Be=x.type=="time",ft=x.type=="week";Cc(Ve.value)&&te&&(Pt=Be?mt(te)>mt(Ve.value):ft?te>Ve.value:Je>new Date(Ve.value)),Cc(jt.value)&&te&&($t=Be?mt(te)<mt(jt.value):ft?te<jt.value:Je<new Date(jt.value))}if((Pt||$t)&&(Ut(!!Pt,Ve.message,jt.message,du.max,du.min),!l))return Me(Le[ae].message),Le}if((k||z)&&!vt&&(Cc(te)||_&&Array.isArray(te))){const Pt=Hm(k),$t=Hm(z),Ve=!Go(Pt.value)&&te.length>+Pt.value,jt=!Go($t.value)&&te.length<+$t.value;if((Ve||jt)&&(Ut(Ve,Pt.message,$t.message),!l))return Me(Le[ae].message),Le}if($&&!vt&&Cc(te)){const{value:Pt,message:$t}=Hm($);if(Cw(Pt)&&!te.match(Pt)&&(Le[ae]={type:du.pattern,message:$t,ref:x,...It(du.pattern,$t)},!l))return Me($t),Le}if(se){if(xu(se)){const Pt=await se(te,r),$t=bN(Pt,de);if($t&&(Le[ae]={...$t,...It(du.validate,$t.message)},!l))return Me($t.message),Le}else if(Es(se)){let Pt={};for(const $t in se){if(!la(Pt)&&!l)break;const Ve=bN(await se[$t](te,r),de,$t);Ve&&(Pt={...Ve,...It($t,Ve.message)},Me(Ve.message),l&&(Le[ae]=Pt))}if(!la(Pt)&&(Le[ae]={ref:de,...Pt},!l))return Le}}return Me(!0),Le};function pJ(t,r){const l=r.slice(0,-1).length;let d=0;for(;d<l;)t=ys(t)?d++:t[r[d++]];return t}function mJ(t){for(const r in t)if(t.hasOwnProperty(r)&&!ys(t[r]))return!1;return!0}function Us(t,r){const l=Array.isArray(r)?r:sP(r)?[r]:xB(r),d=l.length===1?t:pJ(t,l),_=l.length-1,x=l[_];return d&&delete d[x],_!==0&&(Es(d)&&la(d)||Array.isArray(d)&&mJ(d))&&Us(t,l.slice(0,-1)),t}var bE=()=>{let t=[];return{get observers(){return t},next:_=>{for(const x of t)x.next&&x.next(_)},subscribe:_=>(t.push(_),{unsubscribe:()=>{t=t.filter(x=>x!==_)}}),unsubscribe:()=>{t=[]}}},sA=t=>Go(t)||!_B(t);function Nd(t,r){if(sA(t)||sA(r))return t===r;if(Ff(t)&&Ff(r))return t.getTime()===r.getTime();const l=Object.keys(t),d=Object.keys(r);if(l.length!==d.length)return!1;for(const _ of l){const x=t[_];if(!d.includes(_))return!1;if(_!=="ref"){const C=r[_];if(Ff(x)&&Ff(C)||Es(x)&&Es(C)||Array.isArray(x)&&Array.isArray(C)?!Nd(x,C):x!==C)return!1}}return!0}var PB=t=>t.type==="select-multiple",gJ=t=>lP(t)||Ux(t),wE=t=>Ew(t)&&t.isConnected,MB=t=>{for(const r in t)if(xu(t[r]))return!0;return!1};function Aw(t,r={}){const l=Array.isArray(t);if(Es(t)||l)for(const d in t)Array.isArray(t[d])||Es(t[d])&&!MB(t[d])?(r[d]=Array.isArray(t[d])?[]:{},Aw(t[d],r[d])):Go(t[d])||(r[d]=!0);return r}function RB(t,r,l){const d=Array.isArray(t);if(Es(t)||d)for(const _ in t)Array.isArray(t[_])||Es(t[_])&&!MB(t[_])?ys(r)||sA(l[_])?l[_]=Array.isArray(t[_])?Aw(t[_],[]):{...Aw(t[_])}:RB(t[_],Go(r)?{}:r[_],l[_]):l[_]=!Nd(t[_],r[_]);return l}var cv=(t,r)=>RB(t,r,Aw(r)),kB=(t,{valueAsNumber:r,valueAsDate:l,setValueAs:d})=>ys(t)?t:r?t===""?NaN:t&&+t:l&&Cc(t)?new Date(t):d?d(t):t;function SE(t){const r=t.ref;if(!(t.refs?t.refs.every(l=>l.disabled):r.disabled))return aP(r)?r.files:lP(r)?IB(t.refs).value:PB(r)?[...r.selectedOptions].map(({value:l})=>l):Ux(r)?AB(t.refs).value:kB(ys(r.value)?t.ref.value:r.value,t)}var _J=(t,r,l,d)=>{const _={};for(const x of t){const C=Sn(r,x);C&&Oi(_,x,C._f)}return{criteriaMode:l,names:[...t],fields:_,shouldUseNativeValidation:d}},uv=t=>ys(t)?t:Cw(t)?t.source:Es(t)?Cw(t.value)?t.value.source:t.value:t;const SN="AsyncFunction";var yJ=t=>(!t||!t.validate)&&!!(xu(t.validate)&&t.validate.constructor.name===SN||Es(t.validate)&&Object.values(t.validate).find(r=>r.constructor.name===SN)),vJ=t=>t.mount&&(t.required||t.min||t.max||t.maxLength||t.minLength||t.pattern||t.validate);function TN(t,r,l){const d=Sn(t,l);if(d||sP(l))return{error:d,name:l};const _=l.split(".");for(;_.length;){const x=_.join("."),C=Sn(r,x),s=Sn(t,x);if(C&&!Array.isArray(C)&&l!==x)return{name:l};if(s&&s.type)return{name:x,error:s};_.pop()}return{name:l}}var xJ=(t,r,l,d,_)=>_.isOnAll?!1:!l&&_.isOnTouch?!(r||t):(l?d.isOnBlur:_.isOnBlur)?!t:(l?d.isOnChange:_.isOnChange)?t:!0,bJ=(t,r)=>!A2(Sn(t,r)).length&&Us(t,r);const wJ={mode:Rl.onSubmit,reValidateMode:Rl.onChange,shouldFocusError:!0};function SJ(t={}){let r={...wJ,...t},l={submitCount:0,isDirty:!1,isLoading:xu(r.defaultValues),isValidating:!1,isSubmitted:!1,isSubmitting:!1,isSubmitSuccessful:!1,isValid:!1,touchedFields:{},dirtyFields:{},validatingFields:{},errors:r.errors||{},disabled:r.disabled||!1},d={},_=Es(r.defaultValues)||Es(r.values)?sa(r.defaultValues||r.values)||{}:{},x=r.shouldUnregister?{}:sa(_),C={action:!1,mount:!1,watch:!1},s={mount:new Set,unMount:new Set,array:new Set,watch:new Set},k,z=0;const V={isDirty:!1,dirtyFields:!1,validatingFields:!1,touchedFields:!1,isValidating:!1,isValid:!1,errors:!1},U={values:bE(),array:bE(),state:bE()},$=gN(r.mode),se=gN(r.reValidateMode),ae=r.criteriaMode===Rl.all,H=We=>ut=>{clearTimeout(z),z=setTimeout(We,ut)},ne=async We=>{if(!t.disabled&&(V.isValid||We)){const ut=r.resolver?la((await Ye()).errors):await It(d,!0);ut!==l.isValid&&U.state.next({isValid:ut})}},Y=(We,ut)=>{!t.disabled&&(V.isValidating||V.validatingFields)&&((We||Array.from(s.mount)).forEach(Mt=>{Mt&&(ut?Oi(l.validatingFields,Mt,ut):Us(l.validatingFields,Mt))}),U.state.next({validatingFields:l.validatingFields,isValidating:!la(l.validatingFields)}))},te=(We,ut=[],Mt,bn,pn=!0,sn=!0)=>{if(bn&&Mt&&!t.disabled){if(C.action=!0,sn&&Array.isArray(Sn(d,We))){const kn=Mt(Sn(d,We),bn.argA,bn.argB);pn&&Oi(d,We,kn)}if(sn&&Array.isArray(Sn(l.errors,We))){const kn=Mt(Sn(l.errors,We),bn.argA,bn.argB);pn&&Oi(l.errors,We,kn),bJ(l.errors,We)}if(V.touchedFields&&sn&&Array.isArray(Sn(l.touchedFields,We))){const kn=Mt(Sn(l.touchedFields,We),bn.argA,bn.argB);pn&&Oi(l.touchedFields,We,kn)}V.dirtyFields&&(l.dirtyFields=cv(_,x)),U.state.next({name:We,isDirty:Pt(We,ut),dirtyFields:l.dirtyFields,errors:l.errors,isValid:l.isValid})}else Oi(x,We,ut)},de=(We,ut)=>{Oi(l.errors,We,ut),U.state.next({errors:l.errors})},Me=We=>{l.errors=We,U.state.next({errors:l.errors,isValid:!1})},Le=(We,ut,Mt,bn)=>{const pn=Sn(d,We);if(pn){const sn=Sn(x,We,ys(Mt)?Sn(_,We):Mt);ys(sn)||bn&&bn.defaultChecked||ut?Oi(x,We,ut?sn:SE(pn._f)):jt(We,sn),C.mount&&ne()}},lt=(We,ut,Mt,bn,pn)=>{let sn=!1,kn=!1;const pr={name:We};if(!t.disabled){const Ni=!!(Sn(d,We)&&Sn(d,We)._f&&Sn(d,We)._f.disabled);if(!Mt||bn){V.isDirty&&(kn=l.isDirty,l.isDirty=pr.isDirty=Pt(),sn=kn!==pr.isDirty);const Vr=Ni||Nd(Sn(_,We),ut);kn=!!(!Ni&&Sn(l.dirtyFields,We)),Vr||Ni?Us(l.dirtyFields,We):Oi(l.dirtyFields,We,!0),pr.dirtyFields=l.dirtyFields,sn=sn||V.dirtyFields&&kn!==!Vr}if(Mt){const Vr=Sn(l.touchedFields,We);Vr||(Oi(l.touchedFields,We,Mt),pr.touchedFields=l.touchedFields,sn=sn||V.touchedFields&&Vr!==Mt)}sn&&pn&&U.state.next(pr)}return sn?pr:{}},Pe=(We,ut,Mt,bn)=>{const pn=Sn(l.errors,We),sn=V.isValid&&qa(ut)&&l.isValid!==ut;if(t.delayError&&Mt?(k=H(()=>de(We,Mt)),k(t.delayError)):(clearTimeout(z),k=null,Mt?Oi(l.errors,We,Mt):Us(l.errors,We)),(Mt?!Nd(pn,Mt):pn)||!la(bn)||sn){const kn={...bn,...sn&&qa(ut)?{isValid:ut}:{},errors:l.errors,name:We};l={...l,...kn},U.state.next(kn)}},Ye=async We=>{Y(We,!0);const ut=await r.resolver(x,r.context,_J(We||s.mount,d,r.criteriaMode,r.shouldUseNativeValidation));return Y(We),ut},vt=async We=>{const{errors:ut}=await Ye(We);if(We)for(const Mt of We){const bn=Sn(ut,Mt);bn?Oi(l.errors,Mt,bn):Us(l.errors,Mt)}else l.errors=ut;return ut},It=async(We,ut,Mt={valid:!0})=>{for(const bn in We){const pn=We[bn];if(pn){const{_f:sn,...kn}=pn;if(sn){const pr=s.array.has(sn.name),Ni=pn._f&&yJ(pn._f);Ni&&V.validatingFields&&Y([bn],!0);const Vr=await wN(pn,x,ae,r.shouldUseNativeValidation&&!ut,pr);if(Ni&&V.validatingFields&&Y([bn]),Vr[sn.name]&&(Mt.valid=!1,ut))break;!ut&&(Sn(Vr,sn.name)?pr?fJ(l.errors,Vr,sn.name):Oi(l.errors,sn.name,Vr[sn.name]):Us(l.errors,sn.name))}!la(kn)&&await It(kn,ut,Mt)}}return Mt.valid},Ut=()=>{for(const We of s.unMount){const ut=Sn(d,We);ut&&(ut._f.refs?ut._f.refs.every(Mt=>!wE(Mt)):!wE(ut._f.ref))&&rn(We)}s.unMount=new Set},Pt=(We,ut)=>!t.disabled&&(We&&ut&&Oi(x,We,ut),!Nd(Zt(),_)),$t=(We,ut,Mt)=>EB(We,s,{...C.mount?x:ys(ut)?_:Cc(We)?{[We]:ut}:ut},Mt,ut),Ve=We=>A2(Sn(C.mount?x:_,We,t.shouldUnregister?Sn(_,We,[]):[])),jt=(We,ut,Mt={})=>{const bn=Sn(d,We);let pn=ut;if(bn){const sn=bn._f;sn&&(!sn.disabled&&Oi(x,We,kB(ut,sn)),pn=Ew(sn.ref)&&Go(ut)?"":ut,PB(sn.ref)?[...sn.ref.options].forEach(kn=>kn.selected=pn.includes(kn.value)):sn.refs?Ux(sn.ref)?sn.refs.length>1?sn.refs.forEach(kn=>(!kn.defaultChecked||!kn.disabled)&&(kn.checked=Array.isArray(pn)?!!pn.find(pr=>pr===kn.value):pn===kn.value)):sn.refs[0]&&(sn.refs[0].checked=!!pn):sn.refs.forEach(kn=>kn.checked=kn.value===pn):aP(sn.ref)?sn.ref.value="":(sn.ref.value=pn,sn.ref.type||U.values.next({name:We,values:{...x}})))}(Mt.shouldDirty||Mt.shouldTouch)&&lt(We,pn,Mt.shouldTouch,Mt.shouldDirty,!0),Mt.shouldValidate&&Ct(We)},Je=(We,ut,Mt)=>{for(const bn in ut){const pn=ut[bn],sn=`${We}.${bn}`,kn=Sn(d,sn);(s.array.has(We)||Es(pn)||kn&&!kn._f)&&!Ff(pn)?Je(sn,pn,Mt):jt(sn,pn,Mt)}},mt=(We,ut,Mt={})=>{const bn=Sn(d,We),pn=s.array.has(We),sn=sa(ut);Oi(x,We,sn),pn?(U.array.next({name:We,values:{...x}}),(V.isDirty||V.dirtyFields)&&Mt.shouldDirty&&U.state.next({name:We,dirtyFields:cv(_,x),isDirty:Pt(We,sn)})):bn&&!bn._f&&!Go(sn)?Je(We,sn,Mt):jt(We,sn,Mt),_N(We,s)&&U.state.next({...l}),U.values.next({name:C.mount?We:void 0,values:{...x}})},Be=async We=>{C.mount=!0;const ut=We.target;let Mt=ut.name,bn=!0;const pn=Sn(d,Mt),sn=()=>ut.type?SE(pn._f):yB(We),kn=pr=>{bn=Number.isNaN(pr)||Ff(pr)&&isNaN(pr.getTime())||Nd(pr,Sn(x,Mt,pr))};if(pn){let pr,Ni;const Vr=sn(),Zs=We.type===Tw.BLUR||We.type===Tw.FOCUS_OUT,As=!vJ(pn._f)&&!r.resolver&&!Sn(l.errors,Mt)&&!pn._f.deps||xJ(Zs,Sn(l.touchedFields,Mt),l.isSubmitted,se,$),ko=_N(Mt,s,Zs);Oi(x,Mt,Vr),Zs?(pn._f.onBlur&&pn._f.onBlur(We),k&&k(0)):pn._f.onChange&&pn._f.onChange(We);const Qi=lt(Mt,Vr,Zs,!1),Ns=!la(Qi)||ko;if(!Zs&&U.values.next({name:Mt,type:We.type,values:{...x}}),As)return V.isValid&&(t.mode==="onBlur"?Zs&&ne():ne()),Ns&&U.state.next({name:Mt,...ko?{}:Qi});if(!Zs&&ko&&U.state.next({...l}),r.resolver){const{errors:Do}=await Ye([Mt]);if(kn(Vr),bn){const Yo=TN(l.errors,d,Mt),_o=TN(Do,d,Yo.name||Mt);pr=_o.error,Mt=_o.name,Ni=la(Do)}}else Y([Mt],!0),pr=(await wN(pn,x,ae,r.shouldUseNativeValidation))[Mt],Y([Mt]),kn(Vr),bn&&(pr?Ni=!1:V.isValid&&(Ni=await It(d,!0)));bn&&(pn._f.deps&&Ct(pn._f.deps),Pe(Mt,Ni,pr,Qi))}},ft=(We,ut)=>{if(Sn(l.errors,ut)&&We.focus)return We.focus(),1},Ct=async(We,ut={})=>{let Mt,bn;const pn=Dv(We);if(r.resolver){const sn=await vt(ys(We)?We:pn);Mt=la(sn),bn=We?!pn.some(kn=>Sn(sn,kn)):Mt}else We?(bn=(await Promise.all(pn.map(async sn=>{const kn=Sn(d,sn);return await It(kn&&kn._f?{[sn]:kn}:kn)}))).every(Boolean),!(!bn&&!l.isValid)&&ne()):bn=Mt=await It(d);return U.state.next({...!Cc(We)||V.isValid&&Mt!==l.isValid?{}:{name:We},...r.resolver||!We?{isValid:Mt}:{},errors:l.errors}),ut.shouldFocus&&!bn&&Lv(d,ft,We?pn:s.mount),bn},Zt=We=>{const ut={...C.mount?x:_};return ys(We)?ut:Cc(We)?Sn(ut,We):We.map(Mt=>Sn(ut,Mt))},fn=(We,ut)=>({invalid:!!Sn((ut||l).errors,We),isDirty:!!Sn((ut||l).dirtyFields,We),error:Sn((ut||l).errors,We),isValidating:!!Sn(l.validatingFields,We),isTouched:!!Sn((ut||l).touchedFields,We)}),Qn=We=>{We&&Dv(We).forEach(ut=>Us(l.errors,ut)),U.state.next({errors:We?l.errors:{}})},$n=(We,ut,Mt)=>{const bn=(Sn(d,We,{_f:{}})._f||{}).ref,pn=Sn(l.errors,We)||{},{ref:sn,message:kn,type:pr,...Ni}=pn;Oi(l.errors,We,{...Ni,...ut,ref:bn}),U.state.next({name:We,errors:l.errors,isValid:!1}),Mt&&Mt.shouldFocus&&bn&&bn.focus&&bn.focus()},Hn=(We,ut)=>xu(We)?U.values.subscribe({next:Mt=>We($t(void 0,ut),Mt)}):$t(We,ut,!0),rn=(We,ut={})=>{for(const Mt of We?Dv(We):s.mount)s.mount.delete(Mt),s.array.delete(Mt),ut.keepValue||(Us(d,Mt),Us(x,Mt)),!ut.keepError&&Us(l.errors,Mt),!ut.keepDirty&&Us(l.dirtyFields,Mt),!ut.keepTouched&&Us(l.touchedFields,Mt),!ut.keepIsValidating&&Us(l.validatingFields,Mt),!r.shouldUnregister&&!ut.keepDefaultValue&&Us(_,Mt);U.values.next({values:{...x}}),U.state.next({...l,...ut.keepDirty?{isDirty:Pt()}:{}}),!ut.keepIsValid&&ne()},an=({disabled:We,name:ut,field:Mt,fields:bn,value:pn})=>{if(qa(We)&&C.mount||We){const sn=We?void 0:ys(pn)?SE(Mt?Mt._f:Sn(bn,ut)._f):pn;Oi(x,ut,sn),lt(ut,sn,!1,!1,!0)}},or=(We,ut={})=>{let Mt=Sn(d,We);const bn=qa(ut.disabled)||qa(t.disabled);return Oi(d,We,{...Mt||{},_f:{...Mt&&Mt._f?Mt._f:{ref:{name:We}},name:We,mount:!0,...ut}}),s.mount.add(We),Mt?an({field:Mt,disabled:qa(ut.disabled)?ut.disabled:t.disabled,name:We,value:ut.value}):Le(We,!0,ut.value),{...bn?{disabled:ut.disabled||t.disabled}:{},...r.progressive?{required:!!ut.required,min:uv(ut.min),max:uv(ut.max),minLength:uv(ut.minLength),maxLength:uv(ut.maxLength),pattern:uv(ut.pattern)}:{},name:We,onChange:Be,onBlur:Be,ref:pn=>{if(pn){or(We,ut),Mt=Sn(d,We);const sn=ys(pn.value)&&pn.querySelectorAll&&pn.querySelectorAll("input,select,textarea")[0]||pn,kn=gJ(sn),pr=Mt._f.refs||[];if(kn?pr.find(Ni=>Ni===sn):sn===Mt._f.ref)return;Oi(d,We,{_f:{...Mt._f,...kn?{refs:[...pr.filter(wE),sn,...Array.isArray(Sn(_,We))?[{}]:[]],ref:{type:sn.type,name:We}}:{ref:sn}}}),Le(We,!1,void 0,sn)}else Mt=Sn(d,We,{}),Mt._f&&(Mt._f.mount=!1),(r.shouldUnregister||ut.shouldUnregister)&&!(vB(s.array,We)&&C.action)&&s.unMount.add(We)}}},Mn=()=>r.shouldFocusError&&Lv(d,ft,s.mount),Mr=We=>{qa(We)&&(U.state.next({disabled:We}),Lv(d,(ut,Mt)=>{const bn=Sn(d,Mt);bn&&(ut.disabled=bn._f.disabled||We,Array.isArray(bn._f.refs)&&bn._f.refs.forEach(pn=>{pn.disabled=bn._f.disabled||We}))},0,!1))},Lr=(We,ut)=>async Mt=>{let bn;Mt&&(Mt.preventDefault&&Mt.preventDefault(),Mt.persist&&Mt.persist());let pn=sa(x);if(U.state.next({isSubmitting:!0}),r.resolver){const{errors:sn,values:kn}=await Ye();l.errors=sn,pn=kn}else await It(d);if(Us(l.errors,"root"),la(l.errors)){U.state.next({errors:{}});try{await We(pn,Mt)}catch(sn){bn=sn}}else ut&&await ut({...l.errors},Mt),Mn(),setTimeout(Mn);if(U.state.next({isSubmitted:!0,isSubmitting:!1,isSubmitSuccessful:la(l.errors)&&!bn,submitCount:l.submitCount+1,errors:l.errors}),bn)throw bn},xr=(We,ut={})=>{Sn(d,We)&&(ys(ut.defaultValue)?mt(We,sa(Sn(_,We))):(mt(We,ut.defaultValue),Oi(_,We,sa(ut.defaultValue))),ut.keepTouched||Us(l.touchedFields,We),ut.keepDirty||(Us(l.dirtyFields,We),l.isDirty=ut.defaultValue?Pt(We,sa(Sn(_,We))):Pt()),ut.keepError||(Us(l.errors,We),V.isValid&&ne()),U.state.next({...l}))},Tr=(We,ut={})=>{const Mt=We?sa(We):_,bn=sa(Mt),pn=la(We),sn=pn?_:bn;if(ut.keepDefaultValues||(_=Mt),!ut.keepValues){if(ut.keepDirtyValues){const kn=new Set([...s.mount,...Object.keys(cv(_,x))]);for(const pr of Array.from(kn))Sn(l.dirtyFields,pr)?Oi(sn,pr,Sn(x,pr)):mt(pr,Sn(sn,pr))}else{if(iP&&ys(We))for(const kn of s.mount){const pr=Sn(d,kn);if(pr&&pr._f){const Ni=Array.isArray(pr._f.refs)?pr._f.refs[0]:pr._f.ref;if(Ew(Ni)){const Vr=Ni.closest("form");if(Vr){Vr.reset();break}}}}d={}}x=t.shouldUnregister?ut.keepDefaultValues?sa(_):{}:sa(sn),U.array.next({values:{...sn}}),U.values.next({values:{...sn}})}s={mount:ut.keepDirtyValues?s.mount:new Set,unMount:new Set,array:new Set,watch:new Set,watchAll:!1,focus:""},C.mount=!V.isValid||!!ut.keepIsValid||!!ut.keepDirtyValues,C.watch=!!t.shouldUnregister,U.state.next({submitCount:ut.keepSubmitCount?l.submitCount:0,isDirty:pn?!1:ut.keepDirty?l.isDirty:!!(ut.keepDefaultValues&&!Nd(We,_)),isSubmitted:ut.keepIsSubmitted?l.isSubmitted:!1,dirtyFields:pn?{}:ut.keepDirtyValues?ut.keepDefaultValues&&x?cv(_,x):l.dirtyFields:ut.keepDefaultValues&&We?cv(_,We):ut.keepDirty?l.dirtyFields:{},touchedFields:ut.keepTouched?l.touchedFields:{},errors:ut.keepErrors?l.errors:{},isSubmitSuccessful:ut.keepIsSubmitSuccessful?l.isSubmitSuccessful:!1,isSubmitting:!1})},Ki=(We,ut)=>Tr(xu(We)?We(x):We,ut);return{control:{register:or,unregister:rn,getFieldState:fn,handleSubmit:Lr,setError:$n,_executeSchema:Ye,_getWatch:$t,_getDirty:Pt,_updateValid:ne,_removeUnmounted:Ut,_updateFieldArray:te,_updateDisabledField:an,_getFieldArray:Ve,_reset:Tr,_resetDefaultValues:()=>xu(r.defaultValues)&&r.defaultValues().then(We=>{Ki(We,r.resetOptions),U.state.next({isLoading:!1})}),_updateFormState:We=>{l={...l,...We}},_disableForm:Mr,_subjects:U,_proxyFormState:V,_setErrors:Me,get _fields(){return d},get _formValues(){return x},get _state(){return C},set _state(We){C=We},get _defaultValues(){return _},get _names(){return s},set _names(We){s=We},get _formState(){return l},set _formState(We){l=We},get _options(){return r},set _options(We){r={...r,...We}}},trigger:Ct,register:or,handleSubmit:Lr,watch:Hn,setValue:mt,getValues:Zt,reset:Ki,resetField:xr,clearErrors:Qn,unregister:rn,setError:$n,setFocus:(We,ut={})=>{const Mt=Sn(d,We),bn=Mt&&Mt._f;if(bn){const pn=bn.refs?bn.refs[0]:bn.ref;pn.focus&&(pn.focus(),ut.shouldSelect&&pn.select())}},getFieldState:fn}}function DB(t={}){const r=Nt.useRef(),l=Nt.useRef(),[d,_]=Nt.useState({isDirty:!1,isValidating:!1,isLoading:xu(t.defaultValues),isSubmitted:!1,isSubmitting:!1,isSubmitSuccessful:!1,isValid:!1,submitCount:0,dirtyFields:{},touchedFields:{},validatingFields:{},errors:t.errors||{},disabled:t.disabled||!1,defaultValues:xu(t.defaultValues)?void 0:t.defaultValues});r.current||(r.current={...SJ(t),formState:d});const x=r.current.control;return x._options=t,oP({subject:x._subjects.state,next:C=>{SB(C,x._proxyFormState,x._updateFormState,!0)&&_({...x._formState})}}),Nt.useEffect(()=>x._disableForm(t.disabled),[x,t.disabled]),Nt.useEffect(()=>{if(x._proxyFormState.isDirty){const C=x._getDirty();C!==d.isDirty&&x._subjects.state.next({isDirty:C})}},[x,d.isDirty]),Nt.useEffect(()=>{t.values&&!Nd(t.values,l.current)?(x._reset(t.values,x._options.resetOptions),l.current=t.values,_(C=>({...C}))):x._resetDefaultValues()},[t.values,x]),Nt.useEffect(()=>{t.errors&&x._setErrors(t.errors)},[t.errors,x]),Nt.useEffect(()=>{x._state.mount||(x._updateValid(),x._state.mount=!0),x._state.watch&&(x._state.watch=!1,x._subjects.state.next({...x._formState})),x._removeUnmounted()}),Nt.useEffect(()=>{t.shouldUnregister&&x._subjects.values.next({values:x._getWatch()})},[t.shouldUnregister,x]),Nt.useEffect(()=>{r.current&&(r.current.watch=r.current.watch.bind({}))},[d]),r.current.formState=wB(d,x),r.current}const EN=(t,r,l)=>{if(t&&"reportValidity"in t){const d=Sn(l,r);t.setCustomValidity(d&&d.message||""),t.reportValidity()}},LB=(t,r)=>{for(const l in r.fields){const d=r.fields[l];d&&d.ref&&"reportValidity"in d.ref?EN(d.ref,l,t):d.refs&&d.refs.forEach(_=>EN(_,l,t))}},TJ=(t,r)=>{r.shouldUseNativeValidation&&LB(t,r);const l={};for(const d in t){const _=Sn(r.fields,d),x=Object.assign(t[d]||{},{ref:_&&_.ref});if(EJ(r.names||Object.keys(t),d)){const C=Object.assign({},Sn(l,d));Oi(C,"root",x),Oi(l,d,C)}else Oi(l,d,x)}return l},EJ=(t,r)=>t.some(l=>l.startsWith(r+"."));var CJ=function(t,r){for(var l={};t.length;){var d=t[0],_=d.code,x=d.message,C=d.path.join(".");if(!l[C])if("unionErrors"in d){var s=d.unionErrors[0].errors[0];l[C]={message:s.message,type:s.code}}else l[C]={message:x,type:_};if("unionErrors"in d&&d.unionErrors.forEach(function(V){return V.errors.forEach(function(U){return t.push(U)})}),r){var k=l[C].types,z=k&&k[d.code];l[C]=CB(C,r,l,_,z?[].concat(z,d.message):d.message)}t.shift()}return l},NB=function(t,r,l){return l===void 0&&(l={}),function(d,_,x){try{return Promise.resolve(function(C,s){try{var k=Promise.resolve(t[l.mode==="sync"?"parse":"parseAsync"](d,r)).then(function(z){return x.shouldUseNativeValidation&&LB({},x),{errors:{},values:l.raw?d:z}})}catch(z){return s(z)}return k&&k.then?k.then(void 0,s):k}(0,function(C){if(function(s){return Array.isArray(s==null?void 0:s.errors)}(C))return{values:{},errors:TJ(CJ(C.errors,!x.shouldUseNativeValidation&&x.criteriaMode==="all"),x)};throw C}))}catch(C){return Promise.reject(C)}}},Ci;(function(t){t.assertEqual=_=>_;function r(_){}t.assertIs=r;function l(_){throw new Error}t.assertNever=l,t.arrayToEnum=_=>{const x={};for(const C of _)x[C]=C;return x},t.getValidEnumValues=_=>{const x=t.objectKeys(_).filter(s=>typeof _[_[s]]!="number"),C={};for(const s of x)C[s]=_[s];return t.objectValues(C)},t.objectValues=_=>t.objectKeys(_).map(function(x){return _[x]}),t.objectKeys=typeof Object.keys=="function"?_=>Object.keys(_):_=>{const x=[];for(const C in _)Object.prototype.hasOwnProperty.call(_,C)&&x.push(C);return x},t.find=(_,x)=>{for(const C of _)if(x(C))return C},t.isInteger=typeof Number.isInteger=="function"?_=>Number.isInteger(_):_=>typeof _=="number"&&isFinite(_)&&Math.floor(_)===_;function d(_,x=" | "){return _.map(C=>typeof C=="string"?`'${C}'`:C).join(x)}t.joinValues=d,t.jsonStringifyReplacer=(_,x)=>typeof x=="bigint"?x.toString():x})(Ci||(Ci={}));var oA;(function(t){t.mergeShapes=(r,l)=>({...r,...l})})(oA||(oA={}));const jn=Ci.arrayToEnum(["string","nan","number","integer","float","boolean","date","bigint","symbol","function","undefined","null","array","object","unknown","promise","void","never","map","set"]),zd=t=>{switch(typeof t){case"undefined":return jn.undefined;case"string":return jn.string;case"number":return isNaN(t)?jn.nan:jn.number;case"boolean":return jn.boolean;case"function":return jn.function;case"bigint":return jn.bigint;case"symbol":return jn.symbol;case"object":return Array.isArray(t)?jn.array:t===null?jn.null:t.then&&typeof t.then=="function"&&t.catch&&typeof t.catch=="function"?jn.promise:typeof Map<"u"&&t instanceof Map?jn.map:typeof Set<"u"&&t instanceof Set?jn.set:typeof Date<"u"&&t instanceof Date?jn.date:jn.object;default:return jn.unknown}},dn=Ci.arrayToEnum(["invalid_type","invalid_literal","custom","invalid_union","invalid_union_discriminator","invalid_enum_value","unrecognized_keys","invalid_arguments","invalid_return_type","invalid_date","invalid_string","too_small","too_big","invalid_intersection_types","not_multiple_of","not_finite"]),AJ=t=>JSON.stringify(t,null,2).replace(/"([^"]+)":/g,"$1:");class ka extends Error{constructor(r){super(),this.issues=[],this.addIssue=d=>{this.issues=[...this.issues,d]},this.addIssues=(d=[])=>{this.issues=[...this.issues,...d]};const l=new.target.prototype;Object.setPrototypeOf?Object.setPrototypeOf(this,l):this.__proto__=l,this.name="ZodError",this.issues=r}get errors(){return this.issues}format(r){const l=r||function(x){return x.message},d={_errors:[]},_=x=>{for(const C of x.issues)if(C.code==="invalid_union")C.unionErrors.map(_);else if(C.code==="invalid_return_type")_(C.returnTypeError);else if(C.code==="invalid_arguments")_(C.argumentsError);else if(C.path.length===0)d._errors.push(l(C));else{let s=d,k=0;for(;k<C.path.length;){const z=C.path[k];k===C.path.length-1?(s[z]=s[z]||{_errors:[]},s[z]._errors.push(l(C))):s[z]=s[z]||{_errors:[]},s=s[z],k++}}};return _(this),d}static assert(r){if(!(r instanceof ka))throw new Error(`Not a ZodError: ${r}`)}toString(){return this.message}get message(){return JSON.stringify(this.issues,Ci.jsonStringifyReplacer,2)}get isEmpty(){return this.issues.length===0}flatten(r=l=>l.message){const l={},d=[];for(const _ of this.issues)_.path.length>0?(l[_.path[0]]=l[_.path[0]]||[],l[_.path[0]].push(r(_))):d.push(r(_));return{formErrors:d,fieldErrors:l}}get formErrors(){return this.flatten()}}ka.create=t=>new ka(t);const Xg=(t,r)=>{let l;switch(t.code){case dn.invalid_type:t.received===jn.undefined?l="Required":l=`Expected ${t.expected}, received ${t.received}`;break;case dn.invalid_literal:l=`Invalid literal value, expected ${JSON.stringify(t.expected,Ci.jsonStringifyReplacer)}`;break;case dn.unrecognized_keys:l=`Unrecognized key(s) in object: ${Ci.joinValues(t.keys,", ")}`;break;case dn.invalid_union:l="Invalid input";break;case dn.invalid_union_discriminator:l=`Invalid discriminator value. Expected ${Ci.joinValues(t.options)}`;break;case dn.invalid_enum_value:l=`Invalid enum value. Expected ${Ci.joinValues(t.options)}, received '${t.received}'`;break;case dn.invalid_arguments:l="Invalid function arguments";break;case dn.invalid_return_type:l="Invalid function return type";break;case dn.invalid_date:l="Invalid date";break;case dn.invalid_string:typeof t.validation=="object"?"includes"in t.validation?(l=`Invalid input: must include "${t.validation.includes}"`,typeof t.validation.position=="number"&&(l=`${l} at one or more positions greater than or equal to ${t.validation.position}`)):"startsWith"in t.validation?l=`Invalid input: must start with "${t.validation.startsWith}"`:"endsWith"in t.validation?l=`Invalid input: must end with "${t.validation.endsWith}"`:Ci.assertNever(t.validation):t.validation!=="regex"?l=`Invalid ${t.validation}`:l="Invalid";break;case dn.too_small:t.type==="array"?l=`Array must contain ${t.exact?"exactly":t.inclusive?"at least":"more than"} ${t.minimum} element(s)`:t.type==="string"?l=`String must contain ${t.exact?"exactly":t.inclusive?"at least":"over"} ${t.minimum} character(s)`:t.type==="number"?l=`Number must be ${t.exact?"exactly equal to ":t.inclusive?"greater than or equal to ":"greater than "}${t.minimum}`:t.type==="date"?l=`Date must be ${t.exact?"exactly equal to ":t.inclusive?"greater than or equal to ":"greater than "}${new Date(Number(t.minimum))}`:l="Invalid input";break;case dn.too_big:t.type==="array"?l=`Array must contain ${t.exact?"exactly":t.inclusive?"at most":"less than"} ${t.maximum} element(s)`:t.type==="string"?l=`String must contain ${t.exact?"exactly":t.inclusive?"at most":"under"} ${t.maximum} character(s)`:t.type==="number"?l=`Number must be ${t.exact?"exactly":t.inclusive?"less than or equal to":"less than"} ${t.maximum}`:t.type==="bigint"?l=`BigInt must be ${t.exact?"exactly":t.inclusive?"less than or equal to":"less than"} ${t.maximum}`:t.type==="date"?l=`Date must be ${t.exact?"exactly":t.inclusive?"smaller than or equal to":"smaller than"} ${new Date(Number(t.maximum))}`:l="Invalid input";break;case dn.custom:l="Invalid input";break;case dn.invalid_intersection_types:l="Intersection results could not be merged";break;case dn.not_multiple_of:l=`Number must be a multiple of ${t.multipleOf}`;break;case dn.not_finite:l="Number must be finite";break;default:l=r.defaultError,Ci.assertNever(t)}return{message:l}};let zB=Xg;function IJ(t){zB=t}function Iw(){return zB}const Pw=t=>{const{data:r,path:l,errorMaps:d,issueData:_}=t,x=[...l,..._.path||[]],C={..._,path:x};if(_.message!==void 0)return{..._,path:x,message:_.message};let s="";const k=d.filter(z=>!!z).slice().reverse();for(const z of k)s=z(C,{data:r,defaultError:s}).message;return{..._,path:x,message:s}},PJ=[];function Ln(t,r){const l=Iw(),d=Pw({issueData:r,data:t.data,path:t.path,errorMaps:[t.common.contextualErrorMap,t.schemaErrorMap,l,l===Xg?void 0:Xg].filter(_=>!!_)});t.common.issues.push(d)}class Ro{constructor(){this.value="valid"}dirty(){this.value==="valid"&&(this.value="dirty")}abort(){this.value!=="aborted"&&(this.value="aborted")}static mergeArray(r,l){const d=[];for(const _ of l){if(_.status==="aborted")return Sr;_.status==="dirty"&&r.dirty(),d.push(_.value)}return{status:r.value,value:d}}static async mergeObjectAsync(r,l){const d=[];for(const _ of l){const x=await _.key,C=await _.value;d.push({key:x,value:C})}return Ro.mergeObjectSync(r,d)}static mergeObjectSync(r,l){const d={};for(const _ of l){const{key:x,value:C}=_;if(x.status==="aborted"||C.status==="aborted")return Sr;x.status==="dirty"&&r.dirty(),C.status==="dirty"&&r.dirty(),x.value!=="__proto__"&&(typeof C.value<"u"||_.alwaysSet)&&(d[x.value]=C.value)}return{status:r.value,value:d}}}const Sr=Object.freeze({status:"aborted"}),lg=t=>({status:"dirty",value:t}),qo=t=>({status:"valid",value:t}),aA=t=>t.status==="aborted",lA=t=>t.status==="dirty",lx=t=>t.status==="valid",cx=t=>typeof Promise<"u"&&t instanceof Promise;function Mw(t,r,l,d){if(typeof r=="function"?t!==r||!d:!r.has(t))throw new TypeError("Cannot read private member from an object whose class did not declare it");return r.get(t)}function OB(t,r,l,d,_){if(typeof r=="function"?t!==r||!_:!r.has(t))throw new TypeError("Cannot write private member to an object whose class did not declare it");return r.set(t,l),l}var ar;(function(t){t.errToObj=r=>typeof r=="string"?{message:r}:r||{},t.toString=r=>typeof r=="string"?r:r==null?void 0:r.message})(ar||(ar={}));var xv,bv;class Lc{constructor(r,l,d,_){this._cachedPath=[],this.parent=r,this.data=l,this._path=d,this._key=_}get path(){return this._cachedPath.length||(this._key instanceof Array?this._cachedPath.push(...this._path,...this._key):this._cachedPath.push(...this._path,this._key)),this._cachedPath}}const CN=(t,r)=>{if(lx(r))return{success:!0,data:r.value};if(!t.common.issues.length)throw new Error("Validation failed but no issues detected.");return{success:!1,get error(){if(this._error)return this._error;const l=new ka(t.common.issues);return this._error=l,this._error}}};function $r(t){if(!t)return{};const{errorMap:r,invalid_type_error:l,required_error:d,description:_}=t;if(r&&(l||d))throw new Error(`Can't use "invalid_type_error" or "required_error" in conjunction with custom error map.`);return r?{errorMap:r,description:_}:{errorMap:(C,s)=>{var k,z;const{message:V}=t;return C.code==="invalid_enum_value"?{message:V??s.defaultError}:typeof s.data>"u"?{message:(k=V??d)!==null&&k!==void 0?k:s.defaultError}:C.code!=="invalid_type"?{message:s.defaultError}:{message:(z=V??l)!==null&&z!==void 0?z:s.defaultError}},description:_}}class ti{constructor(r){this.spa=this.safeParseAsync,this._def=r,this.parse=this.parse.bind(this),this.safeParse=this.safeParse.bind(this),this.parseAsync=this.parseAsync.bind(this),this.safeParseAsync=this.safeParseAsync.bind(this),this.spa=this.spa.bind(this),this.refine=this.refine.bind(this),this.refinement=this.refinement.bind(this),this.superRefine=this.superRefine.bind(this),this.optional=this.optional.bind(this),this.nullable=this.nullable.bind(this),this.nullish=this.nullish.bind(this),this.array=this.array.bind(this),this.promise=this.promise.bind(this),this.or=this.or.bind(this),this.and=this.and.bind(this),this.transform=this.transform.bind(this),this.brand=this.brand.bind(this),this.default=this.default.bind(this),this.catch=this.catch.bind(this),this.describe=this.describe.bind(this),this.pipe=this.pipe.bind(this),this.readonly=this.readonly.bind(this),this.isNullable=this.isNullable.bind(this),this.isOptional=this.isOptional.bind(this)}get description(){return this._def.description}_getType(r){return zd(r.data)}_getOrReturnCtx(r,l){return l||{common:r.parent.common,data:r.data,parsedType:zd(r.data),schemaErrorMap:this._def.errorMap,path:r.path,parent:r.parent}}_processInputParams(r){return{status:new Ro,ctx:{common:r.parent.common,data:r.data,parsedType:zd(r.data),schemaErrorMap:this._def.errorMap,path:r.path,parent:r.parent}}}_parseSync(r){const l=this._parse(r);if(cx(l))throw new Error("Synchronous parse encountered promise.");return l}_parseAsync(r){const l=this._parse(r);return Promise.resolve(l)}parse(r,l){const d=this.safeParse(r,l);if(d.success)return d.data;throw d.error}safeParse(r,l){var d;const _={common:{issues:[],async:(d=l==null?void 0:l.async)!==null&&d!==void 0?d:!1,contextualErrorMap:l==null?void 0:l.errorMap},path:(l==null?void 0:l.path)||[],schemaErrorMap:this._def.errorMap,parent:null,data:r,parsedType:zd(r)},x=this._parseSync({data:r,path:_.path,parent:_});return CN(_,x)}async parseAsync(r,l){const d=await this.safeParseAsync(r,l);if(d.success)return d.data;throw d.error}async safeParseAsync(r,l){const d={common:{issues:[],contextualErrorMap:l==null?void 0:l.errorMap,async:!0},path:(l==null?void 0:l.path)||[],schemaErrorMap:this._def.errorMap,parent:null,data:r,parsedType:zd(r)},_=this._parse({data:r,path:d.path,parent:d}),x=await(cx(_)?_:Promise.resolve(_));return CN(d,x)}refine(r,l){const d=_=>typeof l=="string"||typeof l>"u"?{message:l}:typeof l=="function"?l(_):l;return this._refinement((_,x)=>{const C=r(_),s=()=>x.addIssue({code:dn.custom,...d(_)});return typeof Promise<"u"&&C instanceof Promise?C.then(k=>k?!0:(s(),!1)):C?!0:(s(),!1)})}refinement(r,l){return this._refinement((d,_)=>r(d)?!0:(_.addIssue(typeof l=="function"?l(d,_):l),!1))}_refinement(r){return new $l({schema:this,typeName:vr.ZodEffects,effect:{type:"refinement",refinement:r}})}superRefine(r){return this._refinement(r)}optional(){return Mc.create(this,this._def)}nullable(){return mh.create(this,this._def)}nullish(){return this.nullable().optional()}array(){return jl.create(this,this._def)}promise(){return Kg.create(this,this._def)}or(r){return fx.create([this,r],this._def)}and(r){return px.create(this,r,this._def)}transform(r){return new $l({...$r(this._def),schema:this,typeName:vr.ZodEffects,effect:{type:"transform",transform:r}})}default(r){const l=typeof r=="function"?r:()=>r;return new vx({...$r(this._def),innerType:this,defaultValue:l,typeName:vr.ZodDefault})}brand(){return new cP({typeName:vr.ZodBranded,type:this,...$r(this._def)})}catch(r){const l=typeof r=="function"?r:()=>r;return new xx({...$r(this._def),innerType:this,catchValue:l,typeName:vr.ZodCatch})}describe(r){const l=this.constructor;return new l({...this._def,description:r})}pipe(r){return $x.create(this,r)}readonly(){return bx.create(this)}isOptional(){return this.safeParse(void 0).success}isNullable(){return this.safeParse(null).success}}const MJ=/^c[^\s-]{8,}$/i,RJ=/^[0-9a-z]+$/,kJ=/^[0-9A-HJKMNP-TV-Z]{26}$/,DJ=/^[0-9a-fA-F]{8}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{12}$/i,LJ=/^[a-z0-9_-]{21}$/i,NJ=/^[-+]?P(?!$)(?:(?:[-+]?\d+Y)|(?:[-+]?\d+[.,]\d+Y$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:(?:[-+]?\d+W)|(?:[-+]?\d+[.,]\d+W$))?(?:(?:[-+]?\d+D)|(?:[-+]?\d+[.,]\d+D$))?(?:T(?=[\d+-])(?:(?:[-+]?\d+H)|(?:[-+]?\d+[.,]\d+H$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:[-+]?\d+(?:[.,]\d+)?S)?)??$/,zJ=/^(?!\.)(?!.*\.\.)([A-Z0-9_'+\-\.]*)[A-Z0-9_+-]@([A-Z0-9][A-Z0-9\-]*\.)+[A-Z]{2,}$/i,OJ="^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$";let TE;const FJ=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,jJ=/^(([a-f0-9]{1,4}:){7}|::([a-f0-9]{1,4}:){0,6}|([a-f0-9]{1,4}:){1}:([a-f0-9]{1,4}:){0,5}|([a-f0-9]{1,4}:){2}:([a-f0-9]{1,4}:){0,4}|([a-f0-9]{1,4}:){3}:([a-f0-9]{1,4}:){0,3}|([a-f0-9]{1,4}:){4}:([a-f0-9]{1,4}:){0,2}|([a-f0-9]{1,4}:){5}:([a-f0-9]{1,4}:){0,1})([a-f0-9]{1,4}|(((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2}))\.){3}((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2})))$/,BJ=/^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/,FB="((\\d\\d[2468][048]|\\d\\d[13579][26]|\\d\\d0[48]|[02468][048]00|[13579][26]00)-02-29|\\d{4}-((0[13578]|1[02])-(0[1-9]|[12]\\d|3[01])|(0[469]|11)-(0[1-9]|[12]\\d|30)|(02)-(0[1-9]|1\\d|2[0-8])))",VJ=new RegExp(`^${FB}$`);function jB(t){let r="([01]\\d|2[0-3]):[0-5]\\d:[0-5]\\d";return t.precision?r=`${r}\\.\\d{${t.precision}}`:t.precision==null&&(r=`${r}(\\.\\d+)?`),r}function UJ(t){return new RegExp(`^${jB(t)}$`)}function BB(t){let r=`${FB}T${jB(t)}`;const l=[];return l.push(t.local?"Z?":"Z"),t.offset&&l.push("([+-]\\d{2}:?\\d{2})"),r=`${r}(${l.join("|")})`,new RegExp(`^${r}$`)}function $J(t,r){return!!((r==="v4"||!r)&&FJ.test(t)||(r==="v6"||!r)&&jJ.test(t))}class Ll extends ti{_parse(r){if(this._def.coerce&&(r.data=String(r.data)),this._getType(r)!==jn.string){const x=this._getOrReturnCtx(r);return Ln(x,{code:dn.invalid_type,expected:jn.string,received:x.parsedType}),Sr}const d=new Ro;let _;for(const x of this._def.checks)if(x.kind==="min")r.data.length<x.value&&(_=this._getOrReturnCtx(r,_),Ln(_,{code:dn.too_small,minimum:x.value,type:"string",inclusive:!0,exact:!1,message:x.message}),d.dirty());else if(x.kind==="max")r.data.length>x.value&&(_=this._getOrReturnCtx(r,_),Ln(_,{code:dn.too_big,maximum:x.value,type:"string",inclusive:!0,exact:!1,message:x.message}),d.dirty());else if(x.kind==="length"){const C=r.data.length>x.value,s=r.data.length<x.value;(C||s)&&(_=this._getOrReturnCtx(r,_),C?Ln(_,{code:dn.too_big,maximum:x.value,type:"string",inclusive:!0,exact:!0,message:x.message}):s&&Ln(_,{code:dn.too_small,minimum:x.value,type:"string",inclusive:!0,exact:!0,message:x.message}),d.dirty())}else if(x.kind==="email")zJ.test(r.data)||(_=this._getOrReturnCtx(r,_),Ln(_,{validation:"email",code:dn.invalid_string,message:x.message}),d.dirty());else if(x.kind==="emoji")TE||(TE=new RegExp(OJ,"u")),TE.test(r.data)||(_=this._getOrReturnCtx(r,_),Ln(_,{validation:"emoji",code:dn.invalid_string,message:x.message}),d.dirty());else if(x.kind==="uuid")DJ.test(r.data)||(_=this._getOrReturnCtx(r,_),Ln(_,{validation:"uuid",code:dn.invalid_string,message:x.message}),d.dirty());else if(x.kind==="nanoid")LJ.test(r.data)||(_=this._getOrReturnCtx(r,_),Ln(_,{validation:"nanoid",code:dn.invalid_string,message:x.message}),d.dirty());else if(x.kind==="cuid")MJ.test(r.data)||(_=this._getOrReturnCtx(r,_),Ln(_,{validation:"cuid",code:dn.invalid_string,message:x.message}),d.dirty());else if(x.kind==="cuid2")RJ.test(r.data)||(_=this._getOrReturnCtx(r,_),Ln(_,{validation:"cuid2",code:dn.invalid_string,message:x.message}),d.dirty());else if(x.kind==="ulid")kJ.test(r.data)||(_=this._getOrReturnCtx(r,_),Ln(_,{validation:"ulid",code:dn.invalid_string,message:x.message}),d.dirty());else if(x.kind==="url")try{new URL(r.data)}catch{_=this._getOrReturnCtx(r,_),Ln(_,{validation:"url",code:dn.invalid_string,message:x.message}),d.dirty()}else x.kind==="regex"?(x.regex.lastIndex=0,x.regex.test(r.data)||(_=this._getOrReturnCtx(r,_),Ln(_,{validation:"regex",code:dn.invalid_string,message:x.message}),d.dirty())):x.kind==="trim"?r.data=r.data.trim():x.kind==="includes"?r.data.includes(x.value,x.position)||(_=this._getOrReturnCtx(r,_),Ln(_,{code:dn.invalid_string,validation:{includes:x.value,position:x.position},message:x.message}),d.dirty()):x.kind==="toLowerCase"?r.data=r.data.toLowerCase():x.kind==="toUpperCase"?r.data=r.data.toUpperCase():x.kind==="startsWith"?r.data.startsWith(x.value)||(_=this._getOrReturnCtx(r,_),Ln(_,{code:dn.invalid_string,validation:{startsWith:x.value},message:x.message}),d.dirty()):x.kind==="endsWith"?r.data.endsWith(x.value)||(_=this._getOrReturnCtx(r,_),Ln(_,{code:dn.invalid_string,validation:{endsWith:x.value},message:x.message}),d.dirty()):x.kind==="datetime"?BB(x).test(r.data)||(_=this._getOrReturnCtx(r,_),Ln(_,{code:dn.invalid_string,validation:"datetime",message:x.message}),d.dirty()):x.kind==="date"?VJ.test(r.data)||(_=this._getOrReturnCtx(r,_),Ln(_,{code:dn.invalid_string,validation:"date",message:x.message}),d.dirty()):x.kind==="time"?UJ(x).test(r.data)||(_=this._getOrReturnCtx(r,_),Ln(_,{code:dn.invalid_string,validation:"time",message:x.message}),d.dirty()):x.kind==="duration"?NJ.test(r.data)||(_=this._getOrReturnCtx(r,_),Ln(_,{validation:"duration",code:dn.invalid_string,message:x.message}),d.dirty()):x.kind==="ip"?$J(r.data,x.version)||(_=this._getOrReturnCtx(r,_),Ln(_,{validation:"ip",code:dn.invalid_string,message:x.message}),d.dirty()):x.kind==="base64"?BJ.test(r.data)||(_=this._getOrReturnCtx(r,_),Ln(_,{validation:"base64",code:dn.invalid_string,message:x.message}),d.dirty()):Ci.assertNever(x);return{status:d.value,value:r.data}}_regex(r,l,d){return this.refinement(_=>r.test(_),{validation:l,code:dn.invalid_string,...ar.errToObj(d)})}_addCheck(r){return new Ll({...this._def,checks:[...this._def.checks,r]})}email(r){return this._addCheck({kind:"email",...ar.errToObj(r)})}url(r){return this._addCheck({kind:"url",...ar.errToObj(r)})}emoji(r){return this._addCheck({kind:"emoji",...ar.errToObj(r)})}uuid(r){return this._addCheck({kind:"uuid",...ar.errToObj(r)})}nanoid(r){return this._addCheck({kind:"nanoid",...ar.errToObj(r)})}cuid(r){return this._addCheck({kind:"cuid",...ar.errToObj(r)})}cuid2(r){return this._addCheck({kind:"cuid2",...ar.errToObj(r)})}ulid(r){return this._addCheck({kind:"ulid",...ar.errToObj(r)})}base64(r){return this._addCheck({kind:"base64",...ar.errToObj(r)})}ip(r){return this._addCheck({kind:"ip",...ar.errToObj(r)})}datetime(r){var l,d;return typeof r=="string"?this._addCheck({kind:"datetime",precision:null,offset:!1,local:!1,message:r}):this._addCheck({kind:"datetime",precision:typeof(r==null?void 0:r.precision)>"u"?null:r==null?void 0:r.precision,offset:(l=r==null?void 0:r.offset)!==null&&l!==void 0?l:!1,local:(d=r==null?void 0:r.local)!==null&&d!==void 0?d:!1,...ar.errToObj(r==null?void 0:r.message)})}date(r){return this._addCheck({kind:"date",message:r})}time(r){return typeof r=="string"?this._addCheck({kind:"time",precision:null,message:r}):this._addCheck({kind:"time",precision:typeof(r==null?void 0:r.precision)>"u"?null:r==null?void 0:r.precision,...ar.errToObj(r==null?void 0:r.message)})}duration(r){return this._addCheck({kind:"duration",...ar.errToObj(r)})}regex(r,l){return this._addCheck({kind:"regex",regex:r,...ar.errToObj(l)})}includes(r,l){return this._addCheck({kind:"includes",value:r,position:l==null?void 0:l.position,...ar.errToObj(l==null?void 0:l.message)})}startsWith(r,l){return this._addCheck({kind:"startsWith",value:r,...ar.errToObj(l)})}endsWith(r,l){return this._addCheck({kind:"endsWith",value:r,...ar.errToObj(l)})}min(r,l){return this._addCheck({kind:"min",value:r,...ar.errToObj(l)})}max(r,l){return this._addCheck({kind:"max",value:r,...ar.errToObj(l)})}length(r,l){return this._addCheck({kind:"length",value:r,...ar.errToObj(l)})}nonempty(r){return this.min(1,ar.errToObj(r))}trim(){return new Ll({...this._def,checks:[...this._def.checks,{kind:"trim"}]})}toLowerCase(){return new Ll({...this._def,checks:[...this._def.checks,{kind:"toLowerCase"}]})}toUpperCase(){return new Ll({...this._def,checks:[...this._def.checks,{kind:"toUpperCase"}]})}get isDatetime(){return!!this._def.checks.find(r=>r.kind==="datetime")}get isDate(){return!!this._def.checks.find(r=>r.kind==="date")}get isTime(){return!!this._def.checks.find(r=>r.kind==="time")}get isDuration(){return!!this._def.checks.find(r=>r.kind==="duration")}get isEmail(){return!!this._def.checks.find(r=>r.kind==="email")}get isURL(){return!!this._def.checks.find(r=>r.kind==="url")}get isEmoji(){return!!this._def.checks.find(r=>r.kind==="emoji")}get isUUID(){return!!this._def.checks.find(r=>r.kind==="uuid")}get isNANOID(){return!!this._def.checks.find(r=>r.kind==="nanoid")}get isCUID(){return!!this._def.checks.find(r=>r.kind==="cuid")}get isCUID2(){return!!this._def.checks.find(r=>r.kind==="cuid2")}get isULID(){return!!this._def.checks.find(r=>r.kind==="ulid")}get isIP(){return!!this._def.checks.find(r=>r.kind==="ip")}get isBase64(){return!!this._def.checks.find(r=>r.kind==="base64")}get minLength(){let r=null;for(const l of this._def.checks)l.kind==="min"&&(r===null||l.value>r)&&(r=l.value);return r}get maxLength(){let r=null;for(const l of this._def.checks)l.kind==="max"&&(r===null||l.value<r)&&(r=l.value);return r}}Ll.create=t=>{var r;return new Ll({checks:[],typeName:vr.ZodString,coerce:(r=t==null?void 0:t.coerce)!==null&&r!==void 0?r:!1,...$r(t)})};function GJ(t,r){const l=(t.toString().split(".")[1]||"").length,d=(r.toString().split(".")[1]||"").length,_=l>d?l:d,x=parseInt(t.toFixed(_).replace(".","")),C=parseInt(r.toFixed(_).replace(".",""));return x%C/Math.pow(10,_)}class hh extends ti{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte,this.step=this.multipleOf}_parse(r){if(this._def.coerce&&(r.data=Number(r.data)),this._getType(r)!==jn.number){const x=this._getOrReturnCtx(r);return Ln(x,{code:dn.invalid_type,expected:jn.number,received:x.parsedType}),Sr}let d;const _=new Ro;for(const x of this._def.checks)x.kind==="int"?Ci.isInteger(r.data)||(d=this._getOrReturnCtx(r,d),Ln(d,{code:dn.invalid_type,expected:"integer",received:"float",message:x.message}),_.dirty()):x.kind==="min"?(x.inclusive?r.data<x.value:r.data<=x.value)&&(d=this._getOrReturnCtx(r,d),Ln(d,{code:dn.too_small,minimum:x.value,type:"number",inclusive:x.inclusive,exact:!1,message:x.message}),_.dirty()):x.kind==="max"?(x.inclusive?r.data>x.value:r.data>=x.value)&&(d=this._getOrReturnCtx(r,d),Ln(d,{code:dn.too_big,maximum:x.value,type:"number",inclusive:x.inclusive,exact:!1,message:x.message}),_.dirty()):x.kind==="multipleOf"?GJ(r.data,x.value)!==0&&(d=this._getOrReturnCtx(r,d),Ln(d,{code:dn.not_multiple_of,multipleOf:x.value,message:x.message}),_.dirty()):x.kind==="finite"?Number.isFinite(r.data)||(d=this._getOrReturnCtx(r,d),Ln(d,{code:dn.not_finite,message:x.message}),_.dirty()):Ci.assertNever(x);return{status:_.value,value:r.data}}gte(r,l){return this.setLimit("min",r,!0,ar.toString(l))}gt(r,l){return this.setLimit("min",r,!1,ar.toString(l))}lte(r,l){return this.setLimit("max",r,!0,ar.toString(l))}lt(r,l){return this.setLimit("max",r,!1,ar.toString(l))}setLimit(r,l,d,_){return new hh({...this._def,checks:[...this._def.checks,{kind:r,value:l,inclusive:d,message:ar.toString(_)}]})}_addCheck(r){return new hh({...this._def,checks:[...this._def.checks,r]})}int(r){return this._addCheck({kind:"int",message:ar.toString(r)})}positive(r){return this._addCheck({kind:"min",value:0,inclusive:!1,message:ar.toString(r)})}negative(r){return this._addCheck({kind:"max",value:0,inclusive:!1,message:ar.toString(r)})}nonpositive(r){return this._addCheck({kind:"max",value:0,inclusive:!0,message:ar.toString(r)})}nonnegative(r){return this._addCheck({kind:"min",value:0,inclusive:!0,message:ar.toString(r)})}multipleOf(r,l){return this._addCheck({kind:"multipleOf",value:r,message:ar.toString(l)})}finite(r){return this._addCheck({kind:"finite",message:ar.toString(r)})}safe(r){return this._addCheck({kind:"min",inclusive:!0,value:Number.MIN_SAFE_INTEGER,message:ar.toString(r)})._addCheck({kind:"max",inclusive:!0,value:Number.MAX_SAFE_INTEGER,message:ar.toString(r)})}get minValue(){let r=null;for(const l of this._def.checks)l.kind==="min"&&(r===null||l.value>r)&&(r=l.value);return r}get maxValue(){let r=null;for(const l of this._def.checks)l.kind==="max"&&(r===null||l.value<r)&&(r=l.value);return r}get isInt(){return!!this._def.checks.find(r=>r.kind==="int"||r.kind==="multipleOf"&&Ci.isInteger(r.value))}get isFinite(){let r=null,l=null;for(const d of this._def.checks){if(d.kind==="finite"||d.kind==="int"||d.kind==="multipleOf")return!0;d.kind==="min"?(l===null||d.value>l)&&(l=d.value):d.kind==="max"&&(r===null||d.value<r)&&(r=d.value)}return Number.isFinite(l)&&Number.isFinite(r)}}hh.create=t=>new hh({checks:[],typeName:vr.ZodNumber,coerce:(t==null?void 0:t.coerce)||!1,...$r(t)});class fh extends ti{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte}_parse(r){if(this._def.coerce&&(r.data=BigInt(r.data)),this._getType(r)!==jn.bigint){const x=this._getOrReturnCtx(r);return Ln(x,{code:dn.invalid_type,expected:jn.bigint,received:x.parsedType}),Sr}let d;const _=new Ro;for(const x of this._def.checks)x.kind==="min"?(x.inclusive?r.data<x.value:r.data<=x.value)&&(d=this._getOrReturnCtx(r,d),Ln(d,{code:dn.too_small,type:"bigint",minimum:x.value,inclusive:x.inclusive,message:x.message}),_.dirty()):x.kind==="max"?(x.inclusive?r.data>x.value:r.data>=x.value)&&(d=this._getOrReturnCtx(r,d),Ln(d,{code:dn.too_big,type:"bigint",maximum:x.value,inclusive:x.inclusive,message:x.message}),_.dirty()):x.kind==="multipleOf"?r.data%x.value!==BigInt(0)&&(d=this._getOrReturnCtx(r,d),Ln(d,{code:dn.not_multiple_of,multipleOf:x.value,message:x.message}),_.dirty()):Ci.assertNever(x);return{status:_.value,value:r.data}}gte(r,l){return this.setLimit("min",r,!0,ar.toString(l))}gt(r,l){return this.setLimit("min",r,!1,ar.toString(l))}lte(r,l){return this.setLimit("max",r,!0,ar.toString(l))}lt(r,l){return this.setLimit("max",r,!1,ar.toString(l))}setLimit(r,l,d,_){return new fh({...this._def,checks:[...this._def.checks,{kind:r,value:l,inclusive:d,message:ar.toString(_)}]})}_addCheck(r){return new fh({...this._def,checks:[...this._def.checks,r]})}positive(r){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!1,message:ar.toString(r)})}negative(r){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!1,message:ar.toString(r)})}nonpositive(r){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!0,message:ar.toString(r)})}nonnegative(r){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!0,message:ar.toString(r)})}multipleOf(r,l){return this._addCheck({kind:"multipleOf",value:r,message:ar.toString(l)})}get minValue(){let r=null;for(const l of this._def.checks)l.kind==="min"&&(r===null||l.value>r)&&(r=l.value);return r}get maxValue(){let r=null;for(const l of this._def.checks)l.kind==="max"&&(r===null||l.value<r)&&(r=l.value);return r}}fh.create=t=>{var r;return new fh({checks:[],typeName:vr.ZodBigInt,coerce:(r=t==null?void 0:t.coerce)!==null&&r!==void 0?r:!1,...$r(t)})};class ux extends ti{_parse(r){if(this._def.coerce&&(r.data=!!r.data),this._getType(r)!==jn.boolean){const d=this._getOrReturnCtx(r);return Ln(d,{code:dn.invalid_type,expected:jn.boolean,received:d.parsedType}),Sr}return qo(r.data)}}ux.create=t=>new ux({typeName:vr.ZodBoolean,coerce:(t==null?void 0:t.coerce)||!1,...$r(t)});class fp extends ti{_parse(r){if(this._def.coerce&&(r.data=new Date(r.data)),this._getType(r)!==jn.date){const x=this._getOrReturnCtx(r);return Ln(x,{code:dn.invalid_type,expected:jn.date,received:x.parsedType}),Sr}if(isNaN(r.data.getTime())){const x=this._getOrReturnCtx(r);return Ln(x,{code:dn.invalid_date}),Sr}const d=new Ro;let _;for(const x of this._def.checks)x.kind==="min"?r.data.getTime()<x.value&&(_=this._getOrReturnCtx(r,_),Ln(_,{code:dn.too_small,message:x.message,inclusive:!0,exact:!1,minimum:x.value,type:"date"}),d.dirty()):x.kind==="max"?r.data.getTime()>x.value&&(_=this._getOrReturnCtx(r,_),Ln(_,{code:dn.too_big,message:x.message,inclusive:!0,exact:!1,maximum:x.value,type:"date"}),d.dirty()):Ci.assertNever(x);return{status:d.value,value:new Date(r.data.getTime())}}_addCheck(r){return new fp({...this._def,checks:[...this._def.checks,r]})}min(r,l){return this._addCheck({kind:"min",value:r.getTime(),message:ar.toString(l)})}max(r,l){return this._addCheck({kind:"max",value:r.getTime(),message:ar.toString(l)})}get minDate(){let r=null;for(const l of this._def.checks)l.kind==="min"&&(r===null||l.value>r)&&(r=l.value);return r!=null?new Date(r):null}get maxDate(){let r=null;for(const l of this._def.checks)l.kind==="max"&&(r===null||l.value<r)&&(r=l.value);return r!=null?new Date(r):null}}fp.create=t=>new fp({checks:[],coerce:(t==null?void 0:t.coerce)||!1,typeName:vr.ZodDate,...$r(t)});class Rw extends ti{_parse(r){if(this._getType(r)!==jn.symbol){const d=this._getOrReturnCtx(r);return Ln(d,{code:dn.invalid_type,expected:jn.symbol,received:d.parsedType}),Sr}return qo(r.data)}}Rw.create=t=>new Rw({typeName:vr.ZodSymbol,...$r(t)});class dx extends ti{_parse(r){if(this._getType(r)!==jn.undefined){const d=this._getOrReturnCtx(r);return Ln(d,{code:dn.invalid_type,expected:jn.undefined,received:d.parsedType}),Sr}return qo(r.data)}}dx.create=t=>new dx({typeName:vr.ZodUndefined,...$r(t)});class hx extends ti{_parse(r){if(this._getType(r)!==jn.null){const d=this._getOrReturnCtx(r);return Ln(d,{code:dn.invalid_type,expected:jn.null,received:d.parsedType}),Sr}return qo(r.data)}}hx.create=t=>new hx({typeName:vr.ZodNull,...$r(t)});class Yg extends ti{constructor(){super(...arguments),this._any=!0}_parse(r){return qo(r.data)}}Yg.create=t=>new Yg({typeName:vr.ZodAny,...$r(t)});class Zf extends ti{constructor(){super(...arguments),this._unknown=!0}_parse(r){return qo(r.data)}}Zf.create=t=>new Zf({typeName:vr.ZodUnknown,...$r(t)});class Mu extends ti{_parse(r){const l=this._getOrReturnCtx(r);return Ln(l,{code:dn.invalid_type,expected:jn.never,received:l.parsedType}),Sr}}Mu.create=t=>new Mu({typeName:vr.ZodNever,...$r(t)});class kw extends ti{_parse(r){if(this._getType(r)!==jn.undefined){const d=this._getOrReturnCtx(r);return Ln(d,{code:dn.invalid_type,expected:jn.void,received:d.parsedType}),Sr}return qo(r.data)}}kw.create=t=>new kw({typeName:vr.ZodVoid,...$r(t)});class jl extends ti{_parse(r){const{ctx:l,status:d}=this._processInputParams(r),_=this._def;if(l.parsedType!==jn.array)return Ln(l,{code:dn.invalid_type,expected:jn.array,received:l.parsedType}),Sr;if(_.exactLength!==null){const C=l.data.length>_.exactLength.value,s=l.data.length<_.exactLength.value;(C||s)&&(Ln(l,{code:C?dn.too_big:dn.too_small,minimum:s?_.exactLength.value:void 0,maximum:C?_.exactLength.value:void 0,type:"array",inclusive:!0,exact:!0,message:_.exactLength.message}),d.dirty())}if(_.minLength!==null&&l.data.length<_.minLength.value&&(Ln(l,{code:dn.too_small,minimum:_.minLength.value,type:"array",inclusive:!0,exact:!1,message:_.minLength.message}),d.dirty()),_.maxLength!==null&&l.data.length>_.maxLength.value&&(Ln(l,{code:dn.too_big,maximum:_.maxLength.value,type:"array",inclusive:!0,exact:!1,message:_.maxLength.message}),d.dirty()),l.common.async)return Promise.all([...l.data].map((C,s)=>_.type._parseAsync(new Lc(l,C,l.path,s)))).then(C=>Ro.mergeArray(d,C));const x=[...l.data].map((C,s)=>_.type._parseSync(new Lc(l,C,l.path,s)));return Ro.mergeArray(d,x)}get element(){return this._def.type}min(r,l){return new jl({...this._def,minLength:{value:r,message:ar.toString(l)}})}max(r,l){return new jl({...this._def,maxLength:{value:r,message:ar.toString(l)}})}length(r,l){return new jl({...this._def,exactLength:{value:r,message:ar.toString(l)}})}nonempty(r){return this.min(1,r)}}jl.create=(t,r)=>new jl({type:t,minLength:null,maxLength:null,exactLength:null,typeName:vr.ZodArray,...$r(r)});function qm(t){if(t instanceof ls){const r={};for(const l in t.shape){const d=t.shape[l];r[l]=Mc.create(qm(d))}return new ls({...t._def,shape:()=>r})}else return t instanceof jl?new jl({...t._def,type:qm(t.element)}):t instanceof Mc?Mc.create(qm(t.unwrap())):t instanceof mh?mh.create(qm(t.unwrap())):t instanceof Nc?Nc.create(t.items.map(r=>qm(r))):t}class ls extends ti{constructor(){super(...arguments),this._cached=null,this.nonstrict=this.passthrough,this.augment=this.extend}_getCached(){if(this._cached!==null)return this._cached;const r=this._def.shape(),l=Ci.objectKeys(r);return this._cached={shape:r,keys:l}}_parse(r){if(this._getType(r)!==jn.object){const z=this._getOrReturnCtx(r);return Ln(z,{code:dn.invalid_type,expected:jn.object,received:z.parsedType}),Sr}const{status:d,ctx:_}=this._processInputParams(r),{shape:x,keys:C}=this._getCached(),s=[];if(!(this._def.catchall instanceof Mu&&this._def.unknownKeys==="strip"))for(const z in _.data)C.includes(z)||s.push(z);const k=[];for(const z of C){const V=x[z],U=_.data[z];k.push({key:{status:"valid",value:z},value:V._parse(new Lc(_,U,_.path,z)),alwaysSet:z in _.data})}if(this._def.catchall instanceof Mu){const z=this._def.unknownKeys;if(z==="passthrough")for(const V of s)k.push({key:{status:"valid",value:V},value:{status:"valid",value:_.data[V]}});else if(z==="strict")s.length>0&&(Ln(_,{code:dn.unrecognized_keys,keys:s}),d.dirty());else if(z!=="strip")throw new Error("Internal ZodObject error: invalid unknownKeys value.")}else{const z=this._def.catchall;for(const V of s){const U=_.data[V];k.push({key:{status:"valid",value:V},value:z._parse(new Lc(_,U,_.path,V)),alwaysSet:V in _.data})}}return _.common.async?Promise.resolve().then(async()=>{const z=[];for(const V of k){const U=await V.key,$=await V.value;z.push({key:U,value:$,alwaysSet:V.alwaysSet})}return z}).then(z=>Ro.mergeObjectSync(d,z)):Ro.mergeObjectSync(d,k)}get shape(){return this._def.shape()}strict(r){return ar.errToObj,new ls({...this._def,unknownKeys:"strict",...r!==void 0?{errorMap:(l,d)=>{var _,x,C,s;const k=(C=(x=(_=this._def).errorMap)===null||x===void 0?void 0:x.call(_,l,d).message)!==null&&C!==void 0?C:d.defaultError;return l.code==="unrecognized_keys"?{message:(s=ar.errToObj(r).message)!==null&&s!==void 0?s:k}:{message:k}}}:{}})}strip(){return new ls({...this._def,unknownKeys:"strip"})}passthrough(){return new ls({...this._def,unknownKeys:"passthrough"})}extend(r){return new ls({...this._def,shape:()=>({...this._def.shape(),...r})})}merge(r){return new ls({unknownKeys:r._def.unknownKeys,catchall:r._def.catchall,shape:()=>({...this._def.shape(),...r._def.shape()}),typeName:vr.ZodObject})}setKey(r,l){return this.augment({[r]:l})}catchall(r){return new ls({...this._def,catchall:r})}pick(r){const l={};return Ci.objectKeys(r).forEach(d=>{r[d]&&this.shape[d]&&(l[d]=this.shape[d])}),new ls({...this._def,shape:()=>l})}omit(r){const l={};return Ci.objectKeys(this.shape).forEach(d=>{r[d]||(l[d]=this.shape[d])}),new ls({...this._def,shape:()=>l})}deepPartial(){return qm(this)}partial(r){const l={};return Ci.objectKeys(this.shape).forEach(d=>{const _=this.shape[d];r&&!r[d]?l[d]=_:l[d]=_.optional()}),new ls({...this._def,shape:()=>l})}required(r){const l={};return Ci.objectKeys(this.shape).forEach(d=>{if(r&&!r[d])l[d]=this.shape[d];else{let x=this.shape[d];for(;x instanceof Mc;)x=x._def.innerType;l[d]=x}}),new ls({...this._def,shape:()=>l})}keyof(){return VB(Ci.objectKeys(this.shape))}}ls.create=(t,r)=>new ls({shape:()=>t,unknownKeys:"strip",catchall:Mu.create(),typeName:vr.ZodObject,...$r(r)});ls.strictCreate=(t,r)=>new ls({shape:()=>t,unknownKeys:"strict",catchall:Mu.create(),typeName:vr.ZodObject,...$r(r)});ls.lazycreate=(t,r)=>new ls({shape:t,unknownKeys:"strip",catchall:Mu.create(),typeName:vr.ZodObject,...$r(r)});class fx extends ti{_parse(r){const{ctx:l}=this._processInputParams(r),d=this._def.options;function _(x){for(const s of x)if(s.result.status==="valid")return s.result;for(const s of x)if(s.result.status==="dirty")return l.common.issues.push(...s.ctx.common.issues),s.result;const C=x.map(s=>new ka(s.ctx.common.issues));return Ln(l,{code:dn.invalid_union,unionErrors:C}),Sr}if(l.common.async)return Promise.all(d.map(async x=>{const C={...l,common:{...l.common,issues:[]},parent:null};return{result:await x._parseAsync({data:l.data,path:l.path,parent:C}),ctx:C}})).then(_);{let x;const C=[];for(const k of d){const z={...l,common:{...l.common,issues:[]},parent:null},V=k._parseSync({data:l.data,path:l.path,parent:z});if(V.status==="valid")return V;V.status==="dirty"&&!x&&(x={result:V,ctx:z}),z.common.issues.length&&C.push(z.common.issues)}if(x)return l.common.issues.push(...x.ctx.common.issues),x.result;const s=C.map(k=>new ka(k));return Ln(l,{code:dn.invalid_union,unionErrors:s}),Sr}}get options(){return this._def.options}}fx.create=(t,r)=>new fx({options:t,typeName:vr.ZodUnion,...$r(r)});const fu=t=>t instanceof gx?fu(t.schema):t instanceof $l?fu(t.innerType()):t instanceof _x?[t.value]:t instanceof ph?t.options:t instanceof yx?Ci.objectValues(t.enum):t instanceof vx?fu(t._def.innerType):t instanceof dx?[void 0]:t instanceof hx?[null]:t instanceof Mc?[void 0,...fu(t.unwrap())]:t instanceof mh?[null,...fu(t.unwrap())]:t instanceof cP||t instanceof bx?fu(t.unwrap()):t instanceof xx?fu(t._def.innerType):[];class P2 extends ti{_parse(r){const{ctx:l}=this._processInputParams(r);if(l.parsedType!==jn.object)return Ln(l,{code:dn.invalid_type,expected:jn.object,received:l.parsedType}),Sr;const d=this.discriminator,_=l.data[d],x=this.optionsMap.get(_);return x?l.common.async?x._parseAsync({data:l.data,path:l.path,parent:l}):x._parseSync({data:l.data,path:l.path,parent:l}):(Ln(l,{code:dn.invalid_union_discriminator,options:Array.from(this.optionsMap.keys()),path:[d]}),Sr)}get discriminator(){return this._def.discriminator}get options(){return this._def.options}get optionsMap(){return this._def.optionsMap}static create(r,l,d){const _=new Map;for(const x of l){const C=fu(x.shape[r]);if(!C.length)throw new Error(`A discriminator value for key \`${r}\` could not be extracted from all schema options`);for(const s of C){if(_.has(s))throw new Error(`Discriminator property ${String(r)} has duplicate value ${String(s)}`);_.set(s,x)}}return new P2({typeName:vr.ZodDiscriminatedUnion,discriminator:r,options:l,optionsMap:_,...$r(d)})}}function cA(t,r){const l=zd(t),d=zd(r);if(t===r)return{valid:!0,data:t};if(l===jn.object&&d===jn.object){const _=Ci.objectKeys(r),x=Ci.objectKeys(t).filter(s=>_.indexOf(s)!==-1),C={...t,...r};for(const s of x){const k=cA(t[s],r[s]);if(!k.valid)return{valid:!1};C[s]=k.data}return{valid:!0,data:C}}else if(l===jn.array&&d===jn.array){if(t.length!==r.length)return{valid:!1};const _=[];for(let x=0;x<t.length;x++){const C=t[x],s=r[x],k=cA(C,s);if(!k.valid)return{valid:!1};_.push(k.data)}return{valid:!0,data:_}}else return l===jn.date&&d===jn.date&&+t==+r?{valid:!0,data:t}:{valid:!1}}class px extends ti{_parse(r){const{status:l,ctx:d}=this._processInputParams(r),_=(x,C)=>{if(aA(x)||aA(C))return Sr;const s=cA(x.value,C.value);return s.valid?((lA(x)||lA(C))&&l.dirty(),{status:l.value,value:s.data}):(Ln(d,{code:dn.invalid_intersection_types}),Sr)};return d.common.async?Promise.all([this._def.left._parseAsync({data:d.data,path:d.path,parent:d}),this._def.right._parseAsync({data:d.data,path:d.path,parent:d})]).then(([x,C])=>_(x,C)):_(this._def.left._parseSync({data:d.data,path:d.path,parent:d}),this._def.right._parseSync({data:d.data,path:d.path,parent:d}))}}px.create=(t,r,l)=>new px({left:t,right:r,typeName:vr.ZodIntersection,...$r(l)});class Nc extends ti{_parse(r){const{status:l,ctx:d}=this._processInputParams(r);if(d.parsedType!==jn.array)return Ln(d,{code:dn.invalid_type,expected:jn.array,received:d.parsedType}),Sr;if(d.data.length<this._def.items.length)return Ln(d,{code:dn.too_small,minimum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),Sr;!this._def.rest&&d.data.length>this._def.items.length&&(Ln(d,{code:dn.too_big,maximum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),l.dirty());const x=[...d.data].map((C,s)=>{const k=this._def.items[s]||this._def.rest;return k?k._parse(new Lc(d,C,d.path,s)):null}).filter(C=>!!C);return d.common.async?Promise.all(x).then(C=>Ro.mergeArray(l,C)):Ro.mergeArray(l,x)}get items(){return this._def.items}rest(r){return new Nc({...this._def,rest:r})}}Nc.create=(t,r)=>{if(!Array.isArray(t))throw new Error("You must pass an array of schemas to z.tuple([ ... ])");return new Nc({items:t,typeName:vr.ZodTuple,rest:null,...$r(r)})};class mx extends ti{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(r){const{status:l,ctx:d}=this._processInputParams(r);if(d.parsedType!==jn.object)return Ln(d,{code:dn.invalid_type,expected:jn.object,received:d.parsedType}),Sr;const _=[],x=this._def.keyType,C=this._def.valueType;for(const s in d.data)_.push({key:x._parse(new Lc(d,s,d.path,s)),value:C._parse(new Lc(d,d.data[s],d.path,s)),alwaysSet:s in d.data});return d.common.async?Ro.mergeObjectAsync(l,_):Ro.mergeObjectSync(l,_)}get element(){return this._def.valueType}static create(r,l,d){return l instanceof ti?new mx({keyType:r,valueType:l,typeName:vr.ZodRecord,...$r(d)}):new mx({keyType:Ll.create(),valueType:r,typeName:vr.ZodRecord,...$r(l)})}}class Dw extends ti{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(r){const{status:l,ctx:d}=this._processInputParams(r);if(d.parsedType!==jn.map)return Ln(d,{code:dn.invalid_type,expected:jn.map,received:d.parsedType}),Sr;const _=this._def.keyType,x=this._def.valueType,C=[...d.data.entries()].map(([s,k],z)=>({key:_._parse(new Lc(d,s,d.path,[z,"key"])),value:x._parse(new Lc(d,k,d.path,[z,"value"]))}));if(d.common.async){const s=new Map;return Promise.resolve().then(async()=>{for(const k of C){const z=await k.key,V=await k.value;if(z.status==="aborted"||V.status==="aborted")return Sr;(z.status==="dirty"||V.status==="dirty")&&l.dirty(),s.set(z.value,V.value)}return{status:l.value,value:s}})}else{const s=new Map;for(const k of C){const z=k.key,V=k.value;if(z.status==="aborted"||V.status==="aborted")return Sr;(z.status==="dirty"||V.status==="dirty")&&l.dirty(),s.set(z.value,V.value)}return{status:l.value,value:s}}}}Dw.create=(t,r,l)=>new Dw({valueType:r,keyType:t,typeName:vr.ZodMap,...$r(l)});class pp extends ti{_parse(r){const{status:l,ctx:d}=this._processInputParams(r);if(d.parsedType!==jn.set)return Ln(d,{code:dn.invalid_type,expected:jn.set,received:d.parsedType}),Sr;const _=this._def;_.minSize!==null&&d.data.size<_.minSize.value&&(Ln(d,{code:dn.too_small,minimum:_.minSize.value,type:"set",inclusive:!0,exact:!1,message:_.minSize.message}),l.dirty()),_.maxSize!==null&&d.data.size>_.maxSize.value&&(Ln(d,{code:dn.too_big,maximum:_.maxSize.value,type:"set",inclusive:!0,exact:!1,message:_.maxSize.message}),l.dirty());const x=this._def.valueType;function C(k){const z=new Set;for(const V of k){if(V.status==="aborted")return Sr;V.status==="dirty"&&l.dirty(),z.add(V.value)}return{status:l.value,value:z}}const s=[...d.data.values()].map((k,z)=>x._parse(new Lc(d,k,d.path,z)));return d.common.async?Promise.all(s).then(k=>C(k)):C(s)}min(r,l){return new pp({...this._def,minSize:{value:r,message:ar.toString(l)}})}max(r,l){return new pp({...this._def,maxSize:{value:r,message:ar.toString(l)}})}size(r,l){return this.min(r,l).max(r,l)}nonempty(r){return this.min(1,r)}}pp.create=(t,r)=>new pp({valueType:t,minSize:null,maxSize:null,typeName:vr.ZodSet,...$r(r)});class bg extends ti{constructor(){super(...arguments),this.validate=this.implement}_parse(r){const{ctx:l}=this._processInputParams(r);if(l.parsedType!==jn.function)return Ln(l,{code:dn.invalid_type,expected:jn.function,received:l.parsedType}),Sr;function d(s,k){return Pw({data:s,path:l.path,errorMaps:[l.common.contextualErrorMap,l.schemaErrorMap,Iw(),Xg].filter(z=>!!z),issueData:{code:dn.invalid_arguments,argumentsError:k}})}function _(s,k){return Pw({data:s,path:l.path,errorMaps:[l.common.contextualErrorMap,l.schemaErrorMap,Iw(),Xg].filter(z=>!!z),issueData:{code:dn.invalid_return_type,returnTypeError:k}})}const x={errorMap:l.common.contextualErrorMap},C=l.data;if(this._def.returns instanceof Kg){const s=this;return qo(async function(...k){const z=new ka([]),V=await s._def.args.parseAsync(k,x).catch(se=>{throw z.addIssue(d(k,se)),z}),U=await Reflect.apply(C,this,V);return await s._def.returns._def.type.parseAsync(U,x).catch(se=>{throw z.addIssue(_(U,se)),z})})}else{const s=this;return qo(function(...k){const z=s._def.args.safeParse(k,x);if(!z.success)throw new ka([d(k,z.error)]);const V=Reflect.apply(C,this,z.data),U=s._def.returns.safeParse(V,x);if(!U.success)throw new ka([_(V,U.error)]);return U.data})}}parameters(){return this._def.args}returnType(){return this._def.returns}args(...r){return new bg({...this._def,args:Nc.create(r).rest(Zf.create())})}returns(r){return new bg({...this._def,returns:r})}implement(r){return this.parse(r)}strictImplement(r){return this.parse(r)}static create(r,l,d){return new bg({args:r||Nc.create([]).rest(Zf.create()),returns:l||Zf.create(),typeName:vr.ZodFunction,...$r(d)})}}class gx extends ti{get schema(){return this._def.getter()}_parse(r){const{ctx:l}=this._processInputParams(r);return this._def.getter()._parse({data:l.data,path:l.path,parent:l})}}gx.create=(t,r)=>new gx({getter:t,typeName:vr.ZodLazy,...$r(r)});class _x extends ti{_parse(r){if(r.data!==this._def.value){const l=this._getOrReturnCtx(r);return Ln(l,{received:l.data,code:dn.invalid_literal,expected:this._def.value}),Sr}return{status:"valid",value:r.data}}get value(){return this._def.value}}_x.create=(t,r)=>new _x({value:t,typeName:vr.ZodLiteral,...$r(r)});function VB(t,r){return new ph({values:t,typeName:vr.ZodEnum,...$r(r)})}class ph extends ti{constructor(){super(...arguments),xv.set(this,void 0)}_parse(r){if(typeof r.data!="string"){const l=this._getOrReturnCtx(r),d=this._def.values;return Ln(l,{expected:Ci.joinValues(d),received:l.parsedType,code:dn.invalid_type}),Sr}if(Mw(this,xv)||OB(this,xv,new Set(this._def.values)),!Mw(this,xv).has(r.data)){const l=this._getOrReturnCtx(r),d=this._def.values;return Ln(l,{received:l.data,code:dn.invalid_enum_value,options:d}),Sr}return qo(r.data)}get options(){return this._def.values}get enum(){const r={};for(const l of this._def.values)r[l]=l;return r}get Values(){const r={};for(const l of this._def.values)r[l]=l;return r}get Enum(){const r={};for(const l of this._def.values)r[l]=l;return r}extract(r,l=this._def){return ph.create(r,{...this._def,...l})}exclude(r,l=this._def){return ph.create(this.options.filter(d=>!r.includes(d)),{...this._def,...l})}}xv=new WeakMap;ph.create=VB;class yx extends ti{constructor(){super(...arguments),bv.set(this,void 0)}_parse(r){const l=Ci.getValidEnumValues(this._def.values),d=this._getOrReturnCtx(r);if(d.parsedType!==jn.string&&d.parsedType!==jn.number){const _=Ci.objectValues(l);return Ln(d,{expected:Ci.joinValues(_),received:d.parsedType,code:dn.invalid_type}),Sr}if(Mw(this,bv)||OB(this,bv,new Set(Ci.getValidEnumValues(this._def.values))),!Mw(this,bv).has(r.data)){const _=Ci.objectValues(l);return Ln(d,{received:d.data,code:dn.invalid_enum_value,options:_}),Sr}return qo(r.data)}get enum(){return this._def.values}}bv=new WeakMap;yx.create=(t,r)=>new yx({values:t,typeName:vr.ZodNativeEnum,...$r(r)});class Kg extends ti{unwrap(){return this._def.type}_parse(r){const{ctx:l}=this._processInputParams(r);if(l.parsedType!==jn.promise&&l.common.async===!1)return Ln(l,{code:dn.invalid_type,expected:jn.promise,received:l.parsedType}),Sr;const d=l.parsedType===jn.promise?l.data:Promise.resolve(l.data);return qo(d.then(_=>this._def.type.parseAsync(_,{path:l.path,errorMap:l.common.contextualErrorMap})))}}Kg.create=(t,r)=>new Kg({type:t,typeName:vr.ZodPromise,...$r(r)});class $l extends ti{innerType(){return this._def.schema}sourceType(){return this._def.schema._def.typeName===vr.ZodEffects?this._def.schema.sourceType():this._def.schema}_parse(r){const{status:l,ctx:d}=this._processInputParams(r),_=this._def.effect||null,x={addIssue:C=>{Ln(d,C),C.fatal?l.abort():l.dirty()},get path(){return d.path}};if(x.addIssue=x.addIssue.bind(x),_.type==="preprocess"){const C=_.transform(d.data,x);if(d.common.async)return Promise.resolve(C).then(async s=>{if(l.value==="aborted")return Sr;const k=await this._def.schema._parseAsync({data:s,path:d.path,parent:d});return k.status==="aborted"?Sr:k.status==="dirty"||l.value==="dirty"?lg(k.value):k});{if(l.value==="aborted")return Sr;const s=this._def.schema._parseSync({data:C,path:d.path,parent:d});return s.status==="aborted"?Sr:s.status==="dirty"||l.value==="dirty"?lg(s.value):s}}if(_.type==="refinement"){const C=s=>{const k=_.refinement(s,x);if(d.common.async)return Promise.resolve(k);if(k instanceof Promise)throw new Error("Async refinement encountered during synchronous parse operation. Use .parseAsync instead.");return s};if(d.common.async===!1){const s=this._def.schema._parseSync({data:d.data,path:d.path,parent:d});return s.status==="aborted"?Sr:(s.status==="dirty"&&l.dirty(),C(s.value),{status:l.value,value:s.value})}else return this._def.schema._parseAsync({data:d.data,path:d.path,parent:d}).then(s=>s.status==="aborted"?Sr:(s.status==="dirty"&&l.dirty(),C(s.value).then(()=>({status:l.value,value:s.value}))))}if(_.type==="transform")if(d.common.async===!1){const C=this._def.schema._parseSync({data:d.data,path:d.path,parent:d});if(!lx(C))return C;const s=_.transform(C.value,x);if(s instanceof Promise)throw new Error("Asynchronous transform encountered during synchronous parse operation. Use .parseAsync instead.");return{status:l.value,value:s}}else return this._def.schema._parseAsync({data:d.data,path:d.path,parent:d}).then(C=>lx(C)?Promise.resolve(_.transform(C.value,x)).then(s=>({status:l.value,value:s})):C);Ci.assertNever(_)}}$l.create=(t,r,l)=>new $l({schema:t,typeName:vr.ZodEffects,effect:r,...$r(l)});$l.createWithPreprocess=(t,r,l)=>new $l({schema:r,effect:{type:"preprocess",transform:t},typeName:vr.ZodEffects,...$r(l)});class Mc extends ti{_parse(r){return this._getType(r)===jn.undefined?qo(void 0):this._def.innerType._parse(r)}unwrap(){return this._def.innerType}}Mc.create=(t,r)=>new Mc({innerType:t,typeName:vr.ZodOptional,...$r(r)});class mh extends ti{_parse(r){return this._getType(r)===jn.null?qo(null):this._def.innerType._parse(r)}unwrap(){return this._def.innerType}}mh.create=(t,r)=>new mh({innerType:t,typeName:vr.ZodNullable,...$r(r)});class vx extends ti{_parse(r){const{ctx:l}=this._processInputParams(r);let d=l.data;return l.parsedType===jn.undefined&&(d=this._def.defaultValue()),this._def.innerType._parse({data:d,path:l.path,parent:l})}removeDefault(){return this._def.innerType}}vx.create=(t,r)=>new vx({innerType:t,typeName:vr.ZodDefault,defaultValue:typeof r.default=="function"?r.default:()=>r.default,...$r(r)});class xx extends ti{_parse(r){const{ctx:l}=this._processInputParams(r),d={...l,common:{...l.common,issues:[]}},_=this._def.innerType._parse({data:d.data,path:d.path,parent:{...d}});return cx(_)?_.then(x=>({status:"valid",value:x.status==="valid"?x.value:this._def.catchValue({get error(){return new ka(d.common.issues)},input:d.data})})):{status:"valid",value:_.status==="valid"?_.value:this._def.catchValue({get error(){return new ka(d.common.issues)},input:d.data})}}removeCatch(){return this._def.innerType}}xx.create=(t,r)=>new xx({innerType:t,typeName:vr.ZodCatch,catchValue:typeof r.catch=="function"?r.catch:()=>r.catch,...$r(r)});class Lw extends ti{_parse(r){if(this._getType(r)!==jn.nan){const d=this._getOrReturnCtx(r);return Ln(d,{code:dn.invalid_type,expected:jn.nan,received:d.parsedType}),Sr}return{status:"valid",value:r.data}}}Lw.create=t=>new Lw({typeName:vr.ZodNaN,...$r(t)});const HJ=Symbol("zod_brand");class cP extends ti{_parse(r){const{ctx:l}=this._processInputParams(r),d=l.data;return this._def.type._parse({data:d,path:l.path,parent:l})}unwrap(){return this._def.type}}class $x extends ti{_parse(r){const{status:l,ctx:d}=this._processInputParams(r);if(d.common.async)return(async()=>{const x=await this._def.in._parseAsync({data:d.data,path:d.path,parent:d});return x.status==="aborted"?Sr:x.status==="dirty"?(l.dirty(),lg(x.value)):this._def.out._parseAsync({data:x.value,path:d.path,parent:d})})();{const _=this._def.in._parseSync({data:d.data,path:d.path,parent:d});return _.status==="aborted"?Sr:_.status==="dirty"?(l.dirty(),{status:"dirty",value:_.value}):this._def.out._parseSync({data:_.value,path:d.path,parent:d})}}static create(r,l){return new $x({in:r,out:l,typeName:vr.ZodPipeline})}}class bx extends ti{_parse(r){const l=this._def.innerType._parse(r),d=_=>(lx(_)&&(_.value=Object.freeze(_.value)),_);return cx(l)?l.then(_=>d(_)):d(l)}unwrap(){return this._def.innerType}}bx.create=(t,r)=>new bx({innerType:t,typeName:vr.ZodReadonly,...$r(r)});function UB(t,r={},l){return t?Yg.create().superRefine((d,_)=>{var x,C;if(!t(d)){const s=typeof r=="function"?r(d):typeof r=="string"?{message:r}:r,k=(C=(x=s.fatal)!==null&&x!==void 0?x:l)!==null&&C!==void 0?C:!0,z=typeof s=="string"?{message:s}:s;_.addIssue({code:"custom",...z,fatal:k})}}):Yg.create()}const qJ={object:ls.lazycreate};var vr;(function(t){t.ZodString="ZodString",t.ZodNumber="ZodNumber",t.ZodNaN="ZodNaN",t.ZodBigInt="ZodBigInt",t.ZodBoolean="ZodBoolean",t.ZodDate="ZodDate",t.ZodSymbol="ZodSymbol",t.ZodUndefined="ZodUndefined",t.ZodNull="ZodNull",t.ZodAny="ZodAny",t.ZodUnknown="ZodUnknown",t.ZodNever="ZodNever",t.ZodVoid="ZodVoid",t.ZodArray="ZodArray",t.ZodObject="ZodObject",t.ZodUnion="ZodUnion",t.ZodDiscriminatedUnion="ZodDiscriminatedUnion",t.ZodIntersection="ZodIntersection",t.ZodTuple="ZodTuple",t.ZodRecord="ZodRecord",t.ZodMap="ZodMap",t.ZodSet="ZodSet",t.ZodFunction="ZodFunction",t.ZodLazy="ZodLazy",t.ZodLiteral="ZodLiteral",t.ZodEnum="ZodEnum",t.ZodEffects="ZodEffects",t.ZodNativeEnum="ZodNativeEnum",t.ZodOptional="ZodOptional",t.ZodNullable="ZodNullable",t.ZodDefault="ZodDefault",t.ZodCatch="ZodCatch",t.ZodPromise="ZodPromise",t.ZodBranded="ZodBranded",t.ZodPipeline="ZodPipeline",t.ZodReadonly="ZodReadonly"})(vr||(vr={}));const WJ=(t,r={message:`Input not instance of ${t.name}`})=>UB(l=>l instanceof t,r),$B=Ll.create,GB=hh.create,ZJ=Lw.create,XJ=fh.create,HB=ux.create,YJ=fp.create,KJ=Rw.create,QJ=dx.create,JJ=hx.create,eee=Yg.create,tee=Zf.create,nee=Mu.create,ree=kw.create,iee=jl.create,see=ls.create,oee=ls.strictCreate,aee=fx.create,lee=P2.create,cee=px.create,uee=Nc.create,dee=mx.create,hee=Dw.create,fee=pp.create,pee=bg.create,mee=gx.create,gee=_x.create,_ee=ph.create,yee=yx.create,vee=Kg.create,AN=$l.create,xee=Mc.create,bee=mh.create,wee=$l.createWithPreprocess,See=$x.create,Tee=()=>$B().optional(),Eee=()=>GB().optional(),Cee=()=>HB().optional(),Aee={string:t=>Ll.create({...t,coerce:!0}),number:t=>hh.create({...t,coerce:!0}),boolean:t=>ux.create({...t,coerce:!0}),bigint:t=>fh.create({...t,coerce:!0}),date:t=>fp.create({...t,coerce:!0})},Iee=Sr;var ht=Object.freeze({__proto__:null,defaultErrorMap:Xg,setErrorMap:IJ,getErrorMap:Iw,makeIssue:Pw,EMPTY_PATH:PJ,addIssueToContext:Ln,ParseStatus:Ro,INVALID:Sr,DIRTY:lg,OK:qo,isAborted:aA,isDirty:lA,isValid:lx,isAsync:cx,get util(){return Ci},get objectUtil(){return oA},ZodParsedType:jn,getParsedType:zd,ZodType:ti,datetimeRegex:BB,ZodString:Ll,ZodNumber:hh,ZodBigInt:fh,ZodBoolean:ux,ZodDate:fp,ZodSymbol:Rw,ZodUndefined:dx,ZodNull:hx,ZodAny:Yg,ZodUnknown:Zf,ZodNever:Mu,ZodVoid:kw,ZodArray:jl,ZodObject:ls,ZodUnion:fx,ZodDiscriminatedUnion:P2,ZodIntersection:px,ZodTuple:Nc,ZodRecord:mx,ZodMap:Dw,ZodSet:pp,ZodFunction:bg,ZodLazy:gx,ZodLiteral:_x,ZodEnum:ph,ZodNativeEnum:yx,ZodPromise:Kg,ZodEffects:$l,ZodTransformer:$l,ZodOptional:Mc,ZodNullable:mh,ZodDefault:vx,ZodCatch:xx,ZodNaN:Lw,BRAND:HJ,ZodBranded:cP,ZodPipeline:$x,ZodReadonly:bx,custom:UB,Schema:ti,ZodSchema:ti,late:qJ,get ZodFirstPartyTypeKind(){return vr},coerce:Aee,any:eee,array:iee,bigint:XJ,boolean:HB,date:YJ,discriminatedUnion:lee,effect:AN,enum:_ee,function:pee,instanceof:WJ,intersection:cee,lazy:mee,literal:gee,map:hee,nan:ZJ,nativeEnum:yee,never:nee,null:JJ,nullable:bee,number:GB,object:see,oboolean:Cee,onumber:Eee,optional:xee,ostring:Tee,pipeline:See,preprocess:wee,promise:vee,record:dee,set:fee,strictObject:oee,string:$B,symbol:KJ,transformer:AN,tuple:uee,undefined:QJ,union:aee,unknown:tee,void:ree,NEVER:Iee,ZodIssueCode:dn,quotelessJson:AJ,ZodError:ka});const Nw=class Nw{static getInstance(){return this.instance||(this.instance=new Nw),this.instance}async getCurrentLocation(){return new Promise((r,l)=>{if(!navigator.geolocation){l(new Error("Geolocation is not supported by this browser"));return}navigator.geolocation.getCurrentPosition(d=>{r({lat:d.coords.latitude,lng:d.coords.longitude,accuracy:d.coords.accuracy,timestamp:d.timestamp})},d=>{let _="Failed to get location";switch(d.code){case d.PERMISSION_DENIED:_="Location access denied by user";break;case d.POSITION_UNAVAILABLE:_="Location information is unavailable";break;case d.TIMEOUT:_="Location request timed out";break}l(new Error(_))},{enableHighAccuracy:!0,timeout:1e4,maximumAge:5*60*1e3})})}async verifyLocationWithinCrisis(r,l,d,_,x=50){const C={userLat:r,userLng:l,crisisLat:d,crisisLng:_,maxDistanceKm:x};try{const s=await fetch("/api/location/verify",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(C)});if(!s.ok)throw new Error("Failed to verify location");return await s.json()}catch(s){console.warn("API location verification failed, using client-side fallback:",s);const k=this.calculateDistance(r,l,d,_);return{isWithinRange:k<=x,distance:Math.round(k*100)/100,maxDistance:x}}}calculateDistance(r,l,d,_){const C=this.deg2rad(d-r),s=this.deg2rad(_-l),k=Math.sin(C/2)*Math.sin(C/2)+Math.cos(this.deg2rad(r))*Math.cos(this.deg2rad(d))*Math.sin(s/2)*Math.sin(s/2);return 6371*(2*Math.atan2(Math.sqrt(k),Math.sqrt(1-k)))}deg2rad(r){return r*(Math.PI/180)}async requestLocationPermission(){if(!navigator.permissions)try{return await this.getCurrentLocation(),!0}catch{return!1}try{return(await navigator.permissions.query({name:"geolocation"})).state==="granted"}catch{return!1}}};iD(Nw,"instance");let uA=Nw;const fb=uA.getInstance(),Pee=()=>{const[t,r]=B.useState({isLoading:!1,userLocation:null,verificationResult:null,error:null,hasPermission:null}),l=B.useCallback(async()=>{r(s=>({...s,isLoading:!0,error:null}));try{const s=await fb.requestLocationPermission();return r(k=>({...k,hasPermission:s,isLoading:!1})),s}catch(s){return r(k=>({...k,error:s instanceof Error?s.message:"Failed to request location permission",isLoading:!1})),!1}},[]),d=B.useCallback(async()=>{r(s=>({...s,isLoading:!0,error:null}));try{const s=await fb.getCurrentLocation();return r(k=>({...k,userLocation:s,isLoading:!1,hasPermission:!0})),s}catch(s){return r(k=>({...k,error:s instanceof Error?s.message:"Failed to get current location",isLoading:!1,hasPermission:!1})),null}},[]),_=B.useCallback(async s=>{r(k=>({...k,isLoading:!0,error:null}));try{let k=t.userLocation;if(!k&&(k=await fb.getCurrentLocation(),!k))throw new Error("Could not get current location");const z=await fb.verifyLocationWithinCrisis(k.lat,k.lng,s.location.lat,s.location.lng,50);return r(V=>({...V,userLocation:k,verificationResult:z,isLoading:!1,hasPermission:!0})),z}catch(k){return r(z=>({...z,error:k instanceof Error?k.message:"Failed to verify location",isLoading:!1})),null}},[t.userLocation]),x=B.useCallback(()=>{r(s=>({...s,error:null}))},[]),C=B.useCallback(()=>{r({isLoading:!1,userLocation:null,verificationResult:null,error:null,hasPermission:null})},[]);return{...t,requestLocationPermission:l,getCurrentLocation:d,verifyLocationWithinCrisis:_,clearError:x,resetVerification:C}},Mee=({crisis:t,onVerificationComplete:r,className:l=""})=>{const{isLoading:d,userLocation:_,verificationResult:x,error:C,hasPermission:s,requestLocationPermission:k,getCurrentLocation:z,verifyLocationWithinCrisis:V,clearError:U}=Pee(),[$,se]=B.useState("idle");B.useEffect(()=>{if(x){const Y=x.isWithinRange?"verified":"failed";se(Y),r(x.isWithinRange,_?{lat:_.lat,lng:_.lng}:void 0)}},[x,_,r]);const ae=async()=>{se("checking"),U(),await V(t)||se("failed")},H=()=>{switch($){case"checking":return w.jsx(Jv,{className:"h-5 w-5 animate-spin text-blue-500"});case"verified":return w.jsx(ep,{className:"h-5 w-5 text-green-500"});case"failed":return w.jsx(Qv,{className:"h-5 w-5 text-red-500"});default:return w.jsx(ro,{className:"h-5 w-5 text-gray-500"})}},ne=()=>{switch($){case"checking":return w.jsx(wi,{variant:"outline",className:"bg-blue-50",children:"Verifying..."});case"verified":return w.jsx(wi,{variant:"default",className:"bg-green-100 text-green-800",children:"Location Verified"});case"failed":return w.jsx(wi,{variant:"destructive",children:"Location Not Verified"});default:return w.jsx(wi,{variant:"outline",children:"Not Verified"})}};return w.jsxs(ei,{className:l,"data-testid":"location-verification-card",children:[w.jsx(Yi,{className:"pb-3",children:w.jsxs(us,{className:"flex items-center gap-2 text-lg",children:[H(),"Location Verification",ne()]})}),w.jsxs(fi,{className:"space-y-4",children:[w.jsxs("div",{className:"text-sm text-muted-foreground",children:[w.jsxs("p",{children:["To submit a story about ",w.jsx("strong",{children:t.name}),", you must be within the crisis area."]}),w.jsxs("p",{className:"mt-1",children:["Crisis location: ",t.location.name]})]}),C&&w.jsxs(vg,{variant:"destructive","data-testid":"location-error",children:[w.jsx(fI,{className:"h-4 w-4"}),w.jsx(xg,{children:C})]}),x&&!x.isWithinRange&&w.jsxs(vg,{variant:"destructive","data-testid":"location-out-of-range",children:[w.jsx(Qv,{className:"h-4 w-4"}),w.jsxs(xg,{children:["You are ",x.distance.toFixed(1),"km away from the crisis area. You must be within ",x.maxDistance,"km to submit a story."]})]}),x&&x.isWithinRange&&w.jsxs(vg,{variant:"default",className:"border-green-200 bg-green-50","data-testid":"location-verified",children:[w.jsx(ep,{className:"h-4 w-4 text-green-600"}),w.jsxs(xg,{className:"text-green-800",children:["Location verified! You are ",x.distance.toFixed(1),"km from the crisis area."]})]}),_&&w.jsxs("div",{className:"text-xs text-muted-foreground p-2 bg-gray-50 rounded",children:[w.jsxs("p",{children:["Your coordinates: ",_.lat.toFixed(4),", ",_.lng.toFixed(4)]}),w.jsxs("p",{children:["Accuracy: ±",_.accuracy.toFixed(0),"m"]})]}),w.jsxs("div",{className:"flex gap-2",children:[$==="idle"||$==="failed"?w.jsxs(An,{onClick:ae,disabled:d,className:"flex items-center gap-2","data-testid":"button-verify-location",children:[d?w.jsx(Jv,{className:"h-4 w-4 animate-spin"}):w.jsx(ro,{className:"h-4 w-4"}),$==="failed"?"Try Again":"Verify Location"]}):null,C&&w.jsx(An,{variant:"outline",onClick:U,"data-testid":"button-clear-error",children:"Clear Error"})]}),w.jsx("div",{className:"text-xs text-muted-foreground",children:w.jsx("p",{children:"💡 Make sure location services are enabled in your browser and device settings."})})]})]})},Ree=ht.object({id:ht.string(),title:ht.string().min(1,"Title is required").max(200,"Title too long"),content:ht.string().min(1,"Content is required").max(5e3,"Content too long"),excerpt:ht.string().max(300,"Excerpt too long"),author:ht.string().min(1,"Author name is required"),images:ht.array(ht.string()).optional().default([]),location:ht.object({lat:ht.coerce.number(),lng:ht.coerce.number(),name:ht.string(),crisisId:ht.string()}),moderationStatus:ht.enum(["pending","approved","rejected","flagged"]).default("pending"),moderationNotes:ht.string().optional(),moderatedBy:ht.string().optional(),moderatedAt:ht.string().datetime().optional(),submittedAt:ht.string().datetime().default(()=>new Date().toISOString()),likes:ht.number().default(0),isLocationVerified:ht.boolean().default(!1),submitterIP:ht.string().optional(),submitterUserAgent:ht.string().optional()}),kee=Ree.omit({id:!0,likes:!0,moderationStatus:!0,moderationNotes:!0,moderatedBy:!0,moderatedAt:!0,submittedAt:!0,submitterIP:!0,submitterUserAgent:!0});ht.object({storyId:ht.string(),action:ht.enum(["approve","reject","flag"]),notes:ht.string().optional(),moderatorId:ht.string()});const Dee=ht.object({platform:ht.string(),username:ht.string().optional(),profileUrl:ht.string().optional(),displayName:ht.string().optional(),profilePicture:ht.string().optional(),followerCount:ht.number().optional(),isVerified:ht.boolean().optional(),connectedAt:ht.string().datetime().default(()=>new Date().toISOString())});ht.object({id:ht.string(),email:ht.string().email(),name:ht.string(),profilePicture:ht.string().optional(),googleId:ht.string(),isVerifiedHost:ht.boolean().default(!1),verifiedHostExpiresAt:ht.string().datetime().optional(),verifiedAt:ht.string().datetime().optional(),socialProfiles:ht.array(Dee).default([]),createdAt:ht.string().datetime().default(()=>new Date().toISOString()),lastActiveAt:ht.string().datetime().default(()=>new Date().toISOString())});const Lee=ht.object({id:ht.string(),name:ht.string().min(1,"Community name is required").max(100,"Community name too long"),description:ht.string().max(500,"Description too long"),category:ht.string(),createdBy:ht.string(),maxGeographicScope:ht.enum(["neighborhood","city","state","national","global"]).default("global"),isActive:ht.boolean().default(!0),memberCount:ht.number().default(0),globalDiscussions:ht.array(ht.string()).default([]),localDiscussions:ht.array(ht.string()).default([]),createdAt:ht.string().datetime().default(()=>new Date().toISOString()),updatedAt:ht.string().datetime().default(()=>new Date().toISOString())});Lee.omit({id:!0,memberCount:!0,globalDiscussions:!0,localDiscussions:!0,createdAt:!0,updatedAt:!0});const Nee=ht.object({id:ht.string(),communityId:ht.string(),title:ht.string().min(1,"Title is required").max(200,"Title too long"),content:ht.string().min(1,"Content is required").max(2e3,"Content too long"),authorId:ht.string(),authorName:ht.string(),authorLocation:ht.object({lat:ht.number(),lng:ht.number(),name:ht.string()}).optional(),isLocal:ht.boolean().default(!1),replies:ht.array(ht.string()).default([]),likes:ht.number().default(0),createdAt:ht.string().datetime().default(()=>new Date().toISOString()),updatedAt:ht.string().datetime().default(()=>new Date().toISOString())});Nee.omit({id:!0,replies:!0,likes:!0,createdAt:!0,updatedAt:!0});const zee=ht.object({id:ht.string(),title:ht.string().min(1,"Event title is required").max(200,"Title too long"),description:ht.string().max(1e3,"Description too long"),category:ht.string(),createdBy:ht.string(),location:ht.object({lat:ht.number(),lng:ht.number(),name:ht.string(),address:ht.string().optional()}),startDate:ht.string().datetime(),endDate:ht.string().datetime(),maxAttendees:ht.number().optional(),currentAttendees:ht.number().default(0),attendeeIds:ht.array(ht.string()).default([]),isActive:ht.boolean().default(!0),createdAt:ht.string().datetime().default(()=>new Date().toISOString()),updatedAt:ht.string().datetime().default(()=>new Date().toISOString())});zee.omit({id:!0,currentAttendees:!0,attendeeIds:!0,createdAt:!0,updatedAt:!0});ht.object({id:ht.string(),userId:ht.string(),stripePaymentIntentId:ht.string(),amount:ht.number(),currency:ht.string().default("usd"),status:ht.enum(["pending","succeeded","failed"]),description:ht.string(),createdAt:ht.string().datetime().default(()=>new Date().toISOString())});ht.object({userLat:ht.number(),userLng:ht.number(),crisisLat:ht.number(),crisisLng:ht.number(),maxDistanceKm:ht.number().default(50)});ht.object({id:ht.string(),name:ht.string(),location:ht.object({lat:ht.number(),lng:ht.number(),name:ht.string()}),severity:ht.enum(["Low","Medium","High","Critical"]),isActive:ht.boolean().default(!0),allowStorySubmissions:ht.boolean().default(!0)});const Oee=ht.object({id:ht.string(),communityId:ht.string(),region:ht.enum(["neighborhood","city","state","national","global"]),thread:ht.enum(["intro","content","faq"]).default("content"),content:ht.string().min(1,"Message content is required").max(1e3,"Message too long"),authorId:ht.string(),authorName:ht.string(),authorAvatar:ht.string().optional(),authorLocation:ht.object({lat:ht.number(),lng:ht.number(),name:ht.string()}).optional(),messageType:ht.enum(["text","image","link","event_share"]).default("text"),replyToId:ht.string().optional(),reactions:ht.array(ht.object({userId:ht.string(),emoji:ht.string()})).default([]),isEdited:ht.boolean().default(!1),editedAt:ht.string().datetime().optional(),createdAt:ht.string().datetime().default(()=>new Date().toISOString())});Oee.omit({id:!0,reactions:!0,isEdited:!0,editedAt:!0,createdAt:!0});const Fee=ht.object({id:ht.string(),senderId:ht.string(),senderName:ht.string(),senderAvatar:ht.string().optional(),recipientId:ht.string(),recipientName:ht.string(),recipientAvatar:ht.string().optional(),content:ht.string().min(1,"Message content is required").max(1e3,"Message too long"),messageType:ht.enum(["text","image","link"]).default("text"),isRead:ht.boolean().default(!1),readAt:ht.string().datetime().optional(),conversationId:ht.string(),createdAt:ht.string().datetime().default(()=>new Date().toISOString())});Fee.omit({id:!0,isRead:!0,readAt:!0,createdAt:!0});const jee=kee.omit({images:!0,location:!0,isLocationVerified:!0}).extend({title:ht.string().min(5,"Title must be at least 5 characters").max(200,"Title too long"),content:ht.string().min(20,"Content must be at least 20 characters").max(5e3,"Content too long"),author:ht.string().min(2,"Author name must be at least 2 characters")}),Bee=({isOpen:t,onClose:r,crisis:l,onSubmissionSuccess:d})=>{const{toast:_}=yp(),[x,C]=B.useState(!1),[s,k]=B.useState([]),[z,V]=B.useState([]),[U,$]=B.useState(!1),[se,ae]=B.useState(null),[H,ne]=B.useState("idle"),Y=DB({resolver:NB(jee),defaultValues:{title:"",content:"",excerpt:"",author:""}}),te=B.useCallback((Pe,Ye)=>{$(Pe),Ye&&ae(Ye)},[]),de=Pe=>{const vt=Array.from(Pe.target.files||[]).filter(It=>It.type.startsWith("image/")?It.size>5*1024*1024?(_({title:"File too large",description:`${It.name} is larger than 5MB`,variant:"destructive"}),!1):!0:(_({title:"Invalid file type",description:`${It.name} is not an image file`,variant:"destructive"}),!1));if(s.length+vt.length>5){_({title:"Too many images",description:"You can upload a maximum of 5 images",variant:"destructive"});return}k(It=>[...It,...vt]),vt.forEach(It=>{const Ut=new FileReader;Ut.onload=Pt=>{var $t;($t=Pt.target)!=null&&$t.result&&V(Ve=>[...Ve,Pt.target.result])},Ut.readAsDataURL(It)})},Me=Pe=>{k(Ye=>Ye.filter((vt,It)=>It!==Pe)),V(Ye=>Ye.filter((vt,It)=>It!==Pe))},Le=async Pe=>{if(!U||!se){_({title:"Location not verified",description:"Please verify your location before submitting your story",variant:"destructive"});return}C(!0);try{const Ye={title:Pe.title,content:Pe.content,excerpt:Pe.excerpt||Pe.content.substring(0,300),author:Pe.author,images:z,location:{lat:se.lat,lng:se.lng,name:l.location.name,crisisId:l.id}},vt=await fetch("/api/stories",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(Ye)});if(!vt.ok){const Ut=await vt.json();throw new Error(Ut.error||"Failed to submit story")}const It=await vt.json();ne("success"),_({title:"Story submitted successfully!",description:"Your story has been submitted for review and will be published once approved."}),setTimeout(()=>{Y.reset(),k([]),V([]),$(!1),ae(null),ne("idle"),d==null||d(),r()},2e3)}catch(Ye){console.error("Error submitting story:",Ye),_({title:"Submission failed",description:Ye instanceof Error?Ye.message:"Failed to submit story. Please try again.",variant:"destructive"})}finally{C(!1)}},lt=()=>{x||(Y.reset(),k([]),V([]),$(!1),ae(null),ne("idle"),r())};return H==="success"?w.jsx(tA,{open:t,onOpenChange:lt,children:w.jsx(bw,{className:"max-w-md","data-testid":"story-success-dialog",children:w.jsxs("div",{className:"text-center py-6",children:[w.jsx(ep,{className:"h-16 w-16 text-green-500 mx-auto mb-4"}),w.jsx("h3",{className:"text-lg font-semibold mb-2",children:"Story Submitted!"}),w.jsx("p",{className:"text-muted-foreground mb-4",children:"Your story has been submitted for review and will be published once approved by our moderation team."}),w.jsx(wi,{variant:"outline",className:"bg-blue-50",children:"Under Review"})]})})}):w.jsx(tA,{open:t,onOpenChange:lt,children:w.jsxs(bw,{className:"max-w-4xl max-h-[90vh] overflow-y-auto","data-testid":"story-submission-dialog",children:[w.jsx(HI,{children:w.jsxs(qI,{children:["Submit Your Story - ",l.name]})}),w.jsxs("div",{className:"space-y-6",children:[w.jsx(Mee,{crisis:l,onVerificationComplete:te}),w.jsxs("form",{onSubmit:Y.handleSubmit(Le),className:"space-y-4",children:[w.jsxs("div",{children:[w.jsx(Ml,{htmlFor:"title",children:"Story Title *"}),w.jsx(Mo,{id:"title","data-testid":"input-story-title",placeholder:"Enter a compelling title for your story",...Y.register("title"),className:"mt-1"}),Y.formState.errors.title&&w.jsx("p",{className:"text-sm text-red-500 mt-1",children:Y.formState.errors.title.message})]}),w.jsxs("div",{children:[w.jsx(Ml,{htmlFor:"author",children:"Your Name *"}),w.jsx(Mo,{id:"author","data-testid":"input-story-author",placeholder:"How should we credit you?",...Y.register("author"),className:"mt-1"}),Y.formState.errors.author&&w.jsx("p",{className:"text-sm text-red-500 mt-1",children:Y.formState.errors.author.message})]}),w.jsxs("div",{children:[w.jsx(Ml,{htmlFor:"content",children:"Your Story *"}),w.jsx(dp,{id:"content","data-testid":"textarea-story-content",placeholder:"Share your experience, observations, or message of hope...",...Y.register("content"),className:"mt-1 min-h-[150px]"}),Y.formState.errors.content&&w.jsx("p",{className:"text-sm text-red-500 mt-1",children:Y.formState.errors.content.message})]}),w.jsxs("div",{children:[w.jsx(Ml,{htmlFor:"excerpt",children:"Short Summary (Optional)"}),w.jsx(dp,{id:"excerpt","data-testid":"textarea-story-excerpt",placeholder:"A brief summary that will be shown in the story preview",...Y.register("excerpt"),className:"mt-1 h-20",maxLength:300}),Y.formState.errors.excerpt&&w.jsx("p",{className:"text-sm text-red-500 mt-1",children:Y.formState.errors.excerpt.message})]}),w.jsxs("div",{children:[w.jsx(Ml,{children:"Images (Optional)"}),w.jsxs("div",{className:"mt-1",children:[w.jsx("input",{type:"file",multiple:!0,accept:"image/*",onChange:de,className:"hidden",id:"image-upload","data-testid":"input-story-images"}),w.jsx(Ml,{htmlFor:"image-upload",className:"flex items-center justify-center w-full h-24 border-2 border-dashed border-gray-300 rounded-lg cursor-pointer hover:border-gray-400",children:w.jsxs("div",{className:"text-center",children:[w.jsx(x7,{className:"h-6 w-6 mx-auto mb-1 text-gray-400"}),w.jsx("span",{className:"text-sm text-gray-500",children:"Upload images (Max 5 files, 5MB each)"})]})})]}),z.length>0&&w.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-2 mt-3",children:z.map((Pe,Ye)=>w.jsx(ei,{className:"relative",children:w.jsxs(fi,{className:"p-2",children:[w.jsx("img",{src:Pe,alt:`Preview ${Ye+1}`,className:"w-full h-20 object-cover rounded"}),w.jsx(An,{type:"button",variant:"destructive",size:"sm",className:"absolute -top-2 -right-2 h-6 w-6 rounded-full p-0",onClick:()=>Me(Ye),"data-testid":`button-remove-image-${Ye}`,children:w.jsx(vh,{className:"h-3 w-3"})})]})},Ye))})]}),w.jsxs(vg,{children:[w.jsx(u7,{className:"h-4 w-4"}),w.jsxs(xg,{children:[w.jsx("strong",{children:"Story Guidelines:"})," Share authentic experiences and messages of hope. Content will be reviewed before publication to ensure it meets community standards. Offensive or inappropriate content will not be approved."]})]}),w.jsxs("div",{className:"flex justify-end gap-2 pt-4",children:[w.jsx(An,{type:"button",variant:"outline",onClick:lt,disabled:x,"data-testid":"button-cancel-story",children:"Cancel"}),w.jsx(An,{type:"submit",disabled:!U||x,"data-testid":"button-submit-story",children:x?w.jsxs(w.Fragment,{children:[w.jsx(Jv,{className:"h-4 w-4 mr-2 animate-spin"}),"Submitting..."]}):w.jsxs(w.Fragment,{children:[w.jsx(i2,{className:"h-4 w-4 mr-2"}),"Submit Story"]})})]})]})]})]})})},Vee=()=>{const{id:t}=dZ(),r=Hl(),[l,d]=B.useState(!1),{data:_=[],isLoading:x,error:C}=Ia({queryKey:["/api/stories/crisis",t],queryFn:async()=>{const ne=await fetch(`/api/stories/crisis/${t}`);if(!ne.ok)throw new Error("Failed to fetch stories");return ne.json()},enabled:!!t}),s=dh({mutationFn:async ne=>{const Y=await fetch(`/api/stories/${ne}/like`,{method:"POST",headers:{"Content-Type":"application/json"}});if(!Y.ok)throw new Error("Failed to like story");return Y.json()},onSuccess:()=>{Pu.invalidateQueries({queryKey:["/api/stories/crisis",t]})}}),z=(ne=>({"gaza-2024":{id:ne,name:"Gaza Strip",severity:"Critical",affected:21e5,description:"Aid access heavily constrained; nearly entire population displaced during war.",image:"https://images.unsplash.com/photo-1578662996442-48f60103fc96?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80",location:"Gaza, Palestine",lastUpdated:"2025-10-15",statistics:{displaced:21e5,needingAid:21e5,childrenAffected:9e5,partnersOnGround:88}},"sudan-2025":{id:ne,name:"Sudan",severity:"Critical",affected:304e5,description:"Largest humanitarian crisis; >4M refugees in neighboring states + massive internal displacement.",image:"https://images.unsplash.com/photo-1547471080-7cc2caa01a7e?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80",location:"Sudan",lastUpdated:"2025-10-15",statistics:{displaced:12e6,needingAid:304e5,childrenAffected:14e6,partnersOnGround:120}},"ukraine-2025":{id:ne,name:"Ukraine",severity:"Critical",affected:127e5,description:"Ongoing strikes on energy and civilian infrastructure.",image:"https://images.unsplash.com/photo-1605818610003-0a1476dfbc26?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80",location:"Ukraine",lastUpdated:"2025-10-15",statistics:{displaced:65e5,needingAid:127e5,childrenAffected:35e5,partnersOnGround:95}},"syria-2025":{id:ne,name:"Syria",severity:"Critical",affected:17e6,description:"Response plans remain severely underfunded.",image:"https://images.unsplash.com/photo-1591608971362-f08b2a75731a?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80",location:"Syria",lastUpdated:"2025-10-15",statistics:{displaced:72e5,needingAid:17e6,childrenAffected:68e5,partnersOnGround:110}},"yemen-2025":{id:ne,name:"Yemen",severity:"Critical",affected:195e5,description:"Funding gaps are acute.",image:"https://images.unsplash.com/photo-1591608971362-f08b2a75731a?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80",location:"Yemen",lastUpdated:"2025-10-15",statistics:{displaced:45e5,needingAid:195e5,childrenAffected:11e6,partnersOnGround:78}},"afghanistan-2025":{id:ne,name:"Afghanistan",severity:"Critical",affected:229e5,description:"Agencies warn of winter risks and service shutdowns due to cuts.",image:"https://images.unsplash.com/photo-1564859228273-274232fdb516?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80",location:"Afghanistan",lastUpdated:"2025-10-15",statistics:{displaced:43e5,needingAid:229e5,childrenAffected:128e5,partnersOnGround:85}},"myanmar-2025":{id:ne,name:"Myanmar",severity:"Critical",affected:21e6,description:"Civil conflict with massive displacement.",image:"https://images.unsplash.com/photo-1528181304800-259b08848526?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80",location:"Myanmar",lastUpdated:"2025-10-15",statistics:{displaced:36e5,needingAid:21e6,childrenAffected:84e5,partnersOnGround:62}},"drc-2025":{id:ne,name:"DR Congo",severity:"Critical",affected:28e6,description:"Conflict in the east and record hunger.",image:"https://images.unsplash.com/photo-1584380931214-dbb5b72e7fd0?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80",location:"Democratic Republic of Congo",lastUpdated:"2025-10-15",statistics:{displaced:71e5,needingAid:28e6,childrenAffected:14e6,partnersOnGround:92}},"somalia-2025":{id:ne,name:"Somalia",severity:"High",affected:6e6,description:"Drought, flooding, and conflict.",image:"https://images.unsplash.com/photo-1593113598332-cd288d649433?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80",location:"Somalia",lastUpdated:"2025-10-15",statistics:{displaced:35e5,needingAid:6e6,childrenAffected:24e5,partnersOnGround:54}},"south-sudan-2025":{id:ne,name:"South Sudan",severity:"Critical",affected:93e5,description:"Flooding and violence; nearly 0.5M newly displaced in 2025.",image:"https://images.unsplash.com/photo-1547471080-7cc2caa01a7e?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80",location:"South Sudan",lastUpdated:"2025-10-15",statistics:{displaced:23e5,needingAid:93e5,childrenAffected:42e5,partnersOnGround:68}},"haiti-2025":{id:ne,name:"Haiti",severity:"Critical",affected:5e6,description:"Gang control over Port-au-Prince, political vacuum, kidnappings, cholera resurgence, famine-risk zones.",image:"https://images.unsplash.com/photo-1505142468610-359e7d316be0?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80",location:"Haiti",lastUpdated:"2025-10-15",statistics:{displaced:7e5,needingAid:5e6,childrenAffected:22e5,partnersOnGround:42}},"burkina-faso-2025":{id:ne,name:"Burkina Faso",severity:"High",affected:59e5,description:"Severely neglected crisis.",image:"https://images.unsplash.com/photo-1516026672322-bc52d61a55d5?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80",location:"Burkina Faso",lastUpdated:"2025-10-15",statistics:{displaced:2e6,needingAid:59e5,childrenAffected:295e4,partnersOnGround:38}},"chad-2025":{id:ne,name:"Chad",severity:"High",affected:128e4,description:"Hosting Sudanese refugees, straining fragile context.",image:"https://images.unsplash.com/photo-1547471080-7cc2caa01a7e?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80",location:"Chad",lastUpdated:"2025-10-15",statistics:{displaced:128e4,needingAid:128e4,childrenAffected:64e4,partnersOnGround:45}},"rohingya-2025":{id:ne,name:"Rohingya (Bangladesh)",severity:"High",affected:12e5,description:"Refugees in Cox's Bazar and Bhasan Char.",image:"https://images.unsplash.com/photo-1528181304800-259b08848526?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80",location:"Cox's Bazar, Bangladesh",lastUpdated:"2025-10-15",statistics:{displaced:12e5,needingAid:148e4,childrenAffected:6e5,partnersOnGround:52}},"car-2025":{id:ne,name:"Central African Republic",severity:"High",affected:24e5,description:"Limited humanitarian access and funding.",image:"https://images.unsplash.com/photo-1584380931214-dbb5b72e7fd0?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80",location:"Central African Republic",lastUpdated:"2025-10-15",statistics:{displaced:8e5,needingAid:24e5,childrenAffected:12e5,partnersOnGround:36}},"lebanon-2025":{id:ne,name:"Lebanon",severity:"High",affected:41e5,description:"Economic collapse and regional conflict spillovers.",image:"https://images.unsplash.com/photo-1552832230-c0197dd311b5?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80",location:"Lebanon",lastUpdated:"2025-10-15",statistics:{displaced:85e4,needingAid:41e5,childrenAffected:16e5,partnersOnGround:58}},"venezuela-2025":{id:ne,name:"Venezuela",severity:"Critical",affected:75e5,description:"Largest displacement in Western Hemisphere - comparable to Syria. Economic collapse, food/medicine shortages.",image:"https://images.unsplash.com/photo-1589909202802-8f4aadce1849?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80",location:"Venezuela (Regional Crisis)",lastUpdated:"2025-10-15",statistics:{displaced:75e5,needingAid:75e5,childrenAffected:28e5,partnersOnGround:72}},"north-korea-2025":{id:ne,name:"North Korea",severity:"High",affected:1e7,description:"Severe food insecurity and chronic malnutrition crisis.",image:"https://images.unsplash.com/photo-1564859228273-274232fdb516?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80",location:"North Korea",lastUpdated:"2025-10-15",statistics:{displaced:0,needingAid:1e7,childrenAffected:35e5,partnersOnGround:12}},"colombia-2025":{id:ne,name:"Colombia",severity:"High",affected:6e6,description:"Resurgent armed groups (ELN, FARC dissidents), coca-economy violence, Venezuelan refugee strain.",image:"https://images.unsplash.com/photo-1589909202802-8f4aadce1849?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80",location:"Colombia",lastUpdated:"2025-10-15",statistics:{displaced:85e5,needingAid:6e6,childrenAffected:24e5,partnersOnGround:64}},"central-america-2025":{id:ne,name:"Central America (Northern Triangle)",severity:"Medium",affected:3e6,description:"Chronic violence, extortion, corruption, climate crop failures. Millions displaced or migrating north.",image:"https://images.unsplash.com/photo-1505142468610-359e7d316be0?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80",location:"Guatemala, El Salvador, Honduras",lastUpdated:"2025-10-15",statistics:{displaced:12e5,needingAid:3e6,childrenAffected:14e5,partnersOnGround:48}},"cuba-2025":{id:ne,name:"Cuba",severity:"Medium",affected:5e6,description:"Severe economic crisis, power shortages, medicine scarcity, record outward migration to U.S.",image:"https://images.unsplash.com/photo-1505142468610-359e7d316be0?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80",location:"Cuba",lastUpdated:"2025-10-15",statistics:{displaced:5e5,needingAid:5e6,childrenAffected:18e5,partnersOnGround:22}}})[ne]||{id:t||"1",name:"Humanitarian Crisis",severity:"High",affected:1e6,description:"Humanitarian crisis requiring urgent international response and support.",image:"https://images.unsplash.com/photo-1544027993-37dbfe43562a?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80",location:"Unknown",lastUpdated:"2025-10-15",statistics:{displaced:5e5,needingAid:1e6,childrenAffected:4e5,partnersOnGround:25}})(t||""),V=[{id:1,name:"Sarah Johnson",avatar:"SJ",role:"Relief Coordinator",online:!0},{id:2,name:"Dr. Ahmed Hassan",avatar:"AH",role:"Medical Director",online:!0},{id:3,name:"Maria Garcia",avatar:"MG",role:"Logistics Manager",online:!1},{id:4,name:"James Liu",avatar:"JL",role:"Field Reporter",online:!0}],$=(ne=>ne==="gaza-2024"?[{id:1,title:"UN confirms famine conditions in Gaza City",date:"2025-09-20",summary:"Widespread acute malnutrition documented with 28,000 cases among children under 5."},{id:2,title:"Less than 35% of required food supplies entering Gaza",date:"2025-09-18",summary:"Severe access restrictions hampering humanitarian aid delivery to 1.9 million displaced people."},{id:3,title:"Only 17 of 35 hospitals partially functioning",date:"2025-09-15",summary:"Healthcare system severely compromised with critical shortages of medical supplies and equipment."}]:[{id:1,title:"New aid shipment arrives at border crossing",date:"2024-01-15",summary:"Critical medical supplies and food provisions distributed to refugee camps."},{id:2,title:"International donors pledge additional $50M in emergency funding",date:"2024-01-14",summary:"Major breakthrough in securing resources for long-term humanitarian response."},{id:3,title:"Winter shelter program expanded to accommodate 10,000 more families",date:"2024-01-13",summary:"Urgent winterization efforts underway as temperatures drop below freezing."}])(t||""),ae=(ne=>ne==="gaza-2024"?[{id:1,title:"Emergency Food Distribution",date:"2025-09-30",time:"08:00 AM",location:"Gaza City Distribution Point",type:"Food Aid"},{id:2,title:"Mobile Medical Clinic",date:"2025-10-02",time:"10:00 AM",location:"Khan Younis Refugee Camp",type:"Medical"},{id:3,title:"Child Malnutrition Screening",date:"2025-10-05",time:"09:00 AM",location:"Rafah Health Center",type:"Health"}]:[{id:1,title:"Emergency Relief Distribution",date:"2024-01-18",time:"09:00 AM",location:"Border Camp A",type:"Aid Distribution"},{id:2,title:"Medical Clinic Setup",date:"2024-01-20",time:"10:00 AM",location:"Refugee Center B",type:"Medical"},{id:3,title:"Volunteer Coordination Meeting",date:"2024-01-22",time:"02:00 PM",location:"Virtual",type:"Coordination"}])(t||""),H=_;return w.jsxs("div",{className:"min-h-screen bg-background",children:[w.jsx("div",{className:"sticky top-0 z-40 bg-background/95 backdrop-blur supports-[backdrop-filter]:bg-background/60 border-b",children:w.jsx("div",{className:"container mx-auto px-4 py-4",children:w.jsxs("div",{className:"flex items-center gap-4",children:[w.jsxs(An,{variant:"ghost",size:"sm",onClick:()=>r("/"),children:[w.jsx(r2,{className:"h-4 w-4 mr-2"}),"Back to Map"]}),w.jsxs("div",{className:"flex items-center gap-3",children:[w.jsx(wi,{variant:z.severity==="Critical"?"destructive":"secondary",children:z.severity}),w.jsx("h1",{className:"text-2xl font-bold",children:z.name})]})]})})}),w.jsxs("div",{className:"relative h-64 overflow-hidden",children:[w.jsx("img",{src:z.image,alt:z.name,className:"w-full h-full object-cover"}),w.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-black/60 to-transparent",children:w.jsx("div",{className:"container mx-auto px-4 h-full flex items-end",children:w.jsxs("div",{className:"text-white pb-8",children:[w.jsx("h2",{className:"text-3xl font-bold mb-2",children:z.name}),w.jsx("p",{className:"text-lg opacity-90",children:z.location}),w.jsxs("p",{className:"text-sm opacity-75",children:["Last updated: ",z.lastUpdated]})]})})})]}),w.jsxs("div",{className:"container mx-auto px-4 py-8 max-w-7xl",children:[w.jsxs(rP,{defaultValue:"overview",className:"space-y-6",children:[w.jsxs(C2,{className:"grid w-full grid-cols-3 h-auto",children:[w.jsx(kl,{value:"overview",className:"text-xs md:text-sm py-2",children:"Overview"}),w.jsx(kl,{value:"stories",className:"text-xs md:text-sm py-2",children:"Stories"}),w.jsx(kl,{value:"get-involved",className:"text-xs md:text-sm py-2",children:"Get Involved"})]}),w.jsx(Dl,{value:"overview",className:"space-y-6",children:w.jsxs(ei,{children:[w.jsx(Yi,{children:w.jsx(us,{children:"Crisis Overview"})}),w.jsxs(fi,{children:[w.jsx("p",{className:"text-muted-foreground leading-relaxed mb-8",children:z.description}),w.jsxs("div",{className:"space-y-6",children:[w.jsx("h3",{className:"text-xl font-semibold",children:"Statistics"}),w.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[w.jsxs("div",{className:"text-center",children:[w.jsx("div",{className:"text-2xl font-bold text-primary",children:z.statistics.displaced.toLocaleString()}),w.jsx("div",{className:"text-sm text-muted-foreground",children:"Displaced"})]}),w.jsxs("div",{className:"text-center",children:[w.jsx("div",{className:"text-2xl font-bold text-primary",children:z.statistics.needingAid.toLocaleString()}),w.jsx("div",{className:"text-sm text-muted-foreground",children:"Need Aid"})]}),w.jsxs("div",{className:"text-center",children:[w.jsx("div",{className:"text-2xl font-bold text-primary",children:z.statistics.childrenAffected.toLocaleString()}),w.jsx("div",{className:"text-sm text-muted-foreground",children:"Children"})]}),w.jsxs("div",{className:"text-center",children:[w.jsx("div",{className:"text-2xl font-bold text-primary",children:z.statistics.partnersOnGround}),w.jsx("div",{className:"text-sm text-muted-foreground",children:"Partners"})]})]}),w.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6 mt-6",children:[w.jsxs(ei,{children:[w.jsx(Yi,{children:w.jsxs(us,{className:"flex items-center gap-2",children:[w.jsx(ho,{className:"h-5 w-5"}),"Population Impact"]})}),w.jsx(fi,{className:"space-y-4",children:w.jsxs("div",{className:"space-y-2",children:[w.jsxs("div",{className:"flex justify-between",children:[w.jsx("span",{children:"Total Displaced"}),w.jsx("span",{className:"font-semibold",children:z.statistics.displaced.toLocaleString()})]}),w.jsxs("div",{className:"flex justify-between",children:[w.jsx("span",{children:"Needing Aid"}),w.jsx("span",{className:"font-semibold",children:z.statistics.needingAid.toLocaleString()})]}),w.jsxs("div",{className:"flex justify-between",children:[w.jsx("span",{children:"Children Affected"}),w.jsx("span",{className:"font-semibold",children:z.statistics.childrenAffected.toLocaleString()})]})]})})]}),w.jsxs(ei,{children:[w.jsx(Yi,{children:w.jsxs(us,{className:"flex items-center gap-2",children:[w.jsx(y7,{className:"h-5 w-5"}),"Response Metrics"]})}),w.jsx(fi,{className:"space-y-4",children:w.jsxs("div",{className:"space-y-2",children:[w.jsxs("div",{className:"flex justify-between",children:[w.jsx("span",{children:"Partners on Ground"}),w.jsx("span",{className:"font-semibold",children:z.statistics.partnersOnGround})]}),w.jsxs("div",{className:"flex justify-between",children:[w.jsx("span",{children:"Aid Coverage"}),w.jsx("span",{className:"font-semibold",children:t==="gaza-2024"?"35%":"72%"})]}),w.jsxs("div",{className:"flex justify-between",children:[w.jsx("span",{children:"Funding Received"}),w.jsx("span",{className:"font-semibold",children:t==="gaza-2024"?"$1.05B":"$127M"})]}),t==="gaza-2024"&&w.jsxs("div",{className:"flex justify-between",children:[w.jsx("span",{children:"Funding Required"}),w.jsx("span",{className:"font-semibold",children:"$6.6B"})]})]})})]})]})]})]})]})}),w.jsxs(Dl,{value:"stories",className:"space-y-6",children:[w.jsxs("div",{className:"text-center mb-8",children:[w.jsx("h2",{className:"text-3xl font-bold mb-2",children:"Archive Your Stories"}),w.jsx("p",{className:"text-lg text-muted-foreground",children:"Get visibility, forever your pains won't go unheard"})]}),w.jsxs("div",{className:"flex justify-between items-center",children:[w.jsxs("h3",{className:"text-lg font-semibold",children:["Community Stories (",H.length,")"]}),w.jsxs(An,{onClick:()=>d(!0),className:"flex items-center gap-2","data-testid":"button-submit-story",children:[w.jsx(Ug,{className:"h-4 w-4"}),"Submit Your Story"]})]}),x?w.jsxs("div",{className:"text-center py-12","data-testid":"text-loading-stories",children:[w.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-purple-500 mx-auto mb-4"}),w.jsx("p",{className:"text-muted-foreground",children:"Loading stories..."})]}):C?w.jsx(ei,{children:w.jsxs(fi,{className:"p-12 text-center","data-testid":"text-error-stories",children:[w.jsx(Pc,{className:"h-12 w-12 text-red-500 mx-auto mb-4"}),w.jsx("h3",{className:"text-lg font-semibold text-muted-foreground mb-2",children:"Failed to Load Stories"}),w.jsx("p",{className:"text-muted-foreground",children:"Unable to fetch stories at this time. Please try again later."})]})}):H.length===0?w.jsx(ei,{children:w.jsxs(fi,{className:"p-12 text-center","data-testid":"text-no-stories",children:[w.jsx(Pc,{className:"h-12 w-12 text-muted-foreground mx-auto mb-4"}),w.jsx("h3",{className:"text-lg font-semibold text-muted-foreground mb-2",children:"No Stories Yet"}),w.jsx("p",{className:"text-muted-foreground mb-4",children:"Be the first to share your story from this crisis"}),w.jsxs(An,{onClick:()=>d(!0),children:[w.jsx(Ug,{className:"h-4 w-4 mr-2"}),"Submit Your Story"]})]})}):w.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:H.map(ne=>w.jsxs(ei,{className:"overflow-hidden","data-testid":`story-card-${ne.id}`,children:[ne.images&&ne.images.length>0&&w.jsx("div",{className:"aspect-video overflow-hidden",children:w.jsx("img",{src:ne.images[0],alt:ne.title,className:"w-full h-full object-cover hover:scale-105 transition-transform duration-300"})}),w.jsxs(fi,{className:"p-4",children:[w.jsx("h3",{className:"font-semibold mb-2","data-testid":`story-title-${ne.id}`,children:ne.title}),w.jsx("p",{className:"text-sm text-muted-foreground mb-3 line-clamp-3","data-testid":`story-excerpt-${ne.id}`,children:ne.excerpt}),w.jsxs("div",{className:"flex justify-between items-center text-sm",children:[w.jsxs("span",{className:"text-muted-foreground","data-testid":`story-author-${ne.id}`,children:["by ",ne.author]}),w.jsxs(An,{variant:"ghost",size:"sm",onClick:()=>s.mutate(ne.id),disabled:s.isPending,className:"flex items-center gap-1","data-testid":`button-like-${ne.id}`,children:[w.jsx(kv,{className:"h-4 w-4 text-red-500"}),w.jsx("span",{children:ne.likes})]})]}),w.jsx("div",{className:"text-xs text-muted-foreground mt-1","data-testid":`story-date-${ne.id}`,children:new Date(ne.submittedAt).toLocaleDateString()})]})]},ne.id))})]}),w.jsxs(Dl,{value:"get-involved",className:"space-y-8",children:[w.jsxs(ei,{children:[w.jsx(Yi,{children:w.jsx(us,{children:"Active Community Members"})}),w.jsxs(fi,{children:[w.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:V.map(ne=>w.jsxs("div",{className:"flex items-center gap-3 p-3 rounded-lg border",children:[w.jsxs("div",{className:"relative",children:[w.jsxs(fo,{children:[w.jsx(Ra,{src:ne.avatar}),w.jsx(po,{children:ne.avatar})]}),ne.online&&w.jsx("div",{className:"absolute -bottom-1 -right-1 w-3 h-3 bg-green-500 rounded-full border-2 border-background"})]}),w.jsxs("div",{children:[w.jsx("div",{className:"font-medium",children:ne.name}),w.jsx("div",{className:"text-sm text-muted-foreground",children:ne.role})]})]},ne.id))}),w.jsxs(An,{className:"w-full mt-4",onClick:()=>{const ne=`crisis_community_${t}`,Y=new URLSearchParams({id:ne,name:`${z.name} Support Community`,category:"Crisis Response"});r(`/community-chat?${Y.toString()}`)},"data-testid":"button-join-crisis-chat",children:[w.jsx(Pc,{className:"h-4 w-4 mr-2"}),"Join Community Chat"]})]})]}),w.jsxs("div",{className:"space-y-4",children:[w.jsx("h3",{className:"text-xl font-semibold",children:"Latest News"}),$.map(ne=>w.jsx(ei,{children:w.jsxs(fi,{className:"p-6",children:[w.jsxs("div",{className:"flex justify-between items-start mb-2",children:[w.jsx("h4",{className:"font-semibold text-lg",children:ne.title}),w.jsx("span",{className:"text-sm text-muted-foreground",children:ne.date})]}),w.jsx("p",{className:"text-muted-foreground",children:ne.summary})]})},ne.id))]}),w.jsxs("div",{className:"space-y-4",children:[w.jsx("h3",{className:"text-xl font-semibold",children:"Upcoming Events"}),ae.map(ne=>w.jsx(ei,{children:w.jsx(fi,{className:"p-6",children:w.jsxs("div",{className:"flex justify-between items-start mb-2",children:[w.jsxs("div",{children:[w.jsx("h4",{className:"font-semibold text-lg",children:ne.title}),w.jsxs("div",{className:"flex items-center gap-4 mt-2 text-sm text-muted-foreground",children:[w.jsxs("span",{className:"flex items-center gap-1",children:[w.jsx(vu,{className:"h-4 w-4"}),ne.date," at ",ne.time]}),w.jsx("span",{children:ne.location})]})]}),w.jsx(wi,{variant:"outline",children:ne.type})]})})},ne.id))]})]})]}),w.jsx(Bee,{isOpen:l,onClose:()=>d(!1),crisis:{id:z.id,name:z.name,location:{lat:t==="gaza-2024"?31.5017:49.8397,lng:t==="gaza-2024"?34.4668:24.0297,name:z.location},severity:z.severity,isActive:!0,allowStorySubmissions:!0},onSubmissionSuccess:()=>{Pu.invalidateQueries({queryKey:["/api/stories/crisis",t]}),d(!1)}})]})]})};var Uee="Toggle",qB=B.forwardRef((t,r)=>{const{pressed:l,defaultPressed:d=!1,onPressedChange:_,...x}=t,[C=!1,s]=kc({prop:l,onChange:_,defaultProp:d});return w.jsx(ir.button,{type:"button","aria-pressed":C,"data-state":C?"on":"off","data-disabled":t.disabled?"":void 0,...x,ref:r,onClick:mn(t.onClick,()=>{t.disabled||s(!C)})})});qB.displayName=Uee;var WB=qB;const $ee=r_("inline-flex items-center justify-center rounded-md text-sm font-medium ring-offset-background transition-colors hover:bg-muted hover:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=on]:bg-accent data-[state=on]:text-accent-foreground",{variants:{variant:{default:"bg-transparent",outline:"border border-input bg-transparent hover:bg-accent hover:text-accent-foreground"},size:{default:"h-10 px-3",sm:"h-9 px-2.5",lg:"h-11 px-5"}},defaultVariants:{variant:"default",size:"default"}}),ZB=B.forwardRef(({className:t,variant:r,size:l,...d},_)=>w.jsx(WB,{ref:_,className:rr($ee({variant:r,size:l,className:t})),...d}));ZB.displayName=WB.displayName;const Gee=({posts:t,onOpenDM:r,onJoinEvent:l})=>{const[d,_]=B.useState("all"),[x,C]=B.useState("all"),[s,k]=B.useState("all"),z=[{id:"1",type:"event",author:"Sarah Chen",authorAvatar:"/api/placeholder/40/40",community:"Climate Action SF",communityType:"local",content:"Join us for a community tree planting event this Saturday! We'll be working to restore the urban canopy in Mission Dolores Park.",timestamp:"2024-09-25T10:00:00Z",location:"Mission Dolores Park, San Francisco",eventDate:"2024-09-28T09:00:00Z",region:"neighborhood",likes:24,comments:8,tags:["environment","volunteer","local-action"]},{id:"2",type:"post",author:"Alex Rivera",authorAvatar:"/api/placeholder/40/40",community:"Global Tech Workers",communityType:"online",content:"Amazing news! Our remote work advocacy efforts led to new legislation supporting digital nomad visas. This affects tech workers globally.",timestamp:"2024-09-25T14:30:00Z",region:"global",likes:156,comments:43,tags:["tech","remote-work","policy"]},{id:"3",type:"event",author:"Maria Santos",authorAvatar:"/api/placeholder/40/40",community:"CA Housing Rights",communityType:"local",content:"Statewide housing rights workshop - learn about tenant protections and organizing strategies. Virtual event open to all California residents.",timestamp:"2024-09-25T16:15:00Z",eventDate:"2024-10-02T18:00:00Z",region:"state",likes:67,comments:22,tags:["housing","rights","education"]}],U=(t.length>0?t:z).filter(H=>{const ne=d==="all"||H.region===d,Y=x==="all"||H.type===x;return ne&&Y}),$=H=>{const ne=new Date(H),te=new Date().getTime()-ne.getTime();return te<36e5?`${Math.floor(te/6e4)}m ago`:te<864e5?`${Math.floor(te/36e5)}h ago`:ne.toLocaleDateString()},se=H=>{switch(H){case"neighborhood":return w.jsx(OO,{className:"h-3 w-3"});case"city":return w.jsx(kO,{className:"h-3 w-3"});case"state":return w.jsx(BO,{className:"h-3 w-3"});case"national":return w.jsx(tp,{className:"h-3 w-3"});case"global":return w.jsx(tp,{className:"h-3 w-3"});default:return w.jsx(ro,{className:"h-3 w-3"})}},ae=H=>{switch(H){case"neighborhood":return"bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-300";case"city":return"bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-300";case"state":return"bg-purple-100 text-purple-800 dark:bg-purple-900 dark:text-purple-300";case"national":return"bg-orange-100 text-orange-800 dark:bg-orange-900 dark:text-orange-300";case"global":return"bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-300";default:return"bg-gray-100 text-gray-800 dark:bg-gray-900 dark:text-gray-300"}};return w.jsxs("div",{className:"space-y-6",children:[w.jsxs("div",{className:"flex flex-wrap gap-4 p-4 bg-card rounded-lg border",children:[w.jsxs("div",{className:"flex items-center gap-2",children:[w.jsx(zO,{className:"h-4 w-4 text-muted-foreground"}),w.jsx("span",{className:"text-sm font-medium",children:"Filters:"})]}),w.jsxs(qg,{value:d,onValueChange:_,children:[w.jsx(lp,{className:"w-40","data-testid":"select-region-filter",children:w.jsx(Wg,{placeholder:"All Regions"})}),w.jsxs(cp,{children:[w.jsx(zi,{value:"all",children:"All Regions"}),w.jsx(zi,{value:"neighborhood",children:"Neighborhood"}),w.jsx(zi,{value:"city",children:"City"}),w.jsx(zi,{value:"state",children:"State"}),w.jsx(zi,{value:"national",children:"National"}),w.jsx(zi,{value:"global",children:"Global"})]})]}),w.jsxs(qg,{value:x,onValueChange:C,children:[w.jsx(lp,{className:"w-32","data-testid":"select-type-filter",children:w.jsx(Wg,{placeholder:"All Types"})}),w.jsxs(cp,{children:[w.jsx(zi,{value:"all",children:"All Types"}),w.jsx(zi,{value:"post",children:"Posts"}),w.jsx(zi,{value:"event",children:"Events"})]})]})]}),w.jsxs(rP,{value:s,onValueChange:k,className:"w-full",children:[w.jsxs(C2,{className:"grid w-full grid-cols-3",children:[w.jsx(kl,{value:"all","data-testid":"tab-all-feed",children:"All Feed"}),w.jsx(kl,{value:"events","data-testid":"tab-events-feed",children:"Events"}),w.jsx(kl,{value:"discussions","data-testid":"tab-discussions-feed",children:"Discussions"})]}),w.jsx(Dl,{value:"all",className:"mt-6",children:w.jsx("div",{className:"space-y-4",children:U.length===0?w.jsxs("div",{className:"text-center py-12","data-testid":"text-no-feed-items",children:[w.jsx(ag,{className:"h-12 w-12 text-muted-foreground mx-auto mb-4"}),w.jsx("h3",{className:"text-lg font-semibold mb-2",children:"No posts to show"}),w.jsx("p",{className:"text-muted-foreground",children:"Join some communities to see posts and events in your feed"})]}):U.map(H=>w.jsxs(ei,{className:"hover:shadow-md transition-shadow","data-testid":`card-feed-item-${H.id}`,children:[w.jsx(Yi,{className:"pb-3",children:w.jsxs("div",{className:"flex items-start gap-3",children:[w.jsxs(fo,{className:"h-10 w-10",children:[w.jsx(Ra,{src:H.authorAvatar}),w.jsx(po,{children:H.author.substring(0,2).toUpperCase()})]}),w.jsxs("div",{className:"flex-1 min-w-0",children:[w.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[w.jsx("span",{className:"font-semibold text-sm","data-testid":`text-author-${H.id}`,children:H.author}),w.jsx("span",{className:"text-muted-foreground text-xs",children:"•"}),w.jsx("span",{className:"text-muted-foreground text-xs","data-testid":`text-community-${H.id}`,children:H.community}),w.jsx("span",{className:"text-muted-foreground text-xs",children:"•"}),w.jsx("span",{className:"text-muted-foreground text-xs",children:$(H.timestamp)})]}),w.jsxs("div",{className:"flex items-center gap-2",children:[w.jsx(wi,{variant:H.type==="event"?"default":"secondary",className:"text-xs","data-testid":`badge-type-${H.id}`,children:H.type==="event"?w.jsxs(w.Fragment,{children:[w.jsx(vu,{className:"h-3 w-3 mr-1"}),"Event"]}):"Discussion"}),w.jsxs(wi,{variant:"outline",className:`text-xs ${ae(H.region)}`,"data-testid":`badge-region-${H.id}`,children:[se(H.region),w.jsx("span",{className:"ml-1 capitalize",children:H.region})]})]})]})]})}),w.jsxs(fi,{className:"pt-0",children:[w.jsx("p",{className:"mb-4 text-sm leading-relaxed","data-testid":`text-content-${H.id}`,children:H.content}),H.type==="event"&&H.location&&w.jsxs("div",{className:"mb-4 p-3 bg-muted/50 rounded-lg",children:[w.jsxs("div",{className:"flex items-center gap-2 text-sm text-muted-foreground mb-1",children:[w.jsx(ro,{className:"h-4 w-4"}),w.jsx("span",{"data-testid":`text-location-${H.id}`,children:H.location})]}),H.eventDate&&w.jsxs("div",{className:"flex items-center gap-2 text-sm text-muted-foreground",children:[w.jsx(vu,{className:"h-4 w-4"}),w.jsx("span",{"data-testid":`text-event-date-${H.id}`,children:new Date(H.eventDate).toLocaleDateString("en-US",{weekday:"long",year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"})})]})]}),H.tags.length>0&&w.jsx("div",{className:"flex flex-wrap gap-1 mb-4",children:H.tags.map(ne=>w.jsx(wi,{variant:"outline",className:"text-xs","data-testid":`tag-${ne}-${H.id}`,children:ne},ne))}),w.jsxs("div",{className:"flex items-center justify-between",children:[w.jsxs("div",{className:"flex items-center gap-4",children:[w.jsxs(An,{variant:"ghost",size:"sm",className:"h-8 gap-2","data-testid":`button-like-${H.id}`,children:[w.jsx(kv,{className:"h-4 w-4"}),w.jsx("span",{className:"text-xs",children:H.likes})]}),w.jsxs(An,{variant:"ghost",size:"sm",className:"h-8 gap-2","data-testid":`button-comment-${H.id}`,children:[w.jsx(ag,{className:"h-4 w-4"}),w.jsx("span",{className:"text-xs",children:H.comments})]}),w.jsx(An,{variant:"ghost",size:"sm",className:"h-8","data-testid":`button-share-${H.id}`,children:w.jsx(p7,{className:"h-4 w-4"})})]}),w.jsxs("div",{className:"flex items-center gap-2",children:[H.communityType==="online"&&w.jsxs(An,{variant:"outline",size:"sm","data-testid":`button-find-nearby-${H.id}`,children:[w.jsx(ho,{className:"h-4 w-4 mr-1"}),"Find Nearby"]}),H.type==="event"&&l&&w.jsx(An,{variant:"default",size:"sm",onClick:()=>l(H.id),"data-testid":`button-join-event-${H.id}`,children:"Join Event"}),r&&w.jsx(An,{variant:"outline",size:"sm",onClick:()=>r(H.author),"data-testid":`button-dm-${H.id}`,children:"Message"})]})]})]})]},H.id))})}),w.jsx(Dl,{value:"events",className:"mt-6",children:w.jsx("div",{className:"space-y-4",children:U.filter(H=>H.type==="event").map(H=>w.jsxs(ei,{className:"hover:shadow-md transition-shadow","data-testid":`card-event-${H.id}`,children:[w.jsx(Yi,{className:"pb-3",children:w.jsxs("div",{className:"flex items-start gap-3",children:[w.jsxs(fo,{className:"h-10 w-10",children:[w.jsx(Ra,{src:H.authorAvatar}),w.jsx(po,{children:H.author.substring(0,2).toUpperCase()})]}),w.jsxs("div",{className:"flex-1 min-w-0",children:[w.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[w.jsx("span",{className:"font-semibold text-sm",children:H.author}),w.jsx("span",{className:"text-muted-foreground text-xs",children:"•"}),w.jsx("span",{className:"text-muted-foreground text-xs",children:H.community}),w.jsx("span",{className:"text-muted-foreground text-xs",children:"•"}),w.jsx("span",{className:"text-muted-foreground text-xs",children:$(H.timestamp)})]}),w.jsxs(wi,{variant:"default",className:"text-xs",children:[w.jsx(vu,{className:"h-3 w-3 mr-1"}),"Event"]})]})]})}),w.jsxs(fi,{className:"pt-0",children:[w.jsx("p",{className:"mb-4 text-sm leading-relaxed",children:H.content}),H.location&&w.jsxs("div",{className:"mb-4 p-3 bg-muted/50 rounded-lg",children:[w.jsxs("div",{className:"flex items-center gap-2 text-sm text-muted-foreground mb-1",children:[w.jsx(ro,{className:"h-4 w-4"}),w.jsx("span",{children:H.location})]}),H.eventDate&&w.jsxs("div",{className:"flex items-center gap-2 text-sm text-muted-foreground",children:[w.jsx(vu,{className:"h-4 w-4"}),w.jsx("span",{children:new Date(H.eventDate).toLocaleDateString("en-US",{weekday:"long",year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"})})]})]}),w.jsxs("div",{className:"flex items-center justify-between",children:[w.jsxs("div",{className:"flex items-center gap-4",children:[w.jsxs(An,{variant:"ghost",size:"sm",className:"h-8 gap-2",children:[w.jsx(kv,{className:"h-4 w-4"}),w.jsx("span",{className:"text-xs",children:H.likes})]}),w.jsxs(An,{variant:"ghost",size:"sm",className:"h-8 gap-2",children:[w.jsx(ag,{className:"h-4 w-4"}),w.jsx("span",{className:"text-xs",children:H.comments})]})]}),w.jsx("div",{className:"flex items-center gap-2",children:l&&w.jsx(An,{variant:"default",size:"sm",onClick:()=>l(H.id),children:"Join Event"})})]})]})]},H.id))})}),w.jsx(Dl,{value:"discussions",className:"mt-6",children:w.jsx("div",{className:"space-y-4",children:U.filter(H=>H.type==="post").map(H=>w.jsxs(ei,{className:"hover:shadow-md transition-shadow","data-testid":`card-discussion-${H.id}`,children:[w.jsx(Yi,{className:"pb-3",children:w.jsxs("div",{className:"flex items-start gap-3",children:[w.jsxs(fo,{className:"h-10 w-10",children:[w.jsx(Ra,{src:H.authorAvatar}),w.jsx(po,{children:H.author.substring(0,2).toUpperCase()})]}),w.jsxs("div",{className:"flex-1 min-w-0",children:[w.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[w.jsx("span",{className:"font-semibold text-sm",children:H.author}),w.jsx("span",{className:"text-muted-foreground text-xs",children:"•"}),w.jsx("span",{className:"text-muted-foreground text-xs",children:H.community}),w.jsx("span",{className:"text-muted-foreground text-xs",children:"•"}),w.jsx("span",{className:"text-muted-foreground text-xs",children:$(H.timestamp)})]}),w.jsx(wi,{variant:"secondary",className:"text-xs",children:"Discussion"})]})]})}),w.jsxs(fi,{className:"pt-0",children:[w.jsx("p",{className:"mb-4 text-sm leading-relaxed",children:H.content}),w.jsxs("div",{className:"flex items-center justify-between",children:[w.jsxs("div",{className:"flex items-center gap-4",children:[w.jsxs(An,{variant:"ghost",size:"sm",className:"h-8 gap-2",children:[w.jsx(kv,{className:"h-4 w-4"}),w.jsx("span",{className:"text-xs",children:H.likes})]}),w.jsxs(An,{variant:"ghost",size:"sm",className:"h-8 gap-2",children:[w.jsx(ag,{className:"h-4 w-4"}),w.jsx("span",{className:"text-xs",children:H.comments})]})]}),w.jsxs("div",{className:"flex items-center gap-2",children:[H.communityType==="online"&&w.jsxs(An,{variant:"outline",size:"sm",children:[w.jsx(ho,{className:"h-4 w-4 mr-1"}),"Find Nearby"]}),r&&w.jsx(An,{variant:"outline",size:"sm",onClick:()=>r(H.author),children:"Message"})]})]})]})]},H.id))})})]})]})},XB=({isOpen:t,onClose:r,currentUserId:l,currentUserName:d,selectedUserId:_,selectedUserName:x})=>{const[C,s]=B.useState(_||null),[k,z]=B.useState(x||null),[V,U]=B.useState(""),[$,se]=B.useState(""),ae=B.useRef(null),{data:H=[]}=Ia({queryKey:["/api/dm/conversations",l],queryFn:async()=>{const Pe=await fetch(`/api/dm/conversations/${l}`);if(!Pe.ok)throw new Error("Failed to fetch conversations");return Pe.json()},enabled:t,refetchInterval:5e3}),{data:ne=[],isLoading:Y}=Ia({queryKey:["/api/dm/between",l,C],queryFn:async()=>{if(!C)return[];const Pe=await fetch(`/api/dm/between/${l}/${C}`);if(!Pe.ok)throw new Error("Failed to fetch messages");return Pe.json()},enabled:t&&!!C,refetchInterval:2e3}),te=dh({mutationFn:async Pe=>{const Ye=await fetch("/api/dm",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(Pe)});if(!Ye.ok)throw new Error("Failed to send message");return Ye.json()},onSuccess:()=>{Pu.invalidateQueries({queryKey:["/api/dm/between",l,C]}),Pu.invalidateQueries({queryKey:["/api/dm/conversations",l]}),se("")}}),de=Nt.useMemo(()=>{const Pe=new Map;return H.forEach(Ye=>{const vt=Ye.senderId===l?Ye.recipientId:Ye.senderId,It=Ye.senderId===l?Ye.recipientName||"User":Ye.senderName;Pe.has(vt)||Pe.set(vt,{userId:vt,userName:It,lastMessage:Ye.content,lastMessageTime:new Date(Ye.createdAt).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}),unreadCount:Ye.isRead?0:1,isOnline:Math.random()>.5})}),Array.from(Pe.values())},[H,l]),Me=de.filter(Pe=>Pe.userName.toLowerCase().includes(V.toLowerCase()));C&&de.find(Pe=>Pe.userId===C);const Le=()=>{if(!$.trim()||!C||te.isPending)return;const Ye={conversationId:[l,C].sort().join("_"),senderId:l,recipientId:C,senderName:d,recipientName:k,content:$.trim()};te.mutate(Ye)},lt=Pe=>{Pe.key==="Enter"&&!Pe.shiftKey&&(Pe.preventDefault(),Le())};return B.useEffect(()=>{var Pe;(Pe=ae.current)==null||Pe.scrollIntoView({behavior:"smooth"})},[ne]),B.useEffect(()=>{_&&x&&(s(_),z(x))},[_,x]),t?w.jsx("div",{className:"fixed inset-0 bg-black/50 z-50 flex items-center justify-center p-4",children:w.jsxs(ei,{className:"w-full max-w-4xl h-[600px] bg-gray-900 border-gray-700 flex",children:[w.jsxs(Yi,{className:"flex-row items-center justify-between space-y-0 pb-4 border-b border-gray-700",children:[w.jsx(us,{className:"text-white",children:"Messages"}),w.jsx(An,{variant:"ghost",size:"sm",onClick:r,"data-testid":"button-close-dm",children:w.jsx(vh,{className:"h-4 w-4"})})]}),w.jsxs(fi,{className:"flex-1 flex p-0 overflow-hidden",children:[w.jsxs("div",{className:"w-1/3 border-r border-gray-700 flex flex-col",children:[w.jsxs("div",{className:"p-4 border-b border-gray-700",children:[w.jsx("h3",{className:"font-semibold text-white mb-2",children:"Conversations"}),w.jsxs("div",{className:"relative",children:[w.jsx(ex,{className:"h-4 w-4 absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400"}),w.jsx(Mo,{placeholder:"Search conversations...",value:V,onChange:Pe=>U(Pe.target.value),className:"pl-10 bg-gray-800 border-gray-600 text-white","data-testid":"input-search-conversations"})]})]}),w.jsx(up,{className:"flex-1",children:w.jsx("div",{className:"p-2",children:Me.length===0?w.jsxs("div",{className:"text-center py-8","data-testid":"text-no-conversations",children:[w.jsx(ag,{className:"h-8 w-8 text-gray-600 mx-auto mb-2"}),w.jsx("p",{className:"text-sm text-gray-400",children:"No conversations yet"}),w.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Start a conversation by clicking on someone's name in the community chat"})]}):Me.map(Pe=>w.jsx("div",{className:`p-3 rounded-lg cursor-pointer mb-2 transition-colors ${C===Pe.userId?"bg-blue-600 text-white":"bg-gray-800 text-gray-300 hover:bg-gray-700"}`,onClick:()=>{s(Pe.userId),z(Pe.userName)},"data-testid":`conversation-${Pe.userId}`,children:w.jsxs("div",{className:"flex items-center gap-3",children:[w.jsx(fo,{className:"h-8 w-8",children:w.jsx(po,{className:"bg-gray-600 text-white text-xs",children:Pe.userName.charAt(0).toUpperCase()})}),w.jsxs("div",{className:"flex-1 min-w-0",children:[w.jsxs("div",{className:"flex items-center justify-between",children:[w.jsx("p",{className:"text-sm font-medium truncate",children:Pe.userName}),w.jsx("span",{className:"text-xs opacity-75",children:Pe.lastMessageTime})]}),w.jsx("p",{className:"text-xs opacity-75 truncate",children:Pe.lastMessage})]}),Pe.unreadCount>0&&w.jsx("div",{className:"bg-blue-500 text-white text-xs rounded-full h-5 w-5 flex items-center justify-center",children:Pe.unreadCount})]})},Pe.userId))})})]}),w.jsx("div",{className:"flex-1 flex flex-col",children:C?w.jsxs(w.Fragment,{children:[w.jsx("div",{className:"p-4 border-b border-gray-700 bg-gray-800",children:w.jsxs("div",{className:"flex items-center gap-3",children:[w.jsx(fo,{className:"h-8 w-8",children:w.jsx(po,{className:"bg-gray-600 text-white text-sm",children:k==null?void 0:k.charAt(0).toUpperCase()})}),w.jsx("h3",{className:"font-semibold text-white",children:k})]})}),w.jsx(up,{className:"flex-1 p-4",children:w.jsxs("div",{className:"space-y-4",children:[Y?w.jsxs("div",{className:"text-center py-12","data-testid":"text-loading-messages",children:[w.jsx("div",{className:"animate-spin rounded-full h-6 w-6 border-b-2 border-blue-500 mx-auto mb-2"}),w.jsx("p",{className:"text-gray-400 text-sm",children:"Loading messages..."})]}):ne.length===0?w.jsxs("div",{className:"text-center py-12","data-testid":"text-no-messages",children:[w.jsx("p",{className:"text-gray-400 text-sm",children:"No messages yet"}),w.jsx("p",{className:"text-gray-500 text-xs mt-1",children:"Send the first message!"})]}):ne.map(Pe=>w.jsx("div",{className:`flex ${Pe.senderId===l?"justify-end":"justify-start"}`,"data-testid":`message-${Pe.id}`,children:w.jsxs("div",{className:`max-w-xs lg:max-w-md px-4 py-2 rounded-lg ${Pe.senderId===l?"bg-blue-600 text-white":"bg-gray-700 text-gray-100"}`,children:[w.jsx("p",{className:"text-sm",children:Pe.content}),w.jsx("p",{className:"text-xs opacity-75 mt-1",children:new Date(Pe.createdAt).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})})]})},Pe.id)),w.jsx("div",{ref:ae})]})}),w.jsx("div",{className:"p-4 border-t border-gray-700",children:w.jsxs("div",{className:"flex gap-2",children:[w.jsx(Mo,{value:$,onChange:Pe=>se(Pe.target.value),onKeyDown:lt,placeholder:`Message ${k}...`,className:"flex-1 bg-gray-800 border-gray-600 text-white","data-testid":"input-dm-message"}),w.jsx(An,{onClick:Le,disabled:!$.trim()||te.isPending,"data-testid":"button-send-dm",children:w.jsx(i2,{className:"h-4 w-4"})})]})})]}):w.jsx("div",{className:"flex-1 flex items-center justify-center","data-testid":"text-select-conversation",children:w.jsxs("div",{className:"text-center",children:[w.jsx(ag,{className:"h-12 w-12 text-gray-600 mx-auto mb-4"}),w.jsx("h3",{className:"text-lg font-semibold text-gray-400 mb-2",children:"Select a conversation"}),w.jsx("p",{className:"text-gray-500",children:"Choose a conversation from the left to start messaging"})]})})})]})]})}):null};function Hee(){var lt;const{user:t}=u_(),[r,l]=B.useState(""),[d,_]=B.useState(!1),[x,C]=B.useState("feed"),[s,k]=B.useState(null),[z,V]=B.useState(!1),[U,$]=B.useState(null),[se,ae]=B.useState(null),{data:H=[],isLoading:ne}=Ia({queryKey:["/api/communities"]}),Y=H.filter(Pe=>Pe.name.toLowerCase().includes(r.toLowerCase())||Pe.description.toLowerCase().includes(r.toLowerCase())),te=(Pe,Ye)=>{$(Pe),ae(Ye||null),V(!0)},de=Pe=>{console.log("Joining event:",Pe)},Me=Pe=>{k(Pe),C("chat")},Le=()=>{k(null),C("feed")};return ne?w.jsx("div",{className:"min-h-screen bg-black text-white p-6",children:w.jsx("div",{className:"max-w-4xl mx-auto",children:w.jsxs("div",{className:"text-center py-12",children:[w.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-500 mx-auto"}),w.jsx("p",{className:"mt-4 text-gray-400",children:"Loading communities..."})]})})}):w.jsxs("div",{className:"min-h-screen bg-black text-white",children:[w.jsx("div",{className:"border-b border-gray-800 p-6",children:w.jsxs("div",{className:"max-w-4xl mx-auto",children:[w.jsxs("div",{className:"flex items-center justify-between mb-6",children:[w.jsxs("div",{className:"flex items-center gap-4",children:[w.jsx(Db,{to:"/","data-testid":"link-home",children:w.jsxs(An,{variant:"ghost",size:"sm",className:"text-gray-400 hover:text-white",children:[w.jsx(r2,{className:"h-4 w-4 mr-2"}),"Back to Map"]})}),w.jsxs("div",{children:[w.jsxs("h1",{className:"text-2xl font-bold flex items-center gap-2","data-testid":"text-page-title",children:[w.jsx(ho,{className:"h-6 w-6"}),"Communities"]}),w.jsx("p",{className:"text-gray-400","data-testid":"text-page-description",children:"Connect with local groups and global conversations"})]})]}),w.jsxs("div",{className:"flex items-center gap-3",children:[w.jsxs(An,{variant:"outline",onClick:()=>V(!0),"data-testid":"button-open-messages",children:[w.jsx(Pc,{className:"h-4 w-4 mr-2"}),"Messages"]}),t&&w.jsx(Db,{to:"/create-community","data-testid":"link-create-community",children:w.jsxs(An,{className:"bg-blue-600 hover:bg-blue-700",children:[w.jsx(Ug,{className:"h-4 w-4 mr-2"}),"Create Community"]})})]})]}),w.jsxs("div",{className:"flex items-center gap-4 mb-6",children:[w.jsxs("div",{className:"relative flex-1",children:[w.jsx(ex,{className:"h-4 w-4 absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400"}),w.jsx(Mo,{placeholder:"Search communities...",value:r,onChange:Pe=>l(Pe.target.value),className:"pl-10 bg-gray-800 border-gray-700 text-white","data-testid":"input-search-communities"})]}),w.jsxs("div",{className:"flex items-center gap-2",children:[w.jsx("span",{className:"text-sm text-gray-400",children:"Global"}),w.jsx(ZB,{pressed:d,onPressedChange:_,"aria-label":"Toggle local mode",className:"data-[state=on]:bg-blue-600","data-testid":"toggle-local-mode",children:d?w.jsx(np,{className:"h-4 w-4"}):w.jsx(tp,{className:"h-4 w-4"})}),w.jsx("span",{className:"text-sm text-gray-400",children:"Local"})]})]}),d&&w.jsx("div",{className:"mb-4 p-3 bg-blue-900/20 border border-blue-800 rounded-lg","data-testid":"text-local-mode-info",children:w.jsxs("p",{className:"text-blue-400 text-sm",children:[w.jsx(ro,{className:"h-4 w-4 inline mr-1"}),"Local mode: Showing communities and discussions from people in your geographic area"]})})]})}),w.jsx("div",{className:"max-w-4xl mx-auto p-6",children:w.jsxs(rP,{value:x,onValueChange:C,className:"w-full",children:[w.jsxs(C2,{className:"grid w-full grid-cols-4 bg-gray-800",children:[w.jsx(kl,{value:"feed","data-testid":"tab-feed",children:"Feed"}),w.jsx(kl,{value:"chat","data-testid":"tab-chat",children:"Chat"}),w.jsx(kl,{value:"communities","data-testid":"tab-all-communities",children:"All Communities"}),w.jsx(kl,{value:"joined","data-testid":"tab-joined-communities",children:"Joined"})]}),w.jsx(Dl,{value:"feed",className:"mt-6",children:w.jsx(Gee,{posts:[],onOpenDM:te,onJoinEvent:de})}),w.jsx(Dl,{value:"chat",className:"mt-6",children:s?w.jsx("div",{className:"h-[700px]",children:w.jsx(BI,{communityId:s,communityName:((lt=H.find(Pe=>Pe.id===s))==null?void 0:lt.name)||"Community Chat",currentUserId:"current_user_123",currentUserName:"You",onOpenDM:te,onClose:Le})}):w.jsxs("div",{className:"space-y-4",children:[w.jsxs("div",{className:"text-center py-12","data-testid":"text-select-community",children:[w.jsx(Pc,{className:"h-12 w-12 text-gray-600 mx-auto mb-4"}),w.jsx("h3",{className:"text-lg font-semibold text-gray-400 mb-2",children:"Select a Community to Chat"}),w.jsx("p",{className:"text-gray-500 mb-6",children:"Choose a community below to start chatting with members in different regions"})]}),w.jsx("div",{className:"grid gap-4",children:Y.slice(0,6).map(Pe=>w.jsx(ei,{className:"bg-gray-800 border-gray-700 hover:bg-gray-750 transition-colors cursor-pointer",onClick:()=>Me(Pe.id),"data-testid":`card-community-chat-${Pe.id}`,children:w.jsx(fi,{className:"p-4",children:w.jsxs("div",{className:"flex items-center justify-between",children:[w.jsxs("div",{className:"flex items-start gap-3",children:[w.jsx(fo,{className:"h-12 w-12",children:w.jsx(po,{className:"bg-blue-600 text-white",children:Pe.name.substring(0,2).toUpperCase()})}),w.jsxs("div",{className:"flex-1 min-w-0",children:[w.jsx("h3",{className:"font-semibold text-white mb-1","data-testid":`text-community-name-${Pe.id}`,children:Pe.name}),w.jsx("p",{className:"text-sm text-gray-400 mb-2 line-clamp-2","data-testid":`text-community-description-${Pe.id}`,children:Pe.description}),w.jsxs("div",{className:"flex items-center gap-4 text-xs text-gray-500",children:[w.jsxs("span",{className:"flex items-center gap-1",children:[w.jsx(ho,{className:"h-3 w-3"}),Pe.memberCount.toLocaleString()," members"]}),w.jsx(wi,{variant:"outline",className:"text-xs",children:Pe.category})]})]})]}),w.jsxs(An,{variant:"outline",size:"sm","data-testid":`button-join-chat-${Pe.id}`,children:[w.jsx(Pc,{className:"h-4 w-4 mr-2"}),"Join Chat"]})]})})},Pe.id))})]})}),w.jsx(Dl,{value:"communities",className:"mt-6",children:Y.length===0?w.jsxs("div",{className:"text-center py-12","data-testid":"text-no-communities",children:[w.jsx(ho,{className:"h-12 w-12 text-gray-600 mx-auto mb-4"}),w.jsx("h3",{className:"text-lg font-semibold text-gray-400 mb-2",children:"No communities found"}),w.jsx("p",{className:"text-gray-500 mb-4",children:r?"Try adjusting your search terms":"Be the first to create a community!"}),t&&!r&&w.jsx(Db,{to:"/create-community","data-testid":"link-create-first-community",children:w.jsxs(An,{className:"bg-blue-600 hover:bg-blue-700",children:[w.jsx(Ug,{className:"h-4 w-4 mr-2"}),"Create Community"]})})]}):w.jsx("div",{className:"grid gap-4",children:Y.map(Pe=>w.jsxs(ei,{className:"bg-gray-800 border-gray-700 hover:bg-gray-750 transition-colors","data-testid":`card-community-${Pe.id}`,children:[w.jsx(Yi,{children:w.jsxs("div",{className:"flex items-start justify-between",children:[w.jsxs("div",{className:"flex items-center gap-3",children:[w.jsxs(fo,{className:"h-12 w-12",children:[w.jsx(Ra,{src:"/api/placeholder/48/48"}),w.jsx(po,{className:"bg-blue-600 text-white",children:Pe.name.substring(0,2).toUpperCase()})]}),w.jsxs("div",{children:[w.jsx(us,{className:"text-white","data-testid":`text-community-name-${Pe.id}`,children:Pe.name}),w.jsx(Fl,{className:"text-gray-400","data-testid":`text-community-category-${Pe.id}`,children:Pe.category})]})]}),w.jsx("div",{className:"flex items-center gap-2",children:w.jsx(wi,{variant:"secondary",className:"bg-green-900 text-green-400","data-testid":`badge-public-${Pe.id}`,children:"Public"})})]})}),w.jsxs(fi,{children:[w.jsx("p",{className:"text-gray-300 mb-4","data-testid":`text-community-description-${Pe.id}`,children:Pe.description}),w.jsx("div",{className:"flex flex-wrap gap-2 mb-4",children:w.jsx(wi,{variant:"outline",className:"text-gray-400 border-gray-600","data-testid":`tag-neighborhood-${Pe.id}`,children:Pe.category})}),w.jsxs("div",{className:"flex items-center justify-between",children:[w.jsxs("div",{className:"flex items-center gap-4 text-sm text-gray-400",children:[w.jsxs("span",{"data-testid":`text-member-count-${Pe.id}`,children:[w.jsx(ho,{className:"h-4 w-4 inline mr-1"}),Math.floor(Math.random()*1e3)+50," members"]}),w.jsxs("span",{"data-testid":`text-created-date-${Pe.id}`,children:["Created ",new Date(Pe.createdAt).toLocaleDateString()]})]}),w.jsx(An,{variant:"outline",className:"border-gray-600 text-gray-300 hover:bg-gray-700","data-testid":`button-join-${Pe.id}`,children:"Join Community"})]})]})]},Pe.id))})}),w.jsx(Dl,{value:"joined",className:"mt-6",children:w.jsxs("div",{className:"text-center py-12","data-testid":"text-joined-placeholder",children:[w.jsx(ho,{className:"h-12 w-12 text-gray-600 mx-auto mb-4"}),w.jsx("h3",{className:"text-lg font-semibold text-gray-400 mb-2",children:"Your Communities"}),w.jsx("p",{className:"text-gray-500",children:"Communities you've joined will appear here"})]})})]})}),w.jsx(XB,{isOpen:z,onClose:()=>{V(!1),$(null),ae(null)},currentUserId:(t==null?void 0:t.id)||"guest",currentUserName:(t==null?void 0:t.name)||"Guest",selectedUserId:U||void 0,selectedUserName:se||void 0})]})}function qee(){const{toast:t}=yp(),[r,l]=B.useState(null),[d,_]=B.useState(""),[x,C]=B.useState(!1);B.useEffect(()=>{if(QF())C(!0);else{const U=eN();C(U)}},[]);const{data:s=[],isLoading:k}=Ia({queryKey:["/api/stories/pending"],refetchInterval:3e4,enabled:x}),z=dh({mutationFn:async({storyId:U,moderationData:$})=>op(`/api/stories/${U}/moderate`,{method:"POST",body:JSON.stringify($),headers:JF()}),onSuccess:()=>{Pu.invalidateQueries({queryKey:["/api/stories/pending"]}),l(null),_(""),t({title:"Story moderated successfully",description:"The story has been processed."})},onError:U=>{t({title:"Moderation failed",description:"Failed to moderate the story. Please try again.",variant:"destructive"})}}),V=U=>{if(!r||!x)return;const $={action:U,notes:d||void 0,moderatorId:"admin"};z.mutate({storyId:r.id,moderationData:$})};return x?k?w.jsx("div",{className:"container mx-auto p-6","data-testid":"loading-moderation",children:w.jsx("div",{className:"flex items-center justify-center h-64",children:w.jsxs("div",{className:"text-center",children:[w.jsx(Mb,{className:"h-8 w-8 animate-spin mx-auto mb-2"}),w.jsx("p",{children:"Loading pending stories..."})]})})}):w.jsxs("div",{className:"container mx-auto p-6","data-testid":"moderation-dashboard",children:[w.jsxs("div",{className:"mb-6",children:[w.jsx("h1",{className:"text-3xl font-bold mb-2",children:"Content Moderation"}),w.jsx("p",{className:"text-muted-foreground",children:"Review and moderate user-submitted stories for inappropriate content"})]}),w.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[w.jsx("div",{className:"lg:col-span-1",children:w.jsxs(ei,{children:[w.jsx(Yi,{children:w.jsxs(us,{className:"flex items-center gap-2",children:[w.jsx(Mb,{className:"h-5 w-5"}),"Pending Stories (",s.length,")"]})}),w.jsx(fi,{className:"p-0",children:s.length===0?w.jsxs("div",{className:"p-6 text-center text-muted-foreground","data-testid":"no-pending-stories",children:[w.jsx(ep,{className:"h-8 w-8 mx-auto mb-2 opacity-50"}),w.jsx("p",{children:"No pending stories to review"})]}):w.jsx("div",{className:"max-h-96 overflow-y-auto",children:s.map(U=>w.jsx("div",{className:`p-4 border-b cursor-pointer hover:bg-muted/50 transition-colors ${(r==null?void 0:r.id)===U.id?"bg-muted":""}`,onClick:()=>l(U),"data-testid":`story-item-${U.id}`,children:w.jsxs("div",{className:"space-y-2",children:[w.jsx("h3",{className:"font-medium line-clamp-2",children:U.title}),w.jsx("p",{className:"text-sm text-muted-foreground line-clamp-2",children:U.excerpt||U.content}),w.jsxs("div",{className:"flex items-center gap-2 text-xs text-muted-foreground",children:[w.jsx(np,{className:"h-3 w-3"}),U.author,w.jsx(ro,{className:"h-3 w-3 ml-2"}),U.location.name]}),w.jsxs("div",{className:"flex items-center gap-2",children:[w.jsx(wi,{variant:U.isLocationVerified?"default":"secondary",children:U.isLocationVerified?"Verified":"Unverified"}),U.images.length>0&&w.jsxs(wi,{variant:"outline",children:[U.images.length," image(s)"]})]}),w.jsxs("p",{className:"text-xs text-muted-foreground",children:["Submitted: ",new Date(U.submittedAt).toLocaleDateString()]})]})},U.id))})})]})}),w.jsx("div",{className:"lg:col-span-2",children:r?w.jsxs(ei,{"data-testid":"story-review-panel",children:[w.jsxs(Yi,{children:[w.jsx(us,{children:r.title}),w.jsxs("div",{className:"flex items-center gap-4 text-sm text-muted-foreground",children:[w.jsxs("span",{className:"flex items-center gap-1",children:[w.jsx(np,{className:"h-4 w-4"}),r.author]}),w.jsxs("span",{className:"flex items-center gap-1",children:[w.jsx(ro,{className:"h-4 w-4"}),r.location.name]}),w.jsx(wi,{variant:r.isLocationVerified?"default":"secondary",children:r.isLocationVerified?"Location Verified":"Location Unverified"})]})]}),w.jsxs(fi,{className:"space-y-6",children:[w.jsxs("div",{className:"space-y-4",children:[w.jsxs("div",{children:[w.jsx("h4",{className:"font-medium mb-2",children:"Content"}),w.jsx("div",{className:"p-4 bg-muted rounded-lg",children:w.jsx("p",{className:"whitespace-pre-wrap",children:r.content})})]}),r.images.length>0&&w.jsxs("div",{children:[w.jsxs("h4",{className:"font-medium mb-2",children:["Images (",r.images.length,")"]}),w.jsx("div",{className:"grid grid-cols-2 gap-4",children:r.images.map((U,$)=>w.jsx("div",{className:"rounded-lg overflow-hidden border",children:w.jsx("img",{src:U,alt:`Story image ${$+1}`,className:"w-full h-32 object-cover","data-testid":`story-image-${$}`})},$))})]}),w.jsxs("div",{children:[w.jsx("h4",{className:"font-medium mb-2",children:"Location Details"}),w.jsxs("div",{className:"p-4 bg-muted rounded-lg space-y-2",children:[w.jsxs("p",{children:[w.jsx("strong",{children:"Name:"})," ",r.location.name]}),w.jsxs("p",{children:[w.jsx("strong",{children:"Coordinates:"})," ",r.location.lat,", ",r.location.lng]}),w.jsxs("p",{children:[w.jsx("strong",{children:"Crisis ID:"})," ",r.location.crisisId]}),w.jsxs("p",{children:[w.jsx("strong",{children:"Verified:"})," ",r.isLocationVerified?"Yes":"No"]})]})]})]}),w.jsxs("div",{children:[w.jsx("h4",{className:"font-medium mb-2",children:"Moderation Notes (Optional)"}),w.jsx(dp,{placeholder:"Add notes about your moderation decision...",value:d,onChange:U=>_(U.target.value),className:"min-h-20","data-testid":"moderation-notes"})]}),w.jsxs("div",{className:"flex gap-3 pt-4 border-t",children:[w.jsxs(An,{onClick:()=>V("approve"),disabled:z.isPending,className:"flex-1","data-testid":"button-approve",children:[w.jsx(ep,{className:"h-4 w-4 mr-2"}),"Approve"]}),w.jsxs(An,{onClick:()=>V("flag"),disabled:z.isPending,variant:"outline",className:"flex-1","data-testid":"button-flag",children:[w.jsx(pI,{className:"h-4 w-4 mr-2"}),"Flag for Review"]}),w.jsxs(An,{onClick:()=>V("reject"),disabled:z.isPending,variant:"destructive",className:"flex-1","data-testid":"button-reject",children:[w.jsx(Qv,{className:"h-4 w-4 mr-2"}),"Reject"]})]})]})]}):w.jsx(ei,{"data-testid":"no-story-selected",children:w.jsx(fi,{className:"flex items-center justify-center h-96",children:w.jsxs("div",{className:"text-center text-muted-foreground",children:[w.jsx(Mb,{className:"h-12 w-12 mx-auto mb-4 opacity-50"}),w.jsx("h3",{className:"text-lg font-medium mb-2",children:"Select a Story to Review"}),w.jsx("p",{children:"Choose a pending story from the list to begin moderation"})]})})})})]})]}):w.jsx("div",{className:"container mx-auto p-6","data-testid":"auth-required",children:w.jsx("div",{className:"flex items-center justify-center h-64",children:w.jsxs("div",{className:"text-center",children:[w.jsx(Qv,{className:"h-8 w-8 mx-auto mb-2 text-destructive"}),w.jsx("p",{children:"Authentication required for moderation access"}),w.jsx(An,{onClick:()=>{const U=eN();C(U)},className:"mt-4",children:"Try Again"})]})})})}var YB={exports:{}},Wee="SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED",Zee=Wee,Xee=Zee;function KB(){}function QB(){}QB.resetWarningCache=KB;var Yee=function(){function t(d,_,x,C,s,k){if(k!==Xee){var z=new Error("Calling PropTypes validators directly is not supported by the `prop-types` package. Use PropTypes.checkPropTypes() to call them. Read more at http://fb.me/use-check-prop-types");throw z.name="Invariant Violation",z}}t.isRequired=t;function r(){return t}var l={array:t,bigint:t,bool:t,func:t,number:t,object:t,string:t,symbol:t,any:t,arrayOf:r,element:t,elementType:t,instanceOf:r,node:t,objectOf:r,oneOf:r,oneOfType:r,shape:r,exact:r,checkPropTypes:QB,resetWarningCache:KB};return l.PropTypes=l,l};YB.exports=Yee();var Kee=YB.exports;const ns=zw(Kee);function IN(t,r){var l=Object.keys(t);if(Object.getOwnPropertySymbols){var d=Object.getOwnPropertySymbols(t);r&&(d=d.filter(function(_){return Object.getOwnPropertyDescriptor(t,_).enumerable})),l.push.apply(l,d)}return l}function PN(t){for(var r=1;r<arguments.length;r++){var l=arguments[r]!=null?arguments[r]:{};r%2?IN(Object(l),!0).forEach(function(d){JB(t,d,l[d])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(l)):IN(Object(l)).forEach(function(d){Object.defineProperty(t,d,Object.getOwnPropertyDescriptor(l,d))})}return t}function Fb(t){"@babel/helpers - typeof";return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?Fb=function(r){return typeof r}:Fb=function(r){return r&&typeof Symbol=="function"&&r.constructor===Symbol&&r!==Symbol.prototype?"symbol":typeof r},Fb(t)}function JB(t,r,l){return r in t?Object.defineProperty(t,r,{value:l,enumerable:!0,configurable:!0,writable:!0}):t[r]=l,t}function Qee(t,r){if(t==null)return{};var l={},d=Object.keys(t),_,x;for(x=0;x<d.length;x++)_=d[x],!(r.indexOf(_)>=0)&&(l[_]=t[_]);return l}function Jee(t,r){if(t==null)return{};var l=Qee(t,r),d,_;if(Object.getOwnPropertySymbols){var x=Object.getOwnPropertySymbols(t);for(_=0;_<x.length;_++)d=x[_],!(r.indexOf(d)>=0)&&Object.prototype.propertyIsEnumerable.call(t,d)&&(l[d]=t[d])}return l}function eV(t,r){return ete(t)||tte(t,r)||nte(t,r)||rte()}function ete(t){if(Array.isArray(t))return t}function tte(t,r){var l=t&&(typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"]);if(l!=null){var d=[],_=!0,x=!1,C,s;try{for(l=l.call(t);!(_=(C=l.next()).done)&&(d.push(C.value),!(r&&d.length===r));_=!0);}catch(k){x=!0,s=k}finally{try{!_&&l.return!=null&&l.return()}finally{if(x)throw s}}return d}}function nte(t,r){if(t){if(typeof t=="string")return MN(t,r);var l=Object.prototype.toString.call(t).slice(8,-1);if(l==="Object"&&t.constructor&&(l=t.constructor.name),l==="Map"||l==="Set")return Array.from(t);if(l==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(l))return MN(t,r)}}function MN(t,r){(r==null||r>t.length)&&(r=t.length);for(var l=0,d=new Array(r);l<r;l++)d[l]=t[l];return d}function rte(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var Bo=function(r,l,d){var _=!!d,x=Nt.useRef(d);Nt.useEffect(function(){x.current=d},[d]),Nt.useEffect(function(){if(!_||!r)return function(){};var C=function(){x.current&&x.current.apply(x,arguments)};return r.on(l,C),function(){r.off(l,C)}},[_,l,r,x])},dA=function(r){var l=Nt.useRef(r);return Nt.useEffect(function(){l.current=r},[r]),l.current},Qg=function(r){return r!==null&&Fb(r)==="object"},ite=function(r){return Qg(r)&&typeof r.then=="function"},ste=function(r){return Qg(r)&&typeof r.elements=="function"&&typeof r.createToken=="function"&&typeof r.createPaymentMethod=="function"&&typeof r.confirmCardPayment=="function"},RN="[object Object]",ote=function t(r,l){if(!Qg(r)||!Qg(l))return r===l;var d=Array.isArray(r),_=Array.isArray(l);if(d!==_)return!1;var x=Object.prototype.toString.call(r)===RN,C=Object.prototype.toString.call(l)===RN;if(x!==C)return!1;if(!x&&!d)return r===l;var s=Object.keys(r),k=Object.keys(l);if(s.length!==k.length)return!1;for(var z={},V=0;V<s.length;V+=1)z[s[V]]=!0;for(var U=0;U<k.length;U+=1)z[k[U]]=!0;var $=Object.keys(z);if($.length!==s.length)return!1;var se=r,ae=l,H=function(Y){return t(se[Y],ae[Y])};return $.every(H)},tV=function(r,l,d){return Qg(r)?Object.keys(r).reduce(function(_,x){var C=!Qg(l)||!ote(r[x],l[x]);return d.includes(x)?(C&&console.warn("Unsupported prop change: options.".concat(x," is not a mutable property.")),_):C?PN(PN({},_||{}),{},JB({},x,r[x])):_},null):null},nV="Invalid prop `stripe` supplied to `Elements`. We recommend using the `loadStripe` utility from `@stripe/stripe-js`. See https://stripe.com/docs/stripe-js/react#elements-props-stripe for details.",kN=function(r){var l=arguments.length>1&&arguments[1]!==void 0?arguments[1]:nV;if(r===null||ste(r))return r;throw new Error(l)},ate=function(r){var l=arguments.length>1&&arguments[1]!==void 0?arguments[1]:nV;if(ite(r))return{tag:"async",stripePromise:Promise.resolve(r).then(function(_){return kN(_,l)})};var d=kN(r,l);return d===null?{tag:"empty"}:{tag:"sync",stripe:d}},lte=function(r){!r||!r._registerWrapper||!r.registerAppInfo||(r._registerWrapper({name:"react-stripe-js",version:"4.0.2"}),r.registerAppInfo({name:"react-stripe-js",version:"4.0.2",url:"https://stripe.com/docs/stripe-js/react"}))},M2=Nt.createContext(null);M2.displayName="ElementsContext";var rV=function(r,l){if(!r)throw new Error("Could not find Elements context; You need to wrap the part of your app that ".concat(l," in an <Elements> provider."));return r},iV=function(r){var l=r.stripe,d=r.options,_=r.children,x=Nt.useMemo(function(){return ate(l)},[l]),C=Nt.useState(function(){return{stripe:x.tag==="sync"?x.stripe:null,elements:x.tag==="sync"?x.stripe.elements(d):null}}),s=eV(C,2),k=s[0],z=s[1];Nt.useEffect(function(){var $=!0,se=function(H){z(function(ne){return ne.stripe?ne:{stripe:H,elements:H.elements(d)}})};return x.tag==="async"&&!k.stripe?x.stripePromise.then(function(ae){ae&&$&&se(ae)}):x.tag==="sync"&&!k.stripe&&se(x.stripe),function(){$=!1}},[x,k,d]);var V=dA(l);Nt.useEffect(function(){V!==null&&V!==l&&console.warn("Unsupported prop change on Elements: You cannot change the `stripe` prop after setting it.")},[V,l]);var U=dA(d);return Nt.useEffect(function(){if(k.elements){var $=tV(d,U,["clientSecret","fonts"]);$&&k.elements.update($)}},[d,U,k.elements]),Nt.useEffect(function(){lte(k.stripe)},[k.stripe]),Nt.createElement(M2.Provider,{value:k},_)};iV.propTypes={stripe:ns.any,options:ns.object};var cte=function(r){var l=Nt.useContext(M2);return rV(l,r)},ute=function(){var r=cte("calls useElements()"),l=r.elements;return l};ns.func.isRequired;var sV=Nt.createContext(null);sV.displayName="CheckoutContext";ns.any,ns.shape({fetchClientSecret:ns.func.isRequired,elementsOptions:ns.object}).isRequired;var hA=function(r){var l=Nt.useContext(sV),d=Nt.useContext(M2);if(l){if(d)throw new Error("You cannot wrap the part of your app that ".concat(r," in both <CheckoutProvider> and <Elements> providers."));return l}else return rV(d,r)},dte=["mode"],hte=function(r){return r.charAt(0).toUpperCase()+r.slice(1)},Ds=function(r,l){var d="".concat(hte(r),"Element"),_=function(k){var z=k.id,V=k.className,U=k.options,$=U===void 0?{}:U,se=k.onBlur,ae=k.onFocus,H=k.onReady,ne=k.onChange,Y=k.onEscape,te=k.onClick,de=k.onLoadError,Me=k.onLoaderStart,Le=k.onNetworksChange,lt=k.onConfirm,Pe=k.onCancel,Ye=k.onShippingAddressChange,vt=k.onShippingRateChange,It=k.onSavedPaymentMethodRemove,Ut=k.onSavedPaymentMethodUpdate,Pt=hA("mounts <".concat(d,">")),$t="elements"in Pt?Pt.elements:null,Ve="checkoutState"in Pt?Pt.checkoutState:null,jt=(Ve==null?void 0:Ve.type)==="success"?Ve.checkout:null,Je=Nt.useState(null),mt=eV(Je,2),Be=mt[0],ft=mt[1],Ct=Nt.useRef(null),Zt=Nt.useRef(null);Bo(Be,"blur",se),Bo(Be,"focus",ae),Bo(Be,"escape",Y),Bo(Be,"click",te),Bo(Be,"loaderror",de),Bo(Be,"loaderstart",Me),Bo(Be,"networkschange",Le),Bo(Be,"confirm",lt),Bo(Be,"cancel",Pe),Bo(Be,"shippingaddresschange",Ye),Bo(Be,"shippingratechange",vt),Bo(Be,"savedpaymentmethodremove",It),Bo(Be,"savedpaymentmethodupdate",Ut),Bo(Be,"change",ne);var fn;H&&(r==="expressCheckout"?fn=H:fn=function(){H(Be)}),Bo(Be,"ready",fn),Nt.useLayoutEffect(function(){if(Ct.current===null&&Zt.current!==null&&($t||jt)){var $n=null;if(jt)switch(r){case"payment":$n=jt.createPaymentElement($);break;case"address":if("mode"in $){var Hn=$.mode,rn=Jee($,dte);if(Hn==="shipping")$n=jt.createShippingAddressElement(rn);else if(Hn==="billing")$n=jt.createBillingAddressElement(rn);else throw new Error("Invalid options.mode. mode must be 'billing' or 'shipping'.")}else throw new Error("You must supply options.mode. mode must be 'billing' or 'shipping'.");break;case"expressCheckout":$n=jt.createExpressCheckoutElement($);break;case"currencySelector":$n=jt.createCurrencySelectorElement();break;case"taxId":$n=jt.createTaxIdElement($);break;default:throw new Error("Invalid Element type ".concat(d,". You must use either the <PaymentElement />, <AddressElement options={{mode: 'shipping'}} />, <AddressElement options={{mode: 'billing'}} />, or <ExpressCheckoutElement />."))}else $t&&($n=$t.create(r,$));Ct.current=$n,ft($n),$n&&$n.mount(Zt.current)}},[$t,jt,$]);var Qn=dA($);return Nt.useEffect(function(){if(Ct.current){var $n=tV($,Qn,["paymentRequest"]);$n&&"update"in Ct.current&&Ct.current.update($n)}},[$,Qn]),Nt.useLayoutEffect(function(){return function(){if(Ct.current&&typeof Ct.current.destroy=="function")try{Ct.current.destroy(),Ct.current=null}catch{}}},[]),Nt.createElement("div",{id:z,className:V,ref:Zt})},x=function(k){hA("mounts <".concat(d,">"));var z=k.id,V=k.className;return Nt.createElement("div",{id:z,className:V})},C=l?x:_;return C.propTypes={id:ns.string,className:ns.string,onChange:ns.func,onBlur:ns.func,onFocus:ns.func,onReady:ns.func,onEscape:ns.func,onClick:ns.func,onLoadError:ns.func,onLoaderStart:ns.func,onNetworksChange:ns.func,onConfirm:ns.func,onCancel:ns.func,onShippingAddressChange:ns.func,onShippingRateChange:ns.func,onSavedPaymentMethodRemove:ns.func,onSavedPaymentMethodUpdate:ns.func,options:ns.object},C.displayName=d,C.__elementType=r,C},Ls=typeof window>"u",fte=Nt.createContext(null);fte.displayName="EmbeddedCheckoutProviderContext";var pte=function(){var r=hA("calls useStripe()"),l=r.stripe;return l};Ds("auBankAccount",Ls);Ds("card",Ls);Ds("cardNumber",Ls);Ds("cardExpiry",Ls);Ds("cardCvc",Ls);Ds("fpxBank",Ls);Ds("iban",Ls);Ds("idealBank",Ls);Ds("p24Bank",Ls);Ds("epsBank",Ls);var mte=Ds("payment",Ls);Ds("expressCheckout",Ls);Ds("paymentRequestButton",Ls);Ds("linkAuthentication",Ls);Ds("address",Ls);Ds("shippingAddress",Ls);Ds("paymentMethodMessaging",Ls);Ds("affirmMessage",Ls);Ds("afterpayClearpayMessage",Ls);Ds("taxId",Ls);var oV="basil",gte=function(r){return r===3?"v3":r},aV="https://js.stripe.com",_te="".concat(aV,"/").concat(oV,"/stripe.js"),yte=/^https:\/\/js\.stripe\.com\/v3\/?(\?.*)?$/,vte=/^https:\/\/js\.stripe\.com\/(v3|[a-z]+)\/stripe\.js(\?.*)?$/,DN="loadStripe.setLoadParameters was called but an existing Stripe.js script already exists in the document; existing script parameters will be used",xte=function(r){return yte.test(r)||vte.test(r)},bte=function(){for(var r=document.querySelectorAll('script[src^="'.concat(aV,'"]')),l=0;l<r.length;l++){var d=r[l];if(xte(d.src))return d}return null},LN=function(r){var l="",d=document.createElement("script");d.src="".concat(_te).concat(l);var _=document.head||document.body;if(!_)throw new Error("Expected document.body not to be null. Stripe.js requires a <body> element.");return _.appendChild(d),d},wte=function(r,l){!r||!r._registerWrapper||r._registerWrapper({name:"stripe-js",version:"7.9.0",startTime:l})},dv=null,pb=null,mb=null,Ste=function(r){return function(l){r(new Error("Failed to load Stripe.js",{cause:l}))}},Tte=function(r,l){return function(){window.Stripe?r(window.Stripe):l(new Error("Stripe.js not available"))}},Ete=function(r){return dv!==null?dv:(dv=new Promise(function(l,d){if(typeof window>"u"||typeof document>"u"){l(null);return}if(window.Stripe&&r&&console.warn(DN),window.Stripe){l(window.Stripe);return}try{var _=bte();if(_&&r)console.warn(DN);else if(!_)_=LN(r);else if(_&&mb!==null&&pb!==null){var x;_.removeEventListener("load",mb),_.removeEventListener("error",pb),(x=_.parentNode)===null||x===void 0||x.removeChild(_),_=LN(r)}mb=Tte(l,d),pb=Ste(d),_.addEventListener("load",mb),_.addEventListener("error",pb)}catch(C){d(C);return}}),dv.catch(function(l){return dv=null,Promise.reject(l)}))},Cte=function(r,l,d){if(r===null)return null;var _=l[0],x=_.match(/^pk_test/),C=gte(r.version),s=oV;x&&C!==s&&console.warn("Stripe.js@".concat(C," was loaded on the page, but @stripe/stripe-js@").concat("7.9.0"," expected Stripe.js@").concat(s,". This may result in unexpected behavior. For more information, see https://docs.stripe.com/sdks/stripejs-versioning"));var k=r.apply(void 0,l);return wte(k,d),k},hv,lV=!1,cV=function(){return hv||(hv=Ete(null).catch(function(r){return hv=null,Promise.reject(r)}),hv)};Promise.resolve().then(function(){return cV()}).catch(function(t){lV||console.warn(t)});var Ate=function(){for(var r=arguments.length,l=new Array(r),d=0;d<r;d++)l[d]=arguments[d];lV=!0;var _=Date.now();return cV().then(function(x){return Cte(x,l,_)})};const Ite=Ate("pk_test_51Raiq2QH4pVSQwXEiXN9lEyPZCQqm7Ui6PnqyBIO0RpeoyzOfTuFplwiYZ0eYRPjR7CMooxQeRww4nz5px8Vy3ZP001iSm3DrC"),Pte=()=>{const t=pte(),r=ute(),{toast:l}=yp(),[d,_]=B.useState(!1),x=async C=>{if(C.preventDefault(),!t||!r)return;_(!0);const{error:s}=await t.confirmPayment({elements:r,confirmParams:{return_url:`${window.location.origin}/?payment=success`}});l(s?{title:"Payment Failed",description:s.message,variant:"destructive"}:{title:"Payment Successful",description:"You are now a verified host! You can create communities and events."}),_(!1)};return w.jsxs("form",{onSubmit:x,className:"space-y-6",children:[w.jsx(mte,{}),w.jsx(An,{type:"submit",disabled:!t||d,className:"w-full","data-testid":"button-submit-payment",children:d?"Processing...":"Pay $50 Annual Fee"})]})};function Mte(){const{user:t,isVerifiedHost:r}=u_(),[l,d]=B.useState(""),[_,x]=B.useState(!0);return B.useEffect(()=>{t&&op("/api/create-verified-host-payment",{method:"POST",body:JSON.stringify({})}).then(C=>{d(C.clientSecret),x(!1)}).catch(C=>{console.error("Error creating payment intent:",C),x(!1)})},[t]),r?w.jsx("div",{className:"container mx-auto py-8 px-4",children:w.jsx(ei,{className:"max-w-md mx-auto",children:w.jsxs(Yi,{className:"text-center",children:[w.jsx(ep,{className:"mx-auto h-12 w-12 text-green-500 mb-4"}),w.jsx(us,{children:"You're Already a Verified Host!"}),w.jsxs(Fl,{children:["You can create communities and events. Your verification expires on"," ",(t==null?void 0:t.verifiedHostExpiresAt)&&new Date(t.verifiedHostExpiresAt).toLocaleDateString()]})]})})}):_?w.jsx("div",{className:"container mx-auto py-8 px-4",children:w.jsx("div",{className:"h-screen flex items-center justify-center",children:w.jsx("div",{className:"animate-spin w-8 h-8 border-4 border-primary border-t-transparent rounded-full","aria-label":"Loading"})})}):l?w.jsx("div",{className:"container mx-auto py-8 px-4",children:w.jsxs(ei,{className:"max-w-md mx-auto",children:[w.jsxs(Yi,{children:[w.jsx(us,{children:"Become a Verified Host"}),w.jsx(Fl,{children:"Pay the annual $50 fee to become a verified host and create communities and events."})]}),w.jsxs(fi,{children:[w.jsxs("div",{className:"mb-6",children:[w.jsx("h3",{className:"font-semibold mb-2",children:"What you get:"}),w.jsxs("ul",{className:"text-sm text-muted-foreground space-y-1",children:[w.jsx("li",{children:"• Create unlimited communities"}),w.jsx("li",{children:"• Host events in your area"}),w.jsx("li",{children:"• Moderate discussions"}),w.jsx("li",{children:"• Valid for one year"})]})]}),w.jsx(iV,{stripe:Ite,options:{clientSecret:l},children:w.jsx(Pte,{})})]})]})}):w.jsx("div",{className:"container mx-auto py-8 px-4",children:w.jsx(ei,{className:"max-w-md mx-auto",children:w.jsxs(Yi,{children:[w.jsx(us,{children:"Payment Error"}),w.jsx(Fl,{children:"Unable to initialize payment. Please try again later."})]})})})}const Rte=lJ,uV=B.createContext({}),kf=({...t})=>w.jsx(uV.Provider,{value:{name:t.name},children:w.jsx(hJ,{...t})}),R2=()=>{const t=B.useContext(uV),r=B.useContext(dV),{getFieldState:l,formState:d}=I2(),_=l(t.name,d);if(!t)throw new Error("useFormField should be used within <FormField>");const{id:x}=r;return{id:x,name:t.name,formItemId:`${x}-form-item`,formDescriptionId:`${x}-form-item-description`,formMessageId:`${x}-form-item-message`,..._}},dV=B.createContext({}),Id=B.forwardRef(({className:t,...r},l)=>{const d=B.useId();return w.jsx(dV.Provider,{value:{id:d},children:w.jsx("div",{ref:l,className:rr("space-y-2",t),...r})})});Id.displayName="FormItem";const Pd=B.forwardRef(({className:t,...r},l)=>{const{error:d,formItemId:_}=R2();return w.jsx(Ml,{ref:l,className:rr(d&&"text-destructive",t),htmlFor:_,...r})});Pd.displayName="FormLabel";const Md=B.forwardRef(({...t},r)=>{const{error:l,formItemId:d,formDescriptionId:_,formMessageId:x}=R2();return w.jsx(Rc,{ref:r,id:d,"aria-describedby":l?`${_} ${x}`:`${_}`,"aria-invalid":!!l,...t})});Md.displayName="FormControl";const Wm=B.forwardRef(({className:t,...r},l)=>{const{formDescriptionId:d}=R2();return w.jsx("p",{ref:l,id:d,className:rr("text-sm text-muted-foreground",t),...r})});Wm.displayName="FormDescription";const Zm=B.forwardRef(({className:t,children:r,...l},d)=>{const{error:_,formMessageId:x}=R2(),C=_?String(_==null?void 0:_.message):r;return C?w.jsx("p",{ref:d,id:x,className:rr("text-sm font-medium text-destructive",t),...l,children:C}):null});Zm.displayName="FormMessage";var uP="Checkbox",[kte,sne]=Gl(uP),[Dte,Lte]=kte(uP),hV=B.forwardRef((t,r)=>{const{__scopeCheckbox:l,name:d,checked:_,defaultChecked:x,required:C,disabled:s,value:k="on",onCheckedChange:z,form:V,...U}=t,[$,se]=B.useState(null),ae=ni(r,Me=>se(Me)),H=B.useRef(!1),ne=$?V||!!$.closest("form"):!0,[Y=!1,te]=kc({prop:_,defaultProp:x,onChange:z}),de=B.useRef(Y);return B.useEffect(()=>{const Me=$==null?void 0:$.form;if(Me){const Le=()=>te(de.current);return Me.addEventListener("reset",Le),()=>Me.removeEventListener("reset",Le)}},[$,te]),w.jsxs(Dte,{scope:l,state:Y,disabled:s,children:[w.jsx(ir.button,{type:"button",role:"checkbox","aria-checked":ih(Y)?"mixed":Y,"aria-required":C,"data-state":mV(Y),"data-disabled":s?"":void 0,disabled:s,value:k,...U,ref:ae,onKeyDown:mn(t.onKeyDown,Me=>{Me.key==="Enter"&&Me.preventDefault()}),onClick:mn(t.onClick,Me=>{te(Le=>ih(Le)?!0:!Le),ne&&(H.current=Me.isPropagationStopped(),H.current||Me.stopPropagation())})}),ne&&w.jsx(Nte,{control:$,bubbles:!H.current,name:d,value:k,checked:Y,required:C,disabled:s,form:V,style:{transform:"translateX(-100%)"},defaultChecked:ih(x)?!1:x})]})});hV.displayName=uP;var fV="CheckboxIndicator",pV=B.forwardRef((t,r)=>{const{__scopeCheckbox:l,forceMount:d,..._}=t,x=Lte(fV,l);return w.jsx(io,{present:d||ih(x.state)||x.state===!0,children:w.jsx(ir.span,{"data-state":mV(x.state),"data-disabled":x.disabled?"":void 0,..._,ref:r,style:{pointerEvents:"none",...t.style}})})});pV.displayName=fV;var Nte=t=>{const{control:r,checked:l,bubbles:d=!0,defaultChecked:_,...x}=t,C=B.useRef(null),s=Dj(l),k=lF(r);B.useEffect(()=>{const V=C.current,U=window.HTMLInputElement.prototype,se=Object.getOwnPropertyDescriptor(U,"checked").set;if(s!==l&&se){const ae=new Event("click",{bubbles:d});V.indeterminate=ih(l),se.call(V,ih(l)?!1:l),V.dispatchEvent(ae)}},[s,l,d]);const z=B.useRef(ih(l)?!1:l);return w.jsx("input",{type:"checkbox","aria-hidden":!0,defaultChecked:_??z.current,...x,tabIndex:-1,ref:C,style:{...t.style,...k,position:"absolute",pointerEvents:"none",opacity:0,margin:0}})};function ih(t){return t==="indeterminate"}function mV(t){return ih(t)?"indeterminate":t?"checked":"unchecked"}var gV=hV,zte=pV;const fA=B.forwardRef(({className:t,...r},l)=>w.jsx(gV,{ref:l,className:rr("peer h-4 w-4 shrink-0 rounded-sm border border-primary ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground",t),...r,children:w.jsx(zte,{className:rr("flex items-center justify-center text-current"),children:w.jsx(hI,{className:"h-4 w-4"})})}));fA.displayName=gV.displayName;const Ote=ht.object({name:ht.string().min(1,"Community name is required").max(100,"Community name too long"),description:ht.string().max(500,"Description too long"),category:ht.string().min(1,"Category is required"),maxGeographicScope:ht.enum(["neighborhood","city","state","national","global"]).default("global"),tags:ht.string().optional(),isPublic:ht.boolean().default(!0),requiresApproval:ht.boolean().default(!1)});function Fte(){const{user:t}=u_(),r=Hl(),{toast:l}=yp(),d=h2(),{data:_}=Ia({queryKey:["/api/user/has-community"],enabled:!!t}),x=DB({resolver:NB(Ote),defaultValues:{name:"",description:"",category:"",maxGeographicScope:"global",tags:"",isPublic:!0,requiresApproval:!1}}),C=dh({mutationFn:async k=>{if(!t)throw new Error("User not authenticated");return op("/api/communities",{method:"POST",body:JSON.stringify({...k,tags:k.tags?k.tags.split(",").map(z=>z.trim()):[]})})},onSuccess:k=>{l({title:"Community Created",description:"Your community has been created successfully!"}),d.invalidateQueries({queryKey:["/api/communities"]}),d.invalidateQueries({queryKey:["/api/user/has-community"]}),r(`/communities/${k.id}`)},onError:k=>{l({title:"Error",description:k.message||"Failed to create community",variant:"destructive"})}}),s=k=>{C.mutate(k)};return t?_!=null&&_.hasCommunity?w.jsx("div",{className:"container mx-auto py-8 px-4",children:w.jsxs(ei,{className:"max-w-md mx-auto",children:[w.jsxs(Yi,{children:[w.jsx(us,{children:"Community Limit Reached"}),w.jsx(Fl,{children:"You already have a community. Each user can only create one community."})]}),w.jsx(fi,{children:w.jsx(An,{onClick:()=>r("/communities"),className:"w-full","data-testid":"button-view-communities",children:"View My Communities"})})]})}):w.jsxs("div",{className:"container mx-auto py-8 px-4 max-w-2xl",children:[w.jsxs("div",{className:"mb-6",children:[w.jsxs(An,{variant:"ghost",onClick:()=>r(-1),className:"mb-4","data-testid":"button-back",children:[w.jsx(r2,{className:"mr-2 h-4 w-4"}),"Back"]}),w.jsx("h1",{className:"text-3xl font-bold mb-2",children:"Create Community"}),w.jsx("p",{className:"text-muted-foreground",children:"Create a new community to bring people together around shared interests or local activities."})]}),w.jsxs(ei,{children:[w.jsxs(Yi,{children:[w.jsxs(us,{className:"flex items-center gap-2",children:[w.jsx(ho,{className:"h-5 w-5"}),"Community Details"]}),w.jsx(Fl,{children:"All communities start as global by default. Members can toggle between global and local views."})]}),w.jsx(fi,{children:w.jsx(Rte,{...x,children:w.jsxs("form",{onSubmit:x.handleSubmit(s),className:"space-y-6",children:[w.jsx(kf,{control:x.control,name:"name",render:({field:k})=>w.jsxs(Id,{children:[w.jsx(Pd,{children:"Community Name"}),w.jsx(Md,{children:w.jsx(Mo,{placeholder:"e.g., Local Hiking Group, Book Club, Tech Meetup",...k,"data-testid":"input-community-name"})}),w.jsx(Zm,{})]})}),w.jsx(kf,{control:x.control,name:"description",render:({field:k})=>w.jsxs(Id,{children:[w.jsx(Pd,{children:"Description"}),w.jsx(Md,{children:w.jsx(dp,{placeholder:"Describe what your community is about, what activities you'll do, and who should join...",rows:4,...k,"data-testid":"textarea-description"})}),w.jsx(Wm,{children:"Help people understand what your community is about"}),w.jsx(Zm,{})]})}),w.jsx(kf,{control:x.control,name:"category",render:({field:k})=>w.jsxs(Id,{children:[w.jsx(Pd,{children:"Category"}),w.jsxs(qg,{onValueChange:k.onChange,defaultValue:k.value,children:[w.jsx(Md,{children:w.jsx(lp,{"data-testid":"select-category",children:w.jsx(Wg,{placeholder:"Select a category"})})}),w.jsxs(cp,{children:[w.jsx(zi,{value:"social",children:"Social"}),w.jsx(zi,{value:"sports",children:"Sports & Fitness"}),w.jsx(zi,{value:"professional",children:"Professional"}),w.jsx(zi,{value:"hobbies",children:"Hobbies & Interests"}),w.jsx(zi,{value:"volunteering",children:"Volunteering"}),w.jsx(zi,{value:"education",children:"Education & Learning"}),w.jsx(zi,{value:"family",children:"Family & Kids"}),w.jsx(zi,{value:"arts",children:"Arts & Culture"}),w.jsx(zi,{value:"support",children:"Support Groups"}),w.jsx(zi,{value:"other",children:"Other"})]})]}),w.jsx(Zm,{})]})}),w.jsx(kf,{control:x.control,name:"maxGeographicScope",render:({field:k})=>w.jsxs(Id,{children:[w.jsx(Pd,{children:"Maximum Geographic Scope"}),w.jsxs(qg,{onValueChange:k.onChange,defaultValue:k.value,children:[w.jsx(Md,{children:w.jsx(lp,{"data-testid":"select-max-scope",children:w.jsx(Wg,{placeholder:"Select geographic scope"})})}),w.jsxs(cp,{children:[w.jsx(zi,{value:"neighborhood",children:"Neighborhood - Most Local"}),w.jsx(zi,{value:"city",children:"City"}),w.jsx(zi,{value:"state",children:"State/Province"}),w.jsx(zi,{value:"national",children:"National"}),w.jsx(zi,{value:"global",children:"Global - Worldwide"})]})]}),w.jsx(Wm,{children:"Chat members can filter by this scope or smaller. Global is always available."}),w.jsx(Zm,{})]})}),w.jsx(kf,{control:x.control,name:"tags",render:({field:k})=>w.jsxs(Id,{children:[w.jsx(Pd,{children:"Tags (Optional)"}),w.jsx(Md,{children:w.jsx(Mo,{placeholder:"hiking, outdoors, weekend (comma separated)",...k,"data-testid":"input-tags"})}),w.jsx(Wm,{children:"Add tags to help people find your community"}),w.jsx(Zm,{})]})}),w.jsxs("div",{className:"space-y-4",children:[w.jsx("h3",{className:"text-lg font-semibold",children:"Community Settings"}),w.jsx(kf,{control:x.control,name:"isPublic",render:({field:k})=>w.jsxs(Id,{className:"flex flex-row items-start space-x-3 space-y-0",children:[w.jsx(Md,{children:w.jsx(fA,{checked:k.value,onCheckedChange:k.onChange,"data-testid":"checkbox-public"})}),w.jsxs("div",{className:"space-y-1 leading-none",children:[w.jsxs(Pd,{className:"flex items-center gap-2",children:[w.jsx(tp,{className:"h-4 w-4"}),"Public Community"]}),w.jsx(Wm,{children:"Anyone can find and join this community"})]})]})}),w.jsx(kf,{control:x.control,name:"requiresApproval",render:({field:k})=>w.jsxs(Id,{className:"flex flex-row items-start space-x-3 space-y-0",children:[w.jsx(Md,{children:w.jsx(fA,{checked:k.value,onCheckedChange:k.onChange,"data-testid":"checkbox-approval"})}),w.jsxs("div",{className:"space-y-1 leading-none",children:[w.jsxs(Pd,{className:"flex items-center gap-2",children:[w.jsx(ro,{className:"h-4 w-4"}),"Require Approval"]}),w.jsx(Wm,{children:"New members need approval before joining"})]})]})})]}),w.jsxs("div",{className:"bg-muted p-4 rounded-lg",children:[w.jsx("h4",{className:"font-semibold mb-2",children:"Geographic Scope"}),w.jsxs("ul",{className:"text-sm text-muted-foreground space-y-1",children:[w.jsx("li",{children:"• Set the maximum geographic scope for chat filtering"}),w.jsx("li",{children:"• Members can filter by your chosen scope or smaller regions"}),w.jsx("li",{children:"• Global chat is always available regardless of scope"}),w.jsx("li",{children:"• Example: State scope allows state, city, and neighborhood filters"})]})]}),w.jsx(An,{type:"submit",className:"w-full",disabled:C.isPending,"data-testid":"button-create-community",children:C.isPending?"Creating...":"Create Community"})]})})})]})]}):w.jsx("div",{className:"container mx-auto py-8 px-4",children:w.jsx(ei,{className:"max-w-md mx-auto",children:w.jsxs(Yi,{children:[w.jsx(us,{children:"Authentication Required"}),w.jsx(Fl,{children:"Please sign in to create a community."})]})})})}const jte=()=>{const[t]=OZ(),r=Hl(),{user:l}=u_(),[d,_]=B.useState(!1),[x,C]=B.useState(null),[s,k]=B.useState(null),z=t.get("id")||"unknown",V=t.get("name")||"Unknown Community",U=(l==null?void 0:l.id)||"guest",$=(l==null?void 0:l.name)||"Guest",se=()=>{r("/")},ae=(H,ne)=>{console.log("Opening DM with:",H,ne),C(H),k(ne),_(!0)};return w.jsxs(w.Fragment,{children:[w.jsx(BI,{communityId:z,communityName:V,currentUserId:U,currentUserName:$,onClose:se,onOpenDM:ae}),w.jsx(XB,{isOpen:d,onClose:()=>{_(!1),C(null),k(null)},currentUserId:U,currentUserName:$,selectedUserId:x||void 0,selectedUserName:s||void 0})]})};function Bte(){const[t,r]=B.useState(""),[l,d]=B.useState(!1),[_,x]=B.useState(""),[C,s]=B.useState(null),[k,z]=B.useState(""),{toast:V}=yp(),U=async()=>{try{(await fetch("/api/stories/pending",{headers:{"X-Moderator-Key":t}})).ok?(x(t),d(!0),V({title:"Authenticated",description:"Access granted to moderation panel"})):V({title:"Authentication Failed",description:"Invalid password. Please try again.",variant:"destructive"})}catch{V({title:"Error",description:"Failed to authenticate. Please try again.",variant:"destructive"})}},{data:$=[],isLoading:se,error:ae}=Ia({queryKey:["/api/stories/pending"],queryFn:async()=>{const Y=await fetch("/api/stories/pending",{headers:{"X-Moderator-Key":_}});if(!Y.ok)throw Y.status===403?(d(!1),x(""),V({title:"Session Expired",description:"Please login again",variant:"destructive"}),new Error("Unauthorized")):new Error("Failed to fetch pending stories");return Y.json()},enabled:l,refetchInterval:1e4}),H=dh({mutationFn:async Y=>{const te=await fetch(`/api/stories/${Y.storyId}/moderate`,{method:"POST",headers:{"Content-Type":"application/json","X-Moderator-Key":_},body:JSON.stringify({action:Y.action,notes:Y.notes,moderatorId:"supadmin"})});if(!te.ok)throw new Error("Failed to moderate story");return te.json()},onSuccess:()=>{Pu.invalidateQueries({queryKey:["/api/stories/pending"]}),s(null),z(""),V({title:"Success",description:"Story moderation completed"})},onError:Y=>{V({title:"Moderation Failed",description:Y.message||"Failed to moderate story. Please try again.",variant:"destructive"})}}),ne=(Y,te)=>{H.mutate({storyId:Y,action:te,notes:k,moderatorId:"supadmin"})};return l?w.jsxs("div",{className:"min-h-screen bg-black text-white",children:[w.jsx("div",{className:"border-b border-gray-800 p-6",children:w.jsxs("div",{className:"container mx-auto flex items-center justify-between",children:[w.jsxs("div",{children:[w.jsxs("h1",{className:"text-2xl font-bold flex items-center gap-2","data-testid":"text-panel-title",children:[w.jsx(wL,{className:"h-6 w-6 text-purple-500"}),"Story Moderation Panel"]}),w.jsx("p",{className:"text-gray-400 text-sm","data-testid":"text-panel-description",children:"Review and approve humanitarian crisis stories"})]}),w.jsxs("div",{className:"flex items-center gap-4",children:[w.jsxs(wi,{variant:"outline",className:"text-purple-400 border-purple-400","data-testid":"badge-pending-count",children:[$.length," Pending"]}),w.jsx(An,{variant:"outline",onClick:()=>{d(!1),x(""),r("")},"data-testid":"button-logout",children:"Logout"})]})]})}),w.jsx("div",{className:"container mx-auto p-6",children:w.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[w.jsxs("div",{children:[w.jsxs("h2",{className:"text-xl font-semibold mb-4","data-testid":"text-stories-heading",children:["Pending Stories (",$.length,")"]}),se?w.jsxs("div",{className:"text-center py-12","data-testid":"text-loading",children:[w.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-purple-500 mx-auto mb-4"}),w.jsx("p",{className:"text-gray-400",children:"Loading pending stories..."})]}):ae?w.jsx(ei,{className:"bg-gray-900 border-gray-700",children:w.jsxs(fi,{className:"p-12 text-center","data-testid":"text-error",children:[w.jsx(fI,{className:"h-12 w-12 text-red-500 mx-auto mb-4"}),w.jsx("h3",{className:"text-lg font-semibold text-gray-400 mb-2",children:"Failed to Load Stories"}),w.jsx("p",{className:"text-gray-500",children:ae.message||"An error occurred while loading pending stories"})]})}):$.length===0?w.jsx(ei,{className:"bg-gray-900 border-gray-700",children:w.jsxs(fi,{className:"p-12 text-center","data-testid":"text-no-stories",children:[w.jsx(bL,{className:"h-12 w-12 text-gray-600 mx-auto mb-4"}),w.jsx("h3",{className:"text-lg font-semibold text-gray-400 mb-2",children:"No Pending Stories"}),w.jsx("p",{className:"text-gray-500",children:"All stories have been reviewed"})]})}):w.jsx(up,{className:"h-[calc(100vh-16rem)]",children:w.jsx("div",{className:"space-y-4",children:$.map(Y=>w.jsxs(ei,{className:`bg-gray-900 border-gray-700 cursor-pointer transition-colors ${(C==null?void 0:C.id)===Y.id?"ring-2 ring-purple-500":"hover:bg-gray-800"}`,onClick:()=>{s(Y),z(Y.moderationNotes||"")},"data-testid":`story-card-${Y.id}`,children:[w.jsx(Yi,{className:"pb-3",children:w.jsxs("div",{className:"flex items-start justify-between",children:[w.jsx(us,{className:"text-white text-lg","data-testid":`story-title-${Y.id}`,children:Y.title}),w.jsx(wi,{variant:"secondary",className:"bg-yellow-900 text-yellow-400",children:"Pending"})]})}),w.jsxs(fi,{children:[w.jsx("p",{className:"text-gray-400 text-sm mb-3 line-clamp-2","data-testid":`story-excerpt-${Y.id}`,children:Y.excerpt}),w.jsxs("div",{className:"flex flex-wrap gap-3 text-xs text-gray-500",children:[w.jsxs("span",{className:"flex items-center gap-1",children:[w.jsx(np,{className:"h-3 w-3"}),Y.author]}),w.jsxs("span",{className:"flex items-center gap-1",children:[w.jsx(ro,{className:"h-3 w-3"}),Y.location.name]}),w.jsxs("span",{className:"flex items-center gap-1",children:[w.jsx(vu,{className:"h-3 w-3"}),new Date(Y.submittedAt).toLocaleDateString()]})]}),Y.images&&Y.images.length>0&&w.jsx("div",{className:"mt-3",children:w.jsxs(wi,{variant:"outline",className:"text-gray-400 border-gray-600",children:[Y.images.length," image",Y.images.length>1?"s":""]})})]})]},Y.id))})})]}),w.jsx("div",{children:C?w.jsxs(ei,{className:"bg-gray-900 border-gray-700 sticky top-6",children:[w.jsxs(Yi,{children:[w.jsx(us,{className:"text-white","data-testid":"detail-story-title",children:C.title}),w.jsxs(Fl,{className:"flex items-center gap-2",children:[w.jsx(np,{className:"h-4 w-4"}),w.jsxs("span",{"data-testid":"detail-story-author",children:["by ",C.author]})]})]}),w.jsxs(fi,{className:"space-y-4",children:[w.jsx(up,{className:"h-64",children:w.jsxs("div",{className:"space-y-4 pr-4",children:[w.jsxs("div",{children:[w.jsx("h3",{className:"text-sm font-semibold text-gray-400 mb-2",children:"Content"}),w.jsx("p",{className:"text-white text-sm","data-testid":"detail-story-content",children:C.content})]}),C.images&&C.images.length>0&&w.jsxs("div",{children:[w.jsxs("h3",{className:"text-sm font-semibold text-gray-400 mb-2",children:["Images (",C.images.length,")"]}),w.jsx("div",{className:"grid grid-cols-2 gap-2",children:C.images.map((Y,te)=>w.jsx("img",{src:Y,alt:`Story image ${te+1}`,className:"w-full h-32 object-cover rounded border border-gray-700","data-testid":`story-image-${te}`},te))})]}),w.jsxs("div",{children:[w.jsx("h3",{className:"text-sm font-semibold text-gray-400 mb-2",children:"Details"}),w.jsxs("div",{className:"space-y-2 text-sm",children:[w.jsxs("div",{className:"flex items-center gap-2 text-gray-400",children:[w.jsx(ro,{className:"h-4 w-4"}),w.jsx("span",{"data-testid":"detail-story-location",children:C.location.name})]}),w.jsxs("div",{className:"flex items-center gap-2 text-gray-400",children:[w.jsx(vu,{className:"h-4 w-4"}),w.jsx("span",{"data-testid":"detail-story-date",children:new Date(C.submittedAt).toLocaleString()})]}),C.isLocationVerified&&w.jsx(wi,{variant:"outline",className:"text-green-400 border-green-400",children:"Location Verified"})]})]})]})}),w.jsxs("div",{children:[w.jsx("h3",{className:"text-sm font-semibold text-gray-400 mb-2",children:"Moderation Notes"}),w.jsx(dp,{placeholder:"Add notes about this story (optional)",value:k,onChange:Y=>z(Y.target.value),className:"bg-gray-800 border-gray-600 text-white min-h-20","data-testid":"textarea-moderation-notes"})]}),w.jsxs("div",{className:"flex gap-2",children:[w.jsxs(An,{onClick:()=>ne(C.id,"approve"),disabled:H.isPending,className:"flex-1 bg-green-600 hover:bg-green-700","data-testid":"button-approve",children:[w.jsx(ep,{className:"h-4 w-4 mr-2"}),"Approve"]}),w.jsxs(An,{onClick:()=>ne(C.id,"reject"),disabled:H.isPending,variant:"destructive",className:"flex-1","data-testid":"button-reject",children:[w.jsx(Qv,{className:"h-4 w-4 mr-2"}),"Reject"]}),w.jsx(An,{onClick:()=>ne(C.id,"flag"),disabled:H.isPending,variant:"outline",className:"border-orange-600 text-orange-400 hover:bg-orange-900","data-testid":"button-flag",children:w.jsx(pI,{className:"h-4 w-4"})})]})]})]}):w.jsx(ei,{className:"bg-gray-900 border-gray-700",children:w.jsxs(fi,{className:"p-12 text-center",children:[w.jsx(bL,{className:"h-12 w-12 text-gray-600 mx-auto mb-4"}),w.jsx("h3",{className:"text-lg font-semibold text-gray-400 mb-2","data-testid":"text-select-story",children:"Select a Story"}),w.jsx("p",{className:"text-gray-500",children:"Click on a story from the left to review and moderate"})]})})})]})})]}):w.jsx("div",{className:"min-h-screen bg-black flex items-center justify-center p-4",children:w.jsxs(ei,{className:"w-full max-w-md bg-gray-900 border-gray-700",children:[w.jsxs(Yi,{children:[w.jsx("div",{className:"flex items-center justify-center mb-4",children:w.jsx(wL,{className:"h-12 w-12 text-purple-500"})}),w.jsx(us,{className:"text-center text-white text-2xl",children:"Super Admin Panel"}),w.jsx(Fl,{className:"text-center text-gray-400",children:"Enter password to access story moderation"})]}),w.jsx(fi,{children:w.jsxs("div",{className:"space-y-4",children:[w.jsx(Mo,{type:"password",placeholder:"Enter admin password",value:t,onChange:Y=>r(Y.target.value),onKeyDown:Y=>Y.key==="Enter"&&U(),className:"bg-gray-800 border-gray-600 text-white","data-testid":"input-admin-password"}),w.jsx(An,{onClick:U,className:"w-full","data-testid":"button-admin-login",children:"Login"})]})})]})})}const Vte=()=>{const t=Hl(),{googleUser:r,signIn:l,loading:d}=u_();return B.useEffect(()=>{r&&t("/create-community")},[r,t]),d?w.jsx("div",{className:"min-h-screen flex items-center justify-center bg-background",children:w.jsx(Jv,{className:"h-8 w-8 animate-spin text-primary"})}):w.jsx("div",{className:"min-h-screen flex items-center justify-center bg-background p-4",children:w.jsxs(ei,{className:"max-w-md w-full",children:[w.jsxs(Yi,{className:"text-center",children:[w.jsx(us,{className:"text-2xl",children:"Join Our Community"}),w.jsx(Fl,{children:"Connect with others and make a difference in your local area"})]}),w.jsxs(fi,{className:"space-y-6",children:[w.jsxs("div",{className:"space-y-4",children:[w.jsxs("div",{className:"flex items-start gap-3",children:[w.jsx("div",{className:"mt-1 p-2 rounded-full bg-primary/10",children:w.jsx(ho,{className:"h-5 w-5 text-primary"})}),w.jsxs("div",{children:[w.jsx("h3",{className:"font-semibold mb-1",children:"Create Your Community"}),w.jsx("p",{className:"text-sm text-muted-foreground",children:"Build and manage your own community with up to 500 members"})]})]}),w.jsxs("div",{className:"flex items-start gap-3",children:[w.jsx("div",{className:"mt-1 p-2 rounded-full bg-primary/10",children:w.jsx(Pc,{className:"h-5 w-5 text-primary"})}),w.jsxs("div",{children:[w.jsx("h3",{className:"font-semibold mb-1",children:"Engage in Real-Time Chat"}),w.jsx("p",{className:"text-sm text-muted-foreground",children:"Connect through threaded discussions and stay informed"})]})]}),w.jsxs("div",{className:"flex items-start gap-3",children:[w.jsx("div",{className:"mt-1 p-2 rounded-full bg-primary/10",children:w.jsx(tp,{className:"h-5 w-5 text-primary"})}),w.jsxs("div",{children:[w.jsx("h3",{className:"font-semibold mb-1",children:"Set Your Geographic Scope"}),w.jsx("p",{className:"text-sm text-muted-foreground",children:"Choose from neighborhood to global reach for your community"})]})]}),w.jsxs("div",{className:"flex items-start gap-3",children:[w.jsx("div",{className:"mt-1 p-2 rounded-full bg-primary/10",children:w.jsx(ro,{className:"h-5 w-5 text-primary"})}),w.jsxs("div",{children:[w.jsx("h3",{className:"font-semibold mb-1",children:"Access Crisis Response Tools"}),w.jsx("p",{className:"text-sm text-muted-foreground",children:"Support humanitarian efforts and share important stories"})]})]})]}),w.jsx(An,{onClick:l,className:"w-full",size:"lg","data-testid":"button-join-signin",children:"Sign in with Google to Get Started"}),w.jsx("p",{className:"text-xs text-center text-muted-foreground",children:"By signing in, you agree to create one community per account"})]})]})})},Ute=()=>w.jsx(EW,{client:Pu,children:w.jsx(WZ,{children:w.jsx(iW,{children:w.jsxs("div",{className:"dark",children:[w.jsx(rH,{}),w.jsx(kH,{}),w.jsx(DZ,{children:w.jsxs(EZ,{children:[w.jsx(Sl,{path:"/",element:w.jsx(tJ,{})}),w.jsx(Sl,{path:"/join",element:w.jsx(Vte,{})}),w.jsx(Sl,{path:"/crisis/:id",element:w.jsx(Vee,{})}),w.jsx(Sl,{path:"/communities",element:w.jsx(Hee,{})}),w.jsx(Sl,{path:"/moderation",element:w.jsx(qee,{})}),w.jsx(Sl,{path:"/become-host",element:w.jsx(Mte,{})}),w.jsx(Sl,{path:"/create-community",element:w.jsx(Fte,{})}),w.jsx(Sl,{path:"/community-chat",element:w.jsx(jte,{})}),w.jsx(Sl,{path:"/supadmin",element:w.jsx(Bte,{})}),w.jsx(Sl,{path:"*",element:w.jsx(nJ,{})})]})})]})})})});sO(document.getElementById("root")).render(w.jsx(Ute,{}));
